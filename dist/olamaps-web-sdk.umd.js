(function(){"use strict";try{if(typeof document<"u"){var l=document.createElement("style");l.appendChild(document.createTextNode(`.maplibregl-map{font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif;overflow:hidden;position:relative;-webkit-tap-highlight-color:rgb(0,0,0,0)}.maplibregl-canvas{left:0;position:absolute;top:0}.maplibregl-map:fullscreen{height:100%;width:100%}.maplibregl-ctrl-group button.maplibregl-ctrl-compass{touch-action:none}.maplibregl-canvas-container.maplibregl-interactive,.maplibregl-ctrl-group button.maplibregl-ctrl-compass{cursor:grab;-webkit-user-select:none;-moz-user-select:none;user-select:none}.maplibregl-canvas-container.maplibregl-interactive.maplibregl-track-pointer{cursor:pointer}.maplibregl-canvas-container.maplibregl-interactive:active,.maplibregl-ctrl-group button.maplibregl-ctrl-compass:active{cursor:grabbing}.maplibregl-canvas-container.maplibregl-touch-zoom-rotate,.maplibregl-canvas-container.maplibregl-touch-zoom-rotate .maplibregl-canvas{touch-action:pan-x pan-y}.maplibregl-canvas-container.maplibregl-touch-drag-pan,.maplibregl-canvas-container.maplibregl-touch-drag-pan .maplibregl-canvas{touch-action:pinch-zoom}.maplibregl-canvas-container.maplibregl-touch-zoom-rotate.maplibregl-touch-drag-pan,.maplibregl-canvas-container.maplibregl-touch-zoom-rotate.maplibregl-touch-drag-pan .maplibregl-canvas{touch-action:none}.maplibregl-canvas-container.maplibregl-touch-drag-pan.maplibregl-cooperative-gestures,.maplibregl-canvas-container.maplibregl-touch-drag-pan.maplibregl-cooperative-gestures .maplibregl-canvas{touch-action:pan-x pan-y}.maplibregl-ctrl-bottom-left,.maplibregl-ctrl-bottom-right,.maplibregl-ctrl-top-left,.maplibregl-ctrl-top-right{pointer-events:none;position:absolute;z-index:2}.maplibregl-ctrl-top-left{left:0;top:0}.maplibregl-ctrl-top-right{right:0;top:0}.maplibregl-ctrl-bottom-left{bottom:0;left:0}.maplibregl-ctrl-bottom-right{bottom:0;right:0}.maplibregl-ctrl{clear:both;pointer-events:auto;transform:translate(0)}.maplibregl-ctrl-top-left .maplibregl-ctrl{float:left;margin:10px 0 0 10px}.maplibregl-ctrl-top-right .maplibregl-ctrl{float:right;margin:10px 10px 0 0}.maplibregl-ctrl-bottom-left .maplibregl-ctrl{float:left;margin:0 0 10px 10px}.maplibregl-ctrl-bottom-right .maplibregl-ctrl{float:right;margin:0 10px 10px 0}.maplibregl-ctrl-group{background:#fff;border-radius:4px}.maplibregl-ctrl-group:not(:empty){box-shadow:0 0 0 2px #0000001a}@media (forced-colors:active){.maplibregl-ctrl-group:not(:empty){box-shadow:0 0 0 2px ButtonText}}.maplibregl-ctrl-group button{background-color:transparent;border:0;box-sizing:border-box;cursor:pointer;display:block;height:29px;outline:none;padding:0;width:29px}.maplibregl-ctrl-group button+button{border-top:1px solid #ddd}.maplibregl-ctrl button .maplibregl-ctrl-icon{background-position:50%;background-repeat:no-repeat;display:block;height:100%;width:100%}@media (forced-colors:active){.maplibregl-ctrl-icon{background-color:transparent}.maplibregl-ctrl-group button+button{border-top:1px solid ButtonText}}.maplibregl-ctrl button::-moz-focus-inner{border:0;padding:0}.maplibregl-ctrl-attrib-button:focus,.maplibregl-ctrl-group button:focus{box-shadow:0 0 2px 2px #0096ff}.maplibregl-ctrl button:disabled{cursor:not-allowed}.maplibregl-ctrl button:disabled .maplibregl-ctrl-icon{opacity:.25}@media (hover:hover){.maplibregl-ctrl button:not(:disabled):hover{background-color:#0000000d}}.maplibregl-ctrl button:not(:disabled):active{background-color:#0000000d}.maplibregl-ctrl-group button:focus:focus-visible{box-shadow:0 0 2px 2px #0096ff}.maplibregl-ctrl-group button:focus:not(:focus-visible){box-shadow:none}.maplibregl-ctrl-group button:focus:first-child{border-radius:4px 4px 0 0}.maplibregl-ctrl-group button:focus:last-child{border-radius:0 0 4px 4px}.maplibregl-ctrl-group button:focus:only-child{border-radius:inherit}.maplibregl-ctrl button.maplibregl-ctrl-zoom-out .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23333' viewBox='0 0 29 29'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-zoom-in .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23333' viewBox='0 0 29 29'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5'/%3E%3C/svg%3E")}@media (forced-colors:active){.maplibregl-ctrl button.maplibregl-ctrl-zoom-out .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23fff' viewBox='0 0 29 29'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-zoom-in .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23fff' viewBox='0 0 29 29'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5'/%3E%3C/svg%3E")}}@media (forced-colors:active) and (prefers-color-scheme:light){.maplibregl-ctrl button.maplibregl-ctrl-zoom-out .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' viewBox='0 0 29 29'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-zoom-in .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' viewBox='0 0 29 29'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5'/%3E%3C/svg%3E")}}.maplibregl-ctrl button.maplibregl-ctrl-fullscreen .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23333' viewBox='0 0 29 29'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-shrink .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' viewBox='0 0 29 29'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1z'/%3E%3C/svg%3E")}@media (forced-colors:active){.maplibregl-ctrl button.maplibregl-ctrl-fullscreen .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23fff' viewBox='0 0 29 29'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-shrink .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23fff' viewBox='0 0 29 29'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1z'/%3E%3C/svg%3E")}}@media (forced-colors:active) and (prefers-color-scheme:light){.maplibregl-ctrl button.maplibregl-ctrl-fullscreen .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' viewBox='0 0 29 29'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-shrink .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' viewBox='0 0 29 29'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1z'/%3E%3C/svg%3E")}}.maplibregl-ctrl button.maplibregl-ctrl-compass .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23333' viewBox='0 0 29 29'%3E%3Cpath d='m10.5 14 4-8 4 8z'/%3E%3Cpath fill='%23ccc' d='m10.5 16 4 8 4-8z'/%3E%3C/svg%3E")}@media (forced-colors:active){.maplibregl-ctrl button.maplibregl-ctrl-compass .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23fff' viewBox='0 0 29 29'%3E%3Cpath d='m10.5 14 4-8 4 8z'/%3E%3Cpath fill='%23ccc' d='m10.5 16 4 8 4-8z'/%3E%3C/svg%3E")}}@media (forced-colors:active) and (prefers-color-scheme:light){.maplibregl-ctrl button.maplibregl-ctrl-compass .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' viewBox='0 0 29 29'%3E%3Cpath d='m10.5 14 4-8 4 8z'/%3E%3Cpath fill='%23ccc' d='m10.5 16 4 8 4-8z'/%3E%3C/svg%3E")}}.maplibregl-ctrl button.maplibregl-ctrl-globe .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='22' height='22' fill='none' stroke='%23333' viewBox='0 0 22 22'%3E%3Ccircle cx='11' cy='11' r='8.5'/%3E%3Cpath d='M17.5 11c0 4.819-3.02 8.5-6.5 8.5S4.5 15.819 4.5 11 7.52 2.5 11 2.5s6.5 3.681 6.5 8.5Z'/%3E%3Cpath d='M13.5 11c0 2.447-.331 4.64-.853 6.206-.262.785-.562 1.384-.872 1.777-.314.399-.58.517-.775.517s-.461-.118-.775-.517c-.31-.393-.61-.992-.872-1.777C8.831 15.64 8.5 13.446 8.5 11s.331-4.64.853-6.206c.262-.785.562-1.384.872-1.777.314-.399.58-.517.775-.517s.461.118.775.517c.31.393.61.992.872 1.777.522 1.565.853 3.76.853 6.206Z'/%3E%3Cpath d='M11 7.5c-1.909 0-3.622-.166-4.845-.428-.616-.132-1.08-.283-1.379-.434a1.3 1.3 0 0 1-.224-.138q.07-.058.224-.138c.299-.151.763-.302 1.379-.434C7.378 5.666 9.091 5.5 11 5.5s3.622.166 4.845.428c.616.132 1.08.283 1.379.434.105.053.177.1.224.138q-.07.058-.224.138c-.299.151-.763.302-1.379.434-1.223.262-2.936.428-4.845.428ZM4.486 6.436ZM11 16.5c-1.909 0-3.622-.166-4.845-.428-.616-.132-1.08-.283-1.379-.434a1.3 1.3 0 0 1-.224-.138 1.3 1.3 0 0 1 .224-.138c.299-.151.763-.302 1.379-.434C7.378 14.666 9.091 14.5 11 14.5s3.622.166 4.845.428c.616.132 1.08.283 1.379.434.105.053.177.1.224.138a1.3 1.3 0 0 1-.224.138c-.299.151-.763.302-1.379.434-1.223.262-2.936.428-4.845.428Zm-6.514-1.064ZM11 12.5c-2.46 0-4.672-.222-6.255-.574-.796-.177-1.406-.38-1.805-.59a1.5 1.5 0 0 1-.39-.272.3.3 0 0 1-.047-.064.3.3 0 0 1 .048-.064c.066-.073.189-.167.389-.272.399-.21 1.009-.413 1.805-.59C6.328 9.722 8.54 9.5 11 9.5s4.672.222 6.256.574c.795.177 1.405.38 1.804.59.2.105.323.2.39.272a.3.3 0 0 1 .047.064.3.3 0 0 1-.048.064 1.4 1.4 0 0 1-.389.272c-.399.21-1.009.413-1.804.59-1.584.352-3.796.574-6.256.574Zm-8.501-1.51v.002zm0 .018v.002zm17.002.002v-.002zm0-.018v-.002z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-globe-enabled .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='22' height='22' fill='none' stroke='%2333b5e5' viewBox='0 0 22 22'%3E%3Ccircle cx='11' cy='11' r='8.5'/%3E%3Cpath d='M17.5 11c0 4.819-3.02 8.5-6.5 8.5S4.5 15.819 4.5 11 7.52 2.5 11 2.5s6.5 3.681 6.5 8.5Z'/%3E%3Cpath d='M13.5 11c0 2.447-.331 4.64-.853 6.206-.262.785-.562 1.384-.872 1.777-.314.399-.58.517-.775.517s-.461-.118-.775-.517c-.31-.393-.61-.992-.872-1.777C8.831 15.64 8.5 13.446 8.5 11s.331-4.64.853-6.206c.262-.785.562-1.384.872-1.777.314-.399.58-.517.775-.517s.461.118.775.517c.31.393.61.992.872 1.777.522 1.565.853 3.76.853 6.206Z'/%3E%3Cpath d='M11 7.5c-1.909 0-3.622-.166-4.845-.428-.616-.132-1.08-.283-1.379-.434a1.3 1.3 0 0 1-.224-.138q.07-.058.224-.138c.299-.151.763-.302 1.379-.434C7.378 5.666 9.091 5.5 11 5.5s3.622.166 4.845.428c.616.132 1.08.283 1.379.434.105.053.177.1.224.138q-.07.058-.224.138c-.299.151-.763.302-1.379.434-1.223.262-2.936.428-4.845.428ZM4.486 6.436ZM11 16.5c-1.909 0-3.622-.166-4.845-.428-.616-.132-1.08-.283-1.379-.434a1.3 1.3 0 0 1-.224-.138 1.3 1.3 0 0 1 .224-.138c.299-.151.763-.302 1.379-.434C7.378 14.666 9.091 14.5 11 14.5s3.622.166 4.845.428c.616.132 1.08.283 1.379.434.105.053.177.1.224.138a1.3 1.3 0 0 1-.224.138c-.299.151-.763.302-1.379.434-1.223.262-2.936.428-4.845.428Zm-6.514-1.064ZM11 12.5c-2.46 0-4.672-.222-6.255-.574-.796-.177-1.406-.38-1.805-.59a1.5 1.5 0 0 1-.39-.272.3.3 0 0 1-.047-.064.3.3 0 0 1 .048-.064c.066-.073.189-.167.389-.272.399-.21 1.009-.413 1.805-.59C6.328 9.722 8.54 9.5 11 9.5s4.672.222 6.256.574c.795.177 1.405.38 1.804.59.2.105.323.2.39.272a.3.3 0 0 1 .047.064.3.3 0 0 1-.048.064 1.4 1.4 0 0 1-.389.272c-.399.21-1.009.413-1.804.59-1.584.352-3.796.574-6.256.574Zm-8.501-1.51v.002zm0 .018v.002zm17.002.002v-.002zm0-.018v-.002z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-terrain .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='22' height='22' fill='%23333' viewBox='0 0 22 22'%3E%3Cpath d='m1.754 13.406 4.453-4.851 3.09 3.09 3.281 3.277.969-.969-3.309-3.312 3.844-4.121 6.148 6.886h1.082v-.855l-7.207-8.07-4.84 5.187L6.169 6.57l-5.48 5.965v.871ZM.688 16.844h20.625v1.375H.688Zm0 0'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-terrain-enabled .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='22' height='22' fill='%2333b5e5' viewBox='0 0 22 22'%3E%3Cpath d='m1.754 13.406 4.453-4.851 3.09 3.09 3.281 3.277.969-.969-3.309-3.312 3.844-4.121 6.148 6.886h1.082v-.855l-7.207-8.07-4.84 5.187L6.169 6.57l-5.48 5.965v.871ZM.688 16.844h20.625v1.375H.688Zm0 0'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23333' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate:disabled .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23aaa' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath fill='red' d='m14 5 1 1-9 9-1-1z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-active .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%2333b5e5' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-active-error .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23e58978' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-background .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%2333b5e5' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-background-error .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23e54e33' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-waiting .maplibregl-ctrl-icon{animation:maplibregl-spin 2s linear infinite}@media (forced-colors:active){.maplibregl-ctrl button.maplibregl-ctrl-geolocate .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23fff' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate:disabled .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23999' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath fill='red' d='m14 5 1 1-9 9-1-1z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-active .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%2333b5e5' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-active-error .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23e58978' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-background .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%2333b5e5' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-background-error .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23e54e33' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3C/svg%3E")}}@media (forced-colors:active) and (prefers-color-scheme:light){.maplibregl-ctrl button.maplibregl-ctrl-geolocate .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate:disabled .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23666' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath fill='red' d='m14 5 1 1-9 9-1-1z'/%3E%3C/svg%3E")}}@keyframes maplibregl-spin{0%{transform:rotate(0)}to{transform:rotate(1turn)}}a.maplibregl-ctrl-logo{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='88' height='23' fill='none'%3E%3Cpath fill='%23000' fill-opacity='.4' fill-rule='evenodd' d='M17.408 16.796h-1.827l2.501-12.095h.198l3.324 6.533.988 2.19.988-2.19 3.258-6.533h.181l2.6 12.095h-1.81l-1.218-5.644-.362-1.71-.658 1.71-2.929 5.644h-.098l-2.914-5.644-.757-1.71-.345 1.71zm1.958-3.42-.726 3.663a1.255 1.255 0 0 1-1.232 1.011h-1.827a1.255 1.255 0 0 1-1.229-1.509l2.501-12.095a1.255 1.255 0 0 1 1.23-1.001h.197a1.25 1.25 0 0 1 1.12.685l3.19 6.273 3.125-6.263a1.25 1.25 0 0 1 1.123-.695h.181a1.255 1.255 0 0 1 1.227.991l1.443 6.71a5 5 0 0 1 .314-.787l.009-.016a4.6 4.6 0 0 1 1.777-1.887c.782-.46 1.668-.667 2.611-.667a4.6 4.6 0 0 1 1.7.32l.306.134c.21-.16.474-.256.759-.256h1.694a1.255 1.255 0 0 1 1.212.925 1.255 1.255 0 0 1 1.212-.925h1.711c.284 0 .545.094.755.252.613-.3 1.312-.45 2.075-.45 1.356 0 2.557.445 3.482 1.4q.47.48.763 1.064V4.701a1.255 1.255 0 0 1 1.255-1.255h1.86A1.255 1.255 0 0 1 54.44 4.7v9.194h2.217c.19 0 .37.043.532.118v-4.77c0-.356.147-.678.385-.906a2.42 2.42 0 0 1-.682-1.71c0-.665.267-1.253.735-1.7a2.45 2.45 0 0 1 1.722-.674 2.43 2.43 0 0 1 1.705.675q.318.302.504.683V4.7a1.255 1.255 0 0 1 1.255-1.255h1.744A1.255 1.255 0 0 1 65.812 4.7v3.335a4.8 4.8 0 0 1 1.526-.246c.938 0 1.817.214 2.59.69a4.47 4.47 0 0 1 1.67 1.743v-.98a1.255 1.255 0 0 1 1.256-1.256h1.777c.233 0 .451.064.639.174a3.4 3.4 0 0 1 1.567-.372c.346 0 .861.02 1.285.232a1.25 1.25 0 0 1 .689 1.004 4.7 4.7 0 0 1 .853-.588c.795-.44 1.675-.647 2.61-.647 1.385 0 2.65.39 3.525 1.396.836.938 1.168 2.173 1.168 3.528q-.001.515-.056 1.051a1.255 1.255 0 0 1-.947 1.09l.408.952a1.255 1.255 0 0 1-.477 1.552c-.418.268-.92.463-1.458.612-.613.171-1.304.244-2.049.244-1.06 0-2.043-.207-2.886-.698l-.015-.008c-.798-.48-1.419-1.135-1.818-1.963l-.004-.008a5.8 5.8 0 0 1-.548-2.512q0-.429.053-.843a1.3 1.3 0 0 1-.333-.086l-.166-.004c-.223 0-.426.062-.643.228-.03.024-.142.139-.142.59v3.883a1.255 1.255 0 0 1-1.256 1.256h-1.777a1.255 1.255 0 0 1-1.256-1.256V15.69l-.032.057a4.8 4.8 0 0 1-1.86 1.833 5.04 5.04 0 0 1-2.484.634 4.5 4.5 0 0 1-1.935-.424 1.25 1.25 0 0 1-.764.258h-1.71a1.255 1.255 0 0 1-1.256-1.255V7.687a2.4 2.4 0 0 1-.428.625c.253.23.412.561.412.93v7.553a1.255 1.255 0 0 1-1.256 1.255h-1.843a1.25 1.25 0 0 1-.894-.373c-.228.23-.544.373-.894.373H51.32a1.255 1.255 0 0 1-1.256-1.255v-1.251l-.061.117a4.7 4.7 0 0 1-1.782 1.884 4.77 4.77 0 0 1-2.485.67 5.6 5.6 0 0 1-1.485-.188l.009 2.764a1.255 1.255 0 0 1-1.255 1.259h-1.729a1.255 1.255 0 0 1-1.255-1.255v-3.537a1.255 1.255 0 0 1-1.167.793h-1.679a1.25 1.25 0 0 1-.77-.263 4.5 4.5 0 0 1-1.945.429c-.885 0-1.724-.21-2.495-.632l-.017-.01a5 5 0 0 1-1.081-.836 1.255 1.255 0 0 1-1.254 1.312h-1.81a1.255 1.255 0 0 1-1.228-.99l-.782-3.625-2.044 3.939a1.25 1.25 0 0 1-1.115.676h-.098a1.25 1.25 0 0 1-1.116-.68l-2.061-3.994zM35.92 16.63l.207-.114.223-.15q.493-.356.735-.785l.061-.118.033 1.332h1.678V9.242h-1.694l-.033 1.267q-.133-.329-.526-.658l-.032-.028a3.2 3.2 0 0 0-.668-.428l-.27-.12a3.3 3.3 0 0 0-1.235-.23q-1.136-.001-1.974.493a3.36 3.36 0 0 0-1.3 1.382q-.445.89-.444 2.074 0 1.2.51 2.107a3.8 3.8 0 0 0 1.382 1.381 3.9 3.9 0 0 0 1.893.477q.795 0 1.455-.33zm-2.789-5.38q-.576.675-.575 1.762 0 1.102.559 1.794.576.675 1.645.675a2.25 2.25 0 0 0 .934-.19 2.2 2.2 0 0 0 .468-.29l.178-.161a2.2 2.2 0 0 0 .397-.561q.244-.5.244-1.15v-.115q0-.708-.296-1.267l-.043-.077a2.2 2.2 0 0 0-.633-.709l-.13-.086-.047-.028a2.1 2.1 0 0 0-1.073-.285q-1.052 0-1.629.692zm2.316 2.706c.163-.17.28-.407.28-.83v-.114c0-.292-.06-.508-.15-.68a.96.96 0 0 0-.353-.389.85.85 0 0 0-.464-.127c-.4 0-.56.114-.664.239l-.01.012c-.148.174-.275.45-.275.945 0 .506.122.801.27.99.097.11.266.224.68.224.303 0 .504-.09.687-.269zm7.545 1.705a2.6 2.6 0 0 0 .331.423q.319.33.755.548l.173.074q.65.255 1.49.255 1.02 0 1.844-.493a3.45 3.45 0 0 0 1.316-1.4q.493-.904.493-2.089 0-1.909-.988-2.913-.988-1.02-2.584-1.02-.898 0-1.575.347a3 3 0 0 0-.415.262l-.199.166a3.4 3.4 0 0 0-.64.82V9.242h-1.712v11.553h1.729l-.017-5.134zm.53-1.138q.206.29.48.5l.155.11.053.034q.51.296 1.119.297 1.07 0 1.645-.675.577-.69.576-1.762 0-1.119-.576-1.777-.558-.675-1.645-.675-.435 0-.835.16a2 2 0 0 0-.284.136 2 2 0 0 0-.363.254 2.2 2.2 0 0 0-.46.569l-.082.162a2.6 2.6 0 0 0-.213 1.072v.115q0 .707.296 1.267l.135.211zm.964-.818a1.1 1.1 0 0 0 .367.385.94.94 0 0 0 .476.118c.423 0 .59-.117.687-.23.159-.194.28-.478.28-.95 0-.53-.133-.8-.266-.952l-.021-.025c-.078-.094-.231-.221-.68-.221a1 1 0 0 0-.503.135l-.012.007a.86.86 0 0 0-.335.343c-.073.133-.132.324-.132.614v.115a1.4 1.4 0 0 0 .14.66zm15.7-6.222q.347-.346.346-.856a1.05 1.05 0 0 0-.345-.79 1.18 1.18 0 0 0-.84-.329q-.51 0-.855.33a1.05 1.05 0 0 0-.346.79q0 .51.346.855.345.346.856.346.51 0 .839-.346zm4.337 9.314.033-1.332q.191.403.59.747l.098.081a4 4 0 0 0 .316.224l.223.122a3.2 3.2 0 0 0 1.44.322 3.8 3.8 0 0 0 1.875-.477 3.5 3.5 0 0 0 1.382-1.366q.527-.89.526-2.09 0-1.184-.444-2.073a3.24 3.24 0 0 0-1.283-1.399q-.823-.51-1.942-.51a3.5 3.5 0 0 0-1.527.344l-.086.043-.165.09a3 3 0 0 0-.33.214q-.432.315-.656.707a2 2 0 0 0-.099.198l.082-1.283V4.701h-1.744v12.095zm.473-2.509a2.5 2.5 0 0 0 .566.7q.117.098.245.18l.144.08a2.1 2.1 0 0 0 .975.232q1.07 0 1.645-.675.576-.69.576-1.778 0-1.102-.576-1.777-.56-.691-1.645-.692a2.2 2.2 0 0 0-1.015.235q-.22.113-.415.282l-.15.142a2.1 2.1 0 0 0-.42.594q-.223.479-.223 1.1v.115q0 .705.293 1.26zm2.616-.293c.157-.191.28-.479.28-.967 0-.51-.13-.79-.276-.961l-.021-.026c-.082-.1-.232-.225-.67-.225a.87.87 0 0 0-.681.279l-.012.011c-.154.155-.274.38-.274.807v.115c0 .285.057.499.144.669a1.1 1.1 0 0 0 .367.405c.137.082.28.123.455.123.423 0 .59-.118.686-.23zm8.266-3.013q.345-.13.724-.14l.069-.002q.493 0 .642.099l.247-1.794q-.196-.099-.717-.099a2.3 2.3 0 0 0-.545.063 2 2 0 0 0-.411.148 2.2 2.2 0 0 0-.4.249 2.5 2.5 0 0 0-.485.499 2.7 2.7 0 0 0-.32.581l-.05.137v-1.48h-1.778v7.553h1.777v-3.884q0-.546.159-.943a1.5 1.5 0 0 1 .466-.636 2.5 2.5 0 0 1 .399-.253 2 2 0 0 1 .224-.099zm9.784 2.656.05-.922q0-1.743-.856-2.698-.838-.97-2.584-.97-1.119-.001-2.007.493a3.46 3.46 0 0 0-1.4 1.382q-.493.906-.493 2.106 0 1.07.428 1.975.428.89 1.332 1.432.906.526 2.255.526.973 0 1.668-.185l.044-.012.135-.04q.613-.184.984-.421l-.542-1.267q-.3.162-.642.274l-.297.087q-.51.131-1.3.131-.954 0-1.497-.444a1.6 1.6 0 0 1-.192-.193q-.366-.44-.512-1.234l-.004-.021zm-5.427-1.256-.003.022h3.752v-.138q-.011-.727-.288-1.118a1 1 0 0 0-.156-.176q-.46-.428-1.316-.428-.986 0-1.494.604-.379.45-.494 1.234zm-27.053 2.77V4.7h-1.86v12.095h5.333V15.15zm7.103-5.908v7.553h-1.843V9.242h1.843z'/%3E%3Cpath fill='%23fff' d='m19.63 11.151-.757-1.71-.345 1.71-1.12 5.644h-1.827L18.083 4.7h.197l3.325 6.533.988 2.19.988-2.19L26.839 4.7h.181l2.6 12.095h-1.81l-1.218-5.644-.362-1.71-.658 1.71-2.93 5.644h-.098l-2.913-5.644zm14.836 5.81q-1.02 0-1.893-.478a3.8 3.8 0 0 1-1.381-1.382q-.51-.906-.51-2.106 0-1.185.444-2.074a3.36 3.36 0 0 1 1.3-1.382q.839-.494 1.974-.494a3.3 3.3 0 0 1 1.234.231 3.3 3.3 0 0 1 .97.575q.396.33.527.659l.033-1.267h1.694v7.553H37.18l-.033-1.332q-.279.593-1.02 1.053a3.17 3.17 0 0 1-1.662.444zm.296-1.482q.938 0 1.58-.642.642-.66.642-1.711v-.115q0-.708-.296-1.267a2.2 2.2 0 0 0-.807-.872 2.1 2.1 0 0 0-1.119-.313q-1.053 0-1.629.692-.575.675-.575 1.76 0 1.103.559 1.795.577.675 1.645.675zm6.521-6.237h1.711v1.4q.906-1.597 2.83-1.597 1.596 0 2.584 1.02.988 1.005.988 2.914 0 1.185-.493 2.09a3.46 3.46 0 0 1-1.316 1.399 3.5 3.5 0 0 1-1.844.493q-.954 0-1.662-.329a2.67 2.67 0 0 1-1.086-.97l.017 5.134h-1.728zm4.048 6.22q1.07 0 1.645-.674.577-.69.576-1.762 0-1.119-.576-1.777-.558-.675-1.645-.675-.592 0-1.12.296-.51.28-.822.823-.296.527-.296 1.234v.115q0 .708.296 1.267.313.543.823.855.51.296 1.119.297z'/%3E%3Cpath fill='%23e1e3e9' d='M51.325 4.7h1.86v10.45h3.473v1.646h-5.333zm7.12 4.542h1.843v7.553h-1.843zm.905-1.415a1.16 1.16 0 0 1-.856-.346 1.17 1.17 0 0 1-.346-.856 1.05 1.05 0 0 1 .346-.79q.346-.329.856-.329.494 0 .839.33a1.05 1.05 0 0 1 .345.79 1.16 1.16 0 0 1-.345.855q-.33.346-.84.346zm7.875 9.133a3.17 3.17 0 0 1-1.662-.444q-.723-.46-1.004-1.053l-.033 1.332h-1.71V4.701h1.743v4.657l-.082 1.283q.279-.658 1.086-1.119a3.5 3.5 0 0 1 1.778-.477q1.119 0 1.942.51a3.24 3.24 0 0 1 1.283 1.4q.445.888.444 2.072 0 1.201-.526 2.09a3.5 3.5 0 0 1-1.382 1.366 3.8 3.8 0 0 1-1.876.477zm-.296-1.481q1.069 0 1.645-.675.577-.69.577-1.778 0-1.102-.577-1.776-.56-.691-1.645-.692a2.12 2.12 0 0 0-1.58.659q-.642.641-.642 1.694v.115q0 .71.296 1.267a2.4 2.4 0 0 0 .807.872 2.1 2.1 0 0 0 1.119.313zm5.927-6.237h1.777v1.481q.263-.757.856-1.217a2.14 2.14 0 0 1 1.349-.46q.527 0 .724.098l-.247 1.794q-.149-.099-.642-.099-.774 0-1.416.494-.626.493-.626 1.58v3.883h-1.777V9.242zm9.534 7.718q-1.35 0-2.255-.526-.904-.543-1.332-1.432a4.6 4.6 0 0 1-.428-1.975q0-1.2.493-2.106a3.46 3.46 0 0 1 1.4-1.382q.889-.495 2.007-.494 1.744 0 2.584.97.855.956.856 2.7 0 .444-.05.92h-5.43q.18 1.005.708 1.45.542.443 1.497.443.79 0 1.3-.131a4 4 0 0 0 .938-.362l.542 1.267q-.411.263-1.119.46-.708.198-1.711.197zm1.596-4.558q.016-1.02-.444-1.432-.46-.428-1.316-.428-1.728 0-1.991 1.86z'/%3E%3Cpath d='M5.074 15.948a.484.657 0 0 0-.486.659v1.84a.484.657 0 0 0 .486.659h4.101a.484.657 0 0 0 .486-.659v-1.84a.484.657 0 0 0-.486-.659zm3.56 1.16H5.617v.838h3.017z' style='fill:%23fff;fill-rule:evenodd;stroke-width:1.03600001'/%3E%3Cg style='stroke-width:1.12603545'%3E%3Cpath d='M-9.408-1.416c-3.833-.025-7.056 2.912-7.08 6.615-.02 3.08 1.653 4.832 3.107 6.268.903.892 1.721 1.74 2.32 2.902l-.525-.004c-.543-.003-.992.304-1.24.639a1.87 1.87 0 0 0-.362 1.121l-.011 1.877c-.003.402.104.787.347 1.125.244.338.688.653 1.23.656l4.142.028c.542.003.99-.306 1.238-.641a1.87 1.87 0 0 0 .363-1.121l.012-1.875a1.87 1.87 0 0 0-.348-1.127c-.243-.338-.688-.653-1.23-.656l-.518-.004c.597-1.145 1.425-1.983 2.348-2.87 1.473-1.414 3.18-3.149 3.2-6.226-.016-3.59-2.923-6.684-6.993-6.707m-.006 1.1v.002c3.274.02 5.92 2.532 5.9 5.6-.017 2.706-1.39 4.026-2.863 5.44-1.034.994-2.118 2.033-2.814 3.633-.018.041-.052.055-.075.065q-.013.004-.02.01a.34.34 0 0 1-.226.084.34.34 0 0 1-.224-.086l-.092-.077c-.699-1.615-1.768-2.669-2.781-3.67-1.454-1.435-2.797-2.762-2.78-5.478.02-3.067 2.7-5.545 5.975-5.523m-.02 2.826c-1.62-.01-2.944 1.315-2.955 2.96-.01 1.646 1.295 2.988 2.916 2.999h.002c1.621.01 2.943-1.316 2.953-2.961.011-1.646-1.294-2.988-2.916-2.998m-.005 1.1c1.017.006 1.829.83 1.822 1.89s-.83 1.874-1.848 1.867c-1.018-.006-1.829-.83-1.822-1.89s.83-1.874 1.848-1.868m-2.155 11.857 4.14.025c.271.002.49.305.487.676l-.013 1.875c-.003.37-.224.67-.495.668l-4.14-.025c-.27-.002-.487-.306-.485-.676l.012-1.875c.003-.37.224-.67.494-.668' style='color:%23000;font-style:normal;font-variant:normal;font-weight:400;font-stretch:normal;font-size:medium;line-height:normal;font-family:sans-serif;font-variant-ligatures:normal;font-variant-position:normal;font-variant-caps:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-feature-settings:normal;text-indent:0;text-align:start;text-decoration:none;text-decoration-line:none;text-decoration-style:solid;text-decoration-color:%23000;letter-spacing:normal;word-spacing:normal;text-transform:none;writing-mode:lr-tb;direction:ltr;text-orientation:mixed;dominant-baseline:auto;baseline-shift:baseline;text-anchor:start;white-space:normal;shape-padding:0;clip-rule:evenodd;display:inline;overflow:visible;visibility:visible;opacity:1;isolation:auto;mix-blend-mode:normal;color-interpolation:sRGB;color-interpolation-filters:linearRGB;solid-color:%23000;solid-opacity:1;vector-effect:none;fill:%23000;fill-opacity:.4;fill-rule:evenodd;stroke:none;stroke-width:2.47727823;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1;color-rendering:auto;image-rendering:auto;shape-rendering:auto;text-rendering:auto' transform='translate(15.553 2.85)scale(.88807)'/%3E%3Cpath d='M-9.415-.316C-12.69-.338-15.37 2.14-15.39 5.207c-.017 2.716 1.326 4.041 2.78 5.477 1.013 1 2.081 2.055 2.78 3.67l.092.076a.34.34 0 0 0 .225.086.34.34 0 0 0 .227-.083l.019-.01c.022-.009.057-.024.074-.064.697-1.6 1.78-2.64 2.814-3.634 1.473-1.414 2.847-2.733 2.864-5.44.02-3.067-2.627-5.58-5.901-5.601m-.057 8.784c1.621.011 2.944-1.315 2.955-2.96.01-1.646-1.295-2.988-2.916-2.999-1.622-.01-2.945 1.315-2.955 2.96s1.295 2.989 2.916 3' style='clip-rule:evenodd;fill:%23e1e3e9;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:2.47727823;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:.4' transform='translate(15.553 2.85)scale(.88807)'/%3E%3Cpath d='M-11.594 15.465c-.27-.002-.492.297-.494.668l-.012 1.876c-.003.371.214.673.485.675l4.14.027c.271.002.492-.298.495-.668l.012-1.877c.003-.37-.215-.672-.485-.674z' style='clip-rule:evenodd;fill:%23fff;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:2.47727823;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:.4' transform='translate(15.553 2.85)scale(.88807)'/%3E%3C/g%3E%3C/svg%3E");background-repeat:no-repeat;cursor:pointer;display:block;height:23px;margin:0 0 -4px -4px;overflow:hidden;width:88px}a.maplibregl-ctrl-logo.maplibregl-compact{width:14px}@media (forced-colors:active){a.maplibregl-ctrl-logo{background-color:transparent;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='88' height='23' fill='none'%3E%3Cpath fill='%23000' fill-opacity='.4' fill-rule='evenodd' d='M17.408 16.796h-1.827l2.501-12.095h.198l3.324 6.533.988 2.19.988-2.19 3.258-6.533h.181l2.6 12.095h-1.81l-1.218-5.644-.362-1.71-.658 1.71-2.929 5.644h-.098l-2.914-5.644-.757-1.71-.345 1.71zm1.958-3.42-.726 3.663a1.255 1.255 0 0 1-1.232 1.011h-1.827a1.255 1.255 0 0 1-1.229-1.509l2.501-12.095a1.255 1.255 0 0 1 1.23-1.001h.197a1.25 1.25 0 0 1 1.12.685l3.19 6.273 3.125-6.263a1.25 1.25 0 0 1 1.123-.695h.181a1.255 1.255 0 0 1 1.227.991l1.443 6.71a5 5 0 0 1 .314-.787l.009-.016a4.6 4.6 0 0 1 1.777-1.887c.782-.46 1.668-.667 2.611-.667a4.6 4.6 0 0 1 1.7.32l.306.134c.21-.16.474-.256.759-.256h1.694a1.255 1.255 0 0 1 1.212.925 1.255 1.255 0 0 1 1.212-.925h1.711c.284 0 .545.094.755.252.613-.3 1.312-.45 2.075-.45 1.356 0 2.557.445 3.482 1.4q.47.48.763 1.064V4.701a1.255 1.255 0 0 1 1.255-1.255h1.86A1.255 1.255 0 0 1 54.44 4.7v9.194h2.217c.19 0 .37.043.532.118v-4.77c0-.356.147-.678.385-.906a2.42 2.42 0 0 1-.682-1.71c0-.665.267-1.253.735-1.7a2.45 2.45 0 0 1 1.722-.674 2.43 2.43 0 0 1 1.705.675q.318.302.504.683V4.7a1.255 1.255 0 0 1 1.255-1.255h1.744A1.255 1.255 0 0 1 65.812 4.7v3.335a4.8 4.8 0 0 1 1.526-.246c.938 0 1.817.214 2.59.69a4.47 4.47 0 0 1 1.67 1.743v-.98a1.255 1.255 0 0 1 1.256-1.256h1.777c.233 0 .451.064.639.174a3.4 3.4 0 0 1 1.567-.372c.346 0 .861.02 1.285.232a1.25 1.25 0 0 1 .689 1.004 4.7 4.7 0 0 1 .853-.588c.795-.44 1.675-.647 2.61-.647 1.385 0 2.65.39 3.525 1.396.836.938 1.168 2.173 1.168 3.528q-.001.515-.056 1.051a1.255 1.255 0 0 1-.947 1.09l.408.952a1.255 1.255 0 0 1-.477 1.552c-.418.268-.92.463-1.458.612-.613.171-1.304.244-2.049.244-1.06 0-2.043-.207-2.886-.698l-.015-.008c-.798-.48-1.419-1.135-1.818-1.963l-.004-.008a5.8 5.8 0 0 1-.548-2.512q0-.429.053-.843a1.3 1.3 0 0 1-.333-.086l-.166-.004c-.223 0-.426.062-.643.228-.03.024-.142.139-.142.59v3.883a1.255 1.255 0 0 1-1.256 1.256h-1.777a1.255 1.255 0 0 1-1.256-1.256V15.69l-.032.057a4.8 4.8 0 0 1-1.86 1.833 5.04 5.04 0 0 1-2.484.634 4.5 4.5 0 0 1-1.935-.424 1.25 1.25 0 0 1-.764.258h-1.71a1.255 1.255 0 0 1-1.256-1.255V7.687a2.4 2.4 0 0 1-.428.625c.253.23.412.561.412.93v7.553a1.255 1.255 0 0 1-1.256 1.255h-1.843a1.25 1.25 0 0 1-.894-.373c-.228.23-.544.373-.894.373H51.32a1.255 1.255 0 0 1-1.256-1.255v-1.251l-.061.117a4.7 4.7 0 0 1-1.782 1.884 4.77 4.77 0 0 1-2.485.67 5.6 5.6 0 0 1-1.485-.188l.009 2.764a1.255 1.255 0 0 1-1.255 1.259h-1.729a1.255 1.255 0 0 1-1.255-1.255v-3.537a1.255 1.255 0 0 1-1.167.793h-1.679a1.25 1.25 0 0 1-.77-.263 4.5 4.5 0 0 1-1.945.429c-.885 0-1.724-.21-2.495-.632l-.017-.01a5 5 0 0 1-1.081-.836 1.255 1.255 0 0 1-1.254 1.312h-1.81a1.255 1.255 0 0 1-1.228-.99l-.782-3.625-2.044 3.939a1.25 1.25 0 0 1-1.115.676h-.098a1.25 1.25 0 0 1-1.116-.68l-2.061-3.994zM35.92 16.63l.207-.114.223-.15q.493-.356.735-.785l.061-.118.033 1.332h1.678V9.242h-1.694l-.033 1.267q-.133-.329-.526-.658l-.032-.028a3.2 3.2 0 0 0-.668-.428l-.27-.12a3.3 3.3 0 0 0-1.235-.23q-1.136-.001-1.974.493a3.36 3.36 0 0 0-1.3 1.382q-.445.89-.444 2.074 0 1.2.51 2.107a3.8 3.8 0 0 0 1.382 1.381 3.9 3.9 0 0 0 1.893.477q.795 0 1.455-.33zm-2.789-5.38q-.576.675-.575 1.762 0 1.102.559 1.794.576.675 1.645.675a2.25 2.25 0 0 0 .934-.19 2.2 2.2 0 0 0 .468-.29l.178-.161a2.2 2.2 0 0 0 .397-.561q.244-.5.244-1.15v-.115q0-.708-.296-1.267l-.043-.077a2.2 2.2 0 0 0-.633-.709l-.13-.086-.047-.028a2.1 2.1 0 0 0-1.073-.285q-1.052 0-1.629.692zm2.316 2.706c.163-.17.28-.407.28-.83v-.114c0-.292-.06-.508-.15-.68a.96.96 0 0 0-.353-.389.85.85 0 0 0-.464-.127c-.4 0-.56.114-.664.239l-.01.012c-.148.174-.275.45-.275.945 0 .506.122.801.27.99.097.11.266.224.68.224.303 0 .504-.09.687-.269zm7.545 1.705a2.6 2.6 0 0 0 .331.423q.319.33.755.548l.173.074q.65.255 1.49.255 1.02 0 1.844-.493a3.45 3.45 0 0 0 1.316-1.4q.493-.904.493-2.089 0-1.909-.988-2.913-.988-1.02-2.584-1.02-.898 0-1.575.347a3 3 0 0 0-.415.262l-.199.166a3.4 3.4 0 0 0-.64.82V9.242h-1.712v11.553h1.729l-.017-5.134zm.53-1.138q.206.29.48.5l.155.11.053.034q.51.296 1.119.297 1.07 0 1.645-.675.577-.69.576-1.762 0-1.119-.576-1.777-.558-.675-1.645-.675-.435 0-.835.16a2 2 0 0 0-.284.136 2 2 0 0 0-.363.254 2.2 2.2 0 0 0-.46.569l-.082.162a2.6 2.6 0 0 0-.213 1.072v.115q0 .707.296 1.267l.135.211zm.964-.818a1.1 1.1 0 0 0 .367.385.94.94 0 0 0 .476.118c.423 0 .59-.117.687-.23.159-.194.28-.478.28-.95 0-.53-.133-.8-.266-.952l-.021-.025c-.078-.094-.231-.221-.68-.221a1 1 0 0 0-.503.135l-.012.007a.86.86 0 0 0-.335.343c-.073.133-.132.324-.132.614v.115a1.4 1.4 0 0 0 .14.66zm15.7-6.222q.347-.346.346-.856a1.05 1.05 0 0 0-.345-.79 1.18 1.18 0 0 0-.84-.329q-.51 0-.855.33a1.05 1.05 0 0 0-.346.79q0 .51.346.855.345.346.856.346.51 0 .839-.346zm4.337 9.314.033-1.332q.191.403.59.747l.098.081a4 4 0 0 0 .316.224l.223.122a3.2 3.2 0 0 0 1.44.322 3.8 3.8 0 0 0 1.875-.477 3.5 3.5 0 0 0 1.382-1.366q.527-.89.526-2.09 0-1.184-.444-2.073a3.24 3.24 0 0 0-1.283-1.399q-.823-.51-1.942-.51a3.5 3.5 0 0 0-1.527.344l-.086.043-.165.09a3 3 0 0 0-.33.214q-.432.315-.656.707a2 2 0 0 0-.099.198l.082-1.283V4.701h-1.744v12.095zm.473-2.509a2.5 2.5 0 0 0 .566.7q.117.098.245.18l.144.08a2.1 2.1 0 0 0 .975.232q1.07 0 1.645-.675.576-.69.576-1.778 0-1.102-.576-1.777-.56-.691-1.645-.692a2.2 2.2 0 0 0-1.015.235q-.22.113-.415.282l-.15.142a2.1 2.1 0 0 0-.42.594q-.223.479-.223 1.1v.115q0 .705.293 1.26zm2.616-.293c.157-.191.28-.479.28-.967 0-.51-.13-.79-.276-.961l-.021-.026c-.082-.1-.232-.225-.67-.225a.87.87 0 0 0-.681.279l-.012.011c-.154.155-.274.38-.274.807v.115c0 .285.057.499.144.669a1.1 1.1 0 0 0 .367.405c.137.082.28.123.455.123.423 0 .59-.118.686-.23zm8.266-3.013q.345-.13.724-.14l.069-.002q.493 0 .642.099l.247-1.794q-.196-.099-.717-.099a2.3 2.3 0 0 0-.545.063 2 2 0 0 0-.411.148 2.2 2.2 0 0 0-.4.249 2.5 2.5 0 0 0-.485.499 2.7 2.7 0 0 0-.32.581l-.05.137v-1.48h-1.778v7.553h1.777v-3.884q0-.546.159-.943a1.5 1.5 0 0 1 .466-.636 2.5 2.5 0 0 1 .399-.253 2 2 0 0 1 .224-.099zm9.784 2.656.05-.922q0-1.743-.856-2.698-.838-.97-2.584-.97-1.119-.001-2.007.493a3.46 3.46 0 0 0-1.4 1.382q-.493.906-.493 2.106 0 1.07.428 1.975.428.89 1.332 1.432.906.526 2.255.526.973 0 1.668-.185l.044-.012.135-.04q.613-.184.984-.421l-.542-1.267q-.3.162-.642.274l-.297.087q-.51.131-1.3.131-.954 0-1.497-.444a1.6 1.6 0 0 1-.192-.193q-.366-.44-.512-1.234l-.004-.021zm-5.427-1.256-.003.022h3.752v-.138q-.011-.727-.288-1.118a1 1 0 0 0-.156-.176q-.46-.428-1.316-.428-.986 0-1.494.604-.379.45-.494 1.234zm-27.053 2.77V4.7h-1.86v12.095h5.333V15.15zm7.103-5.908v7.553h-1.843V9.242h1.843z'/%3E%3Cpath fill='%23fff' d='m19.63 11.151-.757-1.71-.345 1.71-1.12 5.644h-1.827L18.083 4.7h.197l3.325 6.533.988 2.19.988-2.19L26.839 4.7h.181l2.6 12.095h-1.81l-1.218-5.644-.362-1.71-.658 1.71-2.93 5.644h-.098l-2.913-5.644zm14.836 5.81q-1.02 0-1.893-.478a3.8 3.8 0 0 1-1.381-1.382q-.51-.906-.51-2.106 0-1.185.444-2.074a3.36 3.36 0 0 1 1.3-1.382q.839-.494 1.974-.494a3.3 3.3 0 0 1 1.234.231 3.3 3.3 0 0 1 .97.575q.396.33.527.659l.033-1.267h1.694v7.553H37.18l-.033-1.332q-.279.593-1.02 1.053a3.17 3.17 0 0 1-1.662.444zm.296-1.482q.938 0 1.58-.642.642-.66.642-1.711v-.115q0-.708-.296-1.267a2.2 2.2 0 0 0-.807-.872 2.1 2.1 0 0 0-1.119-.313q-1.053 0-1.629.692-.575.675-.575 1.76 0 1.103.559 1.795.577.675 1.645.675zm6.521-6.237h1.711v1.4q.906-1.597 2.83-1.597 1.596 0 2.584 1.02.988 1.005.988 2.914 0 1.185-.493 2.09a3.46 3.46 0 0 1-1.316 1.399 3.5 3.5 0 0 1-1.844.493q-.954 0-1.662-.329a2.67 2.67 0 0 1-1.086-.97l.017 5.134h-1.728zm4.048 6.22q1.07 0 1.645-.674.577-.69.576-1.762 0-1.119-.576-1.777-.558-.675-1.645-.675-.592 0-1.12.296-.51.28-.822.823-.296.527-.296 1.234v.115q0 .708.296 1.267.313.543.823.855.51.296 1.119.297z'/%3E%3Cpath fill='%23e1e3e9' d='M51.325 4.7h1.86v10.45h3.473v1.646h-5.333zm7.12 4.542h1.843v7.553h-1.843zm.905-1.415a1.16 1.16 0 0 1-.856-.346 1.17 1.17 0 0 1-.346-.856 1.05 1.05 0 0 1 .346-.79q.346-.329.856-.329.494 0 .839.33a1.05 1.05 0 0 1 .345.79 1.16 1.16 0 0 1-.345.855q-.33.346-.84.346zm7.875 9.133a3.17 3.17 0 0 1-1.662-.444q-.723-.46-1.004-1.053l-.033 1.332h-1.71V4.701h1.743v4.657l-.082 1.283q.279-.658 1.086-1.119a3.5 3.5 0 0 1 1.778-.477q1.119 0 1.942.51a3.24 3.24 0 0 1 1.283 1.4q.445.888.444 2.072 0 1.201-.526 2.09a3.5 3.5 0 0 1-1.382 1.366 3.8 3.8 0 0 1-1.876.477zm-.296-1.481q1.069 0 1.645-.675.577-.69.577-1.778 0-1.102-.577-1.776-.56-.691-1.645-.692a2.12 2.12 0 0 0-1.58.659q-.642.641-.642 1.694v.115q0 .71.296 1.267a2.4 2.4 0 0 0 .807.872 2.1 2.1 0 0 0 1.119.313zm5.927-6.237h1.777v1.481q.263-.757.856-1.217a2.14 2.14 0 0 1 1.349-.46q.527 0 .724.098l-.247 1.794q-.149-.099-.642-.099-.774 0-1.416.494-.626.493-.626 1.58v3.883h-1.777V9.242zm9.534 7.718q-1.35 0-2.255-.526-.904-.543-1.332-1.432a4.6 4.6 0 0 1-.428-1.975q0-1.2.493-2.106a3.46 3.46 0 0 1 1.4-1.382q.889-.495 2.007-.494 1.744 0 2.584.97.855.956.856 2.7 0 .444-.05.92h-5.43q.18 1.005.708 1.45.542.443 1.497.443.79 0 1.3-.131a4 4 0 0 0 .938-.362l.542 1.267q-.411.263-1.119.46-.708.198-1.711.197zm1.596-4.558q.016-1.02-.444-1.432-.46-.428-1.316-.428-1.728 0-1.991 1.86z'/%3E%3Cpath d='M5.074 15.948a.484.657 0 0 0-.486.659v1.84a.484.657 0 0 0 .486.659h4.101a.484.657 0 0 0 .486-.659v-1.84a.484.657 0 0 0-.486-.659zm3.56 1.16H5.617v.838h3.017z' style='fill:%23fff;fill-rule:evenodd;stroke-width:1.03600001'/%3E%3Cg style='stroke-width:1.12603545'%3E%3Cpath d='M-9.408-1.416c-3.833-.025-7.056 2.912-7.08 6.615-.02 3.08 1.653 4.832 3.107 6.268.903.892 1.721 1.74 2.32 2.902l-.525-.004c-.543-.003-.992.304-1.24.639a1.87 1.87 0 0 0-.362 1.121l-.011 1.877c-.003.402.104.787.347 1.125.244.338.688.653 1.23.656l4.142.028c.542.003.99-.306 1.238-.641a1.87 1.87 0 0 0 .363-1.121l.012-1.875a1.87 1.87 0 0 0-.348-1.127c-.243-.338-.688-.653-1.23-.656l-.518-.004c.597-1.145 1.425-1.983 2.348-2.87 1.473-1.414 3.18-3.149 3.2-6.226-.016-3.59-2.923-6.684-6.993-6.707m-.006 1.1v.002c3.274.02 5.92 2.532 5.9 5.6-.017 2.706-1.39 4.026-2.863 5.44-1.034.994-2.118 2.033-2.814 3.633-.018.041-.052.055-.075.065q-.013.004-.02.01a.34.34 0 0 1-.226.084.34.34 0 0 1-.224-.086l-.092-.077c-.699-1.615-1.768-2.669-2.781-3.67-1.454-1.435-2.797-2.762-2.78-5.478.02-3.067 2.7-5.545 5.975-5.523m-.02 2.826c-1.62-.01-2.944 1.315-2.955 2.96-.01 1.646 1.295 2.988 2.916 2.999h.002c1.621.01 2.943-1.316 2.953-2.961.011-1.646-1.294-2.988-2.916-2.998m-.005 1.1c1.017.006 1.829.83 1.822 1.89s-.83 1.874-1.848 1.867c-1.018-.006-1.829-.83-1.822-1.89s.83-1.874 1.848-1.868m-2.155 11.857 4.14.025c.271.002.49.305.487.676l-.013 1.875c-.003.37-.224.67-.495.668l-4.14-.025c-.27-.002-.487-.306-.485-.676l.012-1.875c.003-.37.224-.67.494-.668' style='color:%23000;font-style:normal;font-variant:normal;font-weight:400;font-stretch:normal;font-size:medium;line-height:normal;font-family:sans-serif;font-variant-ligatures:normal;font-variant-position:normal;font-variant-caps:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-feature-settings:normal;text-indent:0;text-align:start;text-decoration:none;text-decoration-line:none;text-decoration-style:solid;text-decoration-color:%23000;letter-spacing:normal;word-spacing:normal;text-transform:none;writing-mode:lr-tb;direction:ltr;text-orientation:mixed;dominant-baseline:auto;baseline-shift:baseline;text-anchor:start;white-space:normal;shape-padding:0;clip-rule:evenodd;display:inline;overflow:visible;visibility:visible;opacity:1;isolation:auto;mix-blend-mode:normal;color-interpolation:sRGB;color-interpolation-filters:linearRGB;solid-color:%23000;solid-opacity:1;vector-effect:none;fill:%23000;fill-opacity:.4;fill-rule:evenodd;stroke:none;stroke-width:2.47727823;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1;color-rendering:auto;image-rendering:auto;shape-rendering:auto;text-rendering:auto' transform='translate(15.553 2.85)scale(.88807)'/%3E%3Cpath d='M-9.415-.316C-12.69-.338-15.37 2.14-15.39 5.207c-.017 2.716 1.326 4.041 2.78 5.477 1.013 1 2.081 2.055 2.78 3.67l.092.076a.34.34 0 0 0 .225.086.34.34 0 0 0 .227-.083l.019-.01c.022-.009.057-.024.074-.064.697-1.6 1.78-2.64 2.814-3.634 1.473-1.414 2.847-2.733 2.864-5.44.02-3.067-2.627-5.58-5.901-5.601m-.057 8.784c1.621.011 2.944-1.315 2.955-2.96.01-1.646-1.295-2.988-2.916-2.999-1.622-.01-2.945 1.315-2.955 2.96s1.295 2.989 2.916 3' style='clip-rule:evenodd;fill:%23e1e3e9;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:2.47727823;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:.4' transform='translate(15.553 2.85)scale(.88807)'/%3E%3Cpath d='M-11.594 15.465c-.27-.002-.492.297-.494.668l-.012 1.876c-.003.371.214.673.485.675l4.14.027c.271.002.492-.298.495-.668l.012-1.877c.003-.37-.215-.672-.485-.674z' style='clip-rule:evenodd;fill:%23fff;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:2.47727823;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:.4' transform='translate(15.553 2.85)scale(.88807)'/%3E%3C/g%3E%3C/svg%3E")}}@media (forced-colors:active) and (prefers-color-scheme:light){a.maplibregl-ctrl-logo{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='88' height='23' fill='none'%3E%3Cpath fill='%23000' fill-opacity='.4' fill-rule='evenodd' d='M17.408 16.796h-1.827l2.501-12.095h.198l3.324 6.533.988 2.19.988-2.19 3.258-6.533h.181l2.6 12.095h-1.81l-1.218-5.644-.362-1.71-.658 1.71-2.929 5.644h-.098l-2.914-5.644-.757-1.71-.345 1.71zm1.958-3.42-.726 3.663a1.255 1.255 0 0 1-1.232 1.011h-1.827a1.255 1.255 0 0 1-1.229-1.509l2.501-12.095a1.255 1.255 0 0 1 1.23-1.001h.197a1.25 1.25 0 0 1 1.12.685l3.19 6.273 3.125-6.263a1.25 1.25 0 0 1 1.123-.695h.181a1.255 1.255 0 0 1 1.227.991l1.443 6.71a5 5 0 0 1 .314-.787l.009-.016a4.6 4.6 0 0 1 1.777-1.887c.782-.46 1.668-.667 2.611-.667a4.6 4.6 0 0 1 1.7.32l.306.134c.21-.16.474-.256.759-.256h1.694a1.255 1.255 0 0 1 1.212.925 1.255 1.255 0 0 1 1.212-.925h1.711c.284 0 .545.094.755.252.613-.3 1.312-.45 2.075-.45 1.356 0 2.557.445 3.482 1.4q.47.48.763 1.064V4.701a1.255 1.255 0 0 1 1.255-1.255h1.86A1.255 1.255 0 0 1 54.44 4.7v9.194h2.217c.19 0 .37.043.532.118v-4.77c0-.356.147-.678.385-.906a2.42 2.42 0 0 1-.682-1.71c0-.665.267-1.253.735-1.7a2.45 2.45 0 0 1 1.722-.674 2.43 2.43 0 0 1 1.705.675q.318.302.504.683V4.7a1.255 1.255 0 0 1 1.255-1.255h1.744A1.255 1.255 0 0 1 65.812 4.7v3.335a4.8 4.8 0 0 1 1.526-.246c.938 0 1.817.214 2.59.69a4.47 4.47 0 0 1 1.67 1.743v-.98a1.255 1.255 0 0 1 1.256-1.256h1.777c.233 0 .451.064.639.174a3.4 3.4 0 0 1 1.567-.372c.346 0 .861.02 1.285.232a1.25 1.25 0 0 1 .689 1.004 4.7 4.7 0 0 1 .853-.588c.795-.44 1.675-.647 2.61-.647 1.385 0 2.65.39 3.525 1.396.836.938 1.168 2.173 1.168 3.528q-.001.515-.056 1.051a1.255 1.255 0 0 1-.947 1.09l.408.952a1.255 1.255 0 0 1-.477 1.552c-.418.268-.92.463-1.458.612-.613.171-1.304.244-2.049.244-1.06 0-2.043-.207-2.886-.698l-.015-.008c-.798-.48-1.419-1.135-1.818-1.963l-.004-.008a5.8 5.8 0 0 1-.548-2.512q0-.429.053-.843a1.3 1.3 0 0 1-.333-.086l-.166-.004c-.223 0-.426.062-.643.228-.03.024-.142.139-.142.59v3.883a1.255 1.255 0 0 1-1.256 1.256h-1.777a1.255 1.255 0 0 1-1.256-1.256V15.69l-.032.057a4.8 4.8 0 0 1-1.86 1.833 5.04 5.04 0 0 1-2.484.634 4.5 4.5 0 0 1-1.935-.424 1.25 1.25 0 0 1-.764.258h-1.71a1.255 1.255 0 0 1-1.256-1.255V7.687a2.4 2.4 0 0 1-.428.625c.253.23.412.561.412.93v7.553a1.255 1.255 0 0 1-1.256 1.255h-1.843a1.25 1.25 0 0 1-.894-.373c-.228.23-.544.373-.894.373H51.32a1.255 1.255 0 0 1-1.256-1.255v-1.251l-.061.117a4.7 4.7 0 0 1-1.782 1.884 4.77 4.77 0 0 1-2.485.67 5.6 5.6 0 0 1-1.485-.188l.009 2.764a1.255 1.255 0 0 1-1.255 1.259h-1.729a1.255 1.255 0 0 1-1.255-1.255v-3.537a1.255 1.255 0 0 1-1.167.793h-1.679a1.25 1.25 0 0 1-.77-.263 4.5 4.5 0 0 1-1.945.429c-.885 0-1.724-.21-2.495-.632l-.017-.01a5 5 0 0 1-1.081-.836 1.255 1.255 0 0 1-1.254 1.312h-1.81a1.255 1.255 0 0 1-1.228-.99l-.782-3.625-2.044 3.939a1.25 1.25 0 0 1-1.115.676h-.098a1.25 1.25 0 0 1-1.116-.68l-2.061-3.994zM35.92 16.63l.207-.114.223-.15q.493-.356.735-.785l.061-.118.033 1.332h1.678V9.242h-1.694l-.033 1.267q-.133-.329-.526-.658l-.032-.028a3.2 3.2 0 0 0-.668-.428l-.27-.12a3.3 3.3 0 0 0-1.235-.23q-1.136-.001-1.974.493a3.36 3.36 0 0 0-1.3 1.382q-.445.89-.444 2.074 0 1.2.51 2.107a3.8 3.8 0 0 0 1.382 1.381 3.9 3.9 0 0 0 1.893.477q.795 0 1.455-.33zm-2.789-5.38q-.576.675-.575 1.762 0 1.102.559 1.794.576.675 1.645.675a2.25 2.25 0 0 0 .934-.19 2.2 2.2 0 0 0 .468-.29l.178-.161a2.2 2.2 0 0 0 .397-.561q.244-.5.244-1.15v-.115q0-.708-.296-1.267l-.043-.077a2.2 2.2 0 0 0-.633-.709l-.13-.086-.047-.028a2.1 2.1 0 0 0-1.073-.285q-1.052 0-1.629.692zm2.316 2.706c.163-.17.28-.407.28-.83v-.114c0-.292-.06-.508-.15-.68a.96.96 0 0 0-.353-.389.85.85 0 0 0-.464-.127c-.4 0-.56.114-.664.239l-.01.012c-.148.174-.275.45-.275.945 0 .506.122.801.27.99.097.11.266.224.68.224.303 0 .504-.09.687-.269zm7.545 1.705a2.6 2.6 0 0 0 .331.423q.319.33.755.548l.173.074q.65.255 1.49.255 1.02 0 1.844-.493a3.45 3.45 0 0 0 1.316-1.4q.493-.904.493-2.089 0-1.909-.988-2.913-.988-1.02-2.584-1.02-.898 0-1.575.347a3 3 0 0 0-.415.262l-.199.166a3.4 3.4 0 0 0-.64.82V9.242h-1.712v11.553h1.729l-.017-5.134zm.53-1.138q.206.29.48.5l.155.11.053.034q.51.296 1.119.297 1.07 0 1.645-.675.577-.69.576-1.762 0-1.119-.576-1.777-.558-.675-1.645-.675-.435 0-.835.16a2 2 0 0 0-.284.136 2 2 0 0 0-.363.254 2.2 2.2 0 0 0-.46.569l-.082.162a2.6 2.6 0 0 0-.213 1.072v.115q0 .707.296 1.267l.135.211zm.964-.818a1.1 1.1 0 0 0 .367.385.94.94 0 0 0 .476.118c.423 0 .59-.117.687-.23.159-.194.28-.478.28-.95 0-.53-.133-.8-.266-.952l-.021-.025c-.078-.094-.231-.221-.68-.221a1 1 0 0 0-.503.135l-.012.007a.86.86 0 0 0-.335.343c-.073.133-.132.324-.132.614v.115a1.4 1.4 0 0 0 .14.66zm15.7-6.222q.347-.346.346-.856a1.05 1.05 0 0 0-.345-.79 1.18 1.18 0 0 0-.84-.329q-.51 0-.855.33a1.05 1.05 0 0 0-.346.79q0 .51.346.855.345.346.856.346.51 0 .839-.346zm4.337 9.314.033-1.332q.191.403.59.747l.098.081a4 4 0 0 0 .316.224l.223.122a3.2 3.2 0 0 0 1.44.322 3.8 3.8 0 0 0 1.875-.477 3.5 3.5 0 0 0 1.382-1.366q.527-.89.526-2.09 0-1.184-.444-2.073a3.24 3.24 0 0 0-1.283-1.399q-.823-.51-1.942-.51a3.5 3.5 0 0 0-1.527.344l-.086.043-.165.09a3 3 0 0 0-.33.214q-.432.315-.656.707a2 2 0 0 0-.099.198l.082-1.283V4.701h-1.744v12.095zm.473-2.509a2.5 2.5 0 0 0 .566.7q.117.098.245.18l.144.08a2.1 2.1 0 0 0 .975.232q1.07 0 1.645-.675.576-.69.576-1.778 0-1.102-.576-1.777-.56-.691-1.645-.692a2.2 2.2 0 0 0-1.015.235q-.22.113-.415.282l-.15.142a2.1 2.1 0 0 0-.42.594q-.223.479-.223 1.1v.115q0 .705.293 1.26zm2.616-.293c.157-.191.28-.479.28-.967 0-.51-.13-.79-.276-.961l-.021-.026c-.082-.1-.232-.225-.67-.225a.87.87 0 0 0-.681.279l-.012.011c-.154.155-.274.38-.274.807v.115c0 .285.057.499.144.669a1.1 1.1 0 0 0 .367.405c.137.082.28.123.455.123.423 0 .59-.118.686-.23zm8.266-3.013q.345-.13.724-.14l.069-.002q.493 0 .642.099l.247-1.794q-.196-.099-.717-.099a2.3 2.3 0 0 0-.545.063 2 2 0 0 0-.411.148 2.2 2.2 0 0 0-.4.249 2.5 2.5 0 0 0-.485.499 2.7 2.7 0 0 0-.32.581l-.05.137v-1.48h-1.778v7.553h1.777v-3.884q0-.546.159-.943a1.5 1.5 0 0 1 .466-.636 2.5 2.5 0 0 1 .399-.253 2 2 0 0 1 .224-.099zm9.784 2.656.05-.922q0-1.743-.856-2.698-.838-.97-2.584-.97-1.119-.001-2.007.493a3.46 3.46 0 0 0-1.4 1.382q-.493.906-.493 2.106 0 1.07.428 1.975.428.89 1.332 1.432.906.526 2.255.526.973 0 1.668-.185l.044-.012.135-.04q.613-.184.984-.421l-.542-1.267q-.3.162-.642.274l-.297.087q-.51.131-1.3.131-.954 0-1.497-.444a1.6 1.6 0 0 1-.192-.193q-.366-.44-.512-1.234l-.004-.021zm-5.427-1.256-.003.022h3.752v-.138q-.011-.727-.288-1.118a1 1 0 0 0-.156-.176q-.46-.428-1.316-.428-.986 0-1.494.604-.379.45-.494 1.234zm-27.053 2.77V4.7h-1.86v12.095h5.333V15.15zm7.103-5.908v7.553h-1.843V9.242h1.843z'/%3E%3Cpath fill='%23fff' d='m19.63 11.151-.757-1.71-.345 1.71-1.12 5.644h-1.827L18.083 4.7h.197l3.325 6.533.988 2.19.988-2.19L26.839 4.7h.181l2.6 12.095h-1.81l-1.218-5.644-.362-1.71-.658 1.71-2.93 5.644h-.098l-2.913-5.644zm14.836 5.81q-1.02 0-1.893-.478a3.8 3.8 0 0 1-1.381-1.382q-.51-.906-.51-2.106 0-1.185.444-2.074a3.36 3.36 0 0 1 1.3-1.382q.839-.494 1.974-.494a3.3 3.3 0 0 1 1.234.231 3.3 3.3 0 0 1 .97.575q.396.33.527.659l.033-1.267h1.694v7.553H37.18l-.033-1.332q-.279.593-1.02 1.053a3.17 3.17 0 0 1-1.662.444zm.296-1.482q.938 0 1.58-.642.642-.66.642-1.711v-.115q0-.708-.296-1.267a2.2 2.2 0 0 0-.807-.872 2.1 2.1 0 0 0-1.119-.313q-1.053 0-1.629.692-.575.675-.575 1.76 0 1.103.559 1.795.577.675 1.645.675zm6.521-6.237h1.711v1.4q.906-1.597 2.83-1.597 1.596 0 2.584 1.02.988 1.005.988 2.914 0 1.185-.493 2.09a3.46 3.46 0 0 1-1.316 1.399 3.5 3.5 0 0 1-1.844.493q-.954 0-1.662-.329a2.67 2.67 0 0 1-1.086-.97l.017 5.134h-1.728zm4.048 6.22q1.07 0 1.645-.674.577-.69.576-1.762 0-1.119-.576-1.777-.558-.675-1.645-.675-.592 0-1.12.296-.51.28-.822.823-.296.527-.296 1.234v.115q0 .708.296 1.267.313.543.823.855.51.296 1.119.297z'/%3E%3Cpath fill='%23e1e3e9' d='M51.325 4.7h1.86v10.45h3.473v1.646h-5.333zm7.12 4.542h1.843v7.553h-1.843zm.905-1.415a1.16 1.16 0 0 1-.856-.346 1.17 1.17 0 0 1-.346-.856 1.05 1.05 0 0 1 .346-.79q.346-.329.856-.329.494 0 .839.33a1.05 1.05 0 0 1 .345.79 1.16 1.16 0 0 1-.345.855q-.33.346-.84.346zm7.875 9.133a3.17 3.17 0 0 1-1.662-.444q-.723-.46-1.004-1.053l-.033 1.332h-1.71V4.701h1.743v4.657l-.082 1.283q.279-.658 1.086-1.119a3.5 3.5 0 0 1 1.778-.477q1.119 0 1.942.51a3.24 3.24 0 0 1 1.283 1.4q.445.888.444 2.072 0 1.201-.526 2.09a3.5 3.5 0 0 1-1.382 1.366 3.8 3.8 0 0 1-1.876.477zm-.296-1.481q1.069 0 1.645-.675.577-.69.577-1.778 0-1.102-.577-1.776-.56-.691-1.645-.692a2.12 2.12 0 0 0-1.58.659q-.642.641-.642 1.694v.115q0 .71.296 1.267a2.4 2.4 0 0 0 .807.872 2.1 2.1 0 0 0 1.119.313zm5.927-6.237h1.777v1.481q.263-.757.856-1.217a2.14 2.14 0 0 1 1.349-.46q.527 0 .724.098l-.247 1.794q-.149-.099-.642-.099-.774 0-1.416.494-.626.493-.626 1.58v3.883h-1.777V9.242zm9.534 7.718q-1.35 0-2.255-.526-.904-.543-1.332-1.432a4.6 4.6 0 0 1-.428-1.975q0-1.2.493-2.106a3.46 3.46 0 0 1 1.4-1.382q.889-.495 2.007-.494 1.744 0 2.584.97.855.956.856 2.7 0 .444-.05.92h-5.43q.18 1.005.708 1.45.542.443 1.497.443.79 0 1.3-.131a4 4 0 0 0 .938-.362l.542 1.267q-.411.263-1.119.46-.708.198-1.711.197zm1.596-4.558q.016-1.02-.444-1.432-.46-.428-1.316-.428-1.728 0-1.991 1.86z'/%3E%3Cpath d='M5.074 15.948a.484.657 0 0 0-.486.659v1.84a.484.657 0 0 0 .486.659h4.101a.484.657 0 0 0 .486-.659v-1.84a.484.657 0 0 0-.486-.659zm3.56 1.16H5.617v.838h3.017z' style='fill:%23fff;fill-rule:evenodd;stroke-width:1.03600001'/%3E%3Cg style='stroke-width:1.12603545'%3E%3Cpath d='M-9.408-1.416c-3.833-.025-7.056 2.912-7.08 6.615-.02 3.08 1.653 4.832 3.107 6.268.903.892 1.721 1.74 2.32 2.902l-.525-.004c-.543-.003-.992.304-1.24.639a1.87 1.87 0 0 0-.362 1.121l-.011 1.877c-.003.402.104.787.347 1.125.244.338.688.653 1.23.656l4.142.028c.542.003.99-.306 1.238-.641a1.87 1.87 0 0 0 .363-1.121l.012-1.875a1.87 1.87 0 0 0-.348-1.127c-.243-.338-.688-.653-1.23-.656l-.518-.004c.597-1.145 1.425-1.983 2.348-2.87 1.473-1.414 3.18-3.149 3.2-6.226-.016-3.59-2.923-6.684-6.993-6.707m-.006 1.1v.002c3.274.02 5.92 2.532 5.9 5.6-.017 2.706-1.39 4.026-2.863 5.44-1.034.994-2.118 2.033-2.814 3.633-.018.041-.052.055-.075.065q-.013.004-.02.01a.34.34 0 0 1-.226.084.34.34 0 0 1-.224-.086l-.092-.077c-.699-1.615-1.768-2.669-2.781-3.67-1.454-1.435-2.797-2.762-2.78-5.478.02-3.067 2.7-5.545 5.975-5.523m-.02 2.826c-1.62-.01-2.944 1.315-2.955 2.96-.01 1.646 1.295 2.988 2.916 2.999h.002c1.621.01 2.943-1.316 2.953-2.961.011-1.646-1.294-2.988-2.916-2.998m-.005 1.1c1.017.006 1.829.83 1.822 1.89s-.83 1.874-1.848 1.867c-1.018-.006-1.829-.83-1.822-1.89s.83-1.874 1.848-1.868m-2.155 11.857 4.14.025c.271.002.49.305.487.676l-.013 1.875c-.003.37-.224.67-.495.668l-4.14-.025c-.27-.002-.487-.306-.485-.676l.012-1.875c.003-.37.224-.67.494-.668' style='color:%23000;font-style:normal;font-variant:normal;font-weight:400;font-stretch:normal;font-size:medium;line-height:normal;font-family:sans-serif;font-variant-ligatures:normal;font-variant-position:normal;font-variant-caps:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-feature-settings:normal;text-indent:0;text-align:start;text-decoration:none;text-decoration-line:none;text-decoration-style:solid;text-decoration-color:%23000;letter-spacing:normal;word-spacing:normal;text-transform:none;writing-mode:lr-tb;direction:ltr;text-orientation:mixed;dominant-baseline:auto;baseline-shift:baseline;text-anchor:start;white-space:normal;shape-padding:0;clip-rule:evenodd;display:inline;overflow:visible;visibility:visible;opacity:1;isolation:auto;mix-blend-mode:normal;color-interpolation:sRGB;color-interpolation-filters:linearRGB;solid-color:%23000;solid-opacity:1;vector-effect:none;fill:%23000;fill-opacity:.4;fill-rule:evenodd;stroke:none;stroke-width:2.47727823;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1;color-rendering:auto;image-rendering:auto;shape-rendering:auto;text-rendering:auto' transform='translate(15.553 2.85)scale(.88807)'/%3E%3Cpath d='M-9.415-.316C-12.69-.338-15.37 2.14-15.39 5.207c-.017 2.716 1.326 4.041 2.78 5.477 1.013 1 2.081 2.055 2.78 3.67l.092.076a.34.34 0 0 0 .225.086.34.34 0 0 0 .227-.083l.019-.01c.022-.009.057-.024.074-.064.697-1.6 1.78-2.64 2.814-3.634 1.473-1.414 2.847-2.733 2.864-5.44.02-3.067-2.627-5.58-5.901-5.601m-.057 8.784c1.621.011 2.944-1.315 2.955-2.96.01-1.646-1.295-2.988-2.916-2.999-1.622-.01-2.945 1.315-2.955 2.96s1.295 2.989 2.916 3' style='clip-rule:evenodd;fill:%23e1e3e9;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:2.47727823;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:.4' transform='translate(15.553 2.85)scale(.88807)'/%3E%3Cpath d='M-11.594 15.465c-.27-.002-.492.297-.494.668l-.012 1.876c-.003.371.214.673.485.675l4.14.027c.271.002.492-.298.495-.668l.012-1.877c.003-.37-.215-.672-.485-.674z' style='clip-rule:evenodd;fill:%23fff;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:2.47727823;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:.4' transform='translate(15.553 2.85)scale(.88807)'/%3E%3C/g%3E%3C/svg%3E")}}.maplibregl-ctrl.maplibregl-ctrl-attrib{background-color:#ffffff80;margin:0;padding:0 5px}@media screen{.maplibregl-ctrl-attrib.maplibregl-compact{background-color:#fff;border-radius:12px;box-sizing:content-box;color:#000;margin:10px;min-height:20px;padding:2px 24px 2px 0;position:relative}.maplibregl-ctrl-attrib.maplibregl-compact-show{padding:2px 28px 2px 8px;visibility:visible}.maplibregl-ctrl-bottom-left>.maplibregl-ctrl-attrib.maplibregl-compact-show,.maplibregl-ctrl-top-left>.maplibregl-ctrl-attrib.maplibregl-compact-show{border-radius:12px;padding:2px 8px 2px 28px}.maplibregl-ctrl-attrib.maplibregl-compact .maplibregl-ctrl-attrib-inner{display:none}.maplibregl-ctrl-attrib-button{background-color:#ffffff80;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' fill-rule='evenodd' viewBox='0 0 20 20'%3E%3Cpath d='M4 10a6 6 0 1 0 12 0 6 6 0 1 0-12 0m5-3a1 1 0 1 0 2 0 1 1 0 1 0-2 0m0 3a1 1 0 1 1 2 0v3a1 1 0 1 1-2 0'/%3E%3C/svg%3E");border:0;border-radius:12px;box-sizing:border-box;cursor:pointer;display:none;height:24px;outline:none;position:absolute;right:0;top:0;width:24px}.maplibregl-ctrl-attrib summary.maplibregl-ctrl-attrib-button{-webkit-appearance:none;-moz-appearance:none;appearance:none;list-style:none}.maplibregl-ctrl-attrib summary.maplibregl-ctrl-attrib-button::-webkit-details-marker{display:none}.maplibregl-ctrl-bottom-left .maplibregl-ctrl-attrib-button,.maplibregl-ctrl-top-left .maplibregl-ctrl-attrib-button{left:0}.maplibregl-ctrl-attrib.maplibregl-compact .maplibregl-ctrl-attrib-button,.maplibregl-ctrl-attrib.maplibregl-compact-show .maplibregl-ctrl-attrib-inner{display:block}.maplibregl-ctrl-attrib.maplibregl-compact-show .maplibregl-ctrl-attrib-button{background-color:#0000000d}.maplibregl-ctrl-bottom-right>.maplibregl-ctrl-attrib.maplibregl-compact:after{bottom:0;right:0}.maplibregl-ctrl-top-right>.maplibregl-ctrl-attrib.maplibregl-compact:after{right:0;top:0}.maplibregl-ctrl-top-left>.maplibregl-ctrl-attrib.maplibregl-compact:after{left:0;top:0}.maplibregl-ctrl-bottom-left>.maplibregl-ctrl-attrib.maplibregl-compact:after{bottom:0;left:0}}@media screen and (forced-colors:active){.maplibregl-ctrl-attrib.maplibregl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' fill='%23fff' fill-rule='evenodd' viewBox='0 0 20 20'%3E%3Cpath d='M4 10a6 6 0 1 0 12 0 6 6 0 1 0-12 0m5-3a1 1 0 1 0 2 0 1 1 0 1 0-2 0m0 3a1 1 0 1 1 2 0v3a1 1 0 1 1-2 0'/%3E%3C/svg%3E")}}@media screen and (forced-colors:active) and (prefers-color-scheme:light){.maplibregl-ctrl-attrib.maplibregl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' fill-rule='evenodd' viewBox='0 0 20 20'%3E%3Cpath d='M4 10a6 6 0 1 0 12 0 6 6 0 1 0-12 0m5-3a1 1 0 1 0 2 0 1 1 0 1 0-2 0m0 3a1 1 0 1 1 2 0v3a1 1 0 1 1-2 0'/%3E%3C/svg%3E")}}.maplibregl-ctrl-attrib a{color:#000000bf;text-decoration:none}.maplibregl-ctrl-attrib a:hover{color:inherit;text-decoration:underline}.maplibregl-attrib-empty{display:none}.maplibregl-ctrl-scale{background-color:#ffffffbf;border:2px solid #333;border-top:#333;box-sizing:border-box;color:#333;font-size:10px;padding:0 5px;white-space:nowrap}.maplibregl-popup{display:flex;left:0;pointer-events:none;position:absolute;top:0;will-change:transform}.maplibregl-popup-anchor-top,.maplibregl-popup-anchor-top-left,.maplibregl-popup-anchor-top-right{flex-direction:column}.maplibregl-popup-anchor-bottom,.maplibregl-popup-anchor-bottom-left,.maplibregl-popup-anchor-bottom-right{flex-direction:column-reverse}.maplibregl-popup-anchor-left{flex-direction:row}.maplibregl-popup-anchor-right{flex-direction:row-reverse}.maplibregl-popup-tip{border:10px solid transparent;height:0;width:0;z-index:1}.maplibregl-popup-anchor-top .maplibregl-popup-tip{align-self:center;border-bottom-color:#fff;border-top:none}.maplibregl-popup-anchor-top-left .maplibregl-popup-tip{align-self:flex-start;border-bottom-color:#fff;border-left:none;border-top:none}.maplibregl-popup-anchor-top-right .maplibregl-popup-tip{align-self:flex-end;border-bottom-color:#fff;border-right:none;border-top:none}.maplibregl-popup-anchor-bottom .maplibregl-popup-tip{align-self:center;border-bottom:none;border-top-color:#fff}.maplibregl-popup-anchor-bottom-left .maplibregl-popup-tip{align-self:flex-start;border-bottom:none;border-left:none;border-top-color:#fff}.maplibregl-popup-anchor-bottom-right .maplibregl-popup-tip{align-self:flex-end;border-bottom:none;border-right:none;border-top-color:#fff}.maplibregl-popup-anchor-left .maplibregl-popup-tip{align-self:center;border-left:none;border-right-color:#fff}.maplibregl-popup-anchor-right .maplibregl-popup-tip{align-self:center;border-left-color:#fff;border-right:none}.maplibregl-popup-close-button{background-color:transparent;border:0;border-radius:0 3px 0 0;cursor:pointer;position:absolute;right:0;top:0}.maplibregl-popup-close-button:hover{background-color:#0000000d}.maplibregl-popup-content{background:#fff;border-radius:3px;box-shadow:0 1px 2px #0000001a;padding:15px 10px;pointer-events:auto;position:relative}.maplibregl-popup-anchor-top-left .maplibregl-popup-content{border-top-left-radius:0}.maplibregl-popup-anchor-top-right .maplibregl-popup-content{border-top-right-radius:0}.maplibregl-popup-anchor-bottom-left .maplibregl-popup-content{border-bottom-left-radius:0}.maplibregl-popup-anchor-bottom-right .maplibregl-popup-content{border-bottom-right-radius:0}.maplibregl-popup-track-pointer{display:none}.maplibregl-popup-track-pointer *{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.maplibregl-map:hover .maplibregl-popup-track-pointer{display:flex}.maplibregl-map:active .maplibregl-popup-track-pointer{display:none}.maplibregl-marker{left:0;position:absolute;top:0;transition:opacity .2s;will-change:transform}.maplibregl-user-location-dot,.maplibregl-user-location-dot:before{background-color:#1da1f2;border-radius:50%;height:15px;width:15px}.maplibregl-user-location-dot:before{animation:maplibregl-user-location-dot-pulse 2s infinite;content:"";position:absolute}.maplibregl-user-location-dot:after{border:2px solid #fff;border-radius:50%;box-shadow:0 0 3px #00000059;box-sizing:border-box;content:"";height:19px;left:-2px;position:absolute;top:-2px;width:19px}@keyframes maplibregl-user-location-dot-pulse{0%{opacity:1;transform:scale(1)}70%{opacity:0;transform:scale(3)}to{opacity:0;transform:scale(1)}}.maplibregl-user-location-dot-stale{background-color:#aaa}.maplibregl-user-location-dot-stale:after{display:none}.maplibregl-user-location-accuracy-circle{background-color:#1da1f233;border-radius:100%;height:1px;width:1px}.maplibregl-crosshair,.maplibregl-crosshair .maplibregl-interactive,.maplibregl-crosshair .maplibregl-interactive:active{cursor:crosshair}.maplibregl-boxzoom{background:#fff;border:2px dotted #202020;height:0;left:0;opacity:.5;position:absolute;top:0;width:0}.maplibregl-cooperative-gesture-screen{align-items:center;background:#0006;color:#fff;display:flex;font-size:1.4em;inset:0;justify-content:center;line-height:1.2;opacity:0;padding:1rem;pointer-events:none;position:absolute;transition:opacity 1s ease 1s;z-index:99999}.maplibregl-cooperative-gesture-screen.maplibregl-show{opacity:1;transition:opacity .05s}.maplibregl-cooperative-gesture-screen .maplibregl-mobile-message{display:none}@media (hover:none),(pointer:coarse){.maplibregl-cooperative-gesture-screen .maplibregl-desktop-message{display:none}.maplibregl-cooperative-gesture-screen .maplibregl-mobile-message{display:block}}.maplibregl-pseudo-fullscreen{height:100%!important;left:0!important;position:fixed!important;top:0!important;width:100%!important;z-index:99999}.psv-navbar{display:none!important}`)),document.head.appendChild(l)}}catch(a){console.error("vite-plugin-css-injected-by-js",a)}})();
(function(vn,Ql){typeof exports=="object"&&typeof module<"u"?Ql(exports):typeof define=="function"&&define.amd?define(["exports"],Ql):(vn=typeof globalThis<"u"?globalThis:vn||self,Ql(vn.OlaMapsSDK={}))})(this,(function(vn){"use strict";function Ql(e,t){for(var r=0;r<t.length;r++){const n=t[r];if(typeof n!="string"&&!Array.isArray(n)){for(const a in n)if(a!=="default"&&!(a in e)){const d=Object.getOwnPropertyDescriptor(n,a);d&&Object.defineProperty(e,a,d.get?d:{enumerable:!0,get:()=>n[a]})}}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}class ps{apiKey;accessToken;mode;threedTileset;olaMaps;constructor({apiKey:t,accessToken:r="",mode:n="2d",threedTileset:a}){this.apiKey=t,this.mode=n,this.threedTileset=a||"",this.accessToken=r}async init(t){if(typeof window>"u")throw new Error("OlaMaps can only be initialized in a browser environment");const[{OlaMaps:r},n]=await Promise.all([Promise.resolve().then(()=>$8),Promise.resolve().then(()=>qu)]);return ps.initializeStaticProperties(n),await new r({apiKey:this.apiKey,accessToken:this.accessToken,mode:this.mode,threedTileset:this.threedTileset}).init(t)}addNavigationControls(t){if(typeof window>"u")throw new Error("addNavigationControls is only available in browser environments. Call init() first.");if(!ps._navigationControl)throw new Error("MapLibre GL not loaded. Call init() first to use addNavigationControls.");return new ps._navigationControl(t)}addGeolocateControls(t){if(typeof window>"u")throw new Error("addGeolocateControls is only available in browser environments. Call init() first.");if(!ps._geolocateControl)throw new Error("MapLibre GL not loaded. Call init() first to use addGeolocateControls.");return new ps._geolocateControl(t)}getMercatorCoordinate(){if(typeof window>"u")throw new Error("getMercatorCoordinate is only available in browser environments. Call init() first.");if(!ps._mercatorCoordinate)throw new Error("MapLibre GL not loaded. Call init() first to use getMercatorCoordinate.");return ps._mercatorCoordinate}addMarker(t){if(typeof window>"u")throw new Error("addMarker is only available in browser environments. Call init() first.");if(!ps._marker)throw new Error("MapLibre GL not loaded. Call init() first to use addMarker.");return new ps._marker(t)}addPopup(t){if(typeof window>"u")throw new Error("addPopup is only available in browser environments. Call init() first.");if(!ps._popup)throw new Error("MapLibre GL not loaded. Call init() first to use addPopup.");return new ps._popup(t)}getStaticMap(t,r){if(typeof window>"u")throw new Error("getStaticMap is only available in browser environments.");this.fetchStaticMap(t)?.then(a=>{if(a){const d=URL.createObjectURL(a),f=document.getElementById(r);f&&(f.src=d)}}).catch(a=>{console.error("Error loading static map:",a)})}async fetchStaticMap(t){try{const r=await fetch(t);return r.ok?await r.blob():null}catch(r){return console.error("Error fetching static map:",r),null}}static _marker=null;static _popup=null;static _navigationControl=null;static _geolocateControl=null;static _scaleControl=null;static _fullscreenControl=null;static _attributionControl=null;static _terrainControl=null;static _lngLat=null;static _lngLatBounds=null;static _point=null;static _mercatorCoordinate=null;static _mapMouseEvent=null;static _mapTouchEvent=null;static _mapWheelEvent=null;static _ajaxError=null;static get Marker(){return this._marker||this.createMockConstructor("Marker")}static get Popup(){return this._popup||this.createMockConstructor("Popup")}static get NavigationControl(){return this._navigationControl||this.createMockConstructor("NavigationControl")}static get GeolocateControl(){return this._geolocateControl||this.createMockConstructor("GeolocateControl")}static get ScaleControl(){return this._scaleControl||this.createMockConstructor("ScaleControl")}static createMockConstructor(t){return class{constructor(){throw typeof window>"u"?new Error(`OlaMaps.${t} is only available in browser environments. Call init() first.`):new Error(`MapLibre GL not loaded. Call OlaMaps.init() first to use ${t}.`)}}}static get FullscreenControl(){return this._fullscreenControl||this.createMockConstructor("FullscreenControl")}static get AttributionControl(){return this._attributionControl||this.createMockConstructor("AttributionControl")}static get TerrainControl(){return this._terrainControl||this.createMockConstructor("TerrainControl")}static get LngLat(){return this._lngLat||this.createMockConstructor("LngLat")}static get LngLatBounds(){return this._lngLatBounds||this.createMockConstructor("LngLatBounds")}static get Point(){return this._point||this.createMockConstructor("Point")}static get MercatorCoordinate(){return this._mercatorCoordinate||this.createMockConstructor("MercatorCoordinate")}static get MapMouseEvent(){return this._mapMouseEvent||this.createMockConstructor("MapMouseEvent")}static get MapTouchEvent(){return this._mapTouchEvent||this.createMockConstructor("MapTouchEvent")}static get MapWheelEvent(){return this._mapWheelEvent||this.createMockConstructor("MapWheelEvent")}static get AJAXError(){return this._ajaxError||this.createMockConstructor("AJAXError")}static initializeStaticProperties(t){this._marker=t.Marker,this._popup=t.Popup,this._navigationControl=t.NavigationControl,this._geolocateControl=t.GeolocateControl,this._scaleControl=t.ScaleControl,this._fullscreenControl=t.FullscreenControl,this._attributionControl=t.AttributionControl,this._terrainControl=t.TerrainControl,this._lngLat=t.LngLat,this._lngLatBounds=t.LngLatBounds,this._point=t.Point,this._mercatorCoordinate=t.MercatorCoordinate,this._mapMouseEvent=t.MapMouseEvent,this._mapTouchEvent=t.MapTouchEvent,this._mapWheelEvent=t.MapWheelEvent,this._ajaxError=t.AJAXError}}typeof window<"u"&&(window.OlaMaps=ps);const YS=e=>{const r=decodeURIComponent(document.cookie).split(";");for(let n=0;n<r.length;n++){const a=r[n].trim();if(a.indexOf(e)===0)return a.substring(e.length,a.length)}return""},KS=(e,t,r)=>{let n="";if(r){const a=new Date;a.setTime(a.getTime()+r*24*60*60*1e3),n=`; expires=${a.toUTCString()}`}document.cookie=`${e}=${t||""}${n}; path=/`},pb="https://api.olamaps.io/tiles/vector/v1/styles/default-light-standard/style.json?key=0.4.0",_b="https://api.olamaps.io/tiles/vector/v1/3dtiles/tileset.json",gb=e=>`<svg width="108" height="18" viewBox="0 0 108 18" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M31.0629 8.9393L34.6986 15.7293H38.2743L31.0629 2.2793L23.8516 15.7293H27.4273L31.0629 8.9393Z" fill="${e}"/><path d="M19.2265 12.5798L19.2365 2.25977H16.0703V15.7298H22.163L23.851 12.5798H19.2265Z" fill="${e}"/><path d="M7.22135 1.7793C5.79466 1.77733 4.39943 2.19909 3.21222 2.99123C2.025 3.78337 1.09915 4.91029 0.551806 6.22939C0.00446369 7.5485 -0.139771 9.00051 0.137352 10.4017C0.414475 11.8029 1.1005 13.0903 2.10863 14.1011C3.11676 15.1118 4.40168 15.8004 5.80082 16.0798C7.19996 16.3592 8.65043 16.2168 9.96872 15.6707C11.287 15.1245 12.4139 14.1991 13.2067 13.0116C13.9995 11.824 14.4227 10.4277 14.4227 8.9993C14.4227 7.08617 13.6643 5.25125 12.3141 3.89753C10.9639 2.5438 9.13219 1.78195 7.22135 1.7793ZM7.22135 12.8893C6.45207 12.8933 5.69892 12.6685 5.05735 12.2435C4.41579 11.8184 3.91469 11.2123 3.61755 10.5019C3.32041 9.79141 3.24061 9.00864 3.38827 8.25274C3.53592 7.49684 3.90438 6.80184 4.44695 6.25581C4.98952 5.70978 5.68178 5.3373 6.43601 5.18558C7.19023 5.03385 7.97246 5.10971 8.68358 5.40354C9.3947 5.69737 10.0027 6.19594 10.4305 6.83607C10.8583 7.4762 11.0867 8.22908 11.0867 8.9993C11.0867 9.51015 10.9862 10.016 10.791 10.4879C10.5957 10.9599 10.3095 11.3887 9.94873 11.7499C9.58794 12.1112 9.15963 12.3977 8.68823 12.5932C8.21684 12.7887 7.71161 12.8893 7.20138 12.8893H7.22135Z" fill="${e}"/><path d="M55.5634 4.82953V4.33953L50.4296 15.7295H49.4308L44.3768 4.33953V4.82953L43.9773 15.7295H42.9785L43.438 2.26953H44.5766L49.7104 13.8095C49.8003 14.0495 49.9102 14.2895 49.9801 14.5095C50.0543 14.2675 50.1513 14.0332 50.2698 13.8095L55.3437 2.26953H56.4723L56.9318 15.7295H55.933L55.5634 4.82953Z" fill="${e}"/><path d="M60.3287 15.7495H59.25L65.2428 2.26953H66.5513L72.5441 15.7495H71.4254L69.6875 11.8395H62.0666L60.3287 15.7495ZM66.4614 4.54953C66.2216 3.96953 66.0019 3.41953 65.8621 3.01953C65.7322 3.41953 65.5125 4.01953 65.2928 4.54953L62.4462 10.9095H69.288L66.4614 4.54953Z" fill="${e}"/><path d="M79.1611 2.14062C82.6669 2.14062 84.4048 3.62063 84.4048 6.62063C84.4048 9.62063 82.6669 11.0706 79.211 11.0706H75.9949V15.5906H74.9961V2.14062H79.1611ZM79.1611 10.1406C82.0077 10.1406 83.436 8.97062 83.416 6.61062C83.396 4.25062 82.0077 3.06062 79.1411 3.06062H75.9949V10.1406H79.1611Z" fill="${e}"/><path d="M95.1406 3.9293C93.7557 3.25763 92.2346 2.91539 90.6959 2.9293C88.8481 2.9293 87.6995 4.0193 87.6995 5.2293C87.6995 6.8693 88.5984 7.3593 91.6248 8.3693C94.6511 9.3793 95.9995 10.3693 95.9995 12.3693C95.9995 14.9993 93.942 15.9293 91.6947 15.9293C89.6115 15.9429 87.5948 15.1964 86.0215 13.8293L86.5009 13.0693C87.9375 14.3316 89.7833 15.0282 91.6947 15.0293C93.902 15.0293 95.0007 14.1193 95.0007 12.4893C95.0007 10.8593 94.1617 10.2093 90.9356 9.1293C88.069 8.1793 86.7007 7.5993 86.7007 5.2793C86.7007 3.3993 88.2488 2.0293 90.6959 2.0293C92.3497 2.03153 93.9817 2.40754 95.4702 3.1293L95.1406 3.9293Z" fill="${e}"/></svg>`;function mb(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Qd={exports:{}};var JS=Qd.exports,yb;function QS(){return yb||(yb=1,(function(e,t){(function(r,n){e.exports=n()})(JS,(function(){var r={},n={};function a(f,c,T){if(n[f]=T,f==="index"){var C="var sharedModule = {}; ("+n.shared+")(sharedModule); ("+n.worker+")(sharedModule);",R={};return n.shared(R),n.index(r,R),typeof window<"u"&&r.setWorkerUrl(window.URL.createObjectURL(new Blob([C],{type:"text/javascript"}))),r}}a("shared",["exports"],(function(f){function c(l,i,o,h){return new(o||(o=Promise))((function(p,g){function y(E){try{A(h.next(E))}catch(M){g(M)}}function x(E){try{A(h.throw(E))}catch(M){g(M)}}function A(E){var M;E.done?p(E.value):(M=E.value,M instanceof o?M:new o((function(P){P(M)}))).then(y,x)}A((h=h.apply(l,i||[])).next())}))}function T(l,i){this.x=l,this.y=i}function C(l){return l&&l.__esModule&&Object.prototype.hasOwnProperty.call(l,"default")?l.default:l}var R,L;typeof SuppressedError=="function"&&SuppressedError,T.prototype={clone(){return new T(this.x,this.y)},add(l){return this.clone()._add(l)},sub(l){return this.clone()._sub(l)},multByPoint(l){return this.clone()._multByPoint(l)},divByPoint(l){return this.clone()._divByPoint(l)},mult(l){return this.clone()._mult(l)},div(l){return this.clone()._div(l)},rotate(l){return this.clone()._rotate(l)},rotateAround(l,i){return this.clone()._rotateAround(l,i)},matMult(l){return this.clone()._matMult(l)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(l){return this.x===l.x&&this.y===l.y},dist(l){return Math.sqrt(this.distSqr(l))},distSqr(l){const i=l.x-this.x,o=l.y-this.y;return i*i+o*o},angle(){return Math.atan2(this.y,this.x)},angleTo(l){return Math.atan2(this.y-l.y,this.x-l.x)},angleWith(l){return this.angleWithSep(l.x,l.y)},angleWithSep(l,i){return Math.atan2(this.x*i-this.y*l,this.x*l+this.y*i)},_matMult(l){const i=l[2]*this.x+l[3]*this.y;return this.x=l[0]*this.x+l[1]*this.y,this.y=i,this},_add(l){return this.x+=l.x,this.y+=l.y,this},_sub(l){return this.x-=l.x,this.y-=l.y,this},_mult(l){return this.x*=l,this.y*=l,this},_div(l){return this.x/=l,this.y/=l,this},_multByPoint(l){return this.x*=l.x,this.y*=l.y,this},_divByPoint(l){return this.x/=l.x,this.y/=l.y,this},_unit(){return this._div(this.mag()),this},_perp(){const l=this.y;return this.y=this.x,this.x=-l,this},_rotate(l){const i=Math.cos(l),o=Math.sin(l),h=o*this.x+i*this.y;return this.x=i*this.x-o*this.y,this.y=h,this},_rotateAround(l,i){const o=Math.cos(l),h=Math.sin(l),p=i.y+h*(this.x-i.x)+o*(this.y-i.y);return this.x=i.x+o*(this.x-i.x)-h*(this.y-i.y),this.y=p,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:T},T.convert=function(l){if(l instanceof T)return l;if(Array.isArray(l))return new T(+l[0],+l[1]);if(l.x!==void 0&&l.y!==void 0)return new T(+l.x,+l.y);throw new Error("Expected [x, y] or {x, y} point format")};var V=(function(){if(L)return R;function l(i,o,h,p){this.cx=3*i,this.bx=3*(h-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*o,this.by=3*(p-o)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=o,this.p2x=h,this.p2y=p}return L=1,R=l,l.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,o){if(o===void 0&&(o=1e-6),i<0)return 0;if(i>1)return 1;for(var h=i,p=0;p<8;p++){var g=this.sampleCurveX(h)-i;if(Math.abs(g)<o)return h;var y=this.sampleCurveDerivativeX(h);if(Math.abs(y)<1e-6)break;h-=g/y}var x=0,A=1;for(h=i,p=0;p<20&&(g=this.sampleCurveX(h),!(Math.abs(g-i)<o));p++)i>g?x=h:A=h,h=.5*(A-x)+x;return h},solve:function(i,o){return this.sampleCurveY(this.solveCurveX(i,o))}},R})(),X=C(V);let at,nt;function K(){return at==null&&(at=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),at}function It(){if(nt==null&&(nt=!1,K())){const i=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(i){for(let h=0;h<25;h++){const p=4*h;i.fillStyle=`rgb(${p},${p+1},${p+2})`,i.fillRect(h%5,Math.floor(h/5),1,1)}const o=i.getImageData(0,0,5,5).data;for(let h=0;h<100;h++)if(h%4!=3&&o[h]!==h){nt=!0;break}}}return nt||!1}var St=1e-6,Ct=typeof Float32Array<"u"?Float32Array:Array;function Ht(){var l=new Ct(9);return Ct!=Float32Array&&(l[1]=0,l[2]=0,l[3]=0,l[5]=0,l[6]=0,l[7]=0),l[0]=1,l[4]=1,l[8]=1,l}function Qt(l){return l[0]=1,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=1,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=1,l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,l}function ee(){var l=new Ct(3);return Ct!=Float32Array&&(l[0]=0,l[1]=0,l[2]=0),l}function ae(l){var i=l[0],o=l[1],h=l[2];return Math.sqrt(i*i+o*o+h*h)}function be(l,i,o){var h=new Ct(3);return h[0]=l,h[1]=i,h[2]=o,h}function ie(l,i,o){return l[0]=i[0]+o[0],l[1]=i[1]+o[1],l[2]=i[2]+o[2],l}function le(l,i,o){return l[0]=i[0]*o,l[1]=i[1]*o,l[2]=i[2]*o,l}function Ae(l,i,o){var h=i[0],p=i[1],g=i[2],y=o[0],x=o[1],A=o[2];return l[0]=p*A-g*x,l[1]=g*y-h*A,l[2]=h*x-p*y,l}var Fe,ze=ae;function Ce(l,i,o){var h=i[0],p=i[1],g=i[2],y=i[3];return l[0]=o[0]*h+o[4]*p+o[8]*g+o[12]*y,l[1]=o[1]*h+o[5]*p+o[9]*g+o[13]*y,l[2]=o[2]*h+o[6]*p+o[10]*g+o[14]*y,l[3]=o[3]*h+o[7]*p+o[11]*g+o[15]*y,l}function zr(){var l=new Ct(4);return Ct!=Float32Array&&(l[0]=0,l[1]=0,l[2]=0),l[3]=1,l}function ns(l,i,o,h){var p=arguments.length>4&&arguments[4]!==void 0?arguments[4]:"zyx",g=Math.PI/360;i*=g,h*=g,o*=g;var y=Math.sin(i),x=Math.cos(i),A=Math.sin(o),E=Math.cos(o),M=Math.sin(h),P=Math.cos(h);switch(p){case"xyz":l[0]=y*E*P+x*A*M,l[1]=x*A*P-y*E*M,l[2]=x*E*M+y*A*P,l[3]=x*E*P-y*A*M;break;case"xzy":l[0]=y*E*P-x*A*M,l[1]=x*A*P-y*E*M,l[2]=x*E*M+y*A*P,l[3]=x*E*P+y*A*M;break;case"yxz":l[0]=y*E*P+x*A*M,l[1]=x*A*P-y*E*M,l[2]=x*E*M-y*A*P,l[3]=x*E*P+y*A*M;break;case"yzx":l[0]=y*E*P+x*A*M,l[1]=x*A*P+y*E*M,l[2]=x*E*M-y*A*P,l[3]=x*E*P-y*A*M;break;case"zxy":l[0]=y*E*P-x*A*M,l[1]=x*A*P+y*E*M,l[2]=x*E*M+y*A*P,l[3]=x*E*P-y*A*M;break;case"zyx":l[0]=y*E*P-x*A*M,l[1]=x*A*P+y*E*M,l[2]=x*E*M-y*A*P,l[3]=x*E*P+y*A*M;break;default:throw new Error("Unknown angle order "+p)}return l}function Hr(){var l=new Ct(2);return Ct!=Float32Array&&(l[0]=0,l[1]=0),l}function lo(l,i){var o=new Ct(2);return o[0]=l,o[1]=i,o}ee(),Fe=new Ct(4),Ct!=Float32Array&&(Fe[0]=0,Fe[1]=0,Fe[2]=0,Fe[3]=0),ee(),be(1,0,0),be(0,1,0),zr(),zr(),Ht(),Hr();const Le=8192;function vi(l,i,o){return i*(Le/(l.tileSize*Math.pow(2,o-l.tileID.overscaledZ)))}function xi(l,i){return(l%i+i)%i}function li(l,i,o){return l*(1-o)+i*o}function _a(l){if(l<=0)return 0;if(l>=1)return 1;const i=l*l,o=i*l;return 4*(l<.5?o:3*(l-i)+o-.75)}function vs(l,i,o,h){const p=new X(l,i,o,h);return g=>p.solve(g)}const hn=vs(.25,.1,.25,1);function wi(l,i,o){return Math.min(o,Math.max(i,l))}function ur(l,i,o){const h=o-i,p=((l-i)%h+h)%h+i;return p===i?o:p}function Rr(l,...i){for(const o of i)for(const h in o)l[h]=o[h];return l}let hr=1;function Or(l,i,o){const h={};for(const p in l)h[p]=i.call(this,l[p],p,l);return h}function xs(l,i,o){const h={};for(const p in l)i.call(this,l[p],p,l)&&(h[p]=l[p]);return h}function ci(l){return Array.isArray(l)?l.map(ci):typeof l=="object"&&l?Or(l,ci):l}const Fs={};function Je(l){Fs[l]||(typeof console<"u"&&console.warn(l),Fs[l]=!0)}function Ti(l,i,o){return(o.y-l.y)*(i.x-l.x)>(i.y-l.y)*(o.x-l.x)}function Gr(l){return typeof WorkerGlobalScope<"u"&&l!==void 0&&l instanceof WorkerGlobalScope}let We=null;function os(l){return typeof ImageBitmap<"u"&&l instanceof ImageBitmap}const as="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Os(l,i,o,h,p){return c(this,void 0,void 0,(function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const g=new VideoFrame(l,{timestamp:0});try{const y=g?.format;if(!y||!y.startsWith("BGR")&&!y.startsWith("RGB"))throw new Error(`Unrecognized format ${y}`);const x=y.startsWith("BGR"),A=new Uint8ClampedArray(h*p*4);if(yield g.copyTo(A,(function(E,M,P,F,O){const N=4*Math.max(-M,0),z=(Math.max(0,P)-P)*F*4+N,H=4*F,q=Math.max(0,M),ct=Math.max(0,P);return{rect:{x:q,y:ct,width:Math.min(E.width,M+F)-q,height:Math.min(E.height,P+O)-ct},layout:[{offset:z,stride:H}]}})(l,i,o,h,p)),x)for(let E=0;E<A.length;E+=4){const M=A[E];A[E]=A[E+2],A[E+2]=M}return A}finally{g.close()}}))}let $r,ws;function dn(l,i,o,h){return l.addEventListener(i,o,h),{unsubscribe:()=>{l.removeEventListener(i,o,h)}}}function Dn(l){return l*Math.PI/180}function Bi(l){return l/Math.PI*180}const Po={touchstart:!0,touchmove:!0,touchmoveWindow:!0,touchend:!0,touchcancel:!0},co={dblclick:!0,click:!0,mouseover:!0,mouseout:!0,mousedown:!0,mousemove:!0,mousemoveWindow:!0,mouseup:!0,mouseupWindow:!0,contextmenu:!0,wheel:!0},fn="AbortError";function Fn(){return new Error(fn)}const ks={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function Ns(l){return ks.REGISTERED_PROTOCOLS[l.substring(0,l.indexOf("://"))]}const Ls="global-dispatcher";class ls extends Error{constructor(i,o,h,p){super(`AJAXError: ${o} (${i}): ${h}`),this.status=i,this.statusText=o,this.url=h,this.body=p}}const ji=()=>Gr(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,yt=function(l,i){if(/:\/\//.test(l.url)&&!/^https?:|^file:/.test(l.url)){const h=Ns(l.url);if(h)return h(l,i);if(Gr(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:l,targetMapId:Ls},i)}if(!(/^file:/.test(o=l.url)||/^file:/.test(ji())&&!/^\w+:/.test(o))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return(function(h,p){return c(this,void 0,void 0,(function*(){const g=new Request(h.url,{method:h.method||"GET",body:h.body,credentials:h.credentials,headers:h.headers,cache:h.cache,referrer:ji(),signal:p.signal});let y,x;h.type!=="json"||g.headers.has("Accept")||g.headers.set("Accept","application/json");try{y=yield fetch(g)}catch(E){throw new ls(0,E.message,h.url,new Blob)}if(!y.ok){const E=yield y.blob();throw new ls(y.status,y.statusText,h.url,E)}x=h.type==="arrayBuffer"||h.type==="image"?y.arrayBuffer():h.type==="json"?y.json():y.text();const A=yield x;if(p.signal.aborted)throw Fn();return{data:A,cacheControl:y.headers.get("Cache-Control"),expires:y.headers.get("Expires")}}))})(l,i);if(Gr(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:l,mustQueue:!0,targetMapId:Ls},i)}var o;return(function(h,p){return new Promise(((g,y)=>{var x;const A=new XMLHttpRequest;A.open(h.method||"GET",h.url,!0),h.type!=="arrayBuffer"&&h.type!=="image"||(A.responseType="arraybuffer");for(const E in h.headers)A.setRequestHeader(E,h.headers[E]);h.type==="json"&&(A.responseType="text",!((x=h.headers)===null||x===void 0)&&x.Accept||A.setRequestHeader("Accept","application/json")),A.withCredentials=h.credentials==="include",A.onerror=()=>{y(new Error(A.statusText))},A.onload=()=>{if(!p.signal.aborted)if((A.status>=200&&A.status<300||A.status===0)&&A.response!==null){let E=A.response;if(h.type==="json")try{E=JSON.parse(A.response)}catch(M){return void y(M)}g({data:E,cacheControl:A.getResponseHeader("Cache-Control"),expires:A.getResponseHeader("Expires")})}else{const E=new Blob([A.response],{type:A.getResponseHeader("Content-Type")});y(new ls(A.status,A.statusText,h.url,E))}},p.signal.addEventListener("abort",(()=>{A.abort(),y(Fn())})),A.send(h.body)}))})(l,i)};function G(l){if(!l||l.indexOf("://")<=0||l.indexOf("data:image/")===0||l.indexOf("blob:")===0)return!0;const i=new URL(l),o=window.location;return i.protocol===o.protocol&&i.host===o.host}function $(l,i,o){o[l]&&o[l].indexOf(i)!==-1||(o[l]=o[l]||[],o[l].push(i))}function Z(l,i,o){if(o&&o[l]){const h=o[l].indexOf(i);h!==-1&&o[l].splice(h,1)}}class ht{constructor(i,o={}){Rr(this,o),this.type=i}}class ft extends ht{constructor(i,o={}){super("error",Rr({error:i},o))}}class Tt{on(i,o){return this._listeners=this._listeners||{},$(i,o,this._listeners),{unsubscribe:()=>{this.off(i,o)}}}off(i,o){return Z(i,o,this._listeners),Z(i,o,this._oneTimeListeners),this}once(i,o){return o?(this._oneTimeListeners=this._oneTimeListeners||{},$(i,o,this._oneTimeListeners),this):new Promise((h=>this.once(i,h)))}fire(i,o){typeof i=="string"&&(i=new ht(i,o||{}));const h=i.type;if(this.listens(h)){i.target=this;const p=this._listeners&&this._listeners[h]?this._listeners[h].slice():[];for(const x of p)x.call(this,i);const g=this._oneTimeListeners&&this._oneTimeListeners[h]?this._oneTimeListeners[h].slice():[];for(const x of g)Z(h,x,this._oneTimeListeners),x.call(this,i);const y=this._eventedParent;y&&(Rr(i,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),y.fire(i))}else i instanceof ft&&console.error(i.error);return this}listens(i){return this._listeners&&this._listeners[i]&&this._listeners[i].length>0||this._oneTimeListeners&&this._oneTimeListeners[i]&&this._oneTimeListeners[i].length>0||this._eventedParent&&this._eventedParent.listens(i)}setEventedParent(i,o){return this._eventedParent=i,this._eventedParentData=o,this}}var tt={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},"font-faces":{type:"array",value:"fontFaces"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},encoding:{type:"enum",values:{mvt:{},mlt:{}},default:"mvt"},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const xt=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function kt(l,i){const o={};for(const h in l)h!=="ref"&&(o[h]=l[h]);return xt.forEach((h=>{h in i&&(o[h]=i[h])})),o}function Lt(l,i){if(Array.isArray(l)){if(!Array.isArray(i)||l.length!==i.length)return!1;for(let o=0;o<l.length;o++)if(!Lt(l[o],i[o]))return!1;return!0}if(typeof l=="object"&&l!==null&&i!==null){if(typeof i!="object"||Object.keys(l).length!==Object.keys(i).length)return!1;for(const o in l)if(!Lt(l[o],i[o]))return!1;return!0}return l===i}function Ut(l,i){l.push(i)}function ne(l,i,o){Ut(o,{command:"addSource",args:[l,i[l]]})}function ge(l,i,o){Ut(i,{command:"removeSource",args:[l]}),o[l]=!0}function Ee(l,i,o,h){ge(l,o,h),ne(l,i,o)}function Sr(l,i,o){let h;for(h in l[o])if(Object.prototype.hasOwnProperty.call(l[o],h)&&h!=="data"&&!Lt(l[o][h],i[o][h]))return!1;for(h in i[o])if(Object.prototype.hasOwnProperty.call(i[o],h)&&h!=="data"&&!Lt(l[o][h],i[o][h]))return!1;return!0}function Pe(l,i,o,h,p,g){l=l||{},i=i||{};for(const y in l)Object.prototype.hasOwnProperty.call(l,y)&&(Lt(l[y],i[y])||o.push({command:g,args:[h,y,i[y],p]}));for(const y in i)Object.prototype.hasOwnProperty.call(i,y)&&!Object.prototype.hasOwnProperty.call(l,y)&&(Lt(l[y],i[y])||o.push({command:g,args:[h,y,i[y],p]}))}function Ve(l){return l.id}function rr(l,i){return l[i.id]=i,l}class Wt{constructor(i,o,h,p){this.message=(i?`${i}: `:"")+h,p&&(this.identifier=p),o!=null&&o.__line__&&(this.line=o.__line__)}}function Qe(l,...i){for(const o of i)for(const h in o)l[h]=o[h];return l}class ir extends Error{constructor(i,o){super(o),this.message=o,this.key=i}}class kr{constructor(i,o=[]){this.parent=i,this.bindings={};for(const[h,p]of o)this.bindings[h]=p}concat(i){return new kr(this,i)}get(i){if(this.bindings[i])return this.bindings[i];if(this.parent)return this.parent.get(i);throw new Error(`${i} not found in scope.`)}has(i){return!!this.bindings[i]||!!this.parent&&this.parent.has(i)}}const sr={kind:"null"},Xt={kind:"number"},ue={kind:"string"},ve={kind:"boolean"},Ai={kind:"color"},Us={kind:"projectionDefinition"},mr={kind:"object"},we={kind:"value"},Hi={kind:"collator"},zs={kind:"formatted"},pn={kind:"padding"},cs={kind:"colorArray"},On={kind:"numberArray"},Vs={kind:"resolvedImage"},ei={kind:"variableAnchorOffsetCollection"};function Zr(l,i){return{kind:"array",itemType:l,N:i}}function Ue(l){if(l.kind==="array"){const i=Ue(l.itemType);return typeof l.N=="number"?`array<${i}, ${l.N}>`:l.itemType.kind==="value"?"array":`array<${i}>`}return l.kind}const js=[sr,Xt,ue,ve,Ai,Us,zs,mr,Zr(we),pn,On,cs,Vs,ei];function Di(l,i){if(i.kind==="error")return null;if(l.kind==="array"){if(i.kind==="array"&&(i.N===0&&i.itemType.kind==="value"||!Di(l.itemType,i.itemType))&&(typeof l.N!="number"||l.N===i.N))return null}else{if(l.kind===i.kind)return null;if(l.kind==="value"){for(const o of js)if(!Di(o,i))return null}}return`Expected ${Ue(l)} but found ${Ue(i)} instead.`}function Fi(l,i){return i.some((o=>o.kind===l.kind))}function Ge(l,i){return i.some((o=>o==="null"?l===null:o==="array"?Array.isArray(l):o==="object"?l&&!Array.isArray(l)&&typeof l=="object":o===typeof l))}function Hs(l,i){return l.kind==="array"&&i.kind==="array"?l.itemType.kind===i.itemType.kind&&typeof l.N=="number":l.kind===i.kind}const ga=.96422,Gs=.82521,Gi=4/29,$s=6/29,ma=3*$s*$s,ya=$s*$s*$s,ul=Math.PI/180,ba=180/Math.PI;function Bo(l){return(l%=360)<0&&(l+=360),l}function Ws([l,i,o,h]){let p,g;const y=va((.2225045*(l=hl(l))+.7168786*(i=hl(i))+.0606169*(o=hl(o)))/1);l===i&&i===o?p=g=y:(p=va((.4360747*l+.3850649*i+.1430804*o)/ga),g=va((.0139322*l+.0971045*i+.7141733*o)/Gs));const x=116*y-16;return[x<0?0:x,500*(p-y),200*(y-g),h]}function hl(l){return l<=.04045?l/12.92:Math.pow((l+.055)/1.055,2.4)}function va(l){return l>ya?Math.pow(l,1/3):l/ma+Gi}function xa([l,i,o,h]){let p=(l+16)/116,g=isNaN(i)?p:p+i/500,y=isNaN(o)?p:p-o/200;return p=1*dl(p),g=ga*dl(g),y=Gs*dl(y),[wa(3.1338561*g-1.6168667*p-.4906146*y),wa(-.9787684*g+1.9161415*p+.033454*y),wa(.0719453*g-.2289914*p+1.4052427*y),h]}function wa(l){return(l=l<=.00304?12.92*l:1.055*Math.pow(l,1/2.4)-.055)<0?0:l>1?1:l}function dl(l){return l>$s?l*l*l:ma*(l-Gi)}const zc=Object.hasOwn||function(l,i){return Object.prototype.hasOwnProperty.call(l,i)};function Y(l,i){return zc(l,i)?l[i]:void 0}function it(l){return parseInt(l.padEnd(2,l),16)/255}function bt(l,i){return Nt(i?l/100:l,0,1)}function Nt(l,i,o){return Math.min(Math.max(i,l),o)}function Jt(l){return!l.some(Number.isNaN)}const de={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function Re(l,i,o){return l+o*(i-l)}function yr(l,i,o){return l.map(((h,p)=>Re(h,i[p],o)))}class Te{constructor(i,o,h,p=1,g=!0){this.r=i,this.g=o,this.b=h,this.a=p,g||(this.r*=p,this.g*=p,this.b*=p,p||this.overwriteGetter("rgb",[i,o,h,p]))}static parse(i){if(i instanceof Te)return i;if(typeof i!="string")return;const o=(function(h){if((h=h.toLowerCase().trim())==="transparent")return[0,0,0,0];const p=Y(de,h);if(p){const[y,x,A]=p;return[y/255,x/255,A/255,1]}if(h.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(h)){const y=h.length<6?1:2;let x=1;return[it(h.slice(x,x+=y)),it(h.slice(x,x+=y)),it(h.slice(x,x+=y)),it(h.slice(x,x+y)||"ff")]}if(h.startsWith("rgb")){const y=h.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(y){const[x,A,E,M,P,F,O,N,z,H,q,ct]=y,J=[M||" ",O||" ",H].join("");if(J==="  "||J==="  /"||J===",,"||J===",,,"){const rt=[E,F,z].join(""),pt=rt==="%%%"?100:rt===""?255:0;if(pt){const vt=[Nt(+A/pt,0,1),Nt(+P/pt,0,1),Nt(+N/pt,0,1),q?bt(+q,ct):1];if(Jt(vt))return vt}}return}}const g=h.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(g){const[y,x,A,E,M,P,F,O,N]=g,z=[A||" ",M||" ",F].join("");if(z==="  "||z==="  /"||z===",,"||z===",,,"){const H=[+x,Nt(+E,0,100),Nt(+P,0,100),O?bt(+O,N):1];if(Jt(H))return(function([q,ct,J,rt]){function pt(vt){const Pt=(vt+q/30)%12,jt=ct*Math.min(J,1-J);return J-jt*Math.max(-1,Math.min(Pt-3,9-Pt,1))}return q=Bo(q),ct/=100,J/=100,[pt(0),pt(8),pt(4),rt]})(H)}}})(i);return o?new Te(...o,!1):void 0}get rgb(){const{r:i,g:o,b:h,a:p}=this,g=p||1/0;return this.overwriteGetter("rgb",[i/g,o/g,h/g,p])}get hcl(){return this.overwriteGetter("hcl",(function(i){const[o,h,p,g]=Ws(i),y=Math.sqrt(h*h+p*p);return[Math.round(1e4*y)?Bo(Math.atan2(p,h)*ba):NaN,y,o,g]})(this.rgb))}get lab(){return this.overwriteGetter("lab",Ws(this.rgb))}overwriteGetter(i,o){return Object.defineProperty(this,i,{value:o}),o}toString(){const[i,o,h,p]=this.rgb;return`rgba(${[i,o,h].map((g=>Math.round(255*g))).join(",")},${p})`}static interpolate(i,o,h,p="rgb"){switch(p){case"rgb":{const[g,y,x,A]=yr(i.rgb,o.rgb,h);return new Te(g,y,x,A,!1)}case"hcl":{const[g,y,x,A]=i.hcl,[E,M,P,F]=o.hcl;let O,N;if(isNaN(g)||isNaN(E))isNaN(g)?isNaN(E)?O=NaN:(O=E,x!==1&&x!==0||(N=M)):(O=g,P!==1&&P!==0||(N=y));else{let J=E-g;E>g&&J>180?J-=360:E<g&&g-E>180&&(J+=360),O=g+h*J}const[z,H,q,ct]=(function([J,rt,pt,vt]){return J=isNaN(J)?0:J*ul,xa([pt,Math.cos(J)*rt,Math.sin(J)*rt,vt])})([O,N??Re(y,M,h),Re(x,P,h),Re(A,F,h)]);return new Te(z,H,q,ct,!1)}case"lab":{const[g,y,x,A]=xa(yr(i.lab,o.lab,h));return new Te(g,y,x,A,!1)}}}}Te.black=new Te(0,0,0,1),Te.white=new Te(1,1,1,1),Te.transparent=new Te(0,0,0,0),Te.red=new Te(1,0,0,1);class nr{constructor(i,o,h){this.sensitivity=i?o?"variant":"case":o?"accent":"base",this.locale=h,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(i,o){return this.collator.compare(i,o)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const Ie=["bottom","center","top"];class uo{constructor(i,o,h,p,g,y){this.text=i,this.image=o,this.scale=h,this.fontStack=p,this.textColor=g,this.verticalAlign=y}}class Yr{constructor(i){this.sections=i}static fromString(i){return new Yr([new uo(i,null,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some((i=>i.text.length!==0||i.image&&i.image.name.length!==0))}static factory(i){return i instanceof Yr?i:Yr.fromString(i)}toString(){return this.sections.length===0?"":this.sections.map((i=>i.text)).join("")}}class Oi{constructor(i){this.values=i.slice()}static parse(i){if(i instanceof Oi)return i;if(typeof i=="number")return new Oi([i,i,i,i]);if(Array.isArray(i)&&!(i.length<1||i.length>4)){for(const o of i)if(typeof o!="number")return;switch(i.length){case 1:i=[i[0],i[0],i[0],i[0]];break;case 2:i=[i[0],i[1],i[0],i[1]];break;case 3:i=[i[0],i[1],i[2],i[1]]}return new Oi(i)}}toString(){return JSON.stringify(this.values)}static interpolate(i,o,h){return new Oi(yr(i.values,o.values,h))}}class ki{constructor(i){this.values=i.slice()}static parse(i){if(i instanceof ki)return i;if(typeof i=="number")return new ki([i]);if(Array.isArray(i)){for(const o of i)if(typeof o!="number")return;return new ki(i)}}toString(){return JSON.stringify(this.values)}static interpolate(i,o,h){return new ki(yr(i.values,o.values,h))}}class ri{constructor(i){this.values=i.slice()}static parse(i){if(i instanceof ri)return i;if(typeof i=="string"){const h=Te.parse(i);return h?new ri([h]):void 0}if(!Array.isArray(i))return;const o=[];for(const h of i){if(typeof h!="string")return;const p=Te.parse(h);if(!p)return;o.push(p)}return new ri(o)}toString(){return JSON.stringify(this.values)}static interpolate(i,o,h,p="rgb"){const g=[];if(i.values.length!=o.values.length)throw new Error(`colorArray: Arrays have mismatched length (${i.values.length} vs. ${o.values.length}), cannot interpolate.`);for(let y=0;y<i.values.length;y++)g.push(Te.interpolate(i.values[y],o.values[y],h,p));return new ri(g)}}class dr extends Error{constructor(i){super(i),this.name="RuntimeError"}toJSON(){return this.message}}const Vc=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class $i{constructor(i){this.values=i.slice()}static parse(i){if(i instanceof $i)return i;if(Array.isArray(i)&&!(i.length<1)&&i.length%2==0){for(let o=0;o<i.length;o+=2){const h=i[o],p=i[o+1];if(typeof h!="string"||!Vc.has(h)||!Array.isArray(p)||p.length!==2||typeof p[0]!="number"||typeof p[1]!="number")return}return new $i(i)}}toString(){return JSON.stringify(this.values)}static interpolate(i,o,h){const p=i.values,g=o.values;if(p.length!==g.length)throw new dr(`Cannot interpolate values of different length. from: ${i.toString()}, to: ${o.toString()}`);const y=[];for(let x=0;x<p.length;x+=2){if(p[x]!==g[x])throw new dr(`Cannot interpolate values containing mismatched anchors. from[${x}]: ${p[x]}, to[${x}]: ${g[x]}`);y.push(p[x]);const[A,E]=p[x+1],[M,P]=g[x+1];y.push([Re(A,M,h),Re(E,P,h)])}return new $i(y)}}class ts{constructor(i){this.name=i.name,this.available=i.available}toString(){return this.name}static fromString(i){return i?new ts({name:i,available:!1}):null}}class Ni{constructor(i,o,h){this.from=i,this.to=o,this.transition=h}static interpolate(i,o,h){return new Ni(i,o,h)}static parse(i){return i instanceof Ni?i:Array.isArray(i)&&i.length===3&&typeof i[0]=="string"&&typeof i[1]=="string"&&typeof i[2]=="number"?new Ni(i[0],i[1],i[2]):typeof i=="object"&&typeof i.from=="string"&&typeof i.to=="string"&&typeof i.transition=="number"?new Ni(i.from,i.to,i.transition):typeof i=="string"?new Ni(i,i,1):void 0}}function Tp(l,i,o,h){return typeof l=="number"&&l>=0&&l<=255&&typeof i=="number"&&i>=0&&i<=255&&typeof o=="number"&&o>=0&&o<=255?h===void 0||typeof h=="number"&&h>=0&&h<=1?null:`Invalid rgba value [${[l,i,o,h].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof h=="number"?[l,i,o,h]:[l,i,o]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function ho(l){if(l===null||typeof l=="string"||typeof l=="boolean"||typeof l=="number"||l instanceof Ni||l instanceof Te||l instanceof nr||l instanceof Yr||l instanceof Oi||l instanceof ki||l instanceof ri||l instanceof $i||l instanceof ts)return!0;if(Array.isArray(l)){for(const i of l)if(!ho(i))return!1;return!0}if(typeof l=="object"){for(const i in l)if(!ho(l[i]))return!1;return!0}return!1}function br(l){if(l===null)return sr;if(typeof l=="string")return ue;if(typeof l=="boolean")return ve;if(typeof l=="number")return Xt;if(l instanceof Te)return Ai;if(l instanceof Ni)return Us;if(l instanceof nr)return Hi;if(l instanceof Yr)return zs;if(l instanceof Oi)return pn;if(l instanceof ki)return On;if(l instanceof ri)return cs;if(l instanceof $i)return ei;if(l instanceof ts)return Vs;if(Array.isArray(l)){const i=l.length;let o;for(const h of l){const p=br(h);if(o){if(o===p)continue;o=we;break}o=p}return Zr(o||we,i)}return mr}function Ta(l){const i=typeof l;return l===null?"":i==="string"||i==="number"||i==="boolean"?String(l):l instanceof Te||l instanceof Ni||l instanceof Yr||l instanceof Oi||l instanceof ki||l instanceof ri||l instanceof $i||l instanceof ts?l.toString():JSON.stringify(l)}class fo{constructor(i,o){this.type=i,this.value=o}static parse(i,o){if(i.length!==2)return o.error(`'literal' expression requires exactly one argument, but found ${i.length-1} instead.`);if(!ho(i[1]))return o.error("invalid value");const h=i[1];let p=br(h);const g=o.expectedType;return p.kind!=="array"||p.N!==0||!g||g.kind!=="array"||typeof g.N=="number"&&g.N!==0||(p=g),new fo(p,h)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const fl={string:ue,number:Xt,boolean:ve,object:mr};class es{constructor(i,o){this.type=i,this.args=o}static parse(i,o){if(i.length<2)return o.error("Expected at least one argument.");let h,p=1;const g=i[0];if(g==="array"){let x,A;if(i.length>2){const E=i[1];if(typeof E!="string"||!(E in fl)||E==="object")return o.error('The item type argument of "array" must be one of string, number, boolean',1);x=fl[E],p++}else x=we;if(i.length>3){if(i[2]!==null&&(typeof i[2]!="number"||i[2]<0||i[2]!==Math.floor(i[2])))return o.error('The length argument to "array" must be a positive integer literal',2);A=i[2],p++}h=Zr(x,A)}else{if(!fl[g])throw new Error(`Types doesn't contain name = ${g}`);h=fl[g]}const y=[];for(;p<i.length;p++){const x=o.parse(i[p],p,we);if(!x)return null;y.push(x)}return new es(h,y)}evaluate(i){for(let o=0;o<this.args.length;o++){const h=this.args[o].evaluate(i);if(!Di(this.type,br(h)))return h;if(o===this.args.length-1)throw new dr(`Expected value to be of type ${Ue(this.type)}, but found ${Ue(br(h))} instead.`)}throw new Error}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every((i=>i.outputDefined()))}}const vr={"to-boolean":ve,"to-color":Ai,"to-number":Xt,"to-string":ue};class _n{constructor(i,o){this.type=i,this.args=o}static parse(i,o){if(i.length<2)return o.error("Expected at least one argument.");const h=i[0];if(!vr[h])throw new Error(`Can't parse ${h} as it is not part of the known types`);if((h==="to-boolean"||h==="to-string")&&i.length!==2)return o.error("Expected one argument.");const p=vr[h],g=[];for(let y=1;y<i.length;y++){const x=o.parse(i[y],y,we);if(!x)return null;g.push(x)}return new _n(p,g)}evaluate(i){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(i);case"color":{let o,h;for(const p of this.args){if(o=p.evaluate(i),h=null,o instanceof Te)return o;if(typeof o=="string"){const g=i.parseColor(o);if(g)return g}else if(Array.isArray(o)&&(h=o.length<3||o.length>4?`Invalid rgba value ${JSON.stringify(o)}: expected an array containing either three or four numeric values.`:Tp(o[0],o[1],o[2],o[3]),!h))return new Te(o[0]/255,o[1]/255,o[2]/255,o[3])}throw new dr(h||`Could not parse color from value '${typeof o=="string"?o:JSON.stringify(o)}'`)}case"padding":{let o;for(const h of this.args){o=h.evaluate(i);const p=Oi.parse(o);if(p)return p}throw new dr(`Could not parse padding from value '${typeof o=="string"?o:JSON.stringify(o)}'`)}case"numberArray":{let o;for(const h of this.args){o=h.evaluate(i);const p=ki.parse(o);if(p)return p}throw new dr(`Could not parse numberArray from value '${typeof o=="string"?o:JSON.stringify(o)}'`)}case"colorArray":{let o;for(const h of this.args){o=h.evaluate(i);const p=ri.parse(o);if(p)return p}throw new dr(`Could not parse colorArray from value '${typeof o=="string"?o:JSON.stringify(o)}'`)}case"variableAnchorOffsetCollection":{let o;for(const h of this.args){o=h.evaluate(i);const p=$i.parse(o);if(p)return p}throw new dr(`Could not parse variableAnchorOffsetCollection from value '${typeof o=="string"?o:JSON.stringify(o)}'`)}case"number":{let o=null;for(const h of this.args){if(o=h.evaluate(i),o===null)return 0;const p=Number(o);if(!isNaN(p))return p}throw new dr(`Could not convert ${JSON.stringify(o)} to number.`)}case"formatted":return Yr.fromString(Ta(this.args[0].evaluate(i)));case"resolvedImage":return ts.fromString(Ta(this.args[0].evaluate(i)));case"projectionDefinition":return this.args[0].evaluate(i);default:return Ta(this.args[0].evaluate(i))}}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every((i=>i.outputDefined()))}}const je=["Unknown","Point","LineString","Polygon"];class Be{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?je[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(i){let o=this._parseColorCache.get(i);return o||(o=Te.parse(i),this._parseColorCache.set(i,o)),o}}class Aa{constructor(i,o,h=[],p,g=new kr,y=[]){this.registry=i,this.path=h,this.key=h.map((x=>`[${x}]`)).join(""),this.scope=g,this.errors=y,this.expectedType=p,this._isConstant=o}parse(i,o,h,p,g={}){return o?this.concat(o,h,p)._parse(i,g):this._parse(i,g)}_parse(i,o){function h(p,g,y){return y==="assert"?new es(g,[p]):y==="coerce"?new _n(g,[p]):p}if(i!==null&&typeof i!="string"&&typeof i!="boolean"&&typeof i!="number"||(i=["literal",i]),Array.isArray(i)){if(i.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const p=i[0];if(typeof p!="string")return this.error(`Expression name must be a string, but found ${typeof p} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const g=this.registry[p];if(g){let y=g.parse(i,this);if(!y)return null;if(this.expectedType){const x=this.expectedType,A=y.type;if(x.kind!=="string"&&x.kind!=="number"&&x.kind!=="boolean"&&x.kind!=="object"&&x.kind!=="array"||A.kind!=="value"){if(x.kind==="projectionDefinition"&&["string","array"].includes(A.kind)||["color","formatted","resolvedImage"].includes(x.kind)&&["value","string"].includes(A.kind)||["padding","numberArray"].includes(x.kind)&&["value","number","array"].includes(A.kind)||x.kind==="colorArray"&&["value","string","array"].includes(A.kind)||x.kind==="variableAnchorOffsetCollection"&&["value","array"].includes(A.kind))y=h(y,x,o.typeAnnotation||"coerce");else if(this.checkSubtype(x,A))return null}else y=h(y,x,o.typeAnnotation||"assert")}if(!(y instanceof fo)&&y.type.kind!=="resolvedImage"&&this._isConstant(y)){const x=new Be;try{y=new fo(y.type,y.evaluate(x))}catch(A){return this.error(A.message),null}}return y}return this.error(`Unknown expression "${p}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(i===void 0?"'undefined' value invalid. Use null instead.":typeof i=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof i} instead.`)}concat(i,o,h){const p=typeof i=="number"?this.path.concat(i):this.path,g=h?this.scope.concat(h):this.scope;return new Aa(this.registry,this._isConstant,p,o||null,g,this.errors)}error(i,...o){const h=`${this.key}${o.map((p=>`[${p}]`)).join("")}`;this.errors.push(new ir(h,i))}checkSubtype(i,o){const h=Di(i,o);return h&&this.error(h),h}}class Ne{constructor(i,o){this.type=o.type,this.bindings=[].concat(i),this.result=o}evaluate(i){return this.result.evaluate(i)}eachChild(i){for(const o of this.bindings)i(o[1]);i(this.result)}static parse(i,o){if(i.length<4)return o.error(`Expected at least 3 arguments, but found ${i.length-1} instead.`);const h=[];for(let g=1;g<i.length-1;g+=2){const y=i[g];if(typeof y!="string")return o.error(`Expected string, but found ${typeof y} instead.`,g);if(/[^a-zA-Z0-9_]/.test(y))return o.error("Variable names must contain only alphanumeric characters or '_'.",g);const x=o.parse(i[g+1],g+1);if(!x)return null;h.push([y,x])}const p=o.parse(i[i.length-1],i.length-1,o.expectedType,h);return p?new Ne(h,p):null}outputDefined(){return this.result.outputDefined()}}class Ea{constructor(i,o){this.type=o.type,this.name=i,this.boundExpression=o}static parse(i,o){if(i.length!==2||typeof i[1]!="string")return o.error("'var' expression requires exactly one string literal argument.");const h=i[1];return o.scope.has(h)?new Ea(h,o.scope.get(h)):o.error(`Unknown variable "${h}". Make sure "${h}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(i){return this.boundExpression.evaluate(i)}eachChild(){}outputDefined(){return!1}}class Xs{constructor(i,o,h){this.type=i,this.index=o,this.input=h}static parse(i,o){if(i.length!==3)return o.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const h=o.parse(i[1],1,Xt),p=o.parse(i[2],2,Zr(o.expectedType||we));return h&&p?new Xs(p.type.itemType,h,p):null}evaluate(i){const o=this.index.evaluate(i),h=this.input.evaluate(i);if(o<0)throw new dr(`Array index out of bounds: ${o} < 0.`);if(o>=h.length)throw new dr(`Array index out of bounds: ${o} > ${h.length-1}.`);if(o!==Math.floor(o))throw new dr(`Array index must be an integer, but found ${o} instead.`);return h[o]}eachChild(i){i(this.index),i(this.input)}outputDefined(){return!1}}class pl{constructor(i,o){this.type=ve,this.needle=i,this.haystack=o}static parse(i,o){if(i.length!==3)return o.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const h=o.parse(i[1],1,we),p=o.parse(i[2],2,we);return h&&p?Fi(h.type,[ve,ue,Xt,sr,we])?new pl(h,p):o.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ue(h.type)} instead`):null}evaluate(i){const o=this.needle.evaluate(i),h=this.haystack.evaluate(i);if(!h)return!1;if(!Ge(o,["boolean","string","number","null"]))throw new dr(`Expected first argument to be of type boolean, string, number or null, but found ${Ue(br(o))} instead.`);if(!Ge(h,["string","array"]))throw new dr(`Expected second argument to be of type array or string, but found ${Ue(br(h))} instead.`);return h.indexOf(o)>=0}eachChild(i){i(this.needle),i(this.haystack)}outputDefined(){return!0}}class Do{constructor(i,o,h){this.type=Xt,this.needle=i,this.haystack=o,this.fromIndex=h}static parse(i,o){if(i.length<=2||i.length>=5)return o.error(`Expected 2 or 3 arguments, but found ${i.length-1} instead.`);const h=o.parse(i[1],1,we),p=o.parse(i[2],2,we);if(!h||!p)return null;if(!Fi(h.type,[ve,ue,Xt,sr,we]))return o.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ue(h.type)} instead`);if(i.length===4){const g=o.parse(i[3],3,Xt);return g?new Do(h,p,g):null}return new Do(h,p)}evaluate(i){const o=this.needle.evaluate(i),h=this.haystack.evaluate(i);if(!Ge(o,["boolean","string","number","null"]))throw new dr(`Expected first argument to be of type boolean, string, number or null, but found ${Ue(br(o))} instead.`);let p;if(this.fromIndex&&(p=this.fromIndex.evaluate(i)),Ge(h,["string"])){const g=h.indexOf(o,p);return g===-1?-1:[...h.slice(0,g)].length}if(Ge(h,["array"]))return h.indexOf(o,p);throw new dr(`Expected second argument to be of type array or string, but found ${Ue(br(h))} instead.`)}eachChild(i){i(this.needle),i(this.haystack),this.fromIndex&&i(this.fromIndex)}outputDefined(){return!1}}class jc{constructor(i,o,h,p,g,y){this.inputType=i,this.type=o,this.input=h,this.cases=p,this.outputs=g,this.otherwise=y}static parse(i,o){if(i.length<5)return o.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if(i.length%2!=1)return o.error("Expected an even number of arguments.");let h,p;o.expectedType&&o.expectedType.kind!=="value"&&(p=o.expectedType);const g={},y=[];for(let E=2;E<i.length-1;E+=2){let M=i[E];const P=i[E+1];Array.isArray(M)||(M=[M]);const F=o.concat(E);if(M.length===0)return F.error("Expected at least one branch label.");for(const N of M){if(typeof N!="number"&&typeof N!="string")return F.error("Branch labels must be numbers or strings.");if(typeof N=="number"&&Math.abs(N)>Number.MAX_SAFE_INTEGER)return F.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof N=="number"&&Math.floor(N)!==N)return F.error("Numeric branch labels must be integer values.");if(h){if(F.checkSubtype(h,br(N)))return null}else h=br(N);if(g[String(N)]!==void 0)return F.error("Branch labels must be unique.");g[String(N)]=y.length}const O=o.parse(P,E,p);if(!O)return null;p=p||O.type,y.push(O)}const x=o.parse(i[1],1,we);if(!x)return null;const A=o.parse(i[i.length-1],i.length-1,p);return A?x.type.kind!=="value"&&o.concat(1).checkSubtype(h,x.type)?null:new jc(h,p,x,g,y,A):null}evaluate(i){const o=this.input.evaluate(i);return(br(o)===this.inputType&&this.outputs[this.cases[o]]||this.otherwise).evaluate(i)}eachChild(i){i(this.input),this.outputs.forEach(i),i(this.otherwise)}outputDefined(){return this.outputs.every((i=>i.outputDefined()))&&this.otherwise.outputDefined()}}class _l{constructor(i,o,h){this.type=i,this.branches=o,this.otherwise=h}static parse(i,o){if(i.length<4)return o.error(`Expected at least 3 arguments, but found only ${i.length-1}.`);if(i.length%2!=0)return o.error("Expected an odd number of arguments.");let h;o.expectedType&&o.expectedType.kind!=="value"&&(h=o.expectedType);const p=[];for(let y=1;y<i.length-1;y+=2){const x=o.parse(i[y],y,ve);if(!x)return null;const A=o.parse(i[y+1],y+1,h);if(!A)return null;p.push([x,A]),h=h||A.type}const g=o.parse(i[i.length-1],i.length-1,h);if(!g)return null;if(!h)throw new Error("Can't infer output type");return new _l(h,p,g)}evaluate(i){for(const[o,h]of this.branches)if(o.evaluate(i))return h.evaluate(i);return this.otherwise.evaluate(i)}eachChild(i){for(const[o,h]of this.branches)i(o),i(h);i(this.otherwise)}outputDefined(){return this.branches.every((([i,o])=>o.outputDefined()))&&this.otherwise.outputDefined()}}class gl{constructor(i,o,h,p){this.type=i,this.input=o,this.beginIndex=h,this.endIndex=p}static parse(i,o){if(i.length<=2||i.length>=5)return o.error(`Expected 2 or 3 arguments, but found ${i.length-1} instead.`);const h=o.parse(i[1],1,we),p=o.parse(i[2],2,Xt);if(!h||!p)return null;if(!Fi(h.type,[Zr(we),ue,we]))return o.error(`Expected first argument to be of type array or string, but found ${Ue(h.type)} instead`);if(i.length===4){const g=o.parse(i[3],3,Xt);return g?new gl(h.type,h,p,g):null}return new gl(h.type,h,p)}evaluate(i){const o=this.input.evaluate(i),h=this.beginIndex.evaluate(i);let p;if(this.endIndex&&(p=this.endIndex.evaluate(i)),Ge(o,["string"]))return[...o].slice(h,p).join("");if(Ge(o,["array"]))return o.slice(h,p);throw new dr(`Expected first argument to be of type array or string, but found ${Ue(br(o))} instead.`)}eachChild(i){i(this.input),i(this.beginIndex),this.endIndex&&i(this.endIndex)}outputDefined(){return!1}}function Hc(l,i){const o=l.length-1;let h,p,g=0,y=o,x=0;for(;g<=y;)if(x=Math.floor((g+y)/2),h=l[x],p=l[x+1],h<=i){if(x===o||i<p)return x;g=x+1}else{if(!(h>i))throw new dr("Input is not a number.");y=x-1}return 0}class Sa{constructor(i,o,h){this.type=i,this.input=o,this.labels=[],this.outputs=[];for(const[p,g]of h)this.labels.push(p),this.outputs.push(g)}static parse(i,o){if(i.length-1<4)return o.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if((i.length-1)%2!=0)return o.error("Expected an even number of arguments.");const h=o.parse(i[1],1,Xt);if(!h)return null;const p=[];let g=null;o.expectedType&&o.expectedType.kind!=="value"&&(g=o.expectedType);for(let y=1;y<i.length;y+=2){const x=y===1?-1/0:i[y],A=i[y+1],E=y,M=y+1;if(typeof x!="number")return o.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',E);if(p.length&&p[p.length-1][0]>=x)return o.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',E);const P=o.parse(A,M,g);if(!P)return null;g=g||P.type,p.push([x,P])}return new Sa(g,h,p)}evaluate(i){const o=this.labels,h=this.outputs;if(o.length===1)return h[0].evaluate(i);const p=this.input.evaluate(i);if(p<=o[0])return h[0].evaluate(i);const g=o.length;return p>=o[g-1]?h[g-1].evaluate(i):h[Hc(o,p)].evaluate(i)}eachChild(i){i(this.input);for(const o of this.outputs)i(o)}outputDefined(){return this.outputs.every((i=>i.outputDefined()))}}function Ap(l){return l&&l.__esModule&&Object.prototype.hasOwnProperty.call(l,"default")?l.default:l}var gn,Ei,Gc=(function(){if(Ei)return gn;function l(i,o,h,p){this.cx=3*i,this.bx=3*(h-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*o,this.by=3*(p-o)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=o,this.p2x=h,this.p2y=p}return Ei=1,gn=l,l.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,o){if(o===void 0&&(o=1e-6),i<0)return 0;if(i>1)return 1;for(var h=i,p=0;p<8;p++){var g=this.sampleCurveX(h)-i;if(Math.abs(g)<o)return h;var y=this.sampleCurveDerivativeX(h);if(Math.abs(y)<1e-6)break;h-=g/y}var x=0,A=1;for(h=i,p=0;p<20&&(g=this.sampleCurveX(h),!(Math.abs(g-i)<o));p++)i>g?x=h:A=h,h=.5*(A-x)+x;return h},solve:function(i,o){return this.sampleCurveY(this.solveCurveX(i,o))}},gn})(),Ep=Ap(Gc);class Si{constructor(i,o,h,p,g){this.type=i,this.operator=o,this.interpolation=h,this.input=p,this.labels=[],this.outputs=[];for(const[y,x]of g)this.labels.push(y),this.outputs.push(x)}static interpolationFactor(i,o,h,p){let g=0;if(i.name==="exponential")g=Kr(o,i.base,h,p);else if(i.name==="linear")g=Kr(o,1,h,p);else if(i.name==="cubic-bezier"){const y=i.controlPoints;g=new Ep(y[0],y[1],y[2],y[3]).solve(Kr(o,1,h,p))}return g}static parse(i,o){let[h,p,g,...y]=i;if(!Array.isArray(p)||p.length===0)return o.error("Expected an interpolation type expression.",1);if(p[0]==="linear")p={name:"linear"};else if(p[0]==="exponential"){const E=p[1];if(typeof E!="number")return o.error("Exponential interpolation requires a numeric base.",1,1);p={name:"exponential",base:E}}else{if(p[0]!=="cubic-bezier")return o.error(`Unknown interpolation type ${String(p[0])}`,1,0);{const E=p.slice(1);if(E.length!==4||E.some((M=>typeof M!="number"||M<0||M>1)))return o.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);p={name:"cubic-bezier",controlPoints:E}}}if(i.length-1<4)return o.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if((i.length-1)%2!=0)return o.error("Expected an even number of arguments.");if(g=o.parse(g,2,Xt),!g)return null;const x=[];let A=null;h!=="interpolate-hcl"&&h!=="interpolate-lab"||o.expectedType==cs?o.expectedType&&o.expectedType.kind!=="value"&&(A=o.expectedType):A=Ai;for(let E=0;E<y.length;E+=2){const M=y[E],P=y[E+1],F=E+3,O=E+4;if(typeof M!="number")return o.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',F);if(x.length&&x[x.length-1][0]>=M)return o.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',F);const N=o.parse(P,O,A);if(!N)return null;A=A||N.type,x.push([M,N])}return Hs(A,Xt)||Hs(A,Us)||Hs(A,Ai)||Hs(A,pn)||Hs(A,On)||Hs(A,cs)||Hs(A,ei)||Hs(A,Zr(Xt))?new Si(A,h,p,g,x):o.error(`Type ${Ue(A)} is not interpolatable.`)}evaluate(i){const o=this.labels,h=this.outputs;if(o.length===1)return h[0].evaluate(i);const p=this.input.evaluate(i);if(p<=o[0])return h[0].evaluate(i);const g=o.length;if(p>=o[g-1])return h[g-1].evaluate(i);const y=Hc(o,p),x=Si.interpolationFactor(this.interpolation,p,o[y],o[y+1]),A=h[y].evaluate(i),E=h[y+1].evaluate(i);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return Re(A,E,x);case"color":return Te.interpolate(A,E,x);case"padding":return Oi.interpolate(A,E,x);case"colorArray":return ri.interpolate(A,E,x);case"numberArray":return ki.interpolate(A,E,x);case"variableAnchorOffsetCollection":return $i.interpolate(A,E,x);case"array":return yr(A,E,x);case"projectionDefinition":return Ni.interpolate(A,E,x)}case"interpolate-hcl":switch(this.type.kind){case"color":return Te.interpolate(A,E,x,"hcl");case"colorArray":return ri.interpolate(A,E,x,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return Te.interpolate(A,E,x,"lab");case"colorArray":return ri.interpolate(A,E,x,"lab")}}}eachChild(i){i(this.input);for(const o of this.outputs)i(o)}outputDefined(){return this.outputs.every((i=>i.outputDefined()))}}function Kr(l,i,o,h){const p=h-o,g=l-o;return p===0?0:i===1?g/p:(Math.pow(i,g)-1)/(Math.pow(i,p)-1)}const qs={color:Te.interpolate,number:Re,padding:Oi.interpolate,numberArray:ki.interpolate,colorArray:ri.interpolate,variableAnchorOffsetCollection:$i.interpolate,array:yr};class Ca{constructor(i,o){this.type=i,this.args=o}static parse(i,o){if(i.length<2)return o.error("Expected at least one argument.");let h=null;const p=o.expectedType;p&&p.kind!=="value"&&(h=p);const g=[];for(const x of i.slice(1)){const A=o.parse(x,1+g.length,h,void 0,{typeAnnotation:"omit"});if(!A)return null;h=h||A.type,g.push(A)}if(!h)throw new Error("No output type");const y=p&&g.some((x=>Di(p,x.type)));return new Ca(y?we:h,g)}evaluate(i){let o,h=null,p=0;for(const g of this.args)if(p++,h=g.evaluate(i),h&&h instanceof ts&&!h.available&&(o||(o=h.name),h=null,p===this.args.length&&(h=o)),h!==null)break;return h}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every((i=>i.outputDefined()))}}function zh(l,i){return l==="=="||l==="!="?i.kind==="boolean"||i.kind==="string"||i.kind==="number"||i.kind==="null"||i.kind==="value":i.kind==="string"||i.kind==="number"||i.kind==="value"}function Sp(l,i,o,h){return h.compare(i,o)===0}function Zs(l,i,o){const h=l!=="=="&&l!=="!=";return class ZS{constructor(g,y,x){this.type=ve,this.lhs=g,this.rhs=y,this.collator=x,this.hasUntypedArgument=g.type.kind==="value"||y.type.kind==="value"}static parse(g,y){if(g.length!==3&&g.length!==4)return y.error("Expected two or three arguments.");const x=g[0];let A=y.parse(g[1],1,we);if(!A)return null;if(!zh(x,A.type))return y.concat(1).error(`"${x}" comparisons are not supported for type '${Ue(A.type)}'.`);let E=y.parse(g[2],2,we);if(!E)return null;if(!zh(x,E.type))return y.concat(2).error(`"${x}" comparisons are not supported for type '${Ue(E.type)}'.`);if(A.type.kind!==E.type.kind&&A.type.kind!=="value"&&E.type.kind!=="value")return y.error(`Cannot compare types '${Ue(A.type)}' and '${Ue(E.type)}'.`);h&&(A.type.kind==="value"&&E.type.kind!=="value"?A=new es(E.type,[A]):A.type.kind!=="value"&&E.type.kind==="value"&&(E=new es(A.type,[E])));let M=null;if(g.length===4){if(A.type.kind!=="string"&&E.type.kind!=="string"&&A.type.kind!=="value"&&E.type.kind!=="value")return y.error("Cannot use collator to compare non-string types.");if(M=y.parse(g[3],3,Hi),!M)return null}return new ZS(A,E,M)}evaluate(g){const y=this.lhs.evaluate(g),x=this.rhs.evaluate(g);if(h&&this.hasUntypedArgument){const A=br(y),E=br(x);if(A.kind!==E.kind||A.kind!=="string"&&A.kind!=="number")throw new dr(`Expected arguments for "${l}" to be (string, string) or (number, number), but found (${A.kind}, ${E.kind}) instead.`)}if(this.collator&&!h&&this.hasUntypedArgument){const A=br(y),E=br(x);if(A.kind!=="string"||E.kind!=="string")return i(g,y,x)}return this.collator?o(g,y,x,this.collator.evaluate(g)):i(g,y,x)}eachChild(g){g(this.lhs),g(this.rhs),this.collator&&g(this.collator)}outputDefined(){return!0}}}const $c=Zs("==",(function(l,i,o){return i===o}),Sp),Vh=Zs("!=",(function(l,i,o){return i!==o}),(function(l,i,o,h){return!Sp(0,i,o,h)})),Ky=Zs("<",(function(l,i,o){return i<o}),(function(l,i,o,h){return h.compare(i,o)<0})),Cp=Zs(">",(function(l,i,o){return i>o}),(function(l,i,o,h){return h.compare(i,o)>0})),Wc=Zs("<=",(function(l,i,o){return i<=o}),(function(l,i,o,h){return h.compare(i,o)<=0})),Xc=Zs(">=",(function(l,i,o){return i>=o}),(function(l,i,o,h){return h.compare(i,o)>=0}));class rs{constructor(i,o,h){this.type=Hi,this.locale=h,this.caseSensitive=i,this.diacriticSensitive=o}static parse(i,o){if(i.length!==2)return o.error("Expected one argument.");const h=i[1];if(typeof h!="object"||Array.isArray(h))return o.error("Collator options argument must be an object.");const p=o.parse(h["case-sensitive"]!==void 0&&h["case-sensitive"],1,ve);if(!p)return null;const g=o.parse(h["diacritic-sensitive"]!==void 0&&h["diacritic-sensitive"],1,ve);if(!g)return null;let y=null;return h.locale&&(y=o.parse(h.locale,1,ue),!y)?null:new rs(p,g,y)}evaluate(i){return new nr(this.caseSensitive.evaluate(i),this.diacriticSensitive.evaluate(i),this.locale?this.locale.evaluate(i):null)}eachChild(i){i(this.caseSensitive),i(this.diacriticSensitive),this.locale&&i(this.locale)}outputDefined(){return!1}}class qc{constructor(i,o,h,p,g){this.type=ue,this.number=i,this.locale=o,this.currency=h,this.minFractionDigits=p,this.maxFractionDigits=g}static parse(i,o){if(i.length!==3)return o.error("Expected two arguments.");const h=o.parse(i[1],1,Xt);if(!h)return null;const p=i[2];if(typeof p!="object"||Array.isArray(p))return o.error("NumberFormat options argument must be an object.");let g=null;if(p.locale&&(g=o.parse(p.locale,1,ue),!g))return null;let y=null;if(p.currency&&(y=o.parse(p.currency,1,ue),!y))return null;let x=null;if(p["min-fraction-digits"]&&(x=o.parse(p["min-fraction-digits"],1,Xt),!x))return null;let A=null;return p["max-fraction-digits"]&&(A=o.parse(p["max-fraction-digits"],1,Xt),!A)?null:new qc(h,g,y,x,A)}evaluate(i){return new Intl.NumberFormat(this.locale?this.locale.evaluate(i):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(i):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(i):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(i):void 0}).format(this.number.evaluate(i))}eachChild(i){i(this.number),this.locale&&i(this.locale),this.currency&&i(this.currency),this.minFractionDigits&&i(this.minFractionDigits),this.maxFractionDigits&&i(this.maxFractionDigits)}outputDefined(){return!1}}class Fo{constructor(i){this.type=zs,this.sections=i}static parse(i,o){if(i.length<2)return o.error("Expected at least one argument.");const h=i[1];if(!Array.isArray(h)&&typeof h=="object")return o.error("First argument must be an image or text section.");const p=[];let g=!1;for(let y=1;y<=i.length-1;++y){const x=i[y];if(g&&typeof x=="object"&&!Array.isArray(x)){g=!1;let A=null;if(x["font-scale"]&&(A=o.parse(x["font-scale"],1,Xt),!A))return null;let E=null;if(x["text-font"]&&(E=o.parse(x["text-font"],1,Zr(ue)),!E))return null;let M=null;if(x["text-color"]&&(M=o.parse(x["text-color"],1,Ai),!M))return null;let P=null;if(x["vertical-align"]){if(typeof x["vertical-align"]=="string"&&!Ie.includes(x["vertical-align"]))return o.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${x["vertical-align"]}' instead.`);if(P=o.parse(x["vertical-align"],1,ue),!P)return null}const F=p[p.length-1];F.scale=A,F.font=E,F.textColor=M,F.verticalAlign=P}else{const A=o.parse(i[y],1,we);if(!A)return null;const E=A.type.kind;if(E!=="string"&&E!=="value"&&E!=="null"&&E!=="resolvedImage")return o.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");g=!0,p.push({content:A,scale:null,font:null,textColor:null,verticalAlign:null})}}return new Fo(p)}evaluate(i){return new Yr(this.sections.map((o=>{const h=o.content.evaluate(i);return br(h)===Vs?new uo("",h,null,null,null,o.verticalAlign?o.verticalAlign.evaluate(i):null):new uo(Ta(h),null,o.scale?o.scale.evaluate(i):null,o.font?o.font.evaluate(i).join(","):null,o.textColor?o.textColor.evaluate(i):null,o.verticalAlign?o.verticalAlign.evaluate(i):null)})))}eachChild(i){for(const o of this.sections)i(o.content),o.scale&&i(o.scale),o.font&&i(o.font),o.textColor&&i(o.textColor),o.verticalAlign&&i(o.verticalAlign)}outputDefined(){return!1}}class jh{constructor(i){this.type=Vs,this.input=i}static parse(i,o){if(i.length!==2)return o.error("Expected two arguments.");const h=o.parse(i[1],1,ue);return h?new jh(h):o.error("No image name provided.")}evaluate(i){const o=this.input.evaluate(i),h=ts.fromString(o);return h&&i.availableImages&&(h.available=i.availableImages.indexOf(o)>-1),h}eachChild(i){i(this.input)}outputDefined(){return!1}}class ml{constructor(i){this.type=Xt,this.input=i}static parse(i,o){if(i.length!==2)return o.error(`Expected 1 argument, but found ${i.length-1} instead.`);const h=o.parse(i[1],1);return h?h.type.kind!=="array"&&h.type.kind!=="string"&&h.type.kind!=="value"?o.error(`Expected argument of type string or array, but found ${Ue(h.type)} instead.`):new ml(h):null}evaluate(i){const o=this.input.evaluate(i);if(typeof o=="string")return[...o].length;if(Array.isArray(o))return o.length;throw new dr(`Expected value to be of type string or array, but found ${Ue(br(o))} instead.`)}eachChild(i){i(this.input)}outputDefined(){return!1}}const mn=8192;function Jy(l,i){const o=(180+l[0])/360,h=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+l[1]*Math.PI/360)))/360,p=Math.pow(2,i.z);return[Math.round(o*p*mn),Math.round(h*p*mn)]}function Hh(l,i){const o=Math.pow(2,i.z);return[(p=(l[0]/mn+i.x)/o,360*p-180),(h=(l[1]/mn+i.y)/o,360/Math.PI*Math.atan(Math.exp((180-360*h)*Math.PI/180))-90)];var h,p}function yl(l,i){l[0]=Math.min(l[0],i[0]),l[1]=Math.min(l[1],i[1]),l[2]=Math.max(l[2],i[0]),l[3]=Math.max(l[3],i[1])}function po(l,i){return!(l[0]<=i[0]||l[2]>=i[2]||l[1]<=i[1]||l[3]>=i[3])}function Qy(l,i,o){const h=l[0]-i[0],p=l[1]-i[1],g=l[0]-o[0],y=l[1]-o[1];return h*y-g*p==0&&h*g<=0&&p*y<=0}function bl(l,i,o,h){return(p=[h[0]-o[0],h[1]-o[1]])[0]*(g=[i[0]-l[0],i[1]-l[1]])[1]-p[1]*g[0]!=0&&!(!Pp(l,i,o,h)||!Pp(o,h,l,i));var p,g}function Ip(l,i,o){for(const h of o)for(let p=0;p<h.length-1;++p)if(bl(l,i,h[p],h[p+1]))return!0;return!1}function Ia(l,i,o=!1){let h=!1;for(const x of i)for(let A=0;A<x.length-1;A++){if(Qy(l,x[A],x[A+1]))return o;(g=x[A])[1]>(p=l)[1]!=(y=x[A+1])[1]>p[1]&&p[0]<(y[0]-g[0])*(p[1]-g[1])/(y[1]-g[1])+g[0]&&(h=!h)}var p,g,y;return h}function Mp(l,i){for(const o of i)if(Ia(l,o))return!0;return!1}function Rp(l,i){for(const o of l)if(!Ia(o,i))return!1;for(let o=0;o<l.length-1;++o)if(Ip(l[o],l[o+1],i))return!1;return!0}function t0(l,i){for(const o of i)if(Rp(l,o))return!0;return!1}function Pp(l,i,o,h){const p=h[0]-o[0],g=h[1]-o[1],y=(l[0]-o[0])*g-p*(l[1]-o[1]),x=(i[0]-o[0])*g-p*(i[1]-o[1]);return y>0&&x<0||y<0&&x>0}function Gh(l,i,o){const h=[];for(let p=0;p<l.length;p++){const g=[];for(let y=0;y<l[p].length;y++){const x=Jy(l[p][y],o);yl(i,x),g.push(x)}h.push(g)}return h}function Bp(l,i,o){const h=[];for(let p=0;p<l.length;p++){const g=Gh(l[p],i,o);h.push(g)}return h}function $h(l,i,o,h){if(l[0]<o[0]||l[0]>o[2]){const p=.5*h;let g=l[0]-o[0]>p?-h:o[0]-l[0]>p?h:0;g===0&&(g=l[0]-o[2]>p?-h:o[2]-l[0]>p?h:0),l[0]+=g}yl(i,l)}function Wh(l,i,o,h){const p=Math.pow(2,h.z)*mn,g=[h.x*mn,h.y*mn],y=[];for(const x of l)for(const A of x){const E=[A.x+g[0],A.y+g[1]];$h(E,i,o,p),y.push(E)}return y}function Xh(l,i,o,h){const p=Math.pow(2,h.z)*mn,g=[h.x*mn,h.y*mn],y=[];for(const A of l){const E=[];for(const M of A){const P=[M.x+g[0],M.y+g[1]];yl(i,P),E.push(P)}y.push(E)}if(i[2]-i[0]<=p/2){(x=i)[0]=x[1]=1/0,x[2]=x[3]=-1/0;for(const A of y)for(const E of A)$h(E,i,o,p)}var x;return y}class Oo{constructor(i,o){this.type=ve,this.geojson=i,this.geometries=o}static parse(i,o){if(i.length!==2)return o.error(`'within' expression requires exactly one argument, but found ${i.length-1} instead.`);if(ho(i[1])){const h=i[1];if(h.type==="FeatureCollection"){const p=[];for(const g of h.features){const{type:y,coordinates:x}=g.geometry;y==="Polygon"&&p.push(x),y==="MultiPolygon"&&p.push(...x)}if(p.length)return new Oo(h,{type:"MultiPolygon",coordinates:p})}else if(h.type==="Feature"){const p=h.geometry.type;if(p==="Polygon"||p==="MultiPolygon")return new Oo(h,h.geometry)}else if(h.type==="Polygon"||h.type==="MultiPolygon")return new Oo(h,h)}return o.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(i){if(i.geometry()!=null&&i.canonicalID()!=null){if(i.geometryType()==="Point")return(function(o,h){const p=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],y=o.canonicalID();if(h.type==="Polygon"){const x=Gh(h.coordinates,g,y),A=Wh(o.geometry(),p,g,y);if(!po(p,g))return!1;for(const E of A)if(!Ia(E,x))return!1}if(h.type==="MultiPolygon"){const x=Bp(h.coordinates,g,y),A=Wh(o.geometry(),p,g,y);if(!po(p,g))return!1;for(const E of A)if(!Mp(E,x))return!1}return!0})(i,this.geometries);if(i.geometryType()==="LineString")return(function(o,h){const p=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],y=o.canonicalID();if(h.type==="Polygon"){const x=Gh(h.coordinates,g,y),A=Xh(o.geometry(),p,g,y);if(!po(p,g))return!1;for(const E of A)if(!Rp(E,x))return!1}if(h.type==="MultiPolygon"){const x=Bp(h.coordinates,g,y),A=Xh(o.geometry(),p,g,y);if(!po(p,g))return!1;for(const E of A)if(!t0(E,x))return!1}return!0})(i,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let Dp=class{constructor(l=[],i=(o,h)=>o<h?-1:o>h?1:0){if(this.data=l,this.length=this.data.length,this.compare=i,this.length>0)for(let o=(this.length>>1)-1;o>=0;o--)this._down(o)}push(l){this.data.push(l),this._up(this.length++)}pop(){if(this.length===0)return;const l=this.data[0],i=this.data.pop();return--this.length>0&&(this.data[0]=i,this._down(0)),l}peek(){return this.data[0]}_up(l){const{data:i,compare:o}=this,h=i[l];for(;l>0;){const p=l-1>>1,g=i[p];if(o(h,g)>=0)break;i[l]=g,l=p}i[l]=h}_down(l){const{data:i,compare:o}=this,h=this.length>>1,p=i[l];for(;l<h;){let g=1+(l<<1);const y=g+1;if(y<this.length&&o(i[y],i[g])<0&&(g=y),o(i[g],p)>=0)break;i[l]=i[g],l=g}i[l]=p}};function Fp(l,i,o=0,h=l.length-1,p=Zc){for(;h>o;){if(h-o>600){const A=h-o+1,E=i-o+1,M=Math.log(A),P=.5*Math.exp(2*M/3),F=.5*Math.sqrt(M*P*(A-P)/A)*(E-A/2<0?-1:1);Fp(l,i,Math.max(o,Math.floor(i-E*P/A+F)),Math.min(h,Math.floor(i+(A-E)*P/A+F)),p)}const g=l[i];let y=o,x=h;for(vl(l,o,i),p(l[h],g)>0&&vl(l,o,h);y<x;){for(vl(l,y,x),y++,x--;p(l[y],g)<0;)y++;for(;p(l[x],g)>0;)x--}p(l[o],g)===0?vl(l,o,x):(x++,vl(l,x,h)),x<=i&&(o=x+1),i<=x&&(h=x-1)}}function vl(l,i,o){const h=l[i];l[i]=l[o],l[o]=h}function Zc(l,i){return l<i?-1:l>i?1:0}function xl(l,i){if(l.length<=1)return[l];const o=[];let h,p;for(const g of l){const y=r0(g);y!==0&&(g.area=Math.abs(y),p===void 0&&(p=y<0),p===y<0?(h&&o.push(h),h=[g]):h.push(g))}if(h&&o.push(h),i>1)for(let g=0;g<o.length;g++)o[g].length<=i||(Fp(o[g],i,1,o[g].length-1,e0),o[g]=o[g].slice(0,i));return o}function e0(l,i){return i.area-l.area}function r0(l){let i=0;for(let o,h,p=0,g=l.length,y=g-1;p<g;y=p++)o=l[p],h=l[y],i+=(h.x-o.x)*(o.y+h.y);return i}const Op=1/298.257223563,Yc=Op*(2-Op),qh=Math.PI/180;class Zh{constructor(i){const o=6378.137*qh*1e3,h=Math.cos(i*qh),p=1/(1-Yc*(1-h*h)),g=Math.sqrt(p);this.kx=o*g*h,this.ky=o*g*p*(1-Yc)}distance(i,o){const h=this.wrap(i[0]-o[0])*this.kx,p=(i[1]-o[1])*this.ky;return Math.sqrt(h*h+p*p)}pointOnLine(i,o){let h,p,g,y,x=1/0;for(let A=0;A<i.length-1;A++){let E=i[A][0],M=i[A][1],P=this.wrap(i[A+1][0]-E)*this.kx,F=(i[A+1][1]-M)*this.ky,O=0;P===0&&F===0||(O=(this.wrap(o[0]-E)*this.kx*P+(o[1]-M)*this.ky*F)/(P*P+F*F),O>1?(E=i[A+1][0],M=i[A+1][1]):O>0&&(E+=P/this.kx*O,M+=F/this.ky*O)),P=this.wrap(o[0]-E)*this.kx,F=(o[1]-M)*this.ky;const N=P*P+F*F;N<x&&(x=N,h=E,p=M,g=A,y=O)}return{point:[h,p],index:g,t:Math.max(0,Math.min(1,y))}}wrap(i){for(;i<-180;)i+=360;for(;i>180;)i-=360;return i}}function kp(l,i){return i[0]-l[0]}function wl(l){return l[1]-l[0]+1}function yn(l,i){return l[1]>=l[0]&&l[1]<i}function Yh(l,i){if(l[0]>l[1])return[null,null];const o=wl(l);if(i){if(o===2)return[l,null];const p=Math.floor(o/2);return[[l[0],l[0]+p],[l[0]+p,l[1]]]}if(o===1)return[l,null];const h=Math.floor(o/2)-1;return[[l[0],l[0]+h],[l[0]+h+1,l[1]]]}function Kh(l,i){if(!yn(i,l.length))return[1/0,1/0,-1/0,-1/0];const o=[1/0,1/0,-1/0,-1/0];for(let h=i[0];h<=i[1];++h)yl(o,l[h]);return o}function Jh(l){const i=[1/0,1/0,-1/0,-1/0];for(const o of l)for(const h of o)yl(i,h);return i}function Qh(l){return l[0]!==-1/0&&l[1]!==-1/0&&l[2]!==1/0&&l[3]!==1/0}function td(l,i,o){if(!Qh(l)||!Qh(i))return NaN;let h=0,p=0;return l[2]<i[0]&&(h=i[0]-l[2]),l[0]>i[2]&&(h=l[0]-i[2]),l[1]>i[3]&&(p=l[1]-i[3]),l[3]<i[1]&&(p=i[1]-l[3]),o.distance([0,0],[h,p])}function ko(l,i,o){const h=o.pointOnLine(i,l);return o.distance(l,h.point)}function ed(l,i,o,h,p){const g=Math.min(ko(l,[o,h],p),ko(i,[o,h],p)),y=Math.min(ko(o,[l,i],p),ko(h,[l,i],p));return Math.min(g,y)}function i0(l,i,o,h,p){if(!yn(i,l.length)||!yn(h,o.length))return 1/0;let g=1/0;for(let y=i[0];y<i[1];++y){const x=l[y],A=l[y+1];for(let E=h[0];E<h[1];++E){const M=o[E],P=o[E+1];if(bl(x,A,M,P))return 0;g=Math.min(g,ed(x,A,M,P,p))}}return g}function Xe(l,i,o,h,p){if(!yn(i,l.length)||!yn(h,o.length))return NaN;let g=1/0;for(let y=i[0];y<=i[1];++y)for(let x=h[0];x<=h[1];++x)if(g=Math.min(g,p.distance(l[y],o[x])),g===0)return g;return g}function s0(l,i,o){if(Ia(l,i,!0))return 0;let h=1/0;for(const p of i){const g=p[0],y=p[p.length-1];if(g!==y&&(h=Math.min(h,ko(l,[y,g],o)),h===0))return h;const x=o.pointOnLine(p,l);if(h=Math.min(h,o.distance(l,x.point)),h===0)return h}return h}function n0(l,i,o,h){if(!yn(i,l.length))return NaN;for(let g=i[0];g<=i[1];++g)if(Ia(l[g],o,!0))return 0;let p=1/0;for(let g=i[0];g<i[1];++g){const y=l[g],x=l[g+1];for(const A of o)for(let E=0,M=A.length,P=M-1;E<M;P=E++){const F=A[P],O=A[E];if(bl(y,x,F,O))return 0;p=Math.min(p,ed(y,x,F,O,h))}}return p}function Np(l,i){for(const o of l)for(const h of o)if(Ia(h,i,!0))return!0;return!1}function o0(l,i,o,h=1/0){const p=Jh(l),g=Jh(i);if(h!==1/0&&td(p,g,o)>=h)return h;if(po(p,g)){if(Np(l,i))return 0}else if(Np(i,l))return 0;let y=1/0;for(const x of l)for(let A=0,E=x.length,M=E-1;A<E;M=A++){const P=x[M],F=x[A];for(const O of i)for(let N=0,z=O.length,H=z-1;N<z;H=N++){const q=O[H],ct=O[N];if(bl(P,F,q,ct))return 0;y=Math.min(y,ed(P,F,q,ct,o))}}return y}function Lp(l,i,o,h,p,g){if(!g)return;const y=td(Kh(h,g),p,o);y<i&&l.push([y,g,[0,0]])}function Kc(l,i,o,h,p,g,y){if(!g||!y)return;const x=td(Kh(h,g),Kh(p,y),o);x<i&&l.push([x,g,y])}function Jc(l,i,o,h,p=1/0){let g=Math.min(h.distance(l[0],o[0][0]),p);if(g===0)return g;const y=new Dp([[0,[0,l.length-1],[0,0]]],kp),x=Jh(o);for(;y.length>0;){const A=y.pop();if(A[0]>=g)continue;const E=A[1],M=i?50:100;if(wl(E)<=M){if(!yn(E,l.length))return NaN;if(i){const P=n0(l,E,o,h);if(isNaN(P)||P===0)return P;g=Math.min(g,P)}else for(let P=E[0];P<=E[1];++P){const F=s0(l[P],o,h);if(g=Math.min(g,F),g===0)return 0}}else{const P=Yh(E,i);Lp(y,g,h,l,x,P[0]),Lp(y,g,h,l,x,P[1])}}return g}function Qc(l,i,o,h,p,g=1/0){let y=Math.min(g,p.distance(l[0],o[0]));if(y===0)return y;const x=new Dp([[0,[0,l.length-1],[0,o.length-1]]],kp);for(;x.length>0;){const A=x.pop();if(A[0]>=y)continue;const E=A[1],M=A[2],P=i?50:100,F=h?50:100;if(wl(E)<=P&&wl(M)<=F){if(!yn(E,l.length)&&yn(M,o.length))return NaN;let O;if(i&&h)O=i0(l,E,o,M,p),y=Math.min(y,O);else if(i&&!h){const N=l.slice(E[0],E[1]+1);for(let z=M[0];z<=M[1];++z)if(O=ko(o[z],N,p),y=Math.min(y,O),y===0)return y}else if(!i&&h){const N=o.slice(M[0],M[1]+1);for(let z=E[0];z<=E[1];++z)if(O=ko(l[z],N,p),y=Math.min(y,O),y===0)return y}else O=Xe(l,E,o,M,p),y=Math.min(y,O)}else{const O=Yh(E,i),N=Yh(M,h);Kc(x,y,p,l,o,O[0],N[0]),Kc(x,y,p,l,o,O[0],N[1]),Kc(x,y,p,l,o,O[1],N[0]),Kc(x,y,p,l,o,O[1],N[1])}}return y}function rd(l){return l.type==="MultiPolygon"?l.coordinates.map((i=>({type:"Polygon",coordinates:i}))):l.type==="MultiLineString"?l.coordinates.map((i=>({type:"LineString",coordinates:i}))):l.type==="MultiPoint"?l.coordinates.map((i=>({type:"Point",coordinates:i}))):[l]}class No{constructor(i,o){this.type=Xt,this.geojson=i,this.geometries=o}static parse(i,o){if(i.length!==2)return o.error(`'distance' expression requires exactly one argument, but found ${i.length-1} instead.`);if(ho(i[1])){const h=i[1];if(h.type==="FeatureCollection")return new No(h,h.features.map((p=>rd(p.geometry))).flat());if(h.type==="Feature")return new No(h,rd(h.geometry));if("type"in h&&"coordinates"in h)return new No(h,rd(h))}return o.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(i){if(i.geometry()!=null&&i.canonicalID()!=null){if(i.geometryType()==="Point")return(function(o,h){const p=o.geometry(),g=p.flat().map((A=>Hh([A.x,A.y],o.canonical)));if(p.length===0)return NaN;const y=new Zh(g[0][1]);let x=1/0;for(const A of h){switch(A.type){case"Point":x=Math.min(x,Qc(g,!1,[A.coordinates],!1,y,x));break;case"LineString":x=Math.min(x,Qc(g,!1,A.coordinates,!0,y,x));break;case"Polygon":x=Math.min(x,Jc(g,!1,A.coordinates,y,x))}if(x===0)return x}return x})(i,this.geometries);if(i.geometryType()==="LineString")return(function(o,h){const p=o.geometry(),g=p.flat().map((A=>Hh([A.x,A.y],o.canonical)));if(p.length===0)return NaN;const y=new Zh(g[0][1]);let x=1/0;for(const A of h){switch(A.type){case"Point":x=Math.min(x,Qc(g,!0,[A.coordinates],!1,y,x));break;case"LineString":x=Math.min(x,Qc(g,!0,A.coordinates,!0,y,x));break;case"Polygon":x=Math.min(x,Jc(g,!0,A.coordinates,y,x))}if(x===0)return x}return x})(i,this.geometries);if(i.geometryType()==="Polygon")return(function(o,h){const p=o.geometry();if(p.length===0||p[0].length===0)return NaN;const g=xl(p,0).map((A=>A.map((E=>E.map((M=>Hh([M.x,M.y],o.canonical))))))),y=new Zh(g[0][0][0][1]);let x=1/0;for(const A of h)for(const E of g){switch(A.type){case"Point":x=Math.min(x,Jc([A.coordinates],!1,E,y,x));break;case"LineString":x=Math.min(x,Jc(A.coordinates,!0,E,y,x));break;case"Polygon":x=Math.min(x,o0(E,A.coordinates,y,x))}if(x===0)return x}return x})(i,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}class Tl{constructor(i){this.type=we,this.key=i}static parse(i,o){if(i.length!==2)return o.error(`Expected 1 argument, but found ${i.length-1} instead.`);const h=i[1];return h==null?o.error("Global state property must be defined."):typeof h!="string"?o.error(`Global state property must be string, but found ${typeof i[1]} instead.`):new Tl(h)}evaluate(i){var o;const h=(o=i.globals)===null||o===void 0?void 0:o.globalState;return h&&Object.keys(h).length!==0?Y(h,this.key):null}eachChild(){}outputDefined(){return!1}}const Ma={"==":$c,"!=":Vh,">":Cp,"<":Ky,">=":Xc,"<=":Wc,array:es,at:Xs,boolean:es,case:_l,coalesce:Ca,collator:rs,format:Fo,image:jh,in:pl,"index-of":Do,interpolate:Si,"interpolate-hcl":Si,"interpolate-lab":Si,length:ml,let:Ne,literal:fo,match:jc,number:es,"number-format":qc,object:es,slice:gl,step:Sa,string:es,"to-boolean":_n,"to-color":_n,"to-number":_n,"to-string":_n,var:Ea,within:Oo,distance:No,"global-state":Tl};class Ts{constructor(i,o,h,p){this.name=i,this.type=o,this._evaluate=h,this.args=p}evaluate(i){return this._evaluate(i,this.args)}eachChild(i){this.args.forEach(i)}outputDefined(){return!1}static parse(i,o){const h=i[0],p=Ts.definitions[h];if(!p)return o.error(`Unknown expression "${h}". If you wanted a literal array, use ["literal", [...]].`,0);const g=Array.isArray(p)?p[0]:p.type,y=Array.isArray(p)?[[p[1],p[2]]]:p.overloads,x=y.filter((([E])=>!Array.isArray(E)||E.length===i.length-1));let A=null;for(const[E,M]of x){A=new Aa(o.registry,tu,o.path,null,o.scope);const P=[];let F=!1;for(let O=1;O<i.length;O++){const N=i[O],z=Array.isArray(E)?E[O-1]:E.type,H=A.parse(N,1+P.length,z);if(!H){F=!0;break}P.push(H)}if(!F)if(Array.isArray(E)&&E.length!==P.length)A.error(`Expected ${E.length} arguments, but found ${P.length} instead.`);else{for(let O=0;O<P.length;O++){const N=Array.isArray(E)?E[O]:E.type,z=P[O];A.concat(O+1).checkSubtype(N,z.type)}if(A.errors.length===0)return new Ts(h,g,M,P)}}if(x.length===1)o.errors.push(...A.errors);else{const E=(x.length?x:y).map((([P])=>{return F=P,Array.isArray(F)?`(${F.map(Ue).join(", ")})`:`(${Ue(F.type)}...)`;var F})).join(" | "),M=[];for(let P=1;P<i.length;P++){const F=o.parse(i[P],1+M.length);if(!F)return null;M.push(Ue(F.type))}o.error(`Expected arguments of type ${E}, but found (${M.join(", ")}) instead.`)}return null}static register(i,o){Ts.definitions=o;for(const h in o)i[h]=Ts}}function Up(l,[i,o,h,p]){i=i.evaluate(l),o=o.evaluate(l),h=h.evaluate(l);const g=p?p.evaluate(l):1,y=Tp(i,o,h,g);if(y)throw new dr(y);return new Te(i/255,o/255,h/255,g,!1)}function zp(l,i){return l in i}function id(l,i){const o=i[l];return o===void 0?null:o}function Lo(l){return{type:l}}function tu(l){if(l instanceof Ea)return tu(l.boundExpression);if(l instanceof Ts&&l.name==="error"||l instanceof rs||l instanceof Oo||l instanceof No||l instanceof Tl)return!1;const i=l instanceof _n||l instanceof es;let o=!0;return l.eachChild((h=>{o=i?o&&tu(h):o&&h instanceof fo})),!!o&&eu(l)&&ru(l,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"])}function eu(l){if(l instanceof Ts&&(l.name==="get"&&l.args.length===1||l.name==="feature-state"||l.name==="has"&&l.args.length===1||l.name==="properties"||l.name==="geometry-type"||l.name==="id"||/^filter-/.test(l.name))||l instanceof Oo||l instanceof No)return!1;let i=!0;return l.eachChild((o=>{i&&!eu(o)&&(i=!1)})),i}function Al(l){if(l instanceof Ts&&l.name==="feature-state")return!1;let i=!0;return l.eachChild((o=>{i&&!Al(o)&&(i=!1)})),i}function ru(l,i){if(l instanceof Ts&&i.indexOf(l.name)>=0)return!1;let o=!0;return l.eachChild((h=>{o&&!ru(h,i)&&(o=!1)})),o}function Vp(l){return{result:"success",value:l}}function Ra(l){return{result:"error",value:l}}function Pa(l){return l["property-type"]==="data-driven"||l["property-type"]==="cross-faded-data-driven"}function jp(l){return!!l.expression&&l.expression.parameters.indexOf("zoom")>-1}function sd(l){return!!l.expression&&l.expression.interpolated}function Oe(l){return l instanceof Number?"number":l instanceof String?"string":l instanceof Boolean?"boolean":Array.isArray(l)?"array":l===null?"null":typeof l}function iu(l){return typeof l=="object"&&l!==null&&!Array.isArray(l)&&br(l)===mr}function a0(l){return l}function Hp(l,i){const o=l.stops&&typeof l.stops[0][0]=="object",h=o||!(o||l.property!==void 0),p=l.type||(sd(i)?"exponential":"interval"),g=(function(M){switch(M.type){case"color":return Te.parse;case"padding":return Oi.parse;case"numberArray":return ki.parse;case"colorArray":return ri.parse;default:return null}})(i);if(g&&((l=Qe({},l)).stops&&(l.stops=l.stops.map((M=>[M[0],g(M[1])]))),l.default=g(l.default?l.default:i.default)),l.colorSpace&&(y=l.colorSpace)!=="rgb"&&y!=="hcl"&&y!=="lab")throw new Error(`Unknown color space: "${l.colorSpace}"`);var y;const x=(function(M){switch(M){case"exponential":return Gp;case"interval":return l0;case"categorical":return nd;case"identity":return c0;default:throw new Error(`Unknown function type "${M}"`)}})(p);let A,E;if(p==="categorical"){A=Object.create(null);for(const M of l.stops)A[M[0]]=M[1];E=typeof l.stops[0][0]}if(o){const M={},P=[];for(let N=0;N<l.stops.length;N++){const z=l.stops[N],H=z[0].zoom;M[H]===void 0&&(M[H]={zoom:H,type:l.type,property:l.property,default:l.default,stops:[]},P.push(H)),M[H].stops.push([z[0].value,z[1]])}const F=[];for(const N of P)F.push([M[N].zoom,Hp(M[N],i)]);const O={name:"linear"};return{kind:"composite",interpolationType:O,interpolationFactor:Si.interpolationFactor.bind(void 0,O),zoomStops:F.map((N=>N[0])),evaluate:({zoom:N},z)=>Gp({stops:F,base:l.base},i,N).evaluate(N,z)}}if(h){const M=p==="exponential"?{name:"exponential",base:l.base!==void 0?l.base:1}:null;return{kind:"camera",interpolationType:M,interpolationFactor:Si.interpolationFactor.bind(void 0,M),zoomStops:l.stops.map((P=>P[0])),evaluate:({zoom:P})=>x(l,i,P,A,E)}}return{kind:"source",evaluate(M,P){const F=P&&P.properties?P.properties[l.property]:void 0;return F===void 0?El(l.default,i.default):x(l,i,F,A,E)}}}function El(l,i,o){return l!==void 0?l:i!==void 0?i:o!==void 0?o:void 0}function nd(l,i,o,h,p){return El(typeof o===p?h[o]:void 0,l.default,i.default)}function l0(l,i,o){if(Oe(o)!=="number")return El(l.default,i.default);const h=l.stops.length;if(h===1||o<=l.stops[0][0])return l.stops[0][1];if(o>=l.stops[h-1][0])return l.stops[h-1][1];const p=Hc(l.stops.map((g=>g[0])),o);return l.stops[p][1]}function Gp(l,i,o){const h=l.base!==void 0?l.base:1;if(Oe(o)!=="number")return El(l.default,i.default);const p=l.stops.length;if(p===1||o<=l.stops[0][0])return l.stops[0][1];if(o>=l.stops[p-1][0])return l.stops[p-1][1];const g=Hc(l.stops.map((M=>M[0])),o),y=(function(M,P,F,O){const N=O-F,z=M-F;return N===0?0:P===1?z/N:(Math.pow(P,z)-1)/(Math.pow(P,N)-1)})(o,h,l.stops[g][0],l.stops[g+1][0]),x=l.stops[g][1],A=l.stops[g+1][1],E=qs[i.type]||a0;return typeof x.evaluate=="function"?{evaluate(...M){const P=x.evaluate.apply(void 0,M),F=A.evaluate.apply(void 0,M);if(P!==void 0&&F!==void 0)return E(P,F,y,l.colorSpace)}}:E(x,A,y,l.colorSpace)}function c0(l,i,o){switch(i.type){case"color":o=Te.parse(o);break;case"formatted":o=Yr.fromString(o.toString());break;case"resolvedImage":o=ts.fromString(o.toString());break;case"padding":o=Oi.parse(o);break;case"colorArray":o=ri.parse(o);break;case"numberArray":o=ki.parse(o);break;default:Oe(o)===i.type||i.type==="enum"&&i.values[o]||(o=void 0)}return El(o,l.default,i.default)}Ts.register(Ma,{error:[{kind:"error"},[ue],(l,[i])=>{throw new dr(i.evaluate(l))}],typeof:[ue,[we],(l,[i])=>Ue(br(i.evaluate(l)))],"to-rgba":[Zr(Xt,4),[Ai],(l,[i])=>{const[o,h,p,g]=i.evaluate(l).rgb;return[255*o,255*h,255*p,g]}],rgb:[Ai,[Xt,Xt,Xt],Up],rgba:[Ai,[Xt,Xt,Xt,Xt],Up],has:{type:ve,overloads:[[[ue],(l,[i])=>zp(i.evaluate(l),l.properties())],[[ue,mr],(l,[i,o])=>zp(i.evaluate(l),o.evaluate(l))]]},get:{type:we,overloads:[[[ue],(l,[i])=>id(i.evaluate(l),l.properties())],[[ue,mr],(l,[i,o])=>id(i.evaluate(l),o.evaluate(l))]]},"feature-state":[we,[ue],(l,[i])=>id(i.evaluate(l),l.featureState||{})],properties:[mr,[],l=>l.properties()],"geometry-type":[ue,[],l=>l.geometryType()],id:[we,[],l=>l.id()],zoom:[Xt,[],l=>l.globals.zoom],"heatmap-density":[Xt,[],l=>l.globals.heatmapDensity||0],elevation:[Xt,[],l=>l.globals.elevation||0],"line-progress":[Xt,[],l=>l.globals.lineProgress||0],accumulated:[we,[],l=>l.globals.accumulated===void 0?null:l.globals.accumulated],"+":[Xt,Lo(Xt),(l,i)=>{let o=0;for(const h of i)o+=h.evaluate(l);return o}],"*":[Xt,Lo(Xt),(l,i)=>{let o=1;for(const h of i)o*=h.evaluate(l);return o}],"-":{type:Xt,overloads:[[[Xt,Xt],(l,[i,o])=>i.evaluate(l)-o.evaluate(l)],[[Xt],(l,[i])=>-i.evaluate(l)]]},"/":[Xt,[Xt,Xt],(l,[i,o])=>i.evaluate(l)/o.evaluate(l)],"%":[Xt,[Xt,Xt],(l,[i,o])=>i.evaluate(l)%o.evaluate(l)],ln2:[Xt,[],()=>Math.LN2],pi:[Xt,[],()=>Math.PI],e:[Xt,[],()=>Math.E],"^":[Xt,[Xt,Xt],(l,[i,o])=>Math.pow(i.evaluate(l),o.evaluate(l))],sqrt:[Xt,[Xt],(l,[i])=>Math.sqrt(i.evaluate(l))],log10:[Xt,[Xt],(l,[i])=>Math.log(i.evaluate(l))/Math.LN10],ln:[Xt,[Xt],(l,[i])=>Math.log(i.evaluate(l))],log2:[Xt,[Xt],(l,[i])=>Math.log(i.evaluate(l))/Math.LN2],sin:[Xt,[Xt],(l,[i])=>Math.sin(i.evaluate(l))],cos:[Xt,[Xt],(l,[i])=>Math.cos(i.evaluate(l))],tan:[Xt,[Xt],(l,[i])=>Math.tan(i.evaluate(l))],asin:[Xt,[Xt],(l,[i])=>Math.asin(i.evaluate(l))],acos:[Xt,[Xt],(l,[i])=>Math.acos(i.evaluate(l))],atan:[Xt,[Xt],(l,[i])=>Math.atan(i.evaluate(l))],min:[Xt,Lo(Xt),(l,i)=>Math.min(...i.map((o=>o.evaluate(l))))],max:[Xt,Lo(Xt),(l,i)=>Math.max(...i.map((o=>o.evaluate(l))))],abs:[Xt,[Xt],(l,[i])=>Math.abs(i.evaluate(l))],round:[Xt,[Xt],(l,[i])=>{const o=i.evaluate(l);return o<0?-Math.round(-o):Math.round(o)}],floor:[Xt,[Xt],(l,[i])=>Math.floor(i.evaluate(l))],ceil:[Xt,[Xt],(l,[i])=>Math.ceil(i.evaluate(l))],"filter-==":[ve,[ue,we],(l,[i,o])=>l.properties()[i.value]===o.value],"filter-id-==":[ve,[we],(l,[i])=>l.id()===i.value],"filter-type-==":[ve,[ue],(l,[i])=>l.geometryType()===i.value],"filter-<":[ve,[ue,we],(l,[i,o])=>{const h=l.properties()[i.value],p=o.value;return typeof h==typeof p&&h<p}],"filter-id-<":[ve,[we],(l,[i])=>{const o=l.id(),h=i.value;return typeof o==typeof h&&o<h}],"filter->":[ve,[ue,we],(l,[i,o])=>{const h=l.properties()[i.value],p=o.value;return typeof h==typeof p&&h>p}],"filter-id->":[ve,[we],(l,[i])=>{const o=l.id(),h=i.value;return typeof o==typeof h&&o>h}],"filter-<=":[ve,[ue,we],(l,[i,o])=>{const h=l.properties()[i.value],p=o.value;return typeof h==typeof p&&h<=p}],"filter-id-<=":[ve,[we],(l,[i])=>{const o=l.id(),h=i.value;return typeof o==typeof h&&o<=h}],"filter->=":[ve,[ue,we],(l,[i,o])=>{const h=l.properties()[i.value],p=o.value;return typeof h==typeof p&&h>=p}],"filter-id->=":[ve,[we],(l,[i])=>{const o=l.id(),h=i.value;return typeof o==typeof h&&o>=h}],"filter-has":[ve,[we],(l,[i])=>i.value in l.properties()],"filter-has-id":[ve,[],l=>l.id()!==null&&l.id()!==void 0],"filter-type-in":[ve,[Zr(ue)],(l,[i])=>i.value.indexOf(l.geometryType())>=0],"filter-id-in":[ve,[Zr(we)],(l,[i])=>i.value.indexOf(l.id())>=0],"filter-in-small":[ve,[ue,Zr(we)],(l,[i,o])=>o.value.indexOf(l.properties()[i.value])>=0],"filter-in-large":[ve,[ue,Zr(we)],(l,[i,o])=>(function(h,p,g,y){for(;g<=y;){const x=g+y>>1;if(p[x]===h)return!0;p[x]>h?y=x-1:g=x+1}return!1})(l.properties()[i.value],o.value,0,o.value.length-1)],all:{type:ve,overloads:[[[ve,ve],(l,[i,o])=>i.evaluate(l)&&o.evaluate(l)],[Lo(ve),(l,i)=>{for(const o of i)if(!o.evaluate(l))return!1;return!0}]]},any:{type:ve,overloads:[[[ve,ve],(l,[i,o])=>i.evaluate(l)||o.evaluate(l)],[Lo(ve),(l,i)=>{for(const o of i)if(o.evaluate(l))return!0;return!1}]]},"!":[ve,[ve],(l,[i])=>!i.evaluate(l)],"is-supported-script":[ve,[ue],(l,[i])=>{const o=l.globals&&l.globals.isSupportedScript;return!o||o(i.evaluate(l))}],upcase:[ue,[ue],(l,[i])=>i.evaluate(l).toUpperCase()],downcase:[ue,[ue],(l,[i])=>i.evaluate(l).toLowerCase()],concat:[ue,Lo(we),(l,i)=>i.map((o=>Ta(o.evaluate(l)))).join("")],"resolved-locale":[ue,[Hi],(l,[i])=>i.evaluate(l).resolvedLocale()]});class su{constructor(i,o,h){this.expression=i,this._warningHistory={},this._evaluator=new Be,this._defaultValue=o?(function(p){if(p.type==="color"&&iu(p.default))return new Te(0,0,0,0);switch(p.type){case"color":return Te.parse(p.default)||null;case"padding":return Oi.parse(p.default)||null;case"numberArray":return ki.parse(p.default)||null;case"colorArray":return ri.parse(p.default)||null;case"variableAnchorOffsetCollection":return $i.parse(p.default)||null;case"projectionDefinition":return Ni.parse(p.default)||null;default:return p.default===void 0?null:p.default}})(o):null,this._enumValues=o&&o.type==="enum"?o.values:null,this._globalState=h}evaluateWithoutErrorHandling(i,o,h,p,g,y){return this._globalState&&(i=Ba(i,this._globalState)),this._evaluator.globals=i,this._evaluator.feature=o,this._evaluator.featureState=h,this._evaluator.canonical=p,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=y,this.expression.evaluate(this._evaluator)}evaluate(i,o,h,p,g,y){this._globalState&&(i=Ba(i,this._globalState)),this._evaluator.globals=i,this._evaluator.feature=o||null,this._evaluator.featureState=h||null,this._evaluator.canonical=p,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=y||null;try{const x=this.expression.evaluate(this._evaluator);if(x==null||typeof x=="number"&&x!=x)return this._defaultValue;if(this._enumValues&&!(x in this._enumValues))throw new dr(`Expected value to be one of ${Object.keys(this._enumValues).map((A=>JSON.stringify(A))).join(", ")}, but found ${JSON.stringify(x)} instead.`);return x}catch(x){return this._warningHistory[x.message]||(this._warningHistory[x.message]=!0,typeof console<"u"&&console.warn(x.message)),this._defaultValue}}}function nu(l){return Array.isArray(l)&&l.length>0&&typeof l[0]=="string"&&l[0]in Ma}function ou(l,i,o){const h=new Aa(Ma,tu,[],i?(function(g){const y={color:Ai,string:ue,number:Xt,enum:ue,boolean:ve,formatted:zs,padding:pn,numberArray:On,colorArray:cs,projectionDefinition:Us,resolvedImage:Vs,variableAnchorOffsetCollection:ei};return g.type==="array"?Zr(y[g.value]||we,g.length):y[g.type]})(i):void 0),p=h.parse(l,void 0,void 0,void 0,i&&i.type==="string"?{typeAnnotation:"coerce"}:void 0);return p?Vp(new su(p,i,o)):Ra(h.errors)}class Uo{constructor(i,o,h){this.kind=i,this._styleExpression=o,this.isStateDependent=i!=="constant"&&!Al(o.expression),this.globalStateRefs=uu(o.expression),this._globalState=h}evaluateWithoutErrorHandling(i,o,h,p,g,y){return this._globalState&&(i=Ba(i,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(i,o,h,p,g,y)}evaluate(i,o,h,p,g,y){return this._globalState&&(i=Ba(i,this._globalState)),this._styleExpression.evaluate(i,o,h,p,g,y)}}class au{constructor(i,o,h,p,g){this.kind=i,this.zoomStops=h,this._styleExpression=o,this.isStateDependent=i!=="camera"&&!Al(o.expression),this.globalStateRefs=uu(o.expression),this.interpolationType=p,this._globalState=g}evaluateWithoutErrorHandling(i,o,h,p,g,y){return this._globalState&&(i=Ba(i,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(i,o,h,p,g,y)}evaluate(i,o,h,p,g,y){return this._globalState&&(i=Ba(i,this._globalState)),this._styleExpression.evaluate(i,o,h,p,g,y)}interpolationFactor(i,o,h){return this.interpolationType?Si.interpolationFactor(this.interpolationType,i,o,h):0}}function $p(l,i,o){const h=ou(l,i,o);if(h.result==="error")return h;const p=h.value.expression,g=eu(p);if(!g&&!Pa(i))return Ra([new ir("","data expressions not supported")]);const y=ru(p,["zoom"]);if(!y&&!jp(i))return Ra([new ir("","zoom expressions not supported")]);const x=cu(p);return x||y?x instanceof ir?Ra([x]):x instanceof Si&&!sd(i)?Ra([new ir("",'"interpolate" expressions cannot be used with this property')]):Vp(x?new au(g?"camera":"composite",h.value,x.labels,x instanceof Si?x.interpolation:void 0,o):new Uo(g?"constant":"source",h.value,o)):Ra([new ir("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class lu{constructor(i,o){this._parameters=i,this._specification=o,Qe(this,Hp(this._parameters,this._specification))}static deserialize(i){return new lu(i._parameters,i._specification)}static serialize(i){return{_parameters:i._parameters,_specification:i._specification}}}function cu(l){let i=null;if(l instanceof Ne)i=cu(l.result);else if(l instanceof Ca){for(const o of l.args)if(i=cu(o),i)break}else(l instanceof Sa||l instanceof Si)&&l.input instanceof Ts&&l.input.name==="zoom"&&(i=l);return i instanceof ir||l.eachChild((o=>{const h=cu(o);h instanceof ir?i=h:!i&&h?i=new ir("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):i&&h&&i!==h&&(i=new ir("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),i}function uu(l,i=new Set){return l instanceof Tl&&i.add(l.key),l.eachChild((o=>{uu(o,i)})),i}function Ba(l,i){const{zoom:o,heatmapDensity:h,elevation:p,lineProgress:g,isSupportedScript:y,accumulated:x}=l??{};return{zoom:o,heatmapDensity:h,elevation:p,lineProgress:g,isSupportedScript:y,accumulated:x,globalState:i}}function hu(l){if(l===!0||l===!1)return!0;if(!Array.isArray(l)||l.length===0)return!1;switch(l[0]){case"has":return l.length>=2&&l[1]!=="$id"&&l[1]!=="$type";case"in":return l.length>=3&&(typeof l[1]!="string"||Array.isArray(l[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return l.length!==3||Array.isArray(l[1])||Array.isArray(l[2]);case"any":case"all":for(const i of l.slice(1))if(!hu(i)&&typeof i!="boolean")return!1;return!0;default:return!0}}const Wp={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Sl(l,i){if(l==null)return{filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set};hu(l)||(l=Cl(l));const o=ou(l,Wp,i);if(o.result==="error")throw new Error(o.value.map((h=>`${h.key}: ${h.message}`)).join(", "));return{filter:(h,p,g)=>o.value.evaluate(h,p,{},g),needGeometry:od(l),getGlobalStateRefs:()=>uu(o.value.expression)}}function u0(l,i){return l<i?-1:l>i?1:0}function od(l){if(!Array.isArray(l))return!1;if(l[0]==="within"||l[0]==="distance")return!0;for(let i=1;i<l.length;i++)if(od(l[i]))return!0;return!1}function Cl(l){if(!l)return!0;const i=l[0];return l.length<=1?i!=="any":i==="=="?du(l[1],l[2],"=="):i==="!="?fu(du(l[1],l[2],"==")):i==="<"||i===">"||i==="<="||i===">="?du(l[1],l[2],i):i==="any"?(o=l.slice(1),["any"].concat(o.map(Cl))):i==="all"?["all"].concat(l.slice(1).map(Cl)):i==="none"?["all"].concat(l.slice(1).map(Cl).map(fu)):i==="in"?Xp(l[1],l.slice(2)):i==="!in"?fu(Xp(l[1],l.slice(2))):i==="has"?qp(l[1]):i!=="!has"||fu(qp(l[1]));var o}function du(l,i,o){switch(l){case"$type":return[`filter-type-${o}`,i];case"$id":return[`filter-id-${o}`,i];default:return[`filter-${o}`,l,i]}}function Xp(l,i){if(i.length===0)return!1;switch(l){case"$type":return["filter-type-in",["literal",i]];case"$id":return["filter-id-in",["literal",i]];default:return i.length>200&&!i.some((o=>typeof o!=typeof i[0]))?["filter-in-large",l,["literal",i.sort(u0)]]:["filter-in-small",l,["literal",i]]}}function qp(l){switch(l){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",l]}}function fu(l){return["!",l]}function ad(l){const i=typeof l;if(i==="number"||i==="boolean"||i==="string"||l==null)return JSON.stringify(l);if(Array.isArray(l)){let p="[";for(const g of l)p+=`${ad(g)},`;return`${p}]`}const o=Object.keys(l).sort();let h="{";for(let p=0;p<o.length;p++)h+=`${JSON.stringify(o[p])}:${ad(l[o[p]])},`;return`${h}}`}function Zp(l){let i="";for(const o of xt)i+=`/${ad(l[o])}`;return i}function ld(l){const i=l.value;return i?[new Wt(l.key,i,"constants have been deprecated as of v8")]:[]}function Pr(l){return l instanceof Number||l instanceof String||l instanceof Boolean?l.valueOf():l}function kn(l){if(Array.isArray(l))return l.map(kn);if(l instanceof Object&&!(l instanceof Number||l instanceof String||l instanceof Boolean)){const i={};for(const o in l)i[o]=kn(l[o]);return i}return Pr(l)}function is(l){const i=l.key,o=l.value,h=l.valueSpec||{},p=l.objectElementValidators||{},g=l.style,y=l.styleSpec,x=l.validateSpec;let A=[];const E=Oe(o);if(E!=="object")return[new Wt(i,o,`object expected, ${E} found`)];for(const M in o){const P=M.split(".")[0],F=Y(h,P)||h["*"];let O;if(Y(p,P))O=p[P];else if(Y(h,P))O=x;else if(p["*"])O=p["*"];else{if(!h["*"]){A.push(new Wt(i,o[M],`unknown property "${M}"`));continue}O=x}A=A.concat(O({key:(i&&`${i}.`)+M,value:o[M],valueSpec:F,style:g,styleSpec:y,object:o,objectKey:M,validateSpec:x},o))}for(const M in h)p[M]||h[M].required&&h[M].default===void 0&&o[M]===void 0&&A.push(new Wt(i,o,`missing required property "${M}"`));return A}function Il(l){const i=l.value,o=l.valueSpec,h=l.style,p=l.styleSpec,g=l.key,y=l.arrayElementValidator||l.validateSpec;if(Oe(i)!=="array")return[new Wt(g,i,`array expected, ${Oe(i)} found`)];if(o.length&&i.length!==o.length)return[new Wt(g,i,`array length ${o.length} expected, length ${i.length} found`)];if(o["min-length"]&&i.length<o["min-length"])return[new Wt(g,i,`array length at least ${o["min-length"]} expected, length ${i.length} found`)];let x={type:o.value,values:o.values};p.$version<7&&(x.function=o.function),Oe(o.value)==="object"&&(x=o.value);let A=[];for(let E=0;E<i.length;E++)A=A.concat(y({array:i,arrayIndex:E,value:i[E],valueSpec:x,validateSpec:l.validateSpec,style:h,styleSpec:p,key:`${g}[${E}]`}));return A}function zo(l){const i=l.key,o=l.value,h=l.valueSpec;let p=Oe(o);return p==="number"&&o!=o&&(p="NaN"),p!=="number"?[new Wt(i,o,`number expected, ${p} found`)]:"minimum"in h&&o<h.minimum?[new Wt(i,o,`${o} is less than the minimum value ${h.minimum}`)]:"maximum"in h&&o>h.maximum?[new Wt(i,o,`${o} is greater than the maximum value ${h.maximum}`)]:[]}function Yp(l){const i=l.valueSpec,o=Pr(l.value.type);let h,p,g,y={};const x=o!=="categorical"&&l.value.property===void 0,A=!x,E=Oe(l.value.stops)==="array"&&Oe(l.value.stops[0])==="array"&&Oe(l.value.stops[0][0])==="object",M=is({key:l.key,value:l.value,valueSpec:l.styleSpec.function,validateSpec:l.validateSpec,style:l.style,styleSpec:l.styleSpec,objectElementValidators:{stops:function(O){if(o==="identity")return[new Wt(O.key,O.value,'identity function may not have a "stops" property')];let N=[];const z=O.value;return N=N.concat(Il({key:O.key,value:z,valueSpec:O.valueSpec,validateSpec:O.validateSpec,style:O.style,styleSpec:O.styleSpec,arrayElementValidator:P})),Oe(z)==="array"&&z.length===0&&N.push(new Wt(O.key,z,"array must have at least one stop")),N},default:function(O){return O.validateSpec({key:O.key,value:O.value,valueSpec:i,validateSpec:O.validateSpec,style:O.style,styleSpec:O.styleSpec})}}});return o==="identity"&&x&&M.push(new Wt(l.key,l.value,'missing required property "property"')),o==="identity"||l.value.stops||M.push(new Wt(l.key,l.value,'missing required property "stops"')),o==="exponential"&&l.valueSpec.expression&&!sd(l.valueSpec)&&M.push(new Wt(l.key,l.value,"exponential functions not supported")),l.styleSpec.$version>=8&&(A&&!Pa(l.valueSpec)?M.push(new Wt(l.key,l.value,"property functions not supported")):x&&!jp(l.valueSpec)&&M.push(new Wt(l.key,l.value,"zoom functions not supported"))),o!=="categorical"&&!E||l.value.property!==void 0||M.push(new Wt(l.key,l.value,'"property" property is required')),M;function P(O){let N=[];const z=O.value,H=O.key;if(Oe(z)!=="array")return[new Wt(H,z,`array expected, ${Oe(z)} found`)];if(z.length!==2)return[new Wt(H,z,`array length 2 expected, length ${z.length} found`)];if(E){if(Oe(z[0])!=="object")return[new Wt(H,z,`object expected, ${Oe(z[0])} found`)];if(z[0].zoom===void 0)return[new Wt(H,z,"object stop key must have zoom")];if(z[0].value===void 0)return[new Wt(H,z,"object stop key must have value")];if(g&&g>Pr(z[0].zoom))return[new Wt(H,z[0].zoom,"stop zoom values must appear in ascending order")];Pr(z[0].zoom)!==g&&(g=Pr(z[0].zoom),p=void 0,y={}),N=N.concat(is({key:`${H}[0]`,value:z[0],valueSpec:{zoom:{}},validateSpec:O.validateSpec,style:O.style,styleSpec:O.styleSpec,objectElementValidators:{zoom:zo,value:F}}))}else N=N.concat(F({key:`${H}[0]`,value:z[0],validateSpec:O.validateSpec,style:O.style,styleSpec:O.styleSpec},z));return nu(kn(z[1]))?N.concat([new Wt(`${H}[1]`,z[1],"expressions are not allowed in function stops.")]):N.concat(O.validateSpec({key:`${H}[1]`,value:z[1],valueSpec:i,validateSpec:O.validateSpec,style:O.style,styleSpec:O.styleSpec}))}function F(O,N){const z=Oe(O.value),H=Pr(O.value),q=O.value!==null?O.value:N;if(h){if(z!==h)return[new Wt(O.key,q,`${z} stop domain type must match previous stop domain type ${h}`)]}else h=z;if(z!=="number"&&z!=="string"&&z!=="boolean")return[new Wt(O.key,q,"stop domain value must be a number, string, or boolean")];if(z!=="number"&&o!=="categorical"){let ct=`number expected, ${z} found`;return Pa(i)&&o===void 0&&(ct+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Wt(O.key,q,ct)]}return o!=="categorical"||z!=="number"||isFinite(H)&&Math.floor(H)===H?o!=="categorical"&&z==="number"&&p!==void 0&&H<p?[new Wt(O.key,q,"stop domain values must appear in ascending order")]:(p=H,o==="categorical"&&H in y?[new Wt(O.key,q,"stop domain values must be unique")]:(y[H]=!0,[])):[new Wt(O.key,q,`integer expected, found ${H}`)]}}function Da(l){const i=(l.expressionContext==="property"?$p:ou)(kn(l.value),l.valueSpec);if(i.result==="error")return i.value.map((h=>new Wt(`${l.key}${h.key}`,l.value,h.message)));const o=i.value.expression||i.value._styleExpression.expression;if(l.expressionContext==="property"&&l.propertyKey==="text-font"&&!o.outputDefined())return[new Wt(l.key,l.value,`Invalid data expression for "${l.propertyKey}". Output values must be contained as literals within the expression.`)];if(l.expressionContext==="property"&&l.propertyType==="layout"&&!Al(o))return[new Wt(l.key,l.value,'"feature-state" data expressions are not supported with layout properties.')];if(l.expressionContext==="filter"&&!Al(o))return[new Wt(l.key,l.value,'"feature-state" data expressions are not supported with filters.')];if(l.expressionContext&&l.expressionContext.indexOf("cluster")===0){if(!ru(o,["zoom","feature-state"]))return[new Wt(l.key,l.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(l.expressionContext==="cluster-initial"&&!eu(o))return[new Wt(l.key,l.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function cd(l){const i=l.key,o=l.value,h=Oe(o);return h!=="string"?[new Wt(i,o,`color expected, ${h} found`)]:Te.parse(String(o))?[]:[new Wt(i,o,`color expected, "${o}" found`)]}function Ml(l){const i=l.key,o=l.value,h=l.valueSpec,p=[];return Array.isArray(h.values)?h.values.indexOf(Pr(o))===-1&&p.push(new Wt(i,o,`expected one of [${h.values.join(", ")}], ${JSON.stringify(o)} found`)):Object.keys(h.values).indexOf(Pr(o))===-1&&p.push(new Wt(i,o,`expected one of [${Object.keys(h.values).join(", ")}], ${JSON.stringify(o)} found`)),p}function ud(l){return hu(kn(l.value))?Da(Qe({},l,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Kp(l)}function Kp(l){const i=l.value,o=l.key;if(Oe(i)!=="array")return[new Wt(o,i,`array expected, ${Oe(i)} found`)];const h=l.styleSpec;let p,g=[];if(i.length<1)return[new Wt(o,i,"filter array must have at least 1 element")];switch(g=g.concat(Ml({key:`${o}[0]`,value:i[0],valueSpec:h.filter_operator,style:l.style,styleSpec:l.styleSpec})),Pr(i[0])){case"<":case"<=":case">":case">=":i.length>=2&&Pr(i[1])==="$type"&&g.push(new Wt(o,i,`"$type" cannot be use with operator "${i[0]}"`));case"==":case"!=":i.length!==3&&g.push(new Wt(o,i,`filter array for operator "${i[0]}" must have 3 elements`));case"in":case"!in":i.length>=2&&(p=Oe(i[1]),p!=="string"&&g.push(new Wt(`${o}[1]`,i[1],`string expected, ${p} found`)));for(let y=2;y<i.length;y++)p=Oe(i[y]),Pr(i[1])==="$type"?g=g.concat(Ml({key:`${o}[${y}]`,value:i[y],valueSpec:h.geometry_type,style:l.style,styleSpec:l.styleSpec})):p!=="string"&&p!=="number"&&p!=="boolean"&&g.push(new Wt(`${o}[${y}]`,i[y],`string, number, or boolean expected, ${p} found`));break;case"any":case"all":case"none":for(let y=1;y<i.length;y++)g=g.concat(Kp({key:`${o}[${y}]`,value:i[y],style:l.style,styleSpec:l.styleSpec}));break;case"has":case"!has":p=Oe(i[1]),i.length!==2?g.push(new Wt(o,i,`filter array for "${i[0]}" operator must have 2 elements`)):p!=="string"&&g.push(new Wt(`${o}[1]`,i[1],`string expected, ${p} found`))}return g}function hd(l,i){const o=l.key,h=l.validateSpec,p=l.style,g=l.styleSpec,y=l.value,x=l.objectKey,A=g[`${i}_${l.layerType}`];if(!A)return[];const E=x.match(/^(.*)-transition$/);if(i==="paint"&&E&&A[E[1]]&&A[E[1]].transition)return h({key:o,value:y,valueSpec:g.transition,style:p,styleSpec:g});const M=l.valueSpec||A[x];if(!M)return[new Wt(o,y,`unknown property "${x}"`)];let P;if(Oe(y)==="string"&&Pa(M)&&!M.tokens&&(P=/^{([^}]+)}$/.exec(y)))return[new Wt(o,y,`"${x}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(P[1])} }\`.`)];const F=[];return l.layerType==="symbol"&&x==="text-font"&&iu(kn(y))&&Pr(y.type)==="identity"&&F.push(new Wt(o,y,'"text-font" does not support identity functions')),F.concat(h({key:l.key,value:y,valueSpec:M,style:p,styleSpec:g,expressionContext:"property",propertyType:i,propertyKey:x}))}function dd(l){return hd(l,"paint")}function Rl(l){return hd(l,"layout")}function Jp(l){let i=[];const o=l.value,h=l.key,p=l.style,g=l.styleSpec;if(Oe(o)!=="object")return[new Wt(h,o,`object expected, ${Oe(o)} found`)];o.type||o.ref||i.push(new Wt(h,o,'either "type" or "ref" is required'));let y=Pr(o.type);const x=Pr(o.ref);if(o.id){const A=Pr(o.id);for(let E=0;E<l.arrayIndex;E++){const M=p.layers[E];Pr(M.id)===A&&i.push(new Wt(h,o.id,`duplicate layer id "${o.id}", previously used at line ${M.id.__line__}`))}}if("ref"in o){let A;["type","source","source-layer","filter","layout"].forEach((E=>{E in o&&i.push(new Wt(h,o[E],`"${E}" is prohibited for ref layers`))})),p.layers.forEach((E=>{Pr(E.id)===x&&(A=E)})),A?A.ref?i.push(new Wt(h,o.ref,"ref cannot reference another ref layer")):y=Pr(A.type):i.push(new Wt(h,o.ref,`ref layer "${x}" not found`))}else if(y!=="background")if(o.source){const A=p.sources&&p.sources[o.source],E=A&&Pr(A.type);A?E==="vector"&&y==="raster"?i.push(new Wt(h,o.source,`layer "${o.id}" requires a raster source`)):E!=="raster-dem"&&y==="hillshade"||E!=="raster-dem"&&y==="color-relief"?i.push(new Wt(h,o.source,`layer "${o.id}" requires a raster-dem source`)):E==="raster"&&y!=="raster"?i.push(new Wt(h,o.source,`layer "${o.id}" requires a vector source`)):E!=="vector"||o["source-layer"]?E==="raster-dem"&&y!=="hillshade"&&y!=="color-relief"?i.push(new Wt(h,o.source,"raster-dem source can only be used with layer type 'hillshade' or 'color-relief'.")):y!=="line"||!o.paint||!o.paint["line-gradient"]||E==="geojson"&&A.lineMetrics||i.push(new Wt(h,o,`layer "${o.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):i.push(new Wt(h,o,`layer "${o.id}" must specify a "source-layer"`)):i.push(new Wt(h,o.source,`source "${o.source}" not found`))}else i.push(new Wt(h,o,'missing required property "source"'));return i=i.concat(is({key:h,value:o,valueSpec:g.layer,style:l.style,styleSpec:l.styleSpec,validateSpec:l.validateSpec,objectElementValidators:{"*":()=>[],type:()=>l.validateSpec({key:`${h}.type`,value:o.type,valueSpec:g.layer.type,style:l.style,styleSpec:l.styleSpec,validateSpec:l.validateSpec,object:o,objectKey:"type"}),filter:ud,layout:A=>is({layer:o,key:A.key,value:A.value,style:A.style,styleSpec:A.styleSpec,validateSpec:A.validateSpec,objectElementValidators:{"*":E=>Rl(Qe({layerType:y},E))}}),paint:A=>is({layer:o,key:A.key,value:A.value,style:A.style,styleSpec:A.styleSpec,validateSpec:A.validateSpec,objectElementValidators:{"*":E=>dd(Qe({layerType:y},E))}})}})),i}function _o(l){const i=l.value,o=l.key,h=Oe(i);return h!=="string"?[new Wt(o,i,`string expected, ${h} found`)]:[]}const fd={promoteId:function({key:l,value:i}){if(Oe(i)==="string")return _o({key:l,value:i});{const o=[];for(const h in i)o.push(..._o({key:`${l}.${h}`,value:i[h]}));return o}}};function Qp(l){const i=l.value,o=l.key,h=l.styleSpec,p=l.style,g=l.validateSpec;if(!i.type)return[new Wt(o,i,'"type" is required')];const y=Pr(i.type);let x;switch(y){case"vector":case"raster":return x=is({key:o,value:i,valueSpec:h[`source_${y.replace("-","_")}`],style:l.style,styleSpec:h,objectElementValidators:fd,validateSpec:g}),x;case"raster-dem":return x=(function(A){var E;const M=(E=A.sourceName)!==null&&E!==void 0?E:"",P=A.value,F=A.styleSpec,O=F.source_raster_dem,N=A.style;let z=[];const H=Oe(P);if(P===void 0)return z;if(H!=="object")return z.push(new Wt("source_raster_dem",P,`object expected, ${H} found`)),z;const q=Pr(P.encoding)==="custom",ct=["redFactor","greenFactor","blueFactor","baseShift"],J=A.value.encoding?`"${A.value.encoding}"`:"Default";for(const rt in P)!q&&ct.includes(rt)?z.push(new Wt(rt,P[rt],`In "${M}": "${rt}" is only valid when "encoding" is set to "custom". ${J} encoding found`)):O[rt]?z=z.concat(A.validateSpec({key:rt,value:P[rt],valueSpec:O[rt],validateSpec:A.validateSpec,style:N,styleSpec:F})):z.push(new Wt(rt,P[rt],`unknown property "${rt}"`));return z})({sourceName:o,value:i,style:l.style,styleSpec:h,validateSpec:g}),x;case"geojson":if(x=is({key:o,value:i,valueSpec:h.source_geojson,style:p,styleSpec:h,validateSpec:g,objectElementValidators:fd}),i.cluster)for(const A in i.clusterProperties){const[E,M]=i.clusterProperties[A],P=typeof E=="string"?[E,["accumulated"],["get",A]]:E;x.push(...Da({key:`${o}.${A}.map`,value:M,expressionContext:"cluster-map"})),x.push(...Da({key:`${o}.${A}.reduce`,value:P,expressionContext:"cluster-reduce"}))}return x;case"video":return is({key:o,value:i,valueSpec:h.source_video,style:p,validateSpec:g,styleSpec:h});case"image":return is({key:o,value:i,valueSpec:h.source_image,style:p,validateSpec:g,styleSpec:h});case"canvas":return[new Wt(o,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Ml({key:`${o}.type`,value:i.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function pd(l){const i=l.value,o=l.styleSpec,h=o.light,p=l.style;let g=[];const y=Oe(i);if(i===void 0)return g;if(y!=="object")return g=g.concat([new Wt("light",i,`object expected, ${y} found`)]),g;for(const x in i){const A=x.match(/^(.*)-transition$/);g=g.concat(A&&h[A[1]]&&h[A[1]].transition?l.validateSpec({key:x,value:i[x],valueSpec:o.transition,validateSpec:l.validateSpec,style:p,styleSpec:o}):h[x]?l.validateSpec({key:x,value:i[x],valueSpec:h[x],validateSpec:l.validateSpec,style:p,styleSpec:o}):[new Wt(x,i[x],`unknown property "${x}"`)])}return g}function _d(l){const i=l.value,o=l.styleSpec,h=o.sky,p=l.style,g=Oe(i);if(i===void 0)return[];if(g!=="object")return[new Wt("sky",i,`object expected, ${g} found`)];let y=[];for(const x in i)y=y.concat(h[x]?l.validateSpec({key:x,value:i[x],valueSpec:h[x],style:p,styleSpec:o}):[new Wt(x,i[x],`unknown property "${x}"`)]);return y}function Fa(l){const i=l.value,o=l.styleSpec,h=o.terrain,p=l.style;let g=[];const y=Oe(i);if(i===void 0)return g;if(y!=="object")return g=g.concat([new Wt("terrain",i,`object expected, ${y} found`)]),g;for(const x in i)g=g.concat(h[x]?l.validateSpec({key:x,value:i[x],valueSpec:h[x],validateSpec:l.validateSpec,style:p,styleSpec:o}):[new Wt(x,i[x],`unknown property "${x}"`)]);return g}function t_(l){let i=[];const o=l.value,h=l.key;if(Array.isArray(o)){const p=[],g=[];for(const y in o)o[y].id&&p.includes(o[y].id)&&i.push(new Wt(h,o,`all the sprites' ids must be unique, but ${o[y].id} is duplicated`)),p.push(o[y].id),o[y].url&&g.includes(o[y].url)&&i.push(new Wt(h,o,`all the sprites' URLs must be unique, but ${o[y].url} is duplicated`)),g.push(o[y].url),i=i.concat(is({key:`${h}[${y}]`,value:o[y],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:l.validateSpec}));return i}return _o({key:h,value:o})}function e_(l){return i=l.value,i&&i.constructor===Object?[]:[new Wt(l.key,l.value,`object expected, ${Oe(l.value)} found`)];var i}const r_={"*":()=>[],array:Il,boolean:function(l){const i=l.value,o=l.key,h=Oe(i);return h!=="boolean"?[new Wt(o,i,`boolean expected, ${h} found`)]:[]},number:zo,color:cd,constants:ld,enum:Ml,filter:ud,function:Yp,layer:Jp,object:is,source:Qp,light:pd,sky:_d,terrain:Fa,projection:function(l){const i=l.value,o=l.styleSpec,h=o.projection,p=l.style,g=Oe(i);if(i===void 0)return[];if(g!=="object")return[new Wt("projection",i,`object expected, ${g} found`)];let y=[];for(const x in i)y=y.concat(h[x]?l.validateSpec({key:x,value:i[x],valueSpec:h[x],style:p,styleSpec:o}):[new Wt(x,i[x],`unknown property "${x}"`)]);return y},projectionDefinition:function(l){const i=l.key;let o=l.value;o=o instanceof String?o.valueOf():o;const h=Oe(o);return h!=="array"||(function(p){return Array.isArray(p)&&p.length===3&&typeof p[0]=="string"&&typeof p[1]=="string"&&typeof p[2]=="number"})(o)||(function(p){return!!["interpolate","step","literal"].includes(p[0])})(o)?["array","string"].includes(h)?[]:[new Wt(i,o,`projection expected, invalid type "${h}" found`)]:[new Wt(i,o,`projection expected, invalid array ${JSON.stringify(o)} found`)]},string:_o,formatted:function(l){return _o(l).length===0?[]:Da(l)},resolvedImage:function(l){return _o(l).length===0?[]:Da(l)},padding:function(l){const i=l.key,o=l.value;if(Oe(o)==="array"){if(o.length<1||o.length>4)return[new Wt(i,o,`padding requires 1 to 4 values; ${o.length} values found`)];const h={type:"number"};let p=[];for(let g=0;g<o.length;g++)p=p.concat(l.validateSpec({key:`${i}[${g}]`,value:o[g],validateSpec:l.validateSpec,valueSpec:h}));return p}return zo({key:i,value:o,valueSpec:{}})},numberArray:function(l){const i=l.key,o=l.value;if(Oe(o)==="array"){const h={type:"number"};if(o.length<1)return[new Wt(i,o,"array length at least 1 expected, length 0 found")];let p=[];for(let g=0;g<o.length;g++)p=p.concat(l.validateSpec({key:`${i}[${g}]`,value:o[g],validateSpec:l.validateSpec,valueSpec:h}));return p}return zo({key:i,value:o,valueSpec:{}})},colorArray:function(l){const i=l.key,o=l.value;if(Oe(o)==="array"){if(o.length<1)return[new Wt(i,o,"array length at least 1 expected, length 0 found")];let h=[];for(let p=0;p<o.length;p++)h=h.concat(cd({key:`${i}[${p}]`,value:o[p]}));return h}return cd({key:i,value:o})},variableAnchorOffsetCollection:function(l){const i=l.key,o=l.value,h=Oe(o),p=l.styleSpec;if(h!=="array"||o.length<1||o.length%2!=0)return[new Wt(i,o,"variableAnchorOffsetCollection requires a non-empty array of even length")];let g=[];for(let y=0;y<o.length;y+=2)g=g.concat(Ml({key:`${i}[${y}]`,value:o[y],valueSpec:p.layout_symbol["text-anchor"]})),g=g.concat(Il({key:`${i}[${y+1}]`,value:o[y+1],valueSpec:{length:2,value:"number"},validateSpec:l.validateSpec,style:l.style,styleSpec:p}));return g},sprite:t_,state:e_};function pu(l){const i=l.value,o=l.valueSpec,h=l.styleSpec;return l.validateSpec=pu,o.expression&&iu(Pr(i))?Yp(l):o.expression&&nu(kn(i))?Da(l):o.type&&r_[o.type]?r_[o.type](l):is(Qe({},l,{valueSpec:o.type?h[o.type]:o}))}function i_(l){const i=l.value,o=l.key,h=_o(l);return h.length||(i.indexOf("{fontstack}")===-1&&h.push(new Wt(o,i,'"glyphs" url must include a "{fontstack}" token')),i.indexOf("{range}")===-1&&h.push(new Wt(o,i,'"glyphs" url must include a "{range}" token'))),h}function As(l,i=tt){let o=[];return o=o.concat(pu({key:"",value:l,valueSpec:i.$root,styleSpec:i,style:l,validateSpec:pu,objectElementValidators:{glyphs:i_,"*":()=>[]}})),l.constants&&(o=o.concat(ld({key:"constants",value:l.constants}))),Oa(o)}function Wi(l){return function(i){return l(Object.assign({},i,{validateSpec:pu}))}}function Oa(l){return[].concat(l).sort(((i,o)=>i.line-o.line))}function Nr(l){return function(...i){return Oa(l.apply(this,i))}}As.source=Nr(Wi(Qp)),As.sprite=Nr(Wi(t_)),As.glyphs=Nr(Wi(i_)),As.light=Nr(Wi(pd)),As.sky=Nr(Wi(_d)),As.terrain=Nr(Wi(Fa)),As.state=Nr(Wi(e_)),As.layer=Nr(Wi(Jp)),As.filter=Nr(Wi(ud)),As.paintProperty=Nr(Wi(dd)),As.layoutProperty=Nr(Wi(Rl));const Pl=tt,Vo=As,h0=Vo.light,d0=Vo.sky,Bl=Vo.paintProperty,s_=Vo.layoutProperty;function _u(l,i){let o=!1;if(i&&i.length)for(const h of i)l.fire(new ft(new Error(h.message))),o=!0;return o}class Dl{constructor(i,o,h){const p=this.cells=[];if(i instanceof ArrayBuffer){this.arrayBuffer=i;const y=new Int32Array(this.arrayBuffer);i=y[0],this.d=(o=y[1])+2*(h=y[2]);for(let A=0;A<this.d*this.d;A++){const E=y[3+A],M=y[3+A+1];p.push(E===M?null:y.subarray(E,M))}const x=y[3+p.length+1];this.keys=y.subarray(y[3+p.length],x),this.bboxes=y.subarray(x),this.insert=this._insertReadonly}else{this.d=o+2*h;for(let y=0;y<this.d*this.d;y++)p.push([]);this.keys=[],this.bboxes=[]}this.n=o,this.extent=i,this.padding=h,this.scale=o/i,this.uid=0;const g=h/o*i;this.min=-g,this.max=i+g}insert(i,o,h,p,g){this._forEachCell(o,h,p,g,this._insertCell,this.uid++,void 0,void 0),this.keys.push(i),this.bboxes.push(o),this.bboxes.push(h),this.bboxes.push(p),this.bboxes.push(g)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(i,o,h,p,g,y){this.cells[g].push(y)}query(i,o,h,p,g){const y=this.min,x=this.max;if(i<=y&&o<=y&&x<=h&&x<=p&&!g)return Array.prototype.slice.call(this.keys);{const A=[];return this._forEachCell(i,o,h,p,this._queryCell,A,{},g),A}}_queryCell(i,o,h,p,g,y,x,A){const E=this.cells[g];if(E!==null){const M=this.keys,P=this.bboxes;for(let F=0;F<E.length;F++){const O=E[F];if(x[O]===void 0){const N=4*O;(A?A(P[N+0],P[N+1],P[N+2],P[N+3]):i<=P[N+2]&&o<=P[N+3]&&h>=P[N+0]&&p>=P[N+1])?(x[O]=!0,y.push(M[O])):x[O]=!1}}}}_forEachCell(i,o,h,p,g,y,x,A){const E=this._convertToCellCoord(i),M=this._convertToCellCoord(o),P=this._convertToCellCoord(h),F=this._convertToCellCoord(p);for(let O=E;O<=P;O++)for(let N=M;N<=F;N++){const z=this.d*N+O;if((!A||A(this._convertFromCellCoord(O),this._convertFromCellCoord(N),this._convertFromCellCoord(O+1),this._convertFromCellCoord(N+1)))&&g.call(this,i,o,h,p,z,y,x,A))return}}_convertFromCellCoord(i){return(i-this.padding)/this.scale}_convertToCellCoord(i){return Math.max(0,Math.min(this.d-1,Math.floor(i*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const i=this.cells,o=3+this.cells.length+1+1;let h=0;for(let y=0;y<this.cells.length;y++)h+=this.cells[y].length;const p=new Int32Array(o+h+this.keys.length+this.bboxes.length);p[0]=this.extent,p[1]=this.n,p[2]=this.padding;let g=o;for(let y=0;y<i.length;y++){const x=i[y];p[3+y]=g,p.set(x,g),g+=x.length}return p[3+i.length]=g,p.set(this.keys,g),g+=this.keys.length,p[3+i.length+1]=g,p.set(this.bboxes,g),g+=this.bboxes.length,p.buffer}static serialize(i,o){const h=i.toArrayBuffer();return o&&o.push(h),{buffer:h}}static deserialize(i){return new Dl(i.buffer)}}const Ys={};function oe(l,i,o={}){if(Ys[l])throw new Error(`${l} is already registered.`);Object.defineProperty(i,"_classRegistryKey",{value:l,writeable:!1}),Ys[l]={klass:i,omit:o.omit||[],shallow:o.shallow||[]}}oe("Object",Object),oe("Set",Set),oe("TransferableGridIndex",Dl),oe("Color",Te),oe("Error",Error),oe("AJAXError",ls),oe("ResolvedImage",ts),oe("StylePropertyFunction",lu),oe("StyleExpression",su,{omit:["_evaluator"]}),oe("ZoomDependentExpression",au),oe("ZoomConstantExpression",Uo),oe("CompoundExpression",Ts,{omit:["_evaluate"]});for(const l in Ma)Ma[l]._classRegistryKey||oe(`Expression_${l}`,Ma[l]);function ka(l){return l&&typeof ArrayBuffer<"u"&&(l instanceof ArrayBuffer||l.constructor&&l.constructor.name==="ArrayBuffer")}function gd(l){return l.$name||l.constructor._classRegistryKey}function n_(l){return!(function(i){if(i===null||typeof i!="object")return!1;const o=gd(i);return!(!o||o==="Object")})(l)&&(l==null||typeof l=="boolean"||typeof l=="number"||typeof l=="string"||l instanceof Boolean||l instanceof Number||l instanceof String||l instanceof Date||l instanceof RegExp||l instanceof Blob||l instanceof Error||ka(l)||os(l)||ArrayBuffer.isView(l)||l instanceof ImageData)}function Fl(l,i){if(n_(l))return(ka(l)||os(l))&&i&&i.push(l),ArrayBuffer.isView(l)&&i&&i.push(l.buffer),l instanceof ImageData&&i&&i.push(l.data.buffer),l;if(Array.isArray(l)){const g=[];for(const y of l)g.push(Fl(y,i));return g}if(typeof l!="object")throw new Error("can't serialize object of type "+typeof l);const o=gd(l);if(!o)throw new Error(`can't serialize object of unregistered class ${l.constructor.name}`);if(!Ys[o])throw new Error(`${o} is not registered.`);const{klass:h}=Ys[o],p=h.serialize?h.serialize(l,i):{};if(h.serialize){if(i&&p===i[i.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const g in l){if(!l.hasOwnProperty(g)||Ys[o].omit.indexOf(g)>=0)continue;const y=l[g];p[g]=Ys[o].shallow.indexOf(g)>=0?y:Fl(y,i)}l instanceof Error&&(p.message=l.message)}if(p.$name)throw new Error("$name property is reserved for worker serialization logic.");return o!=="Object"&&(p.$name=o),p}function Nn(l){if(n_(l))return l;if(Array.isArray(l))return l.map(Nn);if(typeof l!="object")throw new Error("can't deserialize object of type "+typeof l);const i=gd(l)||"Object";if(!Ys[i])throw new Error(`can't deserialize unregistered class ${i}`);const{klass:o}=Ys[i];if(!o)throw new Error(`can't deserialize unregistered class ${i}`);if(o.deserialize)return o.deserialize(l);const h=Object.create(o.prototype);for(const p of Object.keys(l)){if(p==="$name")continue;const g=l[p];h[p]=Ys[i].shallow.indexOf(p)>=0?g:Nn(g)}return h}class md{constructor(){this.first=!0}update(i,o){const h=Math.floor(i);return this.first?(this.first=!1,this.lastIntegerZoom=h,this.lastIntegerZoomTime=0,this.lastZoom=i,this.lastFloorZoom=h,!0):(this.lastFloorZoom>h?(this.lastIntegerZoom=h+1,this.lastIntegerZoomTime=o):this.lastFloorZoom<h&&(this.lastIntegerZoom=h,this.lastIntegerZoomTime=o),i!==this.lastZoom&&(this.lastZoom=i,this.lastFloorZoom=h,!0))}}function f0(l){return/[\u02EA\u02EB\u2E80-\u2E99\u2E9B-\u2EF3\u2F00-\u2FD5\u2FF0-\u303F\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FD-\u30FF\u3105-\u312F\u31A0-\u4DBF\u4E00-\uA48C\uA490-\uA4C6\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE4F\uFF00-\uFFEF]|\uD81B[\uDFE0-\uDFE4\uDFF0-\uDFF6]|[\uD81C-\uD822\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFF3\uDFF5-\uDFFB\uDFFD\uDFFE]|\uD82C[\uDC00-\uDD22\uDD32\uDD50-\uDD52\uDD55\uDD64-\uDD67\uDD70-\uDEFB]|\uD83C\uDE00|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(l))}function Na(l){return/[\u02EA\u02EB\u1100-\u11FF\u1400-\u167F\u18B0-\u18F5\u2E80-\u2E99\u2E9B-\u2EF3\u2F00-\u2FD5\u2FF0-\u3007\u3012\u3013\u3020-\u302F\u3031-\u303F\u3041-\u3096\u309D-\u30FB\u30FD-\u30FF\u3105-\u312F\u3131-\u318E\u3190-\uA48C\uA490-\uA4C6\uA960-\uA97C\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE48\uFE50-\uFE57\uFE5F-\uFE62\uFE67-\uFE6F\uFF00-\uFF07\uFF0A-\uFF0C\uFF0E-\uFF19\uFF1F-\uFF3A\uFF3C\uFF3E\uFF40-\uFF5A\uFFE0-\uFFE2\uFFE4-\uFFE7]|\uD806[\uDEB0-\uDEBF]|\uD81B[\uDFE0-\uDFE4\uDFF0-\uDFF6]|[\uD81C-\uD822\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFF3\uDFF5-\uDFFB\uDFFD\uDFFE]|\uD82C[\uDC00-\uDD22\uDD32\uDD50-\uDD52\uDD55\uDD64-\uDD67\uDD70-\uDEFB]|\uD83C\uDE00|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(l))}function yd(l){for(const i of l)if(Na(i.charCodeAt(0)))return!0;return!1}function bd(l){for(const i of l)if(!a_(i.charCodeAt(0)))return!1;return!0}function Ol(l){const i=l.map((o=>{try{return new RegExp(`\\p{sc=${o}}`,"u").source}catch{return null}})).filter((o=>o));return new RegExp(i.join("|"),"u")}const o_=Ol(["Arab","Dupl","Mong","Ougr","Syrc"]);function a_(l){return!o_.test(String.fromCodePoint(l))}function vd(l){return!(Na(l)||(i=l,/[\xA7\xA9\xAE\xB1\xBC-\xBE\xD7\xF7\u2016\u2020\u2021\u2030\u2031\u203B\u203C\u2042\u2047-\u2049\u2051\u2100-\u218F\u221E\u2234\u2235\u2300-\u2307\u230C-\u231F\u2324-\u2328\u232B\u237D-\u239A\u23BE-\u23CD\u23CF\u23D1-\u23DB\u23E2-\u2422\u2424-\u24FF\u25A0-\u2619\u2620-\u2767\u2776-\u2793\u2B12-\u2B2F\u2B50-\u2B59\u2BB8-\u2BEB\u3000-\u303F\u30A0-\u30FF\uE000-\uF8FF\uFE30-\uFE6F\uFF00-\uFFEF\uFFFC\uFFFD]/gim.test(String.fromCodePoint(i))));var i}const l_=Ol(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function gu(l){return l_.test(String.fromCodePoint(l))}function c_(l,i){return!(!i&&gu(l)||/[\u0900-\u0DFF\u0F00-\u109F\u1780-\u17FF]/gim.test(String.fromCodePoint(l)))}function p0(l){for(const i of l)if(gu(i.charCodeAt(0)))return!0;return!1}const Ln=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(l){this.pluginStatus=l.pluginStatus,this.pluginURL=l.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(l){if(Ln.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=l.applyArabicShaping,this.processBidirectionalText=l.processBidirectionalText,this.processStyledBidirectionalText=l.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getRTLTextPluginStatus(){return this.pluginStatus}syncState(l,i){return c(this,void 0,void 0,(function*(){if(this.isParsed())return this.getState();if(l.pluginStatus!=="loading")return this.setState(l),l;const o=l.pluginURL,h=new Promise((g=>{this.loadScriptResolve=g}));i(o);const p=new Promise((g=>setTimeout((()=>g()),this.TIMEOUT)));if(yield Promise.race([h,p]),this.isParsed()){const g={pluginStatus:"loaded",pluginURL:o};return this.setState(g),g}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${o}`)}))}};class or{constructor(i,o){this.isSupportedScript=u_,this.zoom=i,o?(this.now=o.now||0,this.fadeDuration=o.fadeDuration||0,this.zoomHistory=o.zoomHistory||new md,this.transition=o.transition||{}):(this.now=0,this.fadeDuration=0,this.zoomHistory=new md,this.transition={})}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const i=this.zoom,o=i-Math.floor(i),h=this.crossFadingFactor();return i>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:o+(1-o)*h}:{fromScale:.5,toScale:1,t:1-(1-h)*o}}}function u_(l){return(function(i,o){for(const h of i)if(!c_(h.charCodeAt(0),o))return!1;return!0})(l,Ln.getRTLTextPluginStatus()==="loaded")}class mu{constructor(i,o,h){this.property=i,this.value=o,this.expression=(function(p,g,y){if(iu(p))return new lu(p,g);if(nu(p)){const x=$p(p,g,y);if(x.result==="error")throw new Error(x.value.map((A=>`${A.key}: ${A.message}`)).join(", "));return x.value}{let x=p;return g.type==="color"&&typeof p=="string"?x=Te.parse(p):g.type!=="padding"||typeof p!="number"&&!Array.isArray(p)?g.type!=="numberArray"||typeof p!="number"&&!Array.isArray(p)?g.type!=="colorArray"||typeof p!="string"&&!Array.isArray(p)?g.type==="variableAnchorOffsetCollection"&&Array.isArray(p)?x=$i.parse(p):g.type==="projectionDefinition"&&typeof p=="string"&&(x=Ni.parse(p)):x=ri.parse(p):x=ki.parse(p):x=Oi.parse(p),{globalStateRefs:new Set,_globalState:null,kind:"constant",evaluate:()=>x}}})(o===void 0?i.specification.default:o,i.specification,h)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}getGlobalStateRefs(){return this.expression.globalStateRefs||new Set}possiblyEvaluate(i,o,h){return this.property.possiblyEvaluate(this,i,o,h)}}class yu{constructor(i,o){this.property=i,this.value=new mu(i,void 0,o)}transitioned(i,o){return new h_(this.property,this.value,o,Rr({},i.transition,this.transition),i.now)}untransitioned(){return new h_(this.property,this.value,null,{},0)}}class xd{constructor(i,o){this._properties=i,this._values=Object.create(i.defaultTransitionablePropertyValues),this._globalState=o}getValue(i){return ci(this._values[i].value.value)}setValue(i,o){Object.prototype.hasOwnProperty.call(this._values,i)||(this._values[i]=new yu(this._values[i].property,this._globalState)),this._values[i].value=new mu(this._values[i].property,o===null?void 0:ci(o),this._globalState)}getTransition(i){return ci(this._values[i].transition)}setTransition(i,o){Object.prototype.hasOwnProperty.call(this._values,i)||(this._values[i]=new yu(this._values[i].property,this._globalState)),this._values[i].transition=ci(o)||void 0}serialize(){const i={};for(const o of Object.keys(this._values)){const h=this.getValue(o);h!==void 0&&(i[o]=h);const p=this.getTransition(o);p!==void 0&&(i[`${o}-transition`]=p)}return i}transitioned(i,o){const h=new d_(this._properties);for(const p of Object.keys(this._values))h._values[p]=this._values[p].transitioned(i,o._values[p]);return h}untransitioned(){const i=new d_(this._properties);for(const o of Object.keys(this._values))i._values[o]=this._values[o].untransitioned();return i}}class h_{constructor(i,o,h,p,g){this.property=i,this.value=o,this.begin=g+p.delay||0,this.end=this.begin+p.duration||0,i.specification.transition&&(p.delay||p.duration)&&(this.prior=h)}possiblyEvaluate(i,o,h){const p=i.now||0,g=this.value.possiblyEvaluate(i,o,h),y=this.prior;if(y){if(p>this.end)return this.prior=null,g;if(this.value.isDataDriven())return this.prior=null,g;if(p<this.begin)return y.possiblyEvaluate(i,o,h);{const x=(p-this.begin)/(this.end-this.begin);return this.property.interpolate(y.possiblyEvaluate(i,o,h),g,_a(x))}}return g}}class d_{constructor(i){this._properties=i,this._values=Object.create(i.defaultTransitioningPropertyValues)}possiblyEvaluate(i,o,h){const p=new kl(this._properties);for(const g of Object.keys(this._values))p._values[g]=this._values[g].possiblyEvaluate(i,o,h);return p}hasTransition(){for(const i of Object.keys(this._values))if(this._values[i].prior)return!0;return!1}}class f_{constructor(i,o){this._properties=i,this._values=Object.create(i.defaultPropertyValues),this._globalState=o}hasValue(i){return this._values[i].value!==void 0}getValue(i){return ci(this._values[i].value)}setValue(i,o){this._values[i]=new mu(this._values[i].property,o===null?void 0:ci(o),this._globalState)}serialize(){const i={};for(const o of Object.keys(this._values)){const h=this.getValue(o);h!==void 0&&(i[o]=h)}return i}possiblyEvaluate(i,o,h){const p=new kl(this._properties);for(const g of Object.keys(this._values))p._values[g]=this._values[g].possiblyEvaluate(i,o,h);return p}}class Ks{constructor(i,o,h){this.property=i,this.value=o,this.parameters=h}isConstant(){return this.value.kind==="constant"}constantOr(i){return this.value.kind==="constant"?this.value.value:i}evaluate(i,o,h,p){return this.property.evaluate(this.value,this.parameters,i,o,h,p)}}class kl{constructor(i){this._properties=i,this._values=Object.create(i.defaultPossiblyEvaluatedValues)}get(i){return this._values[i]}}class fe{constructor(i){this.specification=i}possiblyEvaluate(i,o){if(i.isDataDriven())throw new Error("Value should not be data driven");return i.expression.evaluate(o)}interpolate(i,o,h){const p=qs[this.specification.type];return p?p(i,o,h):i}}class xe{constructor(i,o){this.specification=i,this.overrides=o}possiblyEvaluate(i,o,h,p){return new Ks(this,i.expression.kind==="constant"||i.expression.kind==="camera"?{kind:"constant",value:i.expression.evaluate(o,null,{},h,p)}:i.expression,o)}interpolate(i,o,h){if(i.value.kind!=="constant"||o.value.kind!=="constant")return i;if(i.value.value===void 0||o.value.value===void 0)return new Ks(this,{kind:"constant",value:void 0},i.parameters);const p=qs[this.specification.type];if(p){const g=p(i.value.value,o.value.value,h);return new Ks(this,{kind:"constant",value:g},i.parameters)}return i}evaluate(i,o,h,p,g,y){return i.kind==="constant"?i.value:i.evaluate(o,h,p,g,y)}}class Nl extends xe{possiblyEvaluate(i,o,h,p){if(i.value===void 0)return new Ks(this,{kind:"constant",value:void 0},o);if(i.expression.kind==="constant"){const g=i.expression.evaluate(o,null,{},h,p),y=i.property.specification.type==="resolvedImage"&&typeof g!="string"?g.name:g,x=this._calculate(y,y,y,o);return new Ks(this,{kind:"constant",value:x},o)}if(i.expression.kind==="camera"){const g=this._calculate(i.expression.evaluate({zoom:o.zoom-1}),i.expression.evaluate({zoom:o.zoom}),i.expression.evaluate({zoom:o.zoom+1}),o);return new Ks(this,{kind:"constant",value:g},o)}return new Ks(this,i.expression,o)}evaluate(i,o,h,p,g,y){if(i.kind==="source"){const x=i.evaluate(o,h,p,g,y);return this._calculate(x,x,x,o)}return i.kind==="composite"?this._calculate(i.evaluate({zoom:Math.floor(o.zoom)-1},h,p),i.evaluate({zoom:Math.floor(o.zoom)},h,p),i.evaluate({zoom:Math.floor(o.zoom)+1},h,p),o):i.value}_calculate(i,o,h,p){return p.zoom>p.zoomHistory.lastIntegerZoom?{from:i,to:o}:{from:h,to:o}}interpolate(i){return i}}class bu{constructor(i){this.specification=i}possiblyEvaluate(i,o,h,p){if(i.value!==void 0){if(i.expression.kind==="constant"){const g=i.expression.evaluate(o,null,{},h,p);return this._calculate(g,g,g,o)}return this._calculate(i.expression.evaluate(new or(Math.floor(o.zoom-1),o)),i.expression.evaluate(new or(Math.floor(o.zoom),o)),i.expression.evaluate(new or(Math.floor(o.zoom+1),o)),o)}}_calculate(i,o,h,p){return p.zoom>p.zoomHistory.lastIntegerZoom?{from:i,to:o}:{from:h,to:o}}interpolate(i){return i}}class vu{constructor(i){this.specification=i}possiblyEvaluate(i,o,h,p){return!!i.expression.evaluate(o,null,{},h,p)}interpolate(){return!1}}class Xi{constructor(i){this.properties=i,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const o in i){const h=i[o];h.specification.overridable&&this.overridableProperties.push(o);const p=this.defaultPropertyValues[o]=new mu(h,void 0,void 0),g=this.defaultTransitionablePropertyValues[o]=new yu(h,void 0);this.defaultTransitioningPropertyValues[o]=g.untransitioned(),this.defaultPossiblyEvaluatedValues[o]=p.possiblyEvaluate({})}}}oe("DataDrivenProperty",xe),oe("DataConstantProperty",fe),oe("CrossFadedDataDrivenProperty",Nl),oe("CrossFadedProperty",bu),oe("ColorRampProperty",vu);const wd="-transition";class Es extends Tt{constructor(i,o,h){if(super(),this.id=i.id,this.type=i.type,this._globalState=h,this._featureFilter={filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set},i.type!=="custom"&&(this.metadata=i.metadata,this.minzoom=i.minzoom,this.maxzoom=i.maxzoom,i.type!=="background"&&(this.source=i.source,this.sourceLayer=i["source-layer"],this.filter=i.filter,this._featureFilter=Sl(i.filter,h)),o.layout&&(this._unevaluatedLayout=new f_(o.layout,h)),o.paint)){this._transitionablePaint=new xd(o.paint,h);for(const p in i.paint)this.setPaintProperty(p,i.paint[p],{validate:!1});for(const p in i.layout)this.setLayoutProperty(p,i.layout[p],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new kl(o.paint)}}setFilter(i){this.filter=i,this._featureFilter=Sl(i,this._globalState)}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(i){return i==="visibility"?this.visibility:this._unevaluatedLayout.getValue(i)}getLayoutAffectingGlobalStateRefs(){const i=new Set;if(this._unevaluatedLayout)for(const o in this._unevaluatedLayout._values){const h=this._unevaluatedLayout._values[o];for(const p of h.getGlobalStateRefs())i.add(p)}for(const o of this._featureFilter.getGlobalStateRefs())i.add(o);return i}getPaintAffectingGlobalStateRefs(){var i;const o=new globalThis.Map;if(this._transitionablePaint)for(const h in this._transitionablePaint._values){const p=this._transitionablePaint._values[h].value;for(const g of p.getGlobalStateRefs()){const y=(i=o.get(g))!==null&&i!==void 0?i:[];y.push({name:h,value:p.value}),o.set(g,y)}}return o}setLayoutProperty(i,o,h={}){o!=null&&this._validate(s_,`layers.${this.id}.layout.${i}`,i,o,h)||(i!=="visibility"?this._unevaluatedLayout.setValue(i,o):this.visibility=o)}getPaintProperty(i){return i.endsWith(wd)?this._transitionablePaint.getTransition(i.slice(0,-11)):this._transitionablePaint.getValue(i)}setPaintProperty(i,o,h={}){if(o!=null&&this._validate(Bl,`layers.${this.id}.paint.${i}`,i,o,h))return!1;if(i.endsWith(wd))return this._transitionablePaint.setTransition(i.slice(0,-11),o||void 0),!1;{const p=this._transitionablePaint._values[i],g=p.property.specification["property-type"]==="cross-faded-data-driven",y=p.value.isDataDriven(),x=p.value;this._transitionablePaint.setValue(i,o),this._handleSpecialPaintPropertyUpdate(i);const A=this._transitionablePaint._values[i].value;return A.isDataDriven()||y||g||this._handleOverridablePaintPropertyUpdate(i,x,A)}}_handleSpecialPaintPropertyUpdate(i){}_handleOverridablePaintPropertyUpdate(i,o,h){return!1}isHidden(i,o=!1){return!!(this.minzoom&&i<(o?Math.floor(this.minzoom):this.minzoom))||!!(this.maxzoom&&i>=this.maxzoom)||this.visibility==="none"}updateTransitions(i){this._transitioningPaint=this._transitionablePaint.transitioned(i,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(i,o){i.getCrossfadeParameters&&(this._crossfadeParameters=i.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(i,void 0,o)),this.paint=this._transitioningPaint.possiblyEvaluate(i,void 0,o)}serialize(){const i={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(i.layout=i.layout||{},i.layout.visibility=this.visibility),xs(i,((o,h)=>!(o===void 0||h==="layout"&&!Object.keys(o).length||h==="paint"&&!Object.keys(o).length)))}_validate(i,o,h,p,g={}){return(!g||g.validate!==!1)&&_u(this,i.call(Vo,{key:o,layerType:this.type,objectKey:h,value:p,styleSpec:tt,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const i in this.paint._values){const o=this.paint.get(i);if(o instanceof Ks&&Pa(o.property.specification)&&(o.value.kind==="source"||o.value.kind==="composite")&&o.value.isStateDependent)return!0}return!1}}let Td;var _0={get paint(){return Td=Td||new Xi({"raster-opacity":new fe(tt.paint_raster["raster-opacity"]),"raster-hue-rotate":new fe(tt.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new fe(tt.paint_raster["raster-brightness-min"]),"raster-brightness-max":new fe(tt.paint_raster["raster-brightness-max"]),"raster-saturation":new fe(tt.paint_raster["raster-saturation"]),"raster-contrast":new fe(tt.paint_raster["raster-contrast"]),"raster-resampling":new fe(tt.paint_raster["raster-resampling"]),"raster-fade-duration":new fe(tt.paint_raster["raster-fade-duration"])})}};class g0 extends Es{constructor(i,o){super(i,_0,o)}}const m0={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Ll{constructor(i,o){this._structArray=i,this._pos1=o*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Br{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(i,o){return i._trim(),o&&(i.isTransferred=!0,o.push(i.arrayBuffer)),{length:i.length,arrayBuffer:i.arrayBuffer}}static deserialize(i){const o=Object.create(this.prototype);return o.arrayBuffer=i.arrayBuffer,o.length=i.length,o.capacity=i.arrayBuffer.byteLength/o.bytesPerElement,o._refreshViews(),o}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(i){this.reserve(i),this.length=i}reserve(i){if(i>this.capacity){this.capacity=Math.max(i,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const o=this.uint8;this._refreshViews(),o&&this.uint8.set(o)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function fr(l,i=1){let o=0,h=0;return{members:l.map((p=>{const g=m0[p.type].BYTES_PER_ELEMENT,y=o=p_(o,Math.max(i,g)),x=p.components||1;return h=Math.max(h,g),o+=g*x,{name:p.name,type:p.type,components:x,offset:y}})),size:p_(o,Math.max(h,i)),alignment:i}}function p_(l,i){return Math.ceil(l/i)*i}class Ul extends Br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,o){const h=this.length;return this.resize(h+1),this.emplace(h,i,o)}emplace(i,o,h){const p=2*i;return this.int16[p+0]=o,this.int16[p+1]=h,i}}Ul.prototype.bytesPerElement=4,oe("StructArrayLayout2i4",Ul);class xu extends Br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,o,h){const p=this.length;return this.resize(p+1),this.emplace(p,i,o,h)}emplace(i,o,h,p){const g=3*i;return this.int16[g+0]=o,this.int16[g+1]=h,this.int16[g+2]=p,i}}xu.prototype.bytesPerElement=6,oe("StructArrayLayout3i6",xu);class wu extends Br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,o,h,p){const g=this.length;return this.resize(g+1),this.emplace(g,i,o,h,p)}emplace(i,o,h,p,g){const y=4*i;return this.int16[y+0]=o,this.int16[y+1]=h,this.int16[y+2]=p,this.int16[y+3]=g,i}}wu.prototype.bytesPerElement=8,oe("StructArrayLayout4i8",wu);class Ad extends Br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,o,h,p,g,y){const x=this.length;return this.resize(x+1),this.emplace(x,i,o,h,p,g,y)}emplace(i,o,h,p,g,y,x){const A=6*i;return this.int16[A+0]=o,this.int16[A+1]=h,this.int16[A+2]=p,this.int16[A+3]=g,this.int16[A+4]=y,this.int16[A+5]=x,i}}Ad.prototype.bytesPerElement=12,oe("StructArrayLayout2i4i12",Ad);class Ed extends Br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,o,h,p,g,y){const x=this.length;return this.resize(x+1),this.emplace(x,i,o,h,p,g,y)}emplace(i,o,h,p,g,y,x){const A=4*i,E=8*i;return this.int16[A+0]=o,this.int16[A+1]=h,this.uint8[E+4]=p,this.uint8[E+5]=g,this.uint8[E+6]=y,this.uint8[E+7]=x,i}}Ed.prototype.bytesPerElement=8,oe("StructArrayLayout2i4ub8",Ed);class Js extends Br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,o){const h=this.length;return this.resize(h+1),this.emplace(h,i,o)}emplace(i,o,h){const p=2*i;return this.float32[p+0]=o,this.float32[p+1]=h,i}}Js.prototype.bytesPerElement=8,oe("StructArrayLayout2f8",Js);class Tu extends Br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,o,h,p,g,y,x,A,E,M){const P=this.length;return this.resize(P+1),this.emplace(P,i,o,h,p,g,y,x,A,E,M)}emplace(i,o,h,p,g,y,x,A,E,M,P){const F=10*i;return this.uint16[F+0]=o,this.uint16[F+1]=h,this.uint16[F+2]=p,this.uint16[F+3]=g,this.uint16[F+4]=y,this.uint16[F+5]=x,this.uint16[F+6]=A,this.uint16[F+7]=E,this.uint16[F+8]=M,this.uint16[F+9]=P,i}}Tu.prototype.bytesPerElement=20,oe("StructArrayLayout10ui20",Tu);class zl extends Br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,o,h,p,g,y,x,A){const E=this.length;return this.resize(E+1),this.emplace(E,i,o,h,p,g,y,x,A)}emplace(i,o,h,p,g,y,x,A,E){const M=8*i;return this.uint16[M+0]=o,this.uint16[M+1]=h,this.uint16[M+2]=p,this.uint16[M+3]=g,this.uint16[M+4]=y,this.uint16[M+5]=x,this.uint16[M+6]=A,this.uint16[M+7]=E,i}}zl.prototype.bytesPerElement=16,oe("StructArrayLayout8ui16",zl);class Au extends Br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,o,h,p,g,y,x,A,E,M,P,F){const O=this.length;return this.resize(O+1),this.emplace(O,i,o,h,p,g,y,x,A,E,M,P,F)}emplace(i,o,h,p,g,y,x,A,E,M,P,F,O){const N=12*i;return this.int16[N+0]=o,this.int16[N+1]=h,this.int16[N+2]=p,this.int16[N+3]=g,this.uint16[N+4]=y,this.uint16[N+5]=x,this.uint16[N+6]=A,this.uint16[N+7]=E,this.int16[N+8]=M,this.int16[N+9]=P,this.int16[N+10]=F,this.int16[N+11]=O,i}}Au.prototype.bytesPerElement=24,oe("StructArrayLayout4i4ui4i24",Au);class Vl extends Br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,o,h){const p=this.length;return this.resize(p+1),this.emplace(p,i,o,h)}emplace(i,o,h,p){const g=3*i;return this.float32[g+0]=o,this.float32[g+1]=h,this.float32[g+2]=p,i}}Vl.prototype.bytesPerElement=12,oe("StructArrayLayout3f12",Vl);class Sd extends Br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(i){const o=this.length;return this.resize(o+1),this.emplace(o,i)}emplace(i,o){return this.uint32[1*i+0]=o,i}}Sd.prototype.bytesPerElement=4,oe("StructArrayLayout1ul4",Sd);class La extends Br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,o,h,p,g,y,x,A,E){const M=this.length;return this.resize(M+1),this.emplace(M,i,o,h,p,g,y,x,A,E)}emplace(i,o,h,p,g,y,x,A,E,M){const P=10*i,F=5*i;return this.int16[P+0]=o,this.int16[P+1]=h,this.int16[P+2]=p,this.int16[P+3]=g,this.int16[P+4]=y,this.int16[P+5]=x,this.uint32[F+3]=A,this.uint16[P+8]=E,this.uint16[P+9]=M,i}}La.prototype.bytesPerElement=20,oe("StructArrayLayout6i1ul2ui20",La);class jo extends Br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,o,h,p,g,y){const x=this.length;return this.resize(x+1),this.emplace(x,i,o,h,p,g,y)}emplace(i,o,h,p,g,y,x){const A=6*i;return this.int16[A+0]=o,this.int16[A+1]=h,this.int16[A+2]=p,this.int16[A+3]=g,this.int16[A+4]=y,this.int16[A+5]=x,i}}jo.prototype.bytesPerElement=12,oe("StructArrayLayout2i2i2i12",jo);class Cd extends Br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,o,h,p,g){const y=this.length;return this.resize(y+1),this.emplace(y,i,o,h,p,g)}emplace(i,o,h,p,g,y){const x=4*i,A=8*i;return this.float32[x+0]=o,this.float32[x+1]=h,this.float32[x+2]=p,this.int16[A+6]=g,this.int16[A+7]=y,i}}Cd.prototype.bytesPerElement=16,oe("StructArrayLayout2f1f2i16",Cd);class Eu extends Br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,o,h,p,g,y){const x=this.length;return this.resize(x+1),this.emplace(x,i,o,h,p,g,y)}emplace(i,o,h,p,g,y,x){const A=16*i,E=4*i,M=8*i;return this.uint8[A+0]=o,this.uint8[A+1]=h,this.float32[E+1]=p,this.float32[E+2]=g,this.int16[M+6]=y,this.int16[M+7]=x,i}}Eu.prototype.bytesPerElement=16,oe("StructArrayLayout2ub2f2i16",Eu);class go extends Br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,o,h){const p=this.length;return this.resize(p+1),this.emplace(p,i,o,h)}emplace(i,o,h,p){const g=3*i;return this.uint16[g+0]=o,this.uint16[g+1]=h,this.uint16[g+2]=p,i}}go.prototype.bytesPerElement=6,oe("StructArrayLayout3ui6",go);class Id extends Br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,o,h,p,g,y,x,A,E,M,P,F,O,N,z,H,q){const ct=this.length;return this.resize(ct+1),this.emplace(ct,i,o,h,p,g,y,x,A,E,M,P,F,O,N,z,H,q)}emplace(i,o,h,p,g,y,x,A,E,M,P,F,O,N,z,H,q,ct){const J=24*i,rt=12*i,pt=48*i;return this.int16[J+0]=o,this.int16[J+1]=h,this.uint16[J+2]=p,this.uint16[J+3]=g,this.uint32[rt+2]=y,this.uint32[rt+3]=x,this.uint32[rt+4]=A,this.uint16[J+10]=E,this.uint16[J+11]=M,this.uint16[J+12]=P,this.float32[rt+7]=F,this.float32[rt+8]=O,this.uint8[pt+36]=N,this.uint8[pt+37]=z,this.uint8[pt+38]=H,this.uint32[rt+10]=q,this.int16[J+22]=ct,i}}Id.prototype.bytesPerElement=48,oe("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Id);class Md extends Br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,o,h,p,g,y,x,A,E,M,P,F,O,N,z,H,q,ct,J,rt,pt,vt,Pt,jt,Vt,$t,se,Yt){const Kt=this.length;return this.resize(Kt+1),this.emplace(Kt,i,o,h,p,g,y,x,A,E,M,P,F,O,N,z,H,q,ct,J,rt,pt,vt,Pt,jt,Vt,$t,se,Yt)}emplace(i,o,h,p,g,y,x,A,E,M,P,F,O,N,z,H,q,ct,J,rt,pt,vt,Pt,jt,Vt,$t,se,Yt,Kt){const zt=32*i,ye=16*i;return this.int16[zt+0]=o,this.int16[zt+1]=h,this.int16[zt+2]=p,this.int16[zt+3]=g,this.int16[zt+4]=y,this.int16[zt+5]=x,this.int16[zt+6]=A,this.int16[zt+7]=E,this.uint16[zt+8]=M,this.uint16[zt+9]=P,this.uint16[zt+10]=F,this.uint16[zt+11]=O,this.uint16[zt+12]=N,this.uint16[zt+13]=z,this.uint16[zt+14]=H,this.uint16[zt+15]=q,this.uint16[zt+16]=ct,this.uint16[zt+17]=J,this.uint16[zt+18]=rt,this.uint16[zt+19]=pt,this.uint16[zt+20]=vt,this.uint16[zt+21]=Pt,this.uint16[zt+22]=jt,this.uint32[ye+12]=Vt,this.float32[ye+13]=$t,this.float32[ye+14]=se,this.uint16[zt+30]=Yt,this.uint16[zt+31]=Kt,i}}Md.prototype.bytesPerElement=64,oe("StructArrayLayout8i15ui1ul2f2ui64",Md);class jl extends Br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i){const o=this.length;return this.resize(o+1),this.emplace(o,i)}emplace(i,o){return this.float32[1*i+0]=o,i}}jl.prototype.bytesPerElement=4,oe("StructArrayLayout1f4",jl);class Rd extends Br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,o,h){const p=this.length;return this.resize(p+1),this.emplace(p,i,o,h)}emplace(i,o,h,p){const g=3*i;return this.uint16[6*i+0]=o,this.float32[g+1]=h,this.float32[g+2]=p,i}}Rd.prototype.bytesPerElement=12,oe("StructArrayLayout1ui2f12",Rd);class b extends Br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,o,h){const p=this.length;return this.resize(p+1),this.emplace(p,i,o,h)}emplace(i,o,h,p){const g=4*i;return this.uint32[2*i+0]=o,this.uint16[g+2]=h,this.uint16[g+3]=p,i}}b.prototype.bytesPerElement=8,oe("StructArrayLayout1ul2ui8",b);class s extends Br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,o){const h=this.length;return this.resize(h+1),this.emplace(h,i,o)}emplace(i,o,h){const p=2*i;return this.uint16[p+0]=o,this.uint16[p+1]=h,i}}s.prototype.bytesPerElement=4,oe("StructArrayLayout2ui4",s);class u extends Br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i){const o=this.length;return this.resize(o+1),this.emplace(o,i)}emplace(i,o){return this.uint16[1*i+0]=o,i}}u.prototype.bytesPerElement=2,oe("StructArrayLayout1ui2",u);class _ extends Br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,o,h,p){const g=this.length;return this.resize(g+1),this.emplace(g,i,o,h,p)}emplace(i,o,h,p,g){const y=4*i;return this.float32[y+0]=o,this.float32[y+1]=h,this.float32[y+2]=p,this.float32[y+3]=g,i}}_.prototype.bytesPerElement=16,oe("StructArrayLayout4f16",_);class m extends Ll{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new T(this.anchorPointX,this.anchorPointY)}}m.prototype.size=20;class v extends La{get(i){return new m(this,i)}}oe("CollisionBoxArray",v);class w extends Ll{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(i){this._structArray.uint8[this._pos1+37]=i}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(i){this._structArray.uint8[this._pos1+38]=i}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(i){this._structArray.uint32[this._pos4+10]=i}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}w.prototype.size=48;class S extends Id{get(i){return new w(this,i)}}oe("PlacedSymbolArray",S);class I extends Ll{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(i){this._structArray.uint32[this._pos4+12]=i}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}I.prototype.size=64;class B extends Md{get(i){return new I(this,i)}}oe("SymbolInstanceArray",B);class D extends jl{getoffsetX(i){return this.float32[1*i+0]}}oe("GlyphOffsetArray",D);class U extends xu{getx(i){return this.int16[3*i+0]}gety(i){return this.int16[3*i+1]}gettileUnitDistanceFromAnchor(i){return this.int16[3*i+2]}}oe("SymbolLineVertexArray",U);class k extends Ll{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}k.prototype.size=12;class j extends Rd{get(i){return new k(this,i)}}oe("TextAnchorOffsetArray",j);class W extends Ll{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}W.prototype.size=8;class Q extends b{get(i){return new W(this,i)}}oe("FeatureIndexArray",Q);class et extends Ul{}class st extends Ul{}class ut extends Ul{}class _t extends Ad{}class lt extends Ed{}class gt extends Js{}class mt extends Tu{}class dt extends zl{}class wt extends Au{}class Ft extends Vl{}class Mt extends Sd{}class Rt extends jo{}class Ot extends Eu{}class qt extends go{}class Zt extends s{}const Gt=fr([{name:"a_pos",components:2,type:"Int16"}],4),{members:he}=Gt;class pe{constructor(i=[]){this._forceNewSegmentOnNextPrepare=!1,this.segments=i}prepareSegment(i,o,h,p){const g=this.segments[this.segments.length-1];return i>pe.MAX_VERTEX_ARRAY_LENGTH&&Je(`Max vertices per segment is ${pe.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${i}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${pe.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!g||g.vertexLength+i>pe.MAX_VERTEX_ARRAY_LENGTH||g.sortKey!==p?this.createNewSegment(o,h,p):g}createNewSegment(i,o,h){const p={vertexOffset:i.length,primitiveOffset:o.length,vertexLength:0,primitiveLength:0,vaos:{}};return h!==void 0&&(p.sortKey=h),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(p),p}getOrCreateLatestSegment(i,o,h){return this.prepareSegment(0,i,o,h)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(const i of this.segments)for(const o in i.vaos)i.vaos[o].destroy()}static simpleSegment(i,o,h,p){return new pe([{vertexOffset:i,primitiveOffset:o,vertexLength:h,primitiveLength:p,vaos:{},sortKey:0}])}}function qe(l,i){return 256*(l=wi(Math.floor(l),0,255))+wi(Math.floor(i),0,255)}pe.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,oe("SegmentVector",pe);const xr=fr([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),pr=fr([{name:"a_dasharray_from",components:4,type:"Uint16"},{name:"a_dasharray_to",components:4,type:"Uint16"}]);var Cr,ar,Jr,lr={exports:{}},ui={exports:{}},Vr={exports:{}},Qr=(function(){if(Jr)return lr.exports;Jr=1;var l=(Cr||(Cr=1,ui.exports=function(o,h){var p,g,y,x,A,E,M,P;for(g=o.length-(p=3&o.length),y=h,A=3432918353,E=461845907,P=0;P<g;)M=255&o.charCodeAt(P)|(255&o.charCodeAt(++P))<<8|(255&o.charCodeAt(++P))<<16|(255&o.charCodeAt(++P))<<24,++P,y=27492+(65535&(x=5*(65535&(y=(y^=M=(65535&(M=(M=(65535&M)*A+(((M>>>16)*A&65535)<<16)&4294967295)<<15|M>>>17))*E+(((M>>>16)*E&65535)<<16)&4294967295)<<13|y>>>19))+((5*(y>>>16)&65535)<<16)&4294967295))+((58964+(x>>>16)&65535)<<16);switch(M=0,p){case 3:M^=(255&o.charCodeAt(P+2))<<16;case 2:M^=(255&o.charCodeAt(P+1))<<8;case 1:y^=M=(65535&(M=(M=(65535&(M^=255&o.charCodeAt(P)))*A+(((M>>>16)*A&65535)<<16)&4294967295)<<15|M>>>17))*E+(((M>>>16)*E&65535)<<16)&4294967295}return y^=o.length,y=2246822507*(65535&(y^=y>>>16))+((2246822507*(y>>>16)&65535)<<16)&4294967295,y=3266489909*(65535&(y^=y>>>13))+((3266489909*(y>>>16)&65535)<<16)&4294967295,(y^=y>>>16)>>>0}),ui.exports),i=(ar||(ar=1,Vr.exports=function(o,h){for(var p,g=o.length,y=h^g,x=0;g>=4;)p=1540483477*(65535&(p=255&o.charCodeAt(x)|(255&o.charCodeAt(++x))<<8|(255&o.charCodeAt(++x))<<16|(255&o.charCodeAt(++x))<<24))+((1540483477*(p>>>16)&65535)<<16),y=1540483477*(65535&y)+((1540483477*(y>>>16)&65535)<<16)^(p=1540483477*(65535&(p^=p>>>24))+((1540483477*(p>>>16)&65535)<<16)),g-=4,++x;switch(g){case 3:y^=(255&o.charCodeAt(x+2))<<16;case 2:y^=(255&o.charCodeAt(x+1))<<8;case 1:y=1540483477*(65535&(y^=255&o.charCodeAt(x)))+((1540483477*(y>>>16)&65535)<<16)}return y=1540483477*(65535&(y^=y>>>13))+((1540483477*(y>>>16)&65535)<<16),(y^=y>>>15)>>>0}),Vr.exports);return lr.exports=l,lr.exports.murmur3=l,lr.exports.murmur2=i,lr.exports})(),Li=C(Qr);class bn{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(i,o,h,p){this.ids.push(mo(i)),this.positions.push(o,h,p)}getPositions(i){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const o=mo(i);let h=0,p=this.ids.length-1;for(;h<p;){const y=h+p>>1;this.ids[y]>=o?p=y:h=y+1}const g=[];for(;this.ids[h]===o;)g.push({index:this.positions[3*h],start:this.positions[3*h+1],end:this.positions[3*h+2]}),h++;return g}static serialize(i,o){const h=new Float64Array(i.ids),p=new Uint32Array(i.positions);return Un(h,p,0,h.length-1),o&&o.push(h.buffer,p.buffer),{ids:h,positions:p}}static deserialize(i){const o=new bn;return o.ids=i.ids,o.positions=i.positions,o.indexed=!0,o}}function mo(l){const i=+l;return!isNaN(i)&&i<=Number.MAX_SAFE_INTEGER?i:Li(String(l))}function Un(l,i,o,h){for(;o<h;){const p=l[o+h>>1];let g=o-1,y=h+1;for(;;){do g++;while(l[g]<p);do y--;while(l[y]>p);if(g>=y)break;zn(l,g,y),zn(i,3*g,3*y),zn(i,3*g+1,3*y+1),zn(i,3*g+2,3*y+2)}y-o<h-y?(Un(l,i,o,y),o=y+1):(Un(l,i,y+1,h),h=y)}}function zn(l,i,o){const h=l[i];l[i]=l[o],l[o]=h}oe("FeaturePositionMap",bn);class Ss{constructor(i,o){this.gl=i.gl,this.location=o}}class Ho extends Ss{constructor(i,o){super(i,o),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1f(this.location,i))}}class Go extends Ss{constructor(i,o){super(i,o),this.current=[0,0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]&&i[3]===this.current[3]||(this.current=i,this.gl.uniform4f(this.location,i[0],i[1],i[2],i[3]))}}class us extends Ss{constructor(i,o){super(i,o),this.current=Te.transparent}set(i){i.r===this.current.r&&i.g===this.current.g&&i.b===this.current.b&&i.a===this.current.a||(this.current=i,this.gl.uniform4f(this.location,i.r,i.g,i.b,i.a))}}const yo=new Float32Array(16);function Vn(l){return[qe(255*l.r,255*l.g),qe(255*l.b,255*l.a)]}class jn{constructor(i,o,h){this.value=i,this.uniformNames=o.map((p=>`u_${p}`)),this.type=h}setUniform(i,o,h){i.set(h.constantOr(this.value))}getBinding(i,o,h){return this.type==="color"?new us(i,o):new Ho(i,o)}}class Ir{constructor(i,o){this.uniformNames=o.map((h=>`u_${h}`)),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(i,o){this.pixelRatioFrom=o.pixelRatio,this.pixelRatioTo=i.pixelRatio,this.patternFrom=o.tlbr,this.patternTo=i.tlbr}setConstantDashPositions(i,o){this.dashTo=[0,i.y,i.height,i.width],this.dashFrom=[0,o.y,o.height,o.width]}setUniform(i,o,h,p){let g=null;p==="u_pattern_to"?g=this.patternTo:p==="u_pattern_from"?g=this.patternFrom:p==="u_dasharray_to"?g=this.dashTo:p==="u_dasharray_from"?g=this.dashFrom:p==="u_pixel_ratio_to"?g=this.pixelRatioTo:p==="u_pixel_ratio_from"&&(g=this.pixelRatioFrom),g!==null&&i.set(g)}getBinding(i,o,h){return h.substr(0,9)==="u_pattern"||h.substr(0,12)==="u_dasharray_"?new Go(i,o):new Ho(i,o)}}class wr{constructor(i,o,h,p){this.expression=i,this.type=h,this.maxValue=0,this.paintVertexAttributes=o.map((g=>({name:`a_${g}`,type:"Float32",components:h==="color"?2:1,offset:0}))),this.paintVertexArray=new p}populatePaintArray(i,o,h){const p=this.paintVertexArray.length,g=this.expression.evaluate(new or(0,h),o,{},h.canonical,[],h.formattedSection);this.paintVertexArray.resize(i),this._setPaintValue(p,i,g)}updatePaintArray(i,o,h,p,g){const y=this.expression.evaluate(new or(0,g),h,p);this._setPaintValue(i,o,y)}_setPaintValue(i,o,h){if(this.type==="color"){const p=Vn(h);for(let g=i;g<o;g++)this.paintVertexArray.emplace(g,p[0],p[1])}else{for(let p=i;p<o;p++)this.paintVertexArray.emplace(p,h);this.maxValue=Math.max(this.maxValue,Math.abs(h))}}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class jr{constructor(i,o,h,p,g,y){this.expression=i,this.uniformNames=o.map((x=>`u_${x}_t`)),this.type=h,this.useIntegerZoom=p,this.zoom=g,this.maxValue=0,this.paintVertexAttributes=o.map((x=>({name:`a_${x}`,type:"Float32",components:h==="color"?4:2,offset:0}))),this.paintVertexArray=new y}populatePaintArray(i,o,h){const p=this.expression.evaluate(new or(this.zoom,h),o,{},h.canonical,[],h.formattedSection),g=this.expression.evaluate(new or(this.zoom+1,h),o,{},h.canonical,[],h.formattedSection),y=this.paintVertexArray.length;this.paintVertexArray.resize(i),this._setPaintValue(y,i,p,g)}updatePaintArray(i,o,h,p,g){const y=this.expression.evaluate(new or(this.zoom,g),h,p),x=this.expression.evaluate(new or(this.zoom+1,g),h,p);this._setPaintValue(i,o,y,x)}_setPaintValue(i,o,h,p){if(this.type==="color"){const g=Vn(h),y=Vn(p);for(let x=i;x<o;x++)this.paintVertexArray.emplace(x,g[0],g[1],y[0],y[1])}else{for(let g=i;g<o;g++)this.paintVertexArray.emplace(g,h,p);this.maxValue=Math.max(this.maxValue,Math.abs(h),Math.abs(p))}}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(i,o){const h=this.useIntegerZoom?Math.floor(o.zoom):o.zoom,p=wi(this.expression.interpolationFactor(h,this.zoom,this.zoom+1),0,1);i.set(p)}getBinding(i,o,h){return new Ho(i,o)}}class Mr{constructor(i,o,h,p,g,y){this.expression=i,this.type=o,this.useIntegerZoom=h,this.zoom=p,this.layerId=y,this.zoomInPaintVertexArray=new g,this.zoomOutPaintVertexArray=new g}populatePaintArray(i,o,h){const p=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(i),this.zoomOutPaintVertexArray.resize(i),this._setPaintValues(p,i,this.getPositionIds(o),h)}updatePaintArray(i,o,h,p,g){this._setPaintValues(i,o,this.getPositionIds(h),g)}_setPaintValues(i,o,h,p){const g=this.getPositions(p);if(!g||!h)return;const y=g[h.min],x=g[h.mid],A=g[h.max];if(y&&x&&A)for(let E=i;E<o;E++)this.emplace(this.zoomInPaintVertexArray,E,x,y),this.emplace(this.zoomOutPaintVertexArray,E,x,A)}upload(i){if(this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer){const o=this.getVertexAttributes();this.zoomInPaintVertexBuffer=i.createVertexBuffer(this.zoomInPaintVertexArray,o,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=i.createVertexBuffer(this.zoomOutPaintVertexArray,o,this.expression.isStateDependent)}}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class __ extends Mr{getPositions(i){return i.imagePositions}getPositionIds(i){return i.patterns&&i.patterns[this.layerId]}getVertexAttributes(){return xr.members}emplace(i,o,h,p){i.emplace(o,h.tlbr[0],h.tlbr[1],h.tlbr[2],h.tlbr[3],p.tlbr[0],p.tlbr[1],p.tlbr[2],p.tlbr[3],h.pixelRatio,p.pixelRatio)}}class g_ extends Mr{getPositions(i){return i.dashPositions}getPositionIds(i){return i.dashes&&i.dashes[this.layerId]}getVertexAttributes(){return pr.members}emplace(i,o,h,p){i.emplace(o,0,h.y,h.height,h.width,0,p.y,p.height,p.width)}}class m_{constructor(i,o,h){this.binders={},this._buffers=[];const p=[];for(const g in i.paint._values){if(!h(g))continue;const y=i.paint.get(g);if(!(y instanceof Ks&&Pa(y.property.specification)))continue;const x=y0(g,i.type),A=y.value,E=y.property.specification.type,M=y.property.useIntegerZoom,P=y.property.specification["property-type"],F=P==="cross-faded"||P==="cross-faded-data-driven";if(A.kind==="constant")this.binders[g]=F?new Ir(A.value,x):new jn(A.value,x,E),p.push(`/u_${g}`);else if(A.kind==="source"||F){const O=y_(g,E,"source");this.binders[g]=F?g==="line-dasharray"?new g_(A,E,M,o,O,i.id):new __(A,E,M,o,O,i.id):new wr(A,x,E,O),p.push(`/a_${g}`)}else{const O=y_(g,E,"composite");this.binders[g]=new jr(A,x,E,M,o,O),p.push(`/z_${g}`)}}this.cacheKey=p.sort().join("")}getMaxValue(i){const o=this.binders[i];return o instanceof wr||o instanceof jr?o.maxValue:0}populatePaintArrays(i,o,h){for(const p in this.binders){const g=this.binders[p];(g instanceof wr||g instanceof jr||g instanceof Mr)&&g.populatePaintArray(i,o,h)}}setConstantPatternPositions(i,o){for(const h in this.binders){const p=this.binders[h];p instanceof Ir&&p.setConstantPatternPositions(i,o)}}setConstantDashPositions(i,o){for(const h in this.binders){const p=this.binders[h];p instanceof Ir&&p.setConstantDashPositions(i,o)}}updatePaintArrays(i,o,h,p,g){let y=!1;for(const x in i){const A=o.getPositions(x);for(const E of A){const M=h.feature(E.index);for(const P in this.binders){const F=this.binders[P];if((F instanceof wr||F instanceof jr||F instanceof Mr)&&F.expression.isStateDependent===!0){const O=p.paint.get(P);F.expression=O.value,F.updatePaintArray(E.start,E.end,M,i[x],g),y=!0}}}}return y}defines(){const i=[];for(const o in this.binders){const h=this.binders[o];(h instanceof jn||h instanceof Ir)&&i.push(...h.uniformNames.map((p=>`#define HAS_UNIFORM_${p}`)))}return i}getBinderAttributes(){const i=[];for(const o in this.binders){const h=this.binders[o];if(h instanceof wr||h instanceof jr)for(let p=0;p<h.paintVertexAttributes.length;p++)i.push(h.paintVertexAttributes[p].name);else if(h instanceof Mr){const p=h.getVertexAttributes();for(const g of p)i.push(g.name)}}return i}getBinderUniforms(){const i=[];for(const o in this.binders){const h=this.binders[o];if(h instanceof jn||h instanceof Ir||h instanceof jr)for(const p of h.uniformNames)i.push(p)}return i}getPaintVertexBuffers(){return this._buffers}getUniforms(i,o){const h=[];for(const p in this.binders){const g=this.binders[p];if(g instanceof jn||g instanceof Ir||g instanceof jr){for(const y of g.uniformNames)if(o[y]){const x=g.getBinding(i,o[y],y);h.push({name:y,property:p,binding:x})}}}return h}setUniforms(i,o,h,p){for(const{name:g,property:y,binding:x}of o)this.binders[y].setUniform(x,p,h.get(y),g)}updatePaintBuffers(i){this._buffers=[];for(const o in this.binders){const h=this.binders[o];if(i&&h instanceof Mr){const p=i.fromScale===2?h.zoomInPaintVertexBuffer:h.zoomOutPaintVertexBuffer;p&&this._buffers.push(p)}else(h instanceof wr||h instanceof jr)&&h.paintVertexBuffer&&this._buffers.push(h.paintVertexBuffer)}}upload(i){for(const o in this.binders){const h=this.binders[o];(h instanceof wr||h instanceof jr||h instanceof Mr)&&h.upload(i)}this.updatePaintBuffers()}destroy(){for(const i in this.binders){const o=this.binders[i];(o instanceof wr||o instanceof jr||o instanceof Mr)&&o.destroy()}}}class $o{constructor(i,o,h=()=>!0){this.programConfigurations={};for(const p of i)this.programConfigurations[p.id]=new m_(p,o,h);this.needsUpload=!1,this._featureMap=new bn,this._bufferOffset=0}populatePaintArrays(i,o,h,p){for(const g in this.programConfigurations)this.programConfigurations[g].populatePaintArrays(i,o,p);o.id!==void 0&&this._featureMap.add(o.id,h,this._bufferOffset,i),this._bufferOffset=i,this.needsUpload=!0}updatePaintArrays(i,o,h,p){for(const g of h)this.needsUpload=this.programConfigurations[g.id].updatePaintArrays(i,this._featureMap,o,g,p)||this.needsUpload}get(i){return this.programConfigurations[i]}upload(i){if(this.needsUpload){for(const o in this.programConfigurations)this.programConfigurations[o].upload(i);this.needsUpload=!1}}destroy(){for(const i in this.programConfigurations)this.programConfigurations[i].destroy()}}function y0(l,i){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-dasharray":["dasharray_to","dasharray_from"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[l]||[l.replace(`${i}-`,"").replace(/-/g,"_")]}function y_(l,i,o){const h={color:{source:Js,composite:_},number:{source:jl,composite:Js}},p=(function(g){return{"line-pattern":{source:mt,composite:mt},"fill-pattern":{source:mt,composite:mt},"fill-extrusion-pattern":{source:mt,composite:mt},"line-dasharray":{source:dt,composite:dt}}[g]})(l);return p&&p[o]||h[i][o]}oe("ConstantBinder",jn),oe("CrossFadedConstantBinder",Ir),oe("SourceExpressionBinder",wr),oe("CrossFadedPatternBinder",__),oe("CrossFadedDasharrayBinder",g_),oe("CompositeExpressionBinder",jr),oe("ProgramConfiguration",m_,{omit:["_buffers"]}),oe("ProgramConfigurationSet",$o);const Hn=Math.pow(2,14)-1,Pd=-Hn-1;function bo(l){const i=Le/l.extent,o=l.loadGeometry();for(let h=0;h<o.length;h++){const p=o[h];for(let g=0;g<p.length;g++){const y=p[g],x=Math.round(y.x*i),A=Math.round(y.y*i);y.x=wi(x,Pd,Hn),y.y=wi(A,Pd,Hn),(x<y.x||x>y.x+1||A<y.y||A>y.y+1)&&Je("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return o}function vo(l,i){return{type:l.type,id:l.id,properties:l.properties,geometry:i?bo(l):[]}}const Su=-32768;function b_(l,i,o,h,p){l.emplaceBack(Su+8*i+h,Su+8*o+p)}class Hl{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map((o=>o.id)),this.index=i.index,this.hasDependencies=!1,this.layoutVertexArray=new st,this.indexArray=new qt,this.segments=new pe,this.programConfigurations=new $o(i.layers,i.zoom),this.stateDependentLayerIds=this.layers.filter((o=>o.isStateDependent())).map((o=>o.id))}populate(i,o,h){const p=this.layers[0],g=[];let y=null,x=!1,A=p.type==="heatmap";if(p.type==="circle"){const M=p;y=M.layout.get("circle-sort-key"),x=!y.isConstant(),A=A||M.paint.get("circle-pitch-alignment")==="map"}const E=A?o.subdivisionGranularity.circle:1;for(const{feature:M,id:P,index:F,sourceLayerIndex:O}of i){const N=this.layers[0]._featureFilter.needGeometry,z=vo(M,N);if(!this.layers[0]._featureFilter.filter(new or(this.zoom),z,h))continue;const H=x?y.evaluate(z,{},h):void 0,q={id:P,properties:M.properties,type:M.type,sourceLayerIndex:O,index:F,geometry:N?z.geometry:bo(M),patterns:{},sortKey:H};g.push(q)}x&&g.sort(((M,P)=>M.sortKey-P.sortKey));for(const M of g){const{geometry:P,index:F,sourceLayerIndex:O}=M,N=i[F].feature;this.addFeature(M,P,F,h,E),o.featureIndex.insert(N,P,F,O,this.index)}}update(i,o,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,o,this.stateDependentLayers,{imagePositions:h})}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,he),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(i,o,h,p,g=1){let y;switch(g){case 1:y=[0,7];break;case 3:y=[0,2,5,7];break;case 5:y=[0,1,3,4,6,7];break;case 7:y=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${g}; valid values are 1, 3, 5, 7.`)}const x=y.length;for(const A of o)for(const E of A){const M=E.x,P=E.y;if(M<0||M>=Le||P<0||P>=Le)continue;const F=this.segments.prepareSegment(x*x,this.layoutVertexArray,this.indexArray,i.sortKey),O=F.vertexLength;for(let N=0;N<x;N++)for(let z=0;z<x;z++)b_(this.layoutVertexArray,M,P,y[z],y[N]);for(let N=0;N<x-1;N++)for(let z=0;z<x-1;z++){const H=O+N*x+z,q=O+(N+1)*x+z;this.indexArray.emplaceBack(H,q+1,H+1),this.indexArray.emplaceBack(H,q,q+1)}F.vertexLength+=x*x,F.primitiveLength+=(x-1)*(x-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,h,{imagePositions:{},canonical:p})}}function qA(l,i){for(let o=0;o<l.length;o++)if(Cu(i,l[o]))return!0;for(let o=0;o<i.length;o++)if(Cu(l,i[o]))return!0;return!!b0(l,i)}function v_(l,i,o){return!!Cu(l,i)||!!v0(i,l,o)}function ZA(l,i){if(l.length===1)return KA(i,l[0]);for(let o=0;o<i.length;o++){const h=i[o];for(let p=0;p<h.length;p++)if(Cu(l,h[p]))return!0}for(let o=0;o<l.length;o++)if(KA(i,l[o]))return!0;for(let o=0;o<i.length;o++)if(b0(l,i[o]))return!0;return!1}function W8(l,i,o){if(l.length>1){if(b0(l,i))return!0;for(let h=0;h<i.length;h++)if(v0(i[h],l,o))return!0}for(let h=0;h<l.length;h++)if(v0(l[h],i,o))return!0;return!1}function b0(l,i){if(l.length===0||i.length===0)return!1;for(let o=0;o<l.length-1;o++){const h=l[o],p=l[o+1];for(let g=0;g<i.length-1;g++)if(X8(h,p,i[g],i[g+1]))return!0}return!1}function X8(l,i,o,h){return Ti(l,o,h)!==Ti(i,o,h)&&Ti(l,i,o)!==Ti(l,i,h)}function v0(l,i,o){const h=o*o;if(i.length===1)return l.distSqr(i[0])<h;for(let p=1;p<i.length;p++)if(YA(l,i[p-1],i[p])<h)return!0;return!1}function YA(l,i,o){const h=i.distSqr(o);if(h===0)return l.distSqr(i);const p=((l.x-i.x)*(o.x-i.x)+(l.y-i.y)*(o.y-i.y))/h;return l.distSqr(p<0?i:p>1?o:o.sub(i)._mult(p)._add(i))}function KA(l,i){let o,h,p,g=!1;for(let y=0;y<l.length;y++){o=l[y];for(let x=0,A=o.length-1;x<o.length;A=x++)h=o[x],p=o[A],h.y>i.y!=p.y>i.y&&i.x<(p.x-h.x)*(i.y-h.y)/(p.y-h.y)+h.x&&(g=!g)}return g}function Cu(l,i){let o=!1;for(let h=0,p=l.length-1;h<l.length;p=h++){const g=l[h],y=l[p];g.y>i.y!=y.y>i.y&&i.x<(y.x-g.x)*(i.y-g.y)/(y.y-g.y)+g.x&&(o=!o)}return o}function q8(l,i,o){const h=o[0],p=o[2];if(l.x<h.x&&i.x<h.x||l.x>p.x&&i.x>p.x||l.y<h.y&&i.y<h.y||l.y>p.y&&i.y>p.y)return!1;const g=Ti(l,i,o[0]);return g!==Ti(l,i,o[1])||g!==Ti(l,i,o[2])||g!==Ti(l,i,o[3])}function Iu(l,i,o){const h=i.paint.get(l).value;return h.kind==="constant"?h.value:o.programConfigurations.get(i.id).getMaxValue(l)}function x_(l){return Math.sqrt(l[0]*l[0]+l[1]*l[1])}function w_(l,i,o,h,p){if(!i[0]&&!i[1])return l;const g=T.convert(i)._mult(p);o==="viewport"&&g._rotate(-h);const y=[];for(let x=0;x<l.length;x++)y.push(l[x].sub(g));return y}function Z8({queryGeometry:l,size:i},o){return v_(l,o,i)}function Y8({queryGeometry:l,size:i,transform:o,unwrappedTileID:h,getElevation:p},g){return v_(l,g,i*(o.projectTileCoordinates(g.x,g.y,h,p).signedDistanceFromCamera/o.cameraToCenterDistance))}function K8({queryGeometry:l,size:i,transform:o,unwrappedTileID:h,getElevation:p},g){const y=o.projectTileCoordinates(g.x,g.y,h,p).signedDistanceFromCamera,x=i*(o.cameraToCenterDistance/y);return v_(l,x0(g,o,h,p),x)}function J8({queryGeometry:l,size:i,transform:o,unwrappedTileID:h,getElevation:p},g){return v_(l,x0(g,o,h,p),i)}function JA({queryGeometry:l,size:i,transform:o,unwrappedTileID:h,getElevation:p,pitchAlignment:g="map",pitchScale:y="map"},x){const A=g==="map"?y==="map"?Z8:Y8:y==="map"?K8:J8,E={queryGeometry:l,size:i,transform:o,unwrappedTileID:h,getElevation:p};for(const M of x)for(const P of M)if(A(E,P))return!0;return!1}function x0(l,i,o,h){const p=i.projectTileCoordinates(l.x,l.y,o,h).point;return new T((.5*p.x+.5)*i.width,(.5*-p.y+.5)*i.height)}let QA,tE;oe("CircleBucket",Hl,{omit:["layers"]});var Q8={get paint(){return tE=tE||new Xi({"circle-radius":new xe(tt.paint_circle["circle-radius"]),"circle-color":new xe(tt.paint_circle["circle-color"]),"circle-blur":new xe(tt.paint_circle["circle-blur"]),"circle-opacity":new xe(tt.paint_circle["circle-opacity"]),"circle-translate":new fe(tt.paint_circle["circle-translate"]),"circle-translate-anchor":new fe(tt.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new fe(tt.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new fe(tt.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new xe(tt.paint_circle["circle-stroke-width"]),"circle-stroke-color":new xe(tt.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new xe(tt.paint_circle["circle-stroke-opacity"])})},get layout(){return QA=QA||new Xi({"circle-sort-key":new xe(tt.layout_circle["circle-sort-key"])})}};class tV extends Es{constructor(i,o){super(i,Q8,o)}createBucket(i){return new Hl(i)}queryRadius(i){const o=i;return Iu("circle-radius",this,o)+Iu("circle-stroke-width",this,o)+x_(this.paint.get("circle-translate"))}queryIntersectsFeature({queryGeometry:i,feature:o,featureState:h,geometry:p,transform:g,pixelsToTileUnits:y,unwrappedTileID:x,getElevation:A}){const E=w_(i,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-g.bearingInRadians,y),M=this.paint.get("circle-radius").evaluate(o,h)+this.paint.get("circle-stroke-width").evaluate(o,h),P=this.paint.get("circle-pitch-scale"),F=this.paint.get("circle-pitch-alignment");let O,N;return F==="map"?(O=E,N=M*y):(O=(function(z,H,q,ct){return z.map((J=>x0(J,H,q,ct)))})(E,g,x,A),N=M),JA({queryGeometry:O,size:N,transform:g,unwrappedTileID:x,getElevation:A,pitchAlignment:F,pitchScale:P},p)}}class eE extends Hl{}let rE;oe("HeatmapBucket",eE,{omit:["layers"]});var eV={get paint(){return rE=rE||new Xi({"heatmap-radius":new xe(tt.paint_heatmap["heatmap-radius"]),"heatmap-weight":new xe(tt.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new fe(tt.paint_heatmap["heatmap-intensity"]),"heatmap-color":new vu(tt.paint_heatmap["heatmap-color"]),"heatmap-opacity":new fe(tt.paint_heatmap["heatmap-opacity"])})}};function w0(l,{width:i,height:o},h,p){if(p){if(p instanceof Uint8ClampedArray)p=new Uint8Array(p.buffer);else if(p.length!==i*o*h)throw new RangeError(`mismatched image size. expected: ${p.length} but got: ${i*o*h}`)}else p=new Uint8Array(i*o*h);return l.width=i,l.height=o,l.data=p,l}function iE(l,{width:i,height:o},h){if(i===l.width&&o===l.height)return;const p=w0({},{width:i,height:o},h);T0(l,p,{x:0,y:0},{x:0,y:0},{width:Math.min(l.width,i),height:Math.min(l.height,o)},h),l.width=i,l.height=o,l.data=p.data}function T0(l,i,o,h,p,g){if(p.width===0||p.height===0)return i;if(p.width>l.width||p.height>l.height||o.x>l.width-p.width||o.y>l.height-p.height)throw new RangeError("out of range source coordinates for image copy");if(p.width>i.width||p.height>i.height||h.x>i.width-p.width||h.y>i.height-p.height)throw new RangeError("out of range destination coordinates for image copy");const y=l.data,x=i.data;if(y===x)throw new Error("srcData equals dstData, so image is already copied");for(let A=0;A<p.height;A++){const E=((o.y+A)*l.width+o.x)*g,M=((h.y+A)*i.width+h.x)*g;for(let P=0;P<p.width*g;P++)x[M+P]=y[E+P]}return i}class Bd{constructor(i,o){w0(this,i,1,o)}resize(i){iE(this,i,1)}clone(){return new Bd({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(i,o,h,p,g){T0(i,o,h,p,g,1)}}class hs{constructor(i,o){w0(this,i,4,o)}resize(i){iE(this,i,4)}replace(i,o){o?this.data.set(i):this.data=i instanceof Uint8ClampedArray?new Uint8Array(i.buffer):i}clone(){return new hs({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(i,o,h,p,g){T0(i,o,h,p,g,4)}setPixel(i,o,h){const p=4*(i*this.width+o);this.data[p+0]=Math.round(255*h.r/h.a),this.data[p+1]=Math.round(255*h.g/h.a),this.data[p+2]=Math.round(255*h.b/h.a),this.data[p+3]=Math.round(255*h.a)}}function sE(l){const i={},o=l.resolution||256,h=l.clips?l.clips.length:1,p=l.image||new hs({width:o,height:h});if(Math.log(o)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${o}`);const g=(y,x,A)=>{i[l.evaluationKey]=A;const E=l.expression.evaluate(i);p.setPixel(y/4/o,x/4,E)};if(l.clips)for(let y=0,x=0;y<h;++y,x+=4*o)for(let A=0,E=0;A<o;A++,E+=4){const M=A/(o-1),{start:P,end:F}=l.clips[y];g(x,E,P*(1-M)+F*M)}else for(let y=0,x=0;y<o;y++,x+=4)g(0,x,y/(o-1));return p}oe("AlphaImage",Bd),oe("RGBAImage",hs);const A0="big-fb";class rV extends Es{createBucket(i){return new eE(i)}constructor(i,o){super(i,eV,o),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(i){i==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=sE({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(A0)&&this.heatmapFbos.delete(A0)}queryRadius(i){return Iu("heatmap-radius",this,i)}queryIntersectsFeature({queryGeometry:i,feature:o,featureState:h,geometry:p,transform:g,pixelsToTileUnits:y,unwrappedTileID:x,getElevation:A}){return JA({queryGeometry:i,size:this.paint.get("heatmap-radius").evaluate(o,h)*y,transform:g,unwrappedTileID:x,getElevation:A},p)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let nE;var iV={get paint(){return nE=nE||new Xi({"hillshade-illumination-direction":new fe(tt.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-altitude":new fe(tt.paint_hillshade["hillshade-illumination-altitude"]),"hillshade-illumination-anchor":new fe(tt.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new fe(tt.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new fe(tt.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new fe(tt.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new fe(tt.paint_hillshade["hillshade-accent-color"]),"hillshade-method":new fe(tt.paint_hillshade["hillshade-method"])})}};class sV extends Es{constructor(i,o){super(i,iV,o),this.recalculate({zoom:0,zoomHistory:{}},void 0)}getIlluminationProperties(){let i=this.paint.get("hillshade-illumination-direction").values,o=this.paint.get("hillshade-illumination-altitude").values,h=this.paint.get("hillshade-highlight-color").values,p=this.paint.get("hillshade-shadow-color").values;const g=Math.max(i.length,o.length,h.length,p.length);i=i.concat(Array(g-i.length).fill(i.at(-1))),o=o.concat(Array(g-o.length).fill(o.at(-1))),h=h.concat(Array(g-h.length).fill(h.at(-1))),p=p.concat(Array(g-p.length).fill(p.at(-1)));const y=o.map(Dn);return{directionRadians:i.map(Dn),altitudeRadians:y,shadowColor:p,highlightColor:h}}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}let oE;var nV={get paint(){return oE=oE||new Xi({"color-relief-opacity":new fe(tt["paint_color-relief"]["color-relief-opacity"]),"color-relief-color":new vu(tt["paint_color-relief"]["color-relief-color"])})}};class E0{constructor(i,o,h,p){this.context=i,this.format=h,this.texture=i.gl.createTexture(),this.update(o,p)}update(i,o,h){const{width:p,height:g}=i,y=!(this.size&&this.size[0]===p&&this.size[1]===g||h),{context:x}=this,{gl:A}=x;if(this.useMipmap=!!(o&&o.useMipmap),A.bindTexture(A.TEXTURE_2D,this.texture),x.pixelStoreUnpackFlipY.set(!1),x.pixelStoreUnpack.set(1),x.pixelStoreUnpackPremultiplyAlpha.set(this.format===A.RGBA&&(!o||o.premultiply!==!1)),y)this.size=[p,g],i instanceof HTMLImageElement||i instanceof HTMLCanvasElement||i instanceof HTMLVideoElement||i instanceof ImageData||os(i)?A.texImage2D(A.TEXTURE_2D,0,this.format,this.format,A.UNSIGNED_BYTE,i):A.texImage2D(A.TEXTURE_2D,0,this.format,p,g,0,this.format,A.UNSIGNED_BYTE,i.data);else{const{x:E,y:M}=h||{x:0,y:0};i instanceof HTMLImageElement||i instanceof HTMLCanvasElement||i instanceof HTMLVideoElement||i instanceof ImageData||os(i)?A.texSubImage2D(A.TEXTURE_2D,0,E,M,A.RGBA,A.UNSIGNED_BYTE,i):A.texSubImage2D(A.TEXTURE_2D,0,E,M,p,g,A.RGBA,A.UNSIGNED_BYTE,i.data)}this.useMipmap&&this.isSizePowerOfTwo()&&A.generateMipmap(A.TEXTURE_2D),x.pixelStoreUnpackFlipY.setDefault(),x.pixelStoreUnpack.setDefault(),x.pixelStoreUnpackPremultiplyAlpha.setDefault()}bind(i,o,h){const{context:p}=this,{gl:g}=p;g.bindTexture(g.TEXTURE_2D,this.texture),h!==g.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(h=g.LINEAR),i!==this.filter&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,i),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,h||i),this.filter=i),o!==this.wrap&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,o),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,o),this.wrap=o)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:i}=this.context;i.deleteTexture(this.texture),this.texture=null}}class aE{constructor(i,o,h,p=1,g=1,y=1,x=0){if(this.uid=i,o.height!==o.width)throw new RangeError("DEM tiles must be square");if(h&&!["mapbox","terrarium","custom"].includes(h))return void Je(`"${h}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=o.height;const A=this.dim=o.height-2;switch(this.data=new Uint32Array(o.data.buffer),h){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=p,this.greenFactor=g,this.blueFactor=y,this.baseShift=x;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let E=0;E<A;E++)this.data[this._idx(-1,E)]=this.data[this._idx(0,E)],this.data[this._idx(A,E)]=this.data[this._idx(A-1,E)],this.data[this._idx(E,-1)]=this.data[this._idx(E,0)],this.data[this._idx(E,A)]=this.data[this._idx(E,A-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(A,-1)]=this.data[this._idx(A-1,0)],this.data[this._idx(-1,A)]=this.data[this._idx(0,A-1)],this.data[this._idx(A,A)]=this.data[this._idx(A-1,A-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let E=0;E<A;E++)for(let M=0;M<A;M++){const P=this.get(E,M);P>this.max&&(this.max=P),P<this.min&&(this.min=P)}}get(i,o){const h=new Uint8Array(this.data.buffer),p=4*this._idx(i,o);return this.unpack(h[p],h[p+1],h[p+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(i,o){if(i<-1||i>=this.dim+1||o<-1||o>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(o+1)*this.stride+(i+1)}unpack(i,o,h){return i*this.redFactor+o*this.greenFactor+h*this.blueFactor-this.baseShift}pack(i){return lE(i,this.getUnpackVector())}getPixels(){return new hs({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(i,o,h){if(this.dim!==i.dim)throw new Error("dem dimension mismatch");let p=o*this.dim,g=o*this.dim+this.dim,y=h*this.dim,x=h*this.dim+this.dim;switch(o){case-1:p=g-1;break;case 1:g=p+1}switch(h){case-1:y=x-1;break;case 1:x=y+1}const A=-o*this.dim,E=-h*this.dim;for(let M=y;M<x;M++)for(let P=p;P<g;P++)this.data[this._idx(P,M)]=i.data[this._idx(P+A,M+E)]}}function lE(l,i){const o=i[0],h=i[1],p=i[2],g=i[3],y=Math.min(o,h,p),x=Math.round((l+g)/y);return{r:Math.floor(x*y/o)%256,g:Math.floor(x*y/h)%256,b:Math.floor(x*y/p)%256}}oe("DEMData",aE);class oV extends Es{constructor(i,o){super(i,nV,o)}_createColorRamp(i){const o={elevationStops:[],colorStops:[]},h=this._transitionablePaint._values["color-relief-color"].value.expression;if(h instanceof Uo&&h._styleExpression.expression instanceof Si){this.colorRampExpression=h;const y=h._styleExpression.expression;o.elevationStops=y.labels,o.colorStops=[];for(const x of o.elevationStops)o.colorStops.push(y.evaluate({globals:{elevation:x}}))}if(o.elevationStops.length<1&&(o.elevationStops=[0],o.colorStops=[Te.transparent]),o.elevationStops.length<2&&(o.elevationStops.push(o.elevationStops[0]+1),o.colorStops.push(o.colorStops[0])),o.elevationStops.length<=i)return o;const p={elevationStops:[],colorStops:[]},g=(o.elevationStops.length-1)/(i-1);for(let y=0;y<o.elevationStops.length-.5;y+=g)p.elevationStops.push(o.elevationStops[Math.round(y)]),p.colorStops.push(o.colorStops[Math.round(y)]);return Je(`Too many colors in specification of ${this.id} color-relief layer, may not render properly. Max possible colors: ${i}, provided: ${o.elevationStops.length}`),p}_colorRampChanged(){return this.colorRampExpression!=this._transitionablePaint._values["color-relief-color"].value.expression}getColorRampTextures(i,o,h){if(this.colorRampTextures&&!this._colorRampChanged())return this.colorRampTextures;const p=this._createColorRamp(o),g=new hs({width:p.colorStops.length,height:1}),y=new hs({width:p.colorStops.length,height:1});for(let x=0;x<p.elevationStops.length;x++){const A=lE(p.elevationStops[x],h);y.setPixel(0,x,new Te(A.r/255,A.g/255,A.b/255,1)),g.setPixel(0,x,p.colorStops[x])}return this.colorRampTextures={elevationTexture:new E0(i,y,i.gl.RGBA),colorTexture:new E0(i,g,i.gl.RGBA)},this.colorRampTextures}hasOffscreenPass(){return this.visibility!=="none"&&!!this.colorRampTextures}}const aV=fr([{name:"a_pos",components:2,type:"Int16"}],4),{members:lV}=aV;function T_(l,i,o){const h=o.patternDependencies;let p=!1;for(const g of i){const y=g.paint.get(`${l}-pattern`);y.isConstant()||(p=!0);const x=y.constantOr(null);x&&(p=!0,h[x.to]=!0,h[x.from]=!0)}return p}function S0(l,i,o,h,p){const{zoom:g}=h,y=p.patternDependencies;for(const x of i){const A=x.paint.get(`${l}-pattern`).value;if(A.kind!=="constant"){let E=A.evaluate({zoom:g-1},o,{},p.availableImages),M=A.evaluate({zoom:g},o,{},p.availableImages),P=A.evaluate({zoom:g+1},o,{},p.availableImages);E=E&&E.name?E.name:E,M=M&&M.name?M.name:M,P=P&&P.name?P.name:P,y[E]=!0,y[M]=!0,y[P]=!0,o.patterns[x.id]={min:E,mid:M,max:P}}}return o}function cE(l,i,o,h,p){let g;if(p===(function(y,x,A,E){let M=0;for(let P=x,F=A-E;P<A;P+=E)M+=(y[F]-y[P])*(y[P+1]+y[F+1]),F=P;return M})(l,i,o,h)>0)for(let y=i;y<o;y+=h)g=fE(y/h|0,l[y],l[y+1],g);else for(let y=o-h;y>=i;y-=h)g=fE(y/h|0,l[y],l[y+1],g);return g&&Mu(g,g.next)&&(kd(g),g=g.next),g}function Gl(l,i){if(!l)return l;i||(i=l);let o,h=l;do if(o=!1,h.steiner||!Mu(h,h.next)&&Wr(h.prev,h,h.next)!==0)h=h.next;else{if(kd(h),h=i=h.prev,h===h.next)break;o=!0}while(o||h!==i);return i}function Dd(l,i,o,h,p,g,y){if(!l)return;!y&&g&&(function(A,E,M,P){let F=A;do F.z===0&&(F.z=C0(F.x,F.y,E,M,P)),F.prevZ=F.prev,F.nextZ=F.next,F=F.next;while(F!==A);F.prevZ.nextZ=null,F.prevZ=null,(function(O){let N,z=1;do{let H,q=O;O=null;let ct=null;for(N=0;q;){N++;let J=q,rt=0;for(let vt=0;vt<z&&(rt++,J=J.nextZ,J);vt++);let pt=z;for(;rt>0||pt>0&&J;)rt!==0&&(pt===0||!J||q.z<=J.z)?(H=q,q=q.nextZ,rt--):(H=J,J=J.nextZ,pt--),ct?ct.nextZ=H:O=H,H.prevZ=ct,ct=H;q=J}ct.nextZ=null,z*=2}while(N>1)})(F)})(l,h,p,g);let x=l;for(;l.prev!==l.next;){const A=l.prev,E=l.next;if(g?uV(l,h,p,g):cV(l))i.push(A.i,l.i,E.i),kd(l),l=E.next,x=E.next;else if((l=E)===x){y?y===1?Dd(l=hV(Gl(l),i),i,o,h,p,g,2):y===2&&dV(l,i,o,h,p,g):Dd(Gl(l),i,o,h,p,g,1);break}}}function cV(l){const i=l.prev,o=l,h=l.next;if(Wr(i,o,h)>=0)return!1;const p=i.x,g=o.x,y=h.x,x=i.y,A=o.y,E=h.y,M=Math.min(p,g,y),P=Math.min(x,A,E),F=Math.max(p,g,y),O=Math.max(x,A,E);let N=h.next;for(;N!==i;){if(N.x>=M&&N.x<=F&&N.y>=P&&N.y<=O&&Fd(p,x,g,A,y,E,N.x,N.y)&&Wr(N.prev,N,N.next)>=0)return!1;N=N.next}return!0}function uV(l,i,o,h){const p=l.prev,g=l,y=l.next;if(Wr(p,g,y)>=0)return!1;const x=p.x,A=g.x,E=y.x,M=p.y,P=g.y,F=y.y,O=Math.min(x,A,E),N=Math.min(M,P,F),z=Math.max(x,A,E),H=Math.max(M,P,F),q=C0(O,N,i,o,h),ct=C0(z,H,i,o,h);let J=l.prevZ,rt=l.nextZ;for(;J&&J.z>=q&&rt&&rt.z<=ct;){if(J.x>=O&&J.x<=z&&J.y>=N&&J.y<=H&&J!==p&&J!==y&&Fd(x,M,A,P,E,F,J.x,J.y)&&Wr(J.prev,J,J.next)>=0||(J=J.prevZ,rt.x>=O&&rt.x<=z&&rt.y>=N&&rt.y<=H&&rt!==p&&rt!==y&&Fd(x,M,A,P,E,F,rt.x,rt.y)&&Wr(rt.prev,rt,rt.next)>=0))return!1;rt=rt.nextZ}for(;J&&J.z>=q;){if(J.x>=O&&J.x<=z&&J.y>=N&&J.y<=H&&J!==p&&J!==y&&Fd(x,M,A,P,E,F,J.x,J.y)&&Wr(J.prev,J,J.next)>=0)return!1;J=J.prevZ}for(;rt&&rt.z<=ct;){if(rt.x>=O&&rt.x<=z&&rt.y>=N&&rt.y<=H&&rt!==p&&rt!==y&&Fd(x,M,A,P,E,F,rt.x,rt.y)&&Wr(rt.prev,rt,rt.next)>=0)return!1;rt=rt.nextZ}return!0}function hV(l,i){let o=l;do{const h=o.prev,p=o.next.next;!Mu(h,p)&&hE(h,o,o.next,p)&&Od(h,p)&&Od(p,h)&&(i.push(h.i,o.i,p.i),kd(o),kd(o.next),o=l=p),o=o.next}while(o!==l);return Gl(o)}function dV(l,i,o,h,p,g){let y=l;do{let x=y.next.next;for(;x!==y.prev;){if(y.i!==x.i&&mV(y,x)){let A=dE(y,x);return y=Gl(y,y.next),A=Gl(A,A.next),Dd(y,i,o,h,p,g,0),void Dd(A,i,o,h,p,g,0)}x=x.next}y=y.next}while(y!==l)}function fV(l,i){let o=l.x-i.x;return o===0&&(o=l.y-i.y,o===0)&&(o=(l.next.y-l.y)/(l.next.x-l.x)-(i.next.y-i.y)/(i.next.x-i.x)),o}function pV(l,i){const o=(function(p,g){let y=g;const x=p.x,A=p.y;let E,M=-1/0;if(Mu(p,y))return y;do{if(Mu(p,y.next))return y.next;if(A<=y.y&&A>=y.next.y&&y.next.y!==y.y){const z=y.x+(A-y.y)*(y.next.x-y.x)/(y.next.y-y.y);if(z<=x&&z>M&&(M=z,E=y.x<y.next.x?y:y.next,z===x))return E}y=y.next}while(y!==g);if(!E)return null;const P=E,F=E.x,O=E.y;let N=1/0;y=E;do{if(x>=y.x&&y.x>=F&&x!==y.x&&uE(A<O?x:M,A,F,O,A<O?M:x,A,y.x,y.y)){const z=Math.abs(A-y.y)/(x-y.x);Od(y,p)&&(z<N||z===N&&(y.x>E.x||y.x===E.x&&_V(E,y)))&&(E=y,N=z)}y=y.next}while(y!==P);return E})(l,i);if(!o)return i;const h=dE(o,l);return Gl(h,h.next),Gl(o,o.next)}function _V(l,i){return Wr(l.prev,l,i.prev)<0&&Wr(i.next,l,l.next)<0}function C0(l,i,o,h,p){return(l=1431655765&((l=858993459&((l=252645135&((l=16711935&((l=(l-o)*p|0)|l<<8))|l<<4))|l<<2))|l<<1))|(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-h)*p|0)|i<<8))|i<<4))|i<<2))|i<<1))<<1}function gV(l){let i=l,o=l;do(i.x<o.x||i.x===o.x&&i.y<o.y)&&(o=i),i=i.next;while(i!==l);return o}function uE(l,i,o,h,p,g,y,x){return(p-y)*(i-x)>=(l-y)*(g-x)&&(l-y)*(h-x)>=(o-y)*(i-x)&&(o-y)*(g-x)>=(p-y)*(h-x)}function Fd(l,i,o,h,p,g,y,x){return!(l===y&&i===x)&&uE(l,i,o,h,p,g,y,x)}function mV(l,i){return l.next.i!==i.i&&l.prev.i!==i.i&&!(function(o,h){let p=o;do{if(p.i!==o.i&&p.next.i!==o.i&&p.i!==h.i&&p.next.i!==h.i&&hE(p,p.next,o,h))return!0;p=p.next}while(p!==o);return!1})(l,i)&&(Od(l,i)&&Od(i,l)&&(function(o,h){let p=o,g=!1;const y=(o.x+h.x)/2,x=(o.y+h.y)/2;do p.y>x!=p.next.y>x&&p.next.y!==p.y&&y<(p.next.x-p.x)*(x-p.y)/(p.next.y-p.y)+p.x&&(g=!g),p=p.next;while(p!==o);return g})(l,i)&&(Wr(l.prev,l,i.prev)||Wr(l,i.prev,i))||Mu(l,i)&&Wr(l.prev,l,l.next)>0&&Wr(i.prev,i,i.next)>0)}function Wr(l,i,o){return(i.y-l.y)*(o.x-i.x)-(i.x-l.x)*(o.y-i.y)}function Mu(l,i){return l.x===i.x&&l.y===i.y}function hE(l,i,o,h){const p=E_(Wr(l,i,o)),g=E_(Wr(l,i,h)),y=E_(Wr(o,h,l)),x=E_(Wr(o,h,i));return p!==g&&y!==x||!(p!==0||!A_(l,o,i))||!(g!==0||!A_(l,h,i))||!(y!==0||!A_(o,l,h))||!(x!==0||!A_(o,i,h))}function A_(l,i,o){return i.x<=Math.max(l.x,o.x)&&i.x>=Math.min(l.x,o.x)&&i.y<=Math.max(l.y,o.y)&&i.y>=Math.min(l.y,o.y)}function E_(l){return l>0?1:l<0?-1:0}function Od(l,i){return Wr(l.prev,l,l.next)<0?Wr(l,i,l.next)>=0&&Wr(l,l.prev,i)>=0:Wr(l,i,l.prev)<0||Wr(l,l.next,i)<0}function dE(l,i){const o=I0(l.i,l.x,l.y),h=I0(i.i,i.x,i.y),p=l.next,g=i.prev;return l.next=i,i.prev=l,o.next=p,p.prev=o,h.next=o,o.prev=h,g.next=h,h.prev=g,h}function fE(l,i,o,h){const p=I0(l,i,o);return h?(p.next=h.next,p.prev=h,h.next.prev=p,h.next=p):(p.prev=p,p.next=p),p}function kd(l){l.next.prev=l.prev,l.prev.next=l.next,l.prevZ&&(l.prevZ.nextZ=l.nextZ),l.nextZ&&(l.nextZ.prevZ=l.prevZ)}function I0(l,i,o){return{i:l,x:i,y:o,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class Ru{constructor(i,o){if(o>i)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=i,this._minGranularity=o}getGranularityForZoomLevel(i){return Math.max(Math.floor(this._baseZoomGranularity/(1<<i)),this._minGranularity,1)}}class S_{constructor(i){this.fill=i.fill,this.line=i.line,this.tile=i.tile,this.stencil=i.stencil,this.circle=i.circle}}S_.noSubdivision=new S_({fill:new Ru(0,0),line:new Ru(0,0),tile:new Ru(0,0),stencil:new Ru(0,0),circle:1}),oe("SubdivisionGranularityExpression",Ru),oe("SubdivisionGranularitySetting",S_);const Pu=-32768,Nd=32767;class yV{constructor(i,o){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=i,this._granularityCellSize=Le/i,this._canonical=o}_getKey(i,o){return(i+=32768)<<16|o+32768}_vertexToIndex(i,o){if(i<-32768||o<-32768||i>32767||o>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");const h=0|Math.round(i),p=0|Math.round(o),g=this._getKey(h,p);if(this._vertexDictionary.has(g))return this._vertexDictionary.get(g);const y=this._vertexBuffer.length/2;return this._vertexDictionary.set(g,y),this._vertexBuffer.push(h,p),y}_subdivideTrianglesScanline(i){if(this._granularity<2)return(function(p,g){const y=[];for(let x=0;x<g.length;x+=3){const A=g[x],E=g[x+1],M=g[x+2],P=p[2*A],F=p[2*A+1];(p[2*E]-P)*(p[2*M+1]-F)-(p[2*E+1]-F)*(p[2*M]-P)>0?(y.push(A),y.push(M),y.push(E)):(y.push(A),y.push(E),y.push(M))}return y})(this._vertexBuffer,i);const o=[],h=i.length;for(let p=0;p<h;p+=3){const g=[i[p+0],i[p+1],i[p+2]],y=[this._vertexBuffer[2*i[p+0]+0],this._vertexBuffer[2*i[p+0]+1],this._vertexBuffer[2*i[p+1]+0],this._vertexBuffer[2*i[p+1]+1],this._vertexBuffer[2*i[p+2]+0],this._vertexBuffer[2*i[p+2]+1]];let x=1/0,A=1/0,E=-1/0,M=-1/0;for(let z=0;z<3;z++){const H=y[2*z],q=y[2*z+1];x=Math.min(x,H),E=Math.max(E,H),A=Math.min(A,q),M=Math.max(M,q)}if(x===E||A===M)continue;const P=Math.floor(x/this._granularityCellSize),F=Math.ceil(E/this._granularityCellSize),O=Math.floor(A/this._granularityCellSize),N=Math.ceil(M/this._granularityCellSize);if(P!==F||O!==N)for(let z=O;z<N;z++){const H=this._scanlineGenerateVertexRingForCellRow(z,y,g);bV(this._vertexBuffer,H,o)}else o.push(...g)}return o}_scanlineGenerateVertexRingForCellRow(i,o,h){const p=i*this._granularityCellSize,g=p+this._granularityCellSize,y=[];for(let x=0;x<3;x++){const A=o[2*x],E=o[2*x+1],M=o[2*(x+1)%6],P=o[(2*(x+1)+1)%6],F=o[2*(x+2)%6],O=o[(2*(x+2)+1)%6],N=M-A,z=P-E,H=N===0,q=z===0,ct=(p-E)/z,J=(g-E)/z,rt=Math.min(ct,J),pt=Math.max(ct,J);if(!q&&(rt>=1||pt<=0)||q&&(E<p||E>g)){P>=p&&P<=g&&y.push(h[(x+1)%3]);continue}!q&&rt>0&&y.push(this._vertexToIndex(A+N*rt,E+z*rt));const vt=A+N*Math.max(rt,0),Pt=A+N*Math.min(pt,1);H||this._generateIntraEdgeVertices(y,A,E,M,P,vt,Pt),!q&&pt<1&&y.push(this._vertexToIndex(A+N*pt,E+z*pt)),(q||P>=p&&P<=g)&&y.push(h[(x+1)%3]),!q&&(P<=p||P>=g)&&this._generateInterEdgeVertices(y,A,E,M,P,F,O,Pt,p,g)}return y}_generateIntraEdgeVertices(i,o,h,p,g,y,x){const A=p-o,E=g-h,M=E===0,P=M?Math.min(o,p):Math.min(y,x),F=M?Math.max(o,p):Math.max(y,x),O=Math.floor(P/this._granularityCellSize)+1,N=Math.ceil(F/this._granularityCellSize)-1;if(M?o<p:y<x)for(let z=O;z<=N;z++){const H=z*this._granularityCellSize;i.push(this._vertexToIndex(H,h+E*(H-o)/A))}else for(let z=N;z>=O;z--){const H=z*this._granularityCellSize;i.push(this._vertexToIndex(H,h+E*(H-o)/A))}}_generateInterEdgeVertices(i,o,h,p,g,y,x,A,E,M){const P=g-h,F=y-p,O=x-g,N=(E-g)/O,z=(M-g)/O,H=Math.min(N,z),q=Math.max(N,z),ct=p+F*H;let J=Math.floor(Math.min(ct,A)/this._granularityCellSize)+1,rt=Math.ceil(Math.max(ct,A)/this._granularityCellSize)-1,pt=A<ct;const vt=O===0;if(vt&&(x===E||x===M))return;if(vt||H>=1||q<=0){const jt=h-x,Vt=y+(o-y)*Math.min((E-x)/jt,(M-x)/jt);J=Math.floor(Math.min(Vt,A)/this._granularityCellSize)+1,rt=Math.ceil(Math.max(Vt,A)/this._granularityCellSize)-1,pt=A<Vt}const Pt=P>0?M:E;if(pt)for(let jt=J;jt<=rt;jt++)i.push(this._vertexToIndex(jt*this._granularityCellSize,Pt));else for(let jt=rt;jt>=J;jt--)i.push(this._vertexToIndex(jt*this._granularityCellSize,Pt))}_generateOutline(i){const o=[];for(const h of i){const p=$l(h,this._granularity,!0),g=this._pointArrayToIndices(p),y=[];for(let x=1;x<g.length;x++)y.push(g[x-1]),y.push(g[x]);o.push(y)}return o}_handlePoles(i){let o=!1,h=!1;this._canonical&&(this._canonical.y===0&&(o=!0),this._canonical.y===(1<<this._canonical.z)-1&&(h=!0)),(o||h)&&this._fillPoles(i,o,h)}_ensureNoPoleVertices(){const i=this._vertexBuffer;for(let o=0;o<i.length;o+=2){const h=i[o+1];h===Pu&&(i[o+1]=-32767),h===Nd&&(i[o+1]=32766)}}_generatePoleQuad(i,o,h,p,g,y){p>g!=(y===Pu)?(i.push(o),i.push(h),i.push(this._vertexToIndex(p,y)),i.push(h),i.push(this._vertexToIndex(g,y)),i.push(this._vertexToIndex(p,y))):(i.push(h),i.push(o),i.push(this._vertexToIndex(p,y)),i.push(this._vertexToIndex(g,y)),i.push(h),i.push(this._vertexToIndex(p,y)))}_fillPoles(i,o,h){const p=this._vertexBuffer,g=Le,y=i.length;for(let x=2;x<y;x+=3){const A=i[x-2],E=i[x-1],M=i[x],P=p[2*A],F=p[2*A+1],O=p[2*E],N=p[2*E+1],z=p[2*M],H=p[2*M+1];o&&(F===0&&N===0&&this._generatePoleQuad(i,A,E,P,O,Pu),N===0&&H===0&&this._generatePoleQuad(i,E,M,O,z,Pu),H===0&&F===0&&this._generatePoleQuad(i,M,A,z,P,Pu)),h&&(F===g&&N===g&&this._generatePoleQuad(i,A,E,P,O,Nd),N===g&&H===g&&this._generatePoleQuad(i,E,M,O,z,Nd),H===g&&F===g&&this._generatePoleQuad(i,M,A,z,P,Nd))}}_initializeVertices(i){for(let o=0;o<i.length;o+=2)this._vertexToIndex(i[o],i[o+1])}subdividePolygonInternal(i,o){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;const{flattened:h,holeIndices:p}=(function(x){const A=[],E=[];for(const M of x)if(M.length!==0){M!==x[0]&&A.push(E.length/2);for(let P=0;P<M.length;P++)E.push(M[P].x),E.push(M[P].y)}return{flattened:E,holeIndices:A}})(i);let g;this._initializeVertices(h);try{const x=(function(E,M,P=2){const F=M&&M.length,O=F?M[0]*P:E.length;let N=cE(E,0,O,P,!0);const z=[];if(!N||N.next===N.prev)return z;let H,q,ct;if(F&&(N=(function(J,rt,pt,vt){const Pt=[];for(let jt=0,Vt=rt.length;jt<Vt;jt++){const $t=cE(J,rt[jt]*vt,jt<Vt-1?rt[jt+1]*vt:J.length,vt,!1);$t===$t.next&&($t.steiner=!0),Pt.push(gV($t))}Pt.sort(fV);for(let jt=0;jt<Pt.length;jt++)pt=pV(Pt[jt],pt);return pt})(E,M,N,P)),E.length>80*P){H=E[0],q=E[1];let J=H,rt=q;for(let pt=P;pt<O;pt+=P){const vt=E[pt],Pt=E[pt+1];vt<H&&(H=vt),Pt<q&&(q=Pt),vt>J&&(J=vt),Pt>rt&&(rt=Pt)}ct=Math.max(J-H,rt-q),ct=ct!==0?32767/ct:0}return Dd(N,z,P,H,q,ct,0),z})(h,p),A=this._convertIndices(h,x);g=this._subdivideTrianglesScanline(A)}catch(x){console.error(x)}let y=[];return o&&(y=this._generateOutline(i)),this._ensureNoPoleVertices(),this._handlePoles(g),{verticesFlattened:this._vertexBuffer,indicesTriangles:g,indicesLineList:y}}_convertIndices(i,o){const h=[];for(let p=0;p<o.length;p++)h.push(this._vertexToIndex(i[2*o[p]],i[2*o[p]+1]));return h}_pointArrayToIndices(i){const o=[];for(let h=0;h<i.length;h++){const p=i[h];o.push(this._vertexToIndex(p.x,p.y))}return o}}function pE(l,i,o,h=!0){return new yV(o,i).subdividePolygonInternal(l,h)}function $l(l,i,o=!1){if(!l||l.length<1)return[];if(l.length<2)return[];const h=l[0],p=l[l.length-1],g=o&&(h.x!==p.x||h.y!==p.y);if(i<2)return g?[...l,l[0]]:[...l];const y=Math.floor(Le/i),x=[];x.push(new T(l[0].x,l[0].y));const A=l.length,E=g?A:A-1;for(let M=0;M<E;M++){const P=l[M],F=M<A-1?l[M+1]:l[0],O=P.x,N=P.y,z=F.x,H=F.y,q=O!==z,ct=N!==H;if(!q&&!ct)continue;const J=z-O,rt=H-N,pt=Math.abs(J),vt=Math.abs(rt);let Pt=O,jt=N;for(;;){const $t=J>0?(Math.floor(Pt/y)+1)*y:(Math.ceil(Pt/y)-1)*y,se=rt>0?(Math.floor(jt/y)+1)*y:(Math.ceil(jt/y)-1)*y,Yt=Math.abs(Pt-$t),Kt=Math.abs(jt-se),zt=Math.abs(Pt-z),ye=Math.abs(jt-H),_e=q?Yt/pt:Number.POSITIVE_INFINITY,me=ct?Kt/vt:Number.POSITIVE_INFINITY;if((zt<=Yt||!q)&&(ye<=Kt||!ct))break;if(_e<me&&q||!ct){Pt=$t,jt+=rt*_e;const ce=new T(Pt,Math.round(jt));x[x.length-1].x===ce.x&&x[x.length-1].y===ce.y||x.push(ce)}else{Pt+=J*me,jt=se;const ce=new T(Math.round(Pt),jt);x[x.length-1].x===ce.x&&x[x.length-1].y===ce.y||x.push(ce)}}const Vt=new T(z,H);x[x.length-1].x===Vt.x&&x[x.length-1].y===Vt.y||x.push(Vt)}return x}function bV(l,i,o){if(i.length===0)throw new Error("Subdivision vertex ring is empty.");let h=0,p=l[2*i[0]];for(let A=1;A<i.length;A++){const E=l[2*i[A]];E<p&&(p=E,h=A)}const g=i.length;let y=h,x=(y+1)%g;for(;;){const A=y-1>=0?y-1:g-1,E=(x+1)%g,M=l[2*i[A]],P=l[2*i[E]],F=l[2*i[y]],O=l[2*i[y]+1],N=l[2*i[x]+1];let z=!1;if(M<P)z=!0;else if(M>P)z=!1;else{const H=N-O,q=-(l[2*i[x]]-F),ct=O<N?1:-1;((M-F)*H+(l[2*i[A]+1]-O)*q)*ct>((P-F)*H+(l[2*i[E]+1]-O)*q)*ct&&(z=!0)}if(z){const H=i[A],q=i[y],ct=i[x];H!==q&&H!==ct&&q!==ct&&o.push(ct,q,H),y--,y<0&&(y=g-1)}else{const H=i[E],q=i[y],ct=i[x];H!==q&&H!==ct&&q!==ct&&o.push(ct,q,H),x++,x>=g&&(x=0)}if(A===E)break}}function _E(l,i,o,h,p,g,y,x,A){const E=p.length/2,M=y&&x&&A;if(E<pe.MAX_VERTEX_ARRAY_LENGTH){const P=i.prepareSegment(E,o,h),F=P.vertexLength;for(let z=0;z<g.length;z+=3)h.emplaceBack(F+g[z],F+g[z+1],F+g[z+2]);let O,N;P.vertexLength+=E,P.primitiveLength+=g.length/3,M&&(N=y.prepareSegment(E,o,x),O=N.vertexLength,N.vertexLength+=E);for(let z=0;z<p.length;z+=2)l(p[z],p[z+1]);if(M)for(let z=0;z<A.length;z++){const H=A[z];for(let q=1;q<H.length;q+=2)x.emplaceBack(O+H[q-1],O+H[q]);N.primitiveLength+=H.length/2}}else(function(P,F,O,N,z,H){const q=[];for(let vt=0;vt<N.length/2;vt++)q.push(-1);const ct={count:0};let J=0,rt=P.getOrCreateLatestSegment(F,O),pt=rt.vertexLength;for(let vt=2;vt<z.length;vt+=3){const Pt=z[vt-2],jt=z[vt-1],Vt=z[vt];let $t=q[Pt]<J,se=q[jt]<J,Yt=q[Vt]<J;rt.vertexLength+(($t?1:0)+(se?1:0)+(Yt?1:0))>pe.MAX_VERTEX_ARRAY_LENGTH&&(rt=P.createNewSegment(F,O),J=ct.count,$t=!0,se=!0,Yt=!0,pt=0);const Kt=Ld(q,N,H,ct,Pt,$t,rt),zt=Ld(q,N,H,ct,jt,se,rt),ye=Ld(q,N,H,ct,Vt,Yt,rt);O.emplaceBack(pt+Kt-J,pt+zt-J,pt+ye-J),rt.primitiveLength++}})(i,o,h,p,g,l),M&&(function(P,F,O,N,z,H){const q=[];for(let vt=0;vt<N.length/2;vt++)q.push(-1);const ct={count:0};let J=0,rt=P.getOrCreateLatestSegment(F,O),pt=rt.vertexLength;for(let vt=0;vt<z.length;vt++){const Pt=z[vt];for(let jt=1;jt<z[vt].length;jt+=2){const Vt=Pt[jt-1],$t=Pt[jt];let se=q[Vt]<J,Yt=q[$t]<J;rt.vertexLength+((se?1:0)+(Yt?1:0))>pe.MAX_VERTEX_ARRAY_LENGTH&&(rt=P.createNewSegment(F,O),J=ct.count,se=!0,Yt=!0,pt=0);const Kt=Ld(q,N,H,ct,Vt,se,rt),zt=Ld(q,N,H,ct,$t,Yt,rt);O.emplaceBack(pt+Kt-J,pt+zt-J),rt.primitiveLength++}}})(y,o,x,p,A,l),i.forceNewSegmentOnNextPrepare(),y?.forceNewSegmentOnNextPrepare()}function Ld(l,i,o,h,p,g,y){if(g){const x=h.count;return o(i[2*p],i[2*p+1]),l[p]=h.count,h.count++,y.vertexLength++,x}return l[p]}class M0{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map((o=>o.id)),this.index=i.index,this.hasDependencies=!1,this.patternFeatures=[],this.layoutVertexArray=new ut,this.indexArray=new qt,this.indexArray2=new Zt,this.programConfigurations=new $o(i.layers,i.zoom),this.segments=new pe,this.segments2=new pe,this.stateDependentLayerIds=this.layers.filter((o=>o.isStateDependent())).map((o=>o.id))}populate(i,o,h){this.hasDependencies=T_("fill",this.layers,o);const p=this.layers[0].layout.get("fill-sort-key"),g=!p.isConstant(),y=[];for(const{feature:x,id:A,index:E,sourceLayerIndex:M}of i){const P=this.layers[0]._featureFilter.needGeometry,F=vo(x,P);if(!this.layers[0]._featureFilter.filter(new or(this.zoom),F,h))continue;const O=g?p.evaluate(F,{},h,o.availableImages):void 0,N={id:A,properties:x.properties,type:x.type,sourceLayerIndex:M,index:E,geometry:P?F.geometry:bo(x),patterns:{},sortKey:O};y.push(N)}g&&y.sort(((x,A)=>x.sortKey-A.sortKey));for(const x of y){const{geometry:A,index:E,sourceLayerIndex:M}=x;if(this.hasDependencies){const P=S0("fill",this.layers,x,{zoom:this.zoom},o);this.patternFeatures.push(P)}else this.addFeature(x,A,E,h,{},o.subdivisionGranularity);o.featureIndex.insert(i[E].feature,A,E,M,this.index)}}update(i,o,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,o,this.stateDependentLayers,{imagePositions:h})}addFeatures(i,o,h){for(const p of this.patternFeatures)this.addFeature(p,p.geometry,p.index,o,h,i.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,lV),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.indexBuffer2=i.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(i,o,h,p,g,y){for(const x of xl(o,500)){const A=pE(x,p,y.fill.getGranularityForZoomLevel(p.z)),E=this.layoutVertexArray;_E(((M,P)=>{E.emplaceBack(M,P)}),this.segments,this.layoutVertexArray,this.indexArray,A.verticesFlattened,A.indicesTriangles,this.segments2,this.indexArray2,A.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,h,{imagePositions:g,canonical:p})}}let gE,mE;oe("FillBucket",M0,{omit:["layers","patternFeatures"]});var vV={get paint(){return mE=mE||new Xi({"fill-antialias":new fe(tt.paint_fill["fill-antialias"]),"fill-opacity":new xe(tt.paint_fill["fill-opacity"]),"fill-color":new xe(tt.paint_fill["fill-color"]),"fill-outline-color":new xe(tt.paint_fill["fill-outline-color"]),"fill-translate":new fe(tt.paint_fill["fill-translate"]),"fill-translate-anchor":new fe(tt.paint_fill["fill-translate-anchor"]),"fill-pattern":new Nl(tt.paint_fill["fill-pattern"])})},get layout(){return gE=gE||new Xi({"fill-sort-key":new xe(tt.layout_fill["fill-sort-key"])})}};class xV extends Es{constructor(i,o){super(i,vV,o)}recalculate(i,o){super.recalculate(i,o);const h=this.paint._values["fill-outline-color"];h.value.kind==="constant"&&h.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(i){return new M0(i)}queryRadius(){return x_(this.paint.get("fill-translate"))}queryIntersectsFeature({queryGeometry:i,geometry:o,transform:h,pixelsToTileUnits:p}){return ZA(w_(i,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-h.bearingInRadians,p),o)}isTileClipped(){return!0}}const wV=fr([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),TV=fr([{name:"a_centroid",components:2,type:"Int16"}],4),{members:AV}=wV;class Bu{constructor(i,o,h,p,g){this.properties={},this.extent=h,this.type=0,this.id=void 0,this._pbf=i,this._geometry=-1,this._keys=p,this._values=g,i.readFields(EV,this,o)}loadGeometry(){const i=this._pbf;i.pos=this._geometry;const o=i.readVarint()+i.pos,h=[];let p,g=1,y=0,x=0,A=0;for(;i.pos<o;){if(y<=0){const E=i.readVarint();g=7&E,y=E>>3}if(y--,g===1||g===2)x+=i.readSVarint(),A+=i.readSVarint(),g===1&&(p&&h.push(p),p=[]),p&&p.push(new T(x,A));else{if(g!==7)throw new Error(`unknown command ${g}`);p&&p.push(p[0].clone())}}return p&&h.push(p),h}bbox(){const i=this._pbf;i.pos=this._geometry;const o=i.readVarint()+i.pos;let h=1,p=0,g=0,y=0,x=1/0,A=-1/0,E=1/0,M=-1/0;for(;i.pos<o;){if(p<=0){const P=i.readVarint();h=7&P,p=P>>3}if(p--,h===1||h===2)g+=i.readSVarint(),y+=i.readSVarint(),g<x&&(x=g),g>A&&(A=g),y<E&&(E=y),y>M&&(M=y);else if(h!==7)throw new Error(`unknown command ${h}`)}return[x,E,A,M]}toGeoJSON(i,o,h){const p=this.extent*Math.pow(2,h),g=this.extent*i,y=this.extent*o,x=this.loadGeometry();function A(F){return[360*(F.x+g)/p-180,360/Math.PI*Math.atan(Math.exp((1-2*(F.y+y)/p)*Math.PI))-90]}function E(F){return F.map(A)}let M;if(this.type===1){const F=[];for(const N of x)F.push(N[0]);const O=E(F);M=F.length===1?{type:"Point",coordinates:O[0]}:{type:"MultiPoint",coordinates:O}}else if(this.type===2){const F=x.map(E);M=F.length===1?{type:"LineString",coordinates:F[0]}:{type:"MultiLineString",coordinates:F}}else{if(this.type!==3)throw new Error("unknown feature type");{const F=(function(N){const z=N.length;if(z<=1)return[N];const H=[];let q,ct;for(let J=0;J<z;J++){const rt=SV(N[J]);rt!==0&&(ct===void 0&&(ct=rt<0),ct===rt<0?(q&&H.push(q),q=[N[J]]):q&&q.push(N[J]))}return q&&H.push(q),H})(x),O=[];for(const N of F)O.push(N.map(E));M=O.length===1?{type:"Polygon",coordinates:O[0]}:{type:"MultiPolygon",coordinates:O}}}const P={type:"Feature",geometry:M,properties:this.properties};return this.id!=null&&(P.id=this.id),P}}function EV(l,i,o){l===1?i.id=o.readVarint():l===2?(function(h,p){const g=h.readVarint()+h.pos;for(;h.pos<g;){const y=p._keys[h.readVarint()],x=p._values[h.readVarint()];p.properties[y]=x}})(o,i):l===3?i.type=o.readVarint():l===4&&(i._geometry=o.pos)}function SV(l){let i=0;for(let o,h,p=0,g=l.length,y=g-1;p<g;y=p++)o=l[p],h=l[y],i+=(h.x-o.x)*(o.y+h.y);return i}Bu.types=["Unknown","Point","LineString","Polygon"];class yE{constructor(i,o){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(CV,this,o),this.length=this._features.length}feature(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];const o=this._pbf.readVarint()+this._pbf.pos;return new Bu(this._pbf,o,this.extent,this._keys,this._values)}}function CV(l,i,o){l===15?i.version=o.readVarint():l===1?i.name=o.readString():l===5?i.extent=o.readVarint():l===2?i._features.push(o.pos):l===3?i._keys.push(o.readString()):l===4&&i._values.push((function(h){let p=null;const g=h.readVarint()+h.pos;for(;h.pos<g;){const y=h.readVarint()>>3;p=y===1?h.readString():y===2?h.readFloat():y===3?h.readDouble():y===4?h.readVarint64():y===5?h.readVarint():y===6?h.readSVarint():y===7?h.readBoolean():null}if(p==null)throw new Error("unknown feature value");return p})(o))}class bE{constructor(i,o){this.layers=i.readFields(IV,{},o)}}function IV(l,i,o){if(l===3){const h=new yE(o,o.readVarint()+o.pos);h.length&&(i[h.name]=h)}}const R0=Math.pow(2,13);function Ud(l,i,o,h,p,g,y,x){l.emplaceBack(i,o,2*Math.floor(h*R0)+y,p*R0*2,g*R0*2,Math.round(x))}class P0{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map((o=>o.id)),this.index=i.index,this.hasDependencies=!1,this.layoutVertexArray=new _t,this.centroidVertexArray=new et,this.indexArray=new qt,this.programConfigurations=new $o(i.layers,i.zoom),this.segments=new pe,this.stateDependentLayerIds=this.layers.filter((o=>o.isStateDependent())).map((o=>o.id))}populate(i,o,h){this.features=[],this.hasDependencies=T_("fill-extrusion",this.layers,o);for(const{feature:p,id:g,index:y,sourceLayerIndex:x}of i){const A=this.layers[0]._featureFilter.needGeometry,E=vo(p,A);if(!this.layers[0]._featureFilter.filter(new or(this.zoom),E,h))continue;const M={id:g,sourceLayerIndex:x,index:y,geometry:A?E.geometry:bo(p),properties:p.properties,type:p.type,patterns:{}};this.hasDependencies?this.features.push(S0("fill-extrusion",this.layers,M,{zoom:this.zoom},o)):this.addFeature(M,M.geometry,y,h,{},o.subdivisionGranularity),o.featureIndex.insert(p,M.geometry,y,x,this.index,!0)}}addFeatures(i,o,h){for(const p of this.features){const{geometry:g}=p;this.addFeature(p,g,p.index,o,h,i.subdivisionGranularity)}}update(i,o,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,o,this.stateDependentLayers,{imagePositions:h})}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,AV),this.centroidVertexBuffer=i.createVertexBuffer(this.centroidVertexArray,TV.members,!0),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(i,o,h,p,g,y){for(const x of xl(o,500)){const A={x:0,y:0,sampleCount:0},E=this.layoutVertexArray.length;this.processPolygon(A,p,i,x,y);const M=this.layoutVertexArray.length-E,P=Math.floor(A.x/A.sampleCount),F=Math.floor(A.y/A.sampleCount);for(let O=0;O<M;O++)this.centroidVertexArray.emplaceBack(P,F)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,h,{imagePositions:g,canonical:p})}processPolygon(i,o,h,p,g){if(p.length<1||vE(p[0]))return;for(const P of p)P.length!==0&&MV(i,P);const y={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},x=g.fill.getGranularityForZoomLevel(o.z),A=Bu.types[h.type]==="Polygon";for(const P of p){if(P.length===0||vE(P))continue;const F=$l(P,x,A);this._generateSideFaces(F,y)}if(!A)return;const E=pE(p,o,x,!1),M=this.layoutVertexArray;_E(((P,F)=>{Ud(M,P,F,0,0,1,1,0)}),this.segments,this.layoutVertexArray,this.indexArray,E.verticesFlattened,E.indicesTriangles)}_generateSideFaces(i,o){let h=0;for(let p=1;p<i.length;p++){const g=i[p],y=i[p-1];if(RV(g,y))continue;o.segment.vertexLength+4>pe.MAX_VERTEX_ARRAY_LENGTH&&(o.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const x=g.sub(y)._perp()._unit(),A=y.dist(g);h+A>32768&&(h=0),Ud(this.layoutVertexArray,g.x,g.y,x.x,x.y,0,0,h),Ud(this.layoutVertexArray,g.x,g.y,x.x,x.y,0,1,h),h+=A,Ud(this.layoutVertexArray,y.x,y.y,x.x,x.y,0,0,h),Ud(this.layoutVertexArray,y.x,y.y,x.x,x.y,0,1,h);const E=o.segment.vertexLength;this.indexArray.emplaceBack(E,E+2,E+1),this.indexArray.emplaceBack(E+1,E+2,E+3),o.segment.vertexLength+=4,o.segment.primitiveLength+=2}}}function MV(l,i){for(let o=0;o<i.length;o++){const h=i[o];o===i.length-1&&i[0].x===h.x&&i[0].y===h.y||(l.x+=h.x,l.y+=h.y,l.sampleCount++)}}function RV(l,i){return l.x===i.x&&(l.x<0||l.x>Le)||l.y===i.y&&(l.y<0||l.y>Le)}function vE(l){return l.every((i=>i.x<0))||l.every((i=>i.x>Le))||l.every((i=>i.y<0))||l.every((i=>i.y>Le))}let xE;oe("FillExtrusionBucket",P0,{omit:["layers","features"]});var PV={get paint(){return xE=xE||new Xi({"fill-extrusion-opacity":new fe(tt["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new xe(tt["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new fe(tt["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new fe(tt["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Nl(tt["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new xe(tt["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new xe(tt["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new fe(tt["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class BV extends Es{constructor(i,o){super(i,PV,o)}createBucket(i){return new P0(i)}queryRadius(){return x_(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature({queryGeometry:i,feature:o,featureState:h,geometry:p,transform:g,pixelsToTileUnits:y,pixelPosMatrix:x}){const A=w_(i,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-g.bearingInRadians,y),E=this.paint.get("fill-extrusion-height").evaluate(o,h),M=this.paint.get("fill-extrusion-base").evaluate(o,h),P=(function(O,N){const z=[];for(const H of O){const q=[H.x,H.y,0,1];Ce(q,q,N),z.push(new T(q[0]/q[3],q[1]/q[3]))}return z})(A,x),F=(function(O,N,z,H){const q=[],ct=[],J=H[8]*N,rt=H[9]*N,pt=H[10]*N,vt=H[11]*N,Pt=H[8]*z,jt=H[9]*z,Vt=H[10]*z,$t=H[11]*z;for(const se of O){const Yt=[],Kt=[];for(const zt of se){const ye=zt.x,_e=zt.y,me=H[0]*ye+H[4]*_e+H[12],ce=H[1]*ye+H[5]*_e+H[13],De=H[2]*ye+H[6]*_e+H[14],Lr=H[3]*ye+H[7]*_e+H[15],si=De+pt,Vi=Lr+vt,en=me+Pt,ds=ce+jt,Ci=De+Vt,Dr=Lr+$t,pi=new T((me+J)/Vi,(ce+rt)/Vi);pi.z=si/Vi,Yt.push(pi);const Ii=new T(en/Dr,ds/Dr);Ii.z=Ci/Dr,Kt.push(Ii)}q.push(Yt),ct.push(Kt)}return[q,ct]})(p,M,E,x);return(function(O,N,z){let H=1/0;ZA(z,N)&&(H=wE(z,N[0]));for(let q=0;q<N.length;q++){const ct=N[q],J=O[q];for(let rt=0;rt<ct.length-1;rt++){const pt=ct[rt],vt=[pt,ct[rt+1],J[rt+1],J[rt],pt];qA(z,vt)&&(H=Math.min(H,wE(z,vt)))}}return H!==1/0&&H})(F[0],F[1],P)}}function zd(l,i){return l.x*i.x+l.y*i.y}function wE(l,i){if(l.length===1){let o=0;const h=i[o++];let p;for(;!p||h.equals(p);)if(p=i[o++],!p)return 1/0;for(;o<i.length;o++){const g=i[o],y=l[0],x=p.sub(h),A=g.sub(h),E=y.sub(h),M=zd(x,x),P=zd(x,A),F=zd(A,A),O=zd(E,x),N=zd(E,A),z=M*F-P*P,H=(F*O-P*N)/z,q=(M*N-P*O)/z,ct=h.z*(1-H-q)+p.z*H+g.z*q;if(isFinite(ct))return ct}return 1/0}{let o=1/0;for(const h of i)o=Math.min(o,h.z);return o}}const DV=fr([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:FV}=DV,OV=fr([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:kV}=OV,NV=Math.cos(Math.PI/180*37.5),TE=Math.pow(2,14)/.5;class B0{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map((o=>o.id)),this.index=i.index,this.hasDependencies=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((o=>{this.gradients[o.id]={}})),this.layoutVertexArray=new lt,this.layoutVertexArray2=new gt,this.indexArray=new qt,this.programConfigurations=new $o(i.layers,i.zoom),this.segments=new pe,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((o=>o.isStateDependent())).map((o=>o.id))}populate(i,o,h){this.hasDependencies=T_("line",this.layers,o)||this.hasLineDasharray(this.layers);const p=this.layers[0].layout.get("line-sort-key"),g=!p.isConstant(),y=[];for(const{feature:x,id:A,index:E,sourceLayerIndex:M}of i){const P=this.layers[0]._featureFilter.needGeometry,F=vo(x,P);if(!this.layers[0]._featureFilter.filter(new or(this.zoom),F,h))continue;const O=g?p.evaluate(F,{},h):void 0,N={id:A,properties:x.properties,type:x.type,sourceLayerIndex:M,index:E,geometry:P?F.geometry:bo(x),patterns:{},dashes:{},sortKey:O};y.push(N)}g&&y.sort(((x,A)=>x.sortKey-A.sortKey));for(const x of y){const{geometry:A,index:E,sourceLayerIndex:M}=x;this.hasDependencies?(T_("line",this.layers,o)?S0("line",this.layers,x,{zoom:this.zoom},o):this.hasLineDasharray(this.layers)&&this.addLineDashDependencies(this.layers,x,this.zoom,o),this.patternFeatures.push(x)):this.addFeature(x,A,E,h,{},{},o.subdivisionGranularity),o.featureIndex.insert(i[E].feature,A,E,M,this.index)}}update(i,o,h,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,o,this.stateDependentLayers,{imagePositions:h,dashPositions:p})}addFeatures(i,o,h,p){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,o,h,p,i.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=i.createVertexBuffer(this.layoutVertexArray2,kV)),this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,FV),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(i){if(i.properties&&Object.prototype.hasOwnProperty.call(i.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(i.properties,"mapbox_clip_end"))return{start:+i.properties.mapbox_clip_start,end:+i.properties.mapbox_clip_end}}addFeature(i,o,h,p,g,y,x){const A=this.layers[0].layout,E=A.get("line-join").evaluate(i,{}),M=A.get("line-cap"),P=A.get("line-miter-limit"),F=A.get("line-round-limit");this.lineClips=this.lineFeatureClips(i);for(const O of o)this.addLine(O,i,E,M,P,F,p,x);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,h,{imagePositions:g,dashPositions:y,canonical:p})}addLine(i,o,h,p,g,y,x,A){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,i=$l(i,x?A.line.getGranularityForZoomLevel(x.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let J=0;J<i.length-1;J++)this.totalDistance+=i[J].dist(i[J+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const E=Bu.types[o.type]==="Polygon";let M=i.length;for(;M>=2&&i[M-1].equals(i[M-2]);)M--;let P=0;for(;P<M-1&&i[P].equals(i[P+1]);)P++;if(M<(E?3:2))return;h==="bevel"&&(g=1.05);const F=this.overscaling<=16?122880/(512*this.overscaling):0,O=this.segments.prepareSegment(10*M,this.layoutVertexArray,this.indexArray);let N,z,H,q,ct;this.e1=this.e2=-1,E&&(N=i[M-2],ct=i[P].sub(N)._unit()._perp());for(let J=P;J<M;J++){if(H=J===M-1?E?i[P+1]:void 0:i[J+1],H&&i[J].equals(H))continue;ct&&(q=ct),N&&(z=N),N=i[J],ct=H?H.sub(N)._unit()._perp():q,q=q||ct;let rt=q.add(ct);rt.x===0&&rt.y===0||rt._unit();const pt=q.x*ct.x+q.y*ct.y,vt=rt.x*ct.x+rt.y*ct.y,Pt=vt!==0?1/vt:1/0,jt=2*Math.sqrt(2-2*vt),Vt=vt<NV&&z&&H,$t=q.x*ct.y-q.y*ct.x>0;if(Vt&&J>P){const Kt=N.dist(z);if(Kt>2*F){const zt=N.sub(N.sub(z)._mult(F/Kt)._round());this.updateDistance(z,zt),this.addCurrentVertex(zt,q,0,0,O),z=zt}}const se=z&&H;let Yt=se?h:E?"butt":p;if(se&&Yt==="round"&&(Pt<y?Yt="miter":Pt<=2&&(Yt="fakeround")),Yt==="miter"&&Pt>g&&(Yt="bevel"),Yt==="bevel"&&(Pt>2&&(Yt="flipbevel"),Pt<g&&(Yt="miter")),z&&this.updateDistance(z,N),Yt==="miter")rt._mult(Pt),this.addCurrentVertex(N,rt,0,0,O);else if(Yt==="flipbevel"){if(Pt>100)rt=ct.mult(-1);else{const Kt=Pt*q.add(ct).mag()/q.sub(ct).mag();rt._perp()._mult(Kt*($t?-1:1))}this.addCurrentVertex(N,rt,0,0,O),this.addCurrentVertex(N,rt.mult(-1),0,0,O)}else if(Yt==="bevel"||Yt==="fakeround"){const Kt=-Math.sqrt(Pt*Pt-1),zt=$t?Kt:0,ye=$t?0:Kt;if(z&&this.addCurrentVertex(N,q,zt,ye,O),Yt==="fakeround"){const _e=Math.round(180*jt/Math.PI/20);for(let me=1;me<_e;me++){let ce=me/_e;if(ce!==.5){const Lr=ce-.5;ce+=ce*Lr*(ce-1)*((1.0904+pt*(pt*(3.55645-1.43519*pt)-3.2452))*Lr*Lr+(.848013+pt*(.215638*pt-1.06021)))}const De=ct.sub(q)._mult(ce)._add(q)._unit()._mult($t?-1:1);this.addHalfVertex(N,De.x,De.y,!1,$t,0,O)}}H&&this.addCurrentVertex(N,ct,-zt,-ye,O)}else if(Yt==="butt")this.addCurrentVertex(N,rt,0,0,O);else if(Yt==="square"){const Kt=z?1:-1;this.addCurrentVertex(N,rt,Kt,Kt,O)}else Yt==="round"&&(z&&(this.addCurrentVertex(N,q,0,0,O),this.addCurrentVertex(N,q,1,1,O,!0)),H&&(this.addCurrentVertex(N,ct,-1,-1,O,!0),this.addCurrentVertex(N,ct,0,0,O)));if(Vt&&J<M-1){const Kt=N.dist(H);if(Kt>2*F){const zt=N.add(H.sub(N)._mult(F/Kt)._round());this.updateDistance(N,zt),this.addCurrentVertex(zt,ct,0,0,O),N=zt}}}}addCurrentVertex(i,o,h,p,g,y=!1){const x=o.y*p-o.x,A=-o.y-o.x*p;this.addHalfVertex(i,o.x+o.y*h,o.y-o.x*h,y,!1,h,g),this.addHalfVertex(i,x,A,y,!0,-p,g),this.distance>TE/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(i,o,h,p,g,y))}addHalfVertex({x:i,y:o},h,p,g,y,x,A){const E=.5*(this.lineClips?this.scaledDistance*(TE-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((i<<1)+(g?1:0),(o<<1)+(y?1:0),Math.round(63*h)+128,Math.round(63*p)+128,1+(x===0?0:x<0?-1:1)|(63&E)<<2,E>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const M=A.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,M,this.e2),A.primitiveLength++),y?this.e2=M:this.e1=M}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(i,o){this.distance+=i.dist(o),this.updateScaledDistance()}hasLineDasharray(i){for(const o of i){const h=o.paint.get("line-dasharray");if(h&&!h.isConstant())return!0}return!1}addLineDashDependencies(i,o,h,p){for(const g of i){const y=g.paint.get("line-dasharray");if(!y||y.value.kind==="constant")continue;const x=g.layout.get("line-cap")==="round",A={dasharray:y.value.evaluate({zoom:h-1},o,{}),round:x},E={dasharray:y.value.evaluate({zoom:h},o,{}),round:x},M={dasharray:y.value.evaluate({zoom:h+1},o,{}),round:x},P=`${A.dasharray.join(",")},${A.round}`,F=`${E.dasharray.join(",")},${E.round}`,O=`${M.dasharray.join(",")},${M.round}`;p.dashDependencies[P]=A,p.dashDependencies[F]=E,p.dashDependencies[O]=M,o.dashes[g.id]={min:P,mid:F,max:O}}}}let AE,EE;oe("LineBucket",B0,{omit:["layers","patternFeatures"]});var SE={get paint(){return EE=EE||new Xi({"line-opacity":new xe(tt.paint_line["line-opacity"]),"line-color":new xe(tt.paint_line["line-color"]),"line-translate":new fe(tt.paint_line["line-translate"]),"line-translate-anchor":new fe(tt.paint_line["line-translate-anchor"]),"line-width":new xe(tt.paint_line["line-width"]),"line-gap-width":new xe(tt.paint_line["line-gap-width"]),"line-offset":new xe(tt.paint_line["line-offset"]),"line-blur":new xe(tt.paint_line["line-blur"]),"line-dasharray":new Nl(tt.paint_line["line-dasharray"]),"line-pattern":new Nl(tt.paint_line["line-pattern"]),"line-gradient":new vu(tt.paint_line["line-gradient"])})},get layout(){return AE=AE||new Xi({"line-cap":new fe(tt.layout_line["line-cap"]),"line-join":new xe(tt.layout_line["line-join"]),"line-miter-limit":new fe(tt.layout_line["line-miter-limit"]),"line-round-limit":new fe(tt.layout_line["line-round-limit"]),"line-sort-key":new xe(tt.layout_line["line-sort-key"])})}};class LV extends xe{possiblyEvaluate(i,o){return o=new or(Math.floor(o.zoom),{now:o.now,fadeDuration:o.fadeDuration,zoomHistory:o.zoomHistory,transition:o.transition}),super.possiblyEvaluate(i,o)}evaluate(i,o,h,p){return o=Rr({},o,{zoom:Math.floor(o.zoom)}),super.evaluate(i,o,h,p)}}let C_;class UV extends Es{constructor(i,o){super(i,SE,o),this.gradientVersion=0,C_||(C_=new LV(SE.paint.properties["line-width"].specification),C_.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(i){if(i==="line-gradient"){const o=this.gradientExpression();this.stepInterpolant=!!(function(h){return h._styleExpression!==void 0})(o)&&o._styleExpression.expression instanceof Sa,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(i,o){super.recalculate(i,o),this.paint._values["line-floorwidth"]=C_.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,i)}createBucket(i){return new B0(i)}queryRadius(i){const o=i,h=CE(Iu("line-width",this,o),Iu("line-gap-width",this,o)),p=Iu("line-offset",this,o);return h/2+Math.abs(p)+x_(this.paint.get("line-translate"))}queryIntersectsFeature({queryGeometry:i,feature:o,featureState:h,geometry:p,transform:g,pixelsToTileUnits:y}){const x=w_(i,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-g.bearingInRadians,y),A=y/2*CE(this.paint.get("line-width").evaluate(o,h),this.paint.get("line-gap-width").evaluate(o,h)),E=this.paint.get("line-offset").evaluate(o,h);return E&&(p=(function(M,P){const F=[];for(let O=0;O<M.length;O++){const N=M[O],z=[];for(let H=0;H<N.length;H++){const q=N[H-1],ct=N[H],J=N[H+1],rt=H===0?new T(0,0):ct.sub(q)._unit()._perp(),pt=H===N.length-1?new T(0,0):J.sub(ct)._unit()._perp(),vt=rt._add(pt)._unit(),Pt=vt.x*pt.x+vt.y*pt.y;Pt!==0&&vt._mult(1/Pt),z.push(vt._mult(P)._add(ct))}F.push(z)}return F})(p,E*y)),(function(M,P,F){for(let O=0;O<P.length;O++){const N=P[O];if(M.length>=3){for(let z=0;z<N.length;z++)if(Cu(M,N[z]))return!0}if(W8(M,N,F))return!0}return!1})(x,p,A)}isTileClipped(){return!0}}function CE(l,i){return i>0?i+2*l:l}const zV=fr([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),VV=fr([{name:"a_projected_pos",components:3,type:"Float32"}],4);fr([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const jV=fr([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);fr([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const IE=fr([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),HV=fr([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function GV(l,i,o){return l.sections.forEach((h=>{h.text=(function(p,g,y){const x=g.layout.get("text-transform").evaluate(y,{});return x==="uppercase"?p=p.toLocaleUpperCase():x==="lowercase"&&(p=p.toLocaleLowerCase()),Ln.applyArabicShaping&&(p=Ln.applyArabicShaping(p)),p})(h.text,i,o)})),l}fr([{name:"triangle",components:3,type:"Uint16"}]),fr([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),fr([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),fr([{type:"Float32",name:"offsetX"}]),fr([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),fr([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const Vd={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var hi=24;const D0=4294967296,ME=1/D0,RE=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");class F0{constructor(i=new Uint8Array(16)){this.buf=ArrayBuffer.isView(i)?i:new Uint8Array(i),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(i,o,h=this.length){for(;this.pos<h;){const p=this.readVarint(),g=p>>3,y=this.pos;this.type=7&p,i(g,o,this),this.pos===y&&this.skip(p)}return o}readMessage(i,o){return this.readFields(i,o,this.readVarint()+this.pos)}readFixed32(){const i=this.dataView.getUint32(this.pos,!0);return this.pos+=4,i}readSFixed32(){const i=this.dataView.getInt32(this.pos,!0);return this.pos+=4,i}readFixed64(){const i=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*D0;return this.pos+=8,i}readSFixed64(){const i=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*D0;return this.pos+=8,i}readFloat(){const i=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,i}readDouble(){const i=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,i}readVarint(i){const o=this.buf;let h,p;return p=o[this.pos++],h=127&p,p<128?h:(p=o[this.pos++],h|=(127&p)<<7,p<128?h:(p=o[this.pos++],h|=(127&p)<<14,p<128?h:(p=o[this.pos++],h|=(127&p)<<21,p<128?h:(p=o[this.pos],h|=(15&p)<<28,(function(g,y,x){const A=x.buf;let E,M;if(M=A[x.pos++],E=(112&M)>>4,M<128||(M=A[x.pos++],E|=(127&M)<<3,M<128)||(M=A[x.pos++],E|=(127&M)<<10,M<128)||(M=A[x.pos++],E|=(127&M)<<17,M<128)||(M=A[x.pos++],E|=(127&M)<<24,M<128)||(M=A[x.pos++],E|=(1&M)<<31,M<128))return Du(g,E,y);throw new Error("Expected varint not more than 10 bytes")})(h,i,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const i=this.readVarint();return i%2==1?(i+1)/-2:i/2}readBoolean(){return!!this.readVarint()}readString(){const i=this.readVarint()+this.pos,o=this.pos;return this.pos=i,i-o>=12&&RE?RE.decode(this.buf.subarray(o,i)):(function(h,p,g){let y="",x=p;for(;x<g;){const A=h[x];let E,M,P,F=null,O=A>239?4:A>223?3:A>191?2:1;if(x+O>g)break;O===1?A<128&&(F=A):O===2?(E=h[x+1],(192&E)==128&&(F=(31&A)<<6|63&E,F<=127&&(F=null))):O===3?(E=h[x+1],M=h[x+2],(192&E)==128&&(192&M)==128&&(F=(15&A)<<12|(63&E)<<6|63&M,(F<=2047||F>=55296&&F<=57343)&&(F=null))):O===4&&(E=h[x+1],M=h[x+2],P=h[x+3],(192&E)==128&&(192&M)==128&&(192&P)==128&&(F=(15&A)<<18|(63&E)<<12|(63&M)<<6|63&P,(F<=65535||F>=1114112)&&(F=null))),F===null?(F=65533,O=1):F>65535&&(F-=65536,y+=String.fromCharCode(F>>>10&1023|55296),F=56320|1023&F),y+=String.fromCharCode(F),x+=O}return y})(this.buf,o,i)}readBytes(){const i=this.readVarint()+this.pos,o=this.buf.subarray(this.pos,i);return this.pos=i,o}readPackedVarint(i=[],o){const h=this.readPackedEnd();for(;this.pos<h;)i.push(this.readVarint(o));return i}readPackedSVarint(i=[]){const o=this.readPackedEnd();for(;this.pos<o;)i.push(this.readSVarint());return i}readPackedBoolean(i=[]){const o=this.readPackedEnd();for(;this.pos<o;)i.push(this.readBoolean());return i}readPackedFloat(i=[]){const o=this.readPackedEnd();for(;this.pos<o;)i.push(this.readFloat());return i}readPackedDouble(i=[]){const o=this.readPackedEnd();for(;this.pos<o;)i.push(this.readDouble());return i}readPackedFixed32(i=[]){const o=this.readPackedEnd();for(;this.pos<o;)i.push(this.readFixed32());return i}readPackedSFixed32(i=[]){const o=this.readPackedEnd();for(;this.pos<o;)i.push(this.readSFixed32());return i}readPackedFixed64(i=[]){const o=this.readPackedEnd();for(;this.pos<o;)i.push(this.readFixed64());return i}readPackedSFixed64(i=[]){const o=this.readPackedEnd();for(;this.pos<o;)i.push(this.readSFixed64());return i}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(i){const o=7&i;if(o===0)for(;this.buf[this.pos++]>127;);else if(o===2)this.pos=this.readVarint()+this.pos;else if(o===5)this.pos+=4;else{if(o!==1)throw new Error(`Unimplemented type: ${o}`);this.pos+=8}}writeTag(i,o){this.writeVarint(i<<3|o)}realloc(i){let o=this.length||16;for(;o<this.pos+i;)o*=2;if(o!==this.length){const h=new Uint8Array(o);h.set(this.buf),this.buf=h,this.dataView=new DataView(h.buffer),this.length=o}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(i){this.realloc(4),this.dataView.setInt32(this.pos,i,!0),this.pos+=4}writeSFixed32(i){this.realloc(4),this.dataView.setInt32(this.pos,i,!0),this.pos+=4}writeFixed64(i){this.realloc(8),this.dataView.setInt32(this.pos,-1&i,!0),this.dataView.setInt32(this.pos+4,Math.floor(i*ME),!0),this.pos+=8}writeSFixed64(i){this.realloc(8),this.dataView.setInt32(this.pos,-1&i,!0),this.dataView.setInt32(this.pos+4,Math.floor(i*ME),!0),this.pos+=8}writeVarint(i){(i=+i||0)>268435455||i<0?(function(o,h){let p,g;if(o>=0?(p=o%4294967296|0,g=o/4294967296|0):(p=~(-o%4294967296),g=~(-o/4294967296),4294967295^p?p=p+1|0:(p=0,g=g+1|0)),o>=18446744073709552e3||o<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");h.realloc(10),(function(y,x,A){A.buf[A.pos++]=127&y|128,y>>>=7,A.buf[A.pos++]=127&y|128,y>>>=7,A.buf[A.pos++]=127&y|128,y>>>=7,A.buf[A.pos++]=127&y|128,A.buf[A.pos]=127&(y>>>=7)})(p,0,h),(function(y,x){const A=(7&y)<<4;x.buf[x.pos++]|=A|((y>>>=3)?128:0),y&&(x.buf[x.pos++]=127&y|((y>>>=7)?128:0),y&&(x.buf[x.pos++]=127&y|((y>>>=7)?128:0),y&&(x.buf[x.pos++]=127&y|((y>>>=7)?128:0),y&&(x.buf[x.pos++]=127&y|((y>>>=7)?128:0),y&&(x.buf[x.pos++]=127&y)))))})(g,h)})(i,this):(this.realloc(4),this.buf[this.pos++]=127&i|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=i>>>7&127))))}writeSVarint(i){this.writeVarint(i<0?2*-i-1:2*i)}writeBoolean(i){this.writeVarint(+i)}writeString(i){i=String(i),this.realloc(4*i.length),this.pos++;const o=this.pos;this.pos=(function(p,g,y){for(let x,A,E=0;E<g.length;E++){if(x=g.charCodeAt(E),x>55295&&x<57344){if(!A){x>56319||E+1===g.length?(p[y++]=239,p[y++]=191,p[y++]=189):A=x;continue}if(x<56320){p[y++]=239,p[y++]=191,p[y++]=189,A=x;continue}x=A-55296<<10|x-56320|65536,A=null}else A&&(p[y++]=239,p[y++]=191,p[y++]=189,A=null);x<128?p[y++]=x:(x<2048?p[y++]=x>>6|192:(x<65536?p[y++]=x>>12|224:(p[y++]=x>>18|240,p[y++]=x>>12&63|128),p[y++]=x>>6&63|128),p[y++]=63&x|128)}return y})(this.buf,i,this.pos);const h=this.pos-o;h>=128&&PE(o,h,this),this.pos=o-1,this.writeVarint(h),this.pos+=h}writeFloat(i){this.realloc(4),this.dataView.setFloat32(this.pos,i,!0),this.pos+=4}writeDouble(i){this.realloc(8),this.dataView.setFloat64(this.pos,i,!0),this.pos+=8}writeBytes(i){const o=i.length;this.writeVarint(o),this.realloc(o);for(let h=0;h<o;h++)this.buf[this.pos++]=i[h]}writeRawMessage(i,o){this.pos++;const h=this.pos;i(o,this);const p=this.pos-h;p>=128&&PE(h,p,this),this.pos=h-1,this.writeVarint(p),this.pos+=p}writeMessage(i,o,h){this.writeTag(i,2),this.writeRawMessage(o,h)}writePackedVarint(i,o){o.length&&this.writeMessage(i,$V,o)}writePackedSVarint(i,o){o.length&&this.writeMessage(i,WV,o)}writePackedBoolean(i,o){o.length&&this.writeMessage(i,ZV,o)}writePackedFloat(i,o){o.length&&this.writeMessage(i,XV,o)}writePackedDouble(i,o){o.length&&this.writeMessage(i,qV,o)}writePackedFixed32(i,o){o.length&&this.writeMessage(i,YV,o)}writePackedSFixed32(i,o){o.length&&this.writeMessage(i,KV,o)}writePackedFixed64(i,o){o.length&&this.writeMessage(i,JV,o)}writePackedSFixed64(i,o){o.length&&this.writeMessage(i,QV,o)}writeBytesField(i,o){this.writeTag(i,2),this.writeBytes(o)}writeFixed32Field(i,o){this.writeTag(i,5),this.writeFixed32(o)}writeSFixed32Field(i,o){this.writeTag(i,5),this.writeSFixed32(o)}writeFixed64Field(i,o){this.writeTag(i,1),this.writeFixed64(o)}writeSFixed64Field(i,o){this.writeTag(i,1),this.writeSFixed64(o)}writeVarintField(i,o){this.writeTag(i,0),this.writeVarint(o)}writeSVarintField(i,o){this.writeTag(i,0),this.writeSVarint(o)}writeStringField(i,o){this.writeTag(i,2),this.writeString(o)}writeFloatField(i,o){this.writeTag(i,5),this.writeFloat(o)}writeDoubleField(i,o){this.writeTag(i,1),this.writeDouble(o)}writeBooleanField(i,o){this.writeVarintField(i,+o)}}function Du(l,i,o){return o?4294967296*i+(l>>>0):4294967296*(i>>>0)+(l>>>0)}function PE(l,i,o){const h=i<=16383?1:i<=2097151?2:i<=268435455?3:Math.floor(Math.log(i)/(7*Math.LN2));o.realloc(h);for(let p=o.pos-1;p>=l;p--)o.buf[p+h]=o.buf[p]}function $V(l,i){for(let o=0;o<l.length;o++)i.writeVarint(l[o])}function WV(l,i){for(let o=0;o<l.length;o++)i.writeSVarint(l[o])}function XV(l,i){for(let o=0;o<l.length;o++)i.writeFloat(l[o])}function qV(l,i){for(let o=0;o<l.length;o++)i.writeDouble(l[o])}function ZV(l,i){for(let o=0;o<l.length;o++)i.writeBoolean(l[o])}function YV(l,i){for(let o=0;o<l.length;o++)i.writeFixed32(l[o])}function KV(l,i){for(let o=0;o<l.length;o++)i.writeSFixed32(l[o])}function JV(l,i){for(let o=0;o<l.length;o++)i.writeFixed64(l[o])}function QV(l,i){for(let o=0;o<l.length;o++)i.writeSFixed64(l[o])}function t9(l,i,o){l===1&&o.readMessage(e9,i)}function e9(l,i,o){if(l===3){const{id:h,bitmap:p,width:g,height:y,left:x,top:A,advance:E}=o.readMessage(r9,{});i.push({id:h,bitmap:new Bd({width:g+6,height:y+6},p),metrics:{width:g,height:y,left:x,top:A,advance:E}})}}function r9(l,i,o){l===1?i.id=o.readVarint():l===2?i.bitmap=o.readBytes():l===3?i.width=o.readVarint():l===4?i.height=o.readVarint():l===5?i.left=o.readSVarint():l===6?i.top=o.readSVarint():l===7&&(i.advance=o.readVarint())}function BE(l){let i=0,o=0;for(const y of l)i+=y.w*y.h,o=Math.max(o,y.w);l.sort(((y,x)=>x.h-y.h));const h=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(i/.95)),o),h:1/0}];let p=0,g=0;for(const y of l)for(let x=h.length-1;x>=0;x--){const A=h[x];if(!(y.w>A.w||y.h>A.h)){if(y.x=A.x,y.y=A.y,g=Math.max(g,y.y+y.h),p=Math.max(p,y.x+y.w),y.w===A.w&&y.h===A.h){const E=h.pop();E&&x<h.length&&(h[x]=E)}else y.h===A.h?(A.x+=y.w,A.w-=y.w):y.w===A.w?(A.y+=y.h,A.h-=y.h):(h.push({x:A.x+y.w,y:A.y,w:A.w-y.w,h:y.h}),A.y+=y.h,A.h-=y.h);break}}return{w:p,h:g,fill:i/(p*g)||0}}class O0{constructor(i,{pixelRatio:o,version:h,stretchX:p,stretchY:g,content:y,textFitWidth:x,textFitHeight:A}){this.paddedRect=i,this.pixelRatio=o,this.stretchX=p,this.stretchY=g,this.content=y,this.version=h,this.textFitWidth=x,this.textFitHeight=A}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class DE{constructor(i,o){const h={},p={};this.haveRenderCallbacks=[];const g=[];this.addImages(i,h,g),this.addImages(o,p,g);const{w:y,h:x}=BE(g),A=new hs({width:y||1,height:x||1});for(const E in i){const M=i[E],P=h[E].paddedRect;hs.copy(M.data,A,{x:0,y:0},{x:P.x+1,y:P.y+1},M.data)}for(const E in o){const M=o[E],P=p[E].paddedRect,F=P.x+1,O=P.y+1,N=M.data.width,z=M.data.height;hs.copy(M.data,A,{x:0,y:0},{x:F,y:O},M.data),hs.copy(M.data,A,{x:0,y:z-1},{x:F,y:O-1},{width:N,height:1}),hs.copy(M.data,A,{x:0,y:0},{x:F,y:O+z},{width:N,height:1}),hs.copy(M.data,A,{x:N-1,y:0},{x:F-1,y:O},{width:1,height:z}),hs.copy(M.data,A,{x:0,y:0},{x:F+N,y:O},{width:1,height:z})}this.image=A,this.iconPositions=h,this.patternPositions=p}addImages(i,o,h){for(const p in i){const g=i[p],y={x:0,y:0,w:g.data.width+2,h:g.data.height+2};h.push(y),o[p]=new O0(y,g),g.hasRenderCallback&&this.haveRenderCallbacks.push(p)}}patchUpdatedImages(i,o){i.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const h in i.updatedImages)this.patchUpdatedImage(this.iconPositions[h],i.getImage(h),o),this.patchUpdatedImage(this.patternPositions[h],i.getImage(h),o)}patchUpdatedImage(i,o,h){if(!i||!o||i.version===o.version)return;i.version=o.version;const[p,g]=i.tl;h.update(o.data,void 0,{x:p,y:g})}}var Ua;oe("ImagePosition",O0),oe("ImageAtlas",DE),f.at=void 0,(Ua=f.at||(f.at={}))[Ua.none=0]="none",Ua[Ua.horizontal=1]="horizontal",Ua[Ua.vertical=2]="vertical",Ua[Ua.horizontalOnly=3]="horizontalOnly";class jd{constructor(){this.scale=1,this.fontStack="",this.imageName=null,this.verticalAlign="bottom"}static forText(i,o,h){const p=new jd;return p.scale=i||1,p.fontStack=o,p.verticalAlign=h||"bottom",p}static forImage(i,o){const h=new jd;return h.imageName=i,h.verticalAlign=o||"bottom",h}}class Fu{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(i,o){const h=new Fu;for(let p=0;p<i.sections.length;p++){const g=i.sections[p];g.image?h.addImageSection(g):h.addTextSection(g,o)}return h}length(){return this.text.length}getSection(i){return this.sections[this.sectionIndex[i]]}getSectionIndex(i){return this.sectionIndex[i]}getCharCode(i){return this.text.charCodeAt(i)}verticalizePunctuation(){this.text=(function(i){let o="";for(let h=0;h<i.length;h++){const p=i.charCodeAt(h+1)||null,g=i.charCodeAt(h-1)||null;o+=p&&vd(p)&&!Vd[i[h+1]]||g&&vd(g)&&!Vd[i[h-1]]||!Vd[i[h]]?i[h]:Vd[i[h]]}return o})(this.text)}trim(){let i=0;for(let h=0;h<this.text.length&&M_[this.text.charCodeAt(h)];h++)i++;let o=this.text.length;for(let h=this.text.length-1;h>=0&&h>=i&&M_[this.text.charCodeAt(h)];h--)o--;this.text=this.text.substring(i,o),this.sectionIndex=this.sectionIndex.slice(i,o)}substring(i,o){const h=new Fu;return h.text=this.text.substring(i,o),h.sectionIndex=this.sectionIndex.slice(i,o),h.sections=this.sections,h}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((i,o)=>Math.max(i,this.sections[o].scale)),0)}getMaxImageSize(i){let o=0,h=0;for(let p=0;p<this.length();p++){const g=this.getSection(p);if(g.imageName){const y=i[g.imageName];if(!y)continue;const x=y.displaySize;o=Math.max(o,x[0]),h=Math.max(h,x[1])}}return{maxImageWidth:o,maxImageHeight:h}}addTextSection(i,o){this.text+=i.text,this.sections.push(jd.forText(i.scale,i.fontStack||o,i.verticalAlign));const h=this.sections.length-1;for(let p=0;p<i.text.length;++p)this.sectionIndex.push(h)}addImageSection(i){const o=i.image?i.image.name:"";if(o.length===0)return void Je("Can't add FormattedSection with an empty image.");const h=this.getNextImageSectionCharCode();h?(this.text+=String.fromCharCode(h),this.sections.push(jd.forImage(o,i.verticalAlign)),this.sectionIndex.push(this.sections.length-1)):Je("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function I_(l,i,o,h,p,g,y,x,A,E,M,P,F,O,N){const z=Fu.fromFeature(l,p);let H;P===f.at.vertical&&z.verticalizePunctuation();const{processBidirectionalText:q,processStyledBidirectionalText:ct}=Ln;if(q&&z.sections.length===1){H=[];const pt=q(z.toString(),k0(z,E,g,i,h,O));for(const vt of pt){const Pt=new Fu;Pt.text=vt,Pt.sections=z.sections;for(let jt=0;jt<vt.length;jt++)Pt.sectionIndex.push(0);H.push(Pt)}}else if(ct){H=[];const pt=ct(z.text,z.sectionIndex,k0(z,E,g,i,h,O));for(const vt of pt){const Pt=new Fu;Pt.text=vt[0],Pt.sectionIndex=vt[1],Pt.sections=z.sections,H.push(Pt)}}else H=(function(pt,vt){const Pt=[],jt=pt.text;let Vt=0;for(const $t of vt)Pt.push(pt.substring(Vt,$t)),Vt=$t;return Vt<jt.length&&Pt.push(pt.substring(Vt,jt.length)),Pt})(z,k0(z,E,g,i,h,O));const J=[],rt={positionedLines:J,text:z.toString(),top:M[1],bottom:M[1],left:M[0],right:M[0],writingMode:P,iconsInText:!1,verticalizable:!1};return(function(pt,vt,Pt,jt,Vt,$t,se,Yt,Kt,zt,ye,_e){let me=0,ce=0,De=0,Lr=0;const si=Yt==="right"?1:Yt==="left"?0:.5,Vi=hi/_e;let en=0;for(const Dr of Vt){Dr.trim();const pi=Dr.getMaxScale(),Ii={positionedGlyphs:[],lineOffset:0};pt.positionedLines[en]=Ii;const Mi=Ii.positionedGlyphs;let ss=0;if(!Dr.length()){ce+=$t,++en;continue}const rn=o9(jt,Dr,Vi);for(let fs=0;fs<Dr.length();fs++){const ni=Dr.getSection(fs),gi=Dr.getSectionIndex(fs),mi=Dr.getCharCode(fs),ti=a9(Kt,ye,mi);let Tr;if(ni.imageName){if(pt.iconsInText=!0,ni.scale=ni.scale*Vi,Tr=c9(ni,ti,pi,rn,jt),!Tr)continue;ss=Math.max(ss,Tr.imageOffset)}else if(Tr=l9(ni,mi,ti,rn,vt,Pt),!Tr)continue;const{rect:Wn,metrics:Hu,baselineOffset:Xn}=Tr;Mi.push({glyph:mi,imageName:ni.imageName,x:me,y:ce+Xn+-17,vertical:ti,scale:ni.scale,fontStack:ni.fontStack,sectionIndex:gi,metrics:Hu,rect:Wn}),ti?(pt.verticalizable=!0,me+=(ni.imageName?Hu.advance:hi)*ni.scale+zt):me+=Hu.advance*ni.scale+zt}Mi.length!==0&&(De=Math.max(me-zt,De),u9(Mi,0,Mi.length-1,si)),me=0,Ii.lineOffset=Math.max(ss,(pi-1)*hi);const _i=$t*pi+ss;ce+=_i,Lr=Math.max(_i,Lr),++en}const{horizontalAlign:ds,verticalAlign:Ci}=N0(se);(function(Dr,pi,Ii,Mi,ss,rn,_i,fs,ni){const gi=(pi-Ii)*ss;let mi=0;mi=rn!==_i?-fs*Mi- -17:-Mi*ni*_i+.5*_i;for(const ti of Dr)for(const Tr of ti.positionedGlyphs)Tr.x+=gi,Tr.y+=mi})(pt.positionedLines,si,ds,Ci,De,Lr,$t,ce,Vt.length),pt.top+=-Ci*ce,pt.bottom=pt.top+ce,pt.left+=-ds*De,pt.right=pt.left+De})(rt,i,o,h,H,y,x,A,P,E,F,N),!(function(pt){for(const vt of pt)if(vt.positionedGlyphs.length!==0)return!1;return!0})(J)&&rt}const M_={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},i9={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},s9={40:!0};function FE(l,i,o,h,p,g){if(i.imageName){const y=h[i.imageName];return y?y.displaySize[0]*i.scale*hi/g+p:0}{const y=o[i.fontStack],x=y&&y[l];return x?x.metrics.advance*i.scale+p:0}}function OE(l,i,o,h){const p=Math.pow(l-i,2);return h?l<i?p/2:2*p:p+Math.abs(o)*o}function n9(l,i,o){let h=0;return l===10&&(h-=1e4),o&&(h+=150),l!==40&&l!==65288||(h+=50),i!==41&&i!==65289||(h+=50),h}function kE(l,i,o,h,p,g){let y=null,x=OE(i,o,p,g);for(const A of h){const E=OE(i-A.x,o,p,g)+A.badness;E<=x&&(y=A,x=E)}return{index:l,x:i,priorBreak:y,badness:x}}function NE(l){return l?NE(l.priorBreak).concat(l.index):[]}function k0(l,i,o,h,p,g){if(!l)return[];const y=[],x=(function(M,P,F,O,N,z){let H=0;for(let q=0;q<M.length();q++){const ct=M.getSection(q);H+=FE(M.getCharCode(q),ct,O,N,P,z)}return H/Math.max(1,Math.ceil(H/F))})(l,i,o,h,p,g),A=l.text.indexOf("")>=0;let E=0;for(let M=0;M<l.length();M++){const P=l.getSection(M),F=l.getCharCode(M);if(M_[F]||(E+=FE(F,P,h,p,i,g)),M<l.length()-1){const O=f0(F);(i9[F]||O||P.imageName||M!==l.length()-2&&s9[l.getCharCode(M+1)])&&y.push(kE(M+1,E,x,y,n9(F,l.getCharCode(M+1),O&&A),!1))}}return NE(kE(l.length(),E,x,y,0,!0))}function N0(l){let i=.5,o=.5;switch(l){case"right":case"top-right":case"bottom-right":i=1;break;case"left":case"top-left":case"bottom-left":i=0}switch(l){case"bottom":case"bottom-right":case"bottom-left":o=1;break;case"top":case"top-right":case"top-left":o=0}return{horizontalAlign:i,verticalAlign:o}}function o9(l,i,o){const h=i.getMaxScale()*hi,{maxImageWidth:p,maxImageHeight:g}=i.getMaxImageSize(l),y=Math.max(h,g*o);return{verticalLineContentWidth:Math.max(h,p*o),horizontalLineContentHeight:y}}function LE(l){switch(l){case"top":return 0;case"center":return .5;default:return 1}}function a9(l,i,o){return!(l===f.at.horizontal||!i&&!Na(o)||i&&(M_[o]||(h=o,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(h)))));var h}function l9(l,i,o,h,p,g){const y=g[l.fontStack],x=(function(E,M,P,F){if(E&&E.rect)return E;const O=M[P.fontStack],N=O&&O[F];return N?{rect:null,metrics:N.metrics}:null})(y&&y[i],p,l,i);if(x===null)return null;let A;if(o)A=h.verticalLineContentWidth-l.scale*hi;else{const E=LE(l.verticalAlign);A=(h.horizontalLineContentHeight-l.scale*hi)*E}return{rect:x.rect,metrics:x.metrics,baselineOffset:A}}function c9(l,i,o,h,p){const g=p[l.imageName];if(!g)return null;const y=g.paddedRect,x=g.displaySize,A={width:x[0],height:x[1],left:1,top:-3,advance:i?x[1]:x[0]};let E;if(i)E=h.verticalLineContentWidth-x[1]*l.scale;else{const M=LE(l.verticalAlign);E=(h.horizontalLineContentHeight-x[1]*l.scale)*M}return{rect:y,metrics:A,baselineOffset:E,imageOffset:(i?x[0]:x[1])*l.scale-hi*o}}function u9(l,i,o,h){if(h===0)return;const p=l[o],g=(l[o].x+p.metrics.advance*p.scale)*h;for(let y=i;y<=o;y++)l[y].x-=g}function h9(l,i,o){const{horizontalAlign:h,verticalAlign:p}=N0(o),g=i[0]-l.displaySize[0]*h,y=i[1]-l.displaySize[1]*p;return{image:l,top:y,bottom:y+l.displaySize[1],left:g,right:g+l.displaySize[0]}}function UE(l){var i,o;let h=l.left,p=l.top,g=l.right-h,y=l.bottom-p;const x=(i=l.image.textFitWidth)!==null&&i!==void 0?i:"stretchOrShrink",A=(o=l.image.textFitHeight)!==null&&o!==void 0?o:"stretchOrShrink",E=(l.image.content[2]-l.image.content[0])/(l.image.content[3]-l.image.content[1]);if(A==="proportional"){if(x==="stretchOnly"&&g/y<E||x==="proportional"){const M=Math.ceil(y*E);h*=M/g,g=M}}else if(x==="proportional"&&A==="stretchOnly"&&E!==0&&g/y>E){const M=Math.ceil(g/E);p*=M/y,y=M}return{x1:h,y1:p,x2:h+g,y2:p+y}}function zE(l,i,o,h,p,g){const y=l.image;let x;if(y.content){const H=y.content,q=y.pixelRatio||1;x=[H[0]/q,H[1]/q,y.displaySize[0]-H[2]/q,y.displaySize[1]-H[3]/q]}const A=i.left*g,E=i.right*g;let M,P,F,O;o==="width"||o==="both"?(O=p[0]+A-h[3],P=p[0]+E+h[1]):(O=p[0]+(A+E-y.displaySize[0])/2,P=O+y.displaySize[0]);const N=i.top*g,z=i.bottom*g;return o==="height"||o==="both"?(M=p[1]+N-h[0],F=p[1]+z+h[2]):(M=p[1]+(N+z-y.displaySize[1])/2,F=M+y.displaySize[1]),{image:y,top:M,right:P,bottom:F,left:O,collisionPadding:x}}const Wo=128,za=32640;function VE(l,i){const{expression:o}=i;if(o.kind==="constant")return{kind:"constant",layoutSize:o.evaluate(new or(l+1))};if(o.kind==="source")return{kind:"source"};{const{zoomStops:h,interpolationType:p}=o;let g=0;for(;g<h.length&&h[g]<=l;)g++;g=Math.max(0,g-1);let y=g;for(;y<h.length&&h[y]<l+1;)y++;y=Math.min(h.length-1,y);const x=h[g],A=h[y];return o.kind==="composite"?{kind:"composite",minZoom:x,maxZoom:A,interpolationType:p}:{kind:"camera",minZoom:x,maxZoom:A,minSize:o.evaluate(new or(x)),maxSize:o.evaluate(new or(A)),interpolationType:p}}}function L0(l,i,o){let h="never";const p=l.get(i);return p?h=p:l.get(o)&&(h="always"),h}const d9=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function R_(l,i,o,h,p,g,y,x,A,E,M,P,F){const O=x?Math.min(za,Math.round(x[0])):0,N=x?Math.min(za,Math.round(x[1])):0;l.emplaceBack(i,o,Math.round(32*h),Math.round(32*p),g,y,(O<<1)+(A?1:0),N,16*E,16*M,256*P,256*F)}function U0(l,i,o){l.emplaceBack(i.x,i.y,o),l.emplaceBack(i.x,i.y,o),l.emplaceBack(i.x,i.y,o),l.emplaceBack(i.x,i.y,o)}function f9(l){for(const i of l.sections)if(p0(i.text))return!0;return!1}class z0{constructor(i){this.layoutVertexArray=new wt,this.indexArray=new qt,this.programConfigurations=i,this.segments=new pe,this.dynamicLayoutVertexArray=new Ft,this.opacityVertexArray=new Mt,this.hasVisibleVertices=!1,this.placedSymbolArray=new S}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(i,o,h,p){this.isEmpty()||(h&&(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,zV.members),this.indexBuffer=i.createIndexBuffer(this.indexArray,o),this.dynamicLayoutVertexBuffer=i.createVertexBuffer(this.dynamicLayoutVertexArray,VV.members,!0),this.opacityVertexBuffer=i.createVertexBuffer(this.opacityVertexArray,d9,!0),this.opacityVertexBuffer.itemSize=1),(h||p)&&this.programConfigurations.upload(i))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}oe("SymbolBuffers",z0);class V0{constructor(i,o,h){this.layoutVertexArray=new i,this.layoutAttributes=o,this.indexArray=new h,this.segments=new pe,this.collisionVertexArray=new Ot}upload(i){this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=i.createVertexBuffer(this.collisionVertexArray,jV.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}oe("CollisionBuffers",V0);class Ou{constructor(i){this.collisionBoxArray=i.collisionBoxArray,this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map((y=>y.id)),this.index=i.index,this.pixelRatio=i.pixelRatio,this.sourceLayerIndex=i.sourceLayerIndex,this.hasDependencies=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];const o=this.layers[0]._unevaluatedLayout._values;this.textSizeData=VE(this.zoom,o["text-size"]),this.iconSizeData=VE(this.zoom,o["icon-size"]);const h=this.layers[0].layout,p=h.get("symbol-sort-key"),g=h.get("symbol-z-order");this.canOverlap=L0(h,"text-overlap","text-allow-overlap")!=="never"||L0(h,"icon-overlap","icon-allow-overlap")!=="never"||h.get("text-ignore-placement")||h.get("icon-ignore-placement"),this.sortFeaturesByKey=g!=="viewport-y"&&!p.isConstant(),this.sortFeaturesByY=(g==="viewport-y"||g==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,h.get("symbol-placement")==="point"&&(this.writingModes=h.get("text-writing-mode").map((y=>f.at[y]))),this.stateDependentLayerIds=this.layers.filter((y=>y.isStateDependent())).map((y=>y.id)),this.sourceID=i.sourceID}createArrays(){this.text=new z0(new $o(this.layers,this.zoom,(i=>/^text/.test(i)))),this.icon=new z0(new $o(this.layers,this.zoom,(i=>/^icon/.test(i)))),this.glyphOffsetArray=new D,this.lineVertexArray=new U,this.symbolInstances=new B,this.textAnchorOffsets=new j}calculateGlyphDependencies(i,o,h,p,g){for(let y=0;y<i.length;y++)if(o[i.charCodeAt(y)]=!0,(h||p)&&g){const x=Vd[i.charAt(y)];x&&(o[x.charCodeAt(0)]=!0)}}populate(i,o,h){const p=this.layers[0],g=p.layout,y=g.get("text-font"),x=g.get("text-field"),A=g.get("icon-image"),E=(x.value.kind!=="constant"||x.value.value instanceof Yr&&!x.value.value.isEmpty()||x.value.value.toString().length>0)&&(y.value.kind!=="constant"||y.value.value.length>0),M=A.value.kind!=="constant"||!!A.value.value||Object.keys(A.parameters).length>0,P=g.get("symbol-sort-key");if(this.features=[],!E&&!M)return;const F=o.iconDependencies,O=o.glyphDependencies,N=o.availableImages,z=new or(this.zoom);for(const{feature:H,id:q,index:ct,sourceLayerIndex:J}of i){const rt=p._featureFilter.needGeometry,pt=vo(H,rt);if(!p._featureFilter.filter(z,pt,h))continue;let vt,Pt;if(rt||(pt.geometry=bo(H)),E){const Vt=p.getValueAndResolveTokens("text-field",pt,h,N),$t=Yr.factory(Vt),se=this.hasRTLText=this.hasRTLText||f9($t);(!se||Ln.getRTLTextPluginStatus()==="unavailable"||se&&Ln.isParsed())&&(vt=GV($t,p,pt))}if(M){const Vt=p.getValueAndResolveTokens("icon-image",pt,h,N);Pt=Vt instanceof ts?Vt:ts.fromString(Vt)}if(!vt&&!Pt)continue;const jt=this.sortFeaturesByKey?P.evaluate(pt,{},h):void 0;if(this.features.push({id:q,text:vt,icon:Pt,index:ct,sourceLayerIndex:J,geometry:pt.geometry,properties:H.properties,type:Bu.types[H.type],sortKey:jt}),Pt&&(F[Pt.name]=!0),vt){const Vt=y.evaluate(pt,{},h).join(","),$t=g.get("text-rotation-alignment")!=="viewport"&&g.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(f.at.vertical)>=0;for(const se of vt.sections)if(se.image)F[se.image.name]=!0;else{const Yt=yd(vt.toString()),Kt=se.fontStack||Vt,zt=O[Kt]=O[Kt]||{};this.calculateGlyphDependencies(se.text,zt,$t,this.allowVerticalPlacement,Yt)}}}g.get("symbol-placement")==="line"&&(this.features=(function(H){const q={},ct={},J=[];let rt=0;function pt(Vt){J.push(H[Vt]),rt++}function vt(Vt,$t,se){const Yt=ct[Vt];return delete ct[Vt],ct[$t]=Yt,J[Yt].geometry[0].pop(),J[Yt].geometry[0]=J[Yt].geometry[0].concat(se[0]),Yt}function Pt(Vt,$t,se){const Yt=q[$t];return delete q[$t],q[Vt]=Yt,J[Yt].geometry[0].shift(),J[Yt].geometry[0]=se[0].concat(J[Yt].geometry[0]),Yt}function jt(Vt,$t,se){const Yt=se?$t[0][$t[0].length-1]:$t[0][0];return`${Vt}:${Yt.x}:${Yt.y}`}for(let Vt=0;Vt<H.length;Vt++){const $t=H[Vt],se=$t.geometry,Yt=$t.text?$t.text.toString():null;if(!Yt){pt(Vt);continue}const Kt=jt(Yt,se),zt=jt(Yt,se,!0);if(Kt in ct&&zt in q&&ct[Kt]!==q[zt]){const ye=Pt(Kt,zt,se),_e=vt(Kt,zt,J[ye].geometry);delete q[Kt],delete ct[zt],ct[jt(Yt,J[_e].geometry,!0)]=_e,J[ye].geometry=null}else Kt in ct?vt(Kt,zt,se):zt in q?Pt(Kt,zt,se):(pt(Vt),q[Kt]=rt-1,ct[zt]=rt-1)}return J.filter((Vt=>Vt.geometry))})(this.features)),this.sortFeaturesByKey&&this.features.sort(((H,q)=>H.sortKey-q.sortKey))}update(i,o,h){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(i,o,this.layers,{imagePositions:h}),this.icon.programConfigurations.updatePaintArrays(i,o,this.layers,{imagePositions:h}))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(i){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(i),this.iconCollisionBox.upload(i)),this.text.upload(i,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(i,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(i,o){const h=this.lineVertexArray.length;if(i.segment!==void 0){let p=i.dist(o[i.segment+1]),g=i.dist(o[i.segment]);const y={};for(let x=i.segment+1;x<o.length;x++)y[x]={x:o[x].x,y:o[x].y,tileUnitDistanceFromAnchor:p},x<o.length-1&&(p+=o[x+1].dist(o[x]));for(let x=i.segment||0;x>=0;x--)y[x]={x:o[x].x,y:o[x].y,tileUnitDistanceFromAnchor:g},x>0&&(g+=o[x-1].dist(o[x]));for(let x=0;x<o.length;x++){const A=y[x];this.lineVertexArray.emplaceBack(A.x,A.y,A.tileUnitDistanceFromAnchor)}}return{lineStartIndex:h,lineLength:this.lineVertexArray.length-h}}addSymbols(i,o,h,p,g,y,x,A,E,M,P,F){const O=i.indexArray,N=i.layoutVertexArray,z=i.segments.prepareSegment(4*o.length,N,O,this.canOverlap?y.sortKey:void 0),H=this.glyphOffsetArray.length,q=z.vertexLength,ct=this.allowVerticalPlacement&&x===f.at.vertical?Math.PI/2:0,J=y.text&&y.text.sections;for(let rt=0;rt<o.length;rt++){const{tl:pt,tr:vt,bl:Pt,br:jt,tex:Vt,pixelOffsetTL:$t,pixelOffsetBR:se,minFontScaleX:Yt,minFontScaleY:Kt,glyphOffset:zt,isSDF:ye,sectionIndex:_e}=o[rt],me=z.vertexLength,ce=zt[1];R_(N,A.x,A.y,pt.x,ce+pt.y,Vt.x,Vt.y,h,ye,$t.x,$t.y,Yt,Kt),R_(N,A.x,A.y,vt.x,ce+vt.y,Vt.x+Vt.w,Vt.y,h,ye,se.x,$t.y,Yt,Kt),R_(N,A.x,A.y,Pt.x,ce+Pt.y,Vt.x,Vt.y+Vt.h,h,ye,$t.x,se.y,Yt,Kt),R_(N,A.x,A.y,jt.x,ce+jt.y,Vt.x+Vt.w,Vt.y+Vt.h,h,ye,se.x,se.y,Yt,Kt),U0(i.dynamicLayoutVertexArray,A,ct),O.emplaceBack(me,me+2,me+1),O.emplaceBack(me+1,me+2,me+3),z.vertexLength+=4,z.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(zt[0]),rt!==o.length-1&&_e===o[rt+1].sectionIndex||i.programConfigurations.populatePaintArrays(N.length,y,y.index,{imagePositions:{},canonical:F,formattedSection:J&&J[_e]})}i.placedSymbolArray.emplaceBack(A.x,A.y,H,this.glyphOffsetArray.length-H,q,E,M,A.segment,h?h[0]:0,h?h[1]:0,p[0],p[1],x,0,!1,0,P)}_addCollisionDebugVertex(i,o,h,p,g,y){return o.emplaceBack(0,0),i.emplaceBack(h.x,h.y,p,g,Math.round(y.x),Math.round(y.y))}addCollisionDebugVertices(i,o,h,p,g,y,x){const A=g.segments.prepareSegment(4,g.layoutVertexArray,g.indexArray),E=A.vertexLength,M=g.layoutVertexArray,P=g.collisionVertexArray,F=x.anchorX,O=x.anchorY;this._addCollisionDebugVertex(M,P,y,F,O,new T(i,o)),this._addCollisionDebugVertex(M,P,y,F,O,new T(h,o)),this._addCollisionDebugVertex(M,P,y,F,O,new T(h,p)),this._addCollisionDebugVertex(M,P,y,F,O,new T(i,p)),A.vertexLength+=4;const N=g.indexArray;N.emplaceBack(E,E+1),N.emplaceBack(E+1,E+2),N.emplaceBack(E+2,E+3),N.emplaceBack(E+3,E),A.primitiveLength+=4}addDebugCollisionBoxes(i,o,h,p){for(let g=i;g<o;g++){const y=this.collisionBoxArray.get(g);this.addCollisionDebugVertices(y.x1,y.y1,y.x2,y.y2,p?this.textCollisionBox:this.iconCollisionBox,y.anchorPoint,h)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new V0(Rt,IE.members,Zt),this.iconCollisionBox=new V0(Rt,IE.members,Zt);for(let i=0;i<this.symbolInstances.length;i++){const o=this.symbolInstances.get(i);this.addDebugCollisionBoxes(o.textBoxStartIndex,o.textBoxEndIndex,o,!0),this.addDebugCollisionBoxes(o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o,!0),this.addDebugCollisionBoxes(o.iconBoxStartIndex,o.iconBoxEndIndex,o,!1),this.addDebugCollisionBoxes(o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex,o,!1)}}_deserializeCollisionBoxesForSymbol(i,o,h,p,g,y,x,A,E){const M={};for(let P=o;P<h;P++){const F=i.get(P);M.textBox={x1:F.x1,y1:F.y1,x2:F.x2,y2:F.y2,anchorPointX:F.anchorPointX,anchorPointY:F.anchorPointY},M.textFeatureIndex=F.featureIndex;break}for(let P=p;P<g;P++){const F=i.get(P);M.verticalTextBox={x1:F.x1,y1:F.y1,x2:F.x2,y2:F.y2,anchorPointX:F.anchorPointX,anchorPointY:F.anchorPointY},M.verticalTextFeatureIndex=F.featureIndex;break}for(let P=y;P<x;P++){const F=i.get(P);M.iconBox={x1:F.x1,y1:F.y1,x2:F.x2,y2:F.y2,anchorPointX:F.anchorPointX,anchorPointY:F.anchorPointY},M.iconFeatureIndex=F.featureIndex;break}for(let P=A;P<E;P++){const F=i.get(P);M.verticalIconBox={x1:F.x1,y1:F.y1,x2:F.x2,y2:F.y2,anchorPointX:F.anchorPointX,anchorPointY:F.anchorPointY},M.verticalIconFeatureIndex=F.featureIndex;break}return M}deserializeCollisionBoxes(i){this.collisionArrays=[];for(let o=0;o<this.symbolInstances.length;o++){const h=this.symbolInstances.get(o);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(i,h.textBoxStartIndex,h.textBoxEndIndex,h.verticalTextBoxStartIndex,h.verticalTextBoxEndIndex,h.iconBoxStartIndex,h.iconBoxEndIndex,h.verticalIconBoxStartIndex,h.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(i,o){const h=i.placedSymbolArray.get(o),p=h.vertexStartIndex+4*h.numGlyphs;for(let g=h.vertexStartIndex;g<p;g+=4)i.indexArray.emplaceBack(g,g+2,g+1),i.indexArray.emplaceBack(g+1,g+2,g+3)}getSortedSymbolIndexes(i){if(this.sortedAngle===i&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const o=Math.sin(i),h=Math.cos(i),p=[],g=[],y=[];for(let x=0;x<this.symbolInstances.length;++x){y.push(x);const A=this.symbolInstances.get(x);p.push(0|Math.round(o*A.anchorX+h*A.anchorY)),g.push(A.featureIndex)}return y.sort(((x,A)=>p[x]-p[A]||g[A]-g[x])),y}addToSortKeyRanges(i,o){const h=this.sortKeyRanges[this.sortKeyRanges.length-1];h&&h.sortKey===o?h.symbolInstanceEnd=i+1:this.sortKeyRanges.push({sortKey:o,symbolInstanceStart:i,symbolInstanceEnd:i+1})}sortFeatures(i){if(this.sortFeaturesByY&&this.sortedAngle!==i&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(i),this.sortedAngle=i,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const o of this.symbolInstanceIndexes){const h=this.symbolInstances.get(o);this.featureSortOrder.push(h.featureIndex),[h.rightJustifiedTextSymbolIndex,h.centerJustifiedTextSymbolIndex,h.leftJustifiedTextSymbolIndex].forEach(((p,g,y)=>{p>=0&&y.indexOf(p)===g&&this.addIndicesForPlacedSymbol(this.text,p)})),h.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,h.verticalPlacedTextSymbolIndex),h.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,h.placedIconSymbolIndex),h.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,h.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let jE,HE;oe("SymbolBucket",Ou,{omit:["layers","collisionBoxArray","features","compareText"]}),Ou.MAX_GLYPHS=65535,Ou.addDynamicAttributes=U0;var j0={get paint(){return HE=HE||new Xi({"icon-opacity":new xe(tt.paint_symbol["icon-opacity"]),"icon-color":new xe(tt.paint_symbol["icon-color"]),"icon-halo-color":new xe(tt.paint_symbol["icon-halo-color"]),"icon-halo-width":new xe(tt.paint_symbol["icon-halo-width"]),"icon-halo-blur":new xe(tt.paint_symbol["icon-halo-blur"]),"icon-translate":new fe(tt.paint_symbol["icon-translate"]),"icon-translate-anchor":new fe(tt.paint_symbol["icon-translate-anchor"]),"text-opacity":new xe(tt.paint_symbol["text-opacity"]),"text-color":new xe(tt.paint_symbol["text-color"],{runtimeType:Ai,getOverride:l=>l.textColor,hasOverride:l=>!!l.textColor}),"text-halo-color":new xe(tt.paint_symbol["text-halo-color"]),"text-halo-width":new xe(tt.paint_symbol["text-halo-width"]),"text-halo-blur":new xe(tt.paint_symbol["text-halo-blur"]),"text-translate":new fe(tt.paint_symbol["text-translate"]),"text-translate-anchor":new fe(tt.paint_symbol["text-translate-anchor"])})},get layout(){return jE=jE||new Xi({"symbol-placement":new fe(tt.layout_symbol["symbol-placement"]),"symbol-spacing":new fe(tt.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new fe(tt.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new xe(tt.layout_symbol["symbol-sort-key"]),"symbol-z-order":new fe(tt.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new fe(tt.layout_symbol["icon-allow-overlap"]),"icon-overlap":new fe(tt.layout_symbol["icon-overlap"]),"icon-ignore-placement":new fe(tt.layout_symbol["icon-ignore-placement"]),"icon-optional":new fe(tt.layout_symbol["icon-optional"]),"icon-rotation-alignment":new fe(tt.layout_symbol["icon-rotation-alignment"]),"icon-size":new xe(tt.layout_symbol["icon-size"]),"icon-text-fit":new fe(tt.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new fe(tt.layout_symbol["icon-text-fit-padding"]),"icon-image":new xe(tt.layout_symbol["icon-image"]),"icon-rotate":new xe(tt.layout_symbol["icon-rotate"]),"icon-padding":new xe(tt.layout_symbol["icon-padding"]),"icon-keep-upright":new fe(tt.layout_symbol["icon-keep-upright"]),"icon-offset":new xe(tt.layout_symbol["icon-offset"]),"icon-anchor":new xe(tt.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new fe(tt.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new fe(tt.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new fe(tt.layout_symbol["text-rotation-alignment"]),"text-field":new xe(tt.layout_symbol["text-field"]),"text-font":new xe(tt.layout_symbol["text-font"]),"text-size":new xe(tt.layout_symbol["text-size"]),"text-max-width":new xe(tt.layout_symbol["text-max-width"]),"text-line-height":new fe(tt.layout_symbol["text-line-height"]),"text-letter-spacing":new xe(tt.layout_symbol["text-letter-spacing"]),"text-justify":new xe(tt.layout_symbol["text-justify"]),"text-radial-offset":new xe(tt.layout_symbol["text-radial-offset"]),"text-variable-anchor":new fe(tt.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new xe(tt.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new xe(tt.layout_symbol["text-anchor"]),"text-max-angle":new fe(tt.layout_symbol["text-max-angle"]),"text-writing-mode":new fe(tt.layout_symbol["text-writing-mode"]),"text-rotate":new xe(tt.layout_symbol["text-rotate"]),"text-padding":new fe(tt.layout_symbol["text-padding"]),"text-keep-upright":new fe(tt.layout_symbol["text-keep-upright"]),"text-transform":new xe(tt.layout_symbol["text-transform"]),"text-offset":new xe(tt.layout_symbol["text-offset"]),"text-allow-overlap":new fe(tt.layout_symbol["text-allow-overlap"]),"text-overlap":new fe(tt.layout_symbol["text-overlap"]),"text-ignore-placement":new fe(tt.layout_symbol["text-ignore-placement"]),"text-optional":new fe(tt.layout_symbol["text-optional"])})}};class GE{constructor(i){if(i.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=i.property.overrides?i.property.overrides.runtimeType:sr,this.defaultValue=i}evaluate(i){if(i.formattedSection){const o=this.defaultValue.property.overrides;if(o&&o.hasOverride(i.formattedSection))return o.getOverride(i.formattedSection)}return i.feature&&i.featureState?this.defaultValue.evaluate(i.feature,i.featureState):this.defaultValue.property.specification.default}eachChild(i){this.defaultValue.isConstant()||i(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}oe("FormatSectionOverride",GE,{omit:["defaultValue"]});class P_ extends Es{constructor(i,o){super(i,j0,o)}recalculate(i,o){if(super.recalculate(i,o),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const h=this.layout.get("text-writing-mode");if(h){const p=[];for(const g of h)p.indexOf(g)<0&&p.push(g);this.layout._values["text-writing-mode"]=p}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(i,o,h,p){const g=this.layout.get(i).evaluate(o,{},h,p),y=this._unevaluatedLayout._values[i];return y.isDataDriven()||nu(y.value)||!g?g:(function(x,A){return A.replace(/{([^{}]+)}/g,((E,M)=>x&&M in x?String(x[M]):""))})(o.properties,g)}createBucket(i){return new Ou(i)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const i of j0.paint.overridableProperties){if(!P_.hasPaintOverride(this.layout,i))continue;const o=this.paint.get(i),h=new GE(o),p=new su(h,o.property.specification);let g=null;g=o.value.kind==="constant"||o.value.kind==="source"?new Uo("source",p):new au("composite",p,o.value.zoomStops),this.paint._values[i]=new Ks(o.property,g,o.parameters)}}_handleOverridablePaintPropertyUpdate(i,o,h){return!(!this.layout||o.isDataDriven()||h.isDataDriven())&&P_.hasPaintOverride(this.layout,i)}static hasPaintOverride(i,o){const h=i.get("text-field"),p=j0.paint.properties[o];let g=!1;const y=x=>{for(const A of x)if(p.overrides&&p.overrides.hasOverride(A))return void(g=!0)};if(h.value.kind==="constant"&&h.value.value instanceof Yr)y(h.value.value.sections);else if(h.value.kind==="source"||h.value.kind==="composite"){const x=E=>{g||(E instanceof fo&&br(E.value)===zs?y(E.value.sections):E instanceof Fo?y(E.sections):E.eachChild(x))},A=h.value;A._styleExpression&&x(A._styleExpression.expression)}return g}}let $E;var p9={get paint(){return $E=$E||new Xi({"background-color":new fe(tt.paint_background["background-color"]),"background-pattern":new bu(tt.paint_background["background-pattern"]),"background-opacity":new fe(tt.paint_background["background-opacity"])})}};class _9 extends Es{constructor(i,o){super(i,p9,o)}}class g9 extends Es{constructor(i,o){super(i,{},o),this.onAdd=h=>{this.implementation.onAdd&&this.implementation.onAdd(h,h.painter.context.gl)},this.onRemove=h=>{this.implementation.onRemove&&this.implementation.onRemove(h,h.painter.context.gl)},this.implementation=i}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class m9{constructor(i){this._methodToThrottle=i,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._methodToThrottle()}),0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const y9={once:!0},H0=63710088e-1;class Va{constructor(i,o){if(isNaN(i)||isNaN(o))throw new Error(`Invalid LngLat object: (${i}, ${o})`);if(this.lng=+i,this.lat=+o,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Va(ur(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(i){const o=Math.PI/180,h=this.lat*o,p=i.lat*o,g=Math.sin(h)*Math.sin(p)+Math.cos(h)*Math.cos(p)*Math.cos((i.lng-this.lng)*o);return H0*Math.acos(Math.min(g,1))}static convert(i){if(i instanceof Va)return i;if(Array.isArray(i)&&(i.length===2||i.length===3))return new Va(Number(i[0]),Number(i[1]));if(!Array.isArray(i)&&typeof i=="object"&&i!==null)return new Va(Number("lng"in i?i.lng:i.lon),Number(i.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const WE=2*Math.PI*H0;function XE(l){return WE*Math.cos(l*Math.PI/180)}function qE(l){return(180+l)/360}function ZE(l){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+l*Math.PI/360)))/360}function YE(l,i){return l/XE(i)}function KE(l){return 360*l-180}function B_(l){return 360/Math.PI*Math.atan(Math.exp((180-360*l)*Math.PI/180))-90}function JE(l,i){return l*XE(B_(i))}class Hd{constructor(i,o,h=0){this.x=+i,this.y=+o,this.z=+h}static fromLngLat(i,o=0){const h=Va.convert(i);return new Hd(qE(h.lng),ZE(h.lat),YE(o,h.lat))}toLngLat(){return new Va(KE(this.x),B_(this.y))}toAltitude(){return JE(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/WE*(i=B_(this.y),1/Math.cos(i*Math.PI/180));var i}}function QE(l,i,o){var h=2*Math.PI*6378137/256/Math.pow(2,o);return[l*h-2*Math.PI*6378137/2,i*h-2*Math.PI*6378137/2]}class G0{constructor(i,o,h){if(!(function(p,g,y){return!(p<0||p>25||y<0||y>=Math.pow(2,p)||g<0||g>=Math.pow(2,p))})(i,o,h))throw new Error(`x=${o}, y=${h}, z=${i} outside of bounds. 0<=x<${Math.pow(2,i)}, 0<=y<${Math.pow(2,i)} 0<=z<=25 `);this.z=i,this.x=o,this.y=h,this.key=ku(0,i,i,o,h)}equals(i){return this.z===i.z&&this.x===i.x&&this.y===i.y}url(i,o,h){const p=(y=this.y,x=this.z,A=QE(256*(g=this.x),256*(y=Math.pow(2,x)-y-1),x),E=QE(256*(g+1),256*(y+1),x),A[0]+","+A[1]+","+E[0]+","+E[1]);var g,y,x,A,E;const M=(function(P,F,O){let N,z="";for(let H=P;H>0;H--)N=1<<H-1,z+=(F&N?1:0)+(O&N?2:0);return z})(this.z,this.x,this.y);return i[(this.x+this.y)%i.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(h==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,o>1?"@2x":"").replace(/{quadkey}/g,M).replace(/{bbox-epsg-3857}/g,p)}isChildOf(i){const o=this.z-i.z;return o>0&&i.x===this.x>>o&&i.y===this.y>>o}getTilePoint(i){const o=Math.pow(2,this.z);return new T((i.x*o-this.x)*Le,(i.y*o-this.y)*Le)}toString(){return`${this.z}/${this.x}/${this.y}`}}class tS{constructor(i,o){this.wrap=i,this.canonical=o,this.key=ku(i,o.z,o.z,o.x,o.y)}}class Qs{constructor(i,o,h,p,g){if(this.terrainRttPosMatrix32f=null,i<h)throw new Error(`overscaledZ should be >= z; overscaledZ = ${i}; z = ${h}`);this.overscaledZ=i,this.wrap=o,this.canonical=new G0(h,+p,+g),this.key=ku(o,i,h,p,g)}clone(){return new Qs(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(i){return this.overscaledZ===i.overscaledZ&&this.wrap===i.wrap&&this.canonical.equals(i.canonical)}scaledTo(i){if(i>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${i}; overscaledZ = ${this.overscaledZ}`);const o=this.canonical.z-i;return i>this.canonical.z?new Qs(i,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Qs(i,this.wrap,i,this.canonical.x>>o,this.canonical.y>>o)}isOverscaled(){return this.overscaledZ>this.canonical.z}calculateScaledKey(i,o){if(i>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${i}; overscaledZ = ${this.overscaledZ}`);const h=this.canonical.z-i;return i>this.canonical.z?ku(this.wrap*+o,i,this.canonical.z,this.canonical.x,this.canonical.y):ku(this.wrap*+o,i,i,this.canonical.x>>h,this.canonical.y>>h)}isChildOf(i){if(i.wrap!==this.wrap||this.overscaledZ-i.overscaledZ<=0)return!1;if(i.overscaledZ===0)return this.overscaledZ>0;const o=this.canonical.z-i.canonical.z;return!(o<0)&&i.canonical.x===this.canonical.x>>o&&i.canonical.y===this.canonical.y>>o}children(i){if(this.overscaledZ>=i)return[new Qs(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const o=this.canonical.z+1,h=2*this.canonical.x,p=2*this.canonical.y;return[new Qs(o,this.wrap,o,h,p),new Qs(o,this.wrap,o,h+1,p),new Qs(o,this.wrap,o,h,p+1),new Qs(o,this.wrap,o,h+1,p+1)]}isLessThan(i){return this.wrap<i.wrap||!(this.wrap>i.wrap)&&(this.overscaledZ<i.overscaledZ||!(this.overscaledZ>i.overscaledZ)&&(this.canonical.x<i.canonical.x||!(this.canonical.x>i.canonical.x)&&this.canonical.y<i.canonical.y))}wrapped(){return new Qs(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(i){return new Qs(this.overscaledZ,i,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new tS(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(i){return this.canonical.getTilePoint(new Hd(i.x-this.wrap,i.y))}}function ku(l,i,o,h,p){(l*=2)<0&&(l=-1*l-1);const g=1<<o;return(g*g*l+g*p+h).toString(36)+o.toString(36)+i.toString(36)}function Gd(l,i){return i?l.properties[i]:l.id}oe("CanonicalTileID",G0),oe("OverscaledTileID",Qs,{omit:["terrainRttPosMatrix32f"]});class Wl{constructor(){this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0}extend(i){return this.minX=Math.min(this.minX,i.x),this.minY=Math.min(this.minY,i.y),this.maxX=Math.max(this.maxX,i.x),this.maxY=Math.max(this.maxY,i.y),this}expandBy(i){return this.minX-=i,this.minY-=i,this.maxX+=i,this.maxY+=i,(this.minX>this.maxX||this.minY>this.maxY)&&(this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0),this}shrinkBy(i){return this.expandBy(-i)}map(i){const o=new Wl;return o.extend(i(new T(this.minX,this.minY))),o.extend(i(new T(this.maxX,this.minY))),o.extend(i(new T(this.minX,this.maxY))),o.extend(i(new T(this.maxX,this.maxY))),o}static fromPoints(i){const o=new Wl;for(const h of i)o.extend(h);return o}contains(i){return i.x>=this.minX&&i.x<=this.maxX&&i.y>=this.minY&&i.y<=this.maxY}empty(){return this.minX>this.maxX}width(){return this.maxX-this.minX}height(){return this.maxY-this.minY}covers(i){return!this.empty()&&!i.empty()&&i.minX>=this.minX&&i.maxX<=this.maxX&&i.minY>=this.minY&&i.maxY<=this.maxY}intersects(i){return!this.empty()&&!i.empty()&&i.minX<=this.maxX&&i.maxX>=this.minX&&i.minY<=this.maxY&&i.maxY>=this.minY}}class eS{constructor(i){this._stringToNumber={},this._numberToString=[];for(let o=0;o<i.length;o++){const h=i[o];this._stringToNumber[h]=o,this._numberToString[o]=h}}encode(i){return this._stringToNumber[i]}decode(i){if(i>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${i} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[i]}}class rS{constructor(i,o,h,p,g){this.type="Feature",this._vectorTileFeature=i,i._z=o,i._x=h,i._y=p,this.properties=i.properties,this.id=g}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(i){this._geometry=i}toJSON(){const i={geometry:this.geometry};for(const o in this)o!=="_geometry"&&o!=="_vectorTileFeature"&&(i[o]=this[o]);return i}}class Nu{_name;dataBuffer;nullabilityBuffer;_size;constructor(i,o,h){this._name=i,this.dataBuffer=o,typeof h=="number"?this._size=h:(this.nullabilityBuffer=h,this._size=h.size())}getValue(i){return this.nullabilityBuffer&&!this.nullabilityBuffer.get(i)?null:this.getValueFromBuffer(i)}has(i){return this.nullabilityBuffer&&this.nullabilityBuffer.get(i)||!this.nullabilityBuffer}get name(){return this._name}get size(){return this._size}}class D_ extends Nu{}class $0 extends D_{getValueFromBuffer(i){return this.dataBuffer[i]}}class W0 extends D_{getValueFromBuffer(i){return this.dataBuffer[i]}}class iS extends Nu{delta;constructor(i,o,h,p){super(i,o,p),this.delta=h}}class X0 extends iS{constructor(i,o,h,p){super(i,Int32Array.of(o),h,p)}getValueFromBuffer(i){return this.dataBuffer[0]+i*this.delta}}class q0 extends Nu{constructor(i,o,h){super(i,Int32Array.of(o),h)}getValueFromBuffer(i){return this.dataBuffer[0]}}class b9{_name;_geometryVector;_idVector;_propertyVectors;_extent;propertyVectorsMap;constructor(i,o,h,p,g=4096){this._name=i,this._geometryVector=o,this._idVector=h,this._propertyVectors=p,this._extent=g}get name(){return this._name}get idVector(){return this._idVector}get geometryVector(){return this._geometryVector}get propertyVectors(){return this._propertyVectors}getPropertyVector(i){return this.propertyVectorsMap||(this.propertyVectorsMap=new Map(this._propertyVectors.map((o=>[o.name,o])))),this.propertyVectorsMap.get(i)}*[Symbol.iterator](){const i=this.geometryVector[Symbol.iterator]();let o=0;for(;o<this.numFeatures;){let h;this.idVector&&(h=this.containsMaxSaveIntegerValues(this.idVector)?Number(this.idVector.getValue(o)):this.idVector.getValue(o));const p=i?.next().value,g={};for(const y of this.propertyVectors){if(!y)continue;const x=y.name,A=y.getValue(o);A!==null&&(g[x]=A)}o++,yield{id:h,geometry:p,properties:g}}}get numFeatures(){return this.geometryVector.numGeometries}get extent(){return this._extent}getFeatures(){const i=[],o=this.geometryVector.getGeometries();for(let h=0;h<this.numFeatures;h++){let p;this.idVector&&(p=this.containsMaxSaveIntegerValues(this.idVector)?Number(this.idVector.getValue(h)):this.idVector.getValue(h));const g={coordinates:o[h],type:this.geometryVector.geometryType(h)},y={};for(const x of this.propertyVectors){if(!x)continue;const A=x.name,E=x.getValue(h);E!==null&&(y[A]=E)}i.push({id:p,geometry:g,properties:y})}return i}containsMaxSaveIntegerValues(i){return i instanceof $0||i instanceof q0&&i instanceof X0||i instanceof W0}}class v9{value;constructor(i){this.value=i}get(){return this.value}set(i){this.value=i}increment(){return this.value++}add(i){this.value+=i}}var Ui,ke,Xo,Gn,Xl,Cs,di,fi,sS,tn;(function(l){l.PRESENT="PRESENT",l.DATA="DATA",l.OFFSET="OFFSET",l.LENGTH="LENGTH"})(Ui||(Ui={}));class Z0{_dictionaryType;_offsetType;_lengthType;constructor(i,o,h){this._dictionaryType=i,this._offsetType=o,this._lengthType=h}get dictionaryType(){return this._dictionaryType}get offsetType(){return this._offsetType}get lengthType(){return this._lengthType}}function ii(l,i,o){const h=new Int32Array(o);let p=0,g=i.get();for(let y=0;y<h.length;y++){let x=l[g++],A=127&x;x<128||(x=l[g++],A|=(127&x)<<7,x<128||(x=l[g++],A|=(127&x)<<14,x<128||(x=l[g++],A|=(127&x)<<21,x<128||(x=l[g++],A|=(15&x)<<28)))),h[p++]=A}return i.set(g),h}function F_(l,i,o){const h=new BigInt64Array(o);for(let p=0;p<h.length;p++)h[p]=w9(l,i);return h}function x9(l,i){let o,h;return h=l[i.get()],i.increment(),o=127&h,h<128?o:(h=l[i.get()],i.increment(),o|=(127&h)<<7,h<128?o:(h=l[i.get()],i.increment(),o|=(127&h)<<14,h<128?o:(h=l[i.get()],i.increment(),o|=(127&h)<<21,h<128?o:(h=l[i.get()],o|=(15&h)<<28,(function(p,g,y){let x,A;if(A=g[y.get()],y.increment(),x=(112&A)>>4,A<128||(A=g[y.get()],y.increment(),x|=(127&A)<<3,A<128)||(A=g[y.get()],y.increment(),x|=(127&A)<<10,A<128)||(A=g[y.get()],y.increment(),x|=(127&A)<<17,A<128)||(A=g[y.get()],y.increment(),x|=(127&A)<<24,A<128)||(A=g[y.get()],y.increment(),x|=(1&A)<<31,A<128))return 4294967296*x+(p>>>0);throw new Error("Expected varint not more than 10 bytes")})(o,l,i)))))}function nS(l,i,o,h){throw new Error("FastPFor is not implemented yet.")}function ql(l){return l>>>1^-(1&l)}function Lu(l){return l>>1n^-(1n&l)}function w9(l,i){let o=0n,h=0,p=i.get();for(;p<l.length;){const g=l[p++];if(o|=BigInt(127&g)<<BigInt(h),!(128&g))break;if(h+=7,h>=64)throw new Error("Varint too long")}return i.set(p),o}function oS(l,i,o){const h=new Int32Array(o);let p=0;for(let g=0;g<i;g++){const y=l[g];h.fill(l[g+i],p,p+y),p+=y}return h}function aS(l,i,o){const h=new BigInt64Array(o);let p=0;for(let g=0;g<i;g++){const y=Number(l[g]);h.fill(l[g+i],p,p+y),p+=y}return h}function lS(l,i,o){const h=new Float64Array(o);let p=0;for(let g=0;g<i;g++){const y=l[g];h.fill(l[g+i],p,p+y),p+=y}return h}function Y0(l){const i=l.length/4*4;let o=1;if(i>=4)for(let h=l[0];o<i-4;o+=4)h=l[o]+=h,h=l[o+1]+=h,h=l[o+2]+=h,h=l[o+3]+=h;for(;o!=l.length;)l[o]+=l[o-1],++o}function cS(l){l[0]=l[0]>>>1^-(1&l[0]),l[1]=l[1]>>>1^-(1&l[1]);const i=l.length/4*4;let o=2;if(i>=4)for(;o<i-4;o+=4){const h=l[o],p=l[o+1],g=l[o+2],y=l[o+3];l[o]=(h>>>1^-(1&h))+l[o-2],l[o+1]=(p>>>1^-(1&p))+l[o-1],l[o+2]=(g>>>1^-(1&g))+l[o],l[o+3]=(y>>>1^-(1&y))+l[o+1]}for(;o!=l.length;o+=2)l[o]=(l[o]>>>1^-(1&l[o]))+l[o-2],l[o+1]=(l[o+1]>>>1^-(1&l[o+1]))+l[o-1]}function ja(l,i,o){return Math.min(o,Math.max(i,l))}(function(l){l.NONE="NONE",l.DELTA="DELTA",l.COMPONENTWISE_DELTA="COMPONENTWISE_DELTA",l.RLE="RLE",l.MORTON="MORTON",l.PDE="PDE"})(ke||(ke={})),(function(l){l.NONE="NONE",l.FAST_PFOR="FAST_PFOR",l.VARINT="VARINT",l.ALP="ALP"})(Xo||(Xo={})),(function(l){l.NONE="NONE",l.SINGLE="SINGLE",l.SHARED="SHARED",l.VERTEX="VERTEX",l.MORTON="MORTON",l.FSST="FSST"})(Gn||(Gn={})),(function(l){l.VERTEX="VERTEX",l.INDEX="INDEX",l.STRING="STRING",l.KEY="KEY"})(Xl||(Xl={})),(function(l){l.VAR_BINARY="VAR_BINARY",l.GEOMETRIES="GEOMETRIES",l.PARTS="PARTS",l.RINGS="RINGS",l.TRIANGLES="TRIANGLES",l.SYMBOL="SYMBOL",l.DICTIONARY="DICTIONARY"})(Cs||(Cs={}));class Zl{_physicalStreamType;_logicalStreamType;_logicalLevelTechnique1;_logicalLevelTechnique2;_physicalLevelTechnique;_numValues;_byteLength;constructor(i,o,h,p,g,y,x){this._physicalStreamType=i,this._logicalStreamType=o,this._logicalLevelTechnique1=h,this._logicalLevelTechnique2=p,this._physicalLevelTechnique=g,this._numValues=y,this._byteLength=x}static decode(i,o){const h=i[o.get()],p=Object.values(Ui)[h>>4];let g=null;switch(p){case Ui.DATA:g=new Z0(Object.values(Gn)[15&h]);break;case Ui.OFFSET:g=new Z0(null,Object.values(Xl)[15&h]);break;case Ui.LENGTH:g=new Z0(null,null,Object.values(Cs)[15&h])}o.increment();const y=i[o.get()],x=Object.values(ke)[y>>5],A=Object.values(ke)[y>>2&7],E=Object.values(Xo)[3&y];o.increment();const M=ii(i,o,2);return new Zl(p,g,x,A,E,M[0],M[1])}get physicalStreamType(){return this._physicalStreamType}get logicalStreamType(){return this._logicalStreamType}get logicalLevelTechnique1(){return this._logicalLevelTechnique1}get logicalLevelTechnique2(){return this._logicalLevelTechnique2}get physicalLevelTechnique(){return this._physicalLevelTechnique}get numValues(){return this._numValues}get byteLength(){return this._byteLength}getDecompressedCount(){return this._numValues}}class O_ extends Zl{num_bits;coordinate_shift;constructor(i,o,h,p,g,y,x,A,E){super(i,o,h,p,g,y,x),this.num_bits=A,this.coordinate_shift=E}static decode(i,o){const h=Zl.decode(i,o),p=ii(i,o,2);return new O_(h.physicalStreamType,h.logicalStreamType,h.logicalLevelTechnique1,h.logicalLevelTechnique2,h.physicalLevelTechnique,h.numValues,h.byteLength,p[0],p[1])}static decodePartial(i,o,h){const p=ii(o,h,2);return new O_(i.physicalStreamType,i.logicalStreamType,i.logicalLevelTechnique1,i.logicalLevelTechnique2,i.physicalLevelTechnique,i.numValues,i.byteLength,p[0],p[1])}numBits(){return this.num_bits}coordinateShift(){return this.coordinate_shift}}class $d extends Zl{_runs;_numRleValues;constructor(i,o,h,p,g,y,x,A,E){super(i,o,h,p,g,y,x),this._runs=A,this._numRleValues=E}static decode(i,o){const h=Zl.decode(i,o),p=ii(i,o,2);return new $d(h.physicalStreamType,h.logicalStreamType,h.logicalLevelTechnique1,h.logicalLevelTechnique2,h.physicalLevelTechnique,h.numValues,h.byteLength,p[0],p[1])}static decodePartial(i,o,h){const p=ii(o,h,2);return new $d(i.physicalStreamType,i.logicalStreamType,i.logicalLevelTechnique1,i.logicalLevelTechnique2,i.physicalLevelTechnique,i.numValues,i.byteLength,p[0],p[1])}get runs(){return this._runs}get numRleValues(){return this._numRleValues}getDecompressedCount(){return this._numRleValues}}class qi{static decode(i,o){const h=Zl.decode(i,o);return h.logicalLevelTechnique1===ke.MORTON?O_.decodePartial(h,i,o):ke.RLE!==h.logicalLevelTechnique1&&ke.RLE!==h.logicalLevelTechnique2||Xo.NONE===h.physicalLevelTechnique?h:$d.decodePartial(h,i,o)}}(function(l){l[l.FLAT=0]="FLAT",l[l.CONST=1]="CONST",l[l.SEQUENCE=2]="SEQUENCE",l[l.DICTIONARY=3]="DICTIONARY",l[l.FSST_DICTIONARY=4]="FSST_DICTIONARY"})(di||(di={}));class $n{values;_size;constructor(i,o){this.values=i,this._size=o}get(i){const o=Math.floor(i/8);return(this.values[o]>>i%8&1)==1}set(i,o){const h=Math.floor(i/8);this.values[h]=this.values[h]|(o?1:0)<<i%8}getInt(i){const o=Math.floor(i/8);return this.values[o]>>i%8&1}size(){return this._size}getBuffer(){return this.values}}class Me{constructor(){}static decodeIntStream(i,o,h,p,g){const y=Me.decodePhysicalLevelTechnique(i,o,h);return this.decodeIntBuffer(y,h,p,g)}static decodeLengthStreamToOffsetBuffer(i,o,h){const p=Me.decodePhysicalLevelTechnique(i,o,h);return this.decodeLengthToOffsetBuffer(p,h)}static decodePhysicalLevelTechnique(i,o,h){const p=h.physicalLevelTechnique;if(p===Xo.FAST_PFOR)return nS();if(p===Xo.VARINT)return ii(i,o,h.numValues);if(p===Xo.NONE){const g=o.get();o.add(h.byteLength);const y=i.subarray(g,o.get());return new Int32Array(y)}throw new Error("Specified physicalLevelTechnique is not supported (yet).")}static decodeConstIntStream(i,o,h,p){const g=Me.decodePhysicalLevelTechnique(i,o,h);if(g.length===1){const y=g[0];return p?ql(y):y}return p?(function(y){return ql(y[1])})(g):(function(y){return y[1]})(g)}static decodeSequenceIntStream(i,o,h){return(function(p){if(p.length==2){const g=ql(p[1]);return[g,g]}return[ql(p[2]),ql(p[3])]})(Me.decodePhysicalLevelTechnique(i,o,h))}static decodeSequenceLongStream(i,o,h){return(function(p){if(p.length==2){const g=Lu(p[1]);return[g,g]}return[Lu(p[2]),Lu(p[3])]})(F_(i,o,h.numValues))}static decodeLongStream(i,o,h,p){const g=F_(i,o,h.numValues);return this.decodeLongBuffer(g,h,p)}static decodeLongFloat64Stream(i,o,h,p){const g=(function(y,x,A){const E=new Float64Array(x);for(let M=0;M<x;M++)E[M]=x9(y,A);return E})(i,h.numValues,o);return this.decodeFloat64Buffer(g,h,p)}static decodeConstLongStream(i,o,h,p){const g=F_(i,o,h.numValues);if(g.length===1){const y=g[0];return p?Lu(y):y}return p?(function(y){return Lu(y[1])})(g):(function(y){return y[1]})(g)}static decodeIntBuffer(i,o,h,p){switch(o.logicalLevelTechnique1){case ke.DELTA:return o.logicalLevelTechnique2===ke.RLE?(function(g,y,x){const A=new Int32Array(x);let E=0,M=0;for(let P=0;P<y;P++){const F=g[P],O=ql(g[P+y]);for(let N=0;N<F;N++)M+=O,A[E++]=M}return A})(i,o.runs,o.numRleValues):((function(g){g[0]=g[0]>>>1^-(1&g[0]);const y=g.length/4*4;let x=1;if(y>=4)for(;x<y-4;x+=4){const A=g[x],E=g[x+1],M=g[x+2],P=g[x+3];g[x]=(A>>>1^-(1&A))+g[x-1],g[x+1]=(E>>>1^-(1&E))+g[x],g[x+2]=(M>>>1^-(1&M))+g[x+1],g[x+3]=(P>>>1^-(1&P))+g[x+2]}for(;x!=g.length;++x)g[x]=(g[x]>>>1^-(1&g[x]))+g[x-1]})(i),i);case ke.RLE:return(function(g,y,x){return x?(function(A,E,M){const P=new Int32Array(M);let F=0;for(let O=0;O<E;O++){const N=A[O];let z=A[O+E];z=z>>>1^-(1&z),P.fill(z,F,F+N),F+=N}return P})(g,y.runs,y.numRleValues):oS(g,y.runs,y.numRleValues)})(i,o,h);case ke.MORTON:return Y0(i),i;case ke.COMPONENTWISE_DELTA:return p?((function(g,y,x,A){let E=g[0]>>>1^-(1&g[0]),M=g[1]>>>1^-(1&g[1]);g[0]=ja(Math.round(E*y),x,A),g[1]=ja(Math.round(M*y),x,A);const P=g.length/16;let F=2;if(P>=4)for(;F<P-4;F+=4){const O=g[F],N=g[F+1],z=(O>>>1^-(1&O))+E,H=(N>>>1^-(1&N))+M;g[F]=ja(Math.round(z*y),x,A),g[F+1]=ja(Math.round(H*y),x,A);const q=g[F+2],ct=g[F+3];E=(q>>>1^-(1&q))+z,M=(ct>>>1^-(1&ct))+H,g[F+2]=ja(Math.round(E*y),x,A),g[F+3]=ja(Math.round(M*y),x,A)}for(;F!=g.length;F+=2)E+=g[F]>>>1^-(1&g[F]),M+=g[F+1]>>>1^-(1&g[F+1]),g[F]=ja(Math.round(E*y),x,A),g[F+1]=ja(Math.round(M*y),x,A)})(i,p.scale,p.min,p.max),i):(cS(i),i);case ke.NONE:return h&&(function(g){for(let y=0;y<g.length;y++){const x=g[y];g[y]=x>>>1^-(1&x)}})(i),i;default:throw new Error(`The specified Logical level technique is not supported: ${o.logicalLevelTechnique1}`)}}static decodeLongBuffer(i,o,h){switch(o.logicalLevelTechnique1){case ke.DELTA:return o.logicalLevelTechnique2===ke.RLE?(function(p,g,y){const x=new BigInt64Array(y);let A=0,E=0n;for(let M=0;M<g;M++){const P=Number(p[M]),F=Lu(p[M+g]);for(let O=0;O<P;O++)E+=F,x[A++]=E}return x})(i,o.runs,o.numRleValues):((function(p){p[0]=p[0]>>1n^-(1n&p[0]);const g=p.length/4*4;let y=1;if(g>=4)for(;y<g-4;y+=4){const x=p[y],A=p[y+1],E=p[y+2],M=p[y+3];p[y]=(x>>1n^-(1n&x))+p[y-1],p[y+1]=(A>>1n^-(1n&A))+p[y],p[y+2]=(E>>1n^-(1n&E))+p[y+1],p[y+3]=(M>>1n^-(1n&M))+p[y+2]}for(;y!=p.length;++y)p[y]=(p[y]>>1n^-(1n&p[y]))+p[y-1]})(i),i);case ke.RLE:return(function(p,g,y){return y?(function(x,A,E){const M=new BigInt64Array(E);let P=0;for(let F=0;F<A;F++){const O=Number(x[F]);let N=x[F+A];N=N>>1n^-(1n&N),M.fill(N,P,P+O),P+=O}return M})(p,g.runs,g.numRleValues):aS(p,g.runs,g.numRleValues)})(i,o,h);case ke.NONE:return h&&(function(p){for(let g=0;g<p.length;g++){const y=p[g];p[g]=y>>1n^-(1n&y)}})(i),i;default:throw new Error(`The specified Logical level technique is not supported: ${o.logicalLevelTechnique1}`)}}static decodeFloat64Buffer(i,o,h){switch(o.logicalLevelTechnique1){case ke.DELTA:return o.logicalLevelTechnique2===ke.RLE&&(i=lS(i,o.runs,o.numRleValues)),(function(p){p[0]=p[0]%2==1?(p[0]+1)/-2:p[0]/2;const g=p.length/4*4;let y=1;if(g>=4)for(;y<g-4;y+=4){const x=p[y],A=p[y+1],E=p[y+2],M=p[y+3];p[y]=(x%2==1?(x+1)/-2:x/2)+p[y-1],p[y+1]=(A%2==1?(A+1)/-2:A/2)+p[y],p[y+2]=(E%2==1?(E+1)/-2:E/2)+p[y+1],p[y+3]=(M%2==1?(M+1)/-2:M/2)+p[y+2]}for(;y!=p.length;++y)p[y]=(p[y]%2==1?(p[y]+1)/-2:p[y]/2)+p[y-1]})(i),i;case ke.RLE:return(function(p,g,y){return y?(function(x,A,E){const M=new Float64Array(E);let P=0;for(let F=0;F<A;F++){const O=x[F];let N=x[F+A];N=N%2==1?(N+1)/-2:N/2,M.fill(N,P,P+O),P+=O}return M})(p,g.runs,g.numRleValues):lS(p,g.runs,g.numRleValues)})(i,o,h);case ke.NONE:return h&&(function(p){for(let g=0;g<p.length;g++){const y=p[g];p[g]=y%2==1?(y+1)/-2:y/2}})(i),i;default:throw new Error(`The specified Logical level technique is not supported: ${o.logicalLevelTechnique1}`)}}static decodeLengthToOffsetBuffer(i,o){if(o.logicalLevelTechnique1===ke.DELTA&&o.logicalLevelTechnique2===ke.NONE)return(function(h){const p=new Int32Array(h.length+1);p[0]=0,p[1]=ql(h[0]);let g=p[1],y=2;for(;y!=p.length;++y){const x=h[y-1];g+=x>>>1^-(1&x),p[y]=p[y-1]+g}return p})(i);if(o.logicalLevelTechnique1===ke.RLE&&o.logicalLevelTechnique2===ke.NONE)return(function(h,p,g){const y=new Int32Array(g+1);y[0]=0;let x=1,A=y[0];for(let E=0;E<p;E++){const M=h[E],P=h[E+p];for(let F=x;F<x+M;F++)y[F]=P+A,A=y[F];x+=M}return y})(i,o.runs,o.numRleValues);if(o.logicalLevelTechnique1===ke.NONE&&o.logicalLevelTechnique2===ke.NONE){(function(p){let g=0;for(let y=0;y<p.length;y++)p[y]+=g,g=p[y]})(i);const h=new Int32Array(o.numValues+1);return h[0]=0,h.set(i,1),h}if(o.logicalLevelTechnique1===ke.DELTA&&o.logicalLevelTechnique2===ke.RLE){const h=(function(p,g,y){const x=new Int32Array(y+1);x[0]=0;let A=1,E=x[0];for(let M=0;M<g;M++){const P=p[M];let F=p[M+g];F=F>>>1^-(1&F);for(let O=A;O<A+P;O++)x[O]=F+E,E=x[O];A+=P}return x})(i,o.runs,o.numRleValues);return Y0(h),h}throw new Error("Only delta encoding is supported for transforming length to offset streams yet.")}static decodeNullableIntStream(i,o,h,p,g){const y=h.physicalLevelTechnique===Xo.FAST_PFOR?nS():ii(i,o,h.numValues);return this.decodeNullableIntBuffer(y,h,p,g)}static decodeNullableLongStream(i,o,h,p,g){const y=F_(i,o,h.numValues);return this.decodeNullableLongBuffer(y,h,p,g)}static decodeNullableIntBuffer(i,o,h,p){switch(o.logicalLevelTechnique1){case ke.DELTA:return o.logicalLevelTechnique2===ke.RLE&&(i=oS(i,o.runs,o.numRleValues)),(function(g,y){const x=new Int32Array(g.size());let A=0;g.get(0)?(x[0]=g.get(0)?y[0]>>>1^-(1&y[0]):0,A=1):x[0]=0;let E=1;for(;E!=x.length;++E)x[E]=g.get(E)?x[E-1]+(y[A]>>>1^-(1&y[A++])):x[E-1];return x})(p,i);case ke.RLE:return(function(g,y,x,A){const E=y;return x?(function(M,P,F){const O=new Int32Array(M.size());let N=0;for(let z=0;z<F;z++){const H=P[z];let q=P[z+F];q=q>>>1^-(1&q);for(let ct=N;ct<N+H;ct++)M.get(ct)?O[ct]=q:(O[ct]=0,N++);N+=H}return O})(A,g,E.runs):(function(M,P,F){const O=new Int32Array(M.size());let N=0;for(let z=0;z<F;z++){const H=P[z],q=P[z+F];for(let ct=N;ct<N+H;ct++)M.get(ct)?O[ct]=q:(O[ct]=0,N++);N+=H}return O})(A,g,E.runs)})(i,o,h,p);case ke.MORTON:return Y0(i),i;case ke.COMPONENTWISE_DELTA:return cS(i),i;case ke.NONE:return i=h?(function(g,y){const x=new Int32Array(g.size());let A=0,E=0;for(;E!=x.length;++E)if(g.get(E)){const M=y[A++];x[E]=M>>>1^-(1&M)}else x[E]=0;return x})(p,i):(function(g,y){const x=new Int32Array(g.size());let A=0,E=0;for(;E!=x.length;++E)x[E]=g.get(E)?y[A++]:0;return x})(p,i),i;default:throw new Error("The specified Logical level technique is not supported")}}static decodeNullableLongBuffer(i,o,h,p){switch(o.logicalLevelTechnique1){case ke.DELTA:return o.logicalLevelTechnique2===ke.RLE&&(i=aS(i,o.runs,o.numRleValues)),(function(g,y){const x=new BigInt64Array(g.size());let A=0;g.get(0)?(x[0]=g.get(0)?y[0]>>1n^-(1n&y[0]):0n,A=1):x[0]=0n;let E=1;for(;E!=x.length;++E)x[E]=g.get(E)?x[E-1]+(y[A]>>1n^-(1n&y[A++])):x[E-1];return x})(p,i);case ke.RLE:return(function(g,y,x,A){const E=y;return x?(function(M,P,F){const O=new BigInt64Array(M.size());let N=0;for(let z=0;z<F;z++){const H=Number(P[z]);let q=P[z+F];q=q>>1n^-(1n&q);for(let ct=N;ct<N+H;ct++)M.get(ct)?O[ct]=q:(O[ct]=0n,N++);N+=H}return O})(A,g,E.runs):(function(M,P,F){const O=new BigInt64Array(M.size());let N=0;for(let z=0;z<F;z++){const H=Number(P[z]),q=P[z+F];for(let ct=N;ct<N+H;ct++)M.get(ct)?O[ct]=q:(O[ct]=0n,N++);N+=H}return O})(A,g,E.runs)})(i,o,h,p);case ke.NONE:return i=h?(function(g,y){const x=new BigInt64Array(g.size());let A=0,E=0;for(;E!=x.length;++E)if(g.get(E)){const M=y[A++];x[E]=M>>1n^-(1n&M)}else x[E]=0n;return x})(p,i):(function(g,y){const x=new BigInt64Array(g.size());let A=0,E=0;for(;E!=x.length;++E)x[E]=g.get(E)?y[A++]:0n;return x})(p,i),i;default:throw new Error("The specified Logical level technique is not supported")}}static getVectorType(i,o,h,p){const g=i.logicalLevelTechnique1;if(g===ke.RLE)return i.runs===1?di.CONST:di.FLAT;const y=o instanceof $n?o.size():o;if(g===ke.DELTA&&i.logicalLevelTechnique2===ke.RLE){const x=i.runs,A=2;if(i.numRleValues!==y)return di.FLAT;if(x===1)return di.SEQUENCE;if(x===2){const E=p.get();let M;if(i.physicalLevelTechnique===Xo.VARINT)M=ii(h,p,4);else{const P=p.get();M=new Int32Array(h.buffer,h.byteOffset+P,4)}if(p.set(E),M[2]===A&&M[3]===A)return di.SEQUENCE}}return i.numValues===1?di.CONST:di.FLAT}}class uS extends D_{getValueFromBuffer(i){return this.dataBuffer[i]}}class hS extends iS{constructor(i,o,h,p){super(i,BigInt64Array.of(o),h,p)}getValueFromBuffer(i){return this.dataBuffer[0]+BigInt(i)*this.delta}}class Uu{_geometryOffsets;_partOffsets;_ringOffsets;constructor(i,o,h){this._geometryOffsets=i,this._partOffsets=o,this._ringOffsets=h}get geometryOffsets(){return this._geometryOffsets}get partOffsets(){return this._partOffsets}get ringOffsets(){return this._ringOffsets}}class T9{tileExtent;_numBits;_coordinateShift;minBound;maxBound;constructor(i,o){this._coordinateShift=i<0?Math.abs(i):0,this.tileExtent=o+this._coordinateShift,this._numBits=Math.ceil(Math.log2(this.tileExtent)),this.minBound=i,this.maxBound=o}validateCoordinates(i){if(i.x<this.minBound||i.y<this.minBound||i.x>this.maxBound||i.y>this.maxBound)throw new Error("The specified tile buffer size is currently not supported.")}numBits(){return this._numBits}coordinateShift(){return this._coordinateShift}}class zu extends T9{encode(i){this.validateCoordinates(i);const o=i.x+this._coordinateShift,h=i.y+this._coordinateShift;let p=0;for(let g=0;g<this._numBits;g++)p|=(o&1<<g)<<g|(h&1<<g)<<g+1;return p}decode(i){return{x:this.decodeMorton(i)-this._coordinateShift,y:this.decodeMorton(i>>1)-this._coordinateShift}}decodeMorton(i){let o=0;for(let h=0;h<this._numBits;h++)o|=(i&1<<2*h)>>h;return o}static decode(i,o,h){return{x:zu.decodeMorton(i,o)-h,y:zu.decodeMorton(i>>1,o)-h}}static decodeMorton(i,o){let h=0;for(let p=0;p<o;p++)h|=(i&1<<2*p)>>p;return h}}(function(l){l[l.POINT=0]="POINT",l[l.LINESTRING=1]="LINESTRING",l[l.POLYGON=2]="POLYGON",l[l.MULTIPOINT=3]="MULTIPOINT",l[l.MULTILINESTRING=4]="MULTILINESTRING",l[l.MULTIPOLYGON=5]="MULTIPOLYGON"})(fi||(fi={})),(function(l){l[l.POINT=0]="POINT",l[l.LINESTRING=1]="LINESTRING",l[l.POLYGON=2]="POLYGON"})(sS||(sS={})),(function(l){l[l.MORTON=0]="MORTON",l[l.VEC_2=1]="VEC_2",l[l.VEC_3=2]="VEC_3"})(tn||(tn={}));class A9{createPoint(i){return[[i]]}createMultiPoint(i){return i.map((o=>[o]))}createLineString(i){return[i]}createMultiLineString(i){return i}createPolygon(i,o){return[i,...o]}createMultiPolygon(i){return i.flat()}}function dS(l){const i=new Array(l.numGeometries);let o=1,h=1,p=1,g=0;const y=new A9;let x=0,A=0;const E=l.mortonSettings,M=l.topologyVector,P=M.geometryOffsets,F=M.partOffsets,O=M.ringOffsets,N=l.vertexOffsets,z=l.containsPolygonGeometry(),H=l.vertexBuffer;for(let q=0;q<l.numGeometries;q++){const ct=l.geometryType(q);if(ct===fi.POINT){if(N&&N.length!==0)if(l.vertexBufferType===tn.VEC_2){const J=2*N[A++],rt=new T(H[J],H[J+1]);i[g++]=y.createPoint(rt)}else{const J=N[A++],rt=zu.decode(H[J],E.numBits,E.coordinateShift),pt=new T(rt.x,rt.y);i[g++]=y.createPoint(pt)}else{const J=new T(H[x++],H[x++]);i[g++]=y.createPoint(J)}P&&p++,F&&o++,O&&h++}else if(ct===fi.MULTIPOINT){const J=P[p]-P[p-1];p++;const rt=new Array(J);if(N&&N.length!==0){for(let pt=0;pt<J;pt++){const vt=2*N[A++];rt[pt]=new T(H[vt],H[vt+1])}i[g++]=y.createMultiPoint(rt)}else{for(let pt=0;pt<J;pt++){const vt=H[x++],Pt=H[x++];rt[pt]=new T(vt,Pt)}i[g++]=y.createMultiPoint(rt)}}else if(ct===fi.LINESTRING){let J,rt=0;z?(rt=O[h]-O[h-1],h++):rt=F[o]-F[o-1],o++,N&&N.length!==0?(J=l.vertexBufferType===tn.VEC_2?J0(H,N,A,rt,!1):Q0(H,N,A,rt,!1,E),A+=rt):(J=K0(H,x,rt,!1),x+=2*rt),i[g++]=y.createLineString(J),P&&p++}else if(ct===fi.POLYGON){const J=F[o]-F[o-1];o++;const rt=new Array(J-1);let pt=O[h]-O[h-1];if(h++,N&&N.length!==0){const vt=l.vertexBufferType===tn.VEC_2?N_(H,N,A,pt):L_(H,N,A,pt,0,E);A+=pt;for(let Pt=0;Pt<rt.length;Pt++)pt=O[h]-O[h-1],h++,rt[Pt]=l.vertexBufferType===tn.VEC_2?N_(H,N,A,pt):L_(H,N,A,pt,0,E),A+=pt;i[g++]=y.createPolygon(vt,rt)}else{const vt=k_(H,x,pt);x+=2*pt;for(let Pt=0;Pt<rt.length;Pt++)pt=O[h]-O[h-1],h++,rt[Pt]=k_(H,x,pt),x+=2*pt;i[g++]=y.createPolygon(vt,rt)}P&&p++}else if(ct===fi.MULTILINESTRING){const J=P[p]-P[p-1];p++;const rt=new Array(J);if(N&&N.length!==0){for(let pt=0;pt<J;pt++){let vt=0;z?(vt=O[h]-O[h-1],h++):vt=F[o]-F[o-1],o++;const Pt=l.vertexBufferType===tn.VEC_2?J0(H,N,A,vt,!1):Q0(H,N,A,vt,!1,E);rt[pt]=Pt,A+=vt}i[g++]=y.createMultiLineString(rt)}else{for(let pt=0;pt<J;pt++){let vt=0;z?(vt=O[h]-O[h-1],h++):vt=F[o]-F[o-1],o++,rt[pt]=K0(H,x,vt,!1),x+=2*vt}i[g++]=y.createMultiLineString(rt)}}else{if(ct!==fi.MULTIPOLYGON)throw new Error("The specified geometry type is currently not supported.");{const J=P[p]-P[p-1];p++;const rt=new Array(J);let pt=0;if(N&&N.length!==0){for(let vt=0;vt<J;vt++){const Pt=F[o]-F[o-1];o++;const jt=new Array(Pt-1);pt=O[h]-O[h-1],h++;const Vt=l.vertexBufferType===tn.VEC_2?N_(H,N,A,pt):L_(H,N,A,pt,0,E);A+=pt;for(let $t=0;$t<jt.length;$t++)pt=O[h]-O[h-1],h++,jt[$t]=l.vertexBufferType===tn.VEC_2?N_(H,N,A,pt):L_(H,N,A,pt,0,E),A+=pt;rt[vt]=y.createPolygon(Vt,jt)}i[g++]=y.createMultiPolygon(rt)}else{for(let vt=0;vt<J;vt++){const Pt=F[o]-F[o-1];o++;const jt=new Array(Pt-1);pt=O[h]-O[h-1],h++;const Vt=k_(H,x,pt);x+=2*pt;for(let $t=0;$t<jt.length;$t++){const se=O[h]-O[h-1];h++,jt[$t]=k_(H,x,se),x+=2*se}rt[vt]=y.createPolygon(Vt,jt)}i[g++]=y.createMultiPolygon(rt)}}}}return i}function k_(l,i,o){return K0(l,i,o,!0)}function N_(l,i,o,h){return J0(l,i,o,h,!0)}function L_(l,i,o,h,p,g){return Q0(l,i,o,h,!0,g)}function K0(l,i,o,h){const p=new Array(h?o+1:o);for(let g=0;g<2*o;g+=2)p[g/2]=new T(l[i+g],l[i+g+1]);return h&&(p[p.length-1]=p[0]),p}function J0(l,i,o,h,p){const g=new Array(p?h+1:h);for(let y=0;y<2*h;y+=2){const x=2*i[o+y/2];g[y/2]=new T(l[x],l[x+1])}return p&&(g[g.length-1]=g[0]),g}function Q0(l,i,o,h,p,g){const y=new Array(p?h+1:h);for(let x=0;x<h;x++){const A=zu.decode(l[i[o+x]],g.numBits,g.coordinateShift);y[x]=new T(A.x,A.y)}return p&&(y[y.length-1]=y[0]),y}class fS{_vertexBufferType;_topologyVector;_vertexOffsets;_vertexBuffer;_mortonSettings;constructor(i,o,h,p,g){this._vertexBufferType=i,this._topologyVector=o,this._vertexOffsets=h,this._vertexBuffer=p,this._mortonSettings=g}get vertexBufferType(){return this._vertexBufferType}get topologyVector(){return this._topologyVector}get vertexOffsets(){return this._vertexOffsets}get vertexBuffer(){return this._vertexBuffer}*[Symbol.iterator](){const i=dS(this);let o=0;for(;o<this.numGeometries;)yield{coordinates:i[o],type:this.geometryType(o)},o++}getSimpleEncodedVertex(i){const o=this.vertexOffsets?2*this.vertexOffsets[i]:2*i;return[this.vertexBuffer[o],this.vertexBuffer[o+1]]}getVertex(i){if(this.vertexOffsets&&this.mortonSettings){const h=zu.decode(this.vertexBuffer[this.vertexOffsets[i]],this.mortonSettings.numBits,this.mortonSettings.coordinateShift);return[h.x,h.y]}const o=this.vertexOffsets?2*this.vertexOffsets[i]:2*i;return[this.vertexBuffer[o],this.vertexBuffer[o+1]]}getGeometries(){return dS(this)}get mortonSettings(){return this._mortonSettings}}class Wd extends fS{_numGeometries;_geometryType;constructor(i,o,h,p,g,y,x){super(h,p,g,y,x),this._numGeometries=i,this._geometryType=o}static createMortonEncoded(i,o,h,p,g,y){return new Wd(i,o,tn.MORTON,h,p,g,y)}static create(i,o,h,p,g){return new Wd(i,o,tn.VEC_2,h,p,g)}geometryType(i){return this._geometryType}get numGeometries(){return this._numGeometries}containsPolygonGeometry(){return this._geometryType===fi.POLYGON||this._geometryType===fi.MULTIPOLYGON}containsSingleGeometryType(){return!0}}class Xd extends fS{_geometryTypes;constructor(i,o,h,p,g,y){super(i,h,p,g,y),this._geometryTypes=o}static createMortonEncoded(i,o,h,p,g){return new Xd(tn.MORTON,i,o,h,p,g)}static create(i,o,h,p){return new Xd(tn.VEC_2,i,o,h,p)}geometryType(i){return this._geometryTypes[i]}get numGeometries(){return this._geometryTypes.length}containsPolygonGeometry(){for(let i=0;i<this.numGeometries;i++)if(this.geometryType(i)===fi.POLYGON||this.geometryType(i)===fi.MULTIPOLYGON)return!0;return!1}containsSingleGeometryType(){return!1}}class pS{_triangleOffsets;_indexBuffer;_vertexBuffer;_topologyVector;constructor(i,o,h,p){this._triangleOffsets=i,this._indexBuffer=o,this._vertexBuffer=h,this._topologyVector=p}get triangleOffsets(){return this._triangleOffsets}get indexBuffer(){return this._indexBuffer}get vertexBuffer(){return this._vertexBuffer}get topologyVector(){return this._topologyVector}getGeometries(){if(!this._topologyVector)throw new Error("Cannot convert GpuVector to coordinates without topology information");const i=new Array(this.numGeometries),o=this._topologyVector,h=o.partOffsets,p=o.ringOffsets,g=o.geometryOffsets;let y=0,x=1,A=1,E=1;for(let M=0;M<this.numGeometries;M++)switch(this.geometryType(M)){case fi.POLYGON:{const P=h[x]-h[x-1];x++;const F=[];for(let O=0;O<P;O++){const N=p[A]-p[A-1];A++;const z=[];for(let H=0;H<N;H++){const q=this._vertexBuffer[y++],ct=this._vertexBuffer[y++];z.push(new T(q,ct))}z.length>0&&z.push(z[0]),F.push(z)}i[M]=F,g&&E++}break;case fi.MULTIPOLYGON:{const P=g[E]-g[E-1];E++;const F=[];for(let O=0;O<P;O++){const N=h[x]-h[x-1];x++;for(let z=0;z<N;z++){const H=p[A]-p[A-1];A++;const q=[];for(let ct=0;ct<H;ct++){const J=this._vertexBuffer[y++],rt=this._vertexBuffer[y++];q.push(new T(J,rt))}q.length>0&&q.push(q[0]),F.push(q)}}i[M]=F}}return i}[Symbol.iterator](){return null}}class U_ extends pS{_numGeometries;_geometryType;constructor(i,o,h,p,g,y){super(h,p,g,y),this._numGeometries=i,this._geometryType=o}static create(i,o,h,p,g,y){return new U_(i,o,h,p,g,y)}geometryType(i){return this._geometryType}get numGeometries(){return this._numGeometries}containsSingleGeometryType(){return!0}}class z_ extends pS{_geometryTypes;constructor(i,o,h,p,g){super(o,h,p,g),this._geometryTypes=i}static create(i,o,h,p,g){return new z_(i,o,h,p,g)}geometryType(i){return this._geometryTypes[i]}get numGeometries(){return this._geometryTypes.length}containsSingleGeometryType(){return!1}}function E9(l,i,o,h,p){const g=qi.decode(l,o);let y=null,x=null,A=null,E=null,M=null,P=null,F=null,O=null;if(Me.getVectorType(g,h,l,o)===di.CONST){const z=Me.decodeConstIntStream(l,o,g,!1);for(let H=0;H<i-1;H++){const q=qi.decode(l,o);switch(q.physicalStreamType){case Ui.LENGTH:switch(q.logicalStreamType.lengthType){case Cs.GEOMETRIES:y=Me.decodeLengthStreamToOffsetBuffer(l,o,q);break;case Cs.PARTS:x=Me.decodeLengthStreamToOffsetBuffer(l,o,q);break;case Cs.RINGS:A=Me.decodeLengthStreamToOffsetBuffer(l,o,q);break;case Cs.TRIANGLES:F=Me.decodeLengthStreamToOffsetBuffer(l,o,q)}break;case Ui.OFFSET:switch(q.logicalStreamType.offsetType){case Xl.VERTEX:E=Me.decodeIntStream(l,o,q,!1);break;case Xl.INDEX:O=Me.decodeIntStream(l,o,q,!1)}break;case Ui.DATA:if(Gn.VERTEX===q.logicalStreamType.dictionaryType)M=Me.decodeIntStream(l,o,q,!0,p);else{const ct=q;P={numBits:ct.numBits(),coordinateShift:ct.coordinateShift()},M=Me.decodeIntStream(l,o,q,!1,p)}}}if(O!==null){if(y!=null||x!=null){const H=new Uu(y,x,A);return U_.create(h,z,F,O,M,H)}return U_.create(h,z,F,O,M)}return P===null?Wd.create(h,z,new Uu(y,x,A),E,M):Wd.createMortonEncoded(h,z,new Uu(y,x,A),E,M,P)}const N=Me.decodeIntStream(l,o,g,!1);for(let z=0;z<i-1;z++){const H=qi.decode(l,o);switch(H.physicalStreamType){case Ui.LENGTH:switch(H.logicalStreamType.lengthType){case Cs.GEOMETRIES:y=Me.decodeIntStream(l,o,H,!1);break;case Cs.PARTS:x=Me.decodeIntStream(l,o,H,!1);break;case Cs.RINGS:A=Me.decodeIntStream(l,o,H,!1);break;case Cs.TRIANGLES:F=Me.decodeLengthStreamToOffsetBuffer(l,o,H)}break;case Ui.OFFSET:switch(H.logicalStreamType.offsetType){case Xl.VERTEX:E=Me.decodeIntStream(l,o,H,!1);break;case Xl.INDEX:O=Me.decodeIntStream(l,o,H,!1)}break;case Ui.DATA:if(Gn.VERTEX===H.logicalStreamType.dictionaryType)M=Me.decodeIntStream(l,o,H,!0,p);else{const q=H;P={numBits:q.numBits(),coordinateShift:q.coordinateShift()},M=Me.decodeIntStream(l,o,H,!1,p)}}}return O!==null&&x===null?z_.create(N,F,O,M):(y!==null?(y=tb(N,y,2),x!==null&&A!==null?(x=_S(N,y,x,!1),A=(function(z,H,q,ct){const J=new Int32Array(q[q.length-1]+1);let rt=0;J[0]=rt;let pt=1,vt=1,Pt=0;for(let jt=0;jt<z.length;jt++){const Vt=z[jt],$t=H[jt+1]-H[jt];if(Vt!==0&&Vt!==3)for(let se=0;se<$t;se++){const Yt=q[pt]-q[pt-1];pt++;for(let Kt=0;Kt<Yt;Kt++)rt=J[vt++]=rt+ct[Pt++]}else for(let se=0;se<$t;se++)J[vt++]=++rt,pt++}return J})(N,y,x,A)):x!==null&&(x=(function(z,H,q){const ct=new Int32Array(H[H.length-1]+1);let J=0;ct[0]=J;let rt=1,pt=0;for(let vt=0;vt<z.length;vt++){const Pt=z[vt],jt=H[vt+1]-H[vt];if(Pt===4||Pt===1)for(let Vt=0;Vt<jt;Vt++)J=ct[rt++]=J+q[pt++];else for(let Vt=0;Vt<jt;Vt++)ct[rt++]=++J}return ct})(N,y,x))):x!==null&&A!==null?(x=tb(N,x,1),A=_S(N,x,A,!0)):x!==null&&(x=tb(N,x,0)),O!==null?z_.create(N,F,O,M,new Uu(y,x,A)):P===null?Xd.create(N,new Uu(y,x,A),E,M):Xd.createMortonEncoded(N,new Uu(y,x,A),E,M,P))}function tb(l,i,o){const h=new Int32Array(l.length+1);let p=0;h[0]=p;let g=0;for(let y=0;y<l.length;y++)p=h[y+1]=p+(l[y]>o?i[g++]:1);return h}function _S(l,i,o,h){const p=new Int32Array(i[i.length-1]+1);let g=0;p[0]=g;let y=1,x=0;for(let A=0;A<l.length;A++){const E=l[A],M=i[A+1]-i[A];if(E===5||E===2||h&&(E===4||E===1))for(let P=0;P<M;P++)g=p[y++]=g+o[x++];else for(let P=0;P<M;P++)p[y++]=++g}return p}class S9 extends Nu{dataVector;constructor(i,o,h){super(i,o.getBuffer(),h),this.dataVector=o}getValueFromBuffer(i){return this.dataVector.get(i)}}class C9 extends D_{getValueFromBuffer(i){return this.dataBuffer[i]}}class gS extends Nu{constructor(i,o,h){super(i,BigInt64Array.of(o),h)}getValueFromBuffer(i){return this.dataBuffer[0]}}function I9(l,i,o){for(let h=0;h<l;h++){const p=qi.decode(i,o);o.add(p.byteLength)}}function qd(l,i,o){return mS(l,Math.ceil(i/8),o)}function mS(l,i,o){const h=new Uint8Array(i);let p=0;for(;p<i;){const g=l[o.increment()];if(g<=127){const y=g+3,x=l[o.increment()],A=p+y;h.fill(x,p,A),p=A}else{const y=256-g;for(let x=0;x<y;x++)h[p++]=l[o.increment()]}}return h}const M9=new TextDecoder;function eb(l,i,o){return o-i>=12?M9.decode(l.subarray(i,o)):(function(h,p,g){let y="",x=p;for(;x<g;){const A=h[x];let E,M,P,F=null,O=A>239?4:A>223?3:A>191?2:1;if(x+O>g)break;O===1?A<128&&(F=A):O===2?(E=h[x+1],(192&E)==128&&(F=(31&A)<<6|63&E,F<=127&&(F=null))):O===3?(E=h[x+1],M=h[x+2],(192&E)==128&&(192&M)==128&&(F=(15&A)<<12|(63&E)<<6|63&M,(F<=2047||F>=55296&&F<=57343)&&(F=null))):O===4&&(E=h[x+1],M=h[x+2],P=h[x+3],(192&E)==128&&(192&M)==128&&(192&P)==128&&(F=(15&A)<<18|(63&E)<<12|(63&M)<<6|63&P,(F<=65535||F>=1114112)&&(F=null))),F===null?(F=65533,O=1):F>65535&&(F-=65536,y+=String.fromCharCode(F>>>10&1023|55296),F=56320|1023&F),y+=String.fromCharCode(F),x+=O}return y})(l,i,o)}class rb extends Nu{offsetBuffer;constructor(i,o,h,p){super(i,h,p),this.offsetBuffer=o}}class yS extends rb{textEncoder;constructor(i,o,h,p){super(i,o,h,p??o.length-1),this.textEncoder=new TextEncoder}getValueFromBuffer(i){return eb(this.dataBuffer,this.offsetBuffer[i],this.offsetBuffer[i+1])}}class Vu extends rb{indexBuffer;textEncoder;constructor(i,o,h,p,g){super(i,h,p,g??o.length),this.indexBuffer=o,this.indexBuffer=o,this.textEncoder=new TextEncoder}getValueFromBuffer(i){const o=this.indexBuffer[i];return eb(this.dataBuffer,this.offsetBuffer[o],this.offsetBuffer[o+1])}}class bS extends rb{indexBuffer;symbolOffsetBuffer;symbolTableBuffer;textEncoder;symbolLengthBuffer;lengthBuffer;decodedDictionary;constructor(i,o,h,p,g,y,x){super(i,h,p,x),this.indexBuffer=o,this.symbolOffsetBuffer=g,this.symbolTableBuffer=y,this.textEncoder=new TextEncoder}getValueFromBuffer(i){this.decodedDictionary==null&&(this.symbolLengthBuffer==null&&(this.symbolLengthBuffer=this.offsetToLengthBuffer(this.symbolOffsetBuffer),this.lengthBuffer=this.offsetToLengthBuffer(this.offsetBuffer)),this.decodedDictionary=(function(h,p,g){const y=[],x=new Array(p.length).fill(0);for(let A=1;A<p.length;A++)x[A]=x[A-1]+p[A-1];for(let A=0;A<g.length;A++)if(g[A]===255)y.push(g[++A]);else{const E=p[g[A]],M=x[g[A]];for(let P=0;P<E;P++)y.push(h[M+P])}return new Uint8Array(y)})(this.symbolTableBuffer,this.symbolLengthBuffer,this.dataBuffer));const o=this.indexBuffer[i];return eb(this.decodedDictionary,this.offsetBuffer[o],this.offsetBuffer[o+1])}offsetToLengthBuffer(i){const o=new Uint32Array(i.length-1);let h=i[0];for(let p=1;p<i.length;p++){const g=i[p];o[p-1]=g-h,h=g}return o}}class Zd{static ROOT_COLUMN_NAME="default";static NESTED_COLUMN_SEPARATOR=":";constructor(){}static decode(i,o,h,p,g){let y=null,x=null,A=null,E=null,M=null,P=null,F=null,O=null;for(let N=0;N<p;N++){const z=qi.decode(o,h);if(z.byteLength!==0)switch(z.physicalStreamType){case Ui.PRESENT:{const H=qd(o,z.numValues,h);P=new $n(H,z.numValues);break}case Ui.OFFSET:x=g!=null||P!=null?Me.decodeNullableIntStream(o,h,z,!1,g??P):Me.decodeIntStream(o,h,z,!1);break;case Ui.LENGTH:{const H=Me.decodeLengthStreamToOffsetBuffer(o,h,z);Cs.DICTIONARY===z.logicalStreamType.lengthType?y=H:Cs.SYMBOL===z.logicalStreamType.lengthType?E=H:F=H;break}case Ui.DATA:{const H=o.subarray(h.get(),h.get()+z.byteLength);h.add(z.byteLength);const q=z.logicalStreamType.dictionaryType;Gn.FSST===q?M=H:Gn.SINGLE===q||Gn.SHARED===q?A=H:Gn.NONE===q&&(O=H);break}}}return this.decodeFsstDictionaryVector(i,M,x,y,A,E,g??P)??this.decodeDictionaryVector(i,A,x,y,g??P)??this.decodePlainStringVector(i,F,O,x,g??P)}static decodeFsstDictionaryVector(i,o,h,p,g,y,x){return o?new bS(i,h,p,g,y,o,x):null}static decodeDictionaryVector(i,o,h,p,g){return o?g?new Vu(i,h,p,o,g):new Vu(i,h,p,o):null}static decodePlainStringVector(i,o,h,p,g){if(!o||!h)return null;if(p)return g?new Vu(i,p,o,h,g):new Vu(i,p,o,h);if(g&&g.size()!==o.length-1){const y=new Int32Array(g.size());let x=0;for(let A=0;A<g.size();A++)y[A]=g.get(A)?x++:0;return new Vu(i,y,o,h,g)}return g?new yS(i,o,h,g):new yS(i,o,h)}static decodeSharedDictionary(i,o,h,p,g){let y=null,x=null,A=null,E=null,M=!1;for(;!M;){const N=qi.decode(i,o);switch(N.physicalStreamType){case Ui.LENGTH:Cs.DICTIONARY===N.logicalStreamType.lengthType?y=Me.decodeLengthStreamToOffsetBuffer(i,o,N):A=Me.decodeLengthStreamToOffsetBuffer(i,o,N);break;case Ui.DATA:Gn.SINGLE===N.logicalStreamType.dictionaryType||Gn.SHARED===N.logicalStreamType.dictionaryType?(x=i.subarray(o.get(),o.get()+N.byteLength),M=!0):E=i.subarray(o.get(),o.get()+N.byteLength),o.add(N.byteLength)}}const P=h.complexType.children,F=[];let O=0;for(const N of P){const z=ii(i,o,1)[0];if(z==0)continue;const H=`${h.name}${N.name===Zd.ROOT_COLUMN_NAME?"":Zd.NESTED_COLUMN_SEPARATOR+N.name}`;if(g&&!g.has(H)){I9(z,i,o);continue}if(z!==2||N.type!=="scalarField"||N.scalarField.physicalType!==9)throw new Error("Currently only optional string fields are implemented for a struct.");const q=qi.decode(i,o),ct=qd(i,q.numValues,o),J=qi.decode(i,o),rt=(J instanceof $d?J.numRleValues:J.numValues)!==p?Me.decodeNullableIntStream(i,o,J,!1,new $n(ct,q.numValues)):Me.decodeIntStream(i,o,J,!1);F[O++]=E?new bS(H,rt,y,x,A,E,new $n(ct,q.numValues)):new Vu(H,rt,y,x,new $n(ct,q.numValues))}return F}}function R9(l,i,o,h,p,g){return o.type==="scalarType"?(function(y,x,A,E,M,P){let F=null,O=0;if(y===0)return null;if(P.nullable){const z=qi.decode(x,A);O=z.numValues;const H=A.get(),q=qd(x,O,A);A.set(H+z.byteLength),F=new $n(q,z.numValues)}const N=F??E;switch(M.physicalType){case 4:case 3:return(function(z,H,q,ct,J){const rt=qi.decode(z,H),pt=Me.getVectorType(rt,J,z,H),vt=ct.physicalType===3;if(pt===di.FLAT){const Pt=Yd(J)?Me.decodeNullableIntStream(z,H,rt,vt,J):Me.decodeIntStream(z,H,rt,vt);return new $0(q.name,Pt,J)}if(pt===di.SEQUENCE){const Pt=Me.decodeSequenceIntStream(z,H,rt);return new X0(q.name,Pt[0],Pt[1],rt.numRleValues)}{const Pt=Me.decodeConstIntStream(z,H,rt,vt);return new q0(q.name,Pt,J)}})(x,A,P,M,N);case 9:return Zd.decode(P.name,x,A,P.nullable?y-1:y,F);case 0:return(function(z,H,q,ct,J){const rt=qi.decode(z,H),pt=rt.numValues,vt=H.get(),Pt=Yd(J)?(function(Vt,$t,se,Yt){const Kt=mS(Vt,Math.ceil($t/8),se),zt=new $n(Kt,$t),ye=Yt.size(),_e=new $n(new Uint8Array(ye),ye);let me=0;for(let ce=0;ce<Yt.size();ce++){const De=!!Yt.get(ce)&&zt.get(me++);_e.set(ce,De)}return _e.getBuffer()})(z,pt,H,J):qd(z,pt,H);H.set(vt+rt.byteLength);const jt=new $n(Pt,pt);return new S9(q.name,jt,J)})(x,A,P,0,N);case 6:case 5:return(function(z,H,q,ct,J){const rt=qi.decode(z,H),pt=Me.getVectorType(rt,ct,z,H),vt=J.physicalType===5;if(pt===di.FLAT){const Pt=Yd(ct)?Me.decodeNullableLongStream(z,H,rt,vt,ct):Me.decodeLongStream(z,H,rt,vt);return new uS(q.name,Pt,ct)}if(pt===di.SEQUENCE){const Pt=Me.decodeSequenceLongStream(z,H,rt);return new hS(q.name,Pt[0],Pt[1],rt.numRleValues)}{const Pt=Me.decodeConstLongStream(z,H,rt,vt);return new gS(q.name,Pt,ct)}})(x,A,P,N,M);case 7:return(function(z,H,q,ct){const J=qi.decode(z,H),rt=Yd(ct)?(function(pt,vt,Pt,jt){const Vt=vt.get(),$t=Vt+jt*Float32Array.BYTES_PER_ELEMENT,se=new Uint8Array(pt.subarray(Vt,$t)).buffer,Yt=new Float32Array(se);vt.set($t);const Kt=Pt.size(),zt=new Float32Array(Kt);let ye=0;for(let _e=0;_e<Kt;_e++)zt[_e]=Pt.get(_e)?Yt[ye++]:0;return zt})(z,H,ct,J.numValues):(function(pt,vt,Pt){const jt=vt.get(),Vt=jt+Pt*Float32Array.BYTES_PER_ELEMENT,$t=new Uint8Array(pt.subarray(jt,Vt)).buffer,se=new Float32Array($t);return vt.set(Vt),se})(z,H,J.numValues);return new C9(q.name,rt,ct)})(x,A,P,N);case 8:return(function(z,H,q,ct){const J=qi.decode(z,H),rt=Yd(ct)?(function(pt,vt,Pt,jt){const Vt=vt.get(),$t=Vt+jt*Float64Array.BYTES_PER_ELEMENT,se=new Uint8Array(pt.subarray(Vt,$t)).buffer,Yt=new Float64Array(se);vt.set($t);const Kt=Pt.size(),zt=new Float64Array(Kt);let ye=0;for(let _e=0;_e<Kt;_e++)zt[_e]=Pt.get(_e)?Yt[ye++]:0;return zt})(z,H,ct,J.numValues):(function(pt,vt,Pt){const jt=vt.get(),Vt=jt+Pt*Float64Array.BYTES_PER_ELEMENT,$t=new Uint8Array(pt.subarray(jt,Vt)).buffer,se=new Float64Array($t);return vt.set(Vt),se})(z,H,J.numValues);return new W0(q.name,rt,ct)})(x,A,P,N);default:throw new Error(`The specified data type for the field is currently not supported: ${M}`)}})(h,l,i,p,o.scalarType,o):h!=1?null:Zd.decodeSharedDictionary(l,i,o,p,g)}function Yd(l){return l instanceof $n}class V_{static decodeColumnType(i){switch(i){case 0:case 1:case 2:case 3:{const o={};o.nullable=!!(1&i),o.columnScope=0;const h={};return h.physicalType=i>1?6:4,h.type="physicalType",o.scalarType=h,o.type="scalarType",o}case 4:{const o={nullable:!1,columnScope:0},h={type:"physicalType",physicalType:0};return o.type="complexType",o.complexType=h,o}case 30:{const o={nullable:!1,columnScope:0},h={type:"physicalType",physicalType:1};return o.type="complexType",o.complexType=h,o}default:return this.mapScalarType(i)}}static columnTypeHasName(i){return i>=10}static columnTypeHasChildren(i){return i===30}static hasStreamCount(i){if(i.name==="id")return!1;if(i.type==="scalarType"){const o=i.scalarType;if(o.type==="physicalType")switch(o.physicalType){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:default:return!1;case 9:return!0}else if(o.type==="logicalType")return!1}else if(i.type==="complexType"){const o=i.complexType;if(o.type==="physicalType")switch(o.physicalType){case 0:case 1:return!0;default:return!1}}return console.warn("Unexpected column type in hasStreamCount",i),!1}static mapScalarType(i){let o=null;switch(i){case 10:case 11:o=0;break;case 12:case 13:o=1;break;case 14:case 15:o=2;break;case 16:case 17:o=3;break;case 18:case 19:o=4;break;case 20:case 21:o=5;break;case 22:case 23:o=6;break;case 24:case 25:o=7;break;case 26:case 27:o=8;break;case 28:case 29:o=9;break;default:return null}const h={};h.nullable=!!(1&i),h.columnScope=0;const p={type:"physicalType"};return p.physicalType=o,h.type="scalarType",h.scalarType=p,h}}const P9=new TextDecoder;function vS(l,i){const o=ii(l,i,1)[0];if(o===0)return"";const h=i.get(),p=l.subarray(h,h+o);return i.add(o),P9.decode(p)}function xS(l,i){const o=ii(l,i,1)[0]>>>0,h=!!(4&o),p=!!(2&o),g=ii(l,i,1)[0]>>>0,y={};if(1&o&&(y.nullable=!0),p){const x={};if(h?(x.type="logicalType",x.logicalType=g):(x.type="physicalType",x.physicalType=g),8&o){const A=ii(l,i,1)[0]>>>0;x.children=new Array(A);for(let E=0;E<A;E++)x.children[E]=xS(l,i)}y.type="complexField",y.complexField=x}else{const x={};h?(x.type="logicalType",x.logicalType=g):(x.type="physicalType",x.physicalType=g),y.type="scalarField",y.scalarField=x}return y}function B9(l,i){const o=ii(l,i,1)[0]>>>0,h=V_.decodeColumnType(o);if(!h)throw new Error(`Unsupported column type code: ${o}`);if(V_.columnTypeHasName(o)?h.name=vS(l,i):o>=0&&o<=3?h.name="id":o===4&&(h.name="geometry"),V_.columnTypeHasChildren(o)){const p=ii(l,i,1)[0]>>>0,g=h.complexType;g.children=new Array(p);for(let y=0;y<p;y++)g.children[y]=xS(l,i)}return h}function D9(l,i){const o={featureTables:[]},h={};h.name=vS(l,i);const p=ii(l,i,1)[0]>>>0,g=ii(l,i,1)[0]>>>0;h.columns=new Array(g);for(let y=0;y<g;y++)h.columns[y]=B9(l,i);return o.featureTables.push(h),[o,p]}function F9(l,i,o,h,p,g,y=!1){const x=i.scalarType.physicalType,A=Me.getVectorType(p,g,l,o);if(x===4)switch(A){case di.FLAT:{const E=Me.decodeIntStream(l,o,p,!1);return new $0(h,E,g)}case di.SEQUENCE:{const E=Me.decodeSequenceIntStream(l,o,p);return new X0(h,E[0],E[1],p.numRleValues)}case di.CONST:{const E=Me.decodeConstIntStream(l,o,p,!1);return new q0(h,E,g)}}else switch(A){case di.FLAT:{if(y){const M=Me.decodeLongFloat64Stream(l,o,p,!1);return new W0(h,M,g)}const E=Me.decodeLongStream(l,o,p,!1);return new uS(h,E,g)}case di.SEQUENCE:{const E=Me.decodeSequenceLongStream(l,o,p);return new hS(h,E[0],E[1],p.numRleValues)}case di.CONST:{const E=Me.decodeConstLongStream(l,o,p,!1);return new gS(h,E,g)}}throw new Error("Vector type not supported for id column.")}class O9{constructor(i,o){var h;switch(this._featureData=i,this.properties=this._featureData.properties||{},(h=this._featureData.geometry)===null||h===void 0?void 0:h.type){case fi.POINT:case fi.MULTIPOINT:this.type=1;break;case fi.LINESTRING:case fi.MULTILINESTRING:this.type=2;break;case fi.POLYGON:case fi.MULTIPOLYGON:this.type=3;break;default:this.type=0}this.extent=o,this.id=Number(this._featureData.id)}projectPoint(i,o,h,p){return[360*(i.x+o)/p-180,360/Math.PI*Math.atan(Math.exp((1-2*(i.y+h)/p)*Math.PI))-90]}projectLine(i,o,h,p){return i.map((g=>this.projectPoint(g,o,h,p)))}toGeoJSON(i,o,h){const p=this.extent*Math.pow(2,h),g=this.extent*i,y=this.extent*o,x=this.loadGeometry();let A;switch(this.type){case 1:{const M=[];for(const F of x)M.push(F[0]);const P=this.projectLine(M,g,y,p);A=M.length===1?{type:"Point",coordinates:P[0]}:{type:"MultiPoint",coordinates:P};break}case 2:{const M=x.map((P=>this.projectLine(P,g,y,p)));A=M.length===1?{type:"LineString",coordinates:M[0]}:{type:"MultiLineString",coordinates:M};break}case 3:{const M=xl(x),P=[];for(const F of M)P.push(F.map((O=>this.projectLine(O,g,y,p))));A=P.length===1?{type:"Polygon",coordinates:P[0]}:{type:"MultiPolygon",coordinates:P};break}default:throw new Error(`unknown feature type: ${this.type}`)}const E={type:"Feature",geometry:A,properties:this.properties};return this.id!=null&&(E.id=this.id),E}loadGeometry(){const i=[];for(const o of this._featureData.geometry.coordinates){const h=[];for(const p of o)h.push(new T(p.x,p.y));i.push(h)}return i}bbox(){return[0,0,0,0]}}class k9{constructor(i){this.features=[],this.featureTable=i,this.name=i.name,this.extent=i.extent,this.version=2,this.features=i.getFeatures(),this.length=this.features.length}feature(i){return new O9(this.features[i],this.extent)}}class wS{constructor(i){this.layers={};const o=(function(h,p,g=!0){const y=new v9(0),x=[];for(;y.get()<h.length;){const A=ii(h,y,1)[0]>>>0,E=y.get()+A;if(E>h.length)throw new Error(`Block overruns tile: ${E} > ${h.length}`);if(ii(h,y,1)[0]>>>0!=1){y.set(E);continue}const M=D9(h,y),P=M[1],F=M[0].featureTables[0];let O=null,N=null;const z=[];let H=0;for(const ct of F.columns){const J=ct.name;if(J==="id"){let rt=null;if(ct.nullable){const vt=qi.decode(h,y),Pt=y.get(),jt=qd(h,vt.numValues,y);y.set(Pt+vt.byteLength),rt=new $n(jt,vt.numValues)}const pt=qi.decode(h,y);H=pt.getDecompressedCount(),O=F9(h,ct,y,J,pt,rt??H,g)}else if(J==="geometry"){const rt=ii(h,y,1)[0];if(H===0){const pt=y.get();H=qi.decode(h,y).getDecompressedCount(),y.set(pt)}N=E9(h,rt,y,H,p)}else{const rt=V_.hasStreamCount(ct)?ii(h,y,1)[0]:1;if(rt===0&&ct.type==="scalarType")continue;const pt=R9(h,y,ct,rt,H,void 0);pt&&(Array.isArray(pt)?z.push(...pt):z.push(pt))}}const q=new b9(F.name,N,O,z,P);x.push(q),y.set(E)}return x})(new Uint8Array(i));this.layers=o.reduce(((h,p)=>Object.assign(Object.assign({},h),{[p.name]:new k9(p)})),{})}}class TS{constructor(i,o){this.tileID=i,this.x=i.canonical.x,this.y=i.canonical.y,this.z=i.canonical.z,this.grid=new Dl(Le,16,0),this.grid3D=new Dl(Le,16,0),this.featureIndexArray=new Q,this.promoteId=o}insert(i,o,h,p,g,y){const x=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(h,p,g);const A=y?this.grid3D:this.grid;for(let E=0;E<o.length;E++){const M=o[E],P=[1/0,1/0,-1/0,-1/0];for(let F=0;F<M.length;F++){const O=M[F];P[0]=Math.min(P[0],O.x),P[1]=Math.min(P[1],O.y),P[2]=Math.max(P[2],O.x),P[3]=Math.max(P[3],O.y)}P[0]<Le&&P[1]<Le&&P[2]>=0&&P[3]>=0&&A.insert(x,P[0],P[1],P[2],P[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=this.encoding!=="mlt"?new bE(new F0(this.rawTileData)).layers:new wS(this.rawTileData).layers,this.sourceLayerCoder=new eS(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(i,o,h,p){this.loadVTLayers();const g=i.params,y=Le/i.tileSize/i.scale,x=Sl(g.filter,g.globalState),A=i.queryGeometry,E=i.queryPadding*y,M=Wl.fromPoints(A),P=this.grid.query(M.minX-E,M.minY-E,M.maxX+E,M.maxY+E),F=Wl.fromPoints(i.cameraQueryGeometry).expandBy(E),O=this.grid3D.query(F.minX,F.minY,F.maxX,F.maxY,((H,q,ct,J)=>(function(rt,pt,vt,Pt,jt){for(const $t of rt)if(pt<=$t.x&&vt<=$t.y&&Pt>=$t.x&&jt>=$t.y)return!0;const Vt=[new T(pt,vt),new T(pt,jt),new T(Pt,jt),new T(Pt,vt)];if(rt.length>2){for(const $t of Vt)if(Cu(rt,$t))return!0}for(let $t=0;$t<rt.length-1;$t++)if(q8(rt[$t],rt[$t+1],Vt))return!0;return!1})(i.cameraQueryGeometry,H-E,q-E,ct+E,J+E)));for(const H of O)P.push(H);P.sort(N9);const N={};let z;for(let H=0;H<P.length;H++){const q=P[H];if(q===z)continue;z=q;const ct=this.featureIndexArray.get(q);let J=null;this.loadMatchingFeature(N,ct.bucketIndex,ct.sourceLayerIndex,ct.featureIndex,x,g.layers,g.availableImages,o,h,p,((rt,pt,vt)=>(J||(J=bo(rt)),pt.queryIntersectsFeature({queryGeometry:A,feature:rt,featureState:vt,geometry:J,zoom:this.z,transform:i.transform,pixelsToTileUnits:y,pixelPosMatrix:i.pixelPosMatrix,unwrappedTileID:this.tileID.toUnwrapped(),getElevation:i.getElevation}))))}return N}loadMatchingFeature(i,o,h,p,g,y,x,A,E,M,P){const F=this.bucketLayerIDs[o];if(y&&!F.some((H=>y.has(H))))return;const O=this.sourceLayerCoder.decode(h),N=this.vtLayers[O].feature(p);if(g.needGeometry){const H=vo(N,!0);if(!g.filter(new or(this.tileID.overscaledZ),H,this.tileID.canonical))return}else if(!g.filter(new or(this.tileID.overscaledZ),N))return;const z=this.getId(N,O);for(let H=0;H<F.length;H++){const q=F[H];if(y&&!y.has(q))continue;const ct=A[q];if(!ct)continue;let J={};z&&M&&(J=M.getState(ct.sourceLayer||"_geojsonTileLayer",z));const rt=Rr({},E[q]);rt.paint=AS(rt.paint,ct.paint,N,J,x),rt.layout=AS(rt.layout,ct.layout,N,J,x);const pt=!P||P(N,ct,J);if(!pt)continue;const vt=new rS(N,this.z,this.x,this.y,z);vt.layer=rt;let Pt=i[q];Pt===void 0&&(Pt=i[q]=[]),Pt.push({featureIndex:p,feature:vt,intersectionZ:pt})}}lookupSymbolFeatures(i,o,h,p,g,y,x,A){const E={};this.loadVTLayers();const M=Sl(g.filterSpec,g.globalState);for(const P of i)this.loadMatchingFeature(E,h,p,P,M,y,x,A,o);return E}hasLayer(i){for(const o of this.bucketLayerIDs)for(const h of o)if(i===h)return!0;return!1}getId(i,o){var h;let p=i.id;return this.promoteId&&(p=i.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[o]],typeof p=="boolean"&&(p=Number(p)),p===void 0&&(!((h=i.properties)===null||h===void 0)&&h.cluster)&&this.promoteId&&(p=Number(i.properties.cluster_id))),p}}function AS(l,i,o,h,p){return Or(l,((g,y)=>{const x=i instanceof kl?i.get(y):null;return x&&x.evaluate?x.evaluate(o,h,p):x}))}function N9(l,i){return i-l}function ES(l,i,o,h,p){const g=[];for(let y=0;y<l.length;y++){const x=l[y];let A;for(let E=0;E<x.length-1;E++){let M=x[E],P=x[E+1];M.x<i&&P.x<i||(M.x<i?M=new T(i,M.y+(i-M.x)/(P.x-M.x)*(P.y-M.y))._round():P.x<i&&(P=new T(i,M.y+(i-M.x)/(P.x-M.x)*(P.y-M.y))._round()),M.y<o&&P.y<o||(M.y<o?M=new T(M.x+(o-M.y)/(P.y-M.y)*(P.x-M.x),o)._round():P.y<o&&(P=new T(M.x+(o-M.y)/(P.y-M.y)*(P.x-M.x),o)._round()),M.x>=h&&P.x>=h||(M.x>=h?M=new T(h,M.y+(h-M.x)/(P.x-M.x)*(P.y-M.y))._round():P.x>=h&&(P=new T(h,M.y+(h-M.x)/(P.x-M.x)*(P.y-M.y))._round()),M.y>=p&&P.y>=p||(M.y>=p?M=new T(M.x+(p-M.y)/(P.y-M.y)*(P.x-M.x),p)._round():P.y>=p&&(P=new T(M.x+(p-M.y)/(P.y-M.y)*(P.x-M.x),p)._round()),A&&M.equals(A[A.length-1])||(A=[M],g.push(A)),A.push(P)))))}}return g}function SS(l,i,o,h,p){switch(i){case 1:return(function(g,y,x,A){const E=[];for(const M of g)for(const P of M){const F=A===0?P.x:P.y;F>=y&&F<=x&&E.push([P])}return E})(l,o,h,p);case 2:return CS(l,o,h,p,!1);case 3:return CS(l,o,h,p,!0)}return[]}function L9(l,i,o,h,p){const g=h===0?U9:z9;let y=[];const x=[];for(let M=0;M<l.length-1;M++){const P=l[M],F=l[M+1],O=h===0?P.x:P.y,N=h===0?F.x:F.y;let z=!1;O<i?N>i&&y.push(g(P,F,i)):O>o?N<o&&y.push(g(P,F,o)):y.push(P),N<i&&O>=i&&(y.push(g(P,F,i)),z=!0),N>o&&O<=o&&(y.push(g(P,F,o)),z=!0),!p&&z&&(x.push(y),y=[])}const A=l.length-1,E=h===0?l[A].x:l[A].y;return E>=i&&E<=o&&y.push(l[A]),p&&y.length>0&&!y[0].equals(y[y.length-1])&&y.push(new T(y[0].x,y[0].y)),y.length>0&&x.push(y),x}function CS(l,i,o,h,p){const g=[];for(const y of l){const x=L9(y,i,o,h,p);x.length>0&&g.push(...x)}return g}function U9(l,i,o){return new T(o,l.y+(o-l.x)/(i.x-l.x)*(i.y-l.y))}function z9(l,i,o){return new T(l.x+(o-l.y)/(i.y-l.y)*(i.x-l.x),o)}oe("FeatureIndex",TS,{omit:["rawTileData","sourceLayerCoder"]});class Ha extends T{constructor(i,o,h,p){super(i,o),this.angle=h,p!==void 0&&(this.segment=p)}clone(){return new Ha(this.x,this.y,this.angle,this.segment)}}function IS(l,i,o,h,p){if(i.segment===void 0||o===0)return!0;let g=i,y=i.segment+1,x=0;for(;x>-o/2;){if(y--,y<0)return!1;x-=l[y].dist(g),g=l[y]}x+=l[y].dist(l[y+1]),y++;const A=[];let E=0;for(;x<o/2;){const M=l[y],P=l[y+1];if(!P)return!1;let F=l[y-1].angleTo(M)-M.angleTo(P);for(F=Math.abs((F+3*Math.PI)%(2*Math.PI)-Math.PI),A.push({distance:x,angleDelta:F}),E+=F;x-A[0].distance>h;)E-=A.shift().angleDelta;if(E>p)return!1;y++,x+=M.dist(P)}return!0}function MS(l){let i=0;for(let o=0;o<l.length-1;o++)i+=l[o].dist(l[o+1]);return i}function RS(l,i,o){return l?.6*i*o:0}function PS(l,i){return Math.max(l?l.right-l.left:0,i?i.right-i.left:0)}function V9(l,i,o,h,p,g){const y=RS(o,p,g),x=PS(o,h)*g;let A=0;const E=MS(l)/2;for(let M=0;M<l.length-1;M++){const P=l[M],F=l[M+1],O=P.dist(F);if(A+O>E){const N=(E-A)/O,z=qs.number(P.x,F.x,N),H=qs.number(P.y,F.y,N),q=new Ha(z,H,F.angleTo(P),M);return q._round(),!y||IS(l,q,x,y,i)?q:void 0}A+=O}}function j9(l,i,o,h,p,g,y,x,A){const E=RS(h,g,y),M=PS(h,p),P=M*y,F=l[0].x===0||l[0].x===A||l[0].y===0||l[0].y===A;return i-P<i/4&&(i=P+i/4),BS(l,F?i/2*x%i:(M/2+2*g)*y*x%i,i,E,o,P,F,!1,A)}function BS(l,i,o,h,p,g,y,x,A){const E=g/2,M=MS(l);let P=0,F=i-o,O=[];for(let N=0;N<l.length-1;N++){const z=l[N],H=l[N+1],q=z.dist(H),ct=H.angleTo(z);for(;F+o<P+q;){F+=o;const J=(F-P)/q,rt=qs.number(z.x,H.x,J),pt=qs.number(z.y,H.y,J);if(rt>=0&&rt<A&&pt>=0&&pt<A&&F-E>=0&&F+E<=M){const vt=new Ha(rt,pt,ct,N);vt._round(),h&&!IS(l,vt,g,h,p)||O.push(vt)}}P+=q}return x||O.length||y||(O=BS(l,P/2,o,h,p,g,y,!0,A)),O}function DS(l,i,o,h){const p=[],g=l.image,y=g.pixelRatio,x=g.paddedRect.w-2,A=g.paddedRect.h-2;let E={x1:l.left,y1:l.top,x2:l.right,y2:l.bottom};const M=g.stretchX||[[0,x]],P=g.stretchY||[[0,A]],F=(zt,ye)=>zt+ye[1]-ye[0],O=M.reduce(F,0),N=P.reduce(F,0),z=x-O,H=A-N;let q=0,ct=O,J=0,rt=N,pt=0,vt=z,Pt=0,jt=H;if(g.content&&h){const zt=g.content,ye=zt[2]-zt[0],_e=zt[3]-zt[1];(g.textFitWidth||g.textFitHeight)&&(E=UE(l)),q=j_(M,0,zt[0]),J=j_(P,0,zt[1]),ct=j_(M,zt[0],zt[2]),rt=j_(P,zt[1],zt[3]),pt=zt[0]-q,Pt=zt[1]-J,vt=ye-ct,jt=_e-rt}const Vt=E.x1,$t=E.y1,se=E.x2-Vt,Yt=E.y2-$t,Kt=(zt,ye,_e,me)=>{const ce=H_(zt.stretch-q,ct,se,Vt),De=G_(zt.fixed-pt,vt,zt.stretch,O),Lr=H_(ye.stretch-J,rt,Yt,$t),si=G_(ye.fixed-Pt,jt,ye.stretch,N),Vi=H_(_e.stretch-q,ct,se,Vt),en=G_(_e.fixed-pt,vt,_e.stretch,O),ds=H_(me.stretch-J,rt,Yt,$t),Ci=G_(me.fixed-Pt,jt,me.stretch,N),Dr=new T(ce,Lr),pi=new T(Vi,Lr),Ii=new T(Vi,ds),Mi=new T(ce,ds),ss=new T(De/y,si/y),rn=new T(en/y,Ci/y),_i=i*Math.PI/180;if(_i){const gi=Math.sin(_i),mi=Math.cos(_i),ti=[mi,-gi,gi,mi];Dr._matMult(ti),pi._matMult(ti),Mi._matMult(ti),Ii._matMult(ti)}const fs=zt.stretch+zt.fixed,ni=ye.stretch+ye.fixed;return{tl:Dr,tr:pi,bl:Mi,br:Ii,tex:{x:g.paddedRect.x+1+fs,y:g.paddedRect.y+1+ni,w:_e.stretch+_e.fixed-fs,h:me.stretch+me.fixed-ni},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:ss,pixelOffsetBR:rn,minFontScaleX:vt/y/se,minFontScaleY:jt/y/Yt,isSDF:o}};if(h&&(g.stretchX||g.stretchY)){const zt=FS(M,z,O),ye=FS(P,H,N);for(let _e=0;_e<zt.length-1;_e++){const me=zt[_e],ce=zt[_e+1];for(let De=0;De<ye.length-1;De++)p.push(Kt(me,ye[De],ce,ye[De+1]))}}else p.push(Kt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:x+1},{fixed:0,stretch:A+1}));return p}function j_(l,i,o){let h=0;for(const p of l)h+=Math.max(i,Math.min(o,p[1]))-Math.max(i,Math.min(o,p[0]));return h}function FS(l,i,o){const h=[{fixed:-1,stretch:0}];for(const[p,g]of l){const y=h[h.length-1];h.push({fixed:p-y.stretch,stretch:y.stretch}),h.push({fixed:p-y.stretch,stretch:y.stretch+(g-p)})}return h.push({fixed:i+1,stretch:o}),h}function H_(l,i,o,h){return l/i*o+h}function G_(l,i,o,h){return l-i*o/h}oe("Anchor",Ha);class $_{constructor(i,o,h,p,g,y,x,A,E,M){var P;if(this.boxStartIndex=i.length,E){let F=y.top,O=y.bottom;const N=y.collisionPadding;N&&(F-=N[1],O+=N[3]);let z=O-F;z>0&&(z=Math.max(10,z),this.circleDiameter=z)}else{const F=!((P=y.image)===null||P===void 0)&&P.content&&(y.image.textFitWidth||y.image.textFitHeight)?UE(y):{x1:y.left,y1:y.top,x2:y.right,y2:y.bottom};F.y1=F.y1*x-A[0],F.y2=F.y2*x+A[2],F.x1=F.x1*x-A[3],F.x2=F.x2*x+A[1];const O=y.collisionPadding;if(O&&(F.x1-=O[0]*x,F.y1-=O[1]*x,F.x2+=O[2]*x,F.y2+=O[3]*x),M){const N=new T(F.x1,F.y1),z=new T(F.x2,F.y1),H=new T(F.x1,F.y2),q=new T(F.x2,F.y2),ct=M*Math.PI/180;N._rotate(ct),z._rotate(ct),H._rotate(ct),q._rotate(ct),F.x1=Math.min(N.x,z.x,H.x,q.x),F.x2=Math.max(N.x,z.x,H.x,q.x),F.y1=Math.min(N.y,z.y,H.y,q.y),F.y2=Math.max(N.y,z.y,H.y,q.y)}i.emplaceBack(o.x,o.y,F.x1,F.y1,F.x2,F.y2,h,p,g)}this.boxEndIndex=i.length}}class H9{constructor(i=[],o=(h,p)=>h<p?-1:h>p?1:0){if(this.data=i,this.length=this.data.length,this.compare=o,this.length>0)for(let h=(this.length>>1)-1;h>=0;h--)this._down(h)}push(i){this.data.push(i),this._up(this.length++)}pop(){if(this.length===0)return;const i=this.data[0],o=this.data.pop();return--this.length>0&&(this.data[0]=o,this._down(0)),i}peek(){return this.data[0]}_up(i){const{data:o,compare:h}=this,p=o[i];for(;i>0;){const g=i-1>>1,y=o[g];if(h(p,y)>=0)break;o[i]=y,i=g}o[i]=p}_down(i){const{data:o,compare:h}=this,p=this.length>>1,g=o[i];for(;i<p;){let y=1+(i<<1);const x=y+1;if(x<this.length&&h(o[x],o[y])<0&&(y=x),h(o[y],g)>=0)break;o[i]=o[y],i=y}o[i]=g}}function G9(l,i=1,o=!1){const h=Wl.fromPoints(l[0]),p=Math.min(h.width(),h.height());let g=p/2;const y=new H9([],$9),{minX:x,minY:A,maxX:E,maxY:M}=h;if(p===0)return new T(x,A);for(let O=x;O<E;O+=p)for(let N=A;N<M;N+=p)y.push(new ju(O+g,N+g,g,l));let P=(function(O){let N=0,z=0,H=0;const q=O[0];for(let ct=0,J=q.length,rt=J-1;ct<J;rt=ct++){const pt=q[ct],vt=q[rt],Pt=pt.x*vt.y-vt.x*pt.y;z+=(pt.x+vt.x)*Pt,H+=(pt.y+vt.y)*Pt,N+=3*Pt}return new ju(z/N,H/N,0,O)})(l),F=y.length;for(;y.length;){const O=y.pop();(O.d>P.d||!P.d)&&(P=O,o&&console.log("found best %d after %d probes",Math.round(1e4*O.d)/1e4,F)),O.max-P.d<=i||(g=O.h/2,y.push(new ju(O.p.x-g,O.p.y-g,g,l)),y.push(new ju(O.p.x+g,O.p.y-g,g,l)),y.push(new ju(O.p.x-g,O.p.y+g,g,l)),y.push(new ju(O.p.x+g,O.p.y+g,g,l)),F+=4)}return o&&(console.log(`num probes: ${F}`),console.log(`best distance: ${P.d}`)),P.p}function $9(l,i){return i.max-l.max}function ju(l,i,o,h){this.p=new T(l,i),this.h=o,this.d=(function(p,g){let y=!1,x=1/0;for(let A=0;A<g.length;A++){const E=g[A];for(let M=0,P=E.length,F=P-1;M<P;F=M++){const O=E[M],N=E[F];O.y>p.y!=N.y>p.y&&p.x<(N.x-O.x)*(p.y-O.y)/(N.y-O.y)+O.x&&(y=!y),x=Math.min(x,YA(p,O,N))}}return(y?1:-1)*Math.sqrt(x)})(this.p,h),this.max=this.d+this.h*Math.SQRT2}var zi;f.aJ=void 0,(zi=f.aJ||(f.aJ={}))[zi.center=1]="center",zi[zi.left=2]="left",zi[zi.right=3]="right",zi[zi.top=4]="top",zi[zi.bottom=5]="bottom",zi[zi["top-left"]=6]="top-left",zi[zi["top-right"]=7]="top-right",zi[zi["bottom-left"]=8]="bottom-left",zi[zi["bottom-right"]=9]="bottom-right";const ib=Number.POSITIVE_INFINITY;function OS(l,i){return i[1]!==ib?(function(o,h,p){let g=0,y=0;switch(h=Math.abs(h),p=Math.abs(p),o){case"top-right":case"top-left":case"top":y=p-7;break;case"bottom-right":case"bottom-left":case"bottom":y=7-p}switch(o){case"top-right":case"bottom-right":case"right":g=-h;break;case"top-left":case"bottom-left":case"left":g=h}return[g,y]})(l,i[0],i[1]):(function(o,h){let p=0,g=0;h<0&&(h=0);const y=h/Math.SQRT2;switch(o){case"top-right":case"top-left":g=y-7;break;case"bottom-right":case"bottom-left":g=7-y;break;case"bottom":g=7-h;break;case"top":g=h-7}switch(o){case"top-right":case"bottom-right":p=-y;break;case"top-left":case"bottom-left":p=y;break;case"left":p=h;break;case"right":p=-h}return[p,g]})(l,i[0])}function kS(l,i,o){var h;const p=l.layout,g=(h=p.get("text-variable-anchor-offset"))===null||h===void 0?void 0:h.evaluate(i,{},o);if(g){const x=g.values,A=[];for(let E=0;E<x.length;E+=2){const M=A[E]=x[E],P=x[E+1].map((F=>F*hi));M.startsWith("top")?P[1]-=7:M.startsWith("bottom")&&(P[1]+=7),A[E+1]=P}return new $i(A)}const y=p.get("text-variable-anchor");if(y){let x;x=l._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[p.get("text-radial-offset").evaluate(i,{},o)*hi,ib]:p.get("text-offset").evaluate(i,{},o).map((E=>E*hi));const A=[];for(const E of y)A.push(E,OS(E,x));return new $i(A)}return null}function sb(l){switch(l){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function W9(l,i,o,h,p,g,y,x,A,E,M,P){let F=g.textMaxSize.evaluate(i,{});F===void 0&&(F=y);const O=l.layers[0].layout,N=O.get("icon-offset").evaluate(i,{},M),z=LS(o.horizontal),H=y/24,q=l.tilePixelRatio*H,ct=l.tilePixelRatio*F/24,J=l.tilePixelRatio*x,rt=l.tilePixelRatio*O.get("symbol-spacing"),pt=O.get("text-padding")*l.tilePixelRatio,vt=(function(_e,me,ce,De=1){const Lr=_e.get("icon-padding").evaluate(me,{},ce),si=Lr&&Lr.values;return[si[0]*De,si[1]*De,si[2]*De,si[3]*De]})(O,i,M,l.tilePixelRatio),Pt=O.get("text-max-angle")/180*Math.PI,jt=O.get("text-rotation-alignment")!=="viewport"&&O.get("symbol-placement")!=="point",Vt=O.get("icon-rotation-alignment")==="map"&&O.get("symbol-placement")!=="point",$t=O.get("symbol-placement"),se=rt/2,Yt=O.get("icon-text-fit");let Kt;h&&Yt!=="none"&&(l.allowVerticalPlacement&&o.vertical&&(Kt=zE(h,o.vertical,Yt,O.get("icon-text-fit-padding"),N,H)),z&&(h=zE(h,z,Yt,O.get("icon-text-fit-padding"),N,H)));const zt=M?P.line.getGranularityForZoomLevel(M.z):1,ye=(_e,me)=>{me.x<0||me.x>=Le||me.y<0||me.y>=Le||(function(ce,De,Lr,si,Vi,en,ds,Ci,Dr,pi,Ii,Mi,ss,rn,_i,fs,ni,gi,mi,ti,Tr,Wn,Hu,Xn,Z9){const Gu=ce.addToLineVertexArray(De,Lr);let Yl,$u,Wu,Xu,jS=0,HS=0,GS=0,$S=0,db=-1,fb=-1;const qo={};let WS=Li("");if(ce.allowVerticalPlacement&&si.vertical){const Zi=Ci.layout.get("text-rotate").evaluate(Tr,{},Xn)+90;Wu=new $_(Dr,De,pi,Ii,Mi,si.vertical,ss,rn,_i,Zi),ds&&(Xu=new $_(Dr,De,pi,Ii,Mi,ds,ni,gi,_i,Zi))}if(Vi){const Zi=Ci.layout.get("icon-rotate").evaluate(Tr,{}),sn=Ci.layout.get("icon-text-fit")!=="none",Kl=DS(Vi,Zi,Hu,sn),Zn=ds?DS(ds,Zi,Hu,sn):void 0;$u=new $_(Dr,De,pi,Ii,Mi,Vi,ni,gi,!1,Zi),jS=4*Kl.length;const Jl=ce.iconSizeData;let xo=null;Jl.kind==="source"?(xo=[Wo*Ci.layout.get("icon-size").evaluate(Tr,{})],xo[0]>za&&Je(`${ce.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):Jl.kind==="composite"&&(xo=[Wo*Wn.compositeIconSizes[0].evaluate(Tr,{},Xn),Wo*Wn.compositeIconSizes[1].evaluate(Tr,{},Xn)],(xo[0]>za||xo[1]>za)&&Je(`${ce.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),ce.addSymbols(ce.icon,Kl,xo,ti,mi,Tr,f.at.none,De,Gu.lineStartIndex,Gu.lineLength,-1,Xn),db=ce.icon.placedSymbolArray.length-1,Zn&&(HS=4*Zn.length,ce.addSymbols(ce.icon,Zn,xo,ti,mi,Tr,f.at.vertical,De,Gu.lineStartIndex,Gu.lineLength,-1,Xn),fb=ce.icon.placedSymbolArray.length-1)}const XS=Object.keys(si.horizontal);for(const Zi of XS){const sn=si.horizontal[Zi];if(!Yl){WS=Li(sn.text);const Zn=Ci.layout.get("text-rotate").evaluate(Tr,{},Xn);Yl=new $_(Dr,De,pi,Ii,Mi,sn,ss,rn,_i,Zn)}const Kl=sn.positionedLines.length===1;if(GS+=NS(ce,De,sn,en,Ci,_i,Tr,fs,Gu,si.vertical?f.at.horizontal:f.at.horizontalOnly,Kl?XS:[Zi],qo,db,Wn,Xn),Kl)break}si.vertical&&($S+=NS(ce,De,si.vertical,en,Ci,_i,Tr,fs,Gu,f.at.vertical,["vertical"],qo,fb,Wn,Xn));const Y9=Yl?Yl.boxStartIndex:ce.collisionBoxArray.length,K9=Yl?Yl.boxEndIndex:ce.collisionBoxArray.length,J9=Wu?Wu.boxStartIndex:ce.collisionBoxArray.length,Q9=Wu?Wu.boxEndIndex:ce.collisionBoxArray.length,tj=$u?$u.boxStartIndex:ce.collisionBoxArray.length,ej=$u?$u.boxEndIndex:ce.collisionBoxArray.length,rj=Xu?Xu.boxStartIndex:ce.collisionBoxArray.length,ij=Xu?Xu.boxEndIndex:ce.collisionBoxArray.length;let qn=-1;const X_=(Zi,sn)=>Zi&&Zi.circleDiameter?Math.max(Zi.circleDiameter,sn):sn;qn=X_(Yl,qn),qn=X_(Wu,qn),qn=X_($u,qn),qn=X_(Xu,qn);const qS=qn>-1?1:0;qS&&(qn*=Z9/hi),ce.glyphOffsetArray.length>=Ou.MAX_GLYPHS&&Je("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Tr.sortKey!==void 0&&ce.addToSortKeyRanges(ce.symbolInstances.length,Tr.sortKey);const sj=kS(Ci,Tr,Xn),[nj,oj]=(function(Zi,sn){const Kl=Zi.length,Zn=sn?.values;if(Zn?.length>0)for(let Jl=0;Jl<Zn.length;Jl+=2){const xo=Zn[Jl+1];Zi.emplaceBack(f.aJ[Zn[Jl]],xo[0],xo[1])}return[Kl,Zi.length]})(ce.textAnchorOffsets,sj);ce.symbolInstances.emplaceBack(De.x,De.y,qo.right>=0?qo.right:-1,qo.center>=0?qo.center:-1,qo.left>=0?qo.left:-1,qo.vertical||-1,db,fb,WS,Y9,K9,J9,Q9,tj,ej,rj,ij,pi,GS,$S,jS,HS,qS,0,ss,qn,nj,oj)})(l,me,_e,o,h,p,Kt,l.layers[0],l.collisionBoxArray,i.index,i.sourceLayerIndex,l.index,q,[pt,pt,pt,pt],jt,A,J,vt,Vt,N,i,g,E,M,y)};if($t==="line")for(const _e of ES(i.geometry,0,0,Le,Le)){const me=$l(_e,zt),ce=j9(me,rt,Pt,o.vertical||z,h,24,ct,l.overscaling,Le);for(const De of ce)z&&X9(l,z.text,se,De)||ye(me,De)}else if($t==="line-center"){for(const _e of i.geometry)if(_e.length>1){const me=$l(_e,zt),ce=V9(me,Pt,o.vertical||z,h,24,ct);ce&&ye(me,ce)}}else if(i.type==="Polygon")for(const _e of xl(i.geometry,0)){const me=G9(_e,16);ye($l(_e[0],zt,!0),new Ha(me.x,me.y,0))}else if(i.type==="LineString")for(const _e of i.geometry){const me=$l(_e,zt);ye(me,new Ha(me[0].x,me[0].y,0))}else if(i.type==="Point")for(const _e of i.geometry)for(const me of _e)ye([me],new Ha(me.x,me.y,0))}function NS(l,i,o,h,p,g,y,x,A,E,M,P,F,O,N){const z=(function(ct,J,rt,pt,vt,Pt,jt,Vt){const $t=pt.layout.get("text-rotate").evaluate(Pt,{})*Math.PI/180,se=[];for(const Yt of J.positionedLines)for(const Kt of Yt.positionedGlyphs){if(!Kt.rect)continue;const zt=Kt.rect||{};let ye=4,_e=!0,me=1,ce=0;const De=(vt||Vt)&&Kt.vertical,Lr=Kt.metrics.advance*Kt.scale/2;if(Vt&&J.verticalizable&&(ce=Yt.lineOffset/2-(Kt.imageName?-(hi-Kt.metrics.width*Kt.scale)/2:(Kt.scale-1)*hi)),Kt.imageName){const gi=jt[Kt.imageName];_e=gi.sdf,me=gi.pixelRatio,ye=1/me}const si=vt?[Kt.x+Lr,Kt.y]:[0,0];let Vi=vt?[0,0]:[Kt.x+Lr+rt[0],Kt.y+rt[1]-ce],en=[0,0];De&&(en=Vi,Vi=[0,0]);const ds=Kt.metrics.isDoubleResolution?2:1,Ci=(Kt.metrics.left-ye)*Kt.scale-Lr+Vi[0],Dr=(-Kt.metrics.top-ye)*Kt.scale+Vi[1],pi=Ci+zt.w/ds*Kt.scale/me,Ii=Dr+zt.h/ds*Kt.scale/me,Mi=new T(Ci,Dr),ss=new T(pi,Dr),rn=new T(Ci,Ii),_i=new T(pi,Ii);if(De){const gi=new T(-Lr,Lr- -17),mi=-Math.PI/2,ti=12-Lr,Tr=new T(22-ti,-(Kt.imageName?ti:0)),Wn=new T(...en);Mi._rotateAround(mi,gi)._add(Tr)._add(Wn),ss._rotateAround(mi,gi)._add(Tr)._add(Wn),rn._rotateAround(mi,gi)._add(Tr)._add(Wn),_i._rotateAround(mi,gi)._add(Tr)._add(Wn)}if($t){const gi=Math.sin($t),mi=Math.cos($t),ti=[mi,-gi,gi,mi];Mi._matMult(ti),ss._matMult(ti),rn._matMult(ti),_i._matMult(ti)}const fs=new T(0,0),ni=new T(0,0);se.push({tl:Mi,tr:ss,bl:rn,br:_i,tex:zt,writingMode:J.writingMode,glyphOffset:si,sectionIndex:Kt.sectionIndex,isSDF:_e,pixelOffsetTL:fs,pixelOffsetBR:ni,minFontScaleX:0,minFontScaleY:0})}return se})(0,o,x,p,g,y,h,l.allowVerticalPlacement),H=l.textSizeData;let q=null;H.kind==="source"?(q=[Wo*p.layout.get("text-size").evaluate(y,{})],q[0]>za&&Je(`${l.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):H.kind==="composite"&&(q=[Wo*O.compositeTextSizes[0].evaluate(y,{},N),Wo*O.compositeTextSizes[1].evaluate(y,{},N)],(q[0]>za||q[1]>za)&&Je(`${l.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),l.addSymbols(l.text,z,q,x,g,y,E,i,A.lineStartIndex,A.lineLength,F,N);for(const ct of M)P[ct]=l.text.placedSymbolArray.length-1;return 4*z.length}function LS(l){for(const i in l)return l[i];return null}function X9(l,i,o,h){const p=l.compareText;if(i in p){const g=p[i];for(let y=g.length-1;y>=0;y--)if(h.dist(g[y])<o)return!0}else p[i]=[];return p[i].push(h),!1}const US=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class nb{static from(i){if(!(i instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[o,h]=new Uint8Array(i,0,2);if(o!==219)throw new Error("Data does not appear to be in a KDBush format.");const p=h>>4;if(p!==1)throw new Error(`Got v${p} data when expected v1.`);const g=US[15&h];if(!g)throw new Error("Unrecognized array type.");const[y]=new Uint16Array(i,2,1),[x]=new Uint32Array(i,4,1);return new nb(x,y,g,i)}constructor(i,o=64,h=Float64Array,p){if(isNaN(i)||i<0)throw new Error(`Unpexpected numItems value: ${i}.`);this.numItems=+i,this.nodeSize=Math.min(Math.max(+o,2),65535),this.ArrayType=h,this.IndexArrayType=i<65536?Uint16Array:Uint32Array;const g=US.indexOf(this.ArrayType),y=2*i*this.ArrayType.BYTES_PER_ELEMENT,x=i*this.IndexArrayType.BYTES_PER_ELEMENT,A=(8-x%8)%8;if(g<0)throw new Error(`Unexpected typed array class: ${h}.`);p&&p instanceof ArrayBuffer?(this.data=p,this.ids=new this.IndexArrayType(this.data,8,i),this.coords=new this.ArrayType(this.data,8+x+A,2*i),this._pos=2*i,this._finished=!0):(this.data=new ArrayBuffer(8+y+x+A),this.ids=new this.IndexArrayType(this.data,8,i),this.coords=new this.ArrayType(this.data,8+x+A,2*i),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+g]),new Uint16Array(this.data,2,1)[0]=o,new Uint32Array(this.data,4,1)[0]=i)}add(i,o){const h=this._pos>>1;return this.ids[h]=h,this.coords[this._pos++]=i,this.coords[this._pos++]=o,h}finish(){const i=this._pos>>1;if(i!==this.numItems)throw new Error(`Added ${i} items when expected ${this.numItems}.`);return ob(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(i,o,h,p){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:g,coords:y,nodeSize:x}=this,A=[0,g.length-1,0],E=[];for(;A.length;){const M=A.pop()||0,P=A.pop()||0,F=A.pop()||0;if(P-F<=x){for(let H=F;H<=P;H++){const q=y[2*H],ct=y[2*H+1];q>=i&&q<=h&&ct>=o&&ct<=p&&E.push(g[H])}continue}const O=F+P>>1,N=y[2*O],z=y[2*O+1];N>=i&&N<=h&&z>=o&&z<=p&&E.push(g[O]),(M===0?i<=N:o<=z)&&(A.push(F),A.push(O-1),A.push(1-M)),(M===0?h>=N:p>=z)&&(A.push(O+1),A.push(P),A.push(1-M))}return E}within(i,o,h){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:p,coords:g,nodeSize:y}=this,x=[0,p.length-1,0],A=[],E=h*h;for(;x.length;){const M=x.pop()||0,P=x.pop()||0,F=x.pop()||0;if(P-F<=y){for(let H=F;H<=P;H++)VS(g[2*H],g[2*H+1],i,o)<=E&&A.push(p[H]);continue}const O=F+P>>1,N=g[2*O],z=g[2*O+1];VS(N,z,i,o)<=E&&A.push(p[O]),(M===0?i-h<=N:o-h<=z)&&(x.push(F),x.push(O-1),x.push(1-M)),(M===0?i+h>=N:o+h>=z)&&(x.push(O+1),x.push(P),x.push(1-M))}return A}}function ob(l,i,o,h,p,g){if(p-h<=o)return;const y=h+p>>1;zS(l,i,y,h,p,g),ob(l,i,o,h,y-1,1-g),ob(l,i,o,y+1,p,1-g)}function zS(l,i,o,h,p,g){for(;p>h;){if(p-h>600){const E=p-h+1,M=o-h+1,P=Math.log(E),F=.5*Math.exp(2*P/3),O=.5*Math.sqrt(P*F*(E-F)/E)*(M-E/2<0?-1:1);zS(l,i,o,Math.max(h,Math.floor(o-M*F/E+O)),Math.min(p,Math.floor(o+(E-M)*F/E+O)),g)}const y=i[2*o+g];let x=h,A=p;for(Kd(l,i,h,o),i[2*p+g]>y&&Kd(l,i,h,p);x<A;){for(Kd(l,i,x,A),x++,A--;i[2*x+g]<y;)x++;for(;i[2*A+g]>y;)A--}i[2*h+g]===y?Kd(l,i,h,A):(A++,Kd(l,i,A,p)),A<=o&&(h=A+1),o<=A&&(p=A-1)}}function Kd(l,i,o,h){ab(l,o,h),ab(i,2*o,2*h),ab(i,2*o+1,2*h+1)}function ab(l,i,o){const h=l[i];l[i]=l[o],l[o]=h}function VS(l,i,o,h){const p=l-o,g=i-h;return p*p+g*g}var lb;f.cB=void 0,(lb=f.cB||(f.cB={})).create="create",lb.load="load",lb.fullLoad="fullLoad";let W_=null,Jd=[];const cb=1e3/60,ub="loadTime",hb="fullLoadTime",q9={mark(l){performance.mark(l)},frame(l){const i=l;W_!=null&&Jd.push(i-W_),W_=i},clearMetrics(){W_=null,Jd=[],performance.clearMeasures(ub),performance.clearMeasures(hb);for(const l in f.cB)performance.clearMarks(f.cB[l])},getPerformanceMetrics(){performance.measure(ub,f.cB.create,f.cB.load),performance.measure(hb,f.cB.create,f.cB.fullLoad);const l=performance.getEntriesByName(ub)[0].duration,i=performance.getEntriesByName(hb)[0].duration,o=Jd.length,h=1/(Jd.reduce(((g,y)=>g+y),0)/o/1e3),p=Jd.filter((g=>g>cb)).reduce(((g,y)=>g+(y-cb)/cb),0);return{loadTime:l,fullLoadTime:i,fps:h,percentDroppedFrames:p/(o+p)*100,totalFrames:o}}};f.$=Os,f.A=Ct,f.B=Vo,f.C=function([l,i,o]){return i+=90,i*=Math.PI/180,o*=Math.PI/180,{x:l*Math.cos(i)*Math.sin(o),y:l*Math.sin(i)*Math.sin(o),z:l*Math.cos(o)}},f.D=fe,f.E=Tt,f.F=qs,f.G=or,f.H=d0,f.I=O0,f.J=function(l){if(We==null){const i=l.navigator?l.navigator.userAgent:null;We=!!l.safari||!(!i||!(/\b(iPad|iPhone|iPod)\b/.test(i)||i.match("Safari")&&!i.match("Chrome")))}return We},f.K=class{constructor(l,i){this.target=l,this.mapId=i,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new m9((()=>this.process())),this.subscription=dn(this.target,"message",(o=>this.receive(o)),!1),this.globalScope=Gr(self)?l:window}registerMessageHandler(l,i){this.messageHandlers[l]=i}unregisterMessageHandler(l){delete this.messageHandlers[l]}sendAsync(l,i){return new Promise(((o,h)=>{const p=Math.round(1e18*Math.random()).toString(36).substring(0,10),g=i?dn(i.signal,"abort",(()=>{g?.unsubscribe(),delete this.resolveRejects[p];const A={id:p,type:"<cancel>",origin:location.origin,targetMapId:l.targetMapId,sourceMapId:this.mapId};this.target.postMessage(A)}),y9):null;this.resolveRejects[p]={resolve:A=>{g?.unsubscribe(),o(A)},reject:A=>{g?.unsubscribe(),h(A)}};const y=[],x=Object.assign(Object.assign({},l),{id:p,sourceMapId:this.mapId,origin:location.origin,data:Fl(l.data,y)});this.target.postMessage(x,{transfer:y})}))}receive(l){const i=l.data,o=i.id;if(!(i.origin!=="file://"&&location.origin!=="file://"&&i.origin!=="resource://android"&&location.origin!=="resource://android"&&i.origin!==location.origin||i.targetMapId&&this.mapId!==i.targetMapId)){if(i.type==="<cancel>"){delete this.tasks[o];const h=this.abortControllers[o];return delete this.abortControllers[o],void(h&&h.abort())}if(Gr(self)||i.mustQueue)return this.tasks[o]=i,this.taskQueue.push(o),void this.invoker.trigger();this.processTask(o,i)}}process(){if(this.taskQueue.length===0)return;const l=this.taskQueue.shift(),i=this.tasks[l];delete this.tasks[l],this.taskQueue.length>0&&this.invoker.trigger(),i&&this.processTask(l,i)}processTask(l,i){return c(this,void 0,void 0,(function*(){if(i.type==="<response>"){const p=this.resolveRejects[l];return delete this.resolveRejects[l],p?void(i.error?p.reject(Nn(i.error)):p.resolve(Nn(i.data))):void 0}if(!this.messageHandlers[i.type])return void this.completeTask(l,new Error(`Could not find a registered handler for ${i.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const o=Nn(i.data),h=new AbortController;this.abortControllers[l]=h;try{const p=yield this.messageHandlers[i.type](i.sourceMapId,o,h);this.completeTask(l,null,p)}catch(p){this.completeTask(l,p)}}))}completeTask(l,i,o){const h=[];delete this.abortControllers[l];const p={id:l,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:i?Fl(i):null,data:Fl(o,h)};this.target.postMessage(p,{transfer:h})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},f.L=Ls,f.M=function(){var l=new Ct(16);return Ct!=Float32Array&&(l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[11]=0,l[12]=0,l[13]=0,l[14]=0),l[0]=1,l[5]=1,l[10]=1,l[15]=1,l},f.N=function(l,i,o){var h,p,g,y,x,A,E,M,P,F,O,N,z=o[0],H=o[1],q=o[2];return i===l?(l[12]=i[0]*z+i[4]*H+i[8]*q+i[12],l[13]=i[1]*z+i[5]*H+i[9]*q+i[13],l[14]=i[2]*z+i[6]*H+i[10]*q+i[14],l[15]=i[3]*z+i[7]*H+i[11]*q+i[15]):(p=i[1],g=i[2],y=i[3],x=i[4],A=i[5],E=i[6],M=i[7],P=i[8],F=i[9],O=i[10],N=i[11],l[0]=h=i[0],l[1]=p,l[2]=g,l[3]=y,l[4]=x,l[5]=A,l[6]=E,l[7]=M,l[8]=P,l[9]=F,l[10]=O,l[11]=N,l[12]=h*z+x*H+P*q+i[12],l[13]=p*z+A*H+F*q+i[13],l[14]=g*z+E*H+O*q+i[14],l[15]=y*z+M*H+N*q+i[15]),l},f.O=function(l,i,o){var h=o[0],p=o[1],g=o[2];return l[0]=i[0]*h,l[1]=i[1]*h,l[2]=i[2]*h,l[3]=i[3]*h,l[4]=i[4]*p,l[5]=i[5]*p,l[6]=i[6]*p,l[7]=i[7]*p,l[8]=i[8]*g,l[9]=i[9]*g,l[10]=i[10]*g,l[11]=i[11]*g,l[12]=i[12],l[13]=i[13],l[14]=i[14],l[15]=i[15],l},f.P=T,f.Q=function(l,i,o){var h=i[0],p=i[1],g=i[2],y=i[3],x=i[4],A=i[5],E=i[6],M=i[7],P=i[8],F=i[9],O=i[10],N=i[11],z=i[12],H=i[13],q=i[14],ct=i[15],J=o[0],rt=o[1],pt=o[2],vt=o[3];return l[0]=J*h+rt*x+pt*P+vt*z,l[1]=J*p+rt*A+pt*F+vt*H,l[2]=J*g+rt*E+pt*O+vt*q,l[3]=J*y+rt*M+pt*N+vt*ct,l[4]=(J=o[4])*h+(rt=o[5])*x+(pt=o[6])*P+(vt=o[7])*z,l[5]=J*p+rt*A+pt*F+vt*H,l[6]=J*g+rt*E+pt*O+vt*q,l[7]=J*y+rt*M+pt*N+vt*ct,l[8]=(J=o[8])*h+(rt=o[9])*x+(pt=o[10])*P+(vt=o[11])*z,l[9]=J*p+rt*A+pt*F+vt*H,l[10]=J*g+rt*E+pt*O+vt*q,l[11]=J*y+rt*M+pt*N+vt*ct,l[12]=(J=o[12])*h+(rt=o[13])*x+(pt=o[14])*P+(vt=o[15])*z,l[13]=J*p+rt*A+pt*F+vt*H,l[14]=J*g+rt*E+pt*O+vt*q,l[15]=J*y+rt*M+pt*N+vt*ct,l},f.R=hs,f.S=function(l,i){const o={};for(let h=0;h<i.length;h++){const p=i[h];p in l&&(o[p]=l[p])}return o},f.T=E0,f.U=Va,f.V=ur,f.W=ZE,f.X=qE,f.Y=K,f.Z=It,f._=c,f.a=ks,f.a$=function(l,i){return l[0]*i[0]+l[1]*i[1]+l[2]*i[2]},f.a0=Qs,f.a1=KE,f.a2=B_,f.a3=Le,f.a4=function(l,i){var o,h,p,g,y;if(!l)return i??{};if(!i)return l;let x=Object.assign({},l);if(i.removeAll&&(x={removeAll:!0}),i.remove){const A=new Set(i.remove);x.add&&(x.add=x.add.filter((M=>!A.has(M.id)))),x.update&&(x.update=x.update.filter((M=>!A.has(M.id))));const E=new Set(((o=l.add)!==null&&o!==void 0?o:[]).map((M=>M.id)));i.remove=i.remove.filter((M=>!E.has(M)))}if(i.remove){const A=new Set(x.remove?x.remove.concat(i.remove):i.remove);x.remove=Array.from(A.values())}if(i.add){const A=x.add?x.add.concat(i.add):i.add,E=new Map(A.map((M=>[M.id,M])));x.add=Array.from(E.values())}if(i.update){const A=new Map((h=x.update)===null||h===void 0?void 0:h.map((E=>[E.id,E])));for(const E of i.update){const M=(p=A.get(E.id))!==null&&p!==void 0?p:{id:E.id};E.newGeometry&&(M.newGeometry=E.newGeometry),E.addOrUpdateProperties&&(M.addOrUpdateProperties=((g=M.addOrUpdateProperties)!==null&&g!==void 0?g:[]).concat(E.addOrUpdateProperties)),E.removeProperties&&(M.removeProperties=((y=M.removeProperties)!==null&&y!==void 0?y:[]).concat(E.removeProperties)),E.removeAllProperties&&(M.removeAllProperties=!0),A.set(E.id,M)}x.update=Array.from(A.values())}return x.remove&&x.add&&(x.remove=x.remove.filter((A=>x.add.findIndex((E=>E.id===A))===-1))),x},f.a5=Hd,f.a6=Wl,f.a7=25,f.a8=G0,f.a9=l=>{const i=window.document.createElement("video");return i.muted=!0,new Promise((o=>{i.onloadstart=()=>{o(i)};for(const h of l){const p=window.document.createElement("source");G(h)||(i.crossOrigin="Anonymous"),p.src=h,i.appendChild(p)}}))},f.aA=U0,f.aB=Ce,f.aC=function(l,i,o,h){const p=i.y-l.y,g=i.x-l.x,y=h.y-o.y,x=h.x-o.x,A=y*g-x*p;if(A===0)return null;const E=(x*(l.y-o.y)-y*(l.x-o.x))/A;return new T(l.x+E*g,l.y+E*p)},f.aD=ES,f.aE=qA,f.aF=function(l){let i=1/0,o=1/0,h=-1/0,p=-1/0;for(const g of l)i=Math.min(i,g.x),o=Math.min(o,g.y),h=Math.max(h,g.x),p=Math.max(p,g.y);return[i,o,h,p]},f.aG=hi,f.aH=vi,f.aI=function(l,i,o,h,p=!1){if(!o[0]&&!o[1])return[0,0];const g=p?h==="map"?-l.bearingInRadians:0:h==="viewport"?l.bearingInRadians:0;if(g){const y=Math.sin(g),x=Math.cos(g);o=[o[0]*x-o[1]*y,o[0]*y+o[1]*x]}return[p?o[0]:vi(i,o[0],l.zoom),p?o[1]:vi(i,o[1],l.zoom)]},f.aK=L0,f.aL=sb,f.aM=N0,f.aN=nb,f.aO=fr,f.aP=S_,f.aQ=et,f.aR=pe,f.aS=qt,f.aT=Bi,f.aU=JE,f.aV=le,f.aW=ie,f.aX=function(l){var i=new Ct(3);return i[0]=l[0],i[1]=l[1],i[2]=l[2],i},f.aY=function(l,i,o){return l[0]=i[0]-o[0],l[1]=i[1]-o[1],l[2]=i[2]-o[2],l},f.aZ=function(l,i){var o=i[0],h=i[1],p=i[2],g=o*o+h*h+p*p;return g>0&&(g=1/Math.sqrt(g)),l[0]=i[0]*g,l[1]=i[1]*g,l[2]=i[2]*g,l},f.a_=Ae,f.aa=Wt,f.ab=function(){return hr++},f.ac=v,f.ad=Ou,f.ae=Sl,f.af=vo,f.ag=rS,f.ah=function(l){const i={};if(l.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((o,h,p,g)=>{const y=p||g;return i[h]=!y||y.toLowerCase(),""})),i["max-age"]){const o=parseInt(i["max-age"],10);isNaN(o)?delete i["max-age"]:i["max-age"]=o}return i},f.ai=wi,f.aj=85.051129,f.ak=Dn,f.al=function(l){return Math.pow(2,l)},f.am=Qt,f.an=YE,f.ao=function(l){return Math.log(l)/Math.LN2},f.ap=function(l){var i=l[0],o=l[1];return i*i+o*o},f.aq=class{constructor(l,i){this.max=l,this.onRemove=i,this.reset()}reset(){for(const l in this.data)for(const i of this.data[l])i.timeout&&clearTimeout(i.timeout),this.onRemove(i.value);return this.data={},this.order=[],this}add(l,i,o){const h=l.wrapped().key;this.data[h]===void 0&&(this.data[h]=[]);const p={value:i,timeout:void 0};if(o!==void 0&&(p.timeout=setTimeout((()=>{this.remove(l,p)}),o)),this.data[h].push(p),this.order.push(h),this.order.length>this.max){const g=this._getAndRemoveByKey(this.order[0]);g&&this.onRemove(g)}return this}has(l){return l.wrapped().key in this.data}getAndRemove(l){return this.has(l)?this._getAndRemoveByKey(l.wrapped().key):null}_getAndRemoveByKey(l){const i=this.data[l].shift();return i.timeout&&clearTimeout(i.timeout),this.data[l].length===0&&delete this.data[l],this.order.splice(this.order.indexOf(l),1),i.value}getByKey(l){const i=this.data[l];return i?i[0].value:null}get(l){return this.has(l)?this.data[l.wrapped().key][0].value:null}remove(l,i){if(!this.has(l))return this;const o=l.wrapped().key,h=i===void 0?0:this.data[o].indexOf(i),p=this.data[o][h];return this.data[o].splice(h,1),p.timeout&&clearTimeout(p.timeout),this.data[o].length===0&&delete this.data[o],this.onRemove(p.value),this.order.splice(this.order.indexOf(o),1),this}setMaxSize(l){for(this.max=l;this.order.length>this.max;){const i=this._getAndRemoveByKey(this.order[0]);i&&this.onRemove(i)}return this}filter(l){const i=[];for(const o in this.data)for(const h of this.data[o])l(h.value)||i.push(h);for(const o of i)this.remove(o.value.tileID,o)}},f.ar=function(l){if(!l.length)return new Set;const i=Math.max(...l.map((A=>A.canonical.z)));let o=1/0,h=-1/0,p=1/0,g=-1/0;const y=[];for(const A of l){const{x:E,y:M,z:P}=A.canonical,F=Math.pow(2,i-P),O=E*F,N=M*F;y.push({id:A,x:O,y:N}),O<o&&(o=O),O>h&&(h=O),N<p&&(p=N),N>g&&(g=N)}const x=new Set;for(const A of y)A.x!==o&&A.x!==h&&A.y!==p&&A.y!==g||x.add(A.id);return x},f.as=function(l,i){let o=0,h=0;if(l.kind==="constant")h=l.layoutSize;else if(l.kind!=="source"){const{interpolationType:p,minZoom:g,maxZoom:y}=l,x=p?wi(Si.interpolationFactor(p,i,g,y),0,1):0;l.kind==="camera"?h=qs.number(l.minSize,l.maxSize,x):o=x}return{uSizeT:o,uSize:h}},f.au=function(l,{uSize:i,uSizeT:o},{lowerSize:h,upperSize:p}){return l.kind==="source"?h/Wo:l.kind==="composite"?qs.number(h/Wo,p/Wo,o):i},f.av=function(l,i){var o=i[0],h=i[1],p=i[2],g=i[3],y=i[4],x=i[5],A=i[6],E=i[7],M=i[8],P=i[9],F=i[10],O=i[11],N=i[12],z=i[13],H=i[14],q=i[15],ct=o*x-h*y,J=o*A-p*y,rt=o*E-g*y,pt=h*A-p*x,vt=h*E-g*x,Pt=p*E-g*A,jt=M*z-P*N,Vt=M*H-F*N,$t=M*q-O*N,se=P*H-F*z,Yt=P*q-O*z,Kt=F*q-O*H,zt=ct*Kt-J*Yt+rt*se+pt*$t-vt*Vt+Pt*jt;return zt?(l[0]=(x*Kt-A*Yt+E*se)*(zt=1/zt),l[1]=(p*Yt-h*Kt-g*se)*zt,l[2]=(z*Pt-H*vt+q*pt)*zt,l[3]=(F*vt-P*Pt-O*pt)*zt,l[4]=(A*$t-y*Kt-E*Vt)*zt,l[5]=(o*Kt-p*$t+g*Vt)*zt,l[6]=(H*rt-N*Pt-q*J)*zt,l[7]=(M*Pt-F*rt+O*J)*zt,l[8]=(y*Yt-x*$t+E*jt)*zt,l[9]=(h*$t-o*Yt-g*jt)*zt,l[10]=(N*vt-z*rt+q*ct)*zt,l[11]=(P*rt-M*vt-O*ct)*zt,l[12]=(x*Vt-y*se-A*jt)*zt,l[13]=(o*se-h*Vt+p*jt)*zt,l[14]=(z*J-N*pt-H*ct)*zt,l[15]=(M*pt-P*J+F*ct)*zt,l):null},f.aw=Hr,f.ax=function(l){var i=l[0],o=l[1];return Math.sqrt(i*i+o*o)},f.ay=function(l){return l[0]=0,l[1]=0,l},f.az=function(l,i,o){return l[0]=i[0]*o,l[1]=i[1]*o,l},f.b=os,f.b$=function(l,i){var o=Math.sin(i),h=Math.cos(i);return l[0]=h,l[1]=o,l[2]=0,l[3]=-o,l[4]=h,l[5]=0,l[6]=0,l[7]=0,l[8]=1,l},f.b0=function(l,i,o){return l[0]=i[0]*o[0],l[1]=i[1]*o[1],l[2]=i[2]*o[2],l[3]=i[3]*o[3],l},f.b1=ae,f.b2=function(l,i,o){const h=i[0]*o[0]+i[1]*o[1]+i[2]*o[2];return h===0?null:(-(l[0]*o[0]+l[1]*o[1]+l[2]*o[2])-o[3])/h},f.b3=ze,f.b4=function(l,i,o){return l[0]=i[0]*o,l[1]=i[1]*o,l[2]=i[2]*o,l[3]=i[3]*o,l},f.b5=function(l,i){return l[0]*i[0]+l[1]*i[1]+l[2]*i[2]+l[3]},f.b6=tS,f.b7=ku,f.b8=function(l,i,o,h,p){var g=1/Math.tan(i/2);if(l[0]=g/o,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=g,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[11]=-1,l[12]=0,l[13]=0,l[15]=0,p!=null&&p!==1/0){var y=1/(h-p);l[10]=(p+h)*y,l[14]=2*p*h*y}else l[10]=-1,l[14]=-2*h;return l},f.b9=function(l){var i=new Ct(16);return i[0]=l[0],i[1]=l[1],i[2]=l[2],i[3]=l[3],i[4]=l[4],i[5]=l[5],i[6]=l[6],i[7]=l[7],i[8]=l[8],i[9]=l[9],i[10]=l[10],i[11]=l[11],i[12]=l[12],i[13]=l[13],i[14]=l[14],i[15]=l[15],i},f.bA=function(l,i,o,h){var p=[],g=[];return p[0]=i[0]-o[0],p[1]=i[1]-o[1],p[2]=i[2]-o[2],g[0]=p[0]*Math.cos(h)-p[1]*Math.sin(h),g[1]=p[0]*Math.sin(h)+p[1]*Math.cos(h),g[2]=p[2],l[0]=g[0]+o[0],l[1]=g[1]+o[1],l[2]=g[2]+o[2],l},f.bB=function(l,i,o,h){var p=[],g=[];return p[0]=i[0]-o[0],p[1]=i[1]-o[1],p[2]=i[2]-o[2],g[0]=p[0],g[1]=p[1]*Math.cos(h)-p[2]*Math.sin(h),g[2]=p[1]*Math.sin(h)+p[2]*Math.cos(h),l[0]=g[0]+o[0],l[1]=g[1]+o[1],l[2]=g[2]+o[2],l},f.bC=function(l,i,o,h){var p=[],g=[];return p[0]=i[0]-o[0],p[1]=i[1]-o[1],p[2]=i[2]-o[2],g[0]=p[2]*Math.sin(h)+p[0]*Math.cos(h),g[1]=p[1],g[2]=p[2]*Math.cos(h)-p[0]*Math.sin(h),l[0]=g[0]+o[0],l[1]=g[1]+o[1],l[2]=g[2]+o[2],l},f.bD=function(l,i,o){var h=Math.sin(o),p=Math.cos(o),g=i[0],y=i[1],x=i[2],A=i[3],E=i[8],M=i[9],P=i[10],F=i[11];return i!==l&&(l[4]=i[4],l[5]=i[5],l[6]=i[6],l[7]=i[7],l[12]=i[12],l[13]=i[13],l[14]=i[14],l[15]=i[15]),l[0]=g*p-E*h,l[1]=y*p-M*h,l[2]=x*p-P*h,l[3]=A*p-F*h,l[8]=g*h+E*p,l[9]=y*h+M*p,l[10]=x*h+P*p,l[11]=A*h+F*p,l},f.bE=function(l,i){const o=xi(l,360),h=xi(i,360),p=h-o,g=h>o?p-360:p+360;return Math.abs(p)<Math.abs(g)?p:g},f.bF=function(l){return l[0]=0,l[1]=0,l[2]=0,l},f.bG=function(l,i,o,h){const p=Math.sqrt(l*l+i*i),g=Math.sqrt(o*o+h*h);l/=p,i/=p,o/=g,h/=g;const y=Math.acos(l*o+i*h);return-i*o+l*h>0?y:-y},f.bH=function(l,i){const o=xi(l,2*Math.PI),h=xi(i,2*Math.PI);return Math.min(Math.abs(o-h),Math.abs(o-h+2*Math.PI),Math.abs(o-h-2*Math.PI))},f.bI=function(){const l={},i=tt.$version;for(const o in tt.$root){const h=tt.$root[o];if(h.required){let p=null;p=o==="version"?i:h.type==="array"?[]:{},p!=null&&(l[o]=p)}}return l},f.bJ=ji,f.bK=md,f.bL=function l(i,o){if(Array.isArray(i)){if(!Array.isArray(o)||i.length!==o.length)return!1;for(let h=0;h<i.length;h++)if(!l(i[h],o[h]))return!1;return!0}if(typeof i=="object"&&i!==null&&o!==null){if(typeof o!="object"||Object.keys(i).length!==Object.keys(o).length)return!1;for(const h in i)if(!l(i[h],o[h]))return!1;return!0}return i===o},f.bM=function(l){l=l.slice();const i=Object.create(null);for(let o=0;o<l.length;o++)i[l[o].id]=l[o];for(let o=0;o<l.length;o++)"ref"in l[o]&&(l[o]=kt(l[o],i[l[o].ref]));return l},f.bN=function(l,i){if(l.type==="custom")return new g9(l,i);switch(l.type){case"background":return new _9(l,i);case"circle":return new tV(l,i);case"color-relief":return new oV(l,i);case"fill":return new xV(l,i);case"fill-extrusion":return new BV(l,i);case"heatmap":return new rV(l,i);case"hillshade":return new sV(l,i);case"line":return new UV(l,i);case"raster":return new g0(l,i);case"symbol":return new P_(l,i)}},f.bO=l=>l.type==="raster",f.bP=ci,f.bQ=function(l,i){if(!l)return[{command:"setStyle",args:[i]}];let o=[];try{if(!Lt(l.version,i.version))return[{command:"setStyle",args:[i]}];Lt(l.center,i.center)||o.push({command:"setCenter",args:[i.center]}),Lt(l.state,i.state)||o.push({command:"setGlobalState",args:[i.state]}),Lt(l.centerAltitude,i.centerAltitude)||o.push({command:"setCenterAltitude",args:[i.centerAltitude]}),Lt(l.zoom,i.zoom)||o.push({command:"setZoom",args:[i.zoom]}),Lt(l.bearing,i.bearing)||o.push({command:"setBearing",args:[i.bearing]}),Lt(l.pitch,i.pitch)||o.push({command:"setPitch",args:[i.pitch]}),Lt(l.roll,i.roll)||o.push({command:"setRoll",args:[i.roll]}),Lt(l.sprite,i.sprite)||o.push({command:"setSprite",args:[i.sprite]}),Lt(l.glyphs,i.glyphs)||o.push({command:"setGlyphs",args:[i.glyphs]}),Lt(l.transition,i.transition)||o.push({command:"setTransition",args:[i.transition]}),Lt(l.light,i.light)||o.push({command:"setLight",args:[i.light]}),Lt(l.terrain,i.terrain)||o.push({command:"setTerrain",args:[i.terrain]}),Lt(l.sky,i.sky)||o.push({command:"setSky",args:[i.sky]}),Lt(l.projection,i.projection)||o.push({command:"setProjection",args:[i.projection]});const h={},p=[];(function(y,x,A,E){let M;for(M in x=x||{},y=y||{})Object.prototype.hasOwnProperty.call(y,M)&&(Object.prototype.hasOwnProperty.call(x,M)||ge(M,A,E));for(M in x)Object.prototype.hasOwnProperty.call(x,M)&&(Object.prototype.hasOwnProperty.call(y,M)?Lt(y[M],x[M])||(y[M].type==="geojson"&&x[M].type==="geojson"&&Sr(y,x,M)?Ut(A,{command:"setGeoJSONSourceData",args:[M,x[M].data]}):Ee(M,x,A,E)):ne(M,x,A))})(l.sources,i.sources,p,h);const g=[];l.layers&&l.layers.forEach((y=>{"source"in y&&h[y.source]?o.push({command:"removeLayer",args:[y.id]}):g.push(y)})),o=o.concat(p),(function(y,x,A){x=x||[];const E=(y=y||[]).map(Ve),M=x.map(Ve),P=y.reduce(rr,{}),F=x.reduce(rr,{}),O=E.slice(),N=Object.create(null);let z,H,q,ct,J;for(let rt=0,pt=0;rt<E.length;rt++)z=E[rt],Object.prototype.hasOwnProperty.call(F,z)?pt++:(Ut(A,{command:"removeLayer",args:[z]}),O.splice(O.indexOf(z,pt),1));for(let rt=0,pt=0;rt<M.length;rt++)z=M[M.length-1-rt],O[O.length-1-rt]!==z&&(Object.prototype.hasOwnProperty.call(P,z)?(Ut(A,{command:"removeLayer",args:[z]}),O.splice(O.lastIndexOf(z,O.length-pt),1)):pt++,ct=O[O.length-rt],Ut(A,{command:"addLayer",args:[F[z],ct]}),O.splice(O.length-rt,0,z),N[z]=!0);for(let rt=0;rt<M.length;rt++)if(z=M[rt],H=P[z],q=F[z],!N[z]&&!Lt(H,q))if(Lt(H.source,q.source)&&Lt(H["source-layer"],q["source-layer"])&&Lt(H.type,q.type)){for(J in Pe(H.layout,q.layout,A,z,null,"setLayoutProperty"),Pe(H.paint,q.paint,A,z,null,"setPaintProperty"),Lt(H.filter,q.filter)||Ut(A,{command:"setFilter",args:[z,q.filter]}),Lt(H.minzoom,q.minzoom)&&Lt(H.maxzoom,q.maxzoom)||Ut(A,{command:"setLayerZoomRange",args:[z,q.minzoom,q.maxzoom]}),H)Object.prototype.hasOwnProperty.call(H,J)&&J!=="layout"&&J!=="paint"&&J!=="filter"&&J!=="metadata"&&J!=="minzoom"&&J!=="maxzoom"&&(J.indexOf("paint.")===0?Pe(H[J],q[J],A,z,J.slice(6),"setPaintProperty"):Lt(H[J],q[J])||Ut(A,{command:"setLayerProperty",args:[z,J,q[J]]}));for(J in q)Object.prototype.hasOwnProperty.call(q,J)&&!Object.prototype.hasOwnProperty.call(H,J)&&J!=="layout"&&J!=="paint"&&J!=="filter"&&J!=="metadata"&&J!=="minzoom"&&J!=="maxzoom"&&(J.indexOf("paint.")===0?Pe(H[J],q[J],A,z,J.slice(6),"setPaintProperty"):Lt(H[J],q[J])||Ut(A,{command:"setLayerProperty",args:[z,J,q[J]]}))}else Ut(A,{command:"removeLayer",args:[z]}),ct=O[O.lastIndexOf(z)+1],Ut(A,{command:"addLayer",args:[q,ct]})})(g,i.layers,o)}catch(h){console.warn("Unable to compute style diff:",h),o=[{command:"setStyle",args:[i]}]}return o},f.bR=function(l){const i=[],o=l.id;return o===void 0&&i.push({message:`layers.${o}: missing required property "id"`}),l.render===void 0&&i.push({message:`layers.${o}: missing required method "render"`}),l.renderingMode&&l.renderingMode!=="2d"&&l.renderingMode!=="3d"&&i.push({message:`layers.${o}: property "renderingMode" must be either "2d" or "3d"`}),i},f.bS=Or,f.bT=xs,f.bU=class extends Ss{constructor(l,i){super(l,i),this.current=0}set(l){this.current!==l&&(this.current=l,this.gl.uniform1i(this.location,l))}},f.bV=us,f.bW=class extends Ss{constructor(l,i){super(l,i),this.current=yo}set(l){if(l[12]!==this.current[12]||l[0]!==this.current[0])return this.current=l,void this.gl.uniformMatrix4fv(this.location,!1,l);for(let i=1;i<16;i++)if(l[i]!==this.current[i]){this.current=l,this.gl.uniformMatrix4fv(this.location,!1,l);break}}},f.bX=Go,f.bY=class extends Ss{constructor(l,i){super(l,i),this.current=[0,0,0]}set(l){l[0]===this.current[0]&&l[1]===this.current[1]&&l[2]===this.current[2]||(this.current=l,this.gl.uniform3f(this.location,l[0],l[1],l[2]))}},f.bZ=class extends Ss{constructor(l,i){super(l,i),this.current=[0,0]}set(l){l[0]===this.current[0]&&l[1]===this.current[1]||(this.current=l,this.gl.uniform2f(this.location,l[0],l[1]))}},f.b_=Ht,f.ba=function(l,i,o){var h=Math.sin(o),p=Math.cos(o),g=i[0],y=i[1],x=i[2],A=i[3],E=i[4],M=i[5],P=i[6],F=i[7];return i!==l&&(l[8]=i[8],l[9]=i[9],l[10]=i[10],l[11]=i[11],l[12]=i[12],l[13]=i[13],l[14]=i[14],l[15]=i[15]),l[0]=g*p+E*h,l[1]=y*p+M*h,l[2]=x*p+P*h,l[3]=A*p+F*h,l[4]=E*p-g*h,l[5]=M*p-y*h,l[6]=P*p-x*h,l[7]=F*p-A*h,l},f.bb=function(l,i,o){var h=Math.sin(o),p=Math.cos(o),g=i[4],y=i[5],x=i[6],A=i[7],E=i[8],M=i[9],P=i[10],F=i[11];return i!==l&&(l[0]=i[0],l[1]=i[1],l[2]=i[2],l[3]=i[3],l[12]=i[12],l[13]=i[13],l[14]=i[14],l[15]=i[15]),l[4]=g*p+E*h,l[5]=y*p+M*h,l[6]=x*p+P*h,l[7]=A*p+F*h,l[8]=E*p-g*h,l[9]=M*p-y*h,l[10]=P*p-x*h,l[11]=F*p-A*h,l},f.bc=function(){const l=new Float32Array(16);return Qt(l),l},f.bd=function(){const l=new Float64Array(16);return Qt(l),l},f.be=function(){return new Float64Array(16)},f.bf=function(l,i,o){const h=new Float64Array(4);return ns(h,l,i-90,o),h},f.bg=function(l,i,o,h){var p,g,y,x,A,E=i[0],M=i[1],P=i[2],F=i[3],O=o[0],N=o[1],z=o[2],H=o[3];return(g=E*O+M*N+P*z+F*H)<0&&(g=-g,O=-O,N=-N,z=-z,H=-H),1-g>St?(p=Math.acos(g),y=Math.sin(p),x=Math.sin((1-h)*p)/y,A=Math.sin(h*p)/y):(x=1-h,A=h),l[0]=x*E+A*O,l[1]=x*M+A*N,l[2]=x*P+A*z,l[3]=x*F+A*H,l},f.bh=function(l){const i=new Float64Array(9);var o,h,p,g,y,x,A,E,M,P,F,O,N,z,H,q,ct,J;P=(p=(h=l)[0])*(A=p+p),F=(g=h[1])*A,N=(y=h[2])*A,z=y*(E=g+g),q=(x=h[3])*A,ct=x*E,J=x*(M=y+y),(o=i)[0]=1-(O=g*E)-(H=y*M),o[3]=F-J,o[6]=N+ct,o[1]=F+J,o[4]=1-P-H,o[7]=z-q,o[2]=N-ct,o[5]=z+q,o[8]=1-P-O;const rt=Bi(-Math.asin(wi(i[2],-1,1)));let pt,vt;return Math.hypot(i[5],i[8])<.001?(pt=0,vt=-Bi(Math.atan2(i[3],i[4]))):(pt=Bi(i[5]===0&&i[8]===0?0:Math.atan2(i[5],i[8])),vt=Bi(i[1]===0&&i[0]===0?0:Math.atan2(i[1],i[0]))),{roll:pt,pitch:rt+90,bearing:vt}},f.bi=function(l,i){return l.roll==i.roll&&l.pitch==i.pitch&&l.bearing==i.bearing},f.bj=Te,f.bk=Ho,f.bl=Pu,f.bm=Nd,f.bn=Ru,f.bo=li,f.bp=_a,f.bq=Ni,f.br=function(l,i,o,h,p){return li(h,p,wi((l-i)/(o-i),0,1))},f.bs=xi,f.bt=function(){return new Float64Array(3)},f.bu=function(l,i,o,h){return l[0]=i[0]+o[0]*h,l[1]=i[1]+o[1]*h,l[2]=i[2]+o[2]*h,l},f.bv=ns,f.bw=function(l,i,o){var h=o[0],p=o[1],g=o[2],y=o[3],x=i[0],A=i[1],E=i[2],M=p*E-g*A,P=g*x-h*E,F=h*A-p*x;return l[0]=x+y*(M+=M)+p*(F+=F)-g*(P+=P),l[1]=A+y*P+g*M-h*F,l[2]=E+y*F+h*P-p*M,l},f.bx=function(l,i,o){const h=(p=[l[0],l[1],l[2],i[0],i[1],i[2],o[0],o[1],o[2]])[0]*((M=p[8])*(y=p[4])-(x=p[5])*(E=p[7]))+p[1]*(-M*(g=p[3])+x*(A=p[6]))+p[2]*(E*g-y*A);var p,g,y,x,A,E,M;if(h===0)return null;const P=Ae([],[i[0],i[1],i[2]],[o[0],o[1],o[2]]),F=Ae([],[o[0],o[1],o[2]],[l[0],l[1],l[2]]),O=Ae([],[l[0],l[1],l[2]],[i[0],i[1],i[2]]),N=le([],P,-l[3]);return ie(N,N,le([],F,-i[3])),ie(N,N,le([],O,-o[3])),le(N,N,1/h),N},f.by=H0,f.bz=function(){return new Float64Array(4)},f.c=Fn,f.c$=function(l,i){const o=new Map;if(l!=null)if(l.type==="Feature")o.set(Gd(l,i),l);else for(const h of l.features)o.set(Gd(h,i),h);return o},f.c0=function(l,i,o){var h=i[0],p=i[1],g=i[2];return l[0]=h*o[0]+p*o[3]+g*o[6],l[1]=h*o[1]+p*o[4]+g*o[7],l[2]=h*o[2]+p*o[5]+g*o[8],l},f.c1=function(l,i,o,h,p,g,y){var x=1/(i-o),A=1/(h-p),E=1/(g-y);return l[0]=-2*x,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=-2*A,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=2*E,l[11]=0,l[12]=(i+o)*x,l[13]=(p+h)*A,l[14]=(y+g)*E,l[15]=1,l},f.c2=class extends Ss{constructor(l,i){super(l,i),this.current=new Array}set(l){if(l!=this.current){this.current=l;const i=new Float32Array(4*l.length);for(let o=0;o<l.length;o++)i[4*o]=l[o].r,i[4*o+1]=l[o].g,i[4*o+2]=l[o].b,i[4*o+3]=l[o].a;this.gl.uniform4fv(this.location,i)}}},f.c3=class extends Ss{constructor(l,i){super(l,i),this.current=new Array}set(l){if(l!=this.current){this.current=l;const i=new Float32Array(l);this.gl.uniform1fv(this.location,i)}}},f.c4=class extends Cd{},f.c5=HV,f.c6=class extends go{},f.c7=A0,f.c8=function(l){return l<=1?1:Math.pow(2,Math.ceil(Math.log(l)/Math.LN2))},f.c9=sE,f.cA=q9,f.cC=function(l){return l.message===fn},f.cD=ls,f.cE=function(l,i){ks.REGISTERED_PROTOCOLS[l]=i},f.cF=function(l){delete ks.REGISTERED_PROTOCOLS[l]},f.cG=function(l,i){const o={};for(let p=0;p<l.length;p++){const g=i&&i[l[p].id]||Zp(l[p]);i&&(i[l[p].id]=g);let y=o[g];y||(y=o[g]=[]),y.push(l[p])}const h=[];for(const p in o)h.push(o[p]);return h},f.cH=oe,f.cI=eS,f.cJ=TS,f.cK=DE,f.cL=function(l){l.bucket.createArrays(),l.bucket.tilePixelRatio=Le/(512*l.bucket.overscaling),l.bucket.compareText={},l.bucket.iconsNeedLinear=!1;const i=l.bucket.layers[0],o=i.layout,h=i._unevaluatedLayout._values,p={layoutIconSize:h["icon-size"].possiblyEvaluate(new or(l.bucket.zoom+1),l.canonical),layoutTextSize:h["text-size"].possiblyEvaluate(new or(l.bucket.zoom+1),l.canonical),textMaxSize:h["text-size"].possiblyEvaluate(new or(18))};if(l.bucket.textSizeData.kind==="composite"){const{minZoom:E,maxZoom:M}=l.bucket.textSizeData;p.compositeTextSizes=[h["text-size"].possiblyEvaluate(new or(E),l.canonical),h["text-size"].possiblyEvaluate(new or(M),l.canonical)]}if(l.bucket.iconSizeData.kind==="composite"){const{minZoom:E,maxZoom:M}=l.bucket.iconSizeData;p.compositeIconSizes=[h["icon-size"].possiblyEvaluate(new or(E),l.canonical),h["icon-size"].possiblyEvaluate(new or(M),l.canonical)]}const g=o.get("text-line-height")*hi,y=o.get("text-rotation-alignment")!=="viewport"&&o.get("symbol-placement")!=="point",x=o.get("text-keep-upright"),A=o.get("text-size");for(const E of l.bucket.features){const M=o.get("text-font").evaluate(E,{},l.canonical).join(","),P=A.evaluate(E,{},l.canonical),F=p.layoutTextSize.evaluate(E,{},l.canonical),O=p.layoutIconSize.evaluate(E,{},l.canonical),N={horizontal:{},vertical:void 0},z=E.text;let H,q=[0,0];if(z){const rt=z.toString(),pt=o.get("text-letter-spacing").evaluate(E,{},l.canonical)*hi,vt=bd(rt)?pt:0,Pt=o.get("text-anchor").evaluate(E,{},l.canonical),jt=kS(i,E,l.canonical);if(!jt){const Yt=o.get("text-radial-offset").evaluate(E,{},l.canonical);q=Yt?OS(Pt,[Yt*hi,ib]):o.get("text-offset").evaluate(E,{},l.canonical).map((Kt=>Kt*hi))}let Vt=y?"center":o.get("text-justify").evaluate(E,{},l.canonical);const $t=o.get("symbol-placement")==="point"?o.get("text-max-width").evaluate(E,{},l.canonical)*hi:1/0,se=()=>{l.bucket.allowVerticalPlacement&&yd(rt)&&(N.vertical=I_(z,l.glyphMap,l.glyphPositions,l.imagePositions,M,$t,g,Pt,"left",vt,q,f.at.vertical,!0,F,P))};if(!y&&jt){const Yt=new Set;if(Vt==="auto")for(let zt=0;zt<jt.values.length;zt+=2)Yt.add(sb(jt.values[zt]));else Yt.add(Vt);let Kt=!1;for(const zt of Yt)if(!N.horizontal[zt])if(Kt)N.horizontal[zt]=N.horizontal[0];else{const ye=I_(z,l.glyphMap,l.glyphPositions,l.imagePositions,M,$t,g,"center",zt,vt,q,f.at.horizontal,!1,F,P);ye&&(N.horizontal[zt]=ye,Kt=ye.positionedLines.length===1)}se()}else{Vt==="auto"&&(Vt=sb(Pt));const Yt=I_(z,l.glyphMap,l.glyphPositions,l.imagePositions,M,$t,g,Pt,Vt,vt,q,f.at.horizontal,!1,F,P);Yt&&(N.horizontal[Vt]=Yt),se(),yd(rt)&&y&&x&&(N.vertical=I_(z,l.glyphMap,l.glyphPositions,l.imagePositions,M,$t,g,Pt,Vt,vt,q,f.at.vertical,!1,F,P))}}let ct=!1;if(E.icon&&E.icon.name){const rt=l.imageMap[E.icon.name];rt&&(H=h9(l.imagePositions[E.icon.name],o.get("icon-offset").evaluate(E,{},l.canonical),o.get("icon-anchor").evaluate(E,{},l.canonical)),ct=!!rt.sdf,l.bucket.sdfIcons===void 0?l.bucket.sdfIcons=ct:l.bucket.sdfIcons!==ct&&Je("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(rt.pixelRatio!==l.bucket.pixelRatio||o.get("icon-rotate").constantOr(1)!==0)&&(l.bucket.iconsNeedLinear=!0))}const J=LS(N.horizontal)||N.vertical;l.bucket.iconsInText=!!J&&J.iconsInText,(J||H)&&W9(l.bucket,E,N,H,l.imageMap,p,F,O,q,ct,l.canonical,l.subdivisionGranularity)}l.showCollisionBoxes&&l.bucket.generateCollisionDebugBuffers()},f.cM=M0,f.cN=P0,f.cO=B0,f.cP=yE,f.cQ=F0,f.cR=Bu,f.cS=function(l,i,o,h,p,g){let y=SS(l,i,o,p,0);return y=SS(y,i,h,g,1),y},f.cT=class{constructor(l){this.maxEntries=l,this.map=new Map}get(l){const i=this.map.get(l);return i!==void 0&&(this.map.delete(l),this.map.set(l,i)),i}set(l,i){if(this.map.has(l))this.map.delete(l);else if(this.map.size>=this.maxEntries){const o=this.map.keys().next().value;this.map.delete(o)}this.map.set(l,i)}clear(){this.map.clear()}},f.cU=bE,f.cV=wS,f.cW=class{constructor(l){this._marks={start:[l.url,"start"].join("#"),end:[l.url,"end"].join("#"),measure:l.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let l=performance.getEntriesByName(this._marks.measure);return l.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),l=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),l}},f.cX=function(l,i,o,h,p){return c(this,void 0,void 0,(function*(){if(It())try{return yield Os(l,i,o,h,p)}catch{}return(function(g,y,x,A,E){const M=g.width,P=g.height;$r&&ws||($r=new OffscreenCanvas(M,P),ws=$r.getContext("2d",{willReadFrequently:!0})),$r.width=M,$r.height=P,ws.drawImage(g,0,0,M,P);const F=ws.getImageData(y,x,A,E);return ws.clearRect(0,0,M,P),F.data})(l,i,o,h,p)}))},f.cY=aE,f.cZ=C,f.c_=ou,f.ca=function(l,i,o){var h=i[0],p=i[1],g=i[2],y=o[3]*h+o[7]*p+o[11]*g+o[15];return l[0]=(o[0]*h+o[4]*p+o[8]*g+o[12])/(y=y||1),l[1]=(o[1]*h+o[5]*p+o[9]*g+o[13])/y,l[2]=(o[2]*h+o[6]*p+o[10]*g+o[14])/y,l},f.cb=class extends wu{},f.cc=class extends u{},f.cd=function(l,i){return l[0]===i[0]&&l[1]===i[1]&&l[2]===i[2]&&l[3]===i[3]&&l[4]===i[4]&&l[5]===i[5]&&l[6]===i[6]&&l[7]===i[7]&&l[8]===i[8]&&l[9]===i[9]&&l[10]===i[10]&&l[11]===i[11]&&l[12]===i[12]&&l[13]===i[13]&&l[14]===i[14]&&l[15]===i[15]},f.ce=function(l,i){var o=l[0],h=l[1],p=l[2],g=l[3],y=l[4],x=l[5],A=l[6],E=l[7],M=l[8],P=l[9],F=l[10],O=l[11],N=l[12],z=l[13],H=l[14],q=l[15],ct=i[0],J=i[1],rt=i[2],pt=i[3],vt=i[4],Pt=i[5],jt=i[6],Vt=i[7],$t=i[8],se=i[9],Yt=i[10],Kt=i[11],zt=i[12],ye=i[13],_e=i[14],me=i[15];return Math.abs(o-ct)<=St*Math.max(1,Math.abs(o),Math.abs(ct))&&Math.abs(h-J)<=St*Math.max(1,Math.abs(h),Math.abs(J))&&Math.abs(p-rt)<=St*Math.max(1,Math.abs(p),Math.abs(rt))&&Math.abs(g-pt)<=St*Math.max(1,Math.abs(g),Math.abs(pt))&&Math.abs(y-vt)<=St*Math.max(1,Math.abs(y),Math.abs(vt))&&Math.abs(x-Pt)<=St*Math.max(1,Math.abs(x),Math.abs(Pt))&&Math.abs(A-jt)<=St*Math.max(1,Math.abs(A),Math.abs(jt))&&Math.abs(E-Vt)<=St*Math.max(1,Math.abs(E),Math.abs(Vt))&&Math.abs(M-$t)<=St*Math.max(1,Math.abs(M),Math.abs($t))&&Math.abs(P-se)<=St*Math.max(1,Math.abs(P),Math.abs(se))&&Math.abs(F-Yt)<=St*Math.max(1,Math.abs(F),Math.abs(Yt))&&Math.abs(O-Kt)<=St*Math.max(1,Math.abs(O),Math.abs(Kt))&&Math.abs(N-zt)<=St*Math.max(1,Math.abs(N),Math.abs(zt))&&Math.abs(z-ye)<=St*Math.max(1,Math.abs(z),Math.abs(ye))&&Math.abs(H-_e)<=St*Math.max(1,Math.abs(H),Math.abs(_e))&&Math.abs(q-me)<=St*Math.max(1,Math.abs(q),Math.abs(me))},f.cf=function(l,i){return l[0]=i[0],l[1]=i[1],l[2]=i[2],l[3]=i[3],l[4]=i[4],l[5]=i[5],l[6]=i[6],l[7]=i[7],l[8]=i[8],l[9]=i[9],l[10]=i[10],l[11]=i[11],l[12]=i[12],l[13]=i[13],l[14]=i[14],l[15]=i[15],l},f.cg=l=>l.type==="symbol",f.ch=l=>l.type==="circle",f.ci=l=>l.type==="heatmap",f.cj=l=>l.type==="line",f.ck=l=>l.type==="fill",f.cl=l=>l.type==="fill-extrusion",f.cm=l=>l.type==="hillshade",f.cn=l=>l.type==="color-relief",f.co=l=>l.type==="background",f.cp=l=>l.type==="custom",f.cq=vs,f.cr=function(l,i,o){const h=lo(i.x-o.x,i.y-o.y),p=lo(l.x-o.x,l.y-o.y);var g,y;return Bi(Math.atan2(h[0]*p[1]-h[1]*p[0],(g=h)[0]*(y=p)[0]+g[1]*y[1]))},f.cs=hn,f.ct=function(l,i){return co[i]&&(l instanceof MouseEvent||l instanceof WheelEvent)},f.cu=function(l,i){return Po[i]&&"touches"in l},f.cv=function(l){return Po[l]||co[l]},f.cw=function(l,i,o){var h=i[0],p=i[1];return l[0]=o[0]*h+o[4]*p+o[12],l[1]=o[1]*h+o[5]*p+o[13],l},f.cx=function(l,i){const{x:o,y:h}=Hd.fromLngLat(i);return!(l<0||l>25||h<0||h>=1||o<0||o>=1)},f.cy=function(l,i){return l[0]=i[0],l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=i[1],l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=i[2],l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,l},f.cz=class extends xu{},f.d=G,f.d0=function(l,i){if(l==null)return!0;if(l.type==="Feature")return Gd(l,i)!=null;if(l.type==="FeatureCollection"){const o=new Set;for(const h of l.features){const p=Gd(h,i);if(p==null||o.has(p))return!1;o.add(p)}return!0}return!1},f.d1=function(l,i,o){var h,p,g,y;if(i.removeAll&&l.clear(),i.remove)for(const x of i.remove)l.delete(x);if(i.add)for(const x of i.add){const A=Gd(x,o);A!=null&&l.set(A,x)}if(i.update)for(const x of i.update){let A=l.get(x.id);if(A==null)continue;const E=!x.removeAllProperties&&(((h=x.removeProperties)===null||h===void 0?void 0:h.length)>0||((p=x.addOrUpdateProperties)===null||p===void 0?void 0:p.length)>0);if((x.newGeometry||x.removeAllProperties||E)&&(A=Object.assign({},A),l.set(x.id,A),E&&(A.properties=Object.assign({},A.properties))),x.newGeometry&&(A.geometry=x.newGeometry),x.removeAllProperties)A.properties={};else if(((g=x.removeProperties)===null||g===void 0?void 0:g.length)>0)for(const M of x.removeProperties)Object.prototype.hasOwnProperty.call(A.properties,M)&&delete A.properties[M];if(((y=x.addOrUpdateProperties)===null||y===void 0?void 0:y.length)>0)for(const{key:M,value:P}of x.addOrUpdateProperties)A.properties[M]=P}},f.d2=Ln,f.e=Rr,f.f=l=>c(void 0,void 0,void 0,(function*(){if(l.byteLength===0)return createImageBitmap(new ImageData(1,1));const i=new Blob([new Uint8Array(l)],{type:"image/png"});try{return createImageBitmap(i)}catch(o){throw new Error(`Could not load image because of ${o.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}})),f.g=Ns,f.h=l=>new Promise(((i,o)=>{const h=new Image;h.onload=()=>{i(h),URL.revokeObjectURL(h.src),h.onload=null,window.requestAnimationFrame((()=>{h.src=as}))},h.onerror=()=>o(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const p=new Blob([new Uint8Array(l)],{type:"image/png"});h.src=l.byteLength?URL.createObjectURL(p):as})),f.i=Gr,f.j=(l,i)=>yt(Rr(l,{type:"json"}),i),f.k=ft,f.l=ht,f.m=yt,f.n=(l,i)=>yt(Rr(l,{type:"arrayBuffer"}),i),f.o=function(l){return new F0(l).readFields(t9,[])},f.p=BE,f.q=function(l){return/[\u1100-\u11FF\u3000-\u30FF\u3131-\u318E\u31F0-\u321E\u3260-\u327E\u32D0-\u32FE\u3300-\u3357\u3400-\u4DBF\u4E00-\u9FFF\uA960-\uA97C\uAC00-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFF00-\uFFEF]|\uD81B[\uDFE4\uDFF2-\uDFF6]|[\uD81C-\uD822\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFF3\uDFF5-\uDFFB\uDFFD\uDFFE]|\uD82C[\uDC00-\uDD22\uDD32\uDD50-\uDD52\uDD55\uDD64-\uDD67\uDD70-\uDEFB]|\uD83C\uDE00|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(l))},f.r=Bd,f.s=dn,f.t=Xi,f.u=tt,f.v=Pl,f.w=Je,f.x=xd,f.y=h0,f.z=_u})),a("worker",["./shared"],(function(f){class c{constructor(G,$){this.keyCache={},G&&this.replace(G,$)}replace(G,$){this._layerConfigs={},this._layers={},this.update(G,[],$)}update(G,$,Z){for(const ft of G){this._layerConfigs[ft.id]=ft;const Tt=this._layers[ft.id]=f.bN(ft,Z);Tt._featureFilter=f.ae(Tt.filter,Z),this.keyCache[ft.id]&&delete this.keyCache[ft.id]}for(const ft of $)delete this.keyCache[ft],delete this._layerConfigs[ft],delete this._layers[ft];this.familiesBySource={};const ht=f.cG(Object.values(this._layerConfigs),this.keyCache);for(const ft of ht){const Tt=ft.map((ne=>this._layers[ne.id])),tt=Tt[0];if(tt.visibility==="none")continue;const xt=tt.source||"";let kt=this.familiesBySource[xt];kt||(kt=this.familiesBySource[xt]={});const Lt=tt.sourceLayer||"_geojsonTileLayer";let Ut=kt[Lt];Ut||(Ut=kt[Lt]=[]),Ut.push(Tt)}}}class T{constructor(G){const $={},Z=[];for(const tt in G){const xt=G[tt],kt=$[tt]={};for(const Lt in xt){const Ut=xt[+Lt];if(!Ut||Ut.bitmap.width===0||Ut.bitmap.height===0)continue;const ne={x:0,y:0,w:Ut.bitmap.width+2,h:Ut.bitmap.height+2};Z.push(ne),kt[Lt]={rect:ne,metrics:Ut.metrics}}}const{w:ht,h:ft}=f.p(Z),Tt=new f.r({width:ht||1,height:ft||1});for(const tt in G){const xt=G[tt];for(const kt in xt){const Lt=xt[+kt];if(!Lt||Lt.bitmap.width===0||Lt.bitmap.height===0)continue;const Ut=$[tt][kt].rect;f.r.copy(Lt.bitmap,Tt,{x:0,y:0},{x:Ut.x+1,y:Ut.y+1},Lt.bitmap)}}this.image=Tt,this.positions=$}}f.cH("GlyphAtlas",T);class C{constructor(G){this.tileID=new f.a0(G.tileID.overscaledZ,G.tileID.wrap,G.tileID.canonical.z,G.tileID.canonical.x,G.tileID.canonical.y),this.uid=G.uid,this.zoom=G.zoom,this.pixelRatio=G.pixelRatio,this.tileSize=G.tileSize,this.source=G.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=G.showCollisionBoxes,this.collectResourceTiming=!!G.collectResourceTiming,this.returnDependencies=!!G.returnDependencies,this.promoteId=G.promoteId,this.inFlightDependencies=[]}parse(G,$,Z,ht,ft){return f._(this,void 0,void 0,(function*(){this.status="parsing",this.data=G,this.collisionBoxArray=new f.ac;const Tt=new f.cI(Object.keys(G.layers).sort()),tt=new f.cJ(this.tileID,this.promoteId);tt.bucketLayerIDs=[];const xt={},kt={featureIndex:tt,iconDependencies:{},patternDependencies:{},glyphDependencies:{},dashDependencies:{},availableImages:Z,subdivisionGranularity:ft},Lt=$.familiesBySource[this.source];for(const ue in Lt){const ve=G.layers[ue];if(!ve)continue;ve.version===1&&f.w(`Vector tile source "${this.source}" layer "${ue}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Ai=Tt.encode(ue),Us=[];for(let mr=0;mr<ve.length;mr++){const we=ve.feature(mr),Hi=tt.getId(we,ue);Us.push({feature:we,id:Hi,index:mr,sourceLayerIndex:Ai})}for(const mr of Lt[ue]){const we=mr[0];we.source!==this.source&&f.w(`layer.source = ${we.source} does not equal this.source = ${this.source}`),we.isHidden(this.zoom,!0)||(R(mr,this.zoom,Z),(xt[we.id]=we.createBucket({index:tt.bucketLayerIDs.length,layers:mr,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Ai,sourceID:this.source})).populate(Us,kt,this.tileID.canonical),tt.bucketLayerIDs.push(mr.map((Hi=>Hi.id))))}}const Ut=f.bS(kt.glyphDependencies,(ue=>Object.keys(ue).map(Number)));this.inFlightDependencies.forEach((ue=>ue?.abort())),this.inFlightDependencies=[];let ne=Promise.resolve({});if(Object.keys(Ut).length){const ue=new AbortController;this.inFlightDependencies.push(ue),ne=ht.sendAsync({type:"GG",data:{stacks:Ut,source:this.source,tileID:this.tileID,type:"glyphs"}},ue)}const ge=Object.keys(kt.iconDependencies);let Ee=Promise.resolve({});if(ge.length){const ue=new AbortController;this.inFlightDependencies.push(ue),Ee=ht.sendAsync({type:"GI",data:{icons:ge,source:this.source,tileID:this.tileID,type:"icons"}},ue)}const Sr=Object.keys(kt.patternDependencies);let Pe=Promise.resolve({});if(Sr.length){const ue=new AbortController;this.inFlightDependencies.push(ue),Pe=ht.sendAsync({type:"GI",data:{icons:Sr,source:this.source,tileID:this.tileID,type:"patterns"}},ue)}const Ve=kt.dashDependencies;let rr=Promise.resolve({});if(Object.keys(Ve).length){const ue=new AbortController;this.inFlightDependencies.push(ue),rr=ht.sendAsync({type:"GDA",data:{dashes:Ve}},ue)}const[Wt,Qe,ir,kr]=yield Promise.all([ne,Ee,Pe,rr]),sr=new T(Wt),Xt=new f.cK(Qe,ir);for(const ue in xt){const ve=xt[ue];ve instanceof f.ad?(R(ve.layers,this.zoom,Z),f.cL({bucket:ve,glyphMap:Wt,glyphPositions:sr.positions,imageMap:Qe,imagePositions:Xt.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:kt.subdivisionGranularity})):ve.hasDependencies&&(ve instanceof f.cM||ve instanceof f.cN||ve instanceof f.cO)&&(R(ve.layers,this.zoom,Z),ve.addFeatures(kt,this.tileID.canonical,Xt.patternPositions,kr))}return this.status="done",{buckets:Object.values(xt).filter((ue=>!ue.isEmpty())),featureIndex:tt,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:sr.image,imageAtlas:Xt,dashPositions:kr,glyphMap:this.returnDependencies?Wt:null,iconMap:this.returnDependencies?Qe:null,glyphPositions:this.returnDependencies?sr.positions:null}}))}}function R(yt,G,$){const Z=new f.G(G);for(const ht of yt)ht.recalculate(Z,$)}class L extends f.cR{constructor(G,$){super(new f.cQ,0,$,[],[]),this.feature=G,this.type=G.type,this.properties=G.tags?G.tags:{},"id"in G&&(typeof G.id=="string"?this.id=parseInt(G.id,10):typeof G.id!="number"||isNaN(G.id)||(this.id=G.id))}loadGeometry(){const G=[],$=this.feature.type===1?[this.feature.geometry]:this.feature.geometry;for(const Z of $){const ht=[];for(const ft of Z)ht.push(new f.P(ft[0],ft[1]));G.push(ht)}return G}}class V extends f.cP{constructor(G,$){super(new f.cQ),this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.version=$?$.version:1,this.extent=$?$.extent:4096,this.length=G.length,this.features=G}feature(G){return new L(this.features[G],this.extent)}}function X(yt,G){G.writeVarintField(15,yt.version||1),G.writeStringField(1,yt.name||""),G.writeVarintField(5,yt.extent||4096);const $={keys:[],values:[],keycache:{},valuecache:{}};for(let ft=0;ft<yt.length;ft++)$.feature=yt.feature(ft),G.writeMessage(2,at,$);const Z=$.keys;for(const ft of Z)G.writeStringField(3,ft);const ht=$.values;for(const ft of ht)G.writeMessage(4,Ct,ft)}function at(yt,G){if(!yt.feature)return;const $=yt.feature;$.id!==void 0&&G.writeVarintField(1,$.id),G.writeMessage(2,nt,yt),G.writeVarintField(3,$.type),G.writeMessage(4,St,$)}function nt(yt,G){for(const $ in yt.feature?.properties){let Z=yt.feature.properties[$],ht=yt.keycache[$];if(Z===null)continue;ht===void 0&&(yt.keys.push($),ht=yt.keys.length-1,yt.keycache[$]=ht),G.writeVarint(ht),typeof Z!="string"&&typeof Z!="boolean"&&typeof Z!="number"&&(Z=JSON.stringify(Z));const ft=typeof Z+":"+Z;let Tt=yt.valuecache[ft];Tt===void 0&&(yt.values.push(Z),Tt=yt.values.length-1,yt.valuecache[ft]=Tt),G.writeVarint(Tt)}}function K(yt,G){return(G<<3)+(7&yt)}function It(yt){return yt<<1^yt>>31}function St(yt,G){const $=yt.loadGeometry(),Z=yt.type;let ht=0,ft=0;for(const Tt of $){let tt=1;Z===1&&(tt=Tt.length),G.writeVarint(K(1,tt));const xt=Z===3?Tt.length-1:Tt.length;for(let kt=0;kt<xt;kt++){kt===1&&Z!==1&&G.writeVarint(K(2,xt-1));const Lt=Tt[kt].x-ht,Ut=Tt[kt].y-ft;G.writeVarint(It(Lt)),G.writeVarint(It(Ut)),ht+=Lt,ft+=Ut}yt.type===3&&G.writeVarint(K(7,1))}}function Ct(yt,G){const $=typeof yt;$==="string"?G.writeStringField(1,yt):$==="boolean"?G.writeBooleanField(7,yt):$==="number"&&(yt%1!=0?G.writeDoubleField(3,yt):yt<0?G.writeSVarintField(6,yt):G.writeVarintField(5,yt))}class Ht extends f.cR{constructor(G,$,Z,ht,ft){super(new f.cQ,0,ft,[],[]),this.type=G,this.properties=Z||{},this.extent=ft,this.pointsArray=$,this.id=ht}loadGeometry(){return this.pointsArray.map((G=>G.map(($=>new f.P($.x,$.y)))))}}class Qt extends f.cP{constructor(G,$,Z){super(new f.cQ),this.version=2,this._myFeatures=G,this.name=$,this.length=G.length,this.extent=Z}feature(G){return this._myFeatures[G]}}class ee{constructor(){this.layers={}}addLayer(G){this.layers[G.name]=G}}function ae(yt){let G=(function($){const Z=new f.cQ;return(function(ht,ft){for(const Tt in ht.layers)ft.writeMessage(3,X,ht.layers[Tt])})($,Z),Z.finish()})(yt);return G.byteOffset===0&&G.byteLength===G.buffer.byteLength||(G=new Uint8Array(G)),{vectorTile:yt,rawData:G.buffer}}function be(yt,G,$){const{extent:Z}=yt,ht=Math.pow(2,$.z-G.z),ft=($.x-G.x*ht)*Z,Tt=($.y-G.y*ht)*Z,tt=[];for(let xt=0;xt<yt.length;xt++){const kt=yt.feature(xt);let Lt=kt.loadGeometry();for(const ne of Lt)for(const ge of ne)ge.x=ge.x*ht-ft,ge.y=ge.y*ht-Tt;const Ut=128;Lt=f.cS(Lt,kt.type,-Ut,-Ut,Z+Ut,Z+Ut),Lt.length!==0&&tt.push(new Ht(kt.type,Lt,kt.properties,kt.id,Z))}return new Qt(tt,yt.name,Z)}class ie{constructor(G,$,Z){this.actor=G,this.layerIndex=$,this.availableImages=Z,this.fetching={},this.loading={},this.loaded={},this.overzoomedTileResultCache=new f.cT(1e3)}loadVectorTile(G,$){return f._(this,void 0,void 0,(function*(){const Z=yield f.n(G.request,$);try{return{vectorTile:G.encoding!=="mlt"?new f.cU(new f.cQ(Z.data)):new f.cV(Z.data),rawData:Z.data,cacheControl:Z.cacheControl,expires:Z.expires}}catch(ht){const ft=new Uint8Array(Z.data);let Tt=`Unable to parse the tile at ${G.request.url}, `;throw Tt+=ft[0]===31&&ft[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${ht.message}`,new Error(Tt)}}))}loadTile(G){return f._(this,void 0,void 0,(function*(){const{uid:$,overzoomParameters:Z}=G;Z&&(G.request=Z.overzoomRequest);const ht=!!(G&&G.request&&G.request.collectResourceTiming)&&new f.cW(G.request),ft=new C(G);this.loading[$]=ft;const Tt=new AbortController;ft.abort=Tt;try{const tt=yield this.loadVectorTile(G,Tt);if(delete this.loading[$],!tt)return null;if(Z){const ne=this._getOverzoomTile(G,tt.vectorTile);tt.rawData=ne.rawData,tt.vectorTile=ne.vectorTile}const xt=tt.rawData,kt={};tt.expires&&(kt.expires=tt.expires),tt.cacheControl&&(kt.cacheControl=tt.cacheControl);const Lt={};if(ht){const ne=ht.finish();ne&&(Lt.resourceTiming=JSON.parse(JSON.stringify(ne)))}ft.vectorTile=tt.vectorTile;const Ut=ft.parse(tt.vectorTile,this.layerIndex,this.availableImages,this.actor,G.subdivisionGranularity);this.loaded[$]=ft,this.fetching[$]={rawTileData:xt,cacheControl:kt,resourceTiming:Lt};try{const ne=yield Ut;return f.e({rawTileData:xt.slice(0),encoding:G.encoding},ne,kt,Lt)}finally{delete this.fetching[$]}}catch(tt){throw delete this.loading[$],ft.status="done",this.loaded[$]=ft,tt}}))}_getOverzoomTile(G,$){const{tileID:Z,source:ht,overzoomParameters:ft}=G,{maxZoomTileID:Tt}=ft,tt=`${Tt.key}_${Z.key}`,xt=this.overzoomedTileResultCache.get(tt);if(xt)return xt;const kt=new ee,Lt=this.layerIndex.familiesBySource[ht];for(const ne in Lt){const ge=$.layers[ne];if(!ge)continue;const Ee=be(ge,Tt,Z.canonical);Ee.length>0&&kt.addLayer(Ee)}const Ut=ae(kt);return this.overzoomedTileResultCache.set(tt,Ut),Ut}reloadTile(G){return f._(this,void 0,void 0,(function*(){const $=G.uid;if(!this.loaded||!this.loaded[$])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const Z=this.loaded[$];if(Z.showCollisionBoxes=G.showCollisionBoxes,Z.status==="parsing"){const ht=yield Z.parse(Z.vectorTile,this.layerIndex,this.availableImages,this.actor,G.subdivisionGranularity);let ft;if(this.fetching[$]){const{rawTileData:Tt,cacheControl:tt,resourceTiming:xt}=this.fetching[$];delete this.fetching[$],ft=f.e({rawTileData:Tt.slice(0),encoding:G.encoding},ht,tt,xt)}else ft=ht;return ft}if(Z.status==="done"&&Z.vectorTile)return Z.parse(Z.vectorTile,this.layerIndex,this.availableImages,this.actor,G.subdivisionGranularity)}))}abortTile(G){return f._(this,void 0,void 0,(function*(){const $=this.loading,Z=G.uid;$&&$[Z]&&$[Z].abort&&($[Z].abort.abort(),delete $[Z])}))}removeTile(G){return f._(this,void 0,void 0,(function*(){this.loaded&&this.loaded[G.uid]&&delete this.loaded[G.uid]}))}}class le{constructor(){this.loaded={}}loadTile(G){return f._(this,void 0,void 0,(function*(){const{uid:$,encoding:Z,rawImageData:ht,redFactor:ft,greenFactor:Tt,blueFactor:tt,baseShift:xt}=G,kt=ht.width+2,Lt=ht.height+2,Ut=f.b(ht)?new f.R({width:kt,height:Lt},yield f.cX(ht,-1,-1,kt,Lt)):ht,ne=new f.cY($,Ut,Z,ft,Tt,tt,xt);return this.loaded=this.loaded||{},this.loaded[$]=ne,ne}))}removeTile(G){const $=this.loaded,Z=G.uid;$&&$[Z]&&delete $[Z]}}var Ae,Fe,ze=(function(){if(Fe)return Ae;function yt($,Z){if($.length!==0){G($[0],Z);for(var ht=1;ht<$.length;ht++)G($[ht],!Z)}}function G($,Z){for(var ht=0,ft=0,Tt=0,tt=$.length,xt=tt-1;Tt<tt;xt=Tt++){var kt=($[Tt][0]-$[xt][0])*($[xt][1]+$[Tt][1]),Lt=ht+kt;ft+=Math.abs(ht)>=Math.abs(kt)?ht-Lt+kt:kt-Lt+ht,ht=Lt}ht+ft>=0!=!!Z&&$.reverse()}return Fe=1,Ae=function $(Z,ht){var ft,Tt=Z&&Z.type;if(Tt==="FeatureCollection")for(ft=0;ft<Z.features.length;ft++)$(Z.features[ft],ht);else if(Tt==="GeometryCollection")for(ft=0;ft<Z.geometries.length;ft++)$(Z.geometries[ft],ht);else if(Tt==="Feature")$(Z.geometry,ht);else if(Tt==="Polygon")yt(Z.coordinates,ht);else if(Tt==="MultiPolygon")for(ft=0;ft<Z.coordinates.length;ft++)yt(Z.coordinates[ft],ht);return Z}})(),Ce=f.cZ(ze);const zr={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:yt=>yt},ns=Math.fround||(Hr=new Float32Array(1),yt=>(Hr[0]=+yt,Hr[0]));var Hr;class lo{constructor(G){this.options=Object.assign(Object.create(zr),G),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(G){const{log:$,minZoom:Z,maxZoom:ht}=this.options;$&&console.time("total time");const ft=`prepare ${G.length} points`;$&&console.time(ft),this.points=G;const Tt=[];for(let xt=0;xt<G.length;xt++){const kt=G[xt];if(!kt.geometry)continue;const[Lt,Ut]=kt.geometry.coordinates,ne=ns(xi(Lt)),ge=ns(li(Ut));Tt.push(ne,ge,1/0,xt,-1,1),this.options.reduce&&Tt.push(0)}let tt=this.trees[ht+1]=this._createTree(Tt);$&&console.timeEnd(ft);for(let xt=ht;xt>=Z;xt--){const kt=+Date.now();tt=this.trees[xt]=this._createTree(this._cluster(tt,xt)),$&&console.log("z%d: %d clusters in %dms",xt,tt.numItems,+Date.now()-kt)}return $&&console.timeEnd("total time"),this}getClusters(G,$){let Z=((G[0]+180)%360+360)%360-180;const ht=Math.max(-90,Math.min(90,G[1]));let ft=G[2]===180?180:((G[2]+180)%360+360)%360-180;const Tt=Math.max(-90,Math.min(90,G[3]));if(G[2]-G[0]>=360)Z=-180,ft=180;else if(Z>ft){const Ut=this.getClusters([Z,ht,180,Tt],$),ne=this.getClusters([-180,ht,ft,Tt],$);return Ut.concat(ne)}const tt=this.trees[this._limitZoom($)],xt=tt.range(xi(Z),li(Tt),xi(ft),li(ht)),kt=tt.data,Lt=[];for(const Ut of xt){const ne=this.stride*Ut;Lt.push(kt[ne+5]>1?Le(kt,ne,this.clusterProps):this.points[kt[ne+3]])}return Lt}getChildren(G){const $=this._getOriginId(G),Z=this._getOriginZoom(G),ht="No cluster with the specified id.",ft=this.trees[Z];if(!ft)throw new Error(ht);const Tt=ft.data;if($*this.stride>=Tt.length)throw new Error(ht);const tt=this.options.radius/(this.options.extent*Math.pow(2,Z-1)),xt=ft.within(Tt[$*this.stride],Tt[$*this.stride+1],tt),kt=[];for(const Lt of xt){const Ut=Lt*this.stride;Tt[Ut+4]===G&&kt.push(Tt[Ut+5]>1?Le(Tt,Ut,this.clusterProps):this.points[Tt[Ut+3]])}if(kt.length===0)throw new Error(ht);return kt}getLeaves(G,$,Z){const ht=[];return this._appendLeaves(ht,G,$=$||10,Z=Z||0,0),ht}getTile(G,$,Z){const ht=this.trees[this._limitZoom(G)],ft=Math.pow(2,G),{extent:Tt,radius:tt}=this.options,xt=tt/Tt,kt=(Z-xt)/ft,Lt=(Z+1+xt)/ft,Ut={features:[]};return this._addTileFeatures(ht.range(($-xt)/ft,kt,($+1+xt)/ft,Lt),ht.data,$,Z,ft,Ut),$===0&&this._addTileFeatures(ht.range(1-xt/ft,kt,1,Lt),ht.data,ft,Z,ft,Ut),$===ft-1&&this._addTileFeatures(ht.range(0,kt,xt/ft,Lt),ht.data,-1,Z,ft,Ut),Ut.features.length?Ut:null}getClusterExpansionZoom(G){let $=this._getOriginZoom(G)-1;for(;$<=this.options.maxZoom;){const Z=this.getChildren(G);if($++,Z.length!==1)break;G=Z[0].properties.cluster_id}return $}_appendLeaves(G,$,Z,ht,ft){const Tt=this.getChildren($);for(const tt of Tt){const xt=tt.properties;if(xt&&xt.cluster?ft+xt.point_count<=ht?ft+=xt.point_count:ft=this._appendLeaves(G,xt.cluster_id,Z,ht,ft):ft<ht?ft++:G.push(tt),G.length===Z)break}return ft}_createTree(G){const $=new f.aN(G.length/this.stride|0,this.options.nodeSize,Float32Array);for(let Z=0;Z<G.length;Z+=this.stride)$.add(G[Z],G[Z+1]);return $.finish(),$.data=G,$}_addTileFeatures(G,$,Z,ht,ft,Tt){for(const tt of G){const xt=tt*this.stride,kt=$[xt+5]>1;let Lt,Ut,ne;if(kt)Lt=vi($,xt,this.clusterProps),Ut=$[xt],ne=$[xt+1];else{const Sr=this.points[$[xt+3]];Lt=Sr.properties;const[Pe,Ve]=Sr.geometry.coordinates;Ut=xi(Pe),ne=li(Ve)}const ge={type:1,geometry:[[Math.round(this.options.extent*(Ut*ft-Z)),Math.round(this.options.extent*(ne*ft-ht))]],tags:Lt};let Ee;Ee=kt||this.options.generateId?$[xt+3]:this.points[$[xt+3]].id,Ee!==void 0&&(ge.id=Ee),Tt.features.push(ge)}}_limitZoom(G){return Math.max(this.options.minZoom,Math.min(Math.floor(+G),this.options.maxZoom+1))}_cluster(G,$){const{radius:Z,extent:ht,reduce:ft,minPoints:Tt}=this.options,tt=Z/(ht*Math.pow(2,$)),xt=G.data,kt=[],Lt=this.stride;for(let Ut=0;Ut<xt.length;Ut+=Lt){if(xt[Ut+2]<=$)continue;xt[Ut+2]=$;const ne=xt[Ut],ge=xt[Ut+1],Ee=G.within(xt[Ut],xt[Ut+1],tt),Sr=xt[Ut+5];let Pe=Sr;for(const Ve of Ee){const rr=Ve*Lt;xt[rr+2]>$&&(Pe+=xt[rr+5])}if(Pe>Sr&&Pe>=Tt){let Ve,rr=ne*Sr,Wt=ge*Sr,Qe=-1;const ir=(Ut/Lt<<5)+($+1)+this.points.length;for(const kr of Ee){const sr=kr*Lt;if(xt[sr+2]<=$)continue;xt[sr+2]=$;const Xt=xt[sr+5];rr+=xt[sr]*Xt,Wt+=xt[sr+1]*Xt,xt[sr+4]=ir,ft&&(Ve||(Ve=this._map(xt,Ut,!0),Qe=this.clusterProps.length,this.clusterProps.push(Ve)),ft(Ve,this._map(xt,sr)))}xt[Ut+4]=ir,kt.push(rr/Pe,Wt/Pe,1/0,ir,-1,Pe),ft&&kt.push(Qe)}else{for(let Ve=0;Ve<Lt;Ve++)kt.push(xt[Ut+Ve]);if(Pe>1)for(const Ve of Ee){const rr=Ve*Lt;if(!(xt[rr+2]<=$)){xt[rr+2]=$;for(let Wt=0;Wt<Lt;Wt++)kt.push(xt[rr+Wt])}}}}return kt}_getOriginId(G){return G-this.points.length>>5}_getOriginZoom(G){return(G-this.points.length)%32}_map(G,$,Z){if(G[$+5]>1){const Tt=this.clusterProps[G[$+6]];return Z?Object.assign({},Tt):Tt}const ht=this.points[G[$+3]].properties,ft=this.options.map(ht);return Z&&ft===ht?Object.assign({},ft):ft}}function Le(yt,G,$){return{type:"Feature",id:yt[G+3],properties:vi(yt,G,$),geometry:{type:"Point",coordinates:[(Z=yt[G],360*(Z-.5)),_a(yt[G+1])]}};var Z}function vi(yt,G,$){const Z=yt[G+5],ht=Z>=1e4?`${Math.round(Z/1e3)}k`:Z>=1e3?Math.round(Z/100)/10+"k":Z,ft=yt[G+6],Tt=ft===-1?{}:Object.assign({},$[ft]);return Object.assign(Tt,{cluster:!0,cluster_id:yt[G+3],point_count:Z,point_count_abbreviated:ht})}function xi(yt){return yt/360+.5}function li(yt){const G=Math.sin(yt*Math.PI/180),$=.5-.25*Math.log((1+G)/(1-G))/Math.PI;return $<0?0:$>1?1:$}function _a(yt){const G=(180-360*yt)*Math.PI/180;return 360*Math.atan(Math.exp(G))/Math.PI-90}function vs(yt,G,$,Z){let ht=Z;const ft=G+($-G>>1);let Tt,tt=$-G;const xt=yt[G],kt=yt[G+1],Lt=yt[$],Ut=yt[$+1];for(let ne=G+3;ne<$;ne+=3){const ge=hn(yt[ne],yt[ne+1],xt,kt,Lt,Ut);if(ge>ht)Tt=ne,ht=ge;else if(ge===ht){const Ee=Math.abs(ne-ft);Ee<tt&&(Tt=ne,tt=Ee)}}ht>Z&&(Tt-G>3&&vs(yt,G,Tt,Z),yt[Tt+2]=ht,$-Tt>3&&vs(yt,Tt,$,Z))}function hn(yt,G,$,Z,ht,ft){let Tt=ht-$,tt=ft-Z;if(Tt!==0||tt!==0){const xt=((yt-$)*Tt+(G-Z)*tt)/(Tt*Tt+tt*tt);xt>1?($=ht,Z=ft):xt>0&&($+=Tt*xt,Z+=tt*xt)}return Tt=yt-$,tt=G-Z,Tt*Tt+tt*tt}function wi(yt,G,$,Z){const ht={id:yt??null,type:G,geometry:$,tags:Z,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(G==="Point"||G==="MultiPoint"||G==="LineString")ur(ht,$);else if(G==="Polygon")ur(ht,$[0]);else if(G==="MultiLineString")for(const ft of $)ur(ht,ft);else if(G==="MultiPolygon")for(const ft of $)ur(ht,ft[0]);return ht}function ur(yt,G){for(let $=0;$<G.length;$+=3)yt.minX=Math.min(yt.minX,G[$]),yt.minY=Math.min(yt.minY,G[$+1]),yt.maxX=Math.max(yt.maxX,G[$]),yt.maxY=Math.max(yt.maxY,G[$+1])}function Rr(yt,G,$,Z){if(!G.geometry)return;const ht=G.geometry.coordinates;if(ht&&ht.length===0)return;const ft=G.geometry.type,Tt=Math.pow($.tolerance/((1<<$.maxZoom)*$.extent),2);let tt=[],xt=G.id;if($.promoteId?xt=G.properties[$.promoteId]:$.generateId&&(xt=Z||0),ft==="Point")hr(ht,tt);else if(ft==="MultiPoint")for(const kt of ht)hr(kt,tt);else if(ft==="LineString")Or(ht,tt,Tt,!1);else if(ft==="MultiLineString"){if($.lineMetrics){for(const kt of ht)tt=[],Or(kt,tt,Tt,!1),yt.push(wi(xt,"LineString",tt,G.properties));return}xs(ht,tt,Tt,!1)}else if(ft==="Polygon")xs(ht,tt,Tt,!0);else{if(ft!=="MultiPolygon"){if(ft==="GeometryCollection"){for(const kt of G.geometry.geometries)Rr(yt,{id:xt,geometry:kt,properties:G.properties},$,Z);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const kt of ht){const Lt=[];xs(kt,Lt,Tt,!0),tt.push(Lt)}}yt.push(wi(xt,ft,tt,G.properties))}function hr(yt,G){G.push(ci(yt[0]),Fs(yt[1]),0)}function Or(yt,G,$,Z){let ht,ft,Tt=0;for(let xt=0;xt<yt.length;xt++){const kt=ci(yt[xt][0]),Lt=Fs(yt[xt][1]);G.push(kt,Lt,0),xt>0&&(Tt+=Z?(ht*Lt-kt*ft)/2:Math.sqrt(Math.pow(kt-ht,2)+Math.pow(Lt-ft,2))),ht=kt,ft=Lt}const tt=G.length-3;G[2]=1,vs(G,0,tt,$),G[tt+2]=1,G.size=Math.abs(Tt),G.start=0,G.end=G.size}function xs(yt,G,$,Z){for(let ht=0;ht<yt.length;ht++){const ft=[];Or(yt[ht],ft,$,Z),G.push(ft)}}function ci(yt){return yt/360+.5}function Fs(yt){const G=Math.sin(yt*Math.PI/180),$=.5-.25*Math.log((1+G)/(1-G))/Math.PI;return $<0?0:$>1?1:$}function Je(yt,G,$,Z,ht,ft,Tt,tt){if(Z/=G,ft>=($/=G)&&Tt<Z)return yt;if(Tt<$||ft>=Z)return null;const xt=[];for(const kt of yt){const Lt=kt.geometry;let Ut=kt.type;const ne=ht===0?kt.minX:kt.minY,ge=ht===0?kt.maxX:kt.maxY;if(ne>=$&&ge<Z){xt.push(kt);continue}if(ge<$||ne>=Z)continue;let Ee=[];if(Ut==="Point"||Ut==="MultiPoint")Ti(Lt,Ee,$,Z,ht);else if(Ut==="LineString")Gr(Lt,Ee,$,Z,ht,!1,tt.lineMetrics);else if(Ut==="MultiLineString")os(Lt,Ee,$,Z,ht,!1);else if(Ut==="Polygon")os(Lt,Ee,$,Z,ht,!0);else if(Ut==="MultiPolygon")for(const Sr of Lt){const Pe=[];os(Sr,Pe,$,Z,ht,!0),Pe.length&&Ee.push(Pe)}if(Ee.length){if(tt.lineMetrics&&Ut==="LineString"){for(const Sr of Ee)xt.push(wi(kt.id,Ut,Sr,kt.tags));continue}Ut!=="LineString"&&Ut!=="MultiLineString"||(Ee.length===1?(Ut="LineString",Ee=Ee[0]):Ut="MultiLineString"),Ut!=="Point"&&Ut!=="MultiPoint"||(Ut=Ee.length===3?"Point":"MultiPoint"),xt.push(wi(kt.id,Ut,Ee,kt.tags))}}return xt.length?xt:null}function Ti(yt,G,$,Z,ht){for(let ft=0;ft<yt.length;ft+=3){const Tt=yt[ft+ht];Tt>=$&&Tt<=Z&&as(G,yt[ft],yt[ft+1],yt[ft+2])}}function Gr(yt,G,$,Z,ht,ft,Tt){let tt=We(yt);const xt=ht===0?Os:$r;let kt,Lt,Ut=yt.start;for(let Pe=0;Pe<yt.length-3;Pe+=3){const Ve=yt[Pe],rr=yt[Pe+1],Wt=yt[Pe+2],Qe=yt[Pe+3],ir=yt[Pe+4],kr=ht===0?Ve:rr,sr=ht===0?Qe:ir;let Xt=!1;Tt&&(kt=Math.sqrt(Math.pow(Ve-Qe,2)+Math.pow(rr-ir,2))),kr<$?sr>$&&(Lt=xt(tt,Ve,rr,Qe,ir,$),Tt&&(tt.start=Ut+kt*Lt)):kr>Z?sr<Z&&(Lt=xt(tt,Ve,rr,Qe,ir,Z),Tt&&(tt.start=Ut+kt*Lt)):as(tt,Ve,rr,Wt),sr<$&&kr>=$&&(Lt=xt(tt,Ve,rr,Qe,ir,$),Xt=!0),sr>Z&&kr<=Z&&(Lt=xt(tt,Ve,rr,Qe,ir,Z),Xt=!0),!ft&&Xt&&(Tt&&(tt.end=Ut+kt*Lt),G.push(tt),tt=We(yt)),Tt&&(Ut+=kt)}let ne=yt.length-3;const ge=yt[ne],Ee=yt[ne+1],Sr=ht===0?ge:Ee;Sr>=$&&Sr<=Z&&as(tt,ge,Ee,yt[ne+2]),ne=tt.length-3,ft&&ne>=3&&(tt[ne]!==tt[0]||tt[ne+1]!==tt[1])&&as(tt,tt[0],tt[1],tt[2]),tt.length&&G.push(tt)}function We(yt){const G=[];return G.size=yt.size,G.start=yt.start,G.end=yt.end,G}function os(yt,G,$,Z,ht,ft){for(const Tt of yt)Gr(Tt,G,$,Z,ht,ft,!1)}function as(yt,G,$,Z){yt.push(G,$,Z)}function Os(yt,G,$,Z,ht,ft){const Tt=(ft-G)/(Z-G);return as(yt,ft,$+(ht-$)*Tt,1),Tt}function $r(yt,G,$,Z,ht,ft){const Tt=(ft-$)/(ht-$);return as(yt,G+(Z-G)*Tt,ft,1),Tt}function ws(yt,G){const $=[];for(let Z=0;Z<yt.length;Z++){const ht=yt[Z],ft=ht.type;let Tt;if(ft==="Point"||ft==="MultiPoint"||ft==="LineString")Tt=dn(ht.geometry,G);else if(ft==="MultiLineString"||ft==="Polygon"){Tt=[];for(const tt of ht.geometry)Tt.push(dn(tt,G))}else if(ft==="MultiPolygon"){Tt=[];for(const tt of ht.geometry){const xt=[];for(const kt of tt)xt.push(dn(kt,G));Tt.push(xt)}}$.push(wi(ht.id,ft,Tt,ht.tags))}return $}function dn(yt,G){const $=[];$.size=yt.size,yt.start!==void 0&&($.start=yt.start,$.end=yt.end);for(let Z=0;Z<yt.length;Z+=3)$.push(yt[Z]+G,yt[Z+1],yt[Z+2]);return $}function Dn(yt,G){if(yt.transformed)return yt;const $=1<<yt.z,Z=yt.x,ht=yt.y;for(const ft of yt.features){const Tt=ft.geometry,tt=ft.type;if(ft.geometry=[],tt===1)for(let xt=0;xt<Tt.length;xt+=2)ft.geometry.push(Bi(Tt[xt],Tt[xt+1],G,$,Z,ht));else for(let xt=0;xt<Tt.length;xt++){const kt=[];for(let Lt=0;Lt<Tt[xt].length;Lt+=2)kt.push(Bi(Tt[xt][Lt],Tt[xt][Lt+1],G,$,Z,ht));ft.geometry.push(kt)}}return yt.transformed=!0,yt}function Bi(yt,G,$,Z,ht,ft){return[Math.round($*(yt*Z-ht)),Math.round($*(G*Z-ft))]}function Po(yt,G,$,Z,ht){const ft=G===ht.maxZoom?0:ht.tolerance/((1<<G)*ht.extent),Tt={features:[],numPoints:0,numSimplified:0,numFeatures:yt.length,source:null,x:$,y:Z,z:G,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const tt of yt)co(Tt,tt,ft,ht);return Tt}function co(yt,G,$,Z){const ht=G.geometry,ft=G.type,Tt=[];if(yt.minX=Math.min(yt.minX,G.minX),yt.minY=Math.min(yt.minY,G.minY),yt.maxX=Math.max(yt.maxX,G.maxX),yt.maxY=Math.max(yt.maxY,G.maxY),ft==="Point"||ft==="MultiPoint")for(let tt=0;tt<ht.length;tt+=3)Tt.push(ht[tt],ht[tt+1]),yt.numPoints++,yt.numSimplified++;else if(ft==="LineString")fn(Tt,ht,yt,$,!1,!1);else if(ft==="MultiLineString"||ft==="Polygon")for(let tt=0;tt<ht.length;tt++)fn(Tt,ht[tt],yt,$,ft==="Polygon",tt===0);else if(ft==="MultiPolygon")for(let tt=0;tt<ht.length;tt++){const xt=ht[tt];for(let kt=0;kt<xt.length;kt++)fn(Tt,xt[kt],yt,$,!0,kt===0)}if(Tt.length){let tt=G.tags||null;if(ft==="LineString"&&Z.lineMetrics){tt={};for(const kt in G.tags)tt[kt]=G.tags[kt];tt.mapbox_clip_start=ht.start/ht.size,tt.mapbox_clip_end=ht.end/ht.size}const xt={geometry:Tt,type:ft==="Polygon"||ft==="MultiPolygon"?3:ft==="LineString"||ft==="MultiLineString"?2:1,tags:tt};G.id!==null&&(xt.id=G.id),yt.features.push(xt)}}function fn(yt,G,$,Z,ht,ft){const Tt=Z*Z;if(Z>0&&G.size<(ht?Tt:Z))return void($.numPoints+=G.length/3);const tt=[];for(let xt=0;xt<G.length;xt+=3)(Z===0||G[xt+2]>Tt)&&($.numSimplified++,tt.push(G[xt],G[xt+1])),$.numPoints++;ht&&(function(xt,kt){let Lt=0;for(let Ut=0,ne=xt.length,ge=ne-2;Ut<ne;ge=Ut,Ut+=2)Lt+=(xt[Ut]-xt[ge])*(xt[Ut+1]+xt[ge+1]);if(Lt>0===kt)for(let Ut=0,ne=xt.length;Ut<ne/2;Ut+=2){const ge=xt[Ut],Ee=xt[Ut+1];xt[Ut]=xt[ne-2-Ut],xt[Ut+1]=xt[ne-1-Ut],xt[ne-2-Ut]=ge,xt[ne-1-Ut]=Ee}})(tt,ft),yt.push(tt)}const Fn={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class ks{constructor(G,$){const Z=($=this.options=(function(ft,Tt){for(const tt in Tt)ft[tt]=Tt[tt];return ft})(Object.create(Fn),$)).debug;if(Z&&console.time("preprocess data"),$.maxZoom<0||$.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if($.promoteId&&$.generateId)throw new Error("promoteId and generateId cannot be used together.");let ht=(function(ft,Tt){const tt=[];if(ft.type==="FeatureCollection")for(let xt=0;xt<ft.features.length;xt++)Rr(tt,ft.features[xt],Tt,xt);else Rr(tt,ft.type==="Feature"?ft:{geometry:ft},Tt);return tt})(G,$);this.tiles={},this.tileCoords=[],Z&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",$.indexMaxZoom,$.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ht=(function(ft,Tt){const tt=Tt.buffer/Tt.extent;let xt=ft;const kt=Je(ft,1,-1-tt,tt,0,-1,2,Tt),Lt=Je(ft,1,1-tt,2+tt,0,-1,2,Tt);return(kt||Lt)&&(xt=Je(ft,1,-tt,1+tt,0,-1,2,Tt)||[],kt&&(xt=ws(kt,1).concat(xt)),Lt&&(xt=xt.concat(ws(Lt,-1)))),xt})(ht,$),ht.length&&this.splitTile(ht,0,0,0),Z&&(ht.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(G,$,Z,ht,ft,Tt,tt){const xt=[G,$,Z,ht],kt=this.options,Lt=kt.debug;for(;xt.length;){ht=xt.pop(),Z=xt.pop(),$=xt.pop(),G=xt.pop();const Ut=1<<$,ne=Ns($,Z,ht);let ge=this.tiles[ne];if(!ge&&(Lt>1&&console.time("creation"),ge=this.tiles[ne]=Po(G,$,Z,ht,kt),this.tileCoords.push({z:$,x:Z,y:ht}),Lt)){Lt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",$,Z,ht,ge.numFeatures,ge.numPoints,ge.numSimplified),console.timeEnd("creation"));const Xt=`z${$}`;this.stats[Xt]=(this.stats[Xt]||0)+1,this.total++}if(ge.source=G,ft==null){if($===kt.indexMaxZoom||ge.numPoints<=kt.indexMaxPoints)continue}else{if($===kt.maxZoom||$===ft)continue;if(ft!=null){const Xt=ft-$;if(Z!==Tt>>Xt||ht!==tt>>Xt)continue}}if(ge.source=null,G.length===0)continue;Lt>1&&console.time("clipping");const Ee=.5*kt.buffer/kt.extent,Sr=.5-Ee,Pe=.5+Ee,Ve=1+Ee;let rr=null,Wt=null,Qe=null,ir=null,kr=Je(G,Ut,Z-Ee,Z+Pe,0,ge.minX,ge.maxX,kt),sr=Je(G,Ut,Z+Sr,Z+Ve,0,ge.minX,ge.maxX,kt);G=null,kr&&(rr=Je(kr,Ut,ht-Ee,ht+Pe,1,ge.minY,ge.maxY,kt),Wt=Je(kr,Ut,ht+Sr,ht+Ve,1,ge.minY,ge.maxY,kt),kr=null),sr&&(Qe=Je(sr,Ut,ht-Ee,ht+Pe,1,ge.minY,ge.maxY,kt),ir=Je(sr,Ut,ht+Sr,ht+Ve,1,ge.minY,ge.maxY,kt),sr=null),Lt>1&&console.timeEnd("clipping"),xt.push(rr||[],$+1,2*Z,2*ht),xt.push(Wt||[],$+1,2*Z,2*ht+1),xt.push(Qe||[],$+1,2*Z+1,2*ht),xt.push(ir||[],$+1,2*Z+1,2*ht+1)}}getTile(G,$,Z){G=+G,$=+$,Z=+Z;const ht=this.options,{extent:ft,debug:Tt}=ht;if(G<0||G>24)return null;const tt=1<<G,xt=Ns(G,$=$+tt&tt-1,Z);if(this.tiles[xt])return Dn(this.tiles[xt],ft);Tt>1&&console.log("drilling down to z%d-%d-%d",G,$,Z);let kt,Lt=G,Ut=$,ne=Z;for(;!kt&&Lt>0;)Lt--,Ut>>=1,ne>>=1,kt=this.tiles[Ns(Lt,Ut,ne)];return kt&&kt.source?(Tt>1&&(console.log("found parent tile z%d-%d-%d",Lt,Ut,ne),console.time("drilling down")),this.splitTile(kt.source,Lt,Ut,ne,G,$,Z),Tt>1&&console.timeEnd("drilling down"),this.tiles[xt]?Dn(this.tiles[xt],ft):null):null}}function Ns(yt,G,$){return 32*((1<<yt)*$+G)+yt}class Ls extends ie{constructor(G,$,Z,ht=ls){super(G,$,Z),this._dataUpdateable=new Map,this._createGeoJSONIndex=ht}loadVectorTile(G,$){return f._(this,void 0,void 0,(function*(){const Z=G.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const ht=this._geoJSONIndex.getTile(Z.z,Z.x,Z.y);return ht?ae(new V(ht.features,{version:2,extent:f.a3})):null}))}loadData(G){return f._(this,void 0,void 0,(function*(){var $;($=this._pendingRequest)===null||$===void 0||$.abort();const Z=!!(G&&G.request&&G.request.collectResourceTiming)&&new f.cW(G.request);this._pendingRequest=new AbortController;try{(!this._pendingData||G.request||G.data||G.dataDiff)&&(this._pendingData=this.loadAndProcessGeoJSON(G,this._pendingRequest));const ht=yield this._pendingData;this._geoJSONIndex=this._createGeoJSONIndex(ht,G),this.loaded={};const ft={data:ht};if(Z){const Tt=Z.finish();Tt&&(ft.resourceTiming={},ft.resourceTiming[G.source]=JSON.parse(JSON.stringify(Tt)))}return ft}catch(ht){if(delete this._pendingRequest,f.cC(ht))return{abandoned:!0};throw ht}}))}getData(){return f._(this,void 0,void 0,(function*(){return this._pendingData}))}reloadTile(G){const $=this.loaded;return $&&$[G.uid]?super.reloadTile(G):this.loadTile(G)}loadAndProcessGeoJSON(G,$){return f._(this,void 0,void 0,(function*(){let Z=yield this.loadGeoJSON(G,$);if(delete this._pendingRequest,typeof Z!="object")throw new Error(`Input data given to '${G.source}' is not a valid GeoJSON object.`);if(Ce(Z,!0),G.filter){const ht=f.c_(G.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ht.result==="error")throw new Error(ht.value.map((Tt=>`${Tt.key}: ${Tt.message}`)).join(", "));Z={type:"FeatureCollection",features:Z.features.filter((Tt=>ht.value.evaluate({zoom:0},Tt)))}}return Z}))}loadGeoJSON(G,$){return f._(this,void 0,void 0,(function*(){const{promoteId:Z}=G;if(G.request){const ht=yield f.j(G.request,$);return this._dataUpdateable=f.d0(ht.data,Z)?f.c$(ht.data,Z):void 0,ht.data}if(typeof G.data=="string")try{const ht=JSON.parse(G.data);return this._dataUpdateable=f.d0(ht,Z)?f.c$(ht,Z):void 0,ht}catch{throw new Error(`Input data given to '${G.source}' is not a valid GeoJSON object.`)}if(!G.dataDiff)throw new Error(`Input data given to '${G.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${G.source}`);return f.d1(this._dataUpdateable,G.dataDiff,Z),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}}))}removeSource(G){return f._(this,void 0,void 0,(function*(){this._pendingRequest&&this._pendingRequest.abort()}))}getClusterExpansionZoom(G){return this._geoJSONIndex.getClusterExpansionZoom(G.clusterId)}getClusterChildren(G){return this._geoJSONIndex.getChildren(G.clusterId)}getClusterLeaves(G){return this._geoJSONIndex.getLeaves(G.clusterId,G.limit,G.offset)}}function ls(yt,G){return G.cluster?new lo((function({superclusterOptions:$,clusterProperties:Z}){if(!Z||!$)return $;const ht={},ft={},Tt={accumulated:null,zoom:0},tt={properties:null},xt=Object.keys(Z);for(const kt of xt){const[Lt,Ut]=Z[kt],ne=f.c_(Ut),ge=f.c_(typeof Lt=="string"?[Lt,["accumulated"],["get",kt]]:Lt);ht[kt]=ne.value,ft[kt]=ge.value}return $.map=kt=>{tt.properties=kt;const Lt={};for(const Ut of xt)Lt[Ut]=ht[Ut].evaluate(Tt,tt);return Lt},$.reduce=(kt,Lt)=>{tt.properties=Lt;for(const Ut of xt)Tt.accumulated=kt[Ut],kt[Ut]=ft[Ut].evaluate(Tt,tt)},$})(G)).load(yt.features):(function($,Z){return new ks($,Z)})(yt,G.geojsonVtOptions)}class ji{constructor(G){this.self=G,this.actor=new f.K(G),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.globalStates=new Map,this.self.registerWorkerSource=($,Z)=>{if(this.externalWorkerSourceTypes[$])throw new Error(`Worker source with name "${$}" already registered.`);this.externalWorkerSourceTypes[$]=Z},this.self.addProtocol=f.cE,this.self.removeProtocol=f.cF,this.self.registerRTLTextPlugin=$=>{f.d2.setMethods($)},this.actor.registerMessageHandler("LDT",(($,Z)=>this._getDEMWorkerSource($,Z.source).loadTile(Z))),this.actor.registerMessageHandler("RDT",(($,Z)=>f._(this,void 0,void 0,(function*(){this._getDEMWorkerSource($,Z.source).removeTile(Z)})))),this.actor.registerMessageHandler("GCEZ",(($,Z)=>f._(this,void 0,void 0,(function*(){return this._getWorkerSource($,Z.type,Z.source).getClusterExpansionZoom(Z)})))),this.actor.registerMessageHandler("GCC",(($,Z)=>f._(this,void 0,void 0,(function*(){return this._getWorkerSource($,Z.type,Z.source).getClusterChildren(Z)})))),this.actor.registerMessageHandler("GCL",(($,Z)=>f._(this,void 0,void 0,(function*(){return this._getWorkerSource($,Z.type,Z.source).getClusterLeaves(Z)})))),this.actor.registerMessageHandler("LD",(($,Z)=>this._getWorkerSource($,Z.type,Z.source).loadData(Z))),this.actor.registerMessageHandler("GD",(($,Z)=>this._getWorkerSource($,Z.type,Z.source).getData())),this.actor.registerMessageHandler("LT",(($,Z)=>this._getWorkerSource($,Z.type,Z.source).loadTile(Z))),this.actor.registerMessageHandler("RT",(($,Z)=>this._getWorkerSource($,Z.type,Z.source).reloadTile(Z))),this.actor.registerMessageHandler("AT",(($,Z)=>this._getWorkerSource($,Z.type,Z.source).abortTile(Z))),this.actor.registerMessageHandler("RMT",(($,Z)=>this._getWorkerSource($,Z.type,Z.source).removeTile(Z))),this.actor.registerMessageHandler("RS",(($,Z)=>f._(this,void 0,void 0,(function*(){if(!this.workerSources[$]||!this.workerSources[$][Z.type]||!this.workerSources[$][Z.type][Z.source])return;const ht=this.workerSources[$][Z.type][Z.source];delete this.workerSources[$][Z.type][Z.source],ht.removeSource!==void 0&&ht.removeSource(Z)})))),this.actor.registerMessageHandler("RM",($=>f._(this,void 0,void 0,(function*(){delete this.layerIndexes[$],delete this.availableImages[$],delete this.workerSources[$],delete this.demWorkerSources[$],this.globalStates.delete($)})))),this.actor.registerMessageHandler("SR",(($,Z)=>f._(this,void 0,void 0,(function*(){this.referrer=Z})))),this.actor.registerMessageHandler("SRPS",(($,Z)=>this._syncRTLPluginState($,Z))),this.actor.registerMessageHandler("IS",(($,Z)=>f._(this,void 0,void 0,(function*(){this.self.importScripts(Z)})))),this.actor.registerMessageHandler("SI",(($,Z)=>this._setImages($,Z))),this.actor.registerMessageHandler("UL",(($,Z)=>f._(this,void 0,void 0,(function*(){this._getLayerIndex($).update(Z.layers,Z.removedIds,this._getGlobalState($))})))),this.actor.registerMessageHandler("UGS",(($,Z)=>f._(this,void 0,void 0,(function*(){const ht=this._getGlobalState($);for(const ft in Z)ht[ft]=Z[ft]})))),this.actor.registerMessageHandler("SL",(($,Z)=>f._(this,void 0,void 0,(function*(){this._getLayerIndex($).replace(Z,this._getGlobalState($))}))))}_getGlobalState(G){let $=this.globalStates.get(G);return $||($={},this.globalStates.set(G,$)),$}_setImages(G,$){return f._(this,void 0,void 0,(function*(){this.availableImages[G]=$;for(const Z in this.workerSources[G]){const ht=this.workerSources[G][Z];for(const ft in ht)ht[ft].availableImages=$}}))}_syncRTLPluginState(G,$){return f._(this,void 0,void 0,(function*(){return yield f.d2.syncState($,this.self.importScripts)}))}_getAvailableImages(G){let $=this.availableImages[G];return $||($=[]),$}_getLayerIndex(G){let $=this.layerIndexes[G];return $||($=this.layerIndexes[G]=new c),$}_getWorkerSource(G,$,Z){if(this.workerSources[G]||(this.workerSources[G]={}),this.workerSources[G][$]||(this.workerSources[G][$]={}),!this.workerSources[G][$][Z]){const ht={sendAsync:(ft,Tt)=>(ft.targetMapId=G,this.actor.sendAsync(ft,Tt))};switch($){case"vector":this.workerSources[G][$][Z]=new ie(ht,this._getLayerIndex(G),this._getAvailableImages(G));break;case"geojson":this.workerSources[G][$][Z]=new Ls(ht,this._getLayerIndex(G),this._getAvailableImages(G));break;default:this.workerSources[G][$][Z]=new this.externalWorkerSourceTypes[$](ht,this._getLayerIndex(G),this._getAvailableImages(G))}}return this.workerSources[G][$][Z]}_getDEMWorkerSource(G,$){return this.demWorkerSources[G]||(this.demWorkerSources[G]={}),this.demWorkerSources[G][$]||(this.demWorkerSources[G][$]=new le),this.demWorkerSources[G][$]}}return f.i(self)&&(self.worker=new ji(self)),ji})),a("index",["exports","./shared"],(function(f,c){var T="5.12.0";function C(){var b=new c.A(4);return c.A!=Float32Array&&(b[1]=0,b[2]=0),b[0]=1,b[3]=1,b}let R,L,V;const X={frame(b,s,u){const _=requestAnimationFrame((v=>{m(),s(v)})),{unsubscribe:m}=c.s(b.signal,"abort",(()=>{m(),cancelAnimationFrame(_),u(c.c())}),!1)},frameAsync(b){return new Promise(((s,u)=>{this.frame(b,s,u)}))},getImageData(b,s=0){return this.getImageCanvasContext(b).getImageData(-s,-s,b.width+2*s,b.height+2*s)},getImageCanvasContext(b){const s=window.document.createElement("canvas"),u=s.getContext("2d",{willReadFrequently:!0});if(!u)throw new Error("failed to create canvas 2d context");return s.width=b.width,s.height=b.height,u.drawImage(b,0,0,b.width,b.height),u},resolveURL:b=>(R||(R=document.createElement("a")),R.href=b,R.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return V!==void 0?V:!!matchMedia&&(L==null&&(L=matchMedia("(prefers-reduced-motion: reduce)")),L.matches)},set prefersReducedMotion(b){V=b}},at=new class{constructor(){this._realTime=typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),this._frozenAt=null}getCurrentTime(){return this._frozenAt!==null?this._frozenAt:this._realTime()}setNow(b){this._frozenAt=b}restoreNow(){this._frozenAt=null}isFrozen(){return this._frozenAt!==null}};function nt(){return at.getCurrentTime()}class K{static testProp(s){if(!K.docStyle)return s[0];for(let u=0;u<s.length;u++)if(s[u]in K.docStyle)return s[u];return s[0]}static create(s,u,_){const m=window.document.createElement(s);return u!==void 0&&(m.className=u),_&&_.appendChild(m),m}static createNS(s,u){return window.document.createElementNS(s,u)}static disableDrag(){K.docStyle&&K.selectProp&&(K.userSelect=K.docStyle[K.selectProp],K.docStyle[K.selectProp]="none")}static enableDrag(){K.docStyle&&K.selectProp&&(K.docStyle[K.selectProp]=K.userSelect)}static setTransform(s,u){s.style[K.transformProp]=u}static addEventListener(s,u,_,m={}){s.addEventListener(u,_,"passive"in m?m:m.capture)}static removeEventListener(s,u,_,m={}){s.removeEventListener(u,_,"passive"in m?m:m.capture)}static suppressClickInternal(s){s.preventDefault(),s.stopPropagation(),window.removeEventListener("click",K.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",K.suppressClickInternal,!0),window.setTimeout((()=>{window.removeEventListener("click",K.suppressClickInternal,!0)}),0)}static getScale(s){const u=s.getBoundingClientRect();return{x:u.width/s.offsetWidth||1,y:u.height/s.offsetHeight||1,boundingClientRect:u}}static getPoint(s,u,_){const m=u.boundingClientRect;return new c.P((_.clientX-m.left)/u.x-s.clientLeft,(_.clientY-m.top)/u.y-s.clientTop)}static mousePos(s,u){const _=K.getScale(s);return K.getPoint(s,_,u)}static touchPos(s,u){const _=[],m=K.getScale(s);for(let v=0;v<u.length;v++)_.push(K.getPoint(s,m,u[v]));return _}static mouseButton(s){return s.button}static remove(s){s.parentNode&&s.parentNode.removeChild(s)}static sanitize(s){const u=new DOMParser().parseFromString(s,"text/html").body||document.createElement("body"),_=u.querySelectorAll("script");for(const m of _)m.remove();return K.clean(u),u.innerHTML}static isPossiblyDangerous(s,u){const _=u.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(s)||!_.includes("javascript:")&&!_.includes("data:"))||!!s.startsWith("on")||void 0}static clean(s){const u=s.children;for(const _ of u)K.removeAttributes(_),K.clean(_)}static removeAttributes(s){for(const{name:u,value:_}of s.attributes)K.isPossiblyDangerous(u,_)&&s.removeAttribute(u)}}K.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,K.selectProp=K.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),K.transformProp=K.testProp(["transform","WebkitTransform"]);const It={supported:!1,testSupport:function(b){!Ht&&Ct&&(Qt?ee(b):St=b)}};let St,Ct,Ht=!1,Qt=!1;function ee(b){const s=b.createTexture();b.bindTexture(b.TEXTURE_2D,s);try{if(b.texImage2D(b.TEXTURE_2D,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,Ct),b.isContextLost())return;It.supported=!0}catch{}b.deleteTexture(s),Ht=!0}var ae;typeof document<"u"&&(Ct=document.createElement("img"),Ct.onload=()=>{St&&ee(St),St=null,Qt=!0},Ct.onerror=()=>{Ht=!0,St=null},Ct.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),(function(b){let s,u,_,m;b.resetRequestQueue=()=>{s=[],u=0,_=0,m={}},b.addThrottleControl=I=>{const B=_++;return m[B]=I,B},b.removeThrottleControl=I=>{delete m[I],w()},b.getImage=(I,B,D=!0)=>new Promise(((U,k)=>{It.supported&&(I.headers||(I.headers={}),I.headers.accept="image/webp,*/*"),c.e(I,{type:"image"}),s.push({abortController:B,requestParameters:I,supportImageRefresh:D,state:"queued",onError:j=>{k(j)},onSuccess:j=>{U(j)}}),w()}));const v=I=>c._(this,void 0,void 0,(function*(){I.state="running";const{requestParameters:B,supportImageRefresh:D,onError:U,onSuccess:k,abortController:j}=I,W=D===!1&&!c.i(self)&&!c.g(B.url)&&(!B.headers||Object.keys(B.headers).reduce(((st,ut)=>st&&ut==="accept"),!0));u++;const Q=W?S(B,j):c.m(B,j);try{const st=yield Q;delete I.abortController,I.state="completed",st.data instanceof HTMLImageElement||c.b(st.data)?k(st):st.data&&k({data:yield(et=st.data,typeof createImageBitmap=="function"?c.f(et):c.h(et)),cacheControl:st.cacheControl,expires:st.expires})}catch(st){delete I.abortController,U(st)}finally{u--,w()}var et})),w=()=>{const I=(()=>{for(const B of Object.keys(m))if(m[B]())return!0;return!1})()?c.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:c.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let B=u;B<I&&s.length>0;B++){const D=s.shift();D.abortController.signal.aborted?B--:v(D)}},S=(I,B)=>new Promise(((D,U)=>{const k=new Image,j=I.url,W=I.credentials;W&&W==="include"?k.crossOrigin="use-credentials":(W&&W==="same-origin"||!c.d(j))&&(k.crossOrigin="anonymous"),B.signal.addEventListener("abort",(()=>{k.src="",U(c.c())})),k.fetchPriority="high",k.onload=()=>{k.onerror=k.onload=null,D({data:k})},k.onerror=()=>{k.onerror=k.onload=null,B.signal.aborted||U(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},k.src=j}))})(ae||(ae={})),ae.resetRequestQueue();class be{constructor(s){this._transformRequestFn=s??null}transformRequest(s,u){return this._transformRequestFn&&this._transformRequestFn(s,u)||{url:s}}setTransformRequest(s){this._transformRequestFn=s}}function ie(b){const s=[];if(typeof b=="string")s.push({id:"default",url:b});else if(b&&b.length>0){const u=[];for(const{id:_,url:m}of b){const v=`${_}${m}`;u.indexOf(v)===-1&&(u.push(v),s.push({id:_,url:m}))}}return s}function le(b,s,u){try{const _=new URL(b);return _.pathname+=`${s}${u}`,_.toString()}catch{throw new Error(`Invalid sprite URL "${b}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}function Ae(b){const{userImage:s}=b;return!!(s&&s.render&&s.render())&&(b.data.replace(new Uint8Array(s.data.buffer)),!0)}class Fe extends c.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new c.R({width:1,height:1}),this.dirty=!0}destroy(){this.atlasTexture&&(this.atlasTexture.destroy(),this.atlasTexture=null);for(const s of Object.keys(this.images))this.removeImage(s);this.patterns={},this.atlasImage=new c.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(s){if(this.loaded!==s&&(this.loaded=s,s)){for(const{ids:u,promiseResolve:_}of this.requestors)_(this._getImagesForIds(u));this.requestors=[]}}getImage(s){const u=this.images[s];if(u&&!u.data&&u.spriteData){const _=u.spriteData;u.data=new c.R({width:_.width,height:_.height},_.context.getImageData(_.x,_.y,_.width,_.height).data),u.spriteData=null}return u}addImage(s,u){if(this.images[s])throw new Error(`Image id ${s} already exist, use updateImage instead`);this._validate(s,u)&&(this.images[s]=u)}_validate(s,u){let _=!0;const m=u.data||u.spriteData;return this._validateStretch(u.stretchX,m&&m.width)||(this.fire(new c.k(new Error(`Image "${s}" has invalid "stretchX" value`))),_=!1),this._validateStretch(u.stretchY,m&&m.height)||(this.fire(new c.k(new Error(`Image "${s}" has invalid "stretchY" value`))),_=!1),this._validateContent(u.content,u)||(this.fire(new c.k(new Error(`Image "${s}" has invalid "content" value`))),_=!1),_}_validateStretch(s,u){if(!s)return!0;let _=0;for(const m of s){if(m[0]<_||m[1]<m[0]||u<m[1])return!1;_=m[1]}return!0}_validateContent(s,u){if(!s)return!0;if(s.length!==4)return!1;const _=u.spriteData,m=_&&_.width||u.data.width,v=_&&_.height||u.data.height;return!(s[0]<0||m<s[0]||s[1]<0||v<s[1]||s[2]<0||m<s[2]||s[3]<0||v<s[3]||s[2]<s[0]||s[3]<s[1])}updateImage(s,u,_=!0){const m=this.getImage(s);if(_&&(m.data.width!==u.data.width||m.data.height!==u.data.height))throw new Error(`size mismatch between old image (${m.data.width}x${m.data.height}) and new image (${u.data.width}x${u.data.height}).`);u.version=m.version+1,this.images[s]=u,this.updatedImages[s]=!0}removeImage(s){const u=this.images[s];delete this.images[s],delete this.patterns[s],u.userImage&&u.userImage.onRemove&&u.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(s){return new Promise(((u,_)=>{let m=!0;if(!this.isLoaded())for(const v of s)this.images[v]||(m=!1);this.isLoaded()||m?u(this._getImagesForIds(s)):this.requestors.push({ids:s,promiseResolve:u})}))}_getImagesForIds(s){const u={};for(const _ of s){let m=this.getImage(_);m||(this.fire(new c.l("styleimagemissing",{id:_})),m=this.getImage(_)),m?u[_]={data:m.data.clone(),pixelRatio:m.pixelRatio,sdf:m.sdf,version:m.version,stretchX:m.stretchX,stretchY:m.stretchY,content:m.content,textFitWidth:m.textFitWidth,textFitHeight:m.textFitHeight,hasRenderCallback:!!(m.userImage&&m.userImage.render)}:c.w(`Image "${_}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return u}getPixelSize(){const{width:s,height:u}=this.atlasImage;return{width:s,height:u}}getPattern(s){const u=this.patterns[s],_=this.getImage(s);if(!_)return null;if(u&&u.position.version===_.version)return u.position;if(u)u.position.version=_.version;else{const m={w:_.data.width+2,h:_.data.height+2,x:0,y:0},v=new c.I(m,_);this.patterns[s]={bin:m,position:v}}return this._updatePatternAtlas(),this.patterns[s].position}bind(s){const u=s.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new c.T(s,this.atlasImage,u.RGBA),this.atlasTexture.bind(u.LINEAR,u.CLAMP_TO_EDGE)}_updatePatternAtlas(){const s=[];for(const v in this.patterns)s.push(this.patterns[v].bin);const{w:u,h:_}=c.p(s),m=this.atlasImage;m.resize({width:u||1,height:_||1});for(const v in this.patterns){const{bin:w}=this.patterns[v],S=w.x+1,I=w.y+1,B=this.getImage(v).data,D=B.width,U=B.height;c.R.copy(B,m,{x:0,y:0},{x:S,y:I},{width:D,height:U}),c.R.copy(B,m,{x:0,y:U-1},{x:S,y:I-1},{width:D,height:1}),c.R.copy(B,m,{x:0,y:0},{x:S,y:I+U},{width:D,height:1}),c.R.copy(B,m,{x:D-1,y:0},{x:S-1,y:I},{width:1,height:U}),c.R.copy(B,m,{x:0,y:0},{x:S+D,y:I},{width:1,height:U})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(s){for(const u of s){if(this.callbackDispatchedThisFrame[u])continue;this.callbackDispatchedThisFrame[u]=!0;const _=this.getImage(u);_||c.w(`Image with ID: "${u}" was not found`),Ae(_)&&this.updateImage(u,_)}}cloneImages(){const s={};for(const u in this.images){const _=this.images[u];s[u]=Object.assign(Object.assign({},_),{data:_.data?_.data.clone():null})}return s}}const ze=1e20;function Ce(b,s,u,_,m,v,w,S,I){for(let B=s;B<s+_;B++)zr(b,u*v+B,v,m,w,S,I);for(let B=u;B<u+m;B++)zr(b,B*v+s,1,_,w,S,I)}function zr(b,s,u,_,m,v,w){v[0]=0,w[0]=-ze,w[1]=ze,m[0]=b[s];for(let S=1,I=0,B=0;S<_;S++){m[S]=b[s+S*u];const D=S*S;do{const U=v[I];B=(m[S]-m[U]+D-U*U)/(S-U)/2}while(B<=w[I]&&--I>-1);I++,v[I]=S,w[I]=B,w[I+1]=ze}for(let S=0,I=0;S<_;S++){for(;w[I+1]<S;)I++;const B=v[I],D=S-B;b[s+S*u]=m[B]+D*D}}const ns=c.v.layout_symbol["text-font"].default.join(",");class Hr{constructor(s,u,_){this.requestManager=s,this.localIdeographFontFamily=u,this.entries={},this.lang=_}setURL(s){this.url=s}getGlyphs(s){return c._(this,void 0,void 0,(function*(){const u=[];for(const v in s)for(const w of s[v])u.push(this._getAndCacheGlyphsPromise(v,w));const _=yield Promise.all(u),m={};for(const{stack:v,id:w,glyph:S}of _)m[v]||(m[v]={}),m[v][w]=S&&{id:S.id,bitmap:S.bitmap.clone(),metrics:S.metrics};return m}))}_getAndCacheGlyphsPromise(s,u){return c._(this,void 0,void 0,(function*(){let _=this.entries[s];_||(_=this.entries[s]={glyphs:{},requests:{},ranges:{}});let m=_.glyphs[u];return m!==void 0?{stack:s,id:u,glyph:m}:!this.url||this._charUsesLocalIdeographFontFamily(u)?(m=_.glyphs[u]=this._drawGlyph(_,s,u),{stack:s,id:u,glyph:m}):yield this._downloadAndCacheRangePromise(s,u)}))}_downloadAndCacheRangePromise(s,u){return c._(this,void 0,void 0,(function*(){const _=Math.floor(u/256);if(256*_>65535)throw new Error("glyphs > 65535 not supported");const m=this.entries[s];if(m.ranges[_])return{stack:s,id:u,glyph:null};if(!m.requests[_]){const v=Hr.loadGlyphRange(s,_,this.url,this.requestManager);m.requests[_]=v}try{const v=yield m.requests[_];for(const w in v)m.glyphs[+w]=v[+w];return m.ranges[_]=!0,{stack:s,id:u,glyph:v[u]||null}}catch(v){const w=m.glyphs[u]=this._drawGlyph(m,s,u);return this._warnOnMissingGlyphRange(w,_,u,v),{stack:s,id:u,glyph:w}}}))}_warnOnMissingGlyphRange(s,u,_,m){const v=256*u,w=v+255,S=_.toString(16).padStart(4,"0").toUpperCase();c.w(`Unable to load glyph range ${u}, ${v}-${w}. Rendering codepoint U+${S} locally instead. ${m}`)}_charUsesLocalIdeographFontFamily(s){return!!this.localIdeographFontFamily&&c.q(s)}_drawGlyph(s,u,_){const m=u===ns&&this.localIdeographFontFamily!==""&&this._charUsesLocalIdeographFontFamily(_),v=m?"ideographTinySDF":"tinySDF";s[v]||(s[v]=this._createTinySDF(m?this.localIdeographFontFamily:u));const w=s[v].draw(String.fromCharCode(_));return{id:_,bitmap:new c.r({width:w.width||60,height:w.height||60},w.data),metrics:{width:w.glyphWidth/2||24,height:w.glyphHeight/2||24,left:w.glyphLeft/2+.5||0,top:w.glyphTop/2-27.5||-8,advance:w.glyphAdvance/2||24,isDoubleResolution:!0}}}_createTinySDF(s){const u=s?s.split(","):[];u.push("sans-serif");const _=u.map((m=>/[-\w]+/.test(m)?m:`'${CSS.escape(m)}'`)).join(",");return new Hr.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:_,fontWeight:this._fontWeight(u[0]),fontStyle:this._fontStyle(u[0]),lang:this.lang})}_fontStyle(s){return/italic/i.test(s)?"italic":/oblique/i.test(s)?"oblique":"normal"}_fontWeight(s){const u={thin:100,hairline:100,"extra light":200,"ultra light":200,light:300,normal:400,regular:400,medium:500,semibold:600,demibold:600,bold:700,"extra bold":800,"ultra bold":800,black:900,heavy:900,"extra black":950,"ultra black":950};let _;for(const[m,v]of Object.entries(u))new RegExp(`\\b${m}\\b`,"i").test(s)&&(_=`${v}`);return _}destroy(){for(const s in this.entries){const u=this.entries[s];u.tinySDF&&(u.tinySDF=null),u.ideographTinySDF&&(u.ideographTinySDF=null),u.glyphs={},u.requests={},u.ranges={}}this.entries={}}}Hr.loadGlyphRange=function(b,s,u,_){return c._(this,void 0,void 0,(function*(){const m=256*s,v=m+255,w=_.transformRequest(u.replace("{fontstack}",b).replace("{range}",`${m}-${v}`),"Glyphs"),S=yield c.n(w,new AbortController);if(!S||!S.data)throw new Error(`Could not load glyph range. range: ${s}, ${m}-${v}`);const I={};for(const B of c.o(S.data))I[B.id]=B;return I}))},Hr.TinySDF=class{constructor({fontSize:b=24,buffer:s=3,radius:u=8,cutoff:_=.25,fontFamily:m="sans-serif",fontWeight:v="normal",fontStyle:w="normal",lang:S=null}={}){this.buffer=s,this.cutoff=_,this.radius=u,this.lang=S;const I=this.size=b+4*s,B=this._createCanvas(I),D=this.ctx=B.getContext("2d",{willReadFrequently:!0});D.font=`${w} ${v} ${b}px ${m}`,D.textBaseline="alphabetic",D.textAlign="left",D.fillStyle="black",this.gridOuter=new Float64Array(I*I),this.gridInner=new Float64Array(I*I),this.f=new Float64Array(I),this.z=new Float64Array(I+1),this.v=new Uint16Array(I)}_createCanvas(b){const s=document.createElement("canvas");return s.width=s.height=b,s}draw(b){const{width:s,actualBoundingBoxAscent:u,actualBoundingBoxDescent:_,actualBoundingBoxLeft:m,actualBoundingBoxRight:v}=this.ctx.measureText(b),w=Math.ceil(u),S=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(v-m))),I=Math.min(this.size-this.buffer,w+Math.ceil(_)),B=S+2*this.buffer,D=I+2*this.buffer,U=Math.max(B*D,0),k=new Uint8ClampedArray(U),j={data:k,width:B,height:D,glyphWidth:S,glyphHeight:I,glyphTop:w,glyphLeft:0,glyphAdvance:s};if(S===0||I===0)return j;const{ctx:W,buffer:Q,gridInner:et,gridOuter:st}=this;this.lang&&(W.lang=this.lang),W.clearRect(Q,Q,S,I),W.fillText(b,Q,Q+w);const ut=W.getImageData(Q,Q,S,I);st.fill(ze,0,U),et.fill(0,0,U);for(let _t=0;_t<I;_t++)for(let lt=0;lt<S;lt++){const gt=ut.data[4*(_t*S+lt)+3]/255;if(gt===0)continue;const mt=(_t+Q)*B+lt+Q;if(gt===1)st[mt]=0,et[mt]=ze;else{const dt=.5-gt;st[mt]=dt>0?dt*dt:0,et[mt]=dt<0?dt*dt:0}}Ce(st,0,0,B,D,B,this.f,this.v,this.z),Ce(et,Q,Q,S,I,B,this.f,this.v,this.z);for(let _t=0;_t<U;_t++){const lt=Math.sqrt(st[_t])-Math.sqrt(et[_t]);k[_t]=Math.round(255-255*(lt/this.radius+this.cutoff))}return j}};class lo{constructor(){this.specification=c.u.light.position}possiblyEvaluate(s,u){return c.C(s.expression.evaluate(u))}interpolate(s,u,_){return{x:c.F.number(s.x,u.x,_),y:c.F.number(s.y,u.y,_),z:c.F.number(s.z,u.z,_)}}}let Le;class vi extends c.E{constructor(s){super(),Le=Le||new c.t({anchor:new c.D(c.u.light.anchor),position:new lo,color:new c.D(c.u.light.color),intensity:new c.D(c.u.light.intensity)}),this._transitionable=new c.x(Le,void 0),this.setLight(s),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(s,u={}){if(!this._validate(c.y,s,u))for(const _ in s){const m=s[_];_.endsWith("-transition")?this._transitionable.setTransition(_.slice(0,-11),m):this._transitionable.setValue(_,m)}}updateTransitions(s){this._transitioning=this._transitionable.transitioned(s,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(s){this.properties=this._transitioning.possiblyEvaluate(s)}_validate(s,u,_){return(!_||_.validate!==!1)&&c.z(this,s.call(c.B,{value:u,style:{glyphs:!0,sprite:!0},styleSpec:c.u}))}}const xi=new c.t({"sky-color":new c.D(c.u.sky["sky-color"]),"horizon-color":new c.D(c.u.sky["horizon-color"]),"fog-color":new c.D(c.u.sky["fog-color"]),"fog-ground-blend":new c.D(c.u.sky["fog-ground-blend"]),"horizon-fog-blend":new c.D(c.u.sky["horizon-fog-blend"]),"sky-horizon-blend":new c.D(c.u.sky["sky-horizon-blend"]),"atmosphere-blend":new c.D(c.u.sky["atmosphere-blend"])});class li extends c.E{constructor(s){super(),this._transitionable=new c.x(xi,void 0),this.setSky(s),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new c.G(0))}setSky(s,u={}){if(!this._validate(c.H,s,u)){s||(s={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const _ in s){const m=s[_];_.endsWith("-transition")?this._transitionable.setTransition(_.slice(0,-11),m):this._transitionable.setValue(_,m)}}}getSky(){return this._transitionable.serialize()}updateTransitions(s){this._transitioning=this._transitionable.transitioned(s,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(s){this.properties=this._transitioning.possiblyEvaluate(s)}_validate(s,u,_={}){return _?.validate!==!1&&c.z(this,s.call(c.B,c.e({value:u,style:{glyphs:!0,sprite:!0},styleSpec:c.u})))}calculateFogBlendOpacity(s){return s<60?0:s<70?(s-60)/10:1}}class _a{constructor(s,u){this.width=s,this.height=u,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(s,u){const _=s.join(",")+String(u);return this.dashEntry[_]||(this.dashEntry[_]=this.addDash(s,u)),this.dashEntry[_]}getDashRanges(s,u,_){const m=[];let v=s.length%2==1?-s[s.length-1]*_:0,w=s[0]*_,S=!0;m.push({left:v,right:w,isDash:S,zeroLength:s[0]===0});let I=s[0];for(let B=1;B<s.length;B++){S=!S;const D=s[B];v=I*_,I+=D,w=I*_,m.push({left:v,right:w,isDash:S,zeroLength:D===0})}return m}addRoundDash(s,u,_){const m=u/2;for(let v=-_;v<=_;v++){const w=this.width*(this.nextRow+_+v);let S=0,I=s[S];for(let B=0;B<this.width;B++){B/I.right>1&&(I=s[++S]);const D=Math.abs(B-I.left),U=Math.abs(B-I.right),k=Math.min(D,U);let j;const W=v/_*(m+1);if(I.isDash){const Q=m-Math.abs(W);j=Math.sqrt(k*k+Q*Q)}else j=m-Math.sqrt(k*k+W*W);this.data[w+B]=Math.max(0,Math.min(255,j+128))}}}addRegularDash(s){for(let S=s.length-1;S>=0;--S){const I=s[S],B=s[S+1];I.zeroLength?s.splice(S,1):B&&B.isDash===I.isDash&&(B.left=I.left,s.splice(S,1))}const u=s[0],_=s[s.length-1];u.isDash===_.isDash&&(u.left=_.left-this.width,_.right=u.right+this.width);const m=this.width*this.nextRow;let v=0,w=s[v];for(let S=0;S<this.width;S++){S/w.right>1&&(w=s[++v]);const I=Math.abs(S-w.left),B=Math.abs(S-w.right),D=Math.min(I,B);this.data[m+S]=Math.max(0,Math.min(255,(w.isDash?D:-D)+128))}}addDash(s,u){const _=u?7:0,m=2*_+1;if(this.nextRow+m>this.height)return c.w("LineAtlas out of space"),null;let v=0;for(let S=0;S<s.length;S++)v+=s[S];if(v!==0){const S=this.width/v,I=this.getDashRanges(s,this.width,S);u?this.addRoundDash(I,S,_):this.addRegularDash(I)}const w={y:this.nextRow+_,height:2*_,width:v};return this.nextRow+=m,this.dirty=!0,w}bind(s){const u=s.gl;this.texture?(u.bindTexture(u.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,u.texSubImage2D(u.TEXTURE_2D,0,0,0,this.width,this.height,u.ALPHA,u.UNSIGNED_BYTE,this.data))):(this.texture=u.createTexture(),u.bindTexture(u.TEXTURE_2D,this.texture),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,u.REPEAT),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,u.REPEAT),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,u.LINEAR),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,u.LINEAR),u.texImage2D(u.TEXTURE_2D,0,u.ALPHA,this.width,this.height,0,u.ALPHA,u.UNSIGNED_BYTE,this.data))}}const vs="maplibre_preloaded_worker_pool";class hn{constructor(){this.active={}}acquire(s){if(!this.workers)for(this.workers=[];this.workers.length<hn.workerCount;)this.workers.push(new Worker(c.a.WORKER_URL));return this.active[s]=!0,this.workers.slice()}release(s){delete this.active[s],this.numActive()===0&&(this.workers.forEach((u=>{u.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[vs]}numActive(){return Object.keys(this.active).length}}const wi=Math.floor(X.hardwareConcurrency/2);let ur,Rr;function hr(){return ur||(ur=new hn),ur}hn.workerCount=c.J(globalThis)?Math.max(Math.min(wi,3),1):1;class Or{constructor(s,u){this.workerPool=s,this.actors=[],this.currentActor=0,this.id=u;const _=this.workerPool.acquire(u);for(let m=0;m<_.length;m++){const v=new c.K(_[m],u);v.name=`Worker ${m}`,this.actors.push(v)}if(!this.actors.length)throw new Error("No actors found")}broadcast(s,u){const _=[];for(const m of this.actors)_.push(m.sendAsync({type:s,data:u}));return Promise.all(_)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(s=!0){this.actors.forEach((u=>{u.remove()})),this.actors=[],s&&this.workerPool.release(this.id)}registerMessageHandler(s,u){for(const _ of this.actors)_.registerMessageHandler(s,u)}unregisterMessageHandler(s){for(const u of this.actors)u.unregisterMessageHandler(s)}}function xs(){return Rr||(Rr=new Or(hr(),c.L),Rr.registerMessageHandler("GR",((b,s,u)=>c.m(s,u)))),Rr}function ci(b,s){const u=c.M();return c.N(u,u,[1,1,0]),c.O(u,u,[.5*b.width,.5*b.height,1]),b.calculatePosMatrix?c.Q(u,u,b.calculatePosMatrix(s.toUnwrapped())):u}function Fs(b,s,u,_,m,v,w){var S;const I=(function(k,j,W){if(k)for(const Q of k){const et=j[Q];if(et&&et.source===W&&et.type==="fill-extrusion")return!0}else for(const Q in j){const et=j[Q];if(et.source===W&&et.type==="fill-extrusion")return!0}return!1})((S=m?.layers)!==null&&S!==void 0?S:null,s,b.id),B=v.maxPitchScaleFactor(),D=b.tilesIn(_,B,I);D.sort(Je);const U=[];for(const k of D)U.push({wrappedTileID:k.tileID.wrapped().key,queryResults:k.tile.queryRenderedFeatures(s,u,b.getState(),k.queryGeometry,k.cameraQueryGeometry,k.scale,m,v,B,ci(v,k.tileID),w?(j,W)=>w(k.tileID,j,W):void 0)});return(function(k,j){for(const W in k)for(const Q of k[W])Ti(Q,j);return k})((function(k){const j={},W={};for(const Q of k){const et=Q.queryResults,st=Q.wrappedTileID,ut=W[st]=W[st]||{};for(const _t in et){const lt=et[_t],gt=ut[_t]=ut[_t]||{},mt=j[_t]=j[_t]||[];for(const dt of lt)gt[dt.featureIndex]||(gt[dt.featureIndex]=!0,mt.push(dt))}}return j})(U),b)}function Je(b,s){const u=b.tileID,_=s.tileID;return u.overscaledZ-_.overscaledZ||u.canonical.y-_.canonical.y||u.wrap-_.wrap||u.canonical.x-_.canonical.x}function Ti(b,s){const u=b.feature,_=s.getFeatureState(u.layer["source-layer"],u.id);u.source=u.layer.source,u.layer["source-layer"]&&(u.sourceLayer=u.layer["source-layer"]),u.state=_}function Gr(b,s,u){return c._(this,void 0,void 0,(function*(){let _=b;if(b.url?_=(yield c.j(s.transformRequest(b.url,"Source"),u)).data:yield X.frameAsync(u),!_)return null;const m=c.S(c.e(_,b),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in _&&_.vector_layers&&(m.vectorLayerIds=_.vector_layers.map((v=>v.id))),m}))}class We{constructor(s,u){s&&(u?this.setSouthWest(s).setNorthEast(u):Array.isArray(s)&&(s.length===4?this.setSouthWest([s[0],s[1]]).setNorthEast([s[2],s[3]]):this.setSouthWest(s[0]).setNorthEast(s[1])))}setNorthEast(s){return this._ne=s instanceof c.U?new c.U(s.lng,s.lat):c.U.convert(s),this}setSouthWest(s){return this._sw=s instanceof c.U?new c.U(s.lng,s.lat):c.U.convert(s),this}extend(s){const u=this._sw,_=this._ne;let m,v;if(s instanceof c.U)m=s,v=s;else{if(!(s instanceof We))return Array.isArray(s)?s.length===4||s.every(Array.isArray)?this.extend(We.convert(s)):this.extend(c.U.convert(s)):s&&("lng"in s||"lon"in s)&&"lat"in s?this.extend(c.U.convert(s)):this;if(m=s._sw,v=s._ne,!m||!v)return this}return u||_?(u.lng=Math.min(m.lng,u.lng),u.lat=Math.min(m.lat,u.lat),_.lng=Math.max(v.lng,_.lng),_.lat=Math.max(v.lat,_.lat)):(this._sw=new c.U(m.lng,m.lat),this._ne=new c.U(v.lng,v.lat)),this}getCenter(){return new c.U((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new c.U(this.getWest(),this.getNorth())}getSouthEast(){return new c.U(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(s){const{lng:u,lat:_}=c.U.convert(s);let m=this._sw.lng<=u&&u<=this._ne.lng;return this._sw.lng>this._ne.lng&&(m=this._sw.lng>=u&&u>=this._ne.lng),this._sw.lat<=_&&_<=this._ne.lat&&m}intersects(s){if((s=We.convert(s)).getNorth()<this.getSouth()||s.getSouth()>this.getNorth())return!1;const u=c.V(this.getWest(),-180,180),_=c.V(this.getEast(),-180,180),m=c.V(s.getWest(),-180,180),v=c.V(s.getEast(),-180,180),w=u>_,S=m>v;return!(!w||!S)||(w?v>=u||m<=_:S?_>=m||u<=v:!(m>_||v<u))}static convert(s){return s instanceof We?s:s&&new We(s)}static fromLngLat(s,u=0){const _=360*u/40075017,m=_/Math.cos(Math.PI/180*s.lat);return new We(new c.U(s.lng-m,s.lat-_),new c.U(s.lng+m,s.lat+_))}adjustAntiMeridian(){const s=new c.U(this._sw.lng,this._sw.lat),u=new c.U(this._ne.lng,this._ne.lat);return new We(s,s.lng>u.lng?new c.U(u.lng+360,u.lat):u)}}class os{constructor(s,u,_){this.bounds=We.convert(this.validateBounds(s)),this.minzoom=u||0,this.maxzoom=_||24}validateBounds(s){return Array.isArray(s)&&s.length===4?[Math.max(-180,s[0]),Math.max(-90,s[1]),Math.min(180,s[2]),Math.min(90,s[3])]:[-180,-90,180,90]}contains(s){const u=Math.pow(2,s.z),_=Math.floor(c.X(this.bounds.getWest())*u),m=Math.floor(c.W(this.bounds.getNorth())*u),v=Math.ceil(c.X(this.bounds.getEast())*u),w=Math.ceil(c.W(this.bounds.getSouth())*u);return s.x>=_&&s.x<v&&s.y>=m&&s.y<w}}class as extends c.E{constructor(s,u,_,m){if(super(),this.id=s,this.dispatcher=_,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,c.e(this,c.S(u,["url","scheme","tileSize","promoteId","encoding"])),this._options=c.e({type:"vector"},u),this._collectResourceTiming=u.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(m)}load(){return c._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new c.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const s=yield Gr(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.tileManagers[this.id].clearTiles(),s&&(c.e(this,s),s.bounds&&(this.tileBounds=new os(s.bounds,this.minzoom,this.maxzoom)),this.fire(new c.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.l("data",{dataType:"source",sourceDataType:"content"})))}catch(s){this._tileJSONRequest=null,this._loaded=!0,this.fire(new c.k(s))}}))}loaded(){return this._loaded}hasTile(s){return!this.tileBounds||this.tileBounds.contains(s.canonical)}onAdd(s){this.map=s,this.load()}setSourceProperty(s){this._tileJSONRequest&&this._tileJSONRequest.abort(),s(),this.load()}setTiles(s){return this.setSourceProperty((()=>{this._options.tiles=s})),this}setUrl(s){return this.setSourceProperty((()=>{this.url=s,this._options.url=s})),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return c.e({},this._options)}loadTile(s){return c._(this,void 0,void 0,(function*(){const u=s.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),_={request:this.map._requestManager.transformRequest(u,"Tile"),uid:s.uid,tileID:s.tileID,zoom:s.tileID.overscaledZ,tileSize:this.tileSize*s.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity,encoding:this.encoding,overzoomParameters:this._getOverzoomParameters(s)};_.request.collectResourceTiming=this._collectResourceTiming;let m="RT";if(s.actor&&s.state!=="expired"){if(s.state==="loading")return new Promise(((v,w)=>{s.reloadPromise={resolve:v,reject:w}}))}else s.actor=this.dispatcher.getActor(),m="LT";s.abortController=new AbortController;try{const v=yield s.actor.sendAsync({type:m,data:_},s.abortController);if(delete s.abortController,s.aborted)return;this._afterTileLoadWorkerResponse(s,v)}catch(v){if(delete s.abortController,s.aborted)return;if(v&&v.status!==404)throw v;this._afterTileLoadWorkerResponse(s,null)}}))}_getOverzoomParameters(s){if(s.tileID.canonical.z<=this.maxzoom||this.map._zoomLevelsToOverscale===void 0)return;const u=s.tileID.scaledTo(this.maxzoom).canonical,_=u.url(this.tiles,this.map.getPixelRatio(),this.scheme);return{maxZoomTileID:u,overzoomRequest:this.map._requestManager.transformRequest(_,"Tile")}}_afterTileLoadWorkerResponse(s,u){if(u&&u.resourceTiming&&(s.resourceTiming=u.resourceTiming),u&&this.map._refreshExpiredTiles&&s.setExpiryData(u),s.loadVectorData(u,this.map.painter),s.reloadPromise){const _=s.reloadPromise;s.reloadPromise=null,this.loadTile(s).then(_.resolve).catch(_.reject)}}abortTile(s){return c._(this,void 0,void 0,(function*(){s.abortController&&(s.abortController.abort(),delete s.abortController),s.actor&&(yield s.actor.sendAsync({type:"AT",data:{uid:s.uid,type:this.type,source:this.id}}))}))}unloadTile(s){return c._(this,void 0,void 0,(function*(){s.unloadVectorData(),s.actor&&(yield s.actor.sendAsync({type:"RMT",data:{uid:s.uid,type:this.type,source:this.id}}))}))}hasTransition(){return!1}}class Os extends c.E{constructor(s,u,_,m){super(),this.id=s,this.dispatcher=_,this.setEventedParent(m),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=c.e({type:"raster"},u),c.e(this,c.S(u,["url","scheme","tileSize"]))}load(){return c._(this,arguments,void 0,(function*(s=!1){this._loaded=!1,this.fire(new c.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const u=yield Gr(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,u&&(c.e(this,u),u.bounds&&(this.tileBounds=new os(u.bounds,this.minzoom,this.maxzoom)),this.fire(new c.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.l("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:s})))}catch(u){this._tileJSONRequest=null,this._loaded=!0,this.fire(new c.k(u))}}))}loaded(){return this._loaded}onAdd(s){this.map=s,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(s){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),s(),this.load(!0)}setTiles(s){return this.setSourceProperty((()=>{this._options.tiles=s})),this}setUrl(s){return this.setSourceProperty((()=>{this.url=s,this._options.url=s})),this}serialize(){return c.e({},this._options)}hasTile(s){return!this.tileBounds||this.tileBounds.contains(s.canonical)}loadTile(s){return c._(this,void 0,void 0,(function*(){const u=s.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);s.abortController=new AbortController;try{const _=yield ae.getImage(this.map._requestManager.transformRequest(u,"Tile"),s.abortController,this.map._refreshExpiredTiles);if(delete s.abortController,s.aborted)return void(s.state="unloaded");if(_&&_.data){this.map._refreshExpiredTiles&&(_.cacheControl||_.expires)&&s.setExpiryData({cacheControl:_.cacheControl,expires:_.expires});const m=this.map.painter.context,v=m.gl,w=_.data;s.texture=this.map.painter.getTileTexture(w.width),s.texture?s.texture.update(w,{useMipmap:!0}):(s.texture=new c.T(m,w,v.RGBA,{useMipmap:!0}),s.texture.bind(v.LINEAR,v.CLAMP_TO_EDGE,v.LINEAR_MIPMAP_NEAREST)),s.state="loaded"}}catch(_){if(delete s.abortController,s.aborted)s.state="unloaded";else if(_)throw s.state="errored",_}}))}abortTile(s){return c._(this,void 0,void 0,(function*(){s.abortController&&(s.abortController.abort(),delete s.abortController)}))}unloadTile(s){return c._(this,void 0,void 0,(function*(){s.texture&&this.map.painter.saveTileTexture(s.texture)}))}hasTransition(){return!1}}class $r extends Os{constructor(s,u,_,m){super(s,u,_,m),this.type="raster-dem",this.maxzoom=22,this._options=c.e({type:"raster-dem"},u),this.encoding=u.encoding||"mapbox",this.redFactor=u.redFactor,this.greenFactor=u.greenFactor,this.blueFactor=u.blueFactor,this.baseShift=u.baseShift}loadTile(s){return c._(this,void 0,void 0,(function*(){const u=s.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),_=this.map._requestManager.transformRequest(u,"Tile");s.neighboringTiles=this._getNeighboringTiles(s.tileID),s.abortController=new AbortController;try{const m=yield ae.getImage(_,s.abortController,this.map._refreshExpiredTiles);if(delete s.abortController,s.aborted)return void(s.state="unloaded");if(m&&m.data){const v=m.data;this.map._refreshExpiredTiles&&(m.cacheControl||m.expires)&&s.setExpiryData({cacheControl:m.cacheControl,expires:m.expires});const w=c.b(v)&&c.Y()?v:yield this.readImageNow(v),S={type:this.type,uid:s.uid,source:this.id,rawImageData:w,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!s.actor||s.state==="expired"){s.actor=this.dispatcher.getActor();const I=yield s.actor.sendAsync({type:"LDT",data:S});s.dem=I,s.needsHillshadePrepare=!0,s.needsTerrainPrepare=!0,s.state="loaded"}}}catch(m){if(delete s.abortController,s.aborted)s.state="unloaded";else if(m)throw s.state="errored",m}}))}readImageNow(s){return c._(this,void 0,void 0,(function*(){if(typeof VideoFrame<"u"&&c.Z()){const u=s.width+2,_=s.height+2;try{return new c.R({width:u,height:_},yield c.$(s,-1,-1,u,_))}catch{}}return X.getImageData(s,1)}))}_getNeighboringTiles(s){const u=s.canonical,_=Math.pow(2,u.z),m=(u.x-1+_)%_,v=u.x===0?s.wrap-1:s.wrap,w=(u.x+1+_)%_,S=u.x+1===_?s.wrap+1:s.wrap,I={};return I[new c.a0(s.overscaledZ,v,u.z,m,u.y).key]={backfilled:!1},I[new c.a0(s.overscaledZ,S,u.z,w,u.y).key]={backfilled:!1},u.y>0&&(I[new c.a0(s.overscaledZ,v,u.z,m,u.y-1).key]={backfilled:!1},I[new c.a0(s.overscaledZ,s.wrap,u.z,u.x,u.y-1).key]={backfilled:!1},I[new c.a0(s.overscaledZ,S,u.z,w,u.y-1).key]={backfilled:!1}),u.y+1<_&&(I[new c.a0(s.overscaledZ,v,u.z,m,u.y+1).key]={backfilled:!1},I[new c.a0(s.overscaledZ,s.wrap,u.z,u.x,u.y+1).key]={backfilled:!1},I[new c.a0(s.overscaledZ,S,u.z,w,u.y+1).key]={backfilled:!1}),I}unloadTile(s){return c._(this,void 0,void 0,(function*(){s.demTexture&&this.map.painter.saveTileTexture(s.demTexture),s.fbo&&(s.fbo.destroy(),delete s.fbo),s.dem&&delete s.dem,delete s.neighboringTiles,s.state="unloaded",s.actor&&(yield s.actor.sendAsync({type:"RDT",data:{type:this.type,uid:s.uid,source:this.id}}))}))}}function ws(b){return b.type==="GeometryCollection"?b.geometries.map((s=>s.coordinates)).flat(1/0):b.coordinates.flat(1/0)}function dn(b){const s=new We;let u;switch(b.type){case"FeatureCollection":u=b.features.map((_=>ws(_.geometry))).flat(1/0);break;case"Feature":u=ws(b.geometry);break;default:u=ws(b)}if(u.length==0)return s;for(let _=0;_<u.length-1;_+=2)s.extend([u[_],u[_+1]]);return s}class Dn extends c.E{constructor(s,u,_,m){super(),this.id=s,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._isUpdatingWorker=!1,this._pendingWorkerUpdate={data:u.data},this.actor=_.getActor(),this.setEventedParent(m),this._data=u.data,this._options=c.e({},u),this._collectResourceTiming=u.collectResourceTiming,u.maxzoom!==void 0&&(this.maxzoom=u.maxzoom),u.type&&(this.type=u.type),u.attribution&&(this.attribution=u.attribution),this.promoteId=u.promoteId,u.clusterMaxZoom!==void 0&&this.maxzoom<=u.clusterMaxZoom&&c.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${u.clusterMaxZoom}".`),this.workerOptions=c.e({source:this.id,cluster:u.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(u.buffer!==void 0?u.buffer:128),tolerance:this._pixelsToTileUnits(u.tolerance!==void 0?u.tolerance:.375),extent:c.a3,maxZoom:this.maxzoom,lineMetrics:u.lineMetrics||!1,generateId:u.generateId||!1},superclusterOptions:{maxZoom:this._getClusterMaxZoom(u.clusterMaxZoom),minPoints:Math.max(2,u.clusterMinPoints||2),extent:c.a3,radius:this._pixelsToTileUnits(u.clusterRadius||50),log:!1,generateId:u.generateId||!1},clusterProperties:u.clusterProperties,filter:u.filter},u.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}_hasPendingWorkerUpdate(){return this._pendingWorkerUpdate.data!==void 0||this._pendingWorkerUpdate.diff!==void 0||this._pendingWorkerUpdate.optionsChanged}_pixelsToTileUnits(s){return s*(c.a3/this.tileSize)}_getClusterMaxZoom(s){const u=s?Math.round(s):this.maxzoom-1;return Number.isInteger(s)||s===void 0||c.w(`Integer expected for option 'clusterMaxZoom': provided value "${s}" rounded to "${u}"`),u}load(){return c._(this,void 0,void 0,(function*(){yield this._updateWorkerData()}))}onAdd(s){this.map=s,this.load()}setData(s){return this._data=s,this._pendingWorkerUpdate={data:s},this._updateWorkerData(),this}updateData(s){return this._pendingWorkerUpdate.diff=c.a4(this._pendingWorkerUpdate.diff,s),this._updateWorkerData(),this}getData(){return c._(this,void 0,void 0,(function*(){const s=c.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:s})}))}getBounds(){return c._(this,void 0,void 0,(function*(){return dn(yield this.getData())}))}setClusterOptions(s){return this.workerOptions.cluster=s.cluster,s.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(s.clusterRadius)),s.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=this._getClusterMaxZoom(s.clusterMaxZoom)),this._pendingWorkerUpdate.optionsChanged=!0,this._updateWorkerData(),this}getClusterExpansionZoom(s){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:s,source:this.id}})}getClusterChildren(s){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:s,source:this.id}})}getClusterLeaves(s,u,_){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:s,limit:u,offset:_}})}_updateWorkerData(){return c._(this,void 0,void 0,(function*(){if(this._isUpdatingWorker)return;if(!this._hasPendingWorkerUpdate())return void c.w(`No pending worker updates for GeoJSONSource ${this.id}.`);const{data:s,diff:u}=this._pendingWorkerUpdate,_=c.e({type:this.type},this.workerOptions);s?(typeof s=="string"?(_.request=this.map._requestManager.transformRequest(X.resolveURL(s),"Source"),_.request.collectResourceTiming=this._collectResourceTiming):_.data=JSON.stringify(s),this._pendingWorkerUpdate.data=void 0):u&&(_.dataDiff=u,this._pendingWorkerUpdate.diff=void 0),this._pendingWorkerUpdate.optionsChanged=void 0,this._isUpdatingWorker=!0,this.fire(new c.l("dataloading",{dataType:"source"}));try{const m=yield this.actor.sendAsync({type:"LD",data:_});if(this._isUpdatingWorker=!1,this._removed||m.abandoned)return void this.fire(new c.l("dataabort",{dataType:"source"}));this._data=m.data;let v=null;m.resourceTiming&&m.resourceTiming[this.id]&&(v=m.resourceTiming[this.id].slice(0));const w={dataType:"source"};this._collectResourceTiming&&v&&v.length>0&&c.e(w,{resourceTiming:v}),this.fire(new c.l("data",Object.assign(Object.assign({},w),{sourceDataType:"metadata"}))),this.fire(new c.l("data",Object.assign(Object.assign({},w),{sourceDataType:"content",shouldReloadTileOptions:this._getShouldReloadTileOptions(u)})))}catch(m){if(this._isUpdatingWorker=!1,this._removed)return void this.fire(new c.l("dataabort",{dataType:"source"}));this.fire(new c.k(m))}finally{this._hasPendingWorkerUpdate()&&this._updateWorkerData()}}))}_getShouldReloadTileOptions(s){if(!s||s.removeAll)return;const{add:u=[],update:_=[],remove:m=[]}=s||{},v=new Set([..._.map((w=>w.id)),...m]);return{nextBounds:[..._.map((w=>w.newGeometry)),...u.map((w=>w.geometry))].map((w=>dn(w))),prevIds:v}}shouldReloadTile(s,{nextBounds:u,prevIds:_}){const m=s.latestFeatureIndex.loadVTLayers();for(let I=0;I<s.latestFeatureIndex.featureIndexArray.length;I++){const B=s.latestFeatureIndex.featureIndexArray.get(I),D=m._geojsonTileLayer.feature(B.featureIndex);if(_.has(D.id))return!0}const{buffer:v,extent:w}=this.workerOptions.geojsonVtOptions,S=(function({x:I,y:B,z:D},U=0){const k=c.a1((I-U)/Math.pow(2,D)),j=c.a2((B+1+U)/Math.pow(2,D)),W=c.a1((I+1+U)/Math.pow(2,D)),Q=c.a2((B-U)/Math.pow(2,D));return new We([k,j],[W,Q])})(s.tileID.canonical,v/w);for(const I of u)if(S.intersects(I))return!0;return!1}loaded(){return!this._isUpdatingWorker&&!this._hasPendingWorkerUpdate()}loadTile(s){return c._(this,void 0,void 0,(function*(){const u=s.actor?"RT":"LT";s.actor=this.actor;const _={type:this.type,uid:s.uid,tileID:s.tileID,zoom:s.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};s.abortController=new AbortController;const m=yield this.actor.sendAsync({type:u,data:_},s.abortController);delete s.abortController,s.unloadVectorData(),s.aborted||s.loadVectorData(m,this.map.painter,u==="RT")}))}abortTile(s){return c._(this,void 0,void 0,(function*(){s.abortController&&(s.abortController.abort(),delete s.abortController),s.aborted=!0}))}unloadTile(s){return c._(this,void 0,void 0,(function*(){s.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:s.uid,type:this.type,source:this.id}})}))}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return c.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}class Bi extends c.E{constructor(s,u,_,m){super(),this.flippedWindingOrder=!1,this.id=s,this.dispatcher=_,this.coordinates=u.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(m),this.options=u}load(s){return c._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new c.l("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const u=yield ae.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,u&&u.data&&(this.image=u.data,s&&(this.coordinates=s),this._finishLoading())}catch(u){this._request=null,this._loaded=!0,this.fire(new c.k(u))}}))}loaded(){return this._loaded}updateImage(s){return s.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=s.url,this.load(s.coordinates).finally((()=>{this.texture=null})),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new c.l("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(s){this.map=s,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(s){this.coordinates=s;const u=s.map(c.a5.fromLngLat);var _;return this.tileID=(function(m){const v=c.a6.fromPoints(m),w=v.width(),S=v.height(),I=Math.max(w,S),B=Math.max(0,Math.floor(-Math.log(I)/Math.LN2)),D=Math.pow(2,B);return new c.a8(B,Math.floor((v.minX+v.maxX)/2*D),Math.floor((v.minY+v.maxY)/2*D))})(u),this.terrainTileRanges=this._getOverlappingTileRanges(u),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=u.map((m=>this.tileID.getTilePoint(m)._round())),this.flippedWindingOrder=((_=this.tileCoords)[1].x-_[0].x)*(_[2].y-_[0].y)-(_[1].y-_[0].y)*(_[2].x-_[0].x)<0,this.fire(new c.l("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const s=this.map.painter.context,u=s.gl;this.texture||(this.texture=new c.T(s,this.image,u.RGBA),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE));let _=!1;for(const m in this.tiles){const v=this.tiles[m];v.state!=="loaded"&&(v.state="loaded",v.texture=this.texture,_=!0)}_&&this.fire(new c.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(s){return c._(this,void 0,void 0,(function*(){this.tileID&&this.tileID.equals(s.tileID.canonical)?(this.tiles[String(s.tileID.wrap)]=s,s.buckets={}):s.state="errored"}))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}_getOverlappingTileRanges(s){const{minX:u,minY:_,maxX:m,maxY:v}=c.a6.fromPoints(s),w={};for(let S=0;S<=c.a7;S++){const I=Math.pow(2,S),B=Math.floor(u*I),D=Math.floor(_*I),U=Math.floor(m*I),k=Math.floor(v*I);w[S]={minTileX:B,minTileY:D,maxTileX:U,maxTileY:k}}return w}}class Po extends Bi{constructor(s,u,_,m){super(s,u,_,m),this.roundZoom=!0,this.type="video",this.options=u}load(){return c._(this,void 0,void 0,(function*(){this._loaded=!1;const s=this.options;this.urls=[];for(const u of s.urls)this.urls.push(this.map._requestManager.transformRequest(u,"Source").url);try{const u=yield c.a9(this.urls);if(this._loaded=!0,!u)return;this.video=u,this.video.loop=!0,this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading()}catch(u){this.fire(new c.k(u))}}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(s){if(this.video){const u=this.video.seekable;s<u.start(0)||s>u.end(0)?this.fire(new c.k(new c.aa(`sources.${this.id}`,null,`Playback for this video can be set only between the ${u.start(0)} and ${u.end(0)}-second mark.`))):this.video.currentTime=s}}getVideo(){return this.video}onAdd(s){this.map||(this.map=s,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const s=this.map.painter.context,u=s.gl;this.texture?this.video.paused||(this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE),u.texSubImage2D(u.TEXTURE_2D,0,0,0,u.RGBA,u.UNSIGNED_BYTE,this.video)):(this.texture=new c.T(s,this.video,u.RGBA),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE));let _=!1;for(const m in this.tiles){const v=this.tiles[m];v.state!=="loaded"&&(v.state="loaded",v.texture=this.texture,_=!0)}_&&this.fire(new c.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class co extends Bi{constructor(s,u,_,m){super(s,u,_,m),u.coordinates?Array.isArray(u.coordinates)&&u.coordinates.length===4&&!u.coordinates.some((v=>!Array.isArray(v)||v.length!==2||v.some((w=>typeof w!="number"))))||this.fire(new c.k(new c.aa(`sources.${s}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new c.k(new c.aa(`sources.${s}`,null,'missing required property "coordinates"'))),u.animate&&typeof u.animate!="boolean"&&this.fire(new c.k(new c.aa(`sources.${s}`,null,'optional "animate" property must be a boolean value'))),u.canvas?typeof u.canvas=="string"||u.canvas instanceof HTMLCanvasElement||this.fire(new c.k(new c.aa(`sources.${s}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new c.k(new c.aa(`sources.${s}`,null,'missing required property "canvas"'))),this.options=u,this.animate=u.animate===void 0||u.animate}load(){return c._(this,void 0,void 0,(function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new c.k(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}))}getCanvas(){return this.canvas}onAdd(s){this.map=s,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let s=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,s=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,s=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const u=this.map.painter.context,_=u.gl;this.texture?(s||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new c.T(u,this.canvas,_.RGBA,{premultiply:!0});let m=!1;for(const v in this.tiles){const w=this.tiles[v];w.state!=="loaded"&&(w.state="loaded",w.texture=this.texture,m=!0)}m&&this.fire(new c.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",animate:this.animate,canvas:this.options.canvas,coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const s of[this.canvas.width,this.canvas.height])if(isNaN(s)||s<=0)return!0;return!1}}const fn={},Fn=b=>{switch(b){case"geojson":return Dn;case"image":return Bi;case"raster":return Os;case"raster-dem":return $r;case"vector":return as;case"video":return Po;case"canvas":return co}return fn[b]},ks="RTLPluginLoaded";class Ns extends c.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=xs()}_syncState(s){return this.status=s,this.dispatcher.broadcast("SRPS",{pluginStatus:s,pluginURL:this.url}).catch((u=>{throw this.status="error",u}))}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(s){return c._(this,arguments,void 0,(function*(u,_=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=X.resolveURL(u),!this.url)throw new Error(`requested url ${u} is invalid`);if(this.status==="unavailable"){if(!_)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()}))}_requestImport(){return c._(this,void 0,void 0,(function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new c.l(ks))}))}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let Ls=null;function ls(){return Ls||(Ls=new Ns),Ls}var ji,yt;(function(b){b[b.Base=0]="Base",b[b.Parent=1]="Parent"})(ji||(ji={})),(function(b){b[b.Departing=0]="Departing",b[b.Incoming=1]="Incoming"})(yt||(yt={}));class G{constructor(s,u){this.timeAdded=0,this.fadeEndTime=0,this.fadeOpacity=1,this.tileID=s,this.uid=c.ab(),this.uses=0,this.tileSize=u,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}isRenderable(s){return this.hasData()&&(!this.fadeEndTime||this.fadeOpacity>0)&&(s||!this.holdingForSymbolFade())}setCrossFadeLogic({fadingRole:s,fadingDirection:u,fadingParentID:_,fadeEndTime:m}){this.resetFadeLogic(),this.fadingRole=s,this.fadingDirection=u,this.fadingParentID=_,this.fadeEndTime=m}setSelfFadeLogic(s){this.resetFadeLogic(),this.selfFading=!0,this.fadeEndTime=s}resetFadeLogic(){this.fadingRole=null,this.fadingDirection=null,this.fadingParentID=null,this.selfFading=!1,this.timeAdded=nt(),this.fadeEndTime=0,this.fadeOpacity=1}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(s){this.demTexture&&s.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(s,u,_){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",s){s.featureIndex&&(this.latestFeatureIndex=s.featureIndex,s.rawTileData?(this.latestRawTileData=s.rawTileData,this.latestFeatureIndex.rawTileData=s.rawTileData,this.latestFeatureIndex.encoding=s.encoding):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData,this.latestFeatureIndex.encoding=this.latestEncoding)),this.collisionBoxArray=s.collisionBoxArray,this.buckets=(function(m,v){const w={};if(!v)return w;for(const S of m){const I=S.layerIds.map((B=>v.getLayer(B))).filter(Boolean);if(I.length!==0){S.layers=I,S.stateDependentLayerIds&&(S.stateDependentLayers=S.stateDependentLayerIds.map((B=>I.filter((D=>D.id===B))[0])));for(const B of I)w[B.id]=S}}return w})(s.buckets,u?.style),this.hasSymbolBuckets=!1;for(const m in this.buckets){const v=this.buckets[m];if(v instanceof c.ad){if(this.hasSymbolBuckets=!0,!_)break;v.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const m in this.buckets){const v=this.buckets[m];if(v instanceof c.ad&&v.hasRTLText){this.hasRTLText=!0,ls().lazyLoad();break}}this.queryPadding=0;for(const m in this.buckets){const v=this.buckets[m];this.queryPadding=Math.max(this.queryPadding,u.style.getLayer(m).queryRadius(v))}s.imageAtlas&&(this.imageAtlas=s.imageAtlas),s.glyphAtlasImage&&(this.glyphAtlasImage=s.glyphAtlasImage),this.dashPositions=s.dashPositions}else this.collisionBoxArray=new c.ac}unloadVectorData(){for(const s in this.buckets)this.buckets[s].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.dashPositions&&(this.dashPositions=null),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(s){return this.buckets[s.id]}upload(s){for(const _ in this.buckets){const m=this.buckets[_];m.uploadPending()&&m.upload(s)}const u=s.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new c.T(s,this.imageAtlas.image,u.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new c.T(s,this.glyphAtlasImage,u.ALPHA),this.glyphAtlasImage=null)}prepare(s){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(s,this.imageAtlasTexture)}queryRenderedFeatures(s,u,_,m,v,w,S,I,B,D,U){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:m,cameraQueryGeometry:v,scale:w,tileSize:this.tileSize,pixelPosMatrix:D,transform:I,params:S,queryPadding:this.queryPadding*B,getElevation:U},s,u,_):{}}querySourceFeatures(s,u){const _=this.latestFeatureIndex;if(!_||!_.rawTileData)return;const m=_.loadVTLayers(),v=u&&u.sourceLayer?u.sourceLayer:"",w=m._geojsonTileLayer||m[v];if(!w)return;const S=c.ae(u?.filter,u?.globalState),{z:I,x:B,y:D}=this.tileID.canonical,U={z:I,x:B,y:D};for(let k=0;k<w.length;k++){const j=w.feature(k);if(S.needGeometry){const et=c.af(j,!0);if(!S.filter(new c.G(this.tileID.overscaledZ),et,this.tileID.canonical))continue}else if(!S.filter(new c.G(this.tileID.overscaledZ),j))continue;const W=_.getId(j,v),Q=new c.ag(j,I,B,D,W);Q.tile=U,s.push(Q)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(s){const u=this.expirationTime;if(s.cacheControl){const _=c.ah(s.cacheControl);_["max-age"]&&(this.expirationTime=Date.now()+1e3*_["max-age"])}else s.expires&&(this.expirationTime=new Date(s.expires).getTime());if(this.expirationTime){const _=Date.now();let m=!1;if(this.expirationTime>_)m=!1;else if(u)if(this.expirationTime<u)m=!0;else{const v=this.expirationTime-u;v?this.expirationTime=_+Math.max(v,3e4):m=!0}else m=!0;m?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(s,u){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(s).length===0)return;const _=this.latestFeatureIndex.loadVTLayers();for(const m in this.buckets){if(!u.style.hasLayer(m))continue;const v=this.buckets[m],w=v.layers[0].sourceLayer||"_geojsonTileLayer",S=_[w],I=s[w];if(!S||!I||Object.keys(I).length===0)continue;v.update(I,S,this.imageAtlas&&this.imageAtlas.patternPositions||{},this.dashPositions||{});const B=u&&u.style&&u.style.getLayer(m);B&&(this.queryPadding=Math.max(this.queryPadding,B.queryRadius(v)))}}holdingForSymbolFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<nt()}clearSymbolFadeHold(){this.symbolFadeHoldUntil=void 0}setSymbolHoldDuration(s){this.symbolFadeHoldUntil=nt()+s}setDependencies(s,u){const _={};for(const m of u)_[m]=!0;this.dependencies[s]=_}hasDependency(s,u){for(const _ of s){const m=this.dependencies[_];if(m){for(const v of u)if(m[v])return!0}}return!1}}class ${constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(s,u,_){const m=String(u);if(this.stateChanges[s]=this.stateChanges[s]||{},this.stateChanges[s][m]=this.stateChanges[s][m]||{},c.e(this.stateChanges[s][m],_),this.deletedStates[s]===null){this.deletedStates[s]={};for(const v in this.state[s])v!==m&&(this.deletedStates[s][v]=null)}else if(this.deletedStates[s]&&this.deletedStates[s][m]===null){this.deletedStates[s][m]={};for(const v in this.state[s][m])_[v]||(this.deletedStates[s][m][v]=null)}else for(const v in _)this.deletedStates[s]&&this.deletedStates[s][m]&&this.deletedStates[s][m][v]===null&&delete this.deletedStates[s][m][v]}removeFeatureState(s,u,_){if(this.deletedStates[s]===null)return;const m=String(u);if(this.deletedStates[s]=this.deletedStates[s]||{},_&&u!==void 0)this.deletedStates[s][m]!==null&&(this.deletedStates[s][m]=this.deletedStates[s][m]||{},this.deletedStates[s][m][_]=null);else if(u!==void 0)if(this.stateChanges[s]&&this.stateChanges[s][m])for(_ in this.deletedStates[s][m]={},this.stateChanges[s][m])this.deletedStates[s][m][_]=null;else this.deletedStates[s][m]=null;else this.deletedStates[s]=null}getState(s,u){const _=String(u),m=c.e({},(this.state[s]||{})[_],(this.stateChanges[s]||{})[_]);if(this.deletedStates[s]===null)return{};if(this.deletedStates[s]){const v=this.deletedStates[s][u];if(v===null)return{};for(const w in v)delete m[w]}return m}initializeTileState(s,u){s.setFeatureState(this.state,u)}coalesceChanges(s,u){const _={};for(const m in this.stateChanges){this.state[m]=this.state[m]||{};const v={};for(const w in this.stateChanges[m])this.state[m][w]||(this.state[m][w]={}),c.e(this.state[m][w],this.stateChanges[m][w]),v[w]=this.state[m][w];_[m]=v}for(const m in this.deletedStates){this.state[m]=this.state[m]||{};const v={};if(this.deletedStates[m]===null)for(const w in this.state[m])v[w]={},this.state[m][w]={};else for(const w in this.deletedStates[m]){if(this.deletedStates[m][w]===null)this.state[m][w]={};else for(const S of Object.keys(this.deletedStates[m][w]))delete this.state[m][w][S];v[w]=this.state[m][w]}_[m]=_[m]||{},c.e(_[m],v)}if(this.stateChanges={},this.deletedStates={},Object.keys(_).length!==0)for(const m in s)s[m].setFeatureState(_,u)}}const Z=89.25;function ht(b,s){const u=c.ai(s.lat,-c.aj,c.aj);return new c.P(c.X(s.lng)*b,c.W(u)*b)}function ft(b,s){return new c.a5(s.x/b,s.y/b).toLngLat()}function Tt(b){return b.cameraToCenterDistance*Math.min(.85*Math.tan(c.ak(90-b.pitch)),Math.tan(c.ak(Z-b.pitch)))}function tt(b,s){const u=b.canonical,_=s/c.al(u.z),m=u.x+Math.pow(2,u.z)*b.wrap,v=c.am(new Float64Array(16));return c.N(v,v,[m*_,u.y*_,0]),c.O(v,v,[_/c.a3,_/c.a3,1]),v}function xt(b,s,u,_,m){const v=c.a5.fromLngLat(b,s),w=m*c.an(1,b.lat),S=w*Math.cos(c.ak(u)),I=Math.sqrt(w*w-S*S),B=I*Math.sin(c.ak(-_)),D=I*Math.cos(c.ak(-_));return new c.a5(v.x+B,v.y+D,v.z+S)}function kt(b,s,u){const _=s.intersectsFrustum(b);if(!u||_===0)return _;const m=s.intersectsPlane(u);return m===0?0:_===2&&m===2?2:1}function Lt(b,s,u){let _=0;const m=(u-s)/10;for(let v=0;v<10;v++)_+=m*Math.pow(Math.cos(s+(v+.5)/10*(u-s)),b);return _}function Ut(b,s){return function(u,_,m,v,w){const S=2*((b-1)/c.ao(Math.cos(c.ak(Z-w))/Math.cos(c.ak(Z)))-1),I=Math.acos(m/v),B=2*Lt(S-1,0,c.ak(w/2)),D=Math.min(c.ak(Z),I+c.ak(w/2)),U=Lt(S-1,Math.min(D,I-c.ak(w/2)),D),k=Math.atan(_/m),j=Math.hypot(_,m);let W=u;return W+=c.ao(v/j/Math.max(.5,Math.cos(c.ak(w/2)))),W+=S*c.ao(Math.cos(k))/2,W-=c.ao(Math.max(1,U/B/s))/2,W}}const ne=Ut(9.314,3);function ge(b,s){const u=(s.roundZoom?Math.round:Math.floor)(b.zoom+c.ao(b.tileSize/s.tileSize));return Math.max(0,u)}function Ee(b,s){const u=b.getCameraFrustum(),_=b.getClippingPlane(),m=b.screenPointToMercatorCoordinate(b.getCameraPoint()),v=c.a5.fromLngLat(b.center,b.elevation);m.z=v.z+Math.cos(b.pitchInRadians)*b.cameraToCenterDistance/b.worldSize;const w=b.getCoveringTilesDetailsProvider(),S=w.allowVariableZoom(b,s),I=ge(b,s),B=s.minzoom||0,D=s.maxzoom!==void 0?s.maxzoom:b.maxZoom,U=Math.min(Math.max(0,I),D),k=Math.pow(2,U),j=[k*m.x,k*m.y,0],W=[k*v.x,k*v.y,0],Q=Math.hypot(v.x-m.x,v.y-m.y),et=Math.abs(v.z-m.z),st=Math.hypot(Q,et),ut=gt=>({zoom:0,x:0,y:0,wrap:gt,fullyVisible:!1}),_t=[],lt=[];if(b.renderWorldCopies&&w.allowWorldCopies())for(let gt=1;gt<=3;gt++)_t.push(ut(-gt)),_t.push(ut(gt));for(_t.push(ut(0));_t.length>0;){const gt=_t.pop(),mt=gt.x,dt=gt.y;let wt=gt.fullyVisible;const Ft={x:mt,y:dt,z:gt.zoom},Mt=w.getTileBoundingVolume(Ft,gt.wrap,b.elevation,s);if(!wt){const Zt=kt(u,Mt,_);if(Zt===0)continue;wt=Zt===2}const Rt=w.distanceToTile2d(m.x,m.y,Ft,Mt);let Ot=I;S&&(Ot=(s.calculateTileZoom||ne)(b.zoom+c.ao(b.tileSize/s.tileSize),Rt,et,st,b.fov)),Ot=(s.roundZoom?Math.round:Math.floor)(Ot),Ot=Math.max(0,Ot);const qt=Math.min(Ot,D);if(gt.wrap=w.getWrap(v,Ft,gt.wrap),gt.zoom>=qt){if(gt.zoom<B)continue;const Zt=U-gt.zoom,Gt=j[0]-.5-(mt<<Zt),he=j[1]-.5-(dt<<Zt),pe=s.reparseOverscaled?Math.max(gt.zoom,Ot):gt.zoom;lt.push({tileID:new c.a0(gt.zoom===D?pe:gt.zoom,gt.wrap,gt.zoom,mt,dt),distanceSq:c.ap([W[0]-.5-mt,W[1]-.5-dt]),tileDistanceToCamera:Math.sqrt(Gt*Gt+he*he)})}else for(let Zt=0;Zt<4;Zt++)_t.push({zoom:gt.zoom+1,x:(mt<<1)+Zt%2,y:(dt<<1)+(Zt>>1),wrap:gt.wrap,fullyVisible:wt})}return lt.sort(((gt,mt)=>gt.distanceSq-mt.distanceSq)).map((gt=>gt.tileID))}const Sr=c.a6.fromPoints([new c.P(0,0),new c.P(c.a3,c.a3)]);class Pe extends c.E{constructor(s,u,_){super(),this.id=s,this.dispatcher=_,this.on("data",(m=>this._dataHandler(m))),this.on("dataloading",(()=>{this._sourceErrored=!1})),this.on("error",(()=>{this._sourceErrored=this._source.loaded()})),this._source=((m,v,w,S)=>{const I=new(Fn(v.type))(m,v,w,S);if(I.id!==m)throw new Error(`Expected Source id to be ${m} instead of ${I.id}`);return I})(s,u,_,this),this._tiles={},this._cache=new c.aq(0,(m=>this._unloadTile(m))),this._timers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._rasterFadeDuration=0,this._maxFadingAncestorLevels=5,this._state=new $,this._didEmitContent=!1,this._updated=!1}onAdd(s){this.map=s,this._maxTileCacheSize=s?s._maxTileCacheSize:null,this._maxTileCacheZoomLevels=s?s._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(s)}onRemove(s){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(s)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const s in this._tiles){const u=this._tiles[s];if(u.state!=="loaded"&&u.state!=="errored")return!1}return!0}getSource(){return this._source}getState(){return this._state}pause(){this._paused=!0}resume(){if(!this._paused)return;const s=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,s&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(s,u,_){return c._(this,void 0,void 0,(function*(){try{yield this._source.loadTile(s),this._tileLoaded(s,u,_)}catch(m){s.state="errored",m.status!==404?this._source.fire(new c.k(m,{tile:s})):this.update(this.transform,this.terrain)}}))}_unloadTile(s){this._source.unloadTile&&this._source.unloadTile(s)}_abortTile(s){this._source.abortTile&&this._source.abortTile(s),this._source.fire(new c.l("dataabort",{tile:s,coord:s.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(s){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const u in this._tiles){const _=this._tiles[u];_.upload(s),_.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map((s=>s.tileID)).sort(Ve).map((s=>s.key))}getRenderableIds(s){const u=[];for(const _ in this._tiles)this._isIdRenderable(_,s)&&u.push(this._tiles[_]);return s?u.sort(((_,m)=>{const v=_.tileID,w=m.tileID,S=new c.P(v.canonical.x,v.canonical.y)._rotate(-this.transform.bearingInRadians),I=new c.P(w.canonical.x,w.canonical.y)._rotate(-this.transform.bearingInRadians);return v.overscaledZ-w.overscaledZ||I.y-S.y||I.x-S.x})).map((_=>_.tileID.key)):u.map((_=>_.tileID)).sort(Ve).map((_=>_.key))}hasRenderableParent(s){const u=s.overscaledZ-1;if(u>=this._source.minzoom){const _=this.getLoadedTile(s.scaledTo(u));if(_)return this._isIdRenderable(_.tileID.key)}return!1}_isIdRenderable(s,u=!1){var _;return(_=this._tiles[s])===null||_===void 0?void 0:_.isRenderable(u)}reload(s,u=void 0){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const _ in this._tiles)u&&this._source.shouldReloadTile&&!this._source.shouldReloadTile(this._tiles[_],u)||(s?this._reloadTile(_,"expired"):this._tiles[_].state!=="errored"&&this._reloadTile(_,"reloading"))}}_reloadTile(s,u){return c._(this,void 0,void 0,(function*(){const _=this._tiles[s];_&&(_.state!=="loading"&&(_.state=u),yield this._loadTile(_,s,u))}))}_tileLoaded(s,u,_){s.timeAdded=nt(),s.selfFading&&(s.fadeEndTime=s.timeAdded+this._rasterFadeDuration),_==="expired"&&(s.refreshedUponExpiration=!0),this._setTileReloadTimer(u,s),this.getSource().type==="raster-dem"&&s.dem&&this._backfillDEM(s),this._state.initializeTileState(s,this.map?this.map.painter:null),s.aborted||this._source.fire(new c.l("data",{dataType:"source",tile:s,coord:s.tileID}))}_backfillDEM(s){const u=this.getRenderableIds();for(let m=0;m<u.length;m++){const v=u[m];if(s.neighboringTiles&&s.neighboringTiles[v]){const w=this.getTileByID(v);_(s,w),_(w,s)}}function _(m,v){m.needsHillshadePrepare=!0,m.needsTerrainPrepare=!0;let w=v.tileID.canonical.x-m.tileID.canonical.x;const S=v.tileID.canonical.y-m.tileID.canonical.y,I=Math.pow(2,m.tileID.canonical.z),B=v.tileID.key;w===0&&S===0||Math.abs(S)>1||(Math.abs(w)>1&&(Math.abs(w+I)===1?w+=I:Math.abs(w-I)===1&&(w-=I)),v.dem&&m.dem&&(m.dem.backfillBorder(v.dem,w,S),m.neighboringTiles&&m.neighboringTiles[B]&&(m.neighboringTiles[B].backfilled=!0)))}}getTile(s){return this.getTileByID(s.key)}getTileByID(s){return this._tiles[s]}_retainLoadedChildren(s,u){const _=Object.values(s),m=this._getLoadedDescendents(_),v={};for(const w of _){const S=m[w.key];if(!S?.length){v[w.key]=w;continue}const I=w.overscaledZ+Pe.maxUnderzooming,B=S.filter((k=>k.tileID.overscaledZ<=I));if(!B.length){v[w.key]=w;continue}const D=Math.min(...B.map((k=>k.tileID.overscaledZ))),U=B.filter((k=>k.tileID.overscaledZ===D)).map((k=>k.tileID));for(const k of U)u[k.key]=k;this._areDescendentsComplete(U,D,w.overscaledZ)||(v[w.key]=w)}return v}_getLoadedDescendents(s){var u;const _={};for(const m in this._tiles){const v=this._tiles[m];if(v.hasData())for(const w of s)v.tileID.isChildOf(w)&&(_[u=w.key]||(_[u]=[])).push(v)}return _}_areDescendentsComplete(s,u,_){return s.length===1&&s[0].isOverscaled()?s[0].overscaledZ===u:Math.pow(4,u-_)===s.length}getLoadedTile(s){const u=this._tiles[s.key];return u?.hasData()?u:null}updateCacheSize(s){const u=Math.ceil(s.width/this._source.tileSize)+1,_=Math.ceil(s.height/this._source.tileSize)+1,m=Math.floor(u*_*(this._maxTileCacheZoomLevels===null?c.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),v=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,m):m;this._cache.setMaxSize(v)}handleWrapJump(s){const u=Math.round((s-(this._prevLng===void 0?s:this._prevLng))/360);if(this._prevLng=s,u){const _={};for(const m in this._tiles){const v=this._tiles[m];v.tileID=v.tileID.unwrapTo(v.tileID.wrap+u),_[v.tileID.key]=v}this._tiles=_,this._resetTileReloadTimers()}}update(s,u){if(!this._sourceLoaded||this._paused)return;let _;this.transform=s,this.terrain=u,this.updateCacheSize(s),this.handleWrapJump(this.transform.center.lng),this.used||this.usedForTerrain?this._source.tileID?_=s.getVisibleUnwrappedCoordinates(this._source.tileID).map((I=>new c.a0(I.canonical.z,I.wrap,I.canonical.z,I.canonical.x,I.canonical.y))):(_=Ee(s,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.type==="vector"&&this.map._zoomLevelsToOverscale!==void 0?s.maxZoom-this.map._zoomLevelsToOverscale:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:u,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(_=_.filter((I=>this._source.hasTile(I))))):_=[],this.usedForTerrain&&(_=this._addTerrainIdealTiles(_));const m=_.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,m&&this.fire(new c.l("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const v=ge(s,this._source),w=this._updateRetainedTiles(_,v),S=rr(this._source.type);S&&this._rasterFadeDuration>0&&!u&&this._updateFadingTiles(_,w),S?this._cleanUpRasterTiles(w):this._cleanUpVectorTiles(w)}_cleanUpRasterTiles(s){for(const u in this._tiles)s[u]||this._removeTile(u)}_cleanUpVectorTiles(s){for(const u in this._tiles){const _=this._tiles[u];s[u]?_.clearSymbolFadeHold():_.hasSymbolBuckets?_.holdingForSymbolFade()?_.symbolFadeFinished()&&this._removeTile(u):_.setSymbolHoldDuration(this.map._fadeDuration):this._removeTile(u)}}_addTerrainIdealTiles(s){const u=[];for(const _ of s)if(_.canonical.z>this._source.minzoom){const m=_.scaledTo(_.canonical.z-1);u.push(m);const v=_.scaledTo(Math.max(this._source.minzoom,Math.min(_.canonical.z,5)));u.push(v)}return s.concat(u)}releaseSymbolFadeTiles(){for(const s in this._tiles)this._tiles[s].holdingForSymbolFade()&&this._removeTile(s)}_updateRetainedTiles(s,u){var _;const m={},v={},w=Math.max(u-Pe.maxOverzooming,this._source.minzoom);let S={};for(const I of s){const B=this._addTile(I);m[I.key]=I,B.hasData()||(S[I.key]=I)}S=this._retainLoadedChildren(S,m);for(const I in S){const B=S[I];let D=this._tiles[I],U=D?.wasRequested();for(let k=B.overscaledZ-1;k>=w;--k){const j=B.scaledTo(k);if(v[j.key])break;if(v[j.key]=!0,D=this.getTile(j),!D&&U&&(D=this._addTile(j)),D){const W=D.hasData();if((W||!(!((_=this.map)===null||_===void 0)&&_.cancelPendingTileRequestsWhileZooming)||U)&&(m[j.key]=j),U=D.wasRequested(),W)break}}}return m}_updateFadingTiles(s,u){const _=nt(),m=c.ar(s);for(const v of s){const w=this._tiles[v.key];w.fadingDirection!==yt.Departing&&w.fadeOpacity!==0||w.resetFadeLogic(),this._updateFadingAncestor(w,u,_)||this._updateFadingDescendents(w,u,_)||this._updateFadingEdge(w,m,_)||w.resetFadeLogic()}}_updateFadingAncestor(s,u,_){if(!s.hasData())return!1;const{tileID:m,fadingRole:v,fadingDirection:w,fadingParentID:S}=s;if(v===ji.Base&&w===yt.Incoming&&S)return u[S.key]=S,!0;const I=Math.max(m.overscaledZ-this._maxFadingAncestorLevels,this._source.minzoom);for(let B=m.overscaledZ-1;B>=I;B--){const D=m.scaledTo(B),U=this.getLoadedTile(D);if(U)return s.setCrossFadeLogic({fadingRole:ji.Base,fadingDirection:yt.Incoming,fadingParentID:U.tileID,fadeEndTime:_+this._rasterFadeDuration}),U.setCrossFadeLogic({fadingRole:ji.Parent,fadingDirection:yt.Departing,fadeEndTime:_+this._rasterFadeDuration}),u[D.key]=D,!0}return!1}_updateFadingDescendents(s,u,_){if(!s.hasData())return!1;const m=s.tileID.children(this._source.maxzoom);let v=this._updateFadingChildren(s,m,u,_);if(v)return!0;for(const w of m){const S=w.children(this._source.maxzoom);this._updateFadingChildren(s,S,u,_)&&(v=!0)}return v}_updateFadingChildren(s,u,_,m){if(u[0].overscaledZ>=this._source.maxzoom)return!1;let v=!1;for(const w of u){const S=this.getLoadedTile(w);if(!S)continue;const{fadingRole:I,fadingDirection:B,fadingParentID:D}=S;I===ji.Base&&B===yt.Departing&&D||(S.setCrossFadeLogic({fadingRole:ji.Base,fadingDirection:yt.Departing,fadingParentID:s.tileID,fadeEndTime:m+this._rasterFadeDuration}),s.setCrossFadeLogic({fadingRole:ji.Parent,fadingDirection:yt.Incoming,fadeEndTime:m+this._rasterFadeDuration})),_[w.key]=w,v=!0}return v}_updateFadingEdge(s,u,_){const m=s.tileID;return!!s.selfFading||!s.hasData()&&!!u.has(m)&&(s.setSelfFadeLogic(_+this._rasterFadeDuration),!0)}_addTile(s){let u=this._tiles[s.key];if(u)return u;u=this._cache.getAndRemove(s),u&&(u.resetFadeLogic(),this._setTileReloadTimer(s.key,u),u.tileID=s,this._state.initializeTileState(u,this.map?this.map.painter:null));const _=u;return u||(u=new G(s,this._source.tileSize*s.overscaleFactor()),this._loadTile(u,s.key,u.state)),u.uses++,this._tiles[s.key]=u,_||this._source.fire(new c.l("dataloading",{tile:u,coord:u.tileID,dataType:"source"})),u}_setTileReloadTimer(s,u){this._clearTileReloadTimer(s);const _=u.getExpiryTimeout();_&&(this._timers[s]=setTimeout((()=>{this._reloadTile(s,"expired"),delete this._timers[s]}),_))}_clearTileReloadTimer(s){const u=this._timers[s];u&&(clearTimeout(u),delete this._timers[s])}_resetTileReloadTimers(){for(const s in this._timers)clearTimeout(this._timers[s]),delete this._timers[s];for(const s in this._tiles)this._setTileReloadTimer(s,this._tiles[s])}refreshTiles(s){for(const u in this._tiles)(this._isIdRenderable(u)||this._tiles[u].state=="errored")&&s.some((_=>_.equals(this._tiles[u].tileID.canonical)))&&this._reloadTile(u,"expired")}_removeTile(s){const u=this._tiles[s];u&&(u.uses--,delete this._tiles[s],this._clearTileReloadTimer(s),u.uses>0||(u.hasData()&&u.state!=="reloading"?this._cache.add(u.tileID,u,u.getExpiryTimeout()):(u.aborted=!0,this._abortTile(u),this._unloadTile(u))))}_dataHandler(s){s.dataType==="source"&&(s.sourceDataType!=="metadata"?s.sourceDataType==="content"&&this._sourceLoaded&&!this._paused&&(this.reload(s.sourceDataChanged,s.shouldReloadTileOptions),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0):this._sourceLoaded=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const s in this._tiles)this._removeTile(s);this._cache.reset()}tilesIn(s,u,_){const m=[],v=this.transform;if(!v)return m;const w=v.getCoveringTilesDetailsProvider().allowWorldCopies(),S=_?v.getCameraQueryGeometry(s):s,I=j=>v.screenPointToMercatorCoordinate(j,this.terrain),B=this.transformBbox(s,I,!w),D=this.transformBbox(S,I,!w),U=this.getIds(),k=c.a6.fromPoints(D);for(let j=0;j<U.length;j++){const W=this._tiles[U[j]];if(W.holdingForSymbolFade())continue;const Q=w?[W.tileID]:[W.tileID.unwrapTo(-1),W.tileID.unwrapTo(0)],et=Math.pow(2,v.zoom-W.tileID.overscaledZ),st=u*W.queryPadding*c.a3/W.tileSize/et;for(const ut of Q){const _t=k.map((lt=>ut.getTilePoint(new c.a5(lt.x,lt.y))));if(_t.expandBy(st),_t.intersects(Sr)){const lt=B.map((mt=>ut.getTilePoint(mt))),gt=D.map((mt=>ut.getTilePoint(mt)));m.push({tile:W,tileID:w?ut:ut.unwrapTo(0),queryGeometry:lt,cameraQueryGeometry:gt,scale:et})}}}return m}transformBbox(s,u,_){let m=s.map(u);if(_){const v=c.a6.fromPoints(s);v.shrinkBy(.001*Math.min(v.width(),v.height()));const w=v.map(u);c.a6.fromPoints(m).covers(w)||(m=m.map((S=>S.x>.5?new c.a5(S.x-1,S.y,S.z):S)))}return m}getVisibleCoordinates(s){const u=this.getRenderableIds(s).map((_=>this._tiles[_].tileID));return this.transform&&this.transform.populateCache(u),u}hasTransition(){if(this._source.hasTransition())return!0;if(rr(this._source.type)&&this._rasterFadeDuration>0){const s=nt();for(const u in this._tiles)if(this._tiles[u].fadeEndTime>=s)return!0}return!1}setRasterFadeDuration(s){this._rasterFadeDuration=s}setFeatureState(s,u,_){this._state.updateState(s=s||"_geojsonTileLayer",u,_)}removeFeatureState(s,u,_){this._state.removeFeatureState(s=s||"_geojsonTileLayer",u,_)}getFeatureState(s,u){return this._state.getState(s=s||"_geojsonTileLayer",u)}setDependencies(s,u,_){const m=this._tiles[s];m&&m.setDependencies(u,_)}reloadTilesForDependencies(s,u){for(const _ in this._tiles)this._tiles[_].hasDependency(s,u)&&this._reloadTile(_,"reloading");this._cache.filter((_=>!_.hasDependency(s,u)))}}function Ve(b,s){const u=Math.abs(2*b.wrap)-+(b.wrap<0),_=Math.abs(2*s.wrap)-+(s.wrap<0);return b.overscaledZ-s.overscaledZ||_-u||s.canonical.y-b.canonical.y||s.canonical.x-b.canonical.x}function rr(b){return b==="raster"||b==="image"||b==="video"}Pe.maxOverzooming=10,Pe.maxUnderzooming=3;class Wt{constructor(s,u){this.reset(s,u)}reset(s,u){this.points=s||[],this._distances=[0];for(let _=1;_<this.points.length;_++)this._distances[_]=this._distances[_-1]+this.points[_].dist(this.points[_-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(u||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(s){if(this.points.length===1)return this.points[0];s=c.ai(s,0,1);let u=1,_=this._distances[u];const m=s*this.paddedLength+this.padding;for(;_<m&&u<this._distances.length;)_=this._distances[++u];const v=u-1,w=this._distances[v],S=_-w,I=S>0?(m-w)/S:0;return this.points[v].mult(1-I).add(this.points[u].mult(I))}}function Qe(b,s){let u=!0;return b==="always"||b!=="never"&&s!=="never"||(u=!1),u}class ir{constructor(s,u,_){const m=this.boxCells=[],v=this.circleCells=[];this.xCellCount=Math.ceil(s/_),this.yCellCount=Math.ceil(u/_);for(let w=0;w<this.xCellCount*this.yCellCount;w++)m.push([]),v.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=s,this.height=u,this.xScale=this.xCellCount/s,this.yScale=this.yCellCount/u,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(s,u,_,m,v){this._forEachCell(u,_,m,v,this._insertBoxCell,this.boxUid++),this.boxKeys.push(s),this.bboxes.push(u),this.bboxes.push(_),this.bboxes.push(m),this.bboxes.push(v)}insertCircle(s,u,_,m){this._forEachCell(u-m,_-m,u+m,_+m,this._insertCircleCell,this.circleUid++),this.circleKeys.push(s),this.circles.push(u),this.circles.push(_),this.circles.push(m)}_insertBoxCell(s,u,_,m,v,w){this.boxCells[v].push(w)}_insertCircleCell(s,u,_,m,v,w){this.circleCells[v].push(w)}_query(s,u,_,m,v,w,S){if(_<0||s>this.width||m<0||u>this.height)return[];const I=[];if(s<=0&&u<=0&&this.width<=_&&this.height<=m){if(v)return[{key:null,x1:s,y1:u,x2:_,y2:m}];for(let B=0;B<this.boxKeys.length;B++)I.push({key:this.boxKeys[B],x1:this.bboxes[4*B],y1:this.bboxes[4*B+1],x2:this.bboxes[4*B+2],y2:this.bboxes[4*B+3]});for(let B=0;B<this.circleKeys.length;B++){const D=this.circles[3*B],U=this.circles[3*B+1],k=this.circles[3*B+2];I.push({key:this.circleKeys[B],x1:D-k,y1:U-k,x2:D+k,y2:U+k})}}else this._forEachCell(s,u,_,m,this._queryCell,I,{hitTest:v,overlapMode:w,seenUids:{box:{},circle:{}}},S);return I}query(s,u,_,m){return this._query(s,u,_,m,!1,null)}hitTest(s,u,_,m,v,w){return this._query(s,u,_,m,!0,v,w).length>0}hitTestCircle(s,u,_,m,v){const w=s-_,S=s+_,I=u-_,B=u+_;if(S<0||w>this.width||B<0||I>this.height)return!1;const D=[];return this._forEachCell(w,I,S,B,this._queryCellCircle,D,{hitTest:!0,overlapMode:m,circle:{x:s,y:u,radius:_},seenUids:{box:{},circle:{}}},v),D.length>0}_queryCell(s,u,_,m,v,w,S,I){const{seenUids:B,hitTest:D,overlapMode:U}=S,k=this.boxCells[v];if(k!==null){const W=this.bboxes;for(const Q of k)if(!B.box[Q]){B.box[Q]=!0;const et=4*Q,st=this.boxKeys[Q];if(s<=W[et+2]&&u<=W[et+3]&&_>=W[et+0]&&m>=W[et+1]&&(!I||I(st))&&(!D||!Qe(U,st.overlapMode))&&(w.push({key:st,x1:W[et],y1:W[et+1],x2:W[et+2],y2:W[et+3]}),D))return!0}}const j=this.circleCells[v];if(j!==null){const W=this.circles;for(const Q of j)if(!B.circle[Q]){B.circle[Q]=!0;const et=3*Q,st=this.circleKeys[Q];if(this._circleAndRectCollide(W[et],W[et+1],W[et+2],s,u,_,m)&&(!I||I(st))&&(!D||!Qe(U,st.overlapMode))){const ut=W[et],_t=W[et+1],lt=W[et+2];if(w.push({key:st,x1:ut-lt,y1:_t-lt,x2:ut+lt,y2:_t+lt}),D)return!0}}}return!1}_queryCellCircle(s,u,_,m,v,w,S,I){const{circle:B,seenUids:D,overlapMode:U}=S,k=this.boxCells[v];if(k!==null){const W=this.bboxes;for(const Q of k)if(!D.box[Q]){D.box[Q]=!0;const et=4*Q,st=this.boxKeys[Q];if(this._circleAndRectCollide(B.x,B.y,B.radius,W[et+0],W[et+1],W[et+2],W[et+3])&&(!I||I(st))&&!Qe(U,st.overlapMode))return w.push(!0),!0}}const j=this.circleCells[v];if(j!==null){const W=this.circles;for(const Q of j)if(!D.circle[Q]){D.circle[Q]=!0;const et=3*Q,st=this.circleKeys[Q];if(this._circlesCollide(W[et],W[et+1],W[et+2],B.x,B.y,B.radius)&&(!I||I(st))&&!Qe(U,st.overlapMode))return w.push(!0),!0}}}_forEachCell(s,u,_,m,v,w,S,I){const B=this._convertToXCellCoord(s),D=this._convertToYCellCoord(u),U=this._convertToXCellCoord(_),k=this._convertToYCellCoord(m);for(let j=B;j<=U;j++)for(let W=D;W<=k;W++)if(v.call(this,s,u,_,m,this.xCellCount*W+j,w,S,I))return}_convertToXCellCoord(s){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(s*this.xScale)))}_convertToYCellCoord(s){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(s*this.yScale)))}_circlesCollide(s,u,_,m,v,w){const S=m-s,I=v-u,B=_+w;return B*B>S*S+I*I}_circleAndRectCollide(s,u,_,m,v,w,S){const I=(w-m)/2,B=Math.abs(s-(m+I));if(B>I+_)return!1;const D=(S-v)/2,U=Math.abs(u-(v+D));if(U>D+_)return!1;if(B<=I||U<=D)return!0;const k=B-I,j=U-D;return k*k+j*j<=_*_}}function kr(b,s,u){const _=c.M();if(!b){const{vecSouth:U,vecEast:k}=Xt(s),j=C();j[0]=k[0],j[1]=k[1],j[2]=U[0],j[3]=U[1],m=j,(D=(w=(v=j)[0])*(B=v[3])-(I=v[2])*(S=v[1]))&&(m[0]=B*(D=1/D),m[1]=-S*D,m[2]=-I*D,m[3]=w*D),_[0]=j[0],_[1]=j[1],_[4]=j[2],_[5]=j[3]}var m,v,w,S,I,B,D;return c.O(_,_,[1/u,1/u,1]),_}function sr(b,s,u,_){if(b){const m=c.M();if(!s){const{vecSouth:v,vecEast:w}=Xt(u);m[0]=w[0],m[1]=w[1],m[4]=v[0],m[5]=v[1]}return c.O(m,m,[_,_,1]),m}return u.pixelsToClipSpaceMatrix}function Xt(b){const s=Math.cos(b.rollInRadians),u=Math.sin(b.rollInRadians),_=Math.cos(b.pitchInRadians),m=Math.cos(b.bearingInRadians),v=Math.sin(b.bearingInRadians),w=c.aw();w[0]=-m*_*u-v*s,w[1]=-v*_*u+m*s;const S=c.ax(w);S<1e-9?c.ay(w):c.az(w,w,1/S);const I=c.aw();I[0]=m*_*s-v*u,I[1]=v*_*s+m*u;const B=c.ax(I);return B<1e-9?c.ay(I):c.az(I,I,1/B),{vecEast:I,vecSouth:w}}function ue(b,s,u,_){let m;_?(m=[b,s,_(b,s),1],c.aB(m,m,u)):(m=[b,s,0,1],Fi(m,m,u));const v=m[3];return{point:new c.P(m[0]/v,m[1]/v),signedDistanceFromCamera:v,isOccluded:!1}}function ve(b,s){return .5+b/s*.5}function Ai(b,s){return b.x>=-s[0]&&b.x<=s[0]&&b.y>=-s[1]&&b.y<=s[1]}function Us(b,s,u,_,m,v,w,S,I,B,D,U,k){const j=u?b.textSizeData:b.iconSizeData,W=c.as(j,s.transform.zoom),Q=[256/s.width*2+1,256/s.height*2+1],et=u?b.text.dynamicLayoutVertexArray:b.icon.dynamicLayoutVertexArray;et.clear();const st=b.lineVertexArray,ut=u?b.text.placedSymbolArray:b.icon.placedSymbolArray,_t=s.transform.width/s.transform.height;let lt=!1;for(let gt=0;gt<ut.length;gt++){const mt=ut.get(gt);if(mt.hidden||mt.writingMode===c.at.vertical&&!lt){Di(mt.numGlyphs,et);continue}lt=!1;const dt=new c.P(mt.anchorX,mt.anchorY),wt={getElevation:k,pitchedLabelPlaneMatrix:_,lineVertexArray:st,pitchWithMap:v,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:s.transform,tileAnchorPoint:dt,unwrappedTileID:I,width:B,height:D,translation:U},Ft=Vs(mt.anchorX,mt.anchorY,wt);if(!Ai(Ft.point,Q)){Di(mt.numGlyphs,et);continue}const Mt=ve(s.transform.cameraToCenterDistance,Ft.signedDistanceFromCamera),Rt=c.au(j,W,mt),Ot=v?Rt*s.transform.getPitchedTextCorrection(mt.anchorX,mt.anchorY,I)/Mt:Rt*Mt,qt=Hi({projectionContext:wt,pitchedLabelPlaneMatrixInverse:m,symbol:mt,fontSize:Ot,flip:!1,keepUpright:w,glyphOffsetArray:b.glyphOffsetArray,dynamicLayoutVertexArray:et,aspectRatio:_t,rotateToLine:S});lt=qt.useVertical,(qt.notEnoughRoom||lt||qt.needsFlipping&&Hi({projectionContext:wt,pitchedLabelPlaneMatrixInverse:m,symbol:mt,fontSize:Ot,flip:!0,keepUpright:w,glyphOffsetArray:b.glyphOffsetArray,dynamicLayoutVertexArray:et,aspectRatio:_t,rotateToLine:S}).notEnoughRoom)&&Di(mt.numGlyphs,et)}u?b.text.dynamicLayoutVertexBuffer.updateData(et):b.icon.dynamicLayoutVertexBuffer.updateData(et)}function mr(b,s,u,_,m,v,w,S){const I=v.glyphStartIndex+v.numGlyphs,B=v.lineStartIndex,D=v.lineStartIndex+v.lineLength,U=s.getoffsetX(v.glyphStartIndex),k=s.getoffsetX(I-1),j=Ue(b*U,u,_,m,v.segment,B,D,S,w);if(!j)return null;const W=Ue(b*k,u,_,m,v.segment,B,D,S,w);return W?S.projectionCache.anyProjectionOccluded?null:{first:j,last:W}:null}function we(b,s,u,_){return b===c.at.horizontal&&Math.abs(u.y-s.y)>Math.abs(u.x-s.x)*_?{useVertical:!0}:(b===c.at.vertical?s.y<u.y:s.x>u.x)?{needsFlipping:!0}:null}function Hi(b){const{projectionContext:s,pitchedLabelPlaneMatrixInverse:u,symbol:_,fontSize:m,flip:v,keepUpright:w,glyphOffsetArray:S,dynamicLayoutVertexArray:I,aspectRatio:B,rotateToLine:D}=b,U=m/24,k=_.lineOffsetX*U,j=_.lineOffsetY*U;let W;if(_.numGlyphs>1){const Q=_.glyphStartIndex+_.numGlyphs,et=_.lineStartIndex,st=_.lineStartIndex+_.lineLength,ut=mr(U,S,k,j,v,_,D,s);if(!ut)return{notEnoughRoom:!0};const _t=On(ut.first.point.x,ut.first.point.y,s,u),lt=On(ut.last.point.x,ut.last.point.y,s,u);if(w&&!v){const gt=we(_.writingMode,_t,lt,B);if(gt)return gt}W=[ut.first];for(let gt=_.glyphStartIndex+1;gt<Q-1;gt++){const mt=Ue(U*S.getoffsetX(gt),k,j,v,_.segment,et,st,s,D);if(!mt)return{notEnoughRoom:!0};W.push(mt)}W.push(ut.last)}else{if(w&&!v){const et=cs(s.tileAnchorPoint.x,s.tileAnchorPoint.y,s).point,st=_.lineStartIndex+_.segment+1,ut=new c.P(s.lineVertexArray.getx(st),s.lineVertexArray.gety(st)),_t=cs(ut.x,ut.y,s),lt=_t.signedDistanceFromCamera>0?_t.point:zs(s.tileAnchorPoint,ut,et,1,s),gt=On(et.x,et.y,s,u),mt=On(lt.x,lt.y,s,u),dt=we(_.writingMode,gt,mt,B);if(dt)return dt}const Q=Ue(U*S.getoffsetX(_.glyphStartIndex),k,j,v,_.segment,_.lineStartIndex,_.lineStartIndex+_.lineLength,s,D);if(!Q||s.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};W=[Q]}for(const Q of W)c.aA(I,Q.point,Q.angle);return{}}function zs(b,s,u,_,m){const v=b.add(b.sub(s)._unit()),w=cs(v.x,v.y,m).point,S=u.sub(w);return u.add(S._mult(_/S.mag()))}function pn(b,s,u){const _=s.projectionCache;if(_.projections[b])return _.projections[b];const m=new c.P(s.lineVertexArray.getx(b),s.lineVertexArray.gety(b)),v=cs(m.x,m.y,s);if(v.signedDistanceFromCamera>0)return _.projections[b]=v.point,_.anyProjectionOccluded=_.anyProjectionOccluded||v.isOccluded,v.point;const w=b-u.direction;return zs(u.distanceFromAnchor===0?s.tileAnchorPoint:new c.P(s.lineVertexArray.getx(w),s.lineVertexArray.gety(w)),m,u.previousVertex,u.absOffsetX-u.distanceFromAnchor+1,s)}function cs(b,s,u){const _=b+u.translation[0],m=s+u.translation[1];let v;return u.pitchWithMap?(v=ue(_,m,u.pitchedLabelPlaneMatrix,u.getElevation),v.isOccluded=!1):(v=u.transform.projectTileCoordinates(_,m,u.unwrappedTileID,u.getElevation),v.point.x=(.5*v.point.x+.5)*u.width,v.point.y=(.5*-v.point.y+.5)*u.height),v}function On(b,s,u,_){if(u.pitchWithMap){const m=[b,s,0,1];return c.aB(m,m,_),u.transform.projectTileCoordinates(m[0]/m[3],m[1]/m[3],u.unwrappedTileID,u.getElevation).point}return{x:b/u.width*2-1,y:1-s/u.height*2}}function Vs(b,s,u){return u.transform.projectTileCoordinates(b,s,u.unwrappedTileID,u.getElevation)}function ei(b,s,u){return b._unit()._perp()._mult(s*u)}function Zr(b,s,u,_,m,v,w,S,I){if(S.projectionCache.offsets[b])return S.projectionCache.offsets[b];const B=u.add(s);if(b+I.direction<_||b+I.direction>=m)return S.projectionCache.offsets[b]=B,B;const D=pn(b+I.direction,S,I),U=ei(D.sub(u),w,I.direction),k=u.add(U),j=D.add(U);return S.projectionCache.offsets[b]=c.aC(v,B,k,j)||B,S.projectionCache.offsets[b]}function Ue(b,s,u,_,m,v,w,S,I){const B=_?b-s:b+s;let D=B>0?1:-1,U=0;_&&(D*=-1,U=Math.PI),D<0&&(U+=Math.PI);let k,j=D>0?v+m:v+m+1;S.projectionCache.cachedAnchorPoint?k=S.projectionCache.cachedAnchorPoint:(k=cs(S.tileAnchorPoint.x,S.tileAnchorPoint.y,S).point,S.projectionCache.cachedAnchorPoint=k);let W,Q,et=k,st=k,ut=0,_t=0;const lt=Math.abs(B),gt=[];let mt;for(;ut+_t<=lt;){if(j+=D,j<v||j>=w)return null;ut+=_t,st=et,Q=W;const Ft={absOffsetX:lt,direction:D,distanceFromAnchor:ut,previousVertex:st};if(et=pn(j,S,Ft),u===0)gt.push(st),mt=et.sub(st);else{let Mt;const Rt=et.sub(st);Mt=Rt.mag()===0?ei(pn(j+D,S,Ft).sub(et),u,D):ei(Rt,u,D),Q||(Q=st.add(Mt)),W=Zr(j,Mt,et,v,w,Q,u,S,Ft),gt.push(Q),mt=W.sub(Q)}_t=mt.mag()}const dt=mt._mult((lt-ut)/_t)._add(Q||st),wt=U+Math.atan2(et.y-st.y,et.x-st.x);return gt.push(dt),{point:dt,angle:I?wt:0,path:gt}}const js=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Di(b,s){for(let u=0;u<b;u++){const _=s.length;s.resize(_+4),s.float32.set(js,3*_)}}function Fi(b,s,u){const _=s[0],m=s[1];return b[0]=u[0]*_+u[4]*m+u[12],b[1]=u[1]*_+u[5]*m+u[13],b[3]=u[3]*_+u[7]*m+u[15],b}const Ge=100;class Hs{constructor(s,u=new ir(s.width+200,s.height+200,25),_=new ir(s.width+200,s.height+200,25)){this.transform=s,this.grid=u,this.ignoredGrid=_,this.pitchFactor=Math.cos(s.pitch*Math.PI/180)*s.cameraToCenterDistance,this.screenRightBoundary=s.width+Ge,this.screenBottomBoundary=s.height+Ge,this.gridRightBoundary=s.width+200,this.gridBottomBoundary=s.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(s,u,_,m,v,w,S,I,B,D,U,k){const j=this.projectAndGetPerspectiveRatio(s.anchorPointX+I[0],s.anchorPointY+I[1],v,D,k),W=_*j.perspectiveRatio;let Q;if(w||S)Q=this._projectCollisionBox(s,W,m,v,w,S,I,j,D,U,k);else{const mt=j.x+(U?U.x*W:0),dt=j.y+(U?U.y*W:0);Q={allPointsOccluded:!1,box:[mt+s.x1*W,dt+s.y1*W,mt+s.x2*W,dt+s.y2*W]}}const[et,st,ut,_t]=Q.box,lt=w?Q.allPointsOccluded:j.isOccluded;let gt=lt;return gt||(gt=j.perspectiveRatio<this.perspectiveRatioCutoff),gt||(gt=!this.isInsideGrid(et,st,ut,_t)),gt||u!=="always"&&this.grid.hitTest(et,st,ut,_t,u,B)?{box:[et,st,ut,_t],placeable:!1,offscreen:!1,occluded:lt}:{box:[et,st,ut,_t],placeable:!0,offscreen:this.isOffscreen(et,st,ut,_t),occluded:lt}}placeCollisionCircles(s,u,_,m,v,w,S,I,B,D,U,k,j,W){const Q=[],et=new c.P(u.anchorX,u.anchorY),st=this.getPerspectiveRatio(et.x,et.y,w,W),ut=(B?v*this.transform.getPitchedTextCorrection(u.anchorX,u.anchorY,w)/st:v*st)/c.aG,_t={getElevation:W,pitchedLabelPlaneMatrix:S,lineVertexArray:_,pitchWithMap:B,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:et,unwrappedTileID:w,width:this.transform.width,height:this.transform.height,translation:j},lt=mr(ut,m,u.lineOffsetX*ut,u.lineOffsetY*ut,!1,u,!1,_t);let gt=!1,mt=!1,dt=!0;if(lt){const wt=.5*U*st+k,Ft=new c.P(-100,-100),Mt=new c.P(this.screenRightBoundary,this.screenBottomBoundary),Rt=new Wt,Ot=lt.first,qt=lt.last;let Zt=[];for(let pe=Ot.path.length-1;pe>=1;pe--)Zt.push(Ot.path[pe]);for(let pe=1;pe<qt.path.length;pe++)Zt.push(qt.path[pe]);const Gt=2.5*wt;if(B){const pe=this.projectPathToScreenSpace(Zt,_t);Zt=pe.some((qe=>qe.signedDistanceFromCamera<=0))?[]:pe.map((qe=>qe.point))}let he=[];if(Zt.length>0){const pe=Zt[0].clone(),qe=Zt[0].clone();for(let xr=1;xr<Zt.length;xr++)pe.x=Math.min(pe.x,Zt[xr].x),pe.y=Math.min(pe.y,Zt[xr].y),qe.x=Math.max(qe.x,Zt[xr].x),qe.y=Math.max(qe.y,Zt[xr].y);he=pe.x>=Ft.x&&qe.x<=Mt.x&&pe.y>=Ft.y&&qe.y<=Mt.y?[Zt]:qe.x<Ft.x||pe.x>Mt.x||qe.y<Ft.y||pe.y>Mt.y?[]:c.aD([Zt],Ft.x,Ft.y,Mt.x,Mt.y)}for(const pe of he){Rt.reset(pe,.25*wt);let qe=0;qe=Rt.length<=.5*wt?1:Math.ceil(Rt.paddedLength/Gt)+1;for(let xr=0;xr<qe;xr++){const pr=xr/Math.max(qe-1,1),Cr=Rt.lerp(pr),ar=Cr.x+Ge,Jr=Cr.y+Ge;Q.push(ar,Jr,wt,0);const lr=ar-wt,ui=Jr-wt,Vr=ar+wt,Qr=Jr+wt;if(dt=dt&&this.isOffscreen(lr,ui,Vr,Qr),mt=mt||this.isInsideGrid(lr,ui,Vr,Qr),s!=="always"&&this.grid.hitTestCircle(ar,Jr,wt,s,D)&&(gt=!0,!I))return{circles:[],offscreen:!1,collisionDetected:gt}}}}return{circles:!I&&gt||!mt||st<this.perspectiveRatioCutoff?[]:Q,offscreen:dt,collisionDetected:gt}}projectPathToScreenSpace(s,u){const _=(function(m,v){const w=c.M();return c.av(w,v.pitchedLabelPlaneMatrix),m.map((S=>{const I=ue(S.x,S.y,w,v.getElevation),B=v.transform.projectTileCoordinates(I.point.x,I.point.y,v.unwrappedTileID,v.getElevation);return B.point.x=(.5*B.point.x+.5)*v.width,B.point.y=(.5*-B.point.y+.5)*v.height,B}))})(s,u);return(function(m){let v=0,w=0,S=0,I=0;for(let B=0;B<m.length;B++)m[B].isOccluded?(S=B+1,I=0):(I++,I>w&&(w=I,v=S));return m.slice(v,v+w)})(_)}queryRenderedSymbols(s){if(s.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const u=[],_=new c.a6;for(const U of s){const k=new c.P(U.x+Ge,U.y+Ge);_.extend(k),u.push(k)}const{minX:m,minY:v,maxX:w,maxY:S}=_,I=this.grid.query(m,v,w,S).concat(this.ignoredGrid.query(m,v,w,S)),B={},D={};for(const U of I){const k=U.key;if(B[k.bucketInstanceId]===void 0&&(B[k.bucketInstanceId]={}),B[k.bucketInstanceId][k.featureIndex])continue;const j=[new c.P(U.x1,U.y1),new c.P(U.x2,U.y1),new c.P(U.x2,U.y2),new c.P(U.x1,U.y2)];c.aE(u,j)&&(B[k.bucketInstanceId][k.featureIndex]=!0,D[k.bucketInstanceId]===void 0&&(D[k.bucketInstanceId]=[]),D[k.bucketInstanceId].push(k.featureIndex))}return D}insertCollisionBox(s,u,_,m,v,w){(_?this.ignoredGrid:this.grid).insert({bucketInstanceId:m,featureIndex:v,collisionGroupID:w,overlapMode:u},s[0],s[1],s[2],s[3])}insertCollisionCircles(s,u,_,m,v,w){const S=_?this.ignoredGrid:this.grid,I={bucketInstanceId:m,featureIndex:v,collisionGroupID:w,overlapMode:u};for(let B=0;B<s.length;B+=4)S.insertCircle(I,s[B],s[B+1],s[B+2])}projectAndGetPerspectiveRatio(s,u,_,m,v){if(v){let w;m?(w=[s,u,m(s,u),1],c.aB(w,w,v)):(w=[s,u,0,1],Fi(w,w,v));const S=w[3];return{x:(w[0]/S+1)/2*this.transform.width+Ge,y:(-w[1]/S+1)/2*this.transform.height+Ge,perspectiveRatio:.5+this.transform.cameraToCenterDistance/S*.5,isOccluded:!1,signedDistanceFromCamera:S}}{const w=this.transform.projectTileCoordinates(s,u,_,m);return{x:(w.point.x+1)/2*this.transform.width+Ge,y:(1-w.point.y)/2*this.transform.height+Ge,perspectiveRatio:.5+this.transform.cameraToCenterDistance/w.signedDistanceFromCamera*.5,isOccluded:w.isOccluded,signedDistanceFromCamera:w.signedDistanceFromCamera}}}getPerspectiveRatio(s,u,_,m){const v=this.transform.projectTileCoordinates(s,u,_,m);return .5+this.transform.cameraToCenterDistance/v.signedDistanceFromCamera*.5}isOffscreen(s,u,_,m){return _<Ge||s>=this.screenRightBoundary||m<Ge||u>this.screenBottomBoundary}isInsideGrid(s,u,_,m){return _>=0&&s<this.gridRightBoundary&&m>=0&&u<this.gridBottomBoundary}getViewportMatrix(){const s=c.am([]);return c.N(s,s,[-100,-100,0]),s}_projectCollisionBox(s,u,_,m,v,w,S,I,B,D,U){let k=1,j=0,W=0,Q=1;const et=s.anchorPointX+S[0],st=s.anchorPointY+S[1];if(w&&!v){const Zt=this.projectAndGetPerspectiveRatio(et+1,st,m,B,U),Gt=Zt.x-I.x,he=Math.atan((Zt.y-I.y)/Gt)+(Gt<0?Math.PI:0),pe=Math.sin(he),qe=Math.cos(he);k=qe,j=pe,W=-pe,Q=qe}else if(!w&&v){const Zt=Xt(this.transform);k=Zt.vecEast[0],j=Zt.vecEast[1],W=Zt.vecSouth[0],Q=Zt.vecSouth[1]}let ut=I.x,_t=I.y,lt=u;v&&(ut=et,_t=st,lt=Math.pow(2,-(this.transform.zoom-_.overscaledZ)),lt*=this.transform.getPitchedTextCorrection(et,st,m),D||(lt*=c.ai(.5+I.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),D&&(ut+=k*D.x*lt+W*D.y*lt,_t+=j*D.x*lt+Q*D.y*lt);const gt=s.x1*lt,mt=s.x2*lt,dt=(gt+mt)/2,wt=s.y1*lt,Ft=s.y2*lt,Mt=(wt+Ft)/2,Rt=[{offsetX:gt,offsetY:wt},{offsetX:dt,offsetY:wt},{offsetX:mt,offsetY:wt},{offsetX:mt,offsetY:Mt},{offsetX:mt,offsetY:Ft},{offsetX:dt,offsetY:Ft},{offsetX:gt,offsetY:Ft},{offsetX:gt,offsetY:Mt}];let Ot=[];for(const{offsetX:Zt,offsetY:Gt}of Rt)Ot.push(new c.P(ut+k*Zt+W*Gt,_t+j*Zt+Q*Gt));let qt=!1;if(v){const Zt=Ot.map((Gt=>this.projectAndGetPerspectiveRatio(Gt.x,Gt.y,m,B,U)));qt=Zt.some((Gt=>!Gt.isOccluded)),Ot=Zt.map((Gt=>new c.P(Gt.x,Gt.y)))}else qt=!0;return{box:c.aF(Ot),allPointsOccluded:!qt}}}class ga{constructor(s,u,_,m){this.opacity=s?Math.max(0,Math.min(1,s.opacity+(s.placed?u:-u))):m&&_?1:0,this.placed=_}isHidden(){return this.opacity===0&&!this.placed}}class Gs{constructor(s,u,_,m,v){this.text=new ga(s?s.text:null,u,_,v),this.icon=new ga(s?s.icon:null,u,m,v)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Gi{constructor(s,u,_){this.text=s,this.icon=u,this.skipFade=_}}class $s{constructor(s,u,_,m,v){this.bucketInstanceId=s,this.featureIndex=u,this.sourceLayerIndex=_,this.bucketIndex=m,this.tileID=v}}class ma{constructor(s){this.crossSourceCollisions=s,this.maxGroupID=0,this.collisionGroups={}}get(s){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[s]){const u=++this.maxGroupID;this.collisionGroups[s]={ID:u,predicate:_=>_.collisionGroupID===u}}return this.collisionGroups[s]}}function ya(b,s,u,_,m){const{horizontalAlign:v,verticalAlign:w}=c.aM(b);return new c.P(-(v-.5)*s+_[0]*m,-(w-.5)*u+_[1]*m)}class ul{constructor(s,u,_,m,v){this.transform=s.clone(),this.terrain=u,this.collisionIndex=new Hs(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=_,this.retainedQueryData={},this.collisionGroups=new ma(m),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=v,v&&(v.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(s){const u=this.terrain;return u?(_,m)=>u.getElevation(s,_,m):null}getBucketParts(s,u,_,m){const v=_.getBucket(u),w=_.latestFeatureIndex;if(!v||!w||u.id!==v.layerIds[0])return;const S=_.collisionBoxArray,I=v.layers[0].layout,B=v.layers[0].paint,D=Math.pow(2,this.transform.zoom-_.tileID.overscaledZ),U=_.tileSize/c.a3,k=_.tileID.toUnwrapped(),j=I.get("text-rotation-alignment")==="map",W=c.aH(_,1,this.transform.zoom),Q=c.aI(this.collisionIndex.transform,_,B.get("text-translate"),B.get("text-translate-anchor")),et=c.aI(this.collisionIndex.transform,_,B.get("icon-translate"),B.get("icon-translate-anchor")),st=kr(j,this.transform,W);this.retainedQueryData[v.bucketInstanceId]=new $s(v.bucketInstanceId,w,v.sourceLayerIndex,v.index,_.tileID);const ut={bucket:v,layout:I,translationText:Q,translationIcon:et,unwrappedTileID:k,pitchedLabelPlaneMatrix:st,scale:D,textPixelRatio:U,holdingForFade:_.holdingForSymbolFade(),collisionBoxArray:S,partiallyEvaluatedTextSize:c.as(v.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(v.sourceID)};if(m)for(const _t of v.sortKeyRanges){const{sortKey:lt,symbolInstanceStart:gt,symbolInstanceEnd:mt}=_t;s.push({sortKey:lt,symbolInstanceStart:gt,symbolInstanceEnd:mt,parameters:ut})}else s.push({symbolInstanceStart:0,symbolInstanceEnd:v.symbolInstances.length,parameters:ut})}attemptAnchorPlacement(s,u,_,m,v,w,S,I,B,D,U,k,j,W,Q,et,st,ut,_t,lt){const gt=c.aJ[s.textAnchor],mt=[s.textOffset0,s.textOffset1],dt=ya(gt,_,m,mt,v),wt=this.collisionIndex.placeCollisionBox(u,k,I,B,D,S,w,et,U.predicate,_t,dt,lt);if((!ut||this.collisionIndex.placeCollisionBox(ut,k,I,B,D,S,w,st,U.predicate,_t,dt,lt).placeable)&&wt.placeable){let Ft;if(this.prevPlacement&&this.prevPlacement.variableOffsets[j.crossTileID]&&this.prevPlacement.placements[j.crossTileID]&&this.prevPlacement.placements[j.crossTileID].text&&(Ft=this.prevPlacement.variableOffsets[j.crossTileID].anchor),j.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[j.crossTileID]={textOffset:mt,width:_,height:m,anchor:gt,textBoxScale:v,prevAnchor:Ft},this.markUsedJustification(W,gt,j,Q),W.allowVerticalPlacement&&(this.markUsedOrientation(W,Q,j),this.placedOrientations[j.crossTileID]=Q),{shift:dt,placedGlyphBoxes:wt}}}placeLayerBucketPart(s,u,_){const{bucket:m,layout:v,translationText:w,translationIcon:S,unwrappedTileID:I,pitchedLabelPlaneMatrix:B,textPixelRatio:D,holdingForFade:U,collisionBoxArray:k,partiallyEvaluatedTextSize:j,collisionGroup:W}=s.parameters,Q=v.get("text-optional"),et=v.get("icon-optional"),st=c.aK(v,"text-overlap","text-allow-overlap"),ut=st==="always",_t=c.aK(v,"icon-overlap","icon-allow-overlap"),lt=_t==="always",gt=v.get("text-rotation-alignment")==="map",mt=v.get("text-pitch-alignment")==="map",dt=v.get("icon-text-fit")!=="none",wt=v.get("symbol-z-order")==="viewport-y",Ft=ut&&(lt||!m.hasIconData()||et),Mt=lt&&(ut||!m.hasTextData()||Q);!m.collisionArrays&&k&&m.deserializeCollisionBoxes(k);const Rt=this.retainedQueryData[m.bucketInstanceId].tileID,Ot=this._getTerrainElevationFunc(Rt),qt=this.transform.getFastPathSimpleProjectionMatrix(Rt),Zt=(Gt,he,pe)=>{var qe,xr;if(u[Gt.crossTileID])return;if(U)return void(this.placements[Gt.crossTileID]=new Gi(!1,!1,!1));let pr=!1,Cr=!1,ar=!0,Jr=null,lr={box:null,placeable:!1,offscreen:null,occluded:!1},ui={placeable:!1},Vr=null,Qr=null,Li=null,bn=0,mo=0,Un=0;he.textFeatureIndex?bn=he.textFeatureIndex:Gt.useRuntimeCollisionCircles&&(bn=Gt.featureIndex),he.verticalTextFeatureIndex&&(mo=he.verticalTextFeatureIndex);const zn=he.textBox;if(zn){const us=Ir=>{let wr=c.at.horizontal;if(m.allowVerticalPlacement&&!Ir&&this.prevPlacement){const jr=this.prevPlacement.placedOrientations[Gt.crossTileID];jr&&(this.placedOrientations[Gt.crossTileID]=jr,wr=jr,this.markUsedOrientation(m,wr,Gt))}return wr},yo=(Ir,wr)=>{if(m.allowVerticalPlacement&&Gt.numVerticalGlyphVertices>0&&he.verticalTextBox){for(const jr of m.writingModes)if(jr===c.at.vertical?(lr=wr(),ui=lr):lr=Ir(),lr&&lr.placeable)break}else lr=Ir()},Vn=Gt.textAnchorOffsetStartIndex,jn=Gt.textAnchorOffsetEndIndex;if(jn===Vn){const Ir=(wr,jr)=>{const Mr=this.collisionIndex.placeCollisionBox(wr,st,D,Rt,I,mt,gt,w,W.predicate,Ot,void 0,qt);return Mr&&Mr.placeable&&(this.markUsedOrientation(m,jr,Gt),this.placedOrientations[Gt.crossTileID]=jr),Mr};yo((()=>Ir(zn,c.at.horizontal)),(()=>{const wr=he.verticalTextBox;return m.allowVerticalPlacement&&Gt.numVerticalGlyphVertices>0&&wr?Ir(wr,c.at.vertical):{box:null,offscreen:null}})),us(lr&&lr.placeable)}else{let Ir=c.aJ[(xr=(qe=this.prevPlacement)===null||qe===void 0?void 0:qe.variableOffsets[Gt.crossTileID])===null||xr===void 0?void 0:xr.anchor];const wr=(Mr,__,g_)=>{const m_=Mr.x2-Mr.x1,$o=Mr.y2-Mr.y1,y0=Gt.textBoxScale,y_=dt&&_t==="never"?__:null;let Hn=null,Pd=st==="never"?1:2,bo="never";Ir&&Pd++;for(let vo=0;vo<Pd;vo++){for(let Su=Vn;Su<jn;Su++){const b_=m.textAnchorOffsets.get(Su);if(Ir&&b_.textAnchor!==Ir)continue;const Hl=this.attemptAnchorPlacement(b_,Mr,m_,$o,y0,gt,mt,D,Rt,I,W,bo,Gt,m,g_,w,S,y_,Ot);if(Hl&&(Hn=Hl.placedGlyphBoxes,Hn&&Hn.placeable))return pr=!0,Jr=Hl.shift,Hn}Ir?Ir=null:bo=st}return _&&!Hn&&(Hn={box:this.collisionIndex.placeCollisionBox(zn,"always",D,Rt,I,mt,gt,w,W.predicate,Ot,void 0,qt).box,offscreen:!1,placeable:!1,occluded:!1}),Hn};yo((()=>wr(zn,he.iconBox,c.at.horizontal)),(()=>{const Mr=he.verticalTextBox;return m.allowVerticalPlacement&&(!lr||!lr.placeable)&&Gt.numVerticalGlyphVertices>0&&Mr?wr(Mr,he.verticalIconBox,c.at.vertical):{box:null,occluded:!0,offscreen:null}})),lr&&(pr=lr.placeable,ar=lr.offscreen);const jr=us(lr&&lr.placeable);if(!pr&&this.prevPlacement){const Mr=this.prevPlacement.variableOffsets[Gt.crossTileID];Mr&&(this.variableOffsets[Gt.crossTileID]=Mr,this.markUsedJustification(m,Mr.anchor,Gt,jr))}}}if(Vr=lr,pr=Vr&&Vr.placeable,ar=Vr&&Vr.offscreen,Gt.useRuntimeCollisionCircles&&Gt.centerJustifiedTextSymbolIndex>=0){const us=m.text.placedSymbolArray.get(Gt.centerJustifiedTextSymbolIndex),yo=c.au(m.textSizeData,j,us),Vn=v.get("text-padding");Qr=this.collisionIndex.placeCollisionCircles(st,us,m.lineVertexArray,m.glyphOffsetArray,yo,I,B,_,mt,W.predicate,Gt.collisionCircleDiameter,Vn,w,Ot),Qr.circles.length&&Qr.collisionDetected&&!_&&c.w("Collisions detected, but collision boxes are not shown"),pr=ut||Qr.circles.length>0&&!Qr.collisionDetected,ar=ar&&Qr.offscreen}if(he.iconFeatureIndex&&(Un=he.iconFeatureIndex),he.iconBox){const us=yo=>this.collisionIndex.placeCollisionBox(yo,_t,D,Rt,I,mt,gt,S,W.predicate,Ot,dt&&Jr?Jr:void 0,qt);ui&&ui.placeable&&he.verticalIconBox?(Li=us(he.verticalIconBox),Cr=Li.placeable):(Li=us(he.iconBox),Cr=Li.placeable),ar=ar&&Li.offscreen}const Ss=Q||Gt.numHorizontalGlyphVertices===0&&Gt.numVerticalGlyphVertices===0,Ho=et||Gt.numIconVertices===0;Ss||Ho?Ho?Ss||(Cr=Cr&&pr):pr=Cr&&pr:Cr=pr=Cr&&pr;const Go=Cr&&Li.placeable;if(pr&&Vr.placeable&&this.collisionIndex.insertCollisionBox(Vr.box,st,v.get("text-ignore-placement"),m.bucketInstanceId,ui&&ui.placeable&&mo?mo:bn,W.ID),Go&&this.collisionIndex.insertCollisionBox(Li.box,_t,v.get("icon-ignore-placement"),m.bucketInstanceId,Un,W.ID),Qr&&pr&&this.collisionIndex.insertCollisionCircles(Qr.circles,st,v.get("text-ignore-placement"),m.bucketInstanceId,bn,W.ID),_&&this.storeCollisionData(m.bucketInstanceId,pe,he,Vr,Li,Qr),Gt.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(m.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Gt.crossTileID]=new Gi((pr||Ft)&&!Vr?.occluded,(Cr||Mt)&&!Li?.occluded,ar||m.justReloaded),u[Gt.crossTileID]=!0};if(wt){if(s.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Gt=m.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let he=Gt.length-1;he>=0;--he){const pe=Gt[he];Zt(m.symbolInstances.get(pe),m.collisionArrays[pe],pe)}}else for(let Gt=s.symbolInstanceStart;Gt<s.symbolInstanceEnd;Gt++)Zt(m.symbolInstances.get(Gt),m.collisionArrays[Gt],Gt);m.justReloaded=!1}storeCollisionData(s,u,_,m,v,w){if(_.textBox||_.iconBox){let S,I;this.collisionBoxArrays.has(s)?S=this.collisionBoxArrays.get(s):(S=new Map,this.collisionBoxArrays.set(s,S)),S.has(u)?I=S.get(u):(I={text:null,icon:null},S.set(u,I)),_.textBox&&(I.text=m.box),_.iconBox&&(I.icon=v.box)}if(w){let S=this.collisionCircleArrays[s];S===void 0&&(S=this.collisionCircleArrays[s]=[]);for(let I=0;I<w.circles.length;I+=4)S.push(w.circles[I+0]-Ge),S.push(w.circles[I+1]-Ge),S.push(w.circles[I+2]),S.push(w.collisionDetected?1:0)}}markUsedJustification(s,u,_,m){let v;v=m===c.at.vertical?_.verticalPlacedTextSymbolIndex:{left:_.leftJustifiedTextSymbolIndex,center:_.centerJustifiedTextSymbolIndex,right:_.rightJustifiedTextSymbolIndex}[c.aL(u)];const w=[_.leftJustifiedTextSymbolIndex,_.centerJustifiedTextSymbolIndex,_.rightJustifiedTextSymbolIndex,_.verticalPlacedTextSymbolIndex];for(const S of w)S>=0&&(s.text.placedSymbolArray.get(S).crossTileID=v>=0&&S!==v?0:_.crossTileID)}markUsedOrientation(s,u,_){const m=u===c.at.horizontal||u===c.at.horizontalOnly?u:0,v=u===c.at.vertical?u:0,w=[_.leftJustifiedTextSymbolIndex,_.centerJustifiedTextSymbolIndex,_.rightJustifiedTextSymbolIndex];for(const S of w)s.text.placedSymbolArray.get(S).placedOrientation=m;_.verticalPlacedTextSymbolIndex&&(s.text.placedSymbolArray.get(_.verticalPlacedTextSymbolIndex).placedOrientation=v)}commit(s){this.commitTime=s,this.zoomAtLastRecencyCheck=this.transform.zoom;const u=this.prevPlacement;let _=!1;this.prevZoomAdjustment=u?u.zoomAdjustment(this.transform.zoom):0;const m=u?u.symbolFadeChange(s):1,v=u?u.opacities:{},w=u?u.variableOffsets:{},S=u?u.placedOrientations:{};for(const I in this.placements){const B=this.placements[I],D=v[I];D?(this.opacities[I]=new Gs(D,m,B.text,B.icon),_=_||B.text!==D.text.placed||B.icon!==D.icon.placed):(this.opacities[I]=new Gs(null,m,B.text,B.icon,B.skipFade),_=_||B.text||B.icon)}for(const I in v){const B=v[I];if(!this.opacities[I]){const D=new Gs(B,m,!1,!1);D.isHidden()||(this.opacities[I]=D,_=_||B.text.placed||B.icon.placed)}}for(const I in w)this.variableOffsets[I]||!this.opacities[I]||this.opacities[I].isHidden()||(this.variableOffsets[I]=w[I]);for(const I in S)this.placedOrientations[I]||!this.opacities[I]||this.opacities[I].isHidden()||(this.placedOrientations[I]=S[I]);if(u&&u.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");_?this.lastPlacementChangeTime=s:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=u?u.lastPlacementChangeTime:s)}updateLayerOpacities(s,u){const _={};for(const m of u){const v=m.getBucket(s);v&&m.latestFeatureIndex&&s.id===v.layerIds[0]&&this.updateBucketOpacities(v,m.tileID,_,m.collisionBoxArray)}}updateBucketOpacities(s,u,_,m){s.hasTextData()&&(s.text.opacityVertexArray.clear(),s.text.hasVisibleVertices=!1),s.hasIconData()&&(s.icon.opacityVertexArray.clear(),s.icon.hasVisibleVertices=!1),s.hasIconCollisionBoxData()&&s.iconCollisionBox.collisionVertexArray.clear(),s.hasTextCollisionBoxData()&&s.textCollisionBox.collisionVertexArray.clear();const v=s.layers[0],w=v.layout,S=new Gs(null,0,!1,!1,!0),I=w.get("text-allow-overlap"),B=w.get("icon-allow-overlap"),D=v._unevaluatedLayout.hasValue("text-variable-anchor")||v._unevaluatedLayout.hasValue("text-variable-anchor-offset"),U=w.get("text-rotation-alignment")==="map",k=w.get("text-pitch-alignment")==="map",j=w.get("icon-text-fit")!=="none",W=new Gs(null,0,I&&(B||!s.hasIconData()||w.get("icon-optional")),B&&(I||!s.hasTextData()||w.get("text-optional")),!0);!s.collisionArrays&&m&&(s.hasIconCollisionBoxData()||s.hasTextCollisionBoxData())&&s.deserializeCollisionBoxes(m);const Q=(st,ut,_t)=>{for(let lt=0;lt<ut/4;lt++)st.opacityVertexArray.emplaceBack(_t);st.hasVisibleVertices=st.hasVisibleVertices||_t!==Y},et=this.collisionBoxArrays.get(s.bucketInstanceId);for(let st=0;st<s.symbolInstances.length;st++){const ut=s.symbolInstances.get(st),{numHorizontalGlyphVertices:_t,numVerticalGlyphVertices:lt,crossTileID:gt}=ut;let mt=this.opacities[gt];_[gt]?mt=S:mt||(mt=W,this.opacities[gt]=mt),_[gt]=!0;const dt=ut.numIconVertices>0,wt=this.placedOrientations[ut.crossTileID],Ft=wt===c.at.vertical,Mt=wt===c.at.horizontal||wt===c.at.horizontalOnly;if(_t>0||lt>0){const Ot=zc(mt.text);Q(s.text,_t,Ft?Y:Ot),Q(s.text,lt,Mt?Y:Ot);const qt=mt.text.isHidden();[ut.rightJustifiedTextSymbolIndex,ut.centerJustifiedTextSymbolIndex,ut.leftJustifiedTextSymbolIndex].forEach((he=>{he>=0&&(s.text.placedSymbolArray.get(he).hidden=qt||Ft?1:0)})),ut.verticalPlacedTextSymbolIndex>=0&&(s.text.placedSymbolArray.get(ut.verticalPlacedTextSymbolIndex).hidden=qt||Mt?1:0);const Zt=this.variableOffsets[ut.crossTileID];Zt&&this.markUsedJustification(s,Zt.anchor,ut,wt);const Gt=this.placedOrientations[ut.crossTileID];Gt&&(this.markUsedJustification(s,"left",ut,Gt),this.markUsedOrientation(s,Gt,ut))}if(dt){const Ot=zc(mt.icon),qt=!(j&&ut.verticalPlacedIconSymbolIndex&&Ft);ut.placedIconSymbolIndex>=0&&(Q(s.icon,ut.numIconVertices,qt?Ot:Y),s.icon.placedSymbolArray.get(ut.placedIconSymbolIndex).hidden=mt.icon.isHidden()),ut.verticalPlacedIconSymbolIndex>=0&&(Q(s.icon,ut.numVerticalIconVertices,qt?Y:Ot),s.icon.placedSymbolArray.get(ut.verticalPlacedIconSymbolIndex).hidden=mt.icon.isHidden())}const Rt=et&&et.has(st)?et.get(st):{text:null,icon:null};if(s.hasIconCollisionBoxData()||s.hasTextCollisionBoxData()){const Ot=s.collisionArrays[st];if(Ot){let qt=new c.P(0,0);if(Ot.textBox||Ot.verticalTextBox){let Zt=!0;if(D){const Gt=this.variableOffsets[gt];Gt?(qt=ya(Gt.anchor,Gt.width,Gt.height,Gt.textOffset,Gt.textBoxScale),U&&qt._rotate(k?-this.transform.bearingInRadians:this.transform.bearingInRadians)):Zt=!1}if(Ot.textBox||Ot.verticalTextBox){let Gt;Ot.textBox&&(Gt=Ft),Ot.verticalTextBox&&(Gt=Mt),ba(s.textCollisionBox.collisionVertexArray,mt.text.placed,!Zt||Gt,Rt.text,qt.x,qt.y)}}if(Ot.iconBox||Ot.verticalIconBox){const Zt=!!(!Mt&&Ot.verticalIconBox);let Gt;Ot.iconBox&&(Gt=Zt),Ot.verticalIconBox&&(Gt=!Zt),ba(s.iconCollisionBox.collisionVertexArray,mt.icon.placed,Gt,Rt.icon,j?qt.x:0,j?qt.y:0)}}}}if(s.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[s.bucketInstanceId]&&(this.retainedQueryData[s.bucketInstanceId].featureSortOrder=s.featureSortOrder),s.hasTextData()&&s.text.opacityVertexBuffer&&s.text.opacityVertexBuffer.updateData(s.text.opacityVertexArray),s.hasIconData()&&s.icon.opacityVertexBuffer&&s.icon.opacityVertexBuffer.updateData(s.icon.opacityVertexArray),s.hasIconCollisionBoxData()&&s.iconCollisionBox.collisionVertexBuffer&&s.iconCollisionBox.collisionVertexBuffer.updateData(s.iconCollisionBox.collisionVertexArray),s.hasTextCollisionBoxData()&&s.textCollisionBox.collisionVertexBuffer&&s.textCollisionBox.collisionVertexBuffer.updateData(s.textCollisionBox.collisionVertexArray),s.text.opacityVertexArray.length!==s.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${s.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${s.text.layoutVertexArray.length}) / 4`);if(s.icon.opacityVertexArray.length!==s.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${s.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${s.icon.layoutVertexArray.length}) / 4`);s.bucketInstanceId in this.collisionCircleArrays&&(s.collisionCircleArray=this.collisionCircleArrays[s.bucketInstanceId],delete this.collisionCircleArrays[s.bucketInstanceId])}symbolFadeChange(s){return this.fadeDuration===0?1:(s-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(s){return Math.max(0,(this.transform.zoom-s)/1.5)}hasTransitions(s){return this.stale||s-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(s,u){const _=this.zoomAtLastRecencyCheck===u?1-this.zoomAdjustment(u):1;return this.zoomAtLastRecencyCheck=u,this.commitTime+this.fadeDuration*_>s}setStale(){this.stale=!0}}function ba(b,s,u,_,m,v){_&&_.length!==0||(_=[0,0,0,0]);const w=_[0]-Ge,S=_[1]-Ge,I=_[2]-Ge,B=_[3]-Ge;b.emplaceBack(s?1:0,u?1:0,m||0,v||0,w,S),b.emplaceBack(s?1:0,u?1:0,m||0,v||0,I,S),b.emplaceBack(s?1:0,u?1:0,m||0,v||0,I,B),b.emplaceBack(s?1:0,u?1:0,m||0,v||0,w,B)}const Bo=Math.pow(2,25),Ws=Math.pow(2,24),hl=Math.pow(2,17),va=Math.pow(2,16),xa=Math.pow(2,9),wa=Math.pow(2,8),dl=Math.pow(2,1);function zc(b){if(b.opacity===0&&!b.placed)return 0;if(b.opacity===1&&b.placed)return 4294967295;const s=b.placed?1:0,u=Math.floor(127*b.opacity);return u*Bo+s*Ws+u*hl+s*va+u*xa+s*wa+u*dl+s}const Y=0;class it{constructor(s){this._sortAcrossTiles=s.layout.get("symbol-z-order")!=="viewport-y"&&!s.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(s,u,_,m,v){const w=this._bucketParts;for(;this._currentTileIndex<s.length;)if(u.getBucketParts(w,m,s[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,v())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,w.sort(((S,I)=>S.sortKey-I.sortKey)));this._currentPartIndex<w.length;)if(u.placeLayerBucketPart(w[this._currentPartIndex],this._seenCrossTileIDs,_),this._currentPartIndex++,v())return!0;return!1}}class bt{constructor(s,u,_,m,v,w,S,I){this.placement=new ul(s,u,w,S,I),this._currentPlacementIndex=_.length-1,this._forceFullPlacement=m,this._showCollisionBoxes=v,this._done=!1}isDone(){return this._done}continuePlacement(s,u,_){const m=nt(),v=()=>!this._forceFullPlacement&&nt()-m>2;for(;this._currentPlacementIndex>=0;){const w=u[s[this._currentPlacementIndex]],S=this.placement.collisionIndex.transform.zoom;if(w.type==="symbol"&&(!w.minzoom||w.minzoom<=S)&&(!w.maxzoom||w.maxzoom>S)){if(this._inProgressLayer||(this._inProgressLayer=new it(w)),this._inProgressLayer.continuePlacement(_[w.source],this.placement,this._showCollisionBoxes,w,v))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(s){return this.placement.commit(s),this.placement}}const Nt=512/c.a3/2;class Jt{constructor(s,u,_){this.tileID=s,this.bucketInstanceId=_,this._symbolsByKey={};const m=new Map;for(let v=0;v<u.length;v++){const w=u.get(v),S=w.key,I=m.get(S);I?I.push(w):m.set(S,[w])}for(const[v,w]of m){const S={positions:w.map((I=>({x:Math.floor(I.anchorX*Nt),y:Math.floor(I.anchorY*Nt)}))),crossTileIDs:w.map((I=>I.crossTileID))};if(S.positions.length>128){const I=new c.aN(S.positions.length,16,Uint16Array);for(const{x:B,y:D}of S.positions)I.add(B,D);I.finish(),delete S.positions,S.index=I}this._symbolsByKey[v]=S}}getScaledCoordinates(s,u){const{x:_,y:m,z:v}=this.tileID.canonical,{x:w,y:S,z:I}=u.canonical,B=Nt/Math.pow(2,I-v),D=(S*c.a3+s.anchorY)*B,U=m*c.a3*Nt;return{x:Math.floor((w*c.a3+s.anchorX)*B-_*c.a3*Nt),y:Math.floor(D-U)}}findMatches(s,u,_){const m=this.tileID.canonical.z<u.canonical.z?1:Math.pow(2,this.tileID.canonical.z-u.canonical.z);for(let v=0;v<s.length;v++){const w=s.get(v);if(w.crossTileID)continue;const S=this._symbolsByKey[w.key];if(!S)continue;const I=this.getScaledCoordinates(w,u);if(S.index){const B=S.index.range(I.x-m,I.y-m,I.x+m,I.y+m).sort();for(const D of B){const U=S.crossTileIDs[D];if(!_[U]){_[U]=!0,w.crossTileID=U;break}}}else if(S.positions)for(let B=0;B<S.positions.length;B++){const D=S.positions[B],U=S.crossTileIDs[B];if(Math.abs(D.x-I.x)<=m&&Math.abs(D.y-I.y)<=m&&!_[U]){_[U]=!0,w.crossTileID=U;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map((({crossTileIDs:s})=>s))}}class de{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Re{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(s){const u=Math.round((s-this.lng)/360);if(u!==0)for(const _ in this.indexes){const m=this.indexes[_],v={};for(const w in m){const S=m[w];S.tileID=S.tileID.unwrapTo(S.tileID.wrap+u),v[S.tileID.key]=S}this.indexes[_]=v}this.lng=s}addBucket(s,u,_){if(this.indexes[s.overscaledZ]&&this.indexes[s.overscaledZ][s.key]){if(this.indexes[s.overscaledZ][s.key].bucketInstanceId===u.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(s.overscaledZ,this.indexes[s.overscaledZ][s.key])}for(let v=0;v<u.symbolInstances.length;v++)u.symbolInstances.get(v).crossTileID=0;this.usedCrossTileIDs[s.overscaledZ]||(this.usedCrossTileIDs[s.overscaledZ]={});const m=this.usedCrossTileIDs[s.overscaledZ];for(const v in this.indexes){const w=this.indexes[v];if(Number(v)>s.overscaledZ)for(const S in w){const I=w[S];I.tileID.isChildOf(s)&&I.findMatches(u.symbolInstances,s,m)}else{const S=w[s.scaledTo(Number(v)).key];S&&S.findMatches(u.symbolInstances,s,m)}}for(let v=0;v<u.symbolInstances.length;v++){const w=u.symbolInstances.get(v);w.crossTileID||(w.crossTileID=_.generate(),m[w.crossTileID]=!0)}return this.indexes[s.overscaledZ]===void 0&&(this.indexes[s.overscaledZ]={}),this.indexes[s.overscaledZ][s.key]=new Jt(s,u.symbolInstances,u.bucketInstanceId),!0}removeBucketCrossTileIDs(s,u){for(const _ of u.getCrossTileIDsLists())for(const m of _)delete this.usedCrossTileIDs[s][m]}removeStaleBuckets(s){let u=!1;for(const _ in this.indexes){const m=this.indexes[_];for(const v in m)s[m[v].bucketInstanceId]||(this.removeBucketCrossTileIDs(_,m[v]),delete m[v],u=!0)}return u}}class yr{constructor(){this.layerIndexes={},this.crossTileIDs=new de,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(s,u,_){let m=this.layerIndexes[s.id];m===void 0&&(m=this.layerIndexes[s.id]=new Re);let v=!1;const w={};m.handleWrapJump(_);for(const S of u){const I=S.getBucket(s);I&&s.id===I.layerIds[0]&&(I.bucketInstanceId||(I.bucketInstanceId=++this.maxBucketInstanceId),m.addBucket(S.tileID,I,this.crossTileIDs)&&(v=!0),w[I.bucketInstanceId]=!0)}return m.removeStaleBuckets(w)&&(v=!0),v}pruneUnusedLayers(s){const u={};s.forEach((_=>{u[_]=!0}));for(const _ in this.layerIndexes)u[_]||delete this.layerIndexes[_]}}var Te="void main() {fragColor=vec4(1.0);}";const nr={prelude:Ie(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
out highp vec4 fragColor;`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c
);}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
#ifdef GLOBE
if ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}
#endif
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;`),projectionMercator:Ie("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:Ie("",`#define GLOBE_RADIUS 6371008.8
uniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos
);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); 
if (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len
);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}`),background:Ie(`uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:Ie(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Ie(`in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {
#ifdef GLOBE
vec3 center_vector=projectToSphere(circle_center);
#endif
float angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {
#ifdef GLOBE
vec4 projected_center=interpolateProjection(circle_center,center_vector,ele);
#else
vec4 projected_center=projectTileWithElevation(circle_center,ele);
#endif
corner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}
#ifdef GLOBE
vec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);
#else
gl_Position=projectTileWithElevation(corner_position,ele);
#endif
} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Ie(Te,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:Ie(`uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);
#ifdef GLOBE
vec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);
#else
gl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));
#endif
}`),heatmapTexture:Ie(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Ie("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Ie("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),colorRelief:Ie(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;uniform vec4 u_unpack;uniform sampler2D u_elevation_stops;uniform sampler2D u_color_stops;uniform int u_color_ramp_size;uniform float u_opacity;in vec2 v_pos;float getElevation(vec2 coord) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}float getElevationStop(int stop) {float x=(float(stop)+0.5)/float(u_color_ramp_size);vec4 data=texture(u_elevation_stops,vec2(x,0))*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {float el=getElevation(v_pos);int r=(u_color_ramp_size-1);int l=0;float el_l=getElevationStop(l);float el_r=getElevationStop(r);while(r-l > 1){int m=(r+l)/2;float el_m=getElevationStop(m);if(el < el_m){r=m;el_r=el_m;}else
{l=m;el_l=el_m;}}float x=(float(l)+(el-el_l)/(el_r-el_l)+0.5)/float(u_color_ramp_size);fragColor=u_opacity*texture(u_color_stops,vec2(x,0));
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_dimension;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_pos/8192.0)*scale+epsilon;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),debug:Ie("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:Ie(Te,`in vec2 a_pos;void main() {
#ifdef GLOBE
gl_Position=projectTileFor3D(a_pos,0.0);
#else
gl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);
#endif
}`),fill:Ie(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
fragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_fill_translate;in vec2 a_pos;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);}`),fillOutline:Ie(`in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillOutlinePattern:Ie(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillPattern:Ie(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Ie(`in vec4 v_color;void main() {fragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
out vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);
#ifdef GLOBE
mat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);
#endif
directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Ie(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
#ifdef GLOBE
out vec3 v_sphere_pos;
#endif
out vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Ie(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {vec2 epsilon=1.0/u_dimension;float tileSize=u_dimension.x-2.0;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))*tileSize/pow(2.0,exaggeration+(28.2562-u_zoom));fragColor=clamp(vec4(deriv.x/8.0+0.5,deriv.y/8.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Ie(`uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform float u_exaggeration;uniform vec4 u_accent;uniform int u_method;uniform float u_altitudes[NUM_ILLUMINATION_SOURCES];uniform float u_azimuths[NUM_ILLUMINATION_SOURCES];uniform vec4 u_shadows[NUM_ILLUMINATION_SOURCES];uniform vec4 u_highlights[NUM_ILLUMINATION_SOURCES];
#define PI 3.141592653589793
#define STANDARD 0
#define COMBINED 1
#define IGOR 2
#define MULTIDIRECTIONAL 3
#define BASIC 4
float get_aspect(vec2 deriv){return deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);}void igor_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float aspect=get_aspect(deriv);float azimuth=u_azimuths[0]+PI;float slope_stength=atan(length(deriv))*2.0/PI;float aspect_strength=1.0-abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);float shadow_strength=slope_stength*aspect_strength;float highlight_strength=slope_stength*(1.0-aspect_strength);fragColor=u_shadows[0]*shadow_strength+u_highlights[0]*highlight_strength;}void standard_hillshade(vec2 deriv){float azimuth=u_azimuths[0]+PI;float slope=atan(0.625*length(deriv));float aspect=get_aspect(deriv);float intensity=u_exaggeration;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadows[0],u_highlights[0],shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;}void basic_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor=u_highlights[0]*(2.0*shade-1.0);}else
{fragColor=u_shadows[0]*(1.0-2.0*shade);}}void multidirectional_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;fragColor=vec4(0,0,0,0);for(int i=0; i < NUM_ILLUMINATION_SOURCES; i++){float cos_alt=cos(u_altitudes[i]);float sin_alt=sin(u_altitudes[i]);float cos_az=-cos(u_azimuths[i]);float sin_az=-sin(u_azimuths[i]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor+=u_highlights[i]*(2.0*shade-1.0)/float(NUM_ILLUMINATION_SOURCES);}else
{fragColor+=u_shadows[i]*(1.0-2.0*shade)/float(NUM_ILLUMINATION_SOURCES);}}}void combined_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=acos((sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv)));cang=clamp(cang,0.0,PI/2.0);float shade=cang*atan(length(deriv))*4.0/PI/PI;float highlight=(PI/2.0-cang)*atan(length(deriv))*4.0/PI/PI;fragColor=u_shadows[0]*shade+u_highlights[0]*highlight;}void main() {vec4 pixel=texture(u_image,v_pos);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));vec2 deriv=((pixel.rg*8.0)-4.0)/scaleFactor;if (u_method==BASIC) {basic_hillshade(deriv);} else if (u_method==COMBINED) {combined_hillshade(deriv);} else if (u_method==IGOR) {igor_hillshade(deriv);} else if (u_method==MULTIDIRECTIONAL) {multidirectional_hillshade(deriv);} else if (u_method==STANDARD) {standard_hillshade(deriv);} else {standard_hillshade(deriv);}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:Ie(`uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Ie(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Ie(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Ie(`uniform lowp float u_device_pixel_ratio;uniform lowp float u_lineatlas_width;uniform sampler2D u_image;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfgamma=(u_lineatlas_width/256.0/u_device_pixel_ratio)/min(dasharray_from.w,dasharray_to.w);alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_tileratio;uniform float u_crossfade_from;uniform float u_crossfade_to;uniform float u_lineatlas_height;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
float u_patternscale_a_x=u_tileratio/dasharray_from.w/u_crossfade_from;float u_patternscale_a_y=-dasharray_from.z/2.0/u_lineatlas_height;float u_patternscale_b_x=u_tileratio/dasharray_to.w/u_crossfade_to;float u_patternscale_b_y=-dasharray_to.z/2.0/u_lineatlas_height;v_tex_a=vec2(a_linesofar*u_patternscale_a_x/floorwidth,normal.y*u_patternscale_a_y+(float(dasharray_from.y)+0.5)/u_lineatlas_height);v_tex_b=vec2(a_linesofar*u_patternscale_b_x/floorwidth,normal.y*u_patternscale_b_y+(float(dasharray_to.y)+0.5)/u_lineatlas_height);v_width2=vec2(outset,inset);}`),lineGradientSDF:Ie(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform sampler2D u_image_dash;uniform float u_mix;uniform lowp float u_lineatlas_width;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);float sdfdist_a=texture(u_image_dash,v_tex_a).a;float sdfdist_b=texture(u_image_dash,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfgamma=(u_lineatlas_width/256.0)/min(dasharray_from.w,dasharray_to.w);float dash_alpha=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*dash_alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;uniform float u_tileratio;uniform float u_crossfade_from;uniform float u_crossfade_to;uniform float u_lineatlas_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;out vec2 v_tex_a;out vec2 v_tex_b;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;float texel_height=1.0/u_image_height;float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
float u_patternscale_a_x=u_tileratio/dasharray_from.w/u_crossfade_from;float u_patternscale_a_y=-dasharray_from.z/2.0/u_lineatlas_height;float u_patternscale_b_x=u_tileratio/dasharray_to.w/u_crossfade_to;float u_patternscale_b_y=-dasharray_to.z/2.0/u_lineatlas_height;v_tex_a=vec2(a_linesofar*u_patternscale_a_x/floorwidth,normal.y*u_patternscale_a_y+(float(dasharray_from.y)+0.5)/u_lineatlas_height);v_tex_b=vec2(a_linesofar*u_patternscale_b_x/floorwidth,normal.y*u_patternscale_b_y+(float(dasharray_to.y)+0.5)/u_lineatlas_height);v_width2=vec2(outset,inset);}`),raster:Ie(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;
#ifdef GLOBE
if (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}
#endif
v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),symbolIcon:Ie(`uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Ie(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Ie(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Ie("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:Ie("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:Ie("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:Ie("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:Ie(`in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758
);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}`,"in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:Ie("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function Ie(b,s){const u=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,_=s.match(/in ([\w]+) ([\w]+)/g),m=b.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),v=s.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),w=v?v.concat(m):m,S={};return{fragmentSource:b=b.replace(u,((I,B,D,U,k)=>(S[k]=!0,B==="define"?`
#ifndef HAS_UNIFORM_u_${k}
in ${D} ${U} ${k};
#else
uniform ${D} ${U} u_${k};
#endif
`:`
#ifdef HAS_UNIFORM_u_${k}
    ${D} ${U} ${k} = u_${k};
#endif
`))),vertexSource:s=s.replace(u,((I,B,D,U,k)=>{const j=U==="float"?"vec2":"vec4",W=k.match(/color/)?"color":j;return S[k]?B==="define"?`
#ifndef HAS_UNIFORM_u_${k}
uniform lowp float u_${k}_t;
in ${D} ${j} a_${k};
out ${D} ${U} ${k};
#else
uniform ${D} ${U} u_${k};
#endif
`:W==="vec4"?`
#ifndef HAS_UNIFORM_u_${k}
    ${k} = a_${k};
#else
    ${D} ${U} ${k} = u_${k};
#endif
`:`
#ifndef HAS_UNIFORM_u_${k}
    ${k} = unpack_mix_${W}(a_${k}, u_${k}_t);
#else
    ${D} ${U} ${k} = u_${k};
#endif
`:B==="define"?`
#ifndef HAS_UNIFORM_u_${k}
uniform lowp float u_${k}_t;
in ${D} ${j} a_${k};
#else
uniform ${D} ${U} u_${k};
#endif
`:W==="vec4"?`
#ifndef HAS_UNIFORM_u_${k}
    ${D} ${U} ${k} = a_${k};
#else
    ${D} ${U} ${k} = u_${k};
#endif
`:`
#ifndef HAS_UNIFORM_u_${k}
    ${D} ${U} ${k} = unpack_mix_${W}(a_${k}, u_${k}_t);
#else
    ${D} ${U} ${k} = u_${k};
#endif
`})),staticAttributes:_,staticUniforms:w}}class uo{constructor(s,u,_){this.vertexBuffer=s,this.indexBuffer=u,this.segments=_}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var Yr=c.aO([{name:"a_pos",type:"Int16",components:2}]);const Oi="#define PROJECTION_MERCATOR",ki="mercator";class ri{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return ki}get shaderDefine(){return Oi}get shaderPreludeCode(){return nr.projectionMercator}get vertexShaderPreludeCode(){return nr.projectionMercator.vertexSource}get subdivisionGranularity(){return c.aP.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(s){}getMeshFromTileID(s,u,_,m,v){if(this._cachedMesh)return this._cachedMesh;const w=new c.aQ;w.emplaceBack(0,0),w.emplaceBack(c.a3,0),w.emplaceBack(0,c.a3),w.emplaceBack(c.a3,c.a3);const S=s.createVertexBuffer(w,Yr.members),I=c.aR.simpleSegment(0,0,4,2),B=new c.aS;B.emplaceBack(1,0,2),B.emplaceBack(1,2,3);const D=s.createIndexBuffer(B);return this._cachedMesh=new uo(S,D,I),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(s){}}class dr{constructor(s=0,u=0,_=0,m=0){if(isNaN(s)||s<0||isNaN(u)||u<0||isNaN(_)||_<0||isNaN(m)||m<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=s,this.bottom=u,this.left=_,this.right=m}interpolate(s,u,_){return u.top!=null&&s.top!=null&&(this.top=c.F.number(s.top,u.top,_)),u.bottom!=null&&s.bottom!=null&&(this.bottom=c.F.number(s.bottom,u.bottom,_)),u.left!=null&&s.left!=null&&(this.left=c.F.number(s.left,u.left,_)),u.right!=null&&s.right!=null&&(this.right=c.F.number(s.right,u.right,_)),this}getCenter(s,u){const _=c.ai((this.left+s-this.right)/2,0,s),m=c.ai((this.top+u-this.bottom)/2,0,u);return new c.P(_,m)}equals(s){return this.top===s.top&&this.bottom===s.bottom&&this.left===s.left&&this.right===s.right}clone(){return new dr(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Vc(b,s){if(!b.renderWorldCopies||b.lngRange)return;const u=s.lng-b.center.lng;s.lng+=u>180?-360:u<-180?360:0}function $i(b){return Math.max(0,Math.floor(b))}class ts{constructor(s,u){var _;this.applyConstrain=(m,v)=>this._constrainOverride!==null?this._constrainOverride(m,v):this._callbacks.defaultConstrain(m,v),this._callbacks=s,this._tileSize=512,this._renderWorldCopies=u?.renderWorldCopies===void 0||!!u?.renderWorldCopies,this._minZoom=u?.minZoom||0,this._maxZoom=u?.maxZoom||22,this._minPitch=u?.minPitch==null?0:u?.minPitch,this._maxPitch=u?.maxPitch==null?60:u?.maxPitch,this._constrainOverride=(_=u?.constrainOverride)!==null&&_!==void 0?_:null,this.setMaxBounds(),this._width=0,this._height=0,this._center=new c.U(0,0),this._elevation=0,this._zoom=0,this._tileZoom=$i(this._zoom),this._scale=c.al(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new dr,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(s,u,_){this._constrainOverride=s.constrainOverride,this._latRange=s.latRange,this._lngRange=s.lngRange,this._width=s.width,this._height=s.height,this._center=s.center,this._elevation=s.elevation,this._minElevationForCurrentTile=s.minElevationForCurrentTile,this._zoom=s.zoom,this._tileZoom=$i(this._zoom),this._scale=c.al(this._zoom),this._bearingInRadians=s.bearingInRadians,this._fovInRadians=s.fovInRadians,this._pitchInRadians=s.pitchInRadians,this._rollInRadians=s.rollInRadians,this._unmodified=s.unmodified,this._edgeInsets=new dr(s.padding.top,s.padding.bottom,s.padding.left,s.padding.right),this._minZoom=s.minZoom,this._maxZoom=s.maxZoom,this._minPitch=s.minPitch,this._maxPitch=s.maxPitch,this._renderWorldCopies=s.renderWorldCopies,this._cameraToCenterDistance=s.cameraToCenterDistance,this._nearZ=s.nearZ,this._farZ=s.farZ,this._autoCalculateNearFarZ=!_&&s.autoCalculateNearFarZ,u&&this.constrainInternal(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(s){this._minElevationForCurrentTile=s}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(s){this._minZoom!==s&&(this._minZoom=s,this.setZoom(this.applyConstrain(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(s){this._maxZoom!==s&&(this._maxZoom=s,this.setZoom(this.applyConstrain(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(s){this._minPitch!==s&&(this._minPitch=s,this.setPitch(Math.max(this.pitch,s)))}get maxPitch(){return this._maxPitch}setMaxPitch(s){this._maxPitch!==s&&(this._maxPitch=s,this.setPitch(Math.min(this.pitch,s)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(s){s===void 0?s=!0:s===null&&(s=!1),this._renderWorldCopies=s}get constrainOverride(){return this._constrainOverride}setConstrainOverride(s){s===void 0&&(s=null),this._constrainOverride!==s&&(this._constrainOverride=s,this.constrainInternal(),this._calcMatrices())}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new c.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(s){const u=c.V(s,-180,180)*Math.PI/180;var _,m,v,w,S,I,B,D,U;this._bearingInRadians!==u&&(this._unmodified=!1,this._bearingInRadians=u,this._calcMatrices(),this._rotationMatrix=C(),_=this._rotationMatrix,v=-this._bearingInRadians,w=(m=this._rotationMatrix)[0],S=m[1],I=m[2],B=m[3],D=Math.sin(v),U=Math.cos(v),_[0]=w*U+I*D,_[1]=S*U+B*D,_[2]=w*-D+I*U,_[3]=S*-D+B*U)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(s){const u=c.ai(s,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==u&&(this._unmodified=!1,this._pitchInRadians=u,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(s){const u=s/180*Math.PI;this._rollInRadians!==u&&(this._unmodified=!1,this._rollInRadians=u,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return c.aT(this._fovInRadians)}setFov(s){s=c.ai(s,.1,150),this.fov!==s&&(this._unmodified=!1,this._fovInRadians=c.ak(s),this._calcMatrices())}get zoom(){return this._zoom}setZoom(s){const u=this.applyConstrain(this._center,s).zoom;this._zoom!==u&&(this._unmodified=!1,this._zoom=u,this._tileZoom=Math.max(0,Math.floor(u)),this._scale=c.al(u),this.constrainInternal(),this._calcMatrices())}get center(){return this._center}setCenter(s){s.lat===this._center.lat&&s.lng===this._center.lng||(this._unmodified=!1,this._center=s,this.constrainInternal(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(s){s!==this._elevation&&(this._elevation=s,this.constrainInternal(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(s){this._edgeInsets.equals(s)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,s,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(s,u){this._autoCalculateNearFarZ=!1,this._nearZ=s,this._farZ=u,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(s){return this._edgeInsets.equals(s)}interpolatePadding(s,u,_){this._unmodified=!1,this._edgeInsets.interpolate(s,u,_),this.constrainInternal(),this._calcMatrices()}resize(s,u,_=!0){this._width=s,this._height=u,_&&this.constrainInternal(),this._calcMatrices()}getMaxBounds(){return this._latRange&&this._latRange.length===2&&this._lngRange&&this._lngRange.length===2?new We([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(s){s?(this._lngRange=[s.getWest(),s.getEast()],this._latRange=[s.getSouth(),s.getNorth()],this.constrainInternal()):(this._lngRange=null,this._latRange=[-c.aj,c.aj])}getCameraQueryGeometry(s,u){if(u.length===1)return[u[0],s];{const{minX:_,minY:m,maxX:v,maxY:w}=c.a6.fromPoints(u).extend(s);return[new c.P(_,m),new c.P(v,m),new c.P(v,w),new c.P(_,w),new c.P(_,m)]}}constrainInternal(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;const s=this._unmodified,{center:u,zoom:_}=this.applyConstrain(this.center,this.zoom);this.setCenter(u),this.setZoom(_),this._unmodified=s,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let s=c.am(new Float64Array(16));c.O(s,s,[this._width/2,-this._height/2,1]),c.N(s,s,[1,-1,0]),this._clipSpaceToPixelsMatrix=s,s=c.am(new Float64Array(16)),c.O(s,s,[1,-1,1]),c.N(s,s,[-1,-1,0]),c.O(s,s,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=s,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(s,u,_,m){const v=_!==void 0?_:this.bearing,w=m=m!==void 0?m:this.pitch,S=c.a5.fromLngLat(s,u),I=-Math.cos(c.ak(w)),B=Math.sin(c.ak(w)),D=B*Math.sin(c.ak(v)),U=-B*Math.cos(c.ak(v));let k=this.elevation;const j=u-k;let W;I*j>=0||Math.abs(I)<.1?(W=1e4,k=u+W*I):W=-j/I;let Q,et,st=c.aU(1,S.y),ut=0;do{if(ut+=1,ut>10)break;et=W/st,Q=new c.a5(S.x+D*et,S.y+U*et),st=1/Q.meterInMercatorCoordinateUnits()}while(Math.abs(W-et*st)>1e-12);return{center:Q.toLngLat(),elevation:k,zoom:c.ao(this.height/2/Math.tan(this.fovInRadians/2)/et/this.tileSize)}}recalculateZoomAndCenter(s){if(this.elevation-s==0)return;const u=c.an(1,this.center.lat)*this.worldSize,_=this.cameraToCenterDistance/u,m=c.a5.fromLngLat(this.center,this.elevation),v=xt(this.center,this.elevation,this.pitch,this.bearing,_);this._elevation=s;const w=this.calculateCenterFromCameraLngLatAlt(v.toLngLat(),c.aU(v.z,m.y),this.bearing,this.pitch);this._elevation=w.elevation,this._center=w.center,this.setZoom(w.zoom)}getCameraPoint(){const s=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new c.P(s*Math.sin(this.rollInRadians),s*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){const s=c.an(1,this.center.lat)*this.worldSize;return xt(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/s).toLngLat()}getMercatorTileCoordinates(s){if(!s)return[0,0,1,1];const u=s.canonical.z>=0?1<<s.canonical.z:Math.pow(2,s.canonical.z);return[s.canonical.x/u,s.canonical.y/u,1/u/c.a3,1/u/c.a3]}}class Ni{constructor(s,u){this.min=s,this.max=u,this.center=c.aV([],c.aW([],this.min,this.max),.5)}quadrant(s){const u=[s%2==0,s<2],_=c.aX(this.min),m=c.aX(this.max);for(let v=0;v<u.length;v++)_[v]=u[v]?this.min[v]:this.center[v],m[v]=u[v]?this.center[v]:this.max[v];return m[2]=this.max[2],new Ni(_,m)}distanceX(s){return Math.max(Math.min(this.max[0],s[0]),this.min[0])-s[0]}distanceY(s){return Math.max(Math.min(this.max[1],s[1]),this.min[1])-s[1]}intersectsFrustum(s){let u=!0;for(let _=0;_<s.planes.length;_++){const m=this.intersectsPlane(s.planes[_]);if(m===0)return 0;m===1&&(u=!1)}return u?2:s.aabb.min[0]>this.max[0]||s.aabb.min[1]>this.max[1]||s.aabb.min[2]>this.max[2]||s.aabb.max[0]<this.min[0]||s.aabb.max[1]<this.min[1]||s.aabb.max[2]<this.min[2]?0:1}intersectsPlane(s){let u=s[3],_=s[3];for(let m=0;m<3;m++)s[m]>0?(u+=s[m]*this.min[m],_+=s[m]*this.max[m]):(_+=s[m]*this.min[m],u+=s[m]*this.max[m]);return u>=0?2:_<0?0:1}}class Tp{distanceToTile2d(s,u,_,m){const v=m.distanceX([s,u]),w=m.distanceY([s,u]);return Math.hypot(v,w)}getWrap(s,u,_){return _}getTileBoundingVolume(s,u,_,m){var v,w;let S=0,I=0;if(m?.terrain){const D=new c.a0(s.z,u,s.z,s.x,s.y),U=m.terrain.getMinMaxElevation(D);S=(v=U.minElevation)!==null&&v!==void 0?v:Math.min(0,_),I=(w=U.maxElevation)!==null&&w!==void 0?w:Math.max(0,_)}const B=1<<s.z;return new Ni([u+s.x/B,s.y/B,S],[u+(s.x+1)/B,(s.y+1)/B,I])}allowVariableZoom(s,u){const _=s.fov*(Math.abs(Math.cos(s.rollInRadians))*s.height+Math.abs(Math.sin(s.rollInRadians))*s.width)/s.height,m=c.ai(78.5-_/2,0,60);return!!u.terrain||s.pitch>m}allowWorldCopies(){return!0}prepareNextFrame(){}}class ho{constructor(s,u,_){this.points=s,this.planes=u,this.aabb=_}static fromInvProjectionMatrix(s,u=1,_=0,m,v){const w=v?[[6,5,4],[0,1,2],[0,3,7],[2,1,5],[3,2,6],[0,4,5]]:[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]],S=Math.pow(2,_),I=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((k=>(function(j,W,Q,et){const st=c.aB([],j,W),ut=1/st[3]/Q*et;return c.b0(st,st,[ut,ut,1/st[3],ut])})(k,s,u,S)));m&&(function(k,j,W,Q){const et=Q?4:0,st=Q?0:4;let ut=0;const _t=[],lt=[];for(let dt=0;dt<4;dt++){const wt=c.aY([],k[dt+st],k[dt+et]),Ft=c.b1(wt);c.aV(wt,wt,1/Ft),_t.push(Ft),lt.push(wt)}for(let dt=0;dt<4;dt++){const wt=c.b2(k[dt+et],lt[dt],W);ut=wt!==null&&wt>=0?Math.max(ut,wt):Math.max(ut,_t[dt])}const gt=(function(dt,wt){const Ft=c.aY([],dt[wt[0]],dt[wt[1]]),Mt=c.aY([],dt[wt[2]],dt[wt[1]]),Rt=[0,0,0,0];return c.aZ(Rt,c.a_([],Ft,Mt)),Rt[3]=-c.a$(Rt,dt[wt[0]]),Rt})(k,j),mt=(function(dt,wt){const Ft=c.b3(dt),Mt=c.b4([],dt,1/Ft),Rt=c.aY([],wt,c.aV([],Mt,c.a$(wt,Mt))),Ot=c.b3(Rt);if(Ot>0){const qt=Math.sqrt(1-Mt[3]*Mt[3]),Zt=c.aV([],Mt,-Mt[3]),Gt=c.aW([],Zt,c.aV([],Rt,qt/Ot));return c.b5(wt,Gt)}return null})(W,gt);if(mt!==null){const dt=mt/c.a$(lt[0],gt);ut=Math.min(ut,dt)}for(let dt=0;dt<4;dt++){const wt=Math.min(ut,_t[dt]);k[dt+st]=[k[dt+et][0]+lt[dt][0]*wt,k[dt+et][1]+lt[dt][1]*wt,k[dt+et][2]+lt[dt][2]*wt,1]}})(I,w[0],m,v);const B=w.map((k=>{const j=c.aY([],I[k[0]],I[k[1]]),W=c.aY([],I[k[2]],I[k[1]]),Q=c.aZ([],c.a_([],j,W)),et=-c.a$(Q,I[k[1]]);return Q.concat(et)})),D=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],U=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(const k of I)for(let j=0;j<3;j++)D[j]=Math.min(D[j],k[j]),U[j]=Math.max(U[j],k[j]);return new ho(I,B,new Ni(D,U))}}class br{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(s){this._helper.setMinZoom(s)}setMaxZoom(s){this._helper.setMaxZoom(s)}setMinPitch(s){this._helper.setMinPitch(s)}setMaxPitch(s){this._helper.setMaxPitch(s)}setRenderWorldCopies(s){this._helper.setRenderWorldCopies(s)}setBearing(s){this._helper.setBearing(s)}setPitch(s){this._helper.setPitch(s)}setRoll(s){this._helper.setRoll(s)}setFov(s){this._helper.setFov(s)}setZoom(s){this._helper.setZoom(s)}setCenter(s){this._helper.setCenter(s)}setElevation(s){this._helper.setElevation(s)}setMinElevationForCurrentTile(s){this._helper.setMinElevationForCurrentTile(s)}setPadding(s){this._helper.setPadding(s)}interpolatePadding(s,u,_){return this._helper.interpolatePadding(s,u,_)}isPaddingEqual(s){return this._helper.isPaddingEqual(s)}resize(s,u,_=!0){this._helper.resize(s,u,_)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(s){this._helper.setMaxBounds(s)}setConstrainOverride(s){this._helper.setConstrainOverride(s)}overrideNearFarZ(s,u){this._helper.overrideNearFarZ(s,u)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(s){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),s)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(s,u){}constructor(s){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this.defaultConstrain=(u,_)=>{_=c.ai(+_,this.minZoom,this.maxZoom);const m={center:new c.U(u.lng,u.lat),zoom:_};let v=this._helper._lngRange;if(!this._helper._renderWorldCopies&&v===null){const lt=179.9999999999;v=[-lt,lt]}const w=this.tileSize*c.al(m.zoom);let S=0,I=w,B=0,D=w,U=0,k=0;const{x:j,y:W}=this.size;if(this._helper._latRange){const lt=this._helper._latRange;S=c.W(lt[1])*w,I=c.W(lt[0])*w,I-S<W&&(U=W/(I-S))}v&&(B=c.V(c.X(v[0])*w,0,w),D=c.V(c.X(v[1])*w,0,w),D<B&&(D+=w),D-B<j&&(k=j/(D-B)));const{x:Q,y:et}=ht(w,u);let st,ut;const _t=Math.max(k||0,U||0);if(_t){const lt=new c.P(k?(D+B)/2:Q,U?(I+S)/2:et);return m.center=ft(w,lt).wrap(),m.zoom+=c.ao(_t),m}if(this._helper._latRange){const lt=W/2;et-lt<S&&(ut=S+lt),et+lt>I&&(ut=I-lt)}if(v){const lt=(B+D)/2;let gt=Q;this._helper._renderWorldCopies&&(gt=c.V(Q,lt-w/2,lt+w/2));const mt=j/2;gt-mt<B&&(st=B+mt),gt+mt>D&&(st=D-mt)}if(st!==void 0||ut!==void 0){const lt=new c.P(st??Q,ut??et);m.center=ft(w,lt).wrap()}return m},this.applyConstrain=(u,_)=>this._helper.applyConstrain(u,_),this._helper=new ts({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(u,_)=>this.defaultConstrain(u,_)},s),this._coveringTilesDetailsProvider=new Tp}clone(){const s=new br;return s.apply(this),s}apply(s,u,_){this._helper.apply(s,u,_)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(s){const u=[new c.b6(0,s)];if(this._helper._renderWorldCopies){const _=this.screenPointToMercatorCoordinate(new c.P(0,0)),m=this.screenPointToMercatorCoordinate(new c.P(this._helper._width,0)),v=this.screenPointToMercatorCoordinate(new c.P(this._helper._width,this._helper._height)),w=this.screenPointToMercatorCoordinate(new c.P(0,this._helper._height)),S=Math.floor(Math.min(_.x,m.x,v.x,w.x)),I=Math.floor(Math.max(_.x,m.x,v.x,w.x)),B=1;for(let D=S-B;D<=I+B;D++)D!==0&&u.push(new c.b6(D,s))}return u}getCameraFrustum(){return ho.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(s){const u=this.screenPointToLocation(this.centerPoint,s),_=s?s.getElevationForLngLatZoom(u,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(_)}setLocationAtPoint(s,u){const _=c.an(this.elevation,this.center.lat),m=this.screenPointToMercatorCoordinateAtZ(u,_),v=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,_),w=c.a5.fromLngLat(s),S=new c.a5(w.x-(m.x-v.x),w.y-(m.y-v.y));this.setCenter(S?.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(s,u){return u?this.coordinatePoint(c.a5.fromLngLat(s),u.getElevationForLngLatZoom(s,this._helper._tileZoom),this._pixelMatrix3D):this.coordinatePoint(c.a5.fromLngLat(s))}screenPointToLocation(s,u){var _;return(_=this.screenPointToMercatorCoordinate(s,u))===null||_===void 0?void 0:_.toLngLat()}screenPointToMercatorCoordinate(s,u){if(u){const _=u.pointCoordinate(s);if(_!=null)return _}return this.screenPointToMercatorCoordinateAtZ(s)}screenPointToMercatorCoordinateAtZ(s,u){const _=u||0,m=[s.x,s.y,0,1],v=[s.x,s.y,1,1];c.aB(m,m,this._pixelMatrixInverse),c.aB(v,v,this._pixelMatrixInverse);const w=m[3],S=v[3],I=m[1]/w,B=v[1]/S,D=m[2]/w,U=v[2]/S,k=D===U?0:(_-D)/(U-D);return new c.a5(c.F.number(m[0]/w,v[0]/S,k)/this.worldSize,c.F.number(I,B,k)/this.worldSize,_)}coordinatePoint(s,u=0,_=this._pixelMatrix){const m=[s.x*this.worldSize,s.y*this.worldSize,u,1];return c.aB(m,m,_),new c.P(m[0]/m[3],m[1]/m[3])}getBounds(){const s=Math.max(0,this._helper._height/2-Tt(this));return new We().extend(this.screenPointToLocation(new c.P(0,s))).extend(this.screenPointToLocation(new c.P(this._helper._width,s))).extend(this.screenPointToLocation(new c.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new c.P(0,this._helper._height)))}isPointOnMapSurface(s,u){return u?u.pointCoordinate(s)!=null:s.y>this.height/2-Tt(this)}calculatePosMatrix(s,u=!1,_){var m;const v=(m=s.key)!==null&&m!==void 0?m:c.b7(s.wrap,s.canonical.z,s.canonical.z,s.canonical.x,s.canonical.y),w=u?this._alignedPosMatrixCache:this._posMatrixCache;if(w.has(v)){const B=w.get(v);return _?B.f32:B.f64}const S=tt(s,this.worldSize);c.Q(S,u?this._alignedProjMatrix:this._viewProjMatrix,S);const I={f64:S,f32:new Float32Array(S)};return w.set(v,I),_?I.f32:I.f64}calculateFogMatrix(s){const u=s.key,_=this._fogMatrixCacheF32;if(_.has(u))return _.get(u);const m=tt(s,this.worldSize);return c.Q(m,this._fogMatrix,m),_.set(u,new Float32Array(m)),_.get(u)}calculateCenterFromCameraLngLatAlt(s,u,_,m){return this._helper.calculateCenterFromCameraLngLatAlt(s,u,_,m)}_calculateNearFarZIfNeeded(s,u,_){if(!this._helper.autoCalculateNearFarZ)return;const m=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),v=s-m*this._helper._pixelPerMeter/Math.cos(u),w=m<0?v:s,S=Math.PI/2+this.pitchInRadians,I=c.ak(this.fov)*(Math.abs(Math.cos(c.ak(this.roll)))*this.height+Math.abs(Math.sin(c.ak(this.roll)))*this.width)/this.height*(.5+_.y/this.height),B=Math.sin(I)*w/Math.sin(c.ai(Math.PI-S-I,.01,Math.PI-.01)),D=Tt(this),U=Math.atan(D/this._helper.cameraToCenterDistance),k=c.ak(.75),j=U>k?2*U*(.5+_.y/(2*D)):k,W=Math.sin(j)*w/Math.sin(c.ai(Math.PI-S-j,.01,Math.PI-.01)),Q=Math.min(B,W);this._helper._farZ=1.01*(Math.cos(Math.PI/2-u)*Q+w),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;const s=this.centerOffset,u=ht(this.worldSize,this.center),_=u.x,m=u.y;this._helper._pixelPerMeter=c.an(1,this.center.lat)*this.worldSize;const v=c.ak(Math.min(this.pitch,Z)),w=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(v));let S;this._calculateNearFarZIfNeeded(w,v,s),S=new Float64Array(16),c.b8(S,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),c.av(this._invProjMatrix,S),S[8]=2*-s.x/this._helper._width,S[9]=2*s.y/this._helper._height,this._projectionMatrix=c.b9(S),c.O(S,S,[1,-1,1]),c.N(S,S,[0,0,-this._helper.cameraToCenterDistance]),c.ba(S,S,-this.rollInRadians),c.bb(S,S,this.pitchInRadians),c.ba(S,S,-this.bearingInRadians),c.N(S,S,[-_,-m,0]),this._mercatorMatrix=c.O([],S,[this.worldSize,this.worldSize,this.worldSize]),c.O(S,S,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=c.Q(new Float64Array(16),this.clipSpaceToPixelsMatrix,S),c.N(S,S,[0,0,-this.elevation]),this._viewProjMatrix=S,this._invViewProjMatrix=c.av([],S);const I=[0,0,-1,1];c.aB(I,I,this._invViewProjMatrix),this._cameraPosition=[I[0]/I[3],I[1]/I[3],I[2]/I[3]],this._fogMatrix=new Float64Array(16),c.b8(this._fogMatrix,this.fovInRadians,this.width/this.height,w,this._helper._farZ),this._fogMatrix[8]=2*-s.x/this.width,this._fogMatrix[9]=2*s.y/this.height,c.O(this._fogMatrix,this._fogMatrix,[1,-1,1]),c.N(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),c.ba(this._fogMatrix,this._fogMatrix,-this.rollInRadians),c.bb(this._fogMatrix,this._fogMatrix,this.pitchInRadians),c.ba(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),c.N(this._fogMatrix,this._fogMatrix,[-_,-m,0]),c.O(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),c.N(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=c.Q(new Float64Array(16),this.clipSpaceToPixelsMatrix,S);const B=this._helper._width%2/2,D=this._helper._height%2/2,U=Math.cos(this.bearingInRadians),k=Math.sin(-this.bearingInRadians),j=_-Math.round(_)+U*B+k*D,W=m-Math.round(m)+U*D+k*B,Q=new Float64Array(S);if(c.N(Q,Q,[j>.5?j-1:j,W>.5?W-1:W,0]),this._alignedProjMatrix=Q,S=c.av(new Float64Array(16),this._pixelMatrix),!S)throw new Error("failed to invert matrix");this._pixelMatrixInverse=S,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;const s=this.screenPointToMercatorCoordinate(new c.P(0,0)),u=[s.x*this.worldSize,s.y*this.worldSize,0,1];return c.aB(u,u,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){const s=c.an(1,this.center.lat)*this.worldSize;return xt(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/s).toLngLat()}lngLatToCameraDepth(s,u){const _=c.a5.fromLngLat(s),m=[_.x*this.worldSize,_.y*this.worldSize,u,1];return c.aB(m,m,this._viewProjMatrix),m[2]/m[3]}getProjectionData(s){const{overscaledTileID:u,aligned:_,applyTerrainMatrix:m}=s,v=this._helper.getMercatorTileCoordinates(u),w=u?this.calculatePosMatrix(u,_,!0):null;let S;return S=u&&u.terrainRttPosMatrix32f&&m?u.terrainRttPosMatrix32f:w||c.bc(),{mainMatrix:S,tileMercatorCoords:v,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:S}}isLocationOccluded(s){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(s,u,_){return 1}transformLightDirection(s){return c.aX(s)}getRayDirectionFromPixel(s){throw new Error("Not implemented.")}projectTileCoordinates(s,u,_,m){const v=this.calculatePosMatrix(_);let w;m?(w=[s,u,m(s,u),1],c.aB(w,w,v)):(w=[s,u,0,1],Fi(w,w,v));const S=w[3];return{point:new c.P(w[0]/S,w[1]/S),signedDistanceFromCamera:S,isOccluded:!1}}populateCache(s){for(const u of s)this.calculatePosMatrix(u)}getMatrixForModel(s,u){const _=c.a5.fromLngLat(s,u),m=_.meterInMercatorCoordinateUnits(),v=c.bd();return c.N(v,v,[_.x,_.y,_.z]),c.ba(v,v,Math.PI),c.bb(v,v,Math.PI/2),c.O(v,v,[-m,m,m]),v}getProjectionDataForCustomLayer(s=!0){const u=new c.a0(0,0,0,0,0),_=this.getProjectionData({overscaledTileID:u,applyGlobeMatrix:s}),m=tt(u,this.worldSize);c.Q(m,this._viewProjMatrix,m),_.tileMercatorCoords=[0,0,1,1];const v=[c.a3,c.a3,this.worldSize/this._helper.pixelsPerMeter],w=c.be();return c.O(w,m,v),_.fallbackMatrix=w,_.mainMatrix=w,_}getFastPathSimpleProjectionMatrix(s){return this.calculatePosMatrix(s)}}function Ta(){c.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function fo(b){if(b.useSlerp)if(b.k<1){const s=c.bf(b.startEulerAngles.roll,b.startEulerAngles.pitch,b.startEulerAngles.bearing),u=c.bf(b.endEulerAngles.roll,b.endEulerAngles.pitch,b.endEulerAngles.bearing),_=new Float64Array(4);c.bg(_,s,u,b.k);const m=c.bh(_);b.tr.setRoll(m.roll),b.tr.setPitch(m.pitch),b.tr.setBearing(m.bearing)}else b.tr.setRoll(b.endEulerAngles.roll),b.tr.setPitch(b.endEulerAngles.pitch),b.tr.setBearing(b.endEulerAngles.bearing);else b.tr.setRoll(c.F.number(b.startEulerAngles.roll,b.endEulerAngles.roll,b.k)),b.tr.setPitch(c.F.number(b.startEulerAngles.pitch,b.endEulerAngles.pitch,b.k)),b.tr.setBearing(c.F.number(b.startEulerAngles.bearing,b.endEulerAngles.bearing,b.k))}function fl(b,s,u,_,m){const v=m.padding,w=ht(m.worldSize,u.getNorthWest()),S=ht(m.worldSize,u.getNorthEast()),I=ht(m.worldSize,u.getSouthEast()),B=ht(m.worldSize,u.getSouthWest()),D=c.ak(-_),U=w.rotate(D),k=S.rotate(D),j=I.rotate(D),W=B.rotate(D),Q=new c.P(Math.max(U.x,k.x,W.x,j.x),Math.max(U.y,k.y,W.y,j.y)),et=new c.P(Math.min(U.x,k.x,W.x,j.x),Math.min(U.y,k.y,W.y,j.y)),st=Q.sub(et),ut=(m.width-(v.left+v.right+s.left+s.right))/st.x,_t=(m.height-(v.top+v.bottom+s.top+s.bottom))/st.y;if(_t<0||ut<0)return void Ta();const lt=Math.min(c.ao(m.scale*Math.min(ut,_t)),b.maxZoom),gt=c.P.convert(b.offset),mt=new c.P((s.left-s.right)/2,(s.top-s.bottom)/2).rotate(c.ak(_)),dt=gt.add(mt).mult(m.scale/c.al(lt));return{center:ft(m.worldSize,w.add(I).div(2).sub(dt)),zoom:lt,bearing:_}}class es{get useGlobeControls(){return!1}handlePanInertia(s,u){const _=s.mag(),m=Math.abs(Tt(u));return{easingOffset:s.mult(Math.min(.75*m/_,1)),easingCenter:u.center}}handleMapControlsRollPitchBearingZoom(s,u){s.bearingDelta&&u.setBearing(u.bearing+s.bearingDelta),s.pitchDelta&&u.setPitch(u.pitch+s.pitchDelta),s.rollDelta&&u.setRoll(u.roll+s.rollDelta),s.zoomDelta&&u.setZoom(u.zoom+s.zoomDelta)}handleMapControlsPan(s,u,_){s.around.distSqr(u.centerPoint)<.01||u.setLocationAtPoint(_,s.around)}cameraForBoxAndBearing(s,u,_,m,v){return fl(s,u,_,m,v)}handleJumpToCenterZoom(s,u){s.zoom!==(u.zoom!==void 0?+u.zoom:s.zoom)&&s.setZoom(+u.zoom),u.center!==void 0&&s.setCenter(c.U.convert(u.center))}handleEaseTo(s,u){const _=s.zoom,m=s.padding,v={roll:s.roll,pitch:s.pitch,bearing:s.bearing},w={roll:u.roll===void 0?s.roll:u.roll,pitch:u.pitch===void 0?s.pitch:u.pitch,bearing:u.bearing===void 0?s.bearing:u.bearing},S=u.zoom!==void 0,I=!s.isPaddingEqual(u.padding);let B=!1;const D=S?+u.zoom:s.zoom;let U=s.centerPoint.add(u.offsetAsPoint);const k=s.screenPointToLocation(U),{center:j,zoom:W}=s.applyConstrain(c.U.convert(u.center||k),D??_);Vc(s,j);const Q=ht(s.worldSize,k),et=ht(s.worldSize,j).sub(Q),st=c.al(W-_);return B=W!==_,{easeFunc:ut=>{if(B&&s.setZoom(c.F.number(_,W,ut)),c.bi(v,w)||fo({startEulerAngles:v,endEulerAngles:w,tr:s,k:ut,useSlerp:v.roll!=w.roll}),I&&(s.interpolatePadding(m,u.padding,ut),U=s.centerPoint.add(u.offsetAsPoint)),u.around)s.setLocationAtPoint(u.around,u.aroundPoint);else{const _t=c.al(s.zoom-_),lt=W>_?Math.min(2,st):Math.max(.5,st),gt=Math.pow(lt,1-ut),mt=ft(s.worldSize,Q.add(et.mult(ut*gt)).mult(_t));s.setLocationAtPoint(s.renderWorldCopies?mt.wrap():mt,U)}},isZooming:B,elevationCenter:j}}handleFlyTo(s,u){const _=u.zoom!==void 0,m=s.zoom,v=s.applyConstrain(c.U.convert(u.center||u.locationAtOffset),_?+u.zoom:m),w=v.center,S=v.zoom;Vc(s,w);const I=ht(s.worldSize,u.locationAtOffset),B=ht(s.worldSize,w).sub(I),D=B.mag(),U=c.al(S-m);let k;if(u.minZoom!==void 0){const j=Math.min(+u.minZoom,m,S),W=s.applyConstrain(w,j).zoom;k=c.al(W-m)}return{easeFunc:(j,W,Q,et)=>{s.setZoom(j===1?S:m+c.ao(W));const st=j===1?w:ft(s.worldSize,I.add(B.mult(Q)).mult(W));s.setLocationAtPoint(s.renderWorldCopies?st.wrap():st,et)},scaleOfZoom:U,targetCenter:w,scaleOfMinZoom:k,pixelPathLength:D}}}class vr{constructor(s,u,_){this.blendFunction=s,this.blendColor=u,this.mask=_}}vr.Replace=[1,0],vr.disabled=new vr(vr.Replace,c.bj.transparent,[!1,!1,!1,!1]),vr.unblended=new vr(vr.Replace,c.bj.transparent,[!0,!0,!0,!0]),vr.alphaBlended=new vr([1,771],c.bj.transparent,[!0,!0,!0,!0]);const _n=2305;class je{constructor(s,u,_){this.enable=s,this.mode=u,this.frontFace=_}}je.disabled=new je(!1,1029,_n),je.backCCW=new je(!0,1029,_n),je.frontCCW=new je(!0,1028,_n);class Be{constructor(s,u,_){this.func=s,this.mask=u,this.range=_}}Be.ReadOnly=!1,Be.ReadWrite=!0,Be.disabled=new Be(519,Be.ReadOnly,[0,1]);const Aa=7680;class Ne{constructor(s,u,_,m,v,w){this.test=s,this.ref=u,this.mask=_,this.fail=m,this.depthFail=v,this.pass=w}}Ne.disabled=new Ne({func:519,mask:0},0,0,Aa,Aa,Aa);const Ea=new WeakMap;function Xs(b){var s;if(Ea.has(b))return Ea.get(b);{const u=(s=b.getParameter(b.VERSION))===null||s===void 0?void 0:s.startsWith("WebGL 2.0");return Ea.set(b,u),u}}class pl{get awaitingQuery(){return!!this._readbackQueue}constructor(s){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=s;const u=s.context,_=u.gl;this._texFormat=_.RGBA,this._texType=_.UNSIGNED_BYTE;const m=new c.aQ;m.emplaceBack(-1,-1),m.emplaceBack(2,-1),m.emplaceBack(-1,2);const v=new c.aS;v.emplaceBack(0,1,2),this._fullscreenTriangle=new uo(u.createVertexBuffer(m,Yr.members),u.createIndexBuffer(v),c.aR.simpleSegment(0,0,m.length,v.length)),this._resultBuffer=new Uint8Array(4),u.activeTexture.set(_.TEXTURE1);const w=_.createTexture();_.bindTexture(_.TEXTURE_2D,w),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_S,_.CLAMP_TO_EDGE),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_T,_.CLAMP_TO_EDGE),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MIN_FILTER,_.NEAREST),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MAG_FILTER,_.NEAREST),_.texImage2D(_.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=u.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(w),Xs(_)&&(this._pbo=_.createBuffer(),_.bindBuffer(_.PIXEL_PACK_BUFFER,this._pbo),_.bufferData(_.PIXEL_PACK_BUFFER,4,_.STREAM_READ),_.bindBuffer(_.PIXEL_PACK_BUFFER,null))}destroy(){const s=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),s.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(s,u){const _=this._updateCount;return this._readbackQueue?_>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():_>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(s,u),this._updateCount++,this._measuredError}_bindFramebuffer(){const s=this._cachedRenderContext.context,u=s.gl;s.activeTexture.set(u.TEXTURE1),u.bindTexture(u.TEXTURE_2D,this._fbo.colorAttachment.get()),s.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(s,u){const _=this._cachedRenderContext.context,m=_.gl;if(this._bindFramebuffer(),_.viewport.set([0,0,this._texWidth,this._texHeight]),_.clear({color:c.bj.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(_,m.TRIANGLES,Be.disabled,Ne.disabled,vr.unblended,je.disabled,((v,w)=>({u_input:v,u_output_expected:w}))(s,u),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&Xs(m)){m.bindBuffer(m.PIXEL_PACK_BUFFER,this._pbo),m.readBuffer(m.COLOR_ATTACHMENT0),m.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),m.bindBuffer(m.PIXEL_PACK_BUFFER,null);const v=m.fenceSync(m.SYNC_GPU_COMMANDS_COMPLETE,0);m.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:v}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){const s=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&Xs(s)){const u=s.clientWaitSync(this._readbackQueue.sync,0,0);if(u===s.WAIT_FAILED)return c.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(u===s.TIMEOUT_EXPIRED)return;s.bindBuffer(s.PIXEL_PACK_BUFFER,this._pbo),s.getBufferSubData(s.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),s.bindBuffer(s.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),s.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=pl._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(s){let u=0;return u+=s[0]/256,u+=s[1]/65536,u+=s[2]/16777216,s[3]<127&&(u=-u),u/128}}const Do=c.a3/128;function jc(b,s){const u=b.granularity!==void 0?Math.max(b.granularity,1):1,_=u+(b.generateBorders?2:0),m=u+(b.extendToNorthPole||b.generateBorders?1:0)+(b.extendToSouthPole||b.generateBorders?1:0),v=_+1,w=m+1,S=b.generateBorders?-1:0,I=b.generateBorders||b.extendToNorthPole?-1:0,B=u+(b.generateBorders?1:0),D=u+(b.generateBorders||b.extendToSouthPole?1:0),U=v*w,k=_*m*6,j=v*w>65536;if(j&&s==="16bit")throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");const W=j||s==="32bit",Q=new Int16Array(2*U);let et=0;for(let _t=I;_t<=D;_t++)for(let lt=S;lt<=B;lt++){let gt=lt/u*c.a3;lt===-1&&(gt=-Do),lt===u+1&&(gt=c.a3+Do);let mt=_t/u*c.a3;_t===-1&&(mt=b.extendToNorthPole?c.bl:-Do),_t===u+1&&(mt=b.extendToSouthPole?c.bm:c.a3+Do),Q[et++]=gt,Q[et++]=mt}const st=W?new Uint32Array(k):new Uint16Array(k);let ut=0;for(let _t=0;_t<m;_t++)for(let lt=0;lt<_;lt++){const gt=lt+1+_t*v,mt=lt+(_t+1)*v,dt=lt+1+(_t+1)*v;st[ut++]=lt+_t*v,st[ut++]=mt,st[ut++]=gt,st[ut++]=gt,st[ut++]=mt,st[ut++]=dt}return{vertices:Q.buffer.slice(0),indices:st.buffer.slice(0),uses32bitIndices:W}}const _l=new c.aP({fill:new c.bn(128,2),line:new c.bn(512,0),tile:new c.bn(128,32),stencil:new c.bn(128,1),circle:3});class gl{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return nr.projectionGlobe}get vertexShaderPreludeCode(){return nr.projectionMercator.vertexSource}get subdivisionGranularity(){return _l}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(s){this._errorMeasurement||(this._errorMeasurement=new pl(s));const u=c.W(this._errorQueryLatitudeDegrees),_=2*Math.atan(Math.exp(Math.PI-u*Math.PI*2))-.5*Math.PI,m=this._errorMeasurement.updateErrorLoop(u,_),v=nt();m!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=m,this._errorMeasurementLastChangeTime=v);const w=Math.min(Math.max((v-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=c.bo(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,c.bp(w))}_getMeshKey(s){return`${s.granularity.toString(36)}_${s.generateBorders?"b":""}${s.extendToNorthPole?"n":""}${s.extendToSouthPole?"s":""}`}getMeshFromTileID(s,u,_,m,v){const w=(v==="stencil"?_l.stencil:_l.tile).getGranularityForZoomLevel(u.z);return this._getMesh(s,{granularity:w,generateBorders:_,extendToNorthPole:u.y===0&&m,extendToSouthPole:u.y===(1<<u.z)-1&&m})}_getMesh(s,u){const _=this._getMeshKey(u);if(_ in this._tileMeshCache)return this._tileMeshCache[_];const m=(function(v,w){const S=jc(w,"16bit"),I=c.aQ.deserialize({arrayBuffer:S.vertices,length:S.vertices.byteLength/2/2}),B=c.aS.deserialize({arrayBuffer:S.indices,length:S.indices.byteLength/2/3});return new uo(v.createVertexBuffer(I,Yr.members),v.createIndexBuffer(B),c.aR.simpleSegment(0,0,I.length,B.length))})(s,u);return this._tileMeshCache[_]=m,m}recalculate(s){}hasTransition(){const s=nt();let u=!1;return u=u||(s-this._errorMeasurementLastChangeTime)/1e3<.7,u=u||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,u}setErrorQueryLatitudeDegrees(s){this._errorQueryLatitudeDegrees=s}}const Hc=new c.t({type:new c.D(c.u.projection.type)});class Sa extends c.E{constructor(s){super(),this._transitionable=new c.x(Hc,void 0),this.setProjection(s),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new c.G(0)),this._mercatorProjection=new ri,this._verticalPerspectiveProjection=new gl}get transitionState(){const s=this.properties.get("type");if(typeof s=="string"&&s==="mercator")return 0;if(typeof s=="string"&&s==="vertical-perspective")return 1;if(s instanceof c.bq){if(s.from==="vertical-perspective"&&s.to==="mercator")return 1-s.transition;if(s.from==="mercator"&&s.to==="vertical-perspective")return s.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(s){this._mercatorProjection.updateGPUdependent(s),this._verticalPerspectiveProjection.updateGPUdependent(s)}getMeshFromTileID(s,u,_,m,v){return this.currentProjection.getMeshFromTileID(s,u,_,m,v)}setProjection(s){this._transitionable.setValue("type",s?.type||"mercator")}updateTransitions(s){this._transitioning=this._transitionable.transitioned(s,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(s){this.properties=this._transitioning.possiblyEvaluate(s)}setErrorQueryLatitudeDegrees(s){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(s),this._mercatorProjection.setErrorQueryLatitudeDegrees(s)}}function Ap(b){const s=Gc(b.worldSize,b.center.lat);return 2*Math.PI*s}function gn(b,s,u,_,m){const v=1/(1<<m),w=s/c.a3*v+_*v,S=c.bs((b/c.a3*v+u*v)*Math.PI*2+Math.PI,2*Math.PI),I=2*Math.atan(Math.exp(Math.PI-w*Math.PI*2))-.5*Math.PI,B=Math.cos(I),D=new Float64Array(3);return D[0]=Math.sin(S)*B,D[1]=Math.sin(I),D[2]=Math.cos(S)*B,D}function Ei(b){return(function(s,u){const _=Math.cos(u),m=new Float64Array(3);return m[0]=Math.sin(s)*_,m[1]=Math.sin(u),m[2]=Math.cos(s)*_,m})(b.lng*Math.PI/180,b.lat*Math.PI/180)}function Gc(b,s){return b/(2*Math.PI)/Math.cos(s*Math.PI/180)}function Ep(b){const s=Math.asin(b[1])/Math.PI*180,u=Math.sqrt(b[0]*b[0]+b[2]*b[2]);if(u>1e-6){const _=b[0]/u,m=Math.acos(b[2]/u),v=(_>0?m:-m)/Math.PI*180;return new c.U(c.V(v,-180,180),s)}return new c.U(0,s)}function Si(b){return Math.cos(b*Math.PI/180)}function Kr(b,s){const u=Si(b),_=Si(s);return c.ao(_/u)}function qs(b,s){const u=b.rotate(s.bearingInRadians),_=s.zoom+Kr(s.center.lat,0),m=c.bo(1/Si(s.center.lat),1/Si(Math.min(Math.abs(s.center.lat),60)),c.br(_,7,3,0,1)),v=360/Ap({worldSize:s.worldSize,center:{lat:s.center.lat}});return new c.U(s.center.lng-u.x*v*m,c.ai(s.center.lat+u.y*v,-c.aj,c.aj))}function Ca(b){const s=.5*b,u=Math.sin(s),_=Math.cos(s);return Math.log(u+_)-Math.log(_-u)}function zh(b,s,u,_){const m=b.lat+u*_;if(Math.abs(u)>1){const v=(Math.sign(b.lat+u)!==Math.sign(b.lat)?-Math.abs(b.lat):Math.abs(b.lat))*Math.PI/180,w=Math.abs(b.lat+u)*Math.PI/180,S=Ca(v+_*(w-v)),I=Ca(v),B=Ca(w);return new c.U(b.lng+s*((S-I)/(B-I)),m)}return new c.U(b.lng+s*_,m)}class Sp{constructor(s){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._boundingVolumeFactory=s}swapBuffers(){if(!this._hadAnyChanges)return;const s=this._cachePrevious;this._cachePrevious=this._cache,this._cache=s,this._cache.clear(),this._hadAnyChanges=!1}getTileBoundingVolume(s,u,_,m){const v=`${s.z}_${s.x}_${s.y}_${m?.terrain?"t":""}`,w=this._cache.get(v);if(w)return w;const S=this._cachePrevious.get(v);if(S)return this._cache.set(v,S),S;const I=this._boundingVolumeFactory(s,u,_,m);return this._cache.set(v,I),this._hadAnyChanges=!0,I}}class Zs{constructor(s,u,_,m){this.min=_,this.max=m,this.points=s,this.planes=u}static fromAabb(s,u){const _=[];for(let m=0;m<8;m++)_.push([1&~m?s[0]:u[0],(m>>1&1)==1?u[1]:s[1],(m>>2&1)==1?u[2]:s[2]]);return new Zs(_,[[-1,0,0,u[0]],[1,0,0,-s[0]],[0,-1,0,u[1]],[0,1,0,-s[1]],[0,0,-1,u[2]],[0,0,1,-s[2]]],s,u)}static fromCenterSizeAngles(s,u,_){const m=c.bv([],_[0],_[1],_[2]),v=c.bw([],[u[0],0,0],m),w=c.bw([],[0,u[1],0],m),S=c.bw([],[0,0,u[2]],m),I=[...s],B=[...s];for(let U=0;U<8;U++)for(let k=0;k<3;k++){const j=s[k]+v[k]*(1&~U?-1:1)+w[k]*((U>>1&1)==1?1:-1)+S[k]*((U>>2&1)==1?1:-1);I[k]=Math.min(I[k],j),B[k]=Math.max(B[k],j)}const D=[];for(let U=0;U<8;U++){const k=[...s];c.aW(k,k,c.aV([],v,1&~U?-1:1)),c.aW(k,k,c.aV([],w,(U>>1&1)==1?1:-1)),c.aW(k,k,c.aV([],S,(U>>2&1)==1?1:-1)),D.push(k)}return new Zs(D,[[...v,-c.a$(v,D[0])],[...w,-c.a$(w,D[0])],[...S,-c.a$(S,D[0])],[-v[0],-v[1],-v[2],-c.a$(v,D[7])],[-w[0],-w[1],-w[2],-c.a$(w,D[7])],[-S[0],-S[1],-S[2],-c.a$(S,D[7])]],I,B)}intersectsFrustum(s){let u=!0;const _=this.points.length,m=this.planes.length,v=s.planes.length,w=s.points.length;for(let S=0;S<v;S++){const I=s.planes[S];let B=0;for(let D=0;D<_;D++){const U=this.points[D];I[0]*U[0]+I[1]*U[1]+I[2]*U[2]+I[3]>=0&&B++}if(B===0)return 0;B<_&&(u=!1)}if(u)return 2;for(let S=0;S<m;S++){const I=this.planes[S];let B=0;for(let D=0;D<w;D++){const U=s.points[D];I[0]*U[0]+I[1]*U[1]+I[2]*U[2]+I[3]>=0&&B++}if(B===0)return 0}return 1}intersectsPlane(s){const u=this.points.length;let _=0;for(let m=0;m<u;m++){const v=this.points[m];s[0]*v[0]+s[1]*v[1]+s[2]*v[2]+s[3]>=0&&_++}return _===u?2:_===0?0:1}}function $c(b,s,u){const _=b-s;return _<0?-_:Math.max(0,_-u)}function Vh(b,s,u,_,m){const v=b-u;let w;return w=v<0?Math.min(-v,1+v-m):v>1?Math.min(Math.max(v-m,0),1-v):0,Math.max(w,$c(s,_,m))}class Ky{constructor(){this._boundingVolumeCache=new Sp(this._computeTileBoundingVolume)}prepareNextFrame(){this._boundingVolumeCache.swapBuffers()}distanceToTile2d(s,u,_,m){const v=1<<_.z,w=1/v,S=_.x/v,I=_.y/v;let B=2;return B=Math.min(B,Vh(s,u,S,I,w)),B=Math.min(B,Vh(s,u,S+.5,-I-w,w)),B=Math.min(B,Vh(s,u,S+.5,2-I-w,w)),B}getWrap(s,u,_){const m=1<<u.z,v=1/m,w=u.x/m,S=$c(s.x,w,v),I=$c(s.x,w-1,v),B=$c(s.x,w+1,v),D=Math.min(S,I,B);return D===B?1:D===I?-1:0}allowVariableZoom(s,u){return ge(s,u)>4}allowWorldCopies(){return!1}getTileBoundingVolume(s,u,_,m){return this._boundingVolumeCache.getTileBoundingVolume(s,u,_,m)}_computeTileBoundingVolume(s,u,_,m){var v,w;let S=0,I=0;if(m?.terrain){const B=new c.a0(s.z,u,s.z,s.x,s.y),D=m.terrain.getMinMaxElevation(B);S=(v=D.minElevation)!==null&&v!==void 0?v:Math.min(0,_),I=(w=D.maxElevation)!==null&&w!==void 0?w:Math.max(0,_)}if(S/=c.by,I/=c.by,S+=1,I+=1,s.z<=0)return Zs.fromAabb([-I,-I,-I],[I,I,I]);if(s.z===1)return Zs.fromAabb([s.x===0?-I:0,s.y===0?0:-I,-I],[s.x===0?0:I,s.y===0?I:0,I]);{const B=[gn(0,0,s.x,s.y,s.z),gn(c.a3,0,s.x,s.y,s.z),gn(c.a3,c.a3,s.x,s.y,s.z),gn(0,c.a3,s.x,s.y,s.z)],D=[];for(const Rt of B)D.push(c.aV([],Rt,I));if(I!==S)for(const Rt of B)D.push(c.aV([],Rt,S));s.y===0&&D.push([0,1,0]),s.y===(1<<s.z)-1&&D.push([0,-1,0]);const U=[1,1,1],k=[-1,-1,-1];for(const Rt of D)for(let Ot=0;Ot<3;Ot++)U[Ot]=Math.min(U[Ot],Rt[Ot]),k[Ot]=Math.max(k[Ot],Rt[Ot]);const j=gn(c.a3/2,c.a3/2,s.x,s.y,s.z),W=c.a_([],[0,1,0],j);c.aZ(W,W);const Q=c.a_([],j,W);c.aZ(Q,Q);const et=c.a_([],B[2],B[1]);c.aZ(et,et);const st=c.a_([],B[0],B[3]);c.aZ(st,st),D.push(c.aV([],j,I)),s.y>=(1<<s.z)/2&&D.push(c.aV([],gn(c.a3/2,0,s.x,s.y,s.z),I)),s.y<(1<<s.z)/2&&D.push(c.aV([],gn(c.a3/2,c.a3,s.x,s.y,s.z),I));const ut=Cp(j,D),_t=Cp(Q,D),lt=[-j[0],-j[1],-j[2],ut.max],gt=[j[0],j[1],j[2],-ut.min],mt=[-Q[0],-Q[1],-Q[2],_t.max],dt=[Q[0],Q[1],Q[2],-_t.min],wt=[...et,0],Ft=[...st,0],Mt=[];return s.y===0?Mt.push(c.bx(Ft,wt,lt),c.bx(Ft,wt,gt)):Mt.push(c.bx(mt,wt,lt),c.bx(mt,wt,gt),c.bx(mt,Ft,lt),c.bx(mt,Ft,gt)),s.y===(1<<s.z)-1?Mt.push(c.bx(Ft,wt,lt),c.bx(Ft,wt,gt)):Mt.push(c.bx(dt,wt,lt),c.bx(dt,wt,gt),c.bx(dt,Ft,lt),c.bx(dt,Ft,gt)),new Zs(Mt,[lt,gt,mt,dt,wt,Ft],U,k)}}}function Cp(b,s){let u=1/0,_=-1/0;for(const m of s){const v=c.a$(b,m);u=Math.min(u,v),_=Math.max(_,v)}return{min:u,max:_}}class Wc{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(s){this._helper.setMinZoom(s)}setMaxZoom(s){this._helper.setMaxZoom(s)}setMinPitch(s){this._helper.setMinPitch(s)}setMaxPitch(s){this._helper.setMaxPitch(s)}setRenderWorldCopies(s){this._helper.setRenderWorldCopies(s)}setBearing(s){this._helper.setBearing(s)}setPitch(s){this._helper.setPitch(s)}setRoll(s){this._helper.setRoll(s)}setFov(s){this._helper.setFov(s)}setZoom(s){this._helper.setZoom(s)}setCenter(s){this._helper.setCenter(s)}setElevation(s){this._helper.setElevation(s)}setMinElevationForCurrentTile(s){this._helper.setMinElevationForCurrentTile(s)}setPadding(s){this._helper.setPadding(s)}interpolatePadding(s,u,_){return this._helper.interpolatePadding(s,u,_)}isPaddingEqual(s){return this._helper.isPaddingEqual(s)}resize(s,u){this._helper.resize(s,u)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(s){this._helper.setMaxBounds(s)}setConstrainOverride(s){this._helper.setConstrainOverride(s)}overrideNearFarZ(s,u){this._helper.overrideNearFarZ(s,u)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(s){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),s)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(s){}constructor(s){this._cachedClippingPlane=c.bz(),this._projectionMatrix=c.bd(),this._globeViewProjMatrix32f=c.bc(),this._globeViewProjMatrixNoCorrection=c.bd(),this._globeViewProjMatrixNoCorrectionInverted=c.bd(),this._globeProjMatrixInverted=c.bd(),this._cameraPosition=c.bt(),this._globeLatitudeErrorCorrectionRadians=0,this.defaultConstrain=(u,_)=>{const m=c.ai(u.lat,-c.aj,c.aj),v=c.ai(+_,this.minZoom+Kr(0,m),this.maxZoom);return{center:new c.U(u.lng,m),zoom:v}},this.applyConstrain=(u,_)=>this._helper.applyConstrain(u,_),this._helper=new ts({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(u,_)=>this.defaultConstrain(u,_)},s),this._coveringTilesDetailsProvider=new Ky}clone(){const s=new Wc;return s.apply(this),s}apply(s,u){this._globeLatitudeErrorCorrectionRadians=u||0,this._helper.apply(s)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){const s=c.bt();return s[0]=this._cameraPosition[0],s[1]=this._cameraPosition[1],s[2]=this._cameraPosition[2],s}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(s){const{overscaledTileID:u,applyGlobeMatrix:_}=s,m=this._helper.getMercatorTileCoordinates(u);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:m,clippingPlane:this._cachedClippingPlane,projectionTransition:_?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(s){const u=this.pitchInRadians,_=this.cameraToCenterDistance/s,m=Math.sin(u)*_,v=Math.cos(u)*_+1,w=1/Math.sqrt(m*m+v*v)*1;let S=-m,I=v;const B=Math.sqrt(S*S+I*I);S/=B,I/=B;const D=[0,S,I];c.bA(D,D,[0,0,0],-this.bearingInRadians),c.bB(D,D,[0,0,0],-1*this.center.lat*Math.PI/180),c.bC(D,D,[0,0,0],this.center.lng*Math.PI/180);const U=1/c.b1(D);return c.aV(D,D,U),[...D,-w*U]}isLocationOccluded(s){return!this.isSurfacePointVisible(Ei(s))}transformLightDirection(s){const u=this._helper._center.lng*Math.PI/180,_=this._helper._center.lat*Math.PI/180,m=Math.cos(_),v=[Math.sin(u)*m,Math.sin(_),Math.cos(u)*m],w=[v[2],0,-v[0]],S=[0,0,0];c.a_(S,w,v),c.aZ(w,w),c.aZ(S,S);const I=[0,0,0];return c.aZ(I,[w[0]*s[0]+S[0]*s[1]+v[0]*s[2],w[1]*s[0]+S[1]*s[1]+v[1]*s[2],w[2]*s[0]+S[2]*s[1]+v[2]*s[2]]),I}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(s,u,_){const m=(function(S,I,B){const D=1/(1<<B.z);return new c.a5(S/c.a3*D+B.x*D,I/c.a3*D+B.y*D)})(s,u,_.canonical),v=(w=m.y,[c.bs(m.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-w*Math.PI*2))-.5*Math.PI]);var w;return this.getCircleRadiusCorrection()/Math.cos(v[1])}projectTileCoordinates(s,u,_,m){const v=_.canonical,w=gn(s,u,v.x,v.y,v.z),S=1+(m?m(s,u):0)/c.by,I=[w[0]*S,w[1]*S,w[2]*S,1];c.aB(I,I,this._globeViewProjMatrixNoCorrection);const B=this._cachedClippingPlane,D=B[0]*w[0]+B[1]*w[1]+B[2]*w[2]+B[3]<0;return{point:new c.P(I[0]/I[3],I[1]/I[3]),signedDistanceFromCamera:I[3],isOccluded:D}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;const s=Gc(this.worldSize,this.center.lat),u=c.be(),_=c.be();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*s),c.b8(u,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);const m=this.centerOffset;u[8]=2*-m.x/this._helper._width,u[9]=2*m.y/this._helper._height,this._projectionMatrix=c.b9(u),this._globeProjMatrixInverted=c.be(),c.av(this._globeProjMatrixInverted,u),c.N(u,u,[0,0,-this.cameraToCenterDistance]),c.ba(u,u,this.rollInRadians),c.bb(u,u,-this.pitchInRadians),c.ba(u,u,this.bearingInRadians),c.N(u,u,[0,0,-s]);const v=c.bt();v[0]=s,v[1]=s,v[2]=s,c.bb(_,u,this.center.lat*Math.PI/180),c.bD(_,_,-this.center.lng*Math.PI/180),c.O(_,_,v),this._globeViewProjMatrixNoCorrection=_,c.bb(u,u,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),c.bD(u,u,-this.center.lng*Math.PI/180),c.O(u,u,v),this._globeViewProjMatrix32f=new Float32Array(u),this._globeViewProjMatrixNoCorrectionInverted=c.be(),c.av(this._globeViewProjMatrixNoCorrectionInverted,_);const w=c.bt();this._cameraPosition=c.bt(),this._cameraPosition[2]=this.cameraToCenterDistance/s,c.bA(this._cameraPosition,this._cameraPosition,w,-this.rollInRadians),c.bB(this._cameraPosition,this._cameraPosition,w,this.pitchInRadians),c.bA(this._cameraPosition,this._cameraPosition,w,-this.bearingInRadians),c.aW(this._cameraPosition,this._cameraPosition,[0,0,1]),c.bB(this._cameraPosition,this._cameraPosition,w,-this.center.lat*Math.PI/180),c.bC(this._cameraPosition,this._cameraPosition,w,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(s);const S=c.b9(this._globeViewProjMatrixNoCorrectionInverted);c.O(S,S,[1,1,-1]),this._cachedFrustum=ho.fromInvProjectionMatrix(S,1,0,this._cachedClippingPlane,!0)}calculateFogMatrix(s){c.w("calculateFogMatrix is not supported on globe projection.");const u=c.be();return c.am(u),u}getVisibleUnwrappedCoordinates(s){return[new c.b6(0,s)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(s){s&&c.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(s,u){if(!this._globeViewProjMatrixNoCorrection)return 1;const _=Ei(s);c.aV(_,_,1+u/c.by);const m=c.bz();return c.aB(m,[_[0],_[1],_[2],1],this._globeViewProjMatrixNoCorrection),m[2]/m[3]}populateCache(s){}getBounds(){const s=.5*this.width,u=.5*this.height,_=[new c.P(0,0),new c.P(s,0),new c.P(this.width,0),new c.P(this.width,u),new c.P(this.width,this.height),new c.P(s,this.height),new c.P(0,this.height),new c.P(0,u)],m=[];for(const U of _)m.push(this.unprojectScreenPoint(U));let v=0,w=0,S=0,I=0;const B=this.center;for(const U of m){const k=c.bE(B.lng,U.lng),j=c.bE(B.lat,U.lat);k<w&&(w=k),k>v&&(v=k),j<I&&(I=j),j>S&&(S=j)}const D=[B.lng+w,B.lat+I,B.lng+v,B.lat+S];return this.isSurfacePointOnScreen([0,1,0])&&(D[3]=90,D[0]=-180,D[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(D[1]=-90,D[0]=-180,D[2]=180),new We(D)}calculateCenterFromCameraLngLatAlt(s,u,_,m){return this._helper.calculateCenterFromCameraLngLatAlt(s,u,_,m)}setLocationAtPoint(s,u){const _=Ei(this.unprojectScreenPoint(u)),m=Ei(s),v=c.bt();c.bF(v);const w=c.bt();c.bC(w,_,v,-this.center.lng*Math.PI/180),c.bB(w,w,v,this.center.lat*Math.PI/180);const S=m[0]*m[0]+m[2]*m[2],I=w[0]*w[0];if(S<I)return;const B=Math.sqrt(S-I),D=-B,U=c.bG(m[0],m[2],w[0],B),k=c.bG(m[0],m[2],w[0],D),j=c.bt();c.bC(j,m,v,-U);const W=c.bG(j[1],j[2],w[1],w[2]),Q=c.bt();c.bC(Q,m,v,-k);const et=c.bG(Q[1],Q[2],w[1],w[2]),st=.5*Math.PI,ut=W>=-st&&W<=st,_t=et>=-st&&et<=st;let lt,gt;if(ut&&_t){const Ft=this.center.lng*Math.PI/180,Mt=this.center.lat*Math.PI/180;c.bH(U,Ft)+c.bH(W,Mt)<c.bH(k,Ft)+c.bH(et,Mt)?(lt=U,gt=W):(lt=k,gt=et)}else if(ut)lt=U,gt=W;else{if(!_t)return;lt=k,gt=et}const mt=lt/Math.PI*180,dt=gt/Math.PI*180,wt=this.center.lat;this.setCenter(new c.U(mt,c.ai(dt,-90,90))),this.setZoom(this.zoom+Kr(wt,this.center.lat))}locationToScreenPoint(s,u){const _=Ei(s);if(u){const m=u.getElevationForLngLatZoom(s,this._helper._tileZoom);c.aV(_,_,1+m/c.by)}return this._projectSurfacePointToScreen(_)}_projectSurfacePointToScreen(s){const u=c.bz();return c.aB(u,[...s,1],this._globeViewProjMatrixNoCorrection),u[0]/=u[3],u[1]/=u[3],new c.P((.5*u[0]+.5)*this.width,(.5*-u[1]+.5)*this.height)}screenPointToMercatorCoordinate(s,u){if(u){const _=u.pointCoordinate(s);if(_)return _}return c.a5.fromLngLat(this.unprojectScreenPoint(s))}screenPointToLocation(s,u){var _;return(_=this.screenPointToMercatorCoordinate(s,u))===null||_===void 0?void 0:_.toLngLat()}isPointOnMapSurface(s,u){const _=this._cameraPosition,m=this.getRayDirectionFromPixel(s);return!!this.rayPlanetIntersection(_,m)}getRayDirectionFromPixel(s){const u=c.bz();u[0]=s.x/this.width*2-1,u[1]=-1*(s.y/this.height*2-1),u[2]=1,u[3]=1,c.aB(u,u,this._globeViewProjMatrixNoCorrectionInverted),u[0]/=u[3],u[1]/=u[3],u[2]/=u[3];const _=c.bt();_[0]=u[0]-this._cameraPosition[0],_[1]=u[1]-this._cameraPosition[1],_[2]=u[2]-this._cameraPosition[2];const m=c.bt();return c.aZ(m,_),m}isSurfacePointVisible(s){const u=this._cachedClippingPlane;return u[0]*s[0]+u[1]*s[1]+u[2]*s[2]+u[3]>=0}isSurfacePointOnScreen(s){if(!this.isSurfacePointVisible(s))return!1;const u=c.bz();return c.aB(u,[...s,1],this._globeViewProjMatrixNoCorrection),u[0]/=u[3],u[1]/=u[3],u[2]/=u[3],u[0]>-1&&u[0]<1&&u[1]>-1&&u[1]<1&&u[2]>-1&&u[2]<1}rayPlanetIntersection(s,u){const _=c.a$(s,u),m=c.bt(),v=c.bt();c.aV(v,u,_),c.aY(m,s,v);const w=1-c.a$(m,m);if(w<0)return null;const S=c.a$(s,s)-1,I=-_+(_<0?1:-1)*Math.sqrt(w),B=S/I,D=I;return{tMin:Math.min(B,D),tMax:Math.max(B,D)}}unprojectScreenPoint(s){const u=this._cameraPosition,_=this.getRayDirectionFromPixel(s),m=this.rayPlanetIntersection(u,_);if(m){const D=c.bt();c.aW(D,u,[_[0]*m.tMin,_[1]*m.tMin,_[2]*m.tMin]);const U=c.bt();return c.aZ(U,D),Ep(U)}const v=this._cachedClippingPlane,w=v[0]*_[0]+v[1]*_[1]+v[2]*_[2],S=-c.b5(v,u)/w,I=c.bt();if(S>0)c.aW(I,u,[_[0]*S,_[1]*S,_[2]*S]);else{const D=c.bt();c.aW(D,u,[2*_[0],2*_[1],2*_[2]]);const U=c.b5(this._cachedClippingPlane,D);c.aY(I,D,[this._cachedClippingPlane[0]*U,this._cachedClippingPlane[1]*U,this._cachedClippingPlane[2]*U])}const B=(function(D){const U=c.bt();return U[0]=D[0]*-D[3],U[1]=D[1]*-D[3],U[2]=D[2]*-D[3],{center:U,radius:Math.sqrt(1-D[3]*D[3])}})(v);return Ep((function(D,U,k){const j=c.bt();c.aY(j,k,D);const W=c.bt();return c.bu(W,D,j,U/c.b3(j)),W})(B.center,B.radius,I))}getMatrixForModel(s,u){const _=c.U.convert(s),m=1/c.by,v=c.bd();return c.bD(v,v,_.lng/180*Math.PI),c.bb(v,v,-_.lat/180*Math.PI),c.N(v,v,[0,0,1+u/c.by]),c.bb(v,v,.5*Math.PI),c.O(v,v,[m,m,m]),v}getProjectionDataForCustomLayer(s=!0){const u=this.getProjectionData({overscaledTileID:new c.a0(0,0,0,0,0),applyGlobeMatrix:s});return u.tileMercatorCoords=[0,0,1,1],u}getFastPathSimpleProjectionMatrix(s){}}class Xc{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(s){this._helper.setMinZoom(s)}setMaxZoom(s){this._helper.setMaxZoom(s)}setMinPitch(s){this._helper.setMinPitch(s)}setMaxPitch(s){this._helper.setMaxPitch(s)}setRenderWorldCopies(s){this._helper.setRenderWorldCopies(s)}setBearing(s){this._helper.setBearing(s)}setPitch(s){this._helper.setPitch(s)}setRoll(s){this._helper.setRoll(s)}setFov(s){this._helper.setFov(s)}setZoom(s){this._helper.setZoom(s)}setCenter(s){this._helper.setCenter(s)}setElevation(s){this._helper.setElevation(s)}setMinElevationForCurrentTile(s){this._helper.setMinElevationForCurrentTile(s)}setPadding(s){this._helper.setPadding(s)}interpolatePadding(s,u,_){return this._helper.interpolatePadding(s,u,_)}isPaddingEqual(s){return this._helper.isPaddingEqual(s)}resize(s,u,_=!0){this._helper.resize(s,u,_)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(s){this._helper.setMaxBounds(s)}setConstrainOverride(s){this._helper.setConstrainOverride(s)}overrideNearFarZ(s,u){this._helper.overrideNearFarZ(s,u)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(s){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),s)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(s,u){this._globeness=s,this._globeLatitudeErrorCorrectionRadians=u,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().prepareNextFrame(),this._mercatorTransform.getCoveringTilesDetailsProvider().prepareNextFrame()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(s){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this.defaultConstrain=(u,_)=>this.currentTransform.defaultConstrain(u,_),this.applyConstrain=(u,_)=>this._helper.applyConstrain(u,_),this._helper=new ts({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(u,_)=>this.defaultConstrain(u,_)},s),this._globeness=1,this._mercatorTransform=new br,this._verticalPerspectiveTransform=new Wc}clone(){const s=new Xc;return s._globeness=this._globeness,s._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,s.apply(this),s}apply(s){this._helper.apply(s),this._mercatorTransform.apply(this),this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(s){const u=this._mercatorTransform.getProjectionData(s),_=this._verticalPerspectiveTransform.getProjectionData(s);return{mainMatrix:this.isGlobeRendering?_.mainMatrix:u.mainMatrix,clippingPlane:_.clippingPlane,tileMercatorCoords:_.tileMercatorCoords,projectionTransition:s.applyGlobeMatrix?this._globeness:0,fallbackMatrix:u.fallbackMatrix}}isLocationOccluded(s){return this.currentTransform.isLocationOccluded(s)}transformLightDirection(s){return this.currentTransform.transformLightDirection(s)}getPixelScale(){return c.bo(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return c.bo(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(s,u,_){const m=this._mercatorTransform.getPitchedTextCorrection(s,u,_),v=this._verticalPerspectiveTransform.getPitchedTextCorrection(s,u,_);return c.bo(m,v,this._globeness)}projectTileCoordinates(s,u,_,m){return this.currentTransform.projectTileCoordinates(s,u,_,m)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(s){return this.currentTransform.calculateFogMatrix(s)}getVisibleUnwrappedCoordinates(s){return this.currentTransform.getVisibleUnwrappedCoordinates(s)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(s){this._mercatorTransform.recalculateZoomAndCenter(s),this._verticalPerspectiveTransform.recalculateZoomAndCenter(s)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(s,u){return this.currentTransform.lngLatToCameraDepth(s,u)}populateCache(s){this._mercatorTransform.populateCache(s),this._verticalPerspectiveTransform.populateCache(s)}getBounds(){return this.currentTransform.getBounds()}calculateCenterFromCameraLngLatAlt(s,u,_,m){return this._helper.calculateCenterFromCameraLngLatAlt(s,u,_,m)}setLocationAtPoint(s,u){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(s,u),void this.apply(this._mercatorTransform);this._verticalPerspectiveTransform.setLocationAtPoint(s,u),this.apply(this._verticalPerspectiveTransform)}locationToScreenPoint(s,u){return this.currentTransform.locationToScreenPoint(s,u)}screenPointToMercatorCoordinate(s,u){return this.currentTransform.screenPointToMercatorCoordinate(s,u)}screenPointToLocation(s,u){return this.currentTransform.screenPointToLocation(s,u)}isPointOnMapSurface(s,u){return this.currentTransform.isPointOnMapSurface(s,u)}getRayDirectionFromPixel(s){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(s)}getMatrixForModel(s,u){return this.currentTransform.getMatrixForModel(s,u)}getProjectionDataForCustomLayer(s=!0){const u=this._mercatorTransform.getProjectionDataForCustomLayer(s);if(!this.isGlobeRendering)return u;const _=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(s);return _.fallbackMatrix=u.mainMatrix,_}getFastPathSimpleProjectionMatrix(s){return this.currentTransform.getFastPathSimpleProjectionMatrix(s)}}class rs{get useGlobeControls(){return!0}handlePanInertia(s,u){const _=qs(s,u);return Math.abs(_.lng-u.center.lng)>180&&(_.lng=u.center.lng+179.5*Math.sign(_.lng-u.center.lng)),{easingCenter:_,easingOffset:new c.P(0,0)}}handleMapControlsRollPitchBearingZoom(s,u){const _=s.around,m=u.screenPointToLocation(_);s.bearingDelta&&u.setBearing(u.bearing+s.bearingDelta),s.pitchDelta&&u.setPitch(u.pitch+s.pitchDelta),s.rollDelta&&u.setRoll(u.roll+s.rollDelta);const v=u.zoom;s.zoomDelta&&u.setZoom(u.zoom+s.zoomDelta);const w=u.zoom-v;if(w===0)return;const S=c.bE(u.center.lng,m.lng),I=S/(Math.abs(S/180)+1),B=c.bE(u.center.lat,m.lat),D=u.getRayDirectionFromPixel(_),U=u.cameraPosition,k=-1*c.a$(U,D),j=c.bt();c.aW(j,U,[D[0]*k,D[1]*k,D[2]*k]);const W=c.b1(j)-1,Q=Math.exp(.5*-Math.max(W-.3,0)),et=Gc(u.worldSize,u.center.lat)/Math.min(u.width,u.height),st=c.br(et,.9,.5,1,.25),ut=(1-c.al(-w))*Math.min(Q,st),_t=u.center.lat,lt=u.zoom,gt=new c.U(u.center.lng+I*ut,c.ai(u.center.lat+B*ut,-c.aj,c.aj));u.setLocationAtPoint(m,_);const mt=u.center,dt=c.br(Math.abs(S),45,85,0,1),wt=c.br(et,.75,.35,0,1),Ft=Math.pow(Math.max(dt,wt),.25),Mt=c.bE(mt.lng,gt.lng),Rt=c.bE(mt.lat,gt.lat);u.setCenter(new c.U(mt.lng+Mt*Ft,mt.lat+Rt*Ft).wrap()),u.setZoom(lt+Kr(_t,u.center.lat))}handleMapControlsPan(s,u,_){if(!s.panDelta)return;const m=u.center.lat,v=u.zoom;u.setCenter(qs(s.panDelta,u).wrap()),u.setZoom(v+Kr(m,u.center.lat))}cameraForBoxAndBearing(s,u,_,m,v){const w=fl(s,u,_,m,v),S=u.left/v.width*2-1,I=(v.width-u.right)/v.width*2-1,B=u.top/v.height*-2+1,D=(v.height-u.bottom)/v.height*-2+1,U=c.bE(_.getWest(),_.getEast())<0,k=U?_.getEast():_.getWest(),j=U?_.getWest():_.getEast(),W=Math.max(_.getNorth(),_.getSouth()),Q=Math.min(_.getNorth(),_.getSouth()),et=k+.5*c.bE(k,j),st=W+.5*c.bE(W,Q),ut=v.clone();ut.setCenter(w.center),ut.setBearing(w.bearing),ut.setPitch(0),ut.setRoll(0),ut.setZoom(w.zoom);const _t=ut.modelViewProjectionMatrix,lt=[Ei(_.getNorthWest()),Ei(_.getNorthEast()),Ei(_.getSouthWest()),Ei(_.getSouthEast()),Ei(new c.U(j,st)),Ei(new c.U(k,st)),Ei(new c.U(et,W)),Ei(new c.U(et,Q))],gt=Ei(w.center);let mt=Number.POSITIVE_INFINITY;for(const dt of lt)S<0&&(mt=rs.getLesserNonNegativeNonNull(mt,rs.solveVectorScale(dt,gt,_t,"x",S))),I>0&&(mt=rs.getLesserNonNegativeNonNull(mt,rs.solveVectorScale(dt,gt,_t,"x",I))),B>0&&(mt=rs.getLesserNonNegativeNonNull(mt,rs.solveVectorScale(dt,gt,_t,"y",B))),D<0&&(mt=rs.getLesserNonNegativeNonNull(mt,rs.solveVectorScale(dt,gt,_t,"y",D)));if(Number.isFinite(mt)&&mt!==0)return w.zoom=ut.zoom+c.ao(mt),w;Ta()}handleJumpToCenterZoom(s,u){const _=s.center.lat,m=s.applyConstrain(u.center?c.U.convert(u.center):s.center,s.zoom).center;s.setCenter(m.wrap());const v=u.zoom!==void 0?+u.zoom:s.zoom+Kr(_,m.lat);s.zoom!==v&&s.setZoom(v)}handleEaseTo(s,u){const _=s.zoom,m=s.center,v=s.padding,w={roll:s.roll,pitch:s.pitch,bearing:s.bearing},S={roll:u.roll===void 0?s.roll:u.roll,pitch:u.pitch===void 0?s.pitch:u.pitch,bearing:u.bearing===void 0?s.bearing:u.bearing},I=u.zoom!==void 0,B=!s.isPaddingEqual(u.padding);let D=!1;const U=u.center?c.U.convert(u.center):m,k=s.applyConstrain(U,_).center;Vc(s,k);const j=s.clone();j.setCenter(k),j.setZoom(I?+u.zoom:_+Kr(m.lat,U.lat)),j.setBearing(u.bearing);const W=new c.P(c.ai(s.centerPoint.x+u.offsetAsPoint.x,0,s.width),c.ai(s.centerPoint.y+u.offsetAsPoint.y,0,s.height));j.setLocationAtPoint(k,W);const Q=(u.offset&&u.offsetAsPoint.mag())>0?j.center:k,et=I?+u.zoom:_+Kr(m.lat,Q.lat),st=_+Kr(m.lat,0),ut=et+Kr(Q.lat,0),_t=c.bE(m.lng,Q.lng),lt=c.bE(m.lat,Q.lat),gt=c.al(ut-st);return D=et!==_,{easeFunc:mt=>{if(c.bi(w,S)||fo({startEulerAngles:w,endEulerAngles:S,tr:s,k:mt,useSlerp:w.roll!=S.roll}),B&&s.interpolatePadding(v,u.padding,mt),u.around)c.w("Easing around a point is not supported under globe projection."),s.setLocationAtPoint(u.around,u.aroundPoint);else{const dt=ut>st?Math.min(2,gt):Math.max(.5,gt),wt=Math.pow(dt,1-mt),Ft=zh(m,_t,lt,mt*wt);s.setCenter(Ft.wrap())}if(D){const dt=c.F.number(st,ut,mt)+Kr(0,s.center.lat);s.setZoom(dt)}},isZooming:D,elevationCenter:Q}}handleFlyTo(s,u){const _=u.zoom!==void 0,m=s.center,v=s.zoom,w=s.padding,S=!s.isPaddingEqual(u.padding),I=s.applyConstrain(c.U.convert(u.center||u.locationAtOffset),v).center,B=_?+u.zoom:s.zoom+Kr(s.center.lat,I.lat),D=s.clone();D.setCenter(I),D.setZoom(B),D.setBearing(u.bearing);const U=new c.P(c.ai(s.centerPoint.x+u.offsetAsPoint.x,0,s.width),c.ai(s.centerPoint.y+u.offsetAsPoint.y,0,s.height));D.setLocationAtPoint(I,U);const k=D.center;Vc(s,k);const j=(function(lt,gt,mt){const dt=Ei(gt),wt=Ei(mt),Ft=c.a$(dt,wt),Mt=Math.acos(Ft),Rt=Ap(lt);return Mt/(2*Math.PI)*Rt})(s,m,k),W=v+Kr(m.lat,0),Q=B+Kr(k.lat,0),et=c.al(Q-W);let st;if(typeof u.minZoom=="number"){const lt=+u.minZoom+Kr(k.lat,0),gt=Math.min(lt,W,Q)+Kr(0,k.lat),mt=s.applyConstrain(k,gt).zoom+Kr(k.lat,0);st=c.al(mt-W)}const ut=c.bE(m.lng,k.lng),_t=c.bE(m.lat,k.lat);return{easeFunc:(lt,gt,mt,dt)=>{const wt=zh(m,ut,_t,mt);S&&s.interpolatePadding(w,u.padding,lt);const Ft=lt===1?k:wt;s.setCenter(Ft.wrap());const Mt=W+c.ao(gt);s.setZoom(lt===1?B:Mt+Kr(0,Ft.lat))},scaleOfZoom:et,targetCenter:k,scaleOfMinZoom:st,pixelPathLength:j}}static solveVectorScale(s,u,_,m,v){const w=m==="x"?[_[0],_[4],_[8],_[12]]:[_[1],_[5],_[9],_[13]],S=[_[3],_[7],_[11],_[15]],I=s[0]*w[0]+s[1]*w[1]+s[2]*w[2],B=s[0]*S[0]+s[1]*S[1]+s[2]*S[2],D=u[0]*w[0]+u[1]*w[1]+u[2]*w[2],U=u[0]*S[0]+u[1]*S[1]+u[2]*S[2];return D+v*B===I+v*U||S[3]*(I-D)+w[3]*(U-B)+I*U==D*B?null:(D+w[3]-v*U-v*S[3])/(D-I-v*U+v*B)}static getLesserNonNegativeNonNull(s,u){return u!==null&&u>=0&&u<s?u:s}}class qc{constructor(s){this._globe=s,this._mercatorCameraHelper=new es,this._verticalPerspectiveCameraHelper=new rs}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(s,u){return this.currentHelper.handlePanInertia(s,u)}handleMapControlsRollPitchBearingZoom(s,u){return this.currentHelper.handleMapControlsRollPitchBearingZoom(s,u)}handleMapControlsPan(s,u,_){this.currentHelper.handleMapControlsPan(s,u,_)}cameraForBoxAndBearing(s,u,_,m,v){return this.currentHelper.cameraForBoxAndBearing(s,u,_,m,v)}handleJumpToCenterZoom(s,u){this.currentHelper.handleJumpToCenterZoom(s,u)}handleEaseTo(s,u){return this.currentHelper.handleEaseTo(s,u)}handleFlyTo(s,u){return this.currentHelper.handleFlyTo(s,u)}}const Fo=(b,s)=>c.z(b,s&&s.filter((u=>u.identifier!=="source.canvas"))),jh=c.bI();class ml extends c.E{constructor(s,u={}){var _,m;super(),this._rtlPluginLoaded=()=>{for(const w in this.tileManagers){const S=this.tileManagers[w].getSource().type;S!=="vector"&&S!=="geojson"||this.tileManagers[w].reload()}},this.map=s,this.dispatcher=new Or(hr(),s._getMapId()),this.dispatcher.registerMessageHandler("GG",((w,S)=>this.getGlyphs(w,S))),this.dispatcher.registerMessageHandler("GI",((w,S)=>this.getImages(w,S))),this.dispatcher.registerMessageHandler("GDA",((w,S)=>this.getDashes(w,S))),this.imageManager=new Fe,this.imageManager.setEventedParent(this);const v=((_=s._container)===null||_===void 0?void 0:_.lang)||typeof document<"u"&&((m=document.documentElement)===null||m===void 0?void 0:m.lang)||void 0;this.glyphManager=new Hr(s._requestManager,u.localIdeographFontFamily,v),this.lineAtlas=new _a(256,512),this.crossTileSymbolIndex=new yr,this._setInitialValues(),this._resetUpdates(),this.dispatcher.broadcast("SR",c.bJ()),ls().on(ks,this._rtlPluginLoaded),this.on("data",(w=>{if(w.dataType!=="source"||w.sourceDataType!=="metadata")return;const S=this.tileManagers[w.sourceId];if(!S)return;const I=S.getSource();if(I&&I.vectorLayerIds)for(const B in this._layers){const D=this._layers[B];D.source===I.id&&this._validateLayer(D)}}))}_setInitialValues(){var s;this._spritesImagesIds={},this._layers={},this._order=[],this.tileManagers={},this.zoomHistory=new c.bK,this._availableImages=[],this._globalState={},this._serializedLayers={},this.stylesheet=null,this.light=null,this.sky=null,this.projection&&(this.projection.destroy(),delete this.projection),this._loaded=!1,this._changed=!1,this._updatedLayers={},this._updatedSources={},this._changedImages={},this._glyphsDidChange=!1,this._updatedPaintProps={},this._layerOrderChanged=!1,this.crossTileSymbolIndex=new(((s=this.crossTileSymbolIndex)===null||s===void 0?void 0:s.constructor)||Object),this.pauseablePlacement=void 0,this.placement=void 0,this.z=0}setGlobalStateProperty(s,u){var _,m,v;this._checkLoaded();const w=u===null?(v=(m=(_=this.stylesheet.state)===null||_===void 0?void 0:_[s])===null||m===void 0?void 0:m.default)!==null&&v!==void 0?v:null:u;if(c.bL(w,this._globalState[s]))return this;this._globalState[s]=w,this._applyGlobalStateChanges([s])}getGlobalState(){return this._globalState}setGlobalState(s){this._checkLoaded();const u=[];for(const _ in s)!c.bL(this._globalState[_],s[_].default)&&(u.push(_),this._globalState[_]=s[_].default);this._applyGlobalStateChanges(u)}_applyGlobalStateChanges(s){if(s.length===0)return;const u=new Set,_={};for(const m of s){_[m]=this._globalState[m];for(const v in this._layers){const w=this._layers[v],S=w.getLayoutAffectingGlobalStateRefs(),I=w.getPaintAffectingGlobalStateRefs();if(S.has(m)&&u.add(w.source),I.has(m))for(const{name:B,value:D}of I.get(m))this._updatePaintProperty(w,B,D)}}this.dispatcher.broadcast("UGS",_);for(const m in this.tileManagers)u.has(m)&&(this._reloadSource(m),this._changed=!0)}loadURL(s,u={},_){this.fire(new c.l("dataloading",{dataType:"style"})),u.validate=typeof u.validate!="boolean"||u.validate;const m=this.map._requestManager.transformRequest(s,"Style");this._loadStyleRequest=new AbortController;const v=this._loadStyleRequest;c.j(m,this._loadStyleRequest).then((w=>{this._loadStyleRequest=null,this._load(w.data,u,_)})).catch((w=>{this._loadStyleRequest=null,w&&!v.signal.aborted&&this.fire(new c.k(w))}))}loadJSON(s,u={},_){this.fire(new c.l("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,X.frameAsync(this._frameRequest).then((()=>{this._frameRequest=null,u.validate=u.validate!==!1,this._load(s,u,_)})).catch((()=>{}))}loadEmpty(){this.fire(new c.l("dataloading",{dataType:"style"})),this._load(jh,{validate:!1})}_load(s,u,_){var m,v;let w=u.transformStyle?u.transformStyle(_,s):s;if(!u.validate||!Fo(this,c.B(w))){w=Object.assign({},w),this._loaded=!0,this.stylesheet=w;for(const S in w.sources)this.addSource(S,w.sources[S],{validate:!1});w.sprite?this._loadSprite(w.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(w.glyphs),this._createLayers(),this.light=new vi(this.stylesheet.light),this._setProjectionInternal(((m=this.stylesheet.projection)===null||m===void 0?void 0:m.type)||"mercator"),this.sky=new li(this.stylesheet.sky),this.map.setTerrain((v=this.stylesheet.terrain)!==null&&v!==void 0?v:null),this.fire(new c.l("data",{dataType:"style"})),this.fire(new c.l("style.load"))}}_createLayers(){var s,u,_;const m=c.bM(this.stylesheet.layers);this.setGlobalState((s=this.stylesheet.state)!==null&&s!==void 0?s:null),this.dispatcher.broadcast("SL",m),this._order=m.map((v=>v.id)),this._layers={},this._serializedLayers=null;for(const v of m){const w=c.bN(v,this._globalState);if(w.setEventedParent(this,{layer:{id:v.id}}),this._layers[v.id]=w,c.bO(w)&&this.tileManagers[w.source]){const S=(_=(u=v.paint)===null||u===void 0?void 0:u["raster-fade-duration"])!==null&&_!==void 0?_:w.paint.get("raster-fade-duration");this.tileManagers[w.source].setRasterFadeDuration(S)}}}_loadSprite(s,u=!1,_=void 0){let m;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,(function(v,w,S,I){return c._(this,void 0,void 0,(function*(){const B=ie(v),D=S>1?"@2x":"",U={},k={};for(const{id:j,url:W}of B){const Q=w.transformRequest(le(W,D,".json"),"SpriteJSON");U[j]=c.j(Q,I);const et=w.transformRequest(le(W,D,".png"),"SpriteImage");k[j]=ae.getImage(et,I)}return yield Promise.all([...Object.values(U),...Object.values(k)]),(function(j,W){return c._(this,void 0,void 0,(function*(){const Q={};for(const et in j){Q[et]={};const st=X.getImageCanvasContext((yield W[et]).data),ut=(yield j[et]).data;for(const _t in ut){const{width:lt,height:gt,x:mt,y:dt,sdf:wt,pixelRatio:Ft,stretchX:Mt,stretchY:Rt,content:Ot,textFitWidth:qt,textFitHeight:Zt}=ut[_t];Q[et][_t]={data:null,pixelRatio:Ft,sdf:wt,stretchX:Mt,stretchY:Rt,content:Ot,textFitWidth:qt,textFitHeight:Zt,spriteData:{width:lt,height:gt,x:mt,y:dt,context:st}}}}return Q}))})(U,k)}))})(s,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then((v=>{if(this._spriteRequest=null,v)for(const w in v){this._spritesImagesIds[w]=[];const S=this._spritesImagesIds[w]?this._spritesImagesIds[w].filter((I=>!(I in v))):[];for(const I of S)this.imageManager.removeImage(I),this._changedImages[I]=!0;for(const I in v[w]){const B=w==="default"?I:`${w}:${I}`;this._spritesImagesIds[w].push(B),B in this.imageManager.images?this.imageManager.updateImage(B,v[w][I],!1):this.imageManager.addImage(B,v[w][I]),u&&(this._changedImages[B]=!0)}}})).catch((v=>{this._spriteRequest=null,m=v,this.fire(new c.k(m))})).finally((()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),u&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.l("data",{dataType:"style"})),_&&_(m)}))}_unloadSprite(){for(const s of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(s),this._changedImages[s]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.l("data",{dataType:"style"}))}_validateLayer(s){const u=this.tileManagers[s.source];if(!u)return;const _=s.sourceLayer;if(!_)return;const m=u.getSource();(m.type==="geojson"||m.vectorLayerIds&&m.vectorLayerIds.indexOf(_)===-1)&&this.fire(new c.k(new Error(`Source layer "${_}" does not exist on source "${m.id}" as specified by style layer "${s.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const s in this.tileManagers)if(!this.tileManagers[s].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(s,u=!1){const _=this._serializedAllLayers();if(!s||s.length===0)return Object.values(u?c.bP(_):_);const m=[];for(const v of s)if(_[v]){const w=u?c.bP(_[v]):_[v];m.push(w)}return m}_serializedAllLayers(){let s=this._serializedLayers;if(s)return s;s=this._serializedLayers={};const u=Object.keys(this._layers);for(const _ of u){const m=this._layers[_];m.type!=="custom"&&(s[_]=m.serialize())}return s}hasTransitions(){var s,u,_;if(!((s=this.light)===null||s===void 0)&&s.hasTransition()||!((u=this.sky)===null||u===void 0)&&u.hasTransition()||!((_=this.projection)===null||_===void 0)&&_.hasTransition())return!0;for(const m in this.tileManagers)if(this.tileManagers[m].hasTransition())return!0;for(const m in this._layers)if(this._layers[m].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(s){if(!this._loaded)return;const u=this._changed;if(u){const m=Object.keys(this._updatedLayers),v=Object.keys(this._removedLayers);(m.length||v.length)&&this._updateWorkerLayers(m,v);for(const w in this._updatedSources){const S=this._updatedSources[w];if(S==="reload")this._reloadSource(w);else{if(S!=="clear")throw new Error(`Invalid action ${S}`);this._clearSource(w)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const w in this._updatedPaintProps)this._layers[w].updateTransitions(s);this.light.updateTransitions(s),this.sky.updateTransitions(s),this._resetUpdates()}const _={};for(const m in this.tileManagers){const v=this.tileManagers[m];_[m]=v.used,v.used=!1}for(const m of this._order){const v=this._layers[m];v.recalculate(s,this._availableImages),!v.isHidden(s.zoom)&&v.source&&(this.tileManagers[v.source].used=!0)}for(const m in _){const v=this.tileManagers[m];!!_[m]!=!!v.used&&v.fire(new c.l("data",{sourceDataType:"visibility",dataType:"source",sourceId:m}))}this.light.recalculate(s),this.sky.recalculate(s),this.projection.recalculate(s),this.z=s.zoom,u&&this.fire(new c.l("data",{dataType:"style"}))}_updateTilesForChangedImages(){const s=Object.keys(this._changedImages);if(s.length){for(const u in this.tileManagers)this.tileManagers[u].reloadTilesForDependencies(["icons","patterns"],s);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const s in this.tileManagers)this.tileManagers[s].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(s,u){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(s,!1),removedIds:u})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(s,u={}){var _;this._checkLoaded();const m=this.serialize();if(s=u.transformStyle?u.transformStyle(m,s):s,((_=u.validate)===null||_===void 0||_)&&Fo(this,c.B(s)))return!1;(s=c.bP(s)).layers=c.bM(s.layers);const v=c.bQ(m,s),w=this._getOperationsToPerform(v);if(w.unimplemented.length>0)throw new Error(`Unimplemented: ${w.unimplemented.join(", ")}.`);if(w.operations.length===0)return!1;for(const S of w.operations)S();return this.stylesheet=s,this._serializedLayers=null,!0}_getOperationsToPerform(s){const u=[],_=[];for(const m of s)switch(m.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":u.push((()=>this.addLayer.apply(this,m.args)));break;case"removeLayer":u.push((()=>this.removeLayer.apply(this,m.args)));break;case"setPaintProperty":u.push((()=>this.setPaintProperty.apply(this,m.args)));break;case"setLayoutProperty":u.push((()=>this.setLayoutProperty.apply(this,m.args)));break;case"setFilter":u.push((()=>this.setFilter.apply(this,m.args)));break;case"addSource":u.push((()=>this.addSource.apply(this,m.args)));break;case"removeSource":u.push((()=>this.removeSource.apply(this,m.args)));break;case"setLayerZoomRange":u.push((()=>this.setLayerZoomRange.apply(this,m.args)));break;case"setLight":u.push((()=>this.setLight.apply(this,m.args)));break;case"setGeoJSONSourceData":u.push((()=>this.setGeoJSONSourceData.apply(this,m.args)));break;case"setGlyphs":u.push((()=>this.setGlyphs.apply(this,m.args)));break;case"setSprite":u.push((()=>this.setSprite.apply(this,m.args)));break;case"setTerrain":u.push((()=>this.map.setTerrain.apply(this,m.args)));break;case"setSky":u.push((()=>this.setSky.apply(this,m.args)));break;case"setProjection":this.setProjection.apply(this,m.args);break;case"setGlobalState":u.push((()=>this.setGlobalState.apply(this,m.args)));break;case"setTransition":u.push((()=>{}));break;default:_.push(m.command)}return{operations:u,unimplemented:_}}addImage(s,u){if(this.getImage(s))return this.fire(new c.k(new Error(`An image named "${s}" already exists.`)));this.imageManager.addImage(s,u),this._afterImageUpdated(s)}updateImage(s,u){this.imageManager.updateImage(s,u)}getImage(s){return this.imageManager.getImage(s)}removeImage(s){if(!this.getImage(s))return this.fire(new c.k(new Error(`An image named "${s}" does not exist.`)));this.imageManager.removeImage(s),this._afterImageUpdated(s)}_afterImageUpdated(s){this._availableImages=this.imageManager.listImages(),this._changedImages[s]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.l("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(s,u,_={}){if(this._checkLoaded(),this.tileManagers[s]!==void 0)throw new Error(`Source "${s}" already exists.`);if(!u.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(u).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(u.type)>=0&&this._validate(c.B.source,`sources.${s}`,u,null,_))return;this.map&&this.map._collectResourceTiming&&(u.collectResourceTiming=!0);const m=this.tileManagers[s]=new Pe(s,u,this.dispatcher);m.style=this,m.setEventedParent(this,(()=>({isSourceLoaded:m.loaded(),source:m.serialize(),sourceId:s}))),m.onAdd(this.map),this._changed=!0}removeSource(s){if(this._checkLoaded(),this.tileManagers[s]===void 0)throw new Error("There is no source with this ID");for(const _ in this._layers)if(this._layers[_].source===s)return this.fire(new c.k(new Error(`Source "${s}" cannot be removed while layer "${_}" is using it.`)));const u=this.tileManagers[s];delete this.tileManagers[s],delete this._updatedSources[s],u.fire(new c.l("data",{sourceDataType:"metadata",dataType:"source",sourceId:s})),u.setEventedParent(null),u.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(s,u){if(this._checkLoaded(),this.tileManagers[s]===void 0)throw new Error(`There is no source with this ID=${s}`);const _=this.tileManagers[s].getSource();if(_.type!=="geojson")throw new Error(`geojsonSource.type is ${_.type}, which is !== 'geojson`);_.setData(u),this._changed=!0}getSource(s){return this.tileManagers[s]&&this.tileManagers[s].getSource()}addLayer(s,u,_={}){this._checkLoaded();const m=s.id;if(this.getLayer(m))return void this.fire(new c.k(new Error(`Layer "${m}" already exists on this map.`)));let v;if(s.type==="custom"){if(Fo(this,c.bR(s)))return;v=c.bN(s,this._globalState)}else{if("source"in s&&typeof s.source=="object"&&(this.addSource(m,s.source),s=c.bP(s),s=c.e(s,{source:m})),this._validate(c.B.layer,`layers.${m}`,s,{arrayIndex:-1},_))return;v=c.bN(s,this._globalState),this._validateLayer(v),v.setEventedParent(this,{layer:{id:m}})}const w=u?this._order.indexOf(u):this._order.length;if(u&&w===-1)this.fire(new c.k(new Error(`Cannot add layer "${m}" before non-existing layer "${u}".`)));else{if(this._order.splice(w,0,m),this._layerOrderChanged=!0,this._layers[m]=v,this._removedLayers[m]&&v.source&&v.type!=="custom"){const S=this._removedLayers[m];delete this._removedLayers[m],S.type!==v.type?this._updatedSources[v.source]="clear":(this._updatedSources[v.source]="reload",this.tileManagers[v.source].pause())}this._updateLayer(v),v.onAdd&&v.onAdd(this.map)}}moveLayer(s,u){if(this._checkLoaded(),this._changed=!0,!this._layers[s])return void this.fire(new c.k(new Error(`The layer '${s}' does not exist in the map's style and cannot be moved.`)));if(s===u)return;const _=this._order.indexOf(s);this._order.splice(_,1);const m=u?this._order.indexOf(u):this._order.length;u&&m===-1?this.fire(new c.k(new Error(`Cannot move layer "${s}" before non-existing layer "${u}".`))):(this._order.splice(m,0,s),this._layerOrderChanged=!0)}removeLayer(s){this._checkLoaded();const u=this._layers[s];if(!u)return void this.fire(new c.k(new Error(`Cannot remove non-existing layer "${s}".`)));u.setEventedParent(null);const _=this._order.indexOf(s);this._order.splice(_,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[s]=u,delete this._layers[s],this._serializedLayers&&delete this._serializedLayers[s],delete this._updatedLayers[s],delete this._updatedPaintProps[s],u.onRemove&&u.onRemove(this.map)}getLayer(s){return this._layers[s]}getLayersOrder(){return[...this._order]}hasLayer(s){return s in this._layers}setLayerZoomRange(s,u,_){this._checkLoaded();const m=this.getLayer(s);m?m.minzoom===u&&m.maxzoom===_||(u!=null&&(m.minzoom=u),_!=null&&(m.maxzoom=_),this._updateLayer(m)):this.fire(new c.k(new Error(`Cannot set the zoom range of non-existing layer "${s}".`)))}setFilter(s,u,_={}){this._checkLoaded();const m=this.getLayer(s);if(m){if(!c.bL(m.filter,u))return u==null?(m.setFilter(void 0),void this._updateLayer(m)):void(this._validate(c.B.filter,`layers.${m.id}.filter`,u,null,_)||(m.setFilter(c.bP(u)),this._updateLayer(m)))}else this.fire(new c.k(new Error(`Cannot filter non-existing layer "${s}".`)))}getFilter(s){return c.bP(this.getLayer(s).filter)}setLayoutProperty(s,u,_,m={}){this._checkLoaded();const v=this.getLayer(s);v?c.bL(v.getLayoutProperty(u),_)||(v.setLayoutProperty(u,_,m),this._updateLayer(v)):this.fire(new c.k(new Error(`Cannot style non-existing layer "${s}".`)))}getLayoutProperty(s,u){const _=this.getLayer(s);if(_)return _.getLayoutProperty(u);this.fire(new c.k(new Error(`Cannot get style of non-existing layer "${s}".`)))}setPaintProperty(s,u,_,m={}){this._checkLoaded();const v=this.getLayer(s);v?c.bL(v.getPaintProperty(u),_)||this._updatePaintProperty(v,u,_,m):this.fire(new c.k(new Error(`Cannot style non-existing layer "${s}".`)))}_updatePaintProperty(s,u,_,m={}){s.setPaintProperty(u,_,m)&&this._updateLayer(s),c.bO(s)&&u==="raster-fade-duration"&&this.tileManagers[s.source].setRasterFadeDuration(_),this._changed=!0,this._updatedPaintProps[s.id]=!0,this._serializedLayers=null}getPaintProperty(s,u){return this.getLayer(s).getPaintProperty(u)}setFeatureState(s,u){this._checkLoaded();const _=s.source,m=s.sourceLayer,v=this.tileManagers[_];if(v===void 0)return void this.fire(new c.k(new Error(`The source '${_}' does not exist in the map's style.`)));const w=v.getSource().type;w==="geojson"&&m?this.fire(new c.k(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):w!=="vector"||m?(s.id===void 0&&this.fire(new c.k(new Error("The feature id parameter must be provided."))),v.setFeatureState(m,s.id,u)):this.fire(new c.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(s,u){this._checkLoaded();const _=s.source,m=this.tileManagers[_];if(m===void 0)return void this.fire(new c.k(new Error(`The source '${_}' does not exist in the map's style.`)));const v=m.getSource().type,w=v==="vector"?s.sourceLayer:void 0;v!=="vector"||w?u&&typeof s.id!="string"&&typeof s.id!="number"?this.fire(new c.k(new Error("A feature id is required to remove its specific state property."))):m.removeFeatureState(w,s.id,u):this.fire(new c.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(s){this._checkLoaded();const u=s.source,_=s.sourceLayer,m=this.tileManagers[u];if(m!==void 0)return m.getSource().type!=="vector"||_?(s.id===void 0&&this.fire(new c.k(new Error("The feature id parameter must be provided."))),m.getFeatureState(_,s.id)):void this.fire(new c.k(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new c.k(new Error(`The source '${u}' does not exist in the map's style.`)))}getTransition(){return c.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const s=c.bS(this.tileManagers,(v=>v.serialize())),u=this._serializeByIds(this._order,!0),_=this.map.getTerrain()||void 0,m=this.stylesheet;return c.bT({version:m.version,name:m.name,metadata:m.metadata,light:m.light,sky:m.sky,center:m.center,zoom:m.zoom,bearing:m.bearing,pitch:m.pitch,sprite:m.sprite,glyphs:m.glyphs,transition:m.transition,projection:m.projection,sources:s,layers:u,terrain:_},(v=>v!==void 0))}_updateLayer(s){this._updatedLayers[s.id]=!0,s.source&&!this._updatedSources[s.source]&&this.tileManagers[s.source].getSource().type!=="raster"&&(this._updatedSources[s.source]="reload",this.tileManagers[s.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(s){const u=w=>this._layers[w].type==="fill-extrusion",_={},m=[];for(let w=this._order.length-1;w>=0;w--){const S=this._order[w];if(u(S)){_[S]=w;for(const I of s){const B=I[S];if(B)for(const D of B)m.push(D)}}}m.sort(((w,S)=>S.intersectionZ-w.intersectionZ));const v=[];for(let w=this._order.length-1;w>=0;w--){const S=this._order[w];if(u(S))for(let I=m.length-1;I>=0;I--){const B=m[I].feature;if(_[B.layer.id]<w)break;v.push(B),m.pop()}else for(const I of s){const B=I[S];if(B)for(const D of B)v.push(D.feature)}}return v}queryRenderedFeatures(s,u,_){u&&u.filter&&this._validate(c.B.filter,"queryRenderedFeatures.filter",u.filter,null,u);const m={};if(u&&u.layers){if(!(Array.isArray(u.layers)||u.layers instanceof Set))return this.fire(new c.k(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(const B of u.layers){const D=this._layers[B];if(!D)return this.fire(new c.k(new Error(`The layer '${B}' does not exist in the map's style and cannot be queried for features.`))),[];m[D.source]=!0}}const v=[];u.availableImages=this._availableImages;const w=this._serializedAllLayers(),S=u.layers instanceof Set?u.layers:Array.isArray(u.layers)?new Set(u.layers):null,I=Object.assign(Object.assign({},u),{layers:S,globalState:this._globalState});for(const B in this.tileManagers)u.layers&&!m[B]||v.push(Fs(this.tileManagers[B],this._layers,w,s,I,_,this.map.terrain?(D,U,k)=>this.map.terrain.getElevation(D,U,k):void 0));return this.placement&&v.push((function(B,D,U,k,j,W,Q){const et={},st=W.queryRenderedSymbols(k),ut=[];for(const _t of Object.keys(st).map(Number))ut.push(Q[_t]);ut.sort(Je);for(const _t of ut){const lt=_t.featureIndex.lookupSymbolFeatures(st[_t.bucketInstanceId],D,_t.bucketIndex,_t.sourceLayerIndex,{filterSpec:j.filter,globalState:j.globalState},j.layers,j.availableImages,B);for(const gt in lt){const mt=et[gt]=et[gt]||[],dt=lt[gt];dt.sort(((wt,Ft)=>{const Mt=_t.featureSortOrder;if(Mt){const Rt=Mt.indexOf(wt.featureIndex);return Mt.indexOf(Ft.featureIndex)-Rt}return Ft.featureIndex-wt.featureIndex}));for(const wt of dt)mt.push(wt)}}return(function(_t,lt,gt){for(const mt in _t)for(const dt of _t[mt])Ti(dt,gt[lt[mt].source]);return _t})(et,B,U)})(this._layers,w,this.tileManagers,s,I,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(v)}querySourceFeatures(s,u){u?.filter&&this._validate(c.B.filter,"querySourceFeatures.filter",u.filter,null,u);const _=this.tileManagers[s];return _?(function(m,v){const w=m.getRenderableIds().map((B=>m.getTileByID(B))),S=[],I={};for(let B=0;B<w.length;B++){const D=w[B],U=D.tileID.canonical.key;I[U]||(I[U]=!0,D.querySourceFeatures(S,v))}return S})(_,u?Object.assign(Object.assign({},u),{globalState:this._globalState}):{globalState:this._globalState}):[]}getLight(){return this.light.getLight()}setLight(s,u={}){this._checkLoaded();const _=this.light.getLight();let m=!1;for(const w in s)if(!c.bL(s[w],_[w])){m=!0;break}if(!m)return;const v={now:nt(),transition:c.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(s,u),this.light.updateTransitions(v)}getProjection(){var s;return(s=this.stylesheet)===null||s===void 0?void 0:s.projection}setProjection(s){if(this._checkLoaded(),this.projection){if(this.projection.name===s.type)return;this.projection.destroy(),delete this.projection}this.stylesheet.projection=s,this._setProjectionInternal(s.type)}getSky(){var s;return(s=this.stylesheet)===null||s===void 0?void 0:s.sky}setSky(s,u={}){this._checkLoaded();const _=this.getSky();let m=!1;if(!s&&!_)return;if(s&&!_)m=!0;else if(!s&&_)m=!0;else for(const w in s)if(!c.bL(s[w],_[w])){m=!0;break}if(!m)return;const v={now:nt(),transition:c.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=s,this.sky.setSky(s,u),this.sky.updateTransitions(v)}_setProjectionInternal(s){const u=(function(_,m){const v={constrainOverride:m};if(Array.isArray(_)){const w=new Sa({type:_});return{projection:w,transform:new Xc(v),cameraHelper:new qc(w)}}switch(_){case"mercator":return{projection:new ri,transform:new br(v),cameraHelper:new es};case"globe":{const w=new Sa({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:w,transform:new Xc(v),cameraHelper:new qc(w)}}case"vertical-perspective":return{projection:new gl,transform:new Wc(v),cameraHelper:new rs};default:return c.w(`Unknown projection name: ${_}. Falling back to mercator projection.`),{projection:new ri,transform:new br(v),cameraHelper:new es}}})(s,this.map.transformConstrain);this.projection=u.projection,this.map.migrateProjection(u.transform,u.cameraHelper);for(const _ in this.tileManagers)this.tileManagers[_].reload()}_validate(s,u,_,m,v={}){return(!v||v.validate!==!1)&&Fo(this,s.call(c.B,c.e({key:u,style:this.serialize(),value:_,styleSpec:c.u},m)))}_remove(s=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),ls().off(ks,this._rtlPluginLoaded);for(const u in this._layers)this._layers[u].setEventedParent(null);for(const u in this.tileManagers){const _=this.tileManagers[u];_.setEventedParent(null),_.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),s&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(s)}_clearSource(s){this.tileManagers[s].clearTiles()}_reloadSource(s){this.tileManagers[s].resume(),this.tileManagers[s].reload()}_updateSources(s){for(const u in this.tileManagers)this.tileManagers[u].update(s,this.map.terrain)}_generateCollisionBoxes(){for(const s in this.tileManagers)this._reloadSource(s)}_updatePlacement(s,u,_,m,v=!1){let w=!1,S=!1;const I={};for(const B of this._order){const D=this._layers[B];if(D.type!=="symbol")continue;if(!I[D.source]){const k=this.tileManagers[D.source];I[D.source]=k.getRenderableIds(!0).map((j=>k.getTileByID(j))).sort(((j,W)=>W.tileID.overscaledZ-j.tileID.overscaledZ||(j.tileID.isLessThan(W.tileID)?-1:1)))}const U=this.crossTileSymbolIndex.addLayer(D,I[D.source],s.center.lng);w=w||U}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((v=v||this._layerOrderChanged||_===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(nt(),s.zoom))&&(this.pauseablePlacement=new bt(s,this.map.terrain,this._order,v,u,_,m,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,I),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(nt()),S=!0),w&&this.pauseablePlacement.placement.setStale()),S||w)for(const B of this._order){const D=this._layers[B];D.type==="symbol"&&this.placement.updateLayerOpacities(D,I[D.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(nt())}_releaseSymbolFadeTiles(){for(const s in this.tileManagers)this.tileManagers[s].releaseSymbolFadeTiles()}getImages(s,u){return c._(this,void 0,void 0,(function*(){const _=yield this.imageManager.getImages(u.icons);this._updateTilesForChangedImages();const m=this.tileManagers[u.source];return m&&m.setDependencies(u.tileID.key,u.type,u.icons),_}))}getGlyphs(s,u){return c._(this,void 0,void 0,(function*(){const _=yield this.glyphManager.getGlyphs(u.stacks),m=this.tileManagers[u.source];return m&&m.setDependencies(u.tileID.key,u.type,[""]),_}))}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(s,u={}){this._checkLoaded(),s&&this._validate(c.B.glyphs,"glyphs",s,null,u)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=s,this.glyphManager.entries={},this.glyphManager.setURL(s))}getDashes(s,u){return c._(this,void 0,void 0,(function*(){const _={};for(const[m,v]of Object.entries(u.dashes))_[m]=this.lineAtlas.getDash(v.dasharray,v.round);return _}))}addSprite(s,u,_={},m){this._checkLoaded();const v=[{id:s,url:u}],w=[...ie(this.stylesheet.sprite),...v];this._validate(c.B.sprite,"sprite",w,null,_)||(this.stylesheet.sprite=w,this._loadSprite(v,!0,m))}removeSprite(s){this._checkLoaded();const u=ie(this.stylesheet.sprite);if(u.find((_=>_.id===s))){if(this._spritesImagesIds[s])for(const _ of this._spritesImagesIds[s])this.imageManager.removeImage(_),this._changedImages[_]=!0;u.splice(u.findIndex((_=>_.id===s)),1),this.stylesheet.sprite=u.length>0?u:void 0,delete this._spritesImagesIds[s],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.l("data",{dataType:"style"}))}else this.fire(new c.k(new Error(`Sprite "${s}" doesn't exists on this map.`)))}getSprite(){return ie(this.stylesheet.sprite)}setSprite(s,u={},_){this._checkLoaded(),s&&this._validate(c.B.sprite,"sprite",s,null,u)||(this.stylesheet.sprite=s,s?this._loadSprite(s,!0,_):(this._unloadSprite(),_&&_(null)))}destroy(){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null);for(const s in this.tileManagers){const u=this.tileManagers[s];if(u.setEventedParent(null),u._tiles){for(const _ in u._tiles)u._tiles[_].unloadVectorData();u._tiles={}}u._cache.reset(),u.onRemove(this.map)}this.tileManagers={},this.imageManager&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this._availableImages=[],this._spritesImagesIds={}),this.glyphManager&&this.glyphManager.destroy();for(const s in this._layers){const u=this._layers[s];u.setEventedParent(null),u.onRemove&&u.onRemove(this.map)}this._setInitialValues(),this.setEventedParent(null),this.dispatcher.unregisterMessageHandler("GG"),this.dispatcher.unregisterMessageHandler("GI"),this.dispatcher.unregisterMessageHandler("GDA"),this.dispatcher.remove(!0),this._listeners={},this._oneTimeListeners={}}}var mn=c.aO([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Jy{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(s,u,_,m,v,w,S,I,B){this.context=s;let D=this.boundPaintVertexBuffers.length!==m.length;for(let U=0;!D&&U<m.length;U++)this.boundPaintVertexBuffers[U]!==m[U]&&(D=!0);!this.vao||this.boundProgram!==u||this.boundLayoutVertexBuffer!==_||D||this.boundIndexBuffer!==v||this.boundVertexOffset!==w||this.boundDynamicVertexBuffer!==S||this.boundDynamicVertexBuffer2!==I||this.boundDynamicVertexBuffer3!==B?this.freshBind(u,_,m,v,w,S,I,B):(s.bindVertexArray.set(this.vao),S&&S.bind(),v&&v.dynamicDraw&&v.bind(),I&&I.bind(),B&&B.bind())}freshBind(s,u,_,m,v,w,S,I){const B=s.numAttributes,D=this.context,U=D.gl;this.vao&&this.destroy(),this.vao=D.createVertexArray(),D.bindVertexArray.set(this.vao),this.boundProgram=s,this.boundLayoutVertexBuffer=u,this.boundPaintVertexBuffers=_,this.boundIndexBuffer=m,this.boundVertexOffset=v,this.boundDynamicVertexBuffer=w,this.boundDynamicVertexBuffer2=S,this.boundDynamicVertexBuffer3=I,u.enableAttributes(U,s);for(const k of _)k.enableAttributes(U,s);w&&w.enableAttributes(U,s),S&&S.enableAttributes(U,s),I&&I.enableAttributes(U,s),u.bind(),u.setVertexAttribPointers(U,s,v);for(const k of _)k.bind(),k.setVertexAttribPointers(U,s,v);w&&(w.bind(),w.setVertexAttribPointers(U,s,v)),m&&m.bind(),S&&(S.bind(),S.setVertexAttribPointers(U,s,v)),I&&(I.bind(),I.setVertexAttribPointers(U,s,v)),D.currentNumAttributes=B}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const Hh=(b,s,u,_,m)=>({u_texture:0,u_ele_delta:b,u_fog_matrix:s,u_fog_color:u?u.properties.get("fog-color"):c.bj.white,u_fog_ground_blend:u?u.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:m?0:u?u.calculateFogBlendOpacity(_):0,u_horizon_color:u?u.properties.get("horizon-color"):c.bj.white,u_horizon_fog_blend:u?u.properties.get("horizon-fog-blend"):1,u_is_globe_mode:m?1:0}),yl={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function po(b){const s=[];for(let u=0;u<b.length;u++){if(b[u]===null)continue;const _=b[u].split(" ");s.push(_.pop())}return s}class Qy{constructor(s,u,_,m,v,w,S,I,B=[]){const D=s.gl;this.program=D.createProgram();const U=po(u.staticAttributes),k=_?_.getBinderAttributes():[],j=U.concat(k),W=nr.prelude.staticUniforms?po(nr.prelude.staticUniforms):[],Q=S.staticUniforms?po(S.staticUniforms):[],et=u.staticUniforms?po(u.staticUniforms):[],st=_?_.getBinderUniforms():[],ut=W.concat(Q).concat(et).concat(st),_t=[];for(const Mt of ut)_t.indexOf(Mt)<0&&_t.push(Mt);const lt=_?_.defines():[];Xs(D)&&lt.unshift("#version 300 es"),v&&lt.push("#define OVERDRAW_INSPECTOR;"),w&&lt.push("#define TERRAIN3D;"),I&&lt.push(I),B&&lt.push(...B);let gt=lt.concat(nr.prelude.fragmentSource,S.fragmentSource,u.fragmentSource).join(`
`),mt=lt.concat(nr.prelude.vertexSource,S.vertexSource,u.vertexSource).join(`
`);Xs(D)||(gt=(function(Mt){return Mt.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D(")})(gt),mt=(function(Mt){return Mt.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")})(mt));const dt=D.createShader(D.FRAGMENT_SHADER);if(D.isContextLost())return void(this.failedToCreate=!0);if(D.shaderSource(dt,gt),D.compileShader(dt),!D.getShaderParameter(dt,D.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${D.getShaderInfoLog(dt)}`);D.attachShader(this.program,dt);const wt=D.createShader(D.VERTEX_SHADER);if(D.isContextLost())return void(this.failedToCreate=!0);if(D.shaderSource(wt,mt),D.compileShader(wt),!D.getShaderParameter(wt,D.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${D.getShaderInfoLog(wt)}`);D.attachShader(this.program,wt),this.attributes={};const Ft={};this.numAttributes=j.length;for(let Mt=0;Mt<this.numAttributes;Mt++)j[Mt]&&(D.bindAttribLocation(this.program,Mt,j[Mt]),this.attributes[j[Mt]]=Mt);if(D.linkProgram(this.program),!D.getProgramParameter(this.program,D.LINK_STATUS))throw new Error(`Program failed to link: ${D.getProgramInfoLog(this.program)}`);D.deleteShader(wt),D.deleteShader(dt);for(let Mt=0;Mt<_t.length;Mt++){const Rt=_t[Mt];if(Rt&&!Ft[Rt]){const Ot=D.getUniformLocation(this.program,Rt);Ot&&(Ft[Rt]=Ot)}}this.fixedUniforms=m(s,Ft),this.terrainUniforms=((Mt,Rt)=>({u_depth:new c.bU(Mt,Rt.u_depth),u_terrain:new c.bU(Mt,Rt.u_terrain),u_terrain_dim:new c.bk(Mt,Rt.u_terrain_dim),u_terrain_matrix:new c.bW(Mt,Rt.u_terrain_matrix),u_terrain_unpack:new c.bX(Mt,Rt.u_terrain_unpack),u_terrain_exaggeration:new c.bk(Mt,Rt.u_terrain_exaggeration)}))(s,Ft),this.projectionUniforms=((Mt,Rt)=>({u_projection_matrix:new c.bW(Mt,Rt.u_projection_matrix),u_projection_tile_mercator_coords:new c.bX(Mt,Rt.u_projection_tile_mercator_coords),u_projection_clipping_plane:new c.bX(Mt,Rt.u_projection_clipping_plane),u_projection_transition:new c.bk(Mt,Rt.u_projection_transition),u_projection_fallback_matrix:new c.bW(Mt,Rt.u_projection_fallback_matrix)}))(s,Ft),this.binderUniforms=_?_.getUniforms(s,Ft):[]}draw(s,u,_,m,v,w,S,I,B,D,U,k,j,W,Q,et,st,ut,_t){const lt=s.gl;if(this.failedToCreate)return;if(s.program.set(this.program),s.setDepthMode(_),s.setStencilMode(m),s.setColorMode(v),s.setCullFace(w),I){s.activeTexture.set(lt.TEXTURE2),lt.bindTexture(lt.TEXTURE_2D,I.depthTexture),s.activeTexture.set(lt.TEXTURE3),lt.bindTexture(lt.TEXTURE_2D,I.texture);for(const mt in this.terrainUniforms)this.terrainUniforms[mt].set(I[mt])}if(B)for(const mt in B)this.projectionUniforms[yl[mt]].set(B[mt]);if(S)for(const mt in this.fixedUniforms)this.fixedUniforms[mt].set(S[mt]);et&&et.setUniforms(s,this.binderUniforms,W,{zoom:Q});let gt=0;switch(u){case lt.LINES:gt=2;break;case lt.TRIANGLES:gt=3;break;case lt.LINE_STRIP:gt=1}for(const mt of j.get()){const dt=mt.vaos||(mt.vaos={});(dt[D]||(dt[D]=new Jy)).bind(s,this,U,et?et.getPaintVertexBuffers():[],k,mt.vertexOffset,st,ut,_t),lt.drawElements(u,mt.primitiveLength*gt,lt.UNSIGNED_SHORT,mt.primitiveOffset*gt*2)}}}function bl(b,s,u){const _=1/c.aH(u,1,s.transform.tileZoom),m=Math.pow(2,u.tileID.overscaledZ),v=u.tileSize*Math.pow(2,s.transform.tileZoom)/m,w=v*(u.tileID.canonical.x+u.tileID.wrap*m),S=v*u.tileID.canonical.y;return{u_image:0,u_texsize:u.imageAtlasTexture.size,u_scale:[_,b.fromScale,b.toScale],u_fade:b.t,u_pixel_coord_upper:[w>>16,S>>16],u_pixel_coord_lower:[65535&w,65535&S]}}const Ip=(b,s,u,_)=>{const m=b.style.light,v=m.properties.get("position"),w=[v.x,v.y,v.z],S=c.b_();m.properties.get("anchor")==="viewport"&&c.b$(S,b.transform.bearingInRadians),c.c0(w,w,S);const I=b.transform.transformLightDirection(w),B=m.properties.get("color");return{u_lightpos:w,u_lightpos_globe:I,u_lightintensity:m.properties.get("intensity"),u_lightcolor:[B.r,B.g,B.b],u_vertical_gradient:+s,u_opacity:u,u_fill_translate:_}},Ia=(b,s,u,_,m,v,w)=>c.e(Ip(b,s,u,_),bl(v,b,w),{u_height_factor:-Math.pow(2,m.overscaledZ)/w.tileSize/8}),Mp=(b,s,u,_)=>c.e(bl(s,b,u),{u_fill_translate:_}),Rp=(b,s)=>({u_world:b,u_fill_translate:s}),t0=(b,s,u,_,m)=>c.e(Mp(b,s,u,m),{u_world:_}),Pp=(b,s,u,_,m)=>{const v=b.transform;let w,S,I=0;if(u.paint.get("circle-pitch-alignment")==="map"){const B=c.aH(s,1,v.zoom);w=!0,S=[B,B],I=B/(c.a3*Math.pow(2,s.tileID.overscaledZ))*2*Math.PI*m}else w=!1,S=v.pixelsToGLUnits;return{u_camera_to_center_distance:v.cameraToCenterDistance,u_scale_with_map:+(u.paint.get("circle-pitch-scale")==="map"),u_pitch_with_map:+w,u_device_pixel_ratio:b.pixelRatio,u_extrude_scale:S,u_globe_extrude_scale:I,u_translate:_}},Gh=b=>({u_pixel_extrude_scale:[1/b.width,1/b.height]}),Bp=b=>({u_viewport_size:[b.width,b.height]}),$h=(b,s=1)=>({u_color:b,u_overlay:0,u_overlay_scale:s}),Wh=(b,s,u,_)=>{const m=c.aH(b,1,s)/(c.a3*Math.pow(2,b.tileID.overscaledZ))*2*Math.PI*_;return{u_extrude_scale:c.aH(b,1,s),u_intensity:u,u_globe_extrude_scale:m}},Xh=(b,s,u,_)=>{const m=c.M();c.c1(m,0,b.width,b.height,0,0,1);const v=b.context.gl;return{u_matrix:m,u_world:[v.drawingBufferWidth,v.drawingBufferHeight],u_image:u,u_color_ramp:_,u_opacity:s.paint.get("heatmap-opacity")}},Oo=(b,s,u)=>{const _=u.paint.get("hillshade-accent-color");let m;switch(u.paint.get("hillshade-method")){case"basic":m=4;break;case"combined":m=1;break;case"igor":m=2;break;case"multidirectional":m=3;break;default:m=0}const v=u.getIlluminationProperties();for(let w=0;w<v.directionRadians.length;w++)u.paint.get("hillshade-illumination-anchor")==="viewport"&&(v.directionRadians[w]+=b.transform.bearingInRadians);return{u_image:0,u_latrange:Fp(0,s.tileID),u_exaggeration:u.paint.get("hillshade-exaggeration"),u_altitudes:v.altitudeRadians,u_azimuths:v.directionRadians,u_accent:_,u_method:m,u_highlights:v.highlightColor,u_shadows:v.shadowColor}},Dp=(b,s)=>{const u=s.stride,_=c.M();return c.c1(_,0,c.a3,-c.a3,0,0,1),c.N(_,_,[0,-c.a3,0]),{u_matrix:_,u_image:1,u_dimension:[u,u],u_zoom:b.overscaledZ,u_unpack:s.getUnpackVector()}};function Fp(b,s){const u=Math.pow(2,s.canonical.z),_=s.canonical.y;return[new c.a5(0,_/u).toLngLat().lat,new c.a5(0,(_+1)/u).toLngLat().lat]}const vl=(b,s,u=0)=>({u_image:0,u_unpack:s.getUnpackVector(),u_dimension:[s.stride,s.stride],u_elevation_stops:1,u_color_stops:4,u_color_ramp_size:u,u_opacity:b.paint.get("color-relief-opacity")}),Zc=(b,s,u,_)=>{const m=b.transform;return{u_translation:qh(b,s,u),u_ratio:_/c.aH(s,1,m.zoom),u_device_pixel_ratio:b.pixelRatio,u_units_to_pixels:[1/m.pixelsToGLUnits[0],1/m.pixelsToGLUnits[1]]}},xl=(b,s,u,_,m)=>c.e(Zc(b,s,u,_),{u_image:0,u_image_height:m}),e0=(b,s,u,_,m)=>{const v=b.transform,w=Yc(s,v);return{u_translation:qh(b,s,u),u_texsize:s.imageAtlasTexture.size,u_ratio:_/c.aH(s,1,v.zoom),u_device_pixel_ratio:b.pixelRatio,u_image:0,u_scale:[w,m.fromScale,m.toScale],u_fade:m.t,u_units_to_pixels:[1/v.pixelsToGLUnits[0],1/v.pixelsToGLUnits[1]]}},r0=(b,s,u,_,m)=>{const v=Yc(s,b.transform);return c.e(Zc(b,s,u,_),{u_tileratio:v,u_crossfade_from:m.fromScale,u_crossfade_to:m.toScale,u_image:0,u_mix:m.t,u_lineatlas_width:b.lineAtlas.width,u_lineatlas_height:b.lineAtlas.height})},Op=(b,s,u,_,m,v)=>{const w=Yc(s,b.transform);return c.e(Zc(b,s,u,_),{u_image:0,u_image_height:v,u_tileratio:w,u_crossfade_from:m.fromScale,u_crossfade_to:m.toScale,u_image_dash:1,u_mix:m.t,u_lineatlas_width:b.lineAtlas.width,u_lineatlas_height:b.lineAtlas.height})};function Yc(b,s){return 1/c.aH(b,1,s.tileZoom)}function qh(b,s,u){return c.aI(b.transform,s,u.paint.get("line-translate"),u.paint.get("line-translate-anchor"))}const Zh=(b,s,u,_,m)=>{return{u_tl_parent:b,u_scale_parent:s,u_buffer_scale:1,u_fade_t:u.mix,u_opacity:u.opacity*_.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:_.paint.get("raster-brightness-min"),u_brightness_high:_.paint.get("raster-brightness-max"),u_saturation_factor:(w=_.paint.get("raster-saturation"),w>0?1-1/(1.001-w):-w),u_contrast_factor:(v=_.paint.get("raster-contrast"),v>0?1/(1-v):1+v),u_spin_weights:kp(_.paint.get("raster-hue-rotate")),u_coords_top:[m[0].x,m[0].y,m[1].x,m[1].y],u_coords_bottom:[m[3].x,m[3].y,m[2].x,m[2].y]};var v,w};function kp(b){b*=Math.PI/180;const s=Math.sin(b),u=Math.cos(b);return[(2*u+1)/3,(-Math.sqrt(3)*s-u+1)/3,(Math.sqrt(3)*s-u+1)/3]}const wl=(b,s,u,_,m,v,w,S,I,B,D,U,k)=>{const j=w.transform;return{u_is_size_zoom_constant:+(b==="constant"||b==="source"),u_is_size_feature_constant:+(b==="constant"||b==="camera"),u_size_t:s?s.uSizeT:0,u_size:s?s.uSize:0,u_camera_to_center_distance:j.cameraToCenterDistance,u_pitch:j.pitch/360*2*Math.PI,u_rotate_symbol:+u,u_aspect_ratio:j.width/j.height,u_fade_change:w.options.fadeDuration?w.symbolFadeChange:1,u_label_plane_matrix:S,u_coord_matrix:I,u_is_text:+D,u_pitch_with_map:+_,u_is_along_line:m,u_is_variable_anchor:v,u_texsize:U,u_texture:0,u_translation:B,u_pitched_scale:k}},yn=(b,s,u,_,m,v,w,S,I,B,D,U,k,j)=>{const W=w.transform;return c.e(wl(b,s,u,_,m,v,w,S,I,B,D,U,j),{u_gamma_scale:_?Math.cos(W.pitch*Math.PI/180)*W.cameraToCenterDistance:1,u_device_pixel_ratio:w.pixelRatio,u_is_halo:1})},Yh=(b,s,u,_,m,v,w,S,I,B,D,U,k)=>c.e(yn(b,s,u,_,m,v,w,S,I,B,!0,D,0,k),{u_texsize_icon:U,u_texture_icon:1}),Kh=(b,s)=>({u_opacity:b,u_color:s}),Jh=(b,s,u,_,m)=>c.e((function(v,w,S,I){const B=S.imageManager.getPattern(v.from.toString()),D=S.imageManager.getPattern(v.to.toString()),{width:U,height:k}=S.imageManager.getPixelSize(),j=Math.pow(2,I.tileID.overscaledZ),W=I.tileSize*Math.pow(2,S.transform.tileZoom)/j,Q=W*(I.tileID.canonical.x+I.tileID.wrap*j),et=W*I.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:B.tl,u_pattern_br_a:B.br,u_pattern_tl_b:D.tl,u_pattern_br_b:D.br,u_texsize:[U,k],u_mix:w.t,u_pattern_size_a:B.displaySize,u_pattern_size_b:D.displaySize,u_scale_a:w.fromScale,u_scale_b:w.toScale,u_tile_units_to_pixels:1/c.aH(I,1,S.transform.tileZoom),u_pixel_coord_upper:[Q>>16,et>>16],u_pixel_coord_lower:[65535&Q,65535&et]}})(u,m,s,_),{u_opacity:b}),Qh=(b,s)=>{},td={fillExtrusion:(b,s)=>({u_lightpos:new c.bY(b,s.u_lightpos),u_lightpos_globe:new c.bY(b,s.u_lightpos_globe),u_lightintensity:new c.bk(b,s.u_lightintensity),u_lightcolor:new c.bY(b,s.u_lightcolor),u_vertical_gradient:new c.bk(b,s.u_vertical_gradient),u_opacity:new c.bk(b,s.u_opacity),u_fill_translate:new c.bZ(b,s.u_fill_translate)}),fillExtrusionPattern:(b,s)=>({u_lightpos:new c.bY(b,s.u_lightpos),u_lightpos_globe:new c.bY(b,s.u_lightpos_globe),u_lightintensity:new c.bk(b,s.u_lightintensity),u_lightcolor:new c.bY(b,s.u_lightcolor),u_vertical_gradient:new c.bk(b,s.u_vertical_gradient),u_height_factor:new c.bk(b,s.u_height_factor),u_opacity:new c.bk(b,s.u_opacity),u_fill_translate:new c.bZ(b,s.u_fill_translate),u_image:new c.bU(b,s.u_image),u_texsize:new c.bZ(b,s.u_texsize),u_pixel_coord_upper:new c.bZ(b,s.u_pixel_coord_upper),u_pixel_coord_lower:new c.bZ(b,s.u_pixel_coord_lower),u_scale:new c.bY(b,s.u_scale),u_fade:new c.bk(b,s.u_fade)}),fill:(b,s)=>({u_fill_translate:new c.bZ(b,s.u_fill_translate)}),fillPattern:(b,s)=>({u_image:new c.bU(b,s.u_image),u_texsize:new c.bZ(b,s.u_texsize),u_pixel_coord_upper:new c.bZ(b,s.u_pixel_coord_upper),u_pixel_coord_lower:new c.bZ(b,s.u_pixel_coord_lower),u_scale:new c.bY(b,s.u_scale),u_fade:new c.bk(b,s.u_fade),u_fill_translate:new c.bZ(b,s.u_fill_translate)}),fillOutline:(b,s)=>({u_world:new c.bZ(b,s.u_world),u_fill_translate:new c.bZ(b,s.u_fill_translate)}),fillOutlinePattern:(b,s)=>({u_world:new c.bZ(b,s.u_world),u_image:new c.bU(b,s.u_image),u_texsize:new c.bZ(b,s.u_texsize),u_pixel_coord_upper:new c.bZ(b,s.u_pixel_coord_upper),u_pixel_coord_lower:new c.bZ(b,s.u_pixel_coord_lower),u_scale:new c.bY(b,s.u_scale),u_fade:new c.bk(b,s.u_fade),u_fill_translate:new c.bZ(b,s.u_fill_translate)}),circle:(b,s)=>({u_camera_to_center_distance:new c.bk(b,s.u_camera_to_center_distance),u_scale_with_map:new c.bU(b,s.u_scale_with_map),u_pitch_with_map:new c.bU(b,s.u_pitch_with_map),u_extrude_scale:new c.bZ(b,s.u_extrude_scale),u_device_pixel_ratio:new c.bk(b,s.u_device_pixel_ratio),u_globe_extrude_scale:new c.bk(b,s.u_globe_extrude_scale),u_translate:new c.bZ(b,s.u_translate)}),collisionBox:(b,s)=>({u_pixel_extrude_scale:new c.bZ(b,s.u_pixel_extrude_scale)}),collisionCircle:(b,s)=>({u_viewport_size:new c.bZ(b,s.u_viewport_size)}),debug:(b,s)=>({u_color:new c.bV(b,s.u_color),u_overlay:new c.bU(b,s.u_overlay),u_overlay_scale:new c.bk(b,s.u_overlay_scale)}),depth:Qh,clippingMask:Qh,heatmap:(b,s)=>({u_extrude_scale:new c.bk(b,s.u_extrude_scale),u_intensity:new c.bk(b,s.u_intensity),u_globe_extrude_scale:new c.bk(b,s.u_globe_extrude_scale)}),heatmapTexture:(b,s)=>({u_matrix:new c.bW(b,s.u_matrix),u_world:new c.bZ(b,s.u_world),u_image:new c.bU(b,s.u_image),u_color_ramp:new c.bU(b,s.u_color_ramp),u_opacity:new c.bk(b,s.u_opacity)}),hillshade:(b,s)=>({u_image:new c.bU(b,s.u_image),u_latrange:new c.bZ(b,s.u_latrange),u_exaggeration:new c.bk(b,s.u_exaggeration),u_altitudes:new c.c3(b,s.u_altitudes),u_azimuths:new c.c3(b,s.u_azimuths),u_accent:new c.bV(b,s.u_accent),u_method:new c.bU(b,s.u_method),u_shadows:new c.c2(b,s.u_shadows),u_highlights:new c.c2(b,s.u_highlights)}),hillshadePrepare:(b,s)=>({u_matrix:new c.bW(b,s.u_matrix),u_image:new c.bU(b,s.u_image),u_dimension:new c.bZ(b,s.u_dimension),u_zoom:new c.bk(b,s.u_zoom),u_unpack:new c.bX(b,s.u_unpack)}),colorRelief:(b,s)=>({u_image:new c.bU(b,s.u_image),u_unpack:new c.bX(b,s.u_unpack),u_dimension:new c.bZ(b,s.u_dimension),u_elevation_stops:new c.bU(b,s.u_elevation_stops),u_color_stops:new c.bU(b,s.u_color_stops),u_color_ramp_size:new c.bU(b,s.u_color_ramp_size),u_opacity:new c.bk(b,s.u_opacity)}),line:(b,s)=>({u_translation:new c.bZ(b,s.u_translation),u_ratio:new c.bk(b,s.u_ratio),u_device_pixel_ratio:new c.bk(b,s.u_device_pixel_ratio),u_units_to_pixels:new c.bZ(b,s.u_units_to_pixels)}),lineGradient:(b,s)=>({u_translation:new c.bZ(b,s.u_translation),u_ratio:new c.bk(b,s.u_ratio),u_device_pixel_ratio:new c.bk(b,s.u_device_pixel_ratio),u_units_to_pixels:new c.bZ(b,s.u_units_to_pixels),u_image:new c.bU(b,s.u_image),u_image_height:new c.bk(b,s.u_image_height)}),linePattern:(b,s)=>({u_translation:new c.bZ(b,s.u_translation),u_texsize:new c.bZ(b,s.u_texsize),u_ratio:new c.bk(b,s.u_ratio),u_device_pixel_ratio:new c.bk(b,s.u_device_pixel_ratio),u_image:new c.bU(b,s.u_image),u_units_to_pixels:new c.bZ(b,s.u_units_to_pixels),u_scale:new c.bY(b,s.u_scale),u_fade:new c.bk(b,s.u_fade)}),lineSDF:(b,s)=>({u_translation:new c.bZ(b,s.u_translation),u_ratio:new c.bk(b,s.u_ratio),u_device_pixel_ratio:new c.bk(b,s.u_device_pixel_ratio),u_units_to_pixels:new c.bZ(b,s.u_units_to_pixels),u_image:new c.bU(b,s.u_image),u_mix:new c.bk(b,s.u_mix),u_tileratio:new c.bk(b,s.u_tileratio),u_crossfade_from:new c.bk(b,s.u_crossfade_from),u_crossfade_to:new c.bk(b,s.u_crossfade_to),u_lineatlas_width:new c.bk(b,s.u_lineatlas_width),u_lineatlas_height:new c.bk(b,s.u_lineatlas_height)}),lineGradientSDF:(b,s)=>({u_translation:new c.bZ(b,s.u_translation),u_ratio:new c.bk(b,s.u_ratio),u_device_pixel_ratio:new c.bk(b,s.u_device_pixel_ratio),u_units_to_pixels:new c.bZ(b,s.u_units_to_pixels),u_image:new c.bU(b,s.u_image),u_image_height:new c.bk(b,s.u_image_height),u_tileratio:new c.bk(b,s.u_tileratio),u_crossfade_from:new c.bk(b,s.u_crossfade_from),u_crossfade_to:new c.bk(b,s.u_crossfade_to),u_image_dash:new c.bU(b,s.u_image_dash),u_mix:new c.bk(b,s.u_mix),u_lineatlas_width:new c.bk(b,s.u_lineatlas_width),u_lineatlas_height:new c.bk(b,s.u_lineatlas_height)}),raster:(b,s)=>({u_tl_parent:new c.bZ(b,s.u_tl_parent),u_scale_parent:new c.bk(b,s.u_scale_parent),u_buffer_scale:new c.bk(b,s.u_buffer_scale),u_fade_t:new c.bk(b,s.u_fade_t),u_opacity:new c.bk(b,s.u_opacity),u_image0:new c.bU(b,s.u_image0),u_image1:new c.bU(b,s.u_image1),u_brightness_low:new c.bk(b,s.u_brightness_low),u_brightness_high:new c.bk(b,s.u_brightness_high),u_saturation_factor:new c.bk(b,s.u_saturation_factor),u_contrast_factor:new c.bk(b,s.u_contrast_factor),u_spin_weights:new c.bY(b,s.u_spin_weights),u_coords_top:new c.bX(b,s.u_coords_top),u_coords_bottom:new c.bX(b,s.u_coords_bottom)}),symbolIcon:(b,s)=>({u_is_size_zoom_constant:new c.bU(b,s.u_is_size_zoom_constant),u_is_size_feature_constant:new c.bU(b,s.u_is_size_feature_constant),u_size_t:new c.bk(b,s.u_size_t),u_size:new c.bk(b,s.u_size),u_camera_to_center_distance:new c.bk(b,s.u_camera_to_center_distance),u_pitch:new c.bk(b,s.u_pitch),u_rotate_symbol:new c.bU(b,s.u_rotate_symbol),u_aspect_ratio:new c.bk(b,s.u_aspect_ratio),u_fade_change:new c.bk(b,s.u_fade_change),u_label_plane_matrix:new c.bW(b,s.u_label_plane_matrix),u_coord_matrix:new c.bW(b,s.u_coord_matrix),u_is_text:new c.bU(b,s.u_is_text),u_pitch_with_map:new c.bU(b,s.u_pitch_with_map),u_is_along_line:new c.bU(b,s.u_is_along_line),u_is_variable_anchor:new c.bU(b,s.u_is_variable_anchor),u_texsize:new c.bZ(b,s.u_texsize),u_texture:new c.bU(b,s.u_texture),u_translation:new c.bZ(b,s.u_translation),u_pitched_scale:new c.bk(b,s.u_pitched_scale)}),symbolSDF:(b,s)=>({u_is_size_zoom_constant:new c.bU(b,s.u_is_size_zoom_constant),u_is_size_feature_constant:new c.bU(b,s.u_is_size_feature_constant),u_size_t:new c.bk(b,s.u_size_t),u_size:new c.bk(b,s.u_size),u_camera_to_center_distance:new c.bk(b,s.u_camera_to_center_distance),u_pitch:new c.bk(b,s.u_pitch),u_rotate_symbol:new c.bU(b,s.u_rotate_symbol),u_aspect_ratio:new c.bk(b,s.u_aspect_ratio),u_fade_change:new c.bk(b,s.u_fade_change),u_label_plane_matrix:new c.bW(b,s.u_label_plane_matrix),u_coord_matrix:new c.bW(b,s.u_coord_matrix),u_is_text:new c.bU(b,s.u_is_text),u_pitch_with_map:new c.bU(b,s.u_pitch_with_map),u_is_along_line:new c.bU(b,s.u_is_along_line),u_is_variable_anchor:new c.bU(b,s.u_is_variable_anchor),u_texsize:new c.bZ(b,s.u_texsize),u_texture:new c.bU(b,s.u_texture),u_gamma_scale:new c.bk(b,s.u_gamma_scale),u_device_pixel_ratio:new c.bk(b,s.u_device_pixel_ratio),u_is_halo:new c.bU(b,s.u_is_halo),u_translation:new c.bZ(b,s.u_translation),u_pitched_scale:new c.bk(b,s.u_pitched_scale)}),symbolTextAndIcon:(b,s)=>({u_is_size_zoom_constant:new c.bU(b,s.u_is_size_zoom_constant),u_is_size_feature_constant:new c.bU(b,s.u_is_size_feature_constant),u_size_t:new c.bk(b,s.u_size_t),u_size:new c.bk(b,s.u_size),u_camera_to_center_distance:new c.bk(b,s.u_camera_to_center_distance),u_pitch:new c.bk(b,s.u_pitch),u_rotate_symbol:new c.bU(b,s.u_rotate_symbol),u_aspect_ratio:new c.bk(b,s.u_aspect_ratio),u_fade_change:new c.bk(b,s.u_fade_change),u_label_plane_matrix:new c.bW(b,s.u_label_plane_matrix),u_coord_matrix:new c.bW(b,s.u_coord_matrix),u_is_text:new c.bU(b,s.u_is_text),u_pitch_with_map:new c.bU(b,s.u_pitch_with_map),u_is_along_line:new c.bU(b,s.u_is_along_line),u_is_variable_anchor:new c.bU(b,s.u_is_variable_anchor),u_texsize:new c.bZ(b,s.u_texsize),u_texsize_icon:new c.bZ(b,s.u_texsize_icon),u_texture:new c.bU(b,s.u_texture),u_texture_icon:new c.bU(b,s.u_texture_icon),u_gamma_scale:new c.bk(b,s.u_gamma_scale),u_device_pixel_ratio:new c.bk(b,s.u_device_pixel_ratio),u_is_halo:new c.bU(b,s.u_is_halo),u_translation:new c.bZ(b,s.u_translation),u_pitched_scale:new c.bk(b,s.u_pitched_scale)}),background:(b,s)=>({u_opacity:new c.bk(b,s.u_opacity),u_color:new c.bV(b,s.u_color)}),backgroundPattern:(b,s)=>({u_opacity:new c.bk(b,s.u_opacity),u_image:new c.bU(b,s.u_image),u_pattern_tl_a:new c.bZ(b,s.u_pattern_tl_a),u_pattern_br_a:new c.bZ(b,s.u_pattern_br_a),u_pattern_tl_b:new c.bZ(b,s.u_pattern_tl_b),u_pattern_br_b:new c.bZ(b,s.u_pattern_br_b),u_texsize:new c.bZ(b,s.u_texsize),u_mix:new c.bk(b,s.u_mix),u_pattern_size_a:new c.bZ(b,s.u_pattern_size_a),u_pattern_size_b:new c.bZ(b,s.u_pattern_size_b),u_scale_a:new c.bk(b,s.u_scale_a),u_scale_b:new c.bk(b,s.u_scale_b),u_pixel_coord_upper:new c.bZ(b,s.u_pixel_coord_upper),u_pixel_coord_lower:new c.bZ(b,s.u_pixel_coord_lower),u_tile_units_to_pixels:new c.bk(b,s.u_tile_units_to_pixels)}),terrain:(b,s)=>({u_texture:new c.bU(b,s.u_texture),u_ele_delta:new c.bk(b,s.u_ele_delta),u_fog_matrix:new c.bW(b,s.u_fog_matrix),u_fog_color:new c.bV(b,s.u_fog_color),u_fog_ground_blend:new c.bk(b,s.u_fog_ground_blend),u_fog_ground_blend_opacity:new c.bk(b,s.u_fog_ground_blend_opacity),u_horizon_color:new c.bV(b,s.u_horizon_color),u_horizon_fog_blend:new c.bk(b,s.u_horizon_fog_blend),u_is_globe_mode:new c.bk(b,s.u_is_globe_mode)}),terrainDepth:(b,s)=>({u_ele_delta:new c.bk(b,s.u_ele_delta)}),terrainCoords:(b,s)=>({u_texture:new c.bU(b,s.u_texture),u_terrain_coords_id:new c.bk(b,s.u_terrain_coords_id),u_ele_delta:new c.bk(b,s.u_ele_delta)}),projectionErrorMeasurement:(b,s)=>({u_input:new c.bk(b,s.u_input),u_output_expected:new c.bk(b,s.u_output_expected)}),atmosphere:(b,s)=>({u_sun_pos:new c.bY(b,s.u_sun_pos),u_atmosphere_blend:new c.bk(b,s.u_atmosphere_blend),u_globe_position:new c.bY(b,s.u_globe_position),u_globe_radius:new c.bk(b,s.u_globe_radius),u_inv_proj_matrix:new c.bW(b,s.u_inv_proj_matrix)}),sky:(b,s)=>({u_sky_color:new c.bV(b,s.u_sky_color),u_horizon_color:new c.bV(b,s.u_horizon_color),u_horizon:new c.bZ(b,s.u_horizon),u_horizon_normal:new c.bZ(b,s.u_horizon_normal),u_sky_horizon_blend:new c.bk(b,s.u_sky_horizon_blend),u_sky_blend:new c.bk(b,s.u_sky_blend)})};class ko{constructor(s,u,_){this.context=s;const m=s.gl;this.buffer=m.createBuffer(),this.dynamicDraw=!!_,this.context.unbindVAO(),s.bindElementBuffer.set(this.buffer),m.bufferData(m.ELEMENT_ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?m.DYNAMIC_DRAW:m.STATIC_DRAW),this.dynamicDraw||delete u.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(s){const u=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),u.bufferSubData(u.ELEMENT_ARRAY_BUFFER,0,s.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const ed={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class i0{constructor(s,u,_,m){this.length=u.length,this.attributes=_,this.itemSize=u.bytesPerElement,this.dynamicDraw=m,this.context=s;const v=s.gl;this.buffer=v.createBuffer(),s.bindVertexBuffer.set(this.buffer),v.bufferData(v.ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?v.DYNAMIC_DRAW:v.STATIC_DRAW),this.dynamicDraw||delete u.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(s){if(s.length!==this.length)throw new Error(`Length of new data is ${s.length}, which doesn't match current length of ${this.length}`);const u=this.context.gl;this.bind(),u.bufferSubData(u.ARRAY_BUFFER,0,s.arrayBuffer)}enableAttributes(s,u){for(let _=0;_<this.attributes.length;_++){const m=u.attributes[this.attributes[_].name];m!==void 0&&s.enableVertexAttribArray(m)}}setVertexAttribPointers(s,u,_){for(let m=0;m<this.attributes.length;m++){const v=this.attributes[m],w=u.attributes[v.name];w!==void 0&&s.vertexAttribPointer(w,v.components,s[ed[v.type]],!1,this.itemSize,v.offset+this.itemSize*(_||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Xe{constructor(s){this.gl=s.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(s){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class s0 extends Xe{getDefault(){return c.bj.transparent}set(s){const u=this.current;(s.r!==u.r||s.g!==u.g||s.b!==u.b||s.a!==u.a||this.dirty)&&(this.gl.clearColor(s.r,s.g,s.b,s.a),this.current=s,this.dirty=!1)}}class n0 extends Xe{getDefault(){return 1}set(s){(s!==this.current||this.dirty)&&(this.gl.clearDepth(s),this.current=s,this.dirty=!1)}}class Np extends Xe{getDefault(){return 0}set(s){(s!==this.current||this.dirty)&&(this.gl.clearStencil(s),this.current=s,this.dirty=!1)}}class o0 extends Xe{getDefault(){return[!0,!0,!0,!0]}set(s){const u=this.current;(s[0]!==u[0]||s[1]!==u[1]||s[2]!==u[2]||s[3]!==u[3]||this.dirty)&&(this.gl.colorMask(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class Lp extends Xe{getDefault(){return!0}set(s){(s!==this.current||this.dirty)&&(this.gl.depthMask(s),this.current=s,this.dirty=!1)}}class Kc extends Xe{getDefault(){return 255}set(s){(s!==this.current||this.dirty)&&(this.gl.stencilMask(s),this.current=s,this.dirty=!1)}}class Jc extends Xe{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(s){const u=this.current;(s.func!==u.func||s.ref!==u.ref||s.mask!==u.mask||this.dirty)&&(this.gl.stencilFunc(s.func,s.ref,s.mask),this.current=s,this.dirty=!1)}}class Qc extends Xe{getDefault(){const s=this.gl;return[s.KEEP,s.KEEP,s.KEEP]}set(s){const u=this.current;(s[0]!==u[0]||s[1]!==u[1]||s[2]!==u[2]||this.dirty)&&(this.gl.stencilOp(s[0],s[1],s[2]),this.current=s,this.dirty=!1)}}class rd extends Xe{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const u=this.gl;s?u.enable(u.STENCIL_TEST):u.disable(u.STENCIL_TEST),this.current=s,this.dirty=!1}}class No extends Xe{getDefault(){return[0,1]}set(s){const u=this.current;(s[0]!==u[0]||s[1]!==u[1]||this.dirty)&&(this.gl.depthRange(s[0],s[1]),this.current=s,this.dirty=!1)}}class Tl extends Xe{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const u=this.gl;s?u.enable(u.DEPTH_TEST):u.disable(u.DEPTH_TEST),this.current=s,this.dirty=!1}}class Ma extends Xe{getDefault(){return this.gl.LESS}set(s){(s!==this.current||this.dirty)&&(this.gl.depthFunc(s),this.current=s,this.dirty=!1)}}class Ts extends Xe{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const u=this.gl;s?u.enable(u.BLEND):u.disable(u.BLEND),this.current=s,this.dirty=!1}}class Up extends Xe{getDefault(){const s=this.gl;return[s.ONE,s.ZERO]}set(s){const u=this.current;(s[0]!==u[0]||s[1]!==u[1]||this.dirty)&&(this.gl.blendFunc(s[0],s[1]),this.current=s,this.dirty=!1)}}class zp extends Xe{getDefault(){return c.bj.transparent}set(s){const u=this.current;(s.r!==u.r||s.g!==u.g||s.b!==u.b||s.a!==u.a||this.dirty)&&(this.gl.blendColor(s.r,s.g,s.b,s.a),this.current=s,this.dirty=!1)}}class id extends Xe{getDefault(){return this.gl.FUNC_ADD}set(s){(s!==this.current||this.dirty)&&(this.gl.blendEquation(s),this.current=s,this.dirty=!1)}}class Lo extends Xe{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const u=this.gl;s?u.enable(u.CULL_FACE):u.disable(u.CULL_FACE),this.current=s,this.dirty=!1}}class tu extends Xe{getDefault(){return this.gl.BACK}set(s){(s!==this.current||this.dirty)&&(this.gl.cullFace(s),this.current=s,this.dirty=!1)}}class eu extends Xe{getDefault(){return this.gl.CCW}set(s){(s!==this.current||this.dirty)&&(this.gl.frontFace(s),this.current=s,this.dirty=!1)}}class Al extends Xe{getDefault(){return null}set(s){(s!==this.current||this.dirty)&&(this.gl.useProgram(s),this.current=s,this.dirty=!1)}}class ru extends Xe{getDefault(){return this.gl.TEXTURE0}set(s){(s!==this.current||this.dirty)&&(this.gl.activeTexture(s),this.current=s,this.dirty=!1)}}class Vp extends Xe{getDefault(){const s=this.gl;return[0,0,s.drawingBufferWidth,s.drawingBufferHeight]}set(s){const u=this.current;(s[0]!==u[0]||s[1]!==u[1]||s[2]!==u[2]||s[3]!==u[3]||this.dirty)&&(this.gl.viewport(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class Ra extends Xe{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const u=this.gl;u.bindFramebuffer(u.FRAMEBUFFER,s),this.current=s,this.dirty=!1}}class Pa extends Xe{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const u=this.gl;u.bindRenderbuffer(u.RENDERBUFFER,s),this.current=s,this.dirty=!1}}class jp extends Xe{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const u=this.gl;u.bindTexture(u.TEXTURE_2D,s),this.current=s,this.dirty=!1}}class sd extends Xe{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const u=this.gl;u.bindBuffer(u.ARRAY_BUFFER,s),this.current=s,this.dirty=!1}}class Oe extends Xe{getDefault(){return null}set(s){const u=this.gl;u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,s),this.current=s,this.dirty=!1}}class iu extends Xe{getDefault(){return null}set(s){var u;if(s===this.current&&!this.dirty)return;const _=this.gl;Xs(_)?_.bindVertexArray(s):(u=_.getExtension("OES_vertex_array_object"))===null||u===void 0||u.bindVertexArrayOES(s),this.current=s,this.dirty=!1}}class a0 extends Xe{getDefault(){return 4}set(s){if(s===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_ALIGNMENT,s),this.current=s,this.dirty=!1}}class Hp extends Xe{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s),this.current=s,this.dirty=!1}}class El extends Xe{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_FLIP_Y_WEBGL,s),this.current=s,this.dirty=!1}}class nd extends Xe{constructor(s,u){super(s),this.context=s,this.parent=u}getDefault(){return null}}class l0 extends nd{setDirty(){this.dirty=!0}set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const u=this.gl;u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,s,0),this.current=s,this.dirty=!1}}class Gp extends nd{set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const u=this.gl;u.framebufferRenderbuffer(u.FRAMEBUFFER,u.DEPTH_ATTACHMENT,u.RENDERBUFFER,s),this.current=s,this.dirty=!1}}class c0 extends nd{set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const u=this.gl;u.framebufferRenderbuffer(u.FRAMEBUFFER,u.DEPTH_STENCIL_ATTACHMENT,u.RENDERBUFFER,s),this.current=s,this.dirty=!1}}const su="Framebuffer is not complete";class nu{constructor(s,u,_,m,v){this.context=s,this.width=u,this.height=_;const w=s.gl,S=this.framebuffer=w.createFramebuffer();if(this.colorAttachment=new l0(s,S),m)this.depthAttachment=v?new c0(s,S):new Gp(s,S);else if(v)throw new Error("Stencil cannot be set without depth");if(w.checkFramebufferStatus(w.FRAMEBUFFER)!==w.FRAMEBUFFER_COMPLETE)throw new Error(su)}destroy(){const s=this.context.gl,u=this.colorAttachment.get();if(u&&s.deleteTexture(u),this.depthAttachment){const _=this.depthAttachment.get();_&&s.deleteRenderbuffer(_)}s.deleteFramebuffer(this.framebuffer)}}class ou{constructor(s){var u,_;if(this.gl=s,this.clearColor=new s0(this),this.clearDepth=new n0(this),this.clearStencil=new Np(this),this.colorMask=new o0(this),this.depthMask=new Lp(this),this.stencilMask=new Kc(this),this.stencilFunc=new Jc(this),this.stencilOp=new Qc(this),this.stencilTest=new rd(this),this.depthRange=new No(this),this.depthTest=new Tl(this),this.depthFunc=new Ma(this),this.blend=new Ts(this),this.blendFunc=new Up(this),this.blendColor=new zp(this),this.blendEquation=new id(this),this.cullFace=new Lo(this),this.cullFaceSide=new tu(this),this.frontFace=new eu(this),this.program=new Al(this),this.activeTexture=new ru(this),this.viewport=new Vp(this),this.bindFramebuffer=new Ra(this),this.bindRenderbuffer=new Pa(this),this.bindTexture=new jp(this),this.bindVertexBuffer=new sd(this),this.bindElementBuffer=new Oe(this),this.bindVertexArray=new iu(this),this.pixelStoreUnpack=new a0(this),this.pixelStoreUnpackPremultiplyAlpha=new Hp(this),this.pixelStoreUnpackFlipY=new El(this),this.extTextureFilterAnisotropic=s.getExtension("EXT_texture_filter_anisotropic")||s.getExtension("MOZ_EXT_texture_filter_anisotropic")||s.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=s.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=s.getParameter(s.MAX_TEXTURE_SIZE),Xs(s)){this.HALF_FLOAT=s.HALF_FLOAT;const m=s.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(u=s.RGBA16F)!==null&&u!==void 0?u:m?.RGBA16F_EXT,this.RGB16F=(_=s.RGB16F)!==null&&_!==void 0?_:m?.RGB16F_EXT,s.getExtension("EXT_color_buffer_float")}else{s.getExtension("EXT_color_buffer_half_float"),s.getExtension("OES_texture_half_float_linear");const m=s.getExtension("OES_texture_half_float");this.HALF_FLOAT=m?.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(s,u){return new ko(this,s,u)}createVertexBuffer(s,u,_){return new i0(this,s,u,_)}createRenderbuffer(s,u,_){const m=this.gl,v=m.createRenderbuffer();return this.bindRenderbuffer.set(v),m.renderbufferStorage(m.RENDERBUFFER,s,u,_),this.bindRenderbuffer.set(null),v}createFramebuffer(s,u,_,m){return new nu(this,s,u,_,m)}clear({color:s,depth:u,stencil:_}){const m=this.gl;let v=0;s&&(v|=m.COLOR_BUFFER_BIT,this.clearColor.set(s),this.colorMask.set([!0,!0,!0,!0])),u!==void 0&&(v|=m.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(u),this.depthMask.set(!0)),_!==void 0&&(v|=m.STENCIL_BUFFER_BIT,this.clearStencil.set(_),this.stencilMask.set(255)),m.clear(v)}setCullFace(s){s.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(s.mode),this.frontFace.set(s.frontFace))}setDepthMode(s){s.func!==this.gl.ALWAYS||s.mask?(this.depthTest.set(!0),this.depthFunc.set(s.func),this.depthMask.set(s.mask),this.depthRange.set(s.range)):this.depthTest.set(!1)}setStencilMode(s){s.test.func!==this.gl.ALWAYS||s.mask?(this.stencilTest.set(!0),this.stencilMask.set(s.mask),this.stencilOp.set([s.fail,s.depthFail,s.pass]),this.stencilFunc.set({func:s.test.func,ref:s.ref,mask:s.test.mask})):this.stencilTest.set(!1)}setColorMode(s){c.bL(s.blendFunction,vr.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(s.blendFunction),this.blendColor.set(s.blendColor)),this.colorMask.set(s.mask)}createVertexArray(){var s;return Xs(this.gl)?this.gl.createVertexArray():(s=this.gl.getExtension("OES_vertex_array_object"))===null||s===void 0?void 0:s.createVertexArrayOES()}deleteVertexArray(s){var u;return Xs(this.gl)?this.gl.deleteVertexArray(s):(u=this.gl.getExtension("OES_vertex_array_object"))===null||u===void 0?void 0:u.deleteVertexArrayOES(s)}unbindVAO(){this.bindVertexArray.set(null)}}let Uo;function au(b,s,u,_,m){const v=b.context,w=b.transform,S=v.gl,I=b.useProgram("collisionBox"),B=[];let D=0,U=0;for(let st=0;st<_.length;st++){const ut=_[st],_t=s.getTile(ut).getBucket(u);if(!_t)continue;const lt=m?_t.textCollisionBox:_t.iconCollisionBox,gt=_t.collisionCircleArray;gt.length>0&&(B.push({circleArray:gt,circleOffset:U,coord:ut}),D+=gt.length/4,U=D),lt&&I.draw(v,S.LINES,Be.disabled,Ne.disabled,b.colorModeForRenderPass(),je.disabled,Gh(b.transform),b.style.map.terrain&&b.style.map.terrain.getTerrainData(ut),w.getProjectionData({overscaledTileID:ut,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),u.id,lt.layoutVertexBuffer,lt.indexBuffer,lt.segments,null,b.transform.zoom,null,null,lt.collisionVertexBuffer)}if(!m||!B.length)return;const k=b.useProgram("collisionCircle"),j=new c.c4;j.resize(4*D),j._trim();let W=0;for(const st of B)for(let ut=0;ut<st.circleArray.length/4;ut++){const _t=4*ut,lt=st.circleArray[_t+0],gt=st.circleArray[_t+1],mt=st.circleArray[_t+2],dt=st.circleArray[_t+3];j.emplace(W++,lt,gt,mt,dt,0),j.emplace(W++,lt,gt,mt,dt,1),j.emplace(W++,lt,gt,mt,dt,2),j.emplace(W++,lt,gt,mt,dt,3)}(!Uo||Uo.length<2*D)&&(Uo=(function(st){const ut=2*st,_t=new c.c6;_t.resize(ut),_t._trim();for(let lt=0;lt<ut;lt++){const gt=6*lt;_t.uint16[gt+0]=4*lt+0,_t.uint16[gt+1]=4*lt+1,_t.uint16[gt+2]=4*lt+2,_t.uint16[gt+3]=4*lt+2,_t.uint16[gt+4]=4*lt+3,_t.uint16[gt+5]=4*lt+0}return _t})(D));const Q=v.createIndexBuffer(Uo,!0),et=v.createVertexBuffer(j,c.c5.members,!0);for(const st of B){const ut=Bp(b.transform);k.draw(v,S.TRIANGLES,Be.disabled,Ne.disabled,b.colorModeForRenderPass(),je.disabled,ut,b.style.map.terrain&&b.style.map.terrain.getTerrainData(st.coord),null,u.id,et,Q,c.aR.simpleSegment(0,2*st.circleOffset,st.circleArray.length,st.circleArray.length/2),null,b.transform.zoom,null,null,null)}et.destroy(),Q.destroy()}const $p=c.am(new Float32Array(16));function lu(b,s,u,_,m,v){const{horizontalAlign:w,verticalAlign:S}=c.aM(b);return new c.P((-(w-.5)*s/m+_[0])*v,(-(S-.5)*u/m+_[1])*v)}function cu(b,s,u,_,m,v){const w=s.tileAnchorPoint.add(new c.P(s.translation[0],s.translation[1]));if(s.pitchWithMap){let S=_.mult(v);u||(S=S.rotate(-m));const I=w.add(S);return ue(I.x,I.y,s.pitchedLabelPlaneMatrix,s.getElevation).point}if(u){const S=cs(s.tileAnchorPoint.x+1,s.tileAnchorPoint.y,s).point.sub(b),I=Math.atan(S.y/S.x)+(S.x<0?Math.PI:0);return b.add(_.rotate(I))}return b.add(_)}function uu(b,s,u,_,m,v,w,S,I,B,D,U){const k=b.text.placedSymbolArray,j=b.text.dynamicLayoutVertexArray,W=b.icon.dynamicLayoutVertexArray,Q={};j.clear();for(let et=0;et<k.length;et++){const st=k.get(et),ut=st.hidden||!st.crossTileID||b.allowVerticalPlacement&&!st.placedOrientation?null:_[st.crossTileID];if(ut){const _t=new c.P(st.anchorX,st.anchorY),lt={getElevation:U,width:m.width,height:m.height,pitchedLabelPlaneMatrix:v,pitchWithMap:u,transform:m,tileAnchorPoint:_t,translation:B,unwrappedTileID:D},gt=u?Vs(_t.x,_t.y,lt):cs(_t.x,_t.y,lt),mt=ve(m.cameraToCenterDistance,gt.signedDistanceFromCamera);let dt=c.au(b.textSizeData,S,st)*mt/c.aG;u&&(dt*=b.tilePixelRatio/w);const{width:wt,height:Ft,anchor:Mt,textOffset:Rt,textBoxScale:Ot}=ut,qt=lu(Mt,wt,Ft,Rt,Ot,dt),Zt=m.getPitchedTextCorrection(_t.x+B[0],_t.y+B[1],D),Gt=cu(gt.point,lt,s,qt,-m.bearingInRadians,Zt),he=b.allowVerticalPlacement&&st.placedOrientation===c.at.vertical?Math.PI/2:0;for(let pe=0;pe<st.numGlyphs;pe++)c.aA(j,Gt,he);I&&st.associatedIconIndex>=0&&(Q[st.associatedIconIndex]={shiftedAnchor:Gt,angle:he})}else Di(st.numGlyphs,j)}if(I){W.clear();const et=b.icon.placedSymbolArray;for(let st=0;st<et.length;st++){const ut=et.get(st);if(ut.hidden)Di(ut.numGlyphs,W);else{const _t=Q[st];if(_t)for(let lt=0;lt<ut.numGlyphs;lt++)c.aA(W,_t.shiftedAnchor,_t.angle);else Di(ut.numGlyphs,W)}}b.icon.dynamicLayoutVertexBuffer.updateData(W)}b.text.dynamicLayoutVertexBuffer.updateData(j)}function Ba(b,s,u){return u.iconsInText&&s?"symbolTextAndIcon":b?"symbolSDF":"symbolIcon"}function hu(b,s,u,_,m,v,w,S,I,B,D,U,k){const j=b.context,W=j.gl,Q=b.transform,et=S==="map",st=I==="map",ut=S!=="viewport"&&u.layout.get("symbol-placement")!=="point",_t=et&&!st&&!ut,lt=!u.layout.get("symbol-sort-key").isConstant();let gt=!1;const mt=b.getDepthModeForSublayer(0,Be.ReadOnly),dt=u._unevaluatedLayout.hasValue("text-variable-anchor")||u._unevaluatedLayout.hasValue("text-variable-anchor-offset"),wt=[],Ft=Q.getCircleRadiusCorrection();for(const Mt of _){const Rt=s.getTile(Mt),Ot=Rt.getBucket(u);if(!Ot)continue;const qt=m?Ot.text:Ot.icon;if(!qt||!qt.segments.get().length||!qt.hasVisibleVertices)continue;const Zt=qt.programConfigurations.get(u.id),Gt=m||Ot.sdfIcons,he=m?Ot.textSizeData:Ot.iconSizeData,pe=st||Q.pitch!==0,qe=b.useProgram(Ba(Gt,m,Ot),Zt),xr=c.as(he,Q.zoom),pr=b.style.map.terrain&&b.style.map.terrain.getTerrainData(Mt);let Cr,ar,Jr,lr,ui=[0,0],Vr=null;if(m)ar=Rt.glyphAtlasTexture,Jr=W.LINEAR,Cr=Rt.glyphAtlasTexture.size,Ot.iconsInText&&(ui=Rt.imageAtlasTexture.size,Vr=Rt.imageAtlasTexture,lr=pe||b.options.rotating||b.options.zooming||he.kind==="composite"||he.kind==="camera"?W.LINEAR:W.NEAREST);else{const Ir=u.layout.get("icon-size").constantOr(0)!==1||Ot.iconsNeedLinear;ar=Rt.imageAtlasTexture,Jr=Gt||b.options.rotating||b.options.zooming||Ir||pe?W.LINEAR:W.NEAREST,Cr=Rt.imageAtlasTexture.size}const Qr=c.aH(Rt,1,b.transform.zoom),Li=kr(et,b.transform,Qr),bn=c.M();c.av(bn,Li);const mo=sr(st,et,b.transform,Qr),Un=c.aI(Q,Rt,v,w),zn=Q.getProjectionData({overscaledTileID:Mt,applyGlobeMatrix:!k,applyTerrainMatrix:!0}),Ss=dt&&Ot.hasTextData(),Ho=u.layout.get("icon-text-fit")!=="none"&&Ss&&Ot.hasIconData();if(ut){const Ir=b.style.map.terrain?(jr,Mr)=>b.style.map.terrain.getElevation(Mt,jr,Mr):null,wr=u.layout.get("text-rotation-alignment")==="map";Us(Ot,b,m,Li,bn,st,B,wr,Mt.toUnwrapped(),Q.width,Q.height,Un,Ir)}const Go=m&&dt||Ho,us=ut||Go?$p:st?Li:b.transform.clipSpaceToPixelsMatrix,yo=Gt&&u.paint.get(m?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Vn;Vn=Gt?Ot.iconsInText?Yh(he.kind,xr,_t,st,ut,Go,b,us,mo,Un,Cr,ui,Ft):yn(he.kind,xr,_t,st,ut,Go,b,us,mo,Un,m,Cr,0,Ft):wl(he.kind,xr,_t,st,ut,Go,b,us,mo,Un,m,Cr,Ft);const jn={program:qe,buffers:qt,uniformValues:Vn,projectionData:zn,atlasTexture:ar,atlasTextureIcon:Vr,atlasInterpolation:Jr,atlasInterpolationIcon:lr,isSDF:Gt,hasHalo:yo};if(lt&&Ot.canOverlap){gt=!0;const Ir=qt.segments.get();for(const wr of Ir)wt.push({segments:new c.aR([wr]),sortKey:wr.sortKey,state:jn,terrainData:pr})}else wt.push({segments:qt.segments,sortKey:0,state:jn,terrainData:pr})}gt&&wt.sort(((Mt,Rt)=>Mt.sortKey-Rt.sortKey));for(const Mt of wt){const Rt=Mt.state;if(j.activeTexture.set(W.TEXTURE0),Rt.atlasTexture.bind(Rt.atlasInterpolation,W.CLAMP_TO_EDGE),Rt.atlasTextureIcon&&(j.activeTexture.set(W.TEXTURE1),Rt.atlasTextureIcon&&Rt.atlasTextureIcon.bind(Rt.atlasInterpolationIcon,W.CLAMP_TO_EDGE)),Rt.isSDF){const Ot=Rt.uniformValues;Rt.hasHalo&&(Ot.u_is_halo=1,Wp(Rt.buffers,Mt.segments,u,b,Rt.program,mt,D,U,Ot,Rt.projectionData,Mt.terrainData)),Ot.u_is_halo=0}Wp(Rt.buffers,Mt.segments,u,b,Rt.program,mt,D,U,Rt.uniformValues,Rt.projectionData,Mt.terrainData)}}function Wp(b,s,u,_,m,v,w,S,I,B,D){const U=_.context;m.draw(U,U.gl.TRIANGLES,v,w,S,je.backCCW,I,D,B,u.id,b.layoutVertexBuffer,b.indexBuffer,s,u.paint,_.transform.zoom,b.programConfigurations.get(u.id),b.dynamicLayoutVertexBuffer,b.opacityVertexBuffer)}function Sl(b,s,u,_,m){const v=b.context,w=v.gl,S=Ne.disabled,I=new vr([w.ONE,w.ONE],c.bj.transparent,[!0,!0,!0,!0]),B=s.getBucket(u);if(!B)return;const D=_.key;let U=u.heatmapFbos.get(D);U||(U=od(v,s.tileSize,s.tileSize),u.heatmapFbos.set(D,U)),v.bindFramebuffer.set(U.framebuffer),v.viewport.set([0,0,s.tileSize,s.tileSize]),v.clear({color:c.bj.transparent});const k=B.programConfigurations.get(u.id),j=b.useProgram("heatmap",k,!m),W=b.transform.getProjectionData({overscaledTileID:s.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),Q=b.style.map.terrain.getTerrainData(_);j.draw(v,w.TRIANGLES,Be.disabled,S,I,je.disabled,Wh(s,b.transform.zoom,u.paint.get("heatmap-intensity"),1),Q,W,u.id,B.layoutVertexBuffer,B.indexBuffer,B.segments,u.paint,b.transform.zoom,k)}function u0(b,s,u,_,m){const v=b.context,w=v.gl,S=b.transform;v.setColorMode(b.colorModeForRenderPass());const I=Cl(v,s),B=u.key,D=s.heatmapFbos.get(B);if(!D)return;v.activeTexture.set(w.TEXTURE0),w.bindTexture(w.TEXTURE_2D,D.colorAttachment.get()),v.activeTexture.set(w.TEXTURE1),I.bind(w.LINEAR,w.CLAMP_TO_EDGE);const U=S.getProjectionData({overscaledTileID:u,applyTerrainMatrix:m,applyGlobeMatrix:!_});b.useProgram("heatmapTexture").draw(v,w.TRIANGLES,Be.disabled,Ne.disabled,b.colorModeForRenderPass(),je.disabled,Xh(b,s,0,1),null,U,s.id,b.rasterBoundsBuffer,b.quadTriangleIndexBuffer,b.rasterBoundsSegments,s.paint,S.zoom),D.destroy(),s.heatmapFbos.delete(B)}function od(b,s,u){var _,m;const v=b.gl,w=v.createTexture();v.bindTexture(v.TEXTURE_2D,w),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_S,v.CLAMP_TO_EDGE),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_T,v.CLAMP_TO_EDGE),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MIN_FILTER,v.LINEAR),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MAG_FILTER,v.LINEAR);const S=(_=b.HALF_FLOAT)!==null&&_!==void 0?_:v.UNSIGNED_BYTE,I=(m=b.RGBA16F)!==null&&m!==void 0?m:v.RGBA;v.texImage2D(v.TEXTURE_2D,0,I,s,u,0,v.RGBA,S,null);const B=b.createFramebuffer(s,u,!1,!1);return B.colorAttachment.set(w),B}function Cl(b,s){return s.colorRampTexture||(s.colorRampTexture=new c.T(b,s.colorRamp,b.gl.RGBA)),s.colorRampTexture}function du(b,s,u,_,m,v,w,S){let I=256;if(m.stepInterpolant){const B=s.getSource().maxzoom,D=w.canonical.z===B?Math.ceil(1<<b.transform.maxZoom-w.canonical.z):1;I=c.ai(c.c8(v.maxLineLength/c.a3*1024*D),256,u.maxTextureSize)}return S.gradient=c.c9({expression:m.gradientExpression(),evaluationKey:"lineProgress",resolution:I,image:S.gradient||void 0,clips:v.lineClipsArray}),S.texture?S.texture.update(S.gradient):S.texture=new c.T(u,S.gradient,_.RGBA),S.version=m.gradientVersion,S.texture}function Xp(b,s,u,_,m){b.activeTexture.set(s.TEXTURE0),u.imageAtlasTexture.bind(s.LINEAR,s.CLAMP_TO_EDGE),_.updatePaintBuffers(m)}function qp(b,s,u,_,m,v){(m||b.lineAtlas.dirty)&&(s.activeTexture.set(u.TEXTURE0),b.lineAtlas.bind(s)),_.updatePaintBuffers(v)}function fu(b,s,u,_,m,v,w){const S=v.gradients[m.id];let I=S.texture;m.gradientVersion!==S.version&&(I=du(b,s,u,_,m,v,w,S)),u.activeTexture.set(_.TEXTURE0),I.bind(m.stepInterpolant?_.NEAREST:_.LINEAR,_.CLAMP_TO_EDGE)}function ad(b,s,u,_,m,v,w,S,I){const B=v.gradients[m.id];let D=B.texture;m.gradientVersion!==B.version&&(D=du(b,s,u,_,m,v,w,B)),u.activeTexture.set(_.TEXTURE0),D.bind(m.stepInterpolant?_.NEAREST:_.LINEAR,_.CLAMP_TO_EDGE),u.activeTexture.set(_.TEXTURE1),b.lineAtlas.bind(u),S.updatePaintBuffers(I)}function Zp(b,s,u,_,m){if(!u||!_||!_.imageAtlas)return;const v=_.imageAtlas.patternPositions;let w=v[u.to.toString()],S=v[u.from.toString()];if(!w&&S&&(w=S),!S&&w&&(S=w),!w||!S){const I=m.getPaintProperty(s);w=v[I],S=v[I]}w&&S&&b.setConstantPatternPositions(w,S)}function ld(b,s,u,_,m,v,w,S){const I=b.context.gl,B="fill-pattern",D=u.paint.get(B),U=D&&D.constantOr(1),k=u.getCrossfadeParameters();let j,W,Q,et,st;const ut=b.transform,_t=u.paint.get("fill-translate"),lt=u.paint.get("fill-translate-anchor");w?(W=U&&!u.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",j=I.LINES):(W=U?"fillPattern":"fill",j=I.TRIANGLES);const gt=D.constantOr(null);for(const mt of _){const dt=s.getTile(mt);if(U&&!dt.patternsLoaded())continue;const wt=dt.getBucket(u);if(!wt)continue;const Ft=wt.programConfigurations.get(u.id),Mt=b.useProgram(W,Ft),Rt=b.style.map.terrain&&b.style.map.terrain.getTerrainData(mt);U&&(b.context.activeTexture.set(I.TEXTURE0),dt.imageAtlasTexture.bind(I.LINEAR,I.CLAMP_TO_EDGE),Ft.updatePaintBuffers(k)),Zp(Ft,B,gt,dt,u);const Ot=ut.getProjectionData({overscaledTileID:mt,applyGlobeMatrix:!S,applyTerrainMatrix:!0}),qt=c.aI(ut,dt,_t,lt);if(w){et=wt.indexBuffer2,st=wt.segments2;const Gt=[I.drawingBufferWidth,I.drawingBufferHeight];Q=W==="fillOutlinePattern"&&U?t0(b,k,dt,Gt,qt):Rp(Gt,qt)}else et=wt.indexBuffer,st=wt.segments,Q=U?Mp(b,k,dt,qt):{u_fill_translate:qt};const Zt=b.stencilModeForClipping(mt);Mt.draw(b.context,j,m,Zt,v,je.backCCW,Q,Rt,Ot,u.id,wt.layoutVertexBuffer,et,st,u.paint,b.transform.zoom,Ft)}}function Pr(b,s,u,_,m,v,w,S){const I=b.context,B=I.gl,D="fill-extrusion-pattern",U=u.paint.get(D),k=U.constantOr(1),j=u.getCrossfadeParameters(),W=u.paint.get("fill-extrusion-opacity"),Q=U.constantOr(null),et=b.transform;for(const st of _){const ut=s.getTile(st),_t=ut.getBucket(u);if(!_t)continue;const lt=b.style.map.terrain&&b.style.map.terrain.getTerrainData(st),gt=_t.programConfigurations.get(u.id),mt=b.useProgram(k?"fillExtrusionPattern":"fillExtrusion",gt);k&&(b.context.activeTexture.set(B.TEXTURE0),ut.imageAtlasTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE),gt.updatePaintBuffers(j));const dt=et.getProjectionData({overscaledTileID:st,applyGlobeMatrix:!S,applyTerrainMatrix:!0});Zp(gt,D,Q,ut,u);const wt=c.aI(et,ut,u.paint.get("fill-extrusion-translate"),u.paint.get("fill-extrusion-translate-anchor")),Ft=u.paint.get("fill-extrusion-vertical-gradient"),Mt=k?Ia(b,Ft,W,wt,st,j,ut):Ip(b,Ft,W,wt);mt.draw(I,I.gl.TRIANGLES,m,v,w,je.backCCW,Mt,lt,dt,u.id,_t.layoutVertexBuffer,_t.indexBuffer,_t.segments,u.paint,b.transform.zoom,gt,b.style.map.terrain&&_t.centroidVertexBuffer)}}function kn(b,s,u,_,m,v,w,S,I){var B;const D=b.style.projection,U=b.context,k=b.transform,j=U.gl,W=[`#define NUM_ILLUMINATION_SOURCES ${u.paint.get("hillshade-highlight-color").values.length}`],Q=b.useProgram("hillshade",null,!1,W),et=!b.options.moving;for(const st of _){const ut=s.getTile(st),_t=ut.fbo;if(!_t)continue;const lt=D.getMeshFromTileID(U,st.canonical,S,!0,"raster"),gt=(B=b.style.map.terrain)===null||B===void 0?void 0:B.getTerrainData(st);U.activeTexture.set(j.TEXTURE0),j.bindTexture(j.TEXTURE_2D,_t.colorAttachment.get());const mt=k.getProjectionData({overscaledTileID:st,aligned:et,applyGlobeMatrix:!I,applyTerrainMatrix:!0});Q.draw(U,j.TRIANGLES,v,m[st.overscaledZ],w,je.backCCW,Oo(b,ut,u),gt,mt,u.id,lt.vertexBuffer,lt.indexBuffer,lt.segments)}}function is(b,s,u,_,m,v,w,S,I){var B;const D=b.style.projection,U=b.context,k=b.transform,j=U.gl,W=b.useProgram("colorRelief"),Q=!b.options.moving;let et=!0,st=0;for(const ut of _){const _t=s.getTile(ut),lt=_t.dem;if(et){const Mt=j.getParameter(j.MAX_TEXTURE_SIZE),{elevationTexture:Rt,colorTexture:Ot}=u.getColorRampTextures(U,Mt,lt.getUnpackVector());U.activeTexture.set(j.TEXTURE1),Rt.bind(j.NEAREST,j.CLAMP_TO_EDGE),U.activeTexture.set(j.TEXTURE4),Ot.bind(j.LINEAR,j.CLAMP_TO_EDGE),et=!1,st=Rt.size[0]}if(!lt||!lt.data)continue;const gt=lt.stride,mt=lt.getPixels();if(U.activeTexture.set(j.TEXTURE0),U.pixelStoreUnpackPremultiplyAlpha.set(!1),_t.demTexture=_t.demTexture||b.getTileTexture(gt),_t.demTexture){const Mt=_t.demTexture;Mt.update(mt,{premultiply:!1}),Mt.bind(j.LINEAR,j.CLAMP_TO_EDGE)}else _t.demTexture=new c.T(U,mt,j.RGBA,{premultiply:!1}),_t.demTexture.bind(j.LINEAR,j.CLAMP_TO_EDGE);const dt=D.getMeshFromTileID(U,ut.canonical,S,!0,"raster"),wt=(B=b.style.map.terrain)===null||B===void 0?void 0:B.getTerrainData(ut),Ft=k.getProjectionData({overscaledTileID:ut,aligned:Q,applyGlobeMatrix:!I,applyTerrainMatrix:!0});W.draw(U,j.TRIANGLES,v,m[ut.overscaledZ],w,je.backCCW,vl(u,_t.dem,st),wt,Ft,u.id,dt.vertexBuffer,dt.indexBuffer,dt.segments)}}const Il=[new c.P(0,0),new c.P(c.a3,0),new c.P(c.a3,c.a3),new c.P(0,c.a3)];function zo(b,s,u,_,m,v,w,S,I=!1,B=!1){const D=_[_.length-1].overscaledZ,U=b.context,k=U.gl,j=b.useProgram("raster"),W=b.transform,Q=b.style.projection,et=b.colorModeForRenderPass(),st=!b.options.moving,ut=u.paint.get("raster-opacity"),_t=u.paint.get("raster-resampling"),lt=u.paint.get("raster-fade-duration"),gt=!!b.style.map.terrain;for(const mt of _){const dt=b.getDepthModeForSublayer(mt.overscaledZ-D,ut===1?Be.ReadWrite:Be.ReadOnly,k.LESS),wt=s.getTile(mt),Ft=_t==="nearest"?k.NEAREST:k.LINEAR;U.activeTexture.set(k.TEXTURE0),wt.texture.bind(Ft,k.CLAMP_TO_EDGE,k.LINEAR_MIPMAP_NEAREST),U.activeTexture.set(k.TEXTURE1);const{parentTile:Mt,parentScaleBy:Rt,parentTopLeft:Ot,fadeValues:qt}=Yp(wt,s,lt,gt);wt.fadeOpacity=qt.tileOpacity,Mt?(Mt.fadeOpacity=qt.parentTileOpacity,Mt.texture.bind(Ft,k.CLAMP_TO_EDGE,k.LINEAR_MIPMAP_NEAREST)):wt.texture.bind(Ft,k.CLAMP_TO_EDGE,k.LINEAR_MIPMAP_NEAREST),wt.texture.useMipmap&&U.extTextureFilterAnisotropic&&b.transform.pitch>20&&k.texParameterf(k.TEXTURE_2D,U.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,U.extTextureFilterAnisotropicMax);const Zt=b.style.map.terrain&&b.style.map.terrain.getTerrainData(mt),Gt=W.getProjectionData({overscaledTileID:mt,aligned:st,applyGlobeMatrix:!B,applyTerrainMatrix:!0}),he=Zh(Ot,Rt,qt.fadeMix,u,S),pe=Q.getMeshFromTileID(U,mt.canonical,v,w,"raster");j.draw(U,k.TRIANGLES,dt,m?m[mt.overscaledZ]:Ne.disabled,et,I?je.frontCCW:je.backCCW,he,Zt,Gt,u.id,pe.vertexBuffer,pe.indexBuffer,pe.segments)}}function Yp(b,s,u,_){const m={parentTile:null,parentScaleBy:1,parentTopLeft:[0,0],fadeValues:{tileOpacity:1,parentTileOpacity:1,fadeMix:{opacity:1,mix:0}}};if(u===0||_)return m;if(b.fadingParentID){const v=s.getLoadedTile(b.fadingParentID);if(!v)return m;const w=Math.pow(2,v.tileID.overscaledZ-b.tileID.overscaledZ),S=[b.tileID.canonical.x*w%1,b.tileID.canonical.y*w%1],I=(function(B,D,U){const k=nt(),j=(k-D.timeAdded)/U,W=B.fadingDirection===yt.Incoming,Q=c.ai((k-B.timeAdded)/U,0,1),et=c.ai(1-j,0,1),st=W?Q:et;return{tileOpacity:st,parentTileOpacity:W?et:Q,fadeMix:{opacity:1,mix:1-st}}})(b,v,u);return{parentTile:v,parentScaleBy:w,parentTopLeft:S,fadeValues:I}}if(b.selfFading){const v=(function(w,S){const I=(nt()-w.timeAdded)/S,B=c.ai(I,0,1);return{tileOpacity:B,fadeMix:{opacity:B,mix:0}}})(b,u);return{parentTile:null,parentScaleBy:1,parentTopLeft:[0,0],fadeValues:v}}return m}const Da=new c.bj(1,0,0,1),cd=new c.bj(0,1,0,1),Ml=new c.bj(0,0,1,1),ud=new c.bj(1,0,1,1),Kp=new c.bj(0,1,1,1);function hd(b,s,u,_){Rl(b,0,s+u/2,b.transform.width,u,_)}function dd(b,s,u,_){Rl(b,s-u/2,0,u,b.transform.height,_)}function Rl(b,s,u,_,m,v){const w=b.context,S=w.gl;S.enable(S.SCISSOR_TEST),S.scissor(s*b.pixelRatio,u*b.pixelRatio,_*b.pixelRatio,m*b.pixelRatio),w.clear({color:v}),S.disable(S.SCISSOR_TEST)}function Jp(b,s,u){const _=b.context,m=_.gl,v=b.useProgram("debug"),w=Be.disabled,S=Ne.disabled,I=b.colorModeForRenderPass(),B="$debug",D=b.style.map.terrain&&b.style.map.terrain.getTerrainData(u);_.activeTexture.set(m.TEXTURE0);const U=s.getTileByID(u.key).latestRawTileData,k=Math.floor((U&&U.byteLength||0)/1024),j=s.getTile(u).tileSize,W=512/Math.min(j,512)*(u.overscaledZ/b.transform.zoom)*.5;let Q=u.canonical.toString();u.overscaledZ!==u.canonical.z&&(Q+=` => ${u.overscaledZ}`),(function(st,ut){st.initDebugOverlayCanvas();const _t=st.debugOverlayCanvas,lt=st.context.gl,gt=st.debugOverlayCanvas.getContext("2d");gt.clearRect(0,0,_t.width,_t.height),gt.shadowColor="white",gt.shadowBlur=2,gt.lineWidth=1.5,gt.strokeStyle="white",gt.textBaseline="top",gt.font="bold 36px Open Sans, sans-serif",gt.fillText(ut,5,5),gt.strokeText(ut,5,5),st.debugOverlayTexture.update(_t),st.debugOverlayTexture.bind(lt.LINEAR,lt.CLAMP_TO_EDGE)})(b,`${Q} ${k}kB`);const et=b.transform.getProjectionData({overscaledTileID:u,applyGlobeMatrix:!0,applyTerrainMatrix:!0});v.draw(_,m.TRIANGLES,w,S,vr.alphaBlended,je.disabled,$h(c.bj.transparent,W),null,et,B,b.debugBuffer,b.quadTriangleIndexBuffer,b.debugSegments),v.draw(_,m.LINE_STRIP,w,S,I,je.disabled,$h(c.bj.red),D,et,B,b.debugBuffer,b.tileBorderIndexBuffer,b.debugSegments)}function _o(b,s,u,_){const{isRenderingGlobe:m}=_,v=b.context,w=v.gl,S=b.transform,I=b.colorModeForRenderPass(),B=b.getDepthModeFor3D(),D=b.useProgram("terrain");v.bindFramebuffer.set(null),v.viewport.set([0,0,b.width,b.height]);for(const U of u){const k=s.getTerrainMesh(U.tileID),j=b.renderToTexture.getTexture(U),W=s.getTerrainData(U.tileID);v.activeTexture.set(w.TEXTURE0),w.bindTexture(w.TEXTURE_2D,j.texture);const Q=s.getMeshFrameDelta(S.zoom),et=S.calculateFogMatrix(U.tileID.toUnwrapped()),st=Hh(Q,et,b.style.sky,S.pitch,m),ut=S.getProjectionData({overscaledTileID:U.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});D.draw(v,w.TRIANGLES,B,Ne.disabled,I,je.backCCW,st,W,ut,"terrain",k.vertexBuffer,k.indexBuffer,k.segments)}}function fd(b,s){if(!s.mesh){const u=new c.aQ;u.emplaceBack(-1,-1),u.emplaceBack(1,-1),u.emplaceBack(1,1),u.emplaceBack(-1,1);const _=new c.aS;_.emplaceBack(0,1,2),_.emplaceBack(0,2,3),s.mesh=new uo(b.createVertexBuffer(u,Yr.members),b.createIndexBuffer(_),c.aR.simpleSegment(0,0,u.length,_.length))}return s.mesh}class Qp{constructor(s,u){this.context=new ou(s),this.transform=u,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:c.am(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=Pe.maxUnderzooming+Pe.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new yr}resize(s,u,_){if(this.width=Math.floor(s*_),this.height=Math.floor(u*_),this.pixelRatio=_,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const m of this.style._order)this.style._layers[m].resize()}setup(){const s=this.context,u=new c.aQ;u.emplaceBack(0,0),u.emplaceBack(c.a3,0),u.emplaceBack(0,c.a3),u.emplaceBack(c.a3,c.a3),this.tileExtentBuffer=s.createVertexBuffer(u,Yr.members),this.tileExtentSegments=c.aR.simpleSegment(0,0,4,2);const _=new c.aQ;_.emplaceBack(0,0),_.emplaceBack(c.a3,0),_.emplaceBack(0,c.a3),_.emplaceBack(c.a3,c.a3),this.debugBuffer=s.createVertexBuffer(_,Yr.members),this.debugSegments=c.aR.simpleSegment(0,0,4,5);const m=new c.cb;m.emplaceBack(0,0,0,0),m.emplaceBack(c.a3,0,c.a3,0),m.emplaceBack(0,c.a3,0,c.a3),m.emplaceBack(c.a3,c.a3,c.a3,c.a3),this.rasterBoundsBuffer=s.createVertexBuffer(m,mn.members),this.rasterBoundsSegments=c.aR.simpleSegment(0,0,4,2);const v=new c.aQ;v.emplaceBack(0,0),v.emplaceBack(c.a3,0),v.emplaceBack(0,c.a3),v.emplaceBack(c.a3,c.a3),this.rasterBoundsBufferPosOnly=s.createVertexBuffer(v,Yr.members),this.rasterBoundsSegmentsPosOnly=c.aR.simpleSegment(0,0,4,5);const w=new c.aQ;w.emplaceBack(0,0),w.emplaceBack(1,0),w.emplaceBack(0,1),w.emplaceBack(1,1),this.viewportBuffer=s.createVertexBuffer(w,Yr.members),this.viewportSegments=c.aR.simpleSegment(0,0,4,2);const S=new c.cc;S.emplaceBack(0),S.emplaceBack(1),S.emplaceBack(3),S.emplaceBack(2),S.emplaceBack(0),this.tileBorderIndexBuffer=s.createIndexBuffer(S);const I=new c.aS;I.emplaceBack(1,0,2),I.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=s.createIndexBuffer(I);const B=this.context.gl;this.stencilClearMode=new Ne({func:B.ALWAYS,mask:0},0,255,B.ZERO,B.ZERO,B.ZERO),this.tileExtentMesh=new uo(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){const s=this.context,u=s.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const _=c.M();c.c1(_,0,this.width,this.height,0,0,1),c.O(_,_,[u.drawingBufferWidth,u.drawingBufferHeight,0]);const m={mainMatrix:_,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:_};this.useProgram("clippingMask",null,!0).draw(s,u.TRIANGLES,Be.disabled,this.stencilClearMode,vr.disabled,je.disabled,null,null,m,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(s,u,_){if(this.currentStencilSource===s.source||!s.isTileClipped()||!u||!u.length)return;this.currentStencilSource=s.source,this.nextStencilID+u.length>256&&this.clearStencil();const m=this.context;m.setColorMode(vr.disabled),m.setDepthMode(Be.disabled);const v={};for(const w of u)v[w.key]=this.nextStencilID++;this._renderTileMasks(v,u,_,!0),this._renderTileMasks(v,u,_,!1),this._tileClippingMaskIDs=v}_renderTileMasks(s,u,_,m){const v=this.context,w=v.gl,S=this.style.projection,I=this.transform,B=this.useProgram("clippingMask");for(const D of u){const U=s[D.key],k=this.style.map.terrain&&this.style.map.terrain.getTerrainData(D),j=S.getMeshFromTileID(this.context,D.canonical,m,!0,"stencil"),W=I.getProjectionData({overscaledTileID:D,applyGlobeMatrix:!_,applyTerrainMatrix:!0});B.draw(v,w.TRIANGLES,Be.disabled,new Ne({func:w.ALWAYS,mask:0},U,255,w.KEEP,w.KEEP,w.REPLACE),vr.disabled,_?je.disabled:je.backCCW,null,k,W,"$clipping",j.vertexBuffer,j.indexBuffer,j.segments)}}_renderTilesDepthBuffer(){const s=this.context,u=s.gl,_=this.style.projection,m=this.transform,v=this.useProgram("depth"),w=this.getDepthModeFor3D(),S=Ee(m,{tileSize:m.tileSize});for(const I of S){const B=this.style.map.terrain&&this.style.map.terrain.getTerrainData(I),D=_.getMeshFromTileID(this.context,I.canonical,!0,!0,"raster"),U=m.getProjectionData({overscaledTileID:I,applyGlobeMatrix:!0,applyTerrainMatrix:!0});v.draw(s,u.TRIANGLES,w,Ne.disabled,vr.disabled,je.backCCW,null,B,U,"$clipping",D.vertexBuffer,D.indexBuffer,D.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const s=this.nextStencilID++,u=this.context.gl;return new Ne({func:u.NOTEQUAL,mask:255},s,255,u.KEEP,u.KEEP,u.REPLACE)}stencilModeForClipping(s){const u=this.context.gl;return new Ne({func:u.EQUAL,mask:255},this._tileClippingMaskIDs[s.key],0,u.KEEP,u.KEEP,u.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(s){const u=this.context.gl,_=s.sort(((w,S)=>S.overscaledZ-w.overscaledZ)),m=_[_.length-1].overscaledZ,v=_[0].overscaledZ-m+1;if(v>1){this.currentStencilSource=void 0,this.nextStencilID+v>256&&this.clearStencil();const w={};for(let S=0;S<v;S++)w[S+m]=new Ne({func:u.GEQUAL,mask:255},S+this.nextStencilID,255,u.KEEP,u.KEEP,u.REPLACE);return this.nextStencilID+=v,[w,_]}return[{[m]:Ne.disabled},_]}stencilConfigForOverlapTwoPass(s){const u=this.context.gl,_=s.sort(((w,S)=>S.overscaledZ-w.overscaledZ)),m=_[_.length-1].overscaledZ,v=_[0].overscaledZ-m+1;if(this.clearStencil(),v>1){const w={},S={};for(let I=0;I<v;I++)w[I+m]=new Ne({func:u.GREATER,mask:255},v+1+I,255,u.KEEP,u.KEEP,u.REPLACE),S[I+m]=new Ne({func:u.GREATER,mask:255},1+I,255,u.KEEP,u.KEEP,u.REPLACE);return this.nextStencilID=2*v+1,[w,S,_]}return this.nextStencilID=3,[{[m]:new Ne({func:u.GREATER,mask:255},2,255,u.KEEP,u.KEEP,u.REPLACE)},{[m]:new Ne({func:u.GREATER,mask:255},1,255,u.KEEP,u.KEEP,u.REPLACE)},_]}colorModeForRenderPass(){const s=this.context.gl;return this._showOverdrawInspector?new vr([s.CONSTANT_COLOR,s.ONE],new c.bj(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?vr.unblended:vr.alphaBlended}getDepthModeForSublayer(s,u,_){if(!this.opaquePassEnabledForLayer())return Be.disabled;const m=1-((1+this.currentLayer)*this.numSublayers+s)*this.depthEpsilon;return new Be(_||this.context.gl.LEQUAL,u,[m,m])}getDepthModeFor3D(){return new Be(this.context.gl.LEQUAL,Be.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(s,u){var _,m;this.style=s,this.options=u,this.lineAtlas=s.lineAtlas,this.imageManager=s.imageManager,this.glyphManager=s.glyphManager,this.symbolFadeChange=s.placement.symbolFadeChange(nt()),this.imageManager.beginFrame();const v=this.style._order,w=this.style.tileManagers,S={},I={},B={},D={isRenderingToTexture:!1,isRenderingGlobe:((_=s.projection)===null||_===void 0?void 0:_.transitionState)>0};for(const k in w){const j=w[k];j.used&&j.prepare(this.context),S[k]=j.getVisibleCoordinates(!1),I[k]=S[k].slice().reverse(),B[k]=j.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let k=0;k<v.length;k++)if(this.style._layers[v[k]].is3D()){this.opaquePassCutoff=k;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const k of v){const j=this.style._layers[k];if(!j.hasOffscreenPass()||j.isHidden(this.transform.zoom))continue;const W=I[j.source];(j.type==="custom"||W.length)&&this.renderLayer(this,w[j.source],j,W,D)}if((m=this.style.projection)===null||m===void 0||m.updateGPUdependent({context:this.context,useProgram:k=>this.useProgram(k)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:u.showOverdrawInspector?c.bj.black:c.bj.transparent,depth:1}),this.clearStencil(),this.style.sky&&(function(k,j){const W=k.context,Q=W.gl,et=((mt,dt,wt)=>{const Ft=Math.cos(dt.rollInRadians),Mt=Math.sin(dt.rollInRadians),Rt=Tt(dt),Ot=dt.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:mt.properties.get("sky-color"),u_horizon_color:mt.properties.get("horizon-color"),u_horizon:[(dt.width/2-Rt*Mt)*wt,(dt.height/2+Rt*Ft)*wt],u_horizon_normal:[-Mt,Ft],u_sky_horizon_blend:mt.properties.get("sky-horizon-blend")*dt.height/2*wt,u_sky_blend:Ot}})(j,k.style.map.transform,k.pixelRatio),st=new Be(Q.LEQUAL,Be.ReadWrite,[0,1]),ut=Ne.disabled,_t=k.colorModeForRenderPass(),lt=k.useProgram("sky"),gt=fd(W,j);lt.draw(W,Q.TRIANGLES,st,ut,_t,je.disabled,et,null,void 0,"sky",gt.vertexBuffer,gt.indexBuffer,gt.segments)})(this,this.style.sky),this._showOverdrawInspector=u.showOverdrawInspector,this.depthRangeFor3D=[0,1-(s._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=v.length-1;this.currentLayer>=0;this.currentLayer--){const k=this.style._layers[v[this.currentLayer]],j=w[k.source],W=S[k.source];this._renderTileClippingMasks(k,W,!1),this.renderLayer(this,j,k,W,D)}this.renderPass="translucent";let U=!1;for(this.currentLayer=0;this.currentLayer<v.length;this.currentLayer++){const k=this.style._layers[v[this.currentLayer]],j=w[k.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(k,D))continue;this.opaquePassEnabledForLayer()||U||(U=!0,D.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());const W=(k.type==="symbol"?B:I)[k.source];this._renderTileClippingMasks(k,S[k.source],!!this.renderToTexture),this.renderLayer(this,j,k,W,D)}if(D.isRenderingGlobe&&(function(k,j,W){const Q=k.context,et=Q.gl,st=k.useProgram("atmosphere"),ut=new Be(et.LEQUAL,Be.ReadOnly,[0,1]),_t=k.transform,lt=(function(Ot,qt){const Zt=Ot.properties.get("position"),Gt=[-Zt.x,-Zt.y,-Zt.z],he=c.am(new Float64Array(16));return Ot.properties.get("anchor")==="map"&&(c.ba(he,he,qt.rollInRadians),c.bb(he,he,-qt.pitchInRadians),c.ba(he,he,qt.bearingInRadians),c.bb(he,he,qt.center.lat*Math.PI/180),c.bD(he,he,-qt.center.lng*Math.PI/180)),c.ca(Gt,Gt,he),Gt})(W,k.transform),gt=_t.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),mt=j.properties.get("atmosphere-blend")*gt.projectionTransition;if(mt===0)return;const dt=Gc(_t.worldSize,_t.center.lat),wt=_t.inverseProjectionMatrix,Ft=new Float64Array(4);Ft[3]=1,c.aB(Ft,Ft,_t.modelViewProjectionMatrix),Ft[0]/=Ft[3],Ft[1]/=Ft[3],Ft[2]/=Ft[3],Ft[3]=1,c.aB(Ft,Ft,wt),Ft[0]/=Ft[3],Ft[1]/=Ft[3],Ft[2]/=Ft[3],Ft[3]=1;const Mt=((Ot,qt,Zt,Gt,he)=>({u_sun_pos:Ot,u_atmosphere_blend:qt,u_globe_position:Zt,u_globe_radius:Gt,u_inv_proj_matrix:he}))(lt,mt,[Ft[0],Ft[1],Ft[2]],dt,wt),Rt=fd(Q,j);st.draw(Q,et.TRIANGLES,ut,Ne.disabled,vr.alphaBlended,je.disabled,Mt,null,null,"atmosphere",Rt.vertexBuffer,Rt.indexBuffer,Rt.segments)})(this,this.style.sky,this.style.light),this.options.showTileBoundaries){const k=(function(j,W){let Q=null;const et=Object.values(j._layers).flatMap((lt=>lt.source&&!lt.isHidden(W)?[j.tileManagers[lt.source]]:[])),st=et.filter((lt=>lt.getSource().type==="vector")),ut=et.filter((lt=>lt.getSource().type!=="vector")),_t=lt=>{(!Q||Q.getSource().maxzoom<lt.getSource().maxzoom)&&(Q=lt)};return st.forEach((lt=>_t(lt))),Q||ut.forEach((lt=>_t(lt))),Q})(this.style,this.transform.zoom);k&&(function(j,W,Q){for(let et=0;et<Q.length;et++)Jp(j,W,Q[et])})(this,k,k.getVisibleCoordinates())}this.options.showPadding&&(function(k){const j=k.transform.padding;hd(k,k.transform.height-(j.top||0),3,Da),hd(k,j.bottom||0,3,cd),dd(k,j.left||0,3,Ml),dd(k,k.transform.width-(j.right||0),3,ud);const W=k.transform.centerPoint;(function(Q,et,st,ut){Rl(Q,et-1,st-10,2,20,ut),Rl(Q,et-10,st-1,20,2,ut)})(k,W.x,k.transform.height-W.y,Kp)})(this),this.context.setDefault()}maybeDrawDepthAndCoords(s){if(!this.style||!this.style.map||!this.style.map.terrain)return;const u=this.terrainFacilitator.matrix,_=this.transform.modelViewProjectionMatrix;let m=this.terrainFacilitator.dirty;m||(m=s?!c.cd(u,_):!c.ce(u,_)),m||(m=this.style.map.terrain.tileManager.anyTilesAfterTime(this.terrainFacilitator.renderTime)),m&&(c.cf(u,_),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,(function(v,w){const S=v.context,I=S.gl,B=v.transform,D=vr.unblended,U=new Be(I.LEQUAL,Be.ReadWrite,[0,1]),k=w.tileManager.getRenderableTiles(),j=v.useProgram("terrainDepth");S.bindFramebuffer.set(w.getFramebuffer("depth").framebuffer),S.viewport.set([0,0,v.width/devicePixelRatio,v.height/devicePixelRatio]),S.clear({color:c.bj.transparent,depth:1});for(const W of k){const Q=w.getTerrainMesh(W.tileID),et=w.getTerrainData(W.tileID),st=B.getProjectionData({overscaledTileID:W.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),ut={u_ele_delta:w.getMeshFrameDelta(B.zoom)};j.draw(S,I.TRIANGLES,U,Ne.disabled,D,je.backCCW,ut,et,st,"terrain",Q.vertexBuffer,Q.indexBuffer,Q.segments)}S.bindFramebuffer.set(null),S.viewport.set([0,0,v.width,v.height])})(this,this.style.map.terrain),(function(v,w){const S=v.context,I=S.gl,B=v.transform,D=vr.unblended,U=new Be(I.LEQUAL,Be.ReadWrite,[0,1]),k=w.getCoordsTexture(),j=w.tileManager.getRenderableTiles(),W=v.useProgram("terrainCoords");S.bindFramebuffer.set(w.getFramebuffer("coords").framebuffer),S.viewport.set([0,0,v.width/devicePixelRatio,v.height/devicePixelRatio]),S.clear({color:c.bj.transparent,depth:1}),w.coordsIndex=[];for(const Q of j){const et=w.getTerrainMesh(Q.tileID),st=w.getTerrainData(Q.tileID);S.activeTexture.set(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,k.texture);const ut={u_terrain_coords_id:(255-w.coordsIndex.length)/255,u_texture:0,u_ele_delta:w.getMeshFrameDelta(B.zoom)},_t=B.getProjectionData({overscaledTileID:Q.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});W.draw(S,I.TRIANGLES,U,Ne.disabled,D,je.backCCW,ut,st,_t,"terrain",et.vertexBuffer,et.indexBuffer,et.segments),w.coordsIndex.push(Q.tileID.key)}S.bindFramebuffer.set(null),S.viewport.set([0,0,v.width,v.height])})(this,this.style.map.terrain))}renderLayer(s,u,_,m,v){_.isHidden(this.transform.zoom)||(_.type==="background"||_.type==="custom"||(m||[]).length)&&(this.id=_.id,c.cg(_)?(function(w,S,I,B,D,U){if(w.renderPass!=="translucent")return;const{isRenderingToTexture:k}=U,j=Ne.disabled,W=w.colorModeForRenderPass();(I._unevaluatedLayout.hasValue("text-variable-anchor")||I._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&(function(Q,et,st,ut,_t,lt,gt,mt,dt){const wt=et.transform,Ft=et.style.map.terrain,Mt=_t==="map",Rt=lt==="map";for(const Ot of Q){const qt=ut.getTile(Ot),Zt=qt.getBucket(st);if(!Zt||!Zt.text||!Zt.text.segments.get().length)continue;const Gt=c.as(Zt.textSizeData,wt.zoom),he=c.aH(qt,1,et.transform.zoom),pe=kr(Mt,et.transform,he),qe=st.layout.get("icon-text-fit")!=="none"&&Zt.hasIconData();if(Gt){const xr=Math.pow(2,wt.zoom-qt.tileID.overscaledZ),pr=Ft?(Cr,ar)=>Ft.getElevation(Ot,Cr,ar):null;uu(Zt,Mt,Rt,dt,wt,pe,xr,Gt,qe,c.aI(wt,qt,gt,mt),Ot.toUnwrapped(),pr)}}})(B,w,I,S,I.layout.get("text-rotation-alignment"),I.layout.get("text-pitch-alignment"),I.paint.get("text-translate"),I.paint.get("text-translate-anchor"),D),I.paint.get("icon-opacity").constantOr(1)!==0&&hu(w,S,I,B,!1,I.paint.get("icon-translate"),I.paint.get("icon-translate-anchor"),I.layout.get("icon-rotation-alignment"),I.layout.get("icon-pitch-alignment"),I.layout.get("icon-keep-upright"),j,W,k),I.paint.get("text-opacity").constantOr(1)!==0&&hu(w,S,I,B,!0,I.paint.get("text-translate"),I.paint.get("text-translate-anchor"),I.layout.get("text-rotation-alignment"),I.layout.get("text-pitch-alignment"),I.layout.get("text-keep-upright"),j,W,k),S.map.showCollisionBoxes&&(au(w,S,I,B,!0),au(w,S,I,B,!1))})(s,u,_,m,this.style.placement.variableOffsets,v):c.ch(_)?(function(w,S,I,B,D){if(w.renderPass!=="translucent")return;const{isRenderingToTexture:U}=D,k=I.paint.get("circle-opacity"),j=I.paint.get("circle-stroke-width"),W=I.paint.get("circle-stroke-opacity"),Q=!I.layout.get("circle-sort-key").isConstant();if(k.constantOr(1)===0&&(j.constantOr(1)===0||W.constantOr(1)===0))return;const et=w.context,st=et.gl,ut=w.transform,_t=w.getDepthModeForSublayer(0,Be.ReadOnly),lt=Ne.disabled,gt=w.colorModeForRenderPass(),mt=[],dt=ut.getCircleRadiusCorrection();for(let wt=0;wt<B.length;wt++){const Ft=B[wt],Mt=S.getTile(Ft),Rt=Mt.getBucket(I);if(!Rt)continue;const Ot=I.paint.get("circle-translate"),qt=I.paint.get("circle-translate-anchor"),Zt=c.aI(ut,Mt,Ot,qt),Gt=Rt.programConfigurations.get(I.id),he=w.useProgram("circle",Gt),pe=Rt.layoutVertexBuffer,qe=Rt.indexBuffer,xr=w.style.map.terrain&&w.style.map.terrain.getTerrainData(Ft),pr={programConfiguration:Gt,program:he,layoutVertexBuffer:pe,indexBuffer:qe,uniformValues:Pp(w,Mt,I,Zt,dt),terrainData:xr,projectionData:ut.getProjectionData({overscaledTileID:Ft,applyGlobeMatrix:!U,applyTerrainMatrix:!0})};if(Q){const Cr=Rt.segments.get();for(const ar of Cr)mt.push({segments:new c.aR([ar]),sortKey:ar.sortKey,state:pr})}else mt.push({segments:Rt.segments,sortKey:0,state:pr})}Q&&mt.sort(((wt,Ft)=>wt.sortKey-Ft.sortKey));for(const wt of mt){const{programConfiguration:Ft,program:Mt,layoutVertexBuffer:Rt,indexBuffer:Ot,uniformValues:qt,terrainData:Zt,projectionData:Gt}=wt.state;Mt.draw(et,st.TRIANGLES,_t,lt,gt,je.backCCW,qt,Zt,Gt,I.id,Rt,Ot,wt.segments,I.paint,w.transform.zoom,Ft)}})(s,u,_,m,v):c.ci(_)?(function(w,S,I,B,D){if(I.paint.get("heatmap-opacity")===0)return;const U=w.context,{isRenderingToTexture:k,isRenderingGlobe:j}=D;if(w.style.map.terrain){for(const W of B){const Q=S.getTile(W);S.hasRenderableParent(W)||(w.renderPass==="offscreen"?Sl(w,Q,I,W,j):w.renderPass==="translucent"&&u0(w,I,W,k,j))}U.viewport.set([0,0,w.width,w.height])}else w.renderPass==="offscreen"?(function(W,Q,et,st){const ut=W.context,_t=ut.gl,lt=W.transform,gt=Ne.disabled,mt=new vr([_t.ONE,_t.ONE],c.bj.transparent,[!0,!0,!0,!0]);(function(dt,wt,Ft){const Mt=dt.gl;dt.activeTexture.set(Mt.TEXTURE1),dt.viewport.set([0,0,wt.width/4,wt.height/4]);let Rt=Ft.heatmapFbos.get(c.c7);Rt?(Mt.bindTexture(Mt.TEXTURE_2D,Rt.colorAttachment.get()),dt.bindFramebuffer.set(Rt.framebuffer)):(Rt=od(dt,wt.width/4,wt.height/4),Ft.heatmapFbos.set(c.c7,Rt))})(ut,W,et),ut.clear({color:c.bj.transparent});for(let dt=0;dt<st.length;dt++){const wt=st[dt];if(Q.hasRenderableParent(wt))continue;const Ft=Q.getTile(wt),Mt=Ft.getBucket(et);if(!Mt)continue;const Rt=Mt.programConfigurations.get(et.id),Ot=W.useProgram("heatmap",Rt),qt=lt.getProjectionData({overscaledTileID:wt,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),Zt=lt.getCircleRadiusCorrection();Ot.draw(ut,_t.TRIANGLES,Be.disabled,gt,mt,je.backCCW,Wh(Ft,lt.zoom,et.paint.get("heatmap-intensity"),Zt),null,qt,et.id,Mt.layoutVertexBuffer,Mt.indexBuffer,Mt.segments,et.paint,lt.zoom,Rt)}ut.viewport.set([0,0,W.width,W.height])})(w,S,I,B):w.renderPass==="translucent"&&(function(W,Q){const et=W.context,st=et.gl;et.setColorMode(W.colorModeForRenderPass());const ut=Q.heatmapFbos.get(c.c7);ut&&(et.activeTexture.set(st.TEXTURE0),st.bindTexture(st.TEXTURE_2D,ut.colorAttachment.get()),et.activeTexture.set(st.TEXTURE1),Cl(et,Q).bind(st.LINEAR,st.CLAMP_TO_EDGE),W.useProgram("heatmapTexture").draw(et,st.TRIANGLES,Be.disabled,Ne.disabled,W.colorModeForRenderPass(),je.disabled,Xh(W,Q,0,1),null,null,Q.id,W.viewportBuffer,W.quadTriangleIndexBuffer,W.viewportSegments,Q.paint,W.transform.zoom))})(w,I)})(s,u,_,m,v):c.cj(_)?(function(w,S,I,B,D){if(w.renderPass!=="translucent")return;const{isRenderingToTexture:U}=D,k=I.paint.get("line-opacity"),j=I.paint.get("line-width");if(k.constantOr(1)===0||j.constantOr(1)===0)return;const W=w.getDepthModeForSublayer(0,Be.ReadOnly),Q=w.colorModeForRenderPass(),et=I.paint.get("line-dasharray"),st=et.constantOr(1),ut=I.paint.get("line-pattern"),_t=ut.constantOr(1),lt=I.paint.get("line-gradient"),gt=I.getCrossfadeParameters();let mt;mt=_t?"linePattern":st&&lt?"lineGradientSDF":st?"lineSDF":lt?"lineGradient":"line";const dt=w.context,wt=dt.gl,Ft=w.transform;let Mt=!0;for(const Rt of B){const Ot=S.getTile(Rt);if(_t&&!Ot.patternsLoaded())continue;const qt=Ot.getBucket(I);if(!qt)continue;const Zt=qt.programConfigurations.get(I.id),Gt=w.context.program.get(),he=w.useProgram(mt,Zt),pe=Mt||he.program!==Gt,qe=w.style.map.terrain&&w.style.map.terrain.getTerrainData(Rt),xr=ut.constantOr(null),pr=et&&et.constantOr(null);if(xr&&Ot.imageAtlas){const ui=Ot.imageAtlas,Vr=ui.patternPositions[xr.to.toString()],Qr=ui.patternPositions[xr.from.toString()];Vr&&Qr&&Zt.setConstantPatternPositions(Vr,Qr)}else if(pr){const ui=I.layout.get("line-cap")==="round",Vr=w.lineAtlas.getDash(pr.to,ui),Qr=w.lineAtlas.getDash(pr.from,ui);Zt.setConstantDashPositions(Vr,Qr)}const Cr=Ft.getProjectionData({overscaledTileID:Rt,applyGlobeMatrix:!U,applyTerrainMatrix:!0}),ar=Ft.getPixelScale();let Jr;_t?(Jr=e0(w,Ot,I,ar,gt),Xp(dt,wt,Ot,Zt,gt)):st&&lt?(Jr=Op(w,Ot,I,ar,gt,qt.lineClipsArray.length),ad(w,S,dt,wt,I,qt,Rt,Zt,gt)):st?(Jr=r0(w,Ot,I,ar,gt),qp(w,dt,wt,Zt,pe,gt)):lt?(Jr=xl(w,Ot,I,ar,qt.lineClipsArray.length),fu(w,S,dt,wt,I,qt,Rt)):Jr=Zc(w,Ot,I,ar);const lr=w.stencilModeForClipping(Rt);he.draw(dt,wt.TRIANGLES,W,lr,Q,je.disabled,Jr,qe,Cr,I.id,qt.layoutVertexBuffer,qt.indexBuffer,qt.segments,I.paint,w.transform.zoom,Zt,qt.layoutVertexBuffer2),Mt=!1}})(s,u,_,m,v):c.ck(_)?(function(w,S,I,B,D){const U=I.paint.get("fill-color"),k=I.paint.get("fill-opacity");if(k.constantOr(1)===0)return;const{isRenderingToTexture:j}=D,W=w.colorModeForRenderPass(),Q=I.paint.get("fill-pattern"),et=w.opaquePassEnabledForLayer()&&!Q.constantOr(1)&&U.constantOr(c.bj.transparent).a===1&&k.constantOr(0)===1?"opaque":"translucent";if(w.renderPass===et){const st=w.getDepthModeForSublayer(1,w.renderPass==="opaque"?Be.ReadWrite:Be.ReadOnly);ld(w,S,I,B,st,W,!1,j)}if(w.renderPass==="translucent"&&I.paint.get("fill-antialias")){const st=w.getDepthModeForSublayer(I.getPaintProperty("fill-outline-color")?2:0,Be.ReadOnly);ld(w,S,I,B,st,W,!0,j)}})(s,u,_,m,v):c.cl(_)?(function(w,S,I,B,D){const U=I.paint.get("fill-extrusion-opacity");if(U===0)return;const{isRenderingToTexture:k}=D;if(w.renderPass==="translucent"){const j=new Be(w.context.gl.LEQUAL,Be.ReadWrite,w.depthRangeFor3D);if(U!==1||I.paint.get("fill-extrusion-pattern").constantOr(1))Pr(w,S,I,B,j,Ne.disabled,vr.disabled,k),Pr(w,S,I,B,j,w.stencilModeFor3D(),w.colorModeForRenderPass(),k);else{const W=w.colorModeForRenderPass();Pr(w,S,I,B,j,Ne.disabled,W,k)}}})(s,u,_,m,v):c.cm(_)?(function(w,S,I,B,D){if(w.renderPass!=="offscreen"&&w.renderPass!=="translucent")return;const{isRenderingToTexture:U}=D,k=w.context,j=w.style.projection.useSubdivision,W=w.getDepthModeForSublayer(0,Be.ReadOnly),Q=w.colorModeForRenderPass();if(w.renderPass==="offscreen")(function(et,st,ut,_t,lt,gt,mt){const dt=et.context,wt=dt.gl;for(const Ft of ut){const Mt=st.getTile(Ft),Rt=Mt.dem;if(!Rt||!Rt.data||!Mt.needsHillshadePrepare)continue;const Ot=Rt.dim,qt=Rt.stride,Zt=Rt.getPixels();if(dt.activeTexture.set(wt.TEXTURE1),dt.pixelStoreUnpackPremultiplyAlpha.set(!1),Mt.demTexture=Mt.demTexture||et.getTileTexture(qt),Mt.demTexture){const he=Mt.demTexture;he.update(Zt,{premultiply:!1}),he.bind(wt.NEAREST,wt.CLAMP_TO_EDGE)}else Mt.demTexture=new c.T(dt,Zt,wt.RGBA,{premultiply:!1}),Mt.demTexture.bind(wt.NEAREST,wt.CLAMP_TO_EDGE);dt.activeTexture.set(wt.TEXTURE0);let Gt=Mt.fbo;if(!Gt){const he=new c.T(dt,{width:Ot,height:Ot,data:null},wt.RGBA);he.bind(wt.LINEAR,wt.CLAMP_TO_EDGE),Gt=Mt.fbo=dt.createFramebuffer(Ot,Ot,!0,!1),Gt.colorAttachment.set(he.texture)}dt.bindFramebuffer.set(Gt.framebuffer),dt.viewport.set([0,0,Ot,Ot]),et.useProgram("hillshadePrepare").draw(dt,wt.TRIANGLES,lt,gt,mt,je.disabled,Dp(Mt.tileID,Rt),null,null,_t.id,et.rasterBoundsBuffer,et.quadTriangleIndexBuffer,et.rasterBoundsSegments),Mt.needsHillshadePrepare=!1}})(w,S,B,I,W,Ne.disabled,Q),k.viewport.set([0,0,w.width,w.height]);else if(w.renderPass==="translucent")if(j){const[et,st,ut]=w.stencilConfigForOverlapTwoPass(B);kn(w,S,I,ut,et,W,Q,!1,U),kn(w,S,I,ut,st,W,Q,!0,U)}else{const[et,st]=w.getStencilConfigForOverlapAndUpdateStencilID(B);kn(w,S,I,st,et,W,Q,!1,U)}})(s,u,_,m,v):c.cn(_)?(function(w,S,I,B,D){if(w.renderPass!=="translucent"||!B.length)return;const{isRenderingToTexture:U}=D,k=w.style.projection.useSubdivision,j=w.getDepthModeForSublayer(0,Be.ReadOnly),W=w.colorModeForRenderPass();if(k){const[Q,et,st]=w.stencilConfigForOverlapTwoPass(B);is(w,S,I,st,Q,j,W,!1,U),is(w,S,I,st,et,j,W,!0,U)}else{const[Q,et]=w.getStencilConfigForOverlapAndUpdateStencilID(B);is(w,S,I,et,Q,j,W,!1,U)}})(s,u,_,m,v):c.bO(_)?(function(w,S,I,B,D){if(w.renderPass!=="translucent"||I.paint.get("raster-opacity")===0||!B.length)return;const{isRenderingToTexture:U}=D,k=S.getSource(),j=w.style.projection.useSubdivision;if(k instanceof Bi)zo(w,S,I,B,null,!1,!1,k.tileCoords,k.flippedWindingOrder,U);else if(j){const[W,Q,et]=w.stencilConfigForOverlapTwoPass(B);zo(w,S,I,et,W,!1,!0,Il,!1,U),zo(w,S,I,et,Q,!0,!0,Il,!1,U)}else{const[W,Q]=w.getStencilConfigForOverlapAndUpdateStencilID(B);zo(w,S,I,Q,W,!1,!0,Il,!1,U)}})(s,u,_,m,v):c.co(_)?(function(w,S,I,B,D){const U=I.paint.get("background-color"),k=I.paint.get("background-opacity");if(k===0)return;const{isRenderingToTexture:j}=D,W=w.context,Q=W.gl,et=w.style.projection,st=w.transform,ut=st.tileSize,_t=I.paint.get("background-pattern");if(w.isPatternMissing(_t))return;const lt=!_t&&U.a===1&&k===1&&w.opaquePassEnabledForLayer()?"opaque":"translucent";if(w.renderPass!==lt)return;const gt=Ne.disabled,mt=w.getDepthModeForSublayer(0,lt==="opaque"?Be.ReadWrite:Be.ReadOnly),dt=w.colorModeForRenderPass(),wt=w.useProgram(_t?"backgroundPattern":"background"),Ft=B||Ee(st,{tileSize:ut,terrain:w.style.map.terrain});_t&&(W.activeTexture.set(Q.TEXTURE0),w.imageManager.bind(w.context));const Mt=I.getCrossfadeParameters();for(const Rt of Ft){const Ot=st.getProjectionData({overscaledTileID:Rt,applyGlobeMatrix:!j,applyTerrainMatrix:!0}),qt=_t?Jh(k,w,_t,{tileID:Rt,tileSize:ut},Mt):Kh(k,U),Zt=w.style.map.terrain&&w.style.map.terrain.getTerrainData(Rt),Gt=et.getMeshFromTileID(W,Rt.canonical,!1,!0,"raster");wt.draw(W,Q.TRIANGLES,mt,gt,dt,je.backCCW,qt,Zt,Ot,I.id,Gt.vertexBuffer,Gt.indexBuffer,Gt.segments)}})(s,0,_,m,v):c.cp(_)&&(function(w,S,I,B){const{isRenderingGlobe:D}=B,U=w.context,k=I.implementation,j=w.style.projection,W=w.transform,Q=W.getProjectionDataForCustomLayer(D),et={farZ:W.farZ,nearZ:W.nearZ,fov:W.fov*Math.PI/180,modelViewProjectionMatrix:W.modelViewProjectionMatrix,projectionMatrix:W.projectionMatrix,shaderData:{variantName:j.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;
uniform mat4 u_projection_matrix;
${j.shaderPreludeCode.vertexSource}`,define:j.shaderDefine},defaultProjectionData:Q},st=k.renderingMode?k.renderingMode:"2d";if(w.renderPass==="offscreen"){const ut=k.prerender;ut&&(w.setCustomLayerDefaults(),U.setColorMode(w.colorModeForRenderPass()),ut.call(k,U.gl,et),U.setDirty(),w.setBaseState())}else if(w.renderPass==="translucent"){w.setCustomLayerDefaults(),U.setColorMode(w.colorModeForRenderPass()),U.setStencilMode(Ne.disabled);const ut=st==="3d"?w.getDepthModeFor3D():w.getDepthModeForSublayer(0,Be.ReadOnly);U.setDepthMode(ut),k.render(U.gl,et),U.setDirty(),w.setBaseState(),U.bindFramebuffer.set(null)}})(s,0,_,v))}saveTileTexture(s){const u=this._tileTextures[s.size[0]];u?u.push(s):this._tileTextures[s.size[0]]=[s]}getTileTexture(s){const u=this._tileTextures[s];return u&&u.length>0?u.pop():null}isPatternMissing(s){if(!s)return!1;if(!s.from||!s.to)return!0;const u=this.imageManager.getPattern(s.from.toString()),_=this.imageManager.getPattern(s.to.toString());return!u||!_}useProgram(s,u,_=!1,m=[]){this.cache=this.cache||{};const v=!!this.style.map.terrain,w=this.style.projection,S=_?nr.projectionMercator:w.shaderPreludeCode,I=_?Oi:w.shaderDefine,B=s+(u?u.cacheKey:"")+`/${_?ki:w.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(v?"/terrain":"")+(m?`/${m.join("/")}`:"");return this.cache[B]||(this.cache[B]=new Qy(this.context,nr[s],u,td[s],this._showOverdrawInspector,v,S,I,m)),this.cache[B]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const s=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(s.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new c.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){var s,u;if(this._tileTextures){for(const _ in this._tileTextures){const m=this._tileTextures[_];if(m)for(const v of m)v.destroy()}this._tileTextures={}}if(this.tileExtentBuffer&&this.tileExtentBuffer.destroy(),this.debugBuffer&&this.debugBuffer.destroy(),this.rasterBoundsBuffer&&this.rasterBoundsBuffer.destroy(),this.rasterBoundsBufferPosOnly&&this.rasterBoundsBufferPosOnly.destroy(),this.viewportBuffer&&this.viewportBuffer.destroy(),this.tileBorderIndexBuffer&&this.tileBorderIndexBuffer.destroy(),this.quadTriangleIndexBuffer&&this.quadTriangleIndexBuffer.destroy(),this.tileExtentMesh&&((s=this.tileExtentMesh.vertexBuffer)===null||s===void 0||s.destroy()),this.tileExtentMesh&&((u=this.tileExtentMesh.indexBuffer)===null||u===void 0||u.destroy()),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.cache){for(const _ in this.cache){const m=this.cache[_];m&&m.program&&this.context.gl.deleteProgram(m.program)}this.cache={}}this.context&&this.context.setDefault()}overLimit(){const{drawingBufferWidth:s,drawingBufferHeight:u}=this.context.gl;return this.width!==s||this.height!==u}}function pd(b,s){let u,_=!1,m=null,v=null;const w=()=>{m=null,_&&(b.apply(v,u),m=setTimeout(w,s),_=!1)};return(...S)=>(_=!0,v=this,u=S,m||w(),m)}class _d{constructor(s){this._getCurrentHash=()=>{const u=window.location.hash.replace("#","");if(this._hashName){let _;return u.split("&").map((m=>m.split("="))).forEach((m=>{m[0]===this._hashName&&(_=m)})),(_&&_[1]||"").split("/")}return u.split("/")},this._onHashChange=()=>{const u=this._getCurrentHash();if(!this._isValidHash(u))return!1;const _=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(u[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+u[2],+u[1]],zoom:+u[0],bearing:_,pitch:+(u[4]||0)}),!0},this._updateHashUnthrottled=()=>{const u=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,u)},this._removeHash=()=>{const u=this._getCurrentHash();if(u.length===0)return;const _=u.join("/");let m=_;m.split("&").length>0&&(m=m.split("&")[0]),this._hashName&&(m=`${this._hashName}=${_}`);let v=window.location.hash.replace(m,"");v.startsWith("#&")?v=v.slice(0,1)+v.slice(2):v==="#"&&(v="");let w=window.location.href.replace(/(#.+)?$/,v);w=w.replace("&&","&"),window.history.replaceState(window.history.state,null,w)},this._updateHash=pd(this._updateHashUnthrottled,300),this._hashName=s&&encodeURIComponent(s)}addTo(s){return this._map=s,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(s){const u=this._map.getCenter(),_=Math.round(100*this._map.getZoom())/100,m=Math.ceil((_*Math.LN2+Math.log(512/360/.5))/Math.LN10),v=Math.pow(10,m),w=Math.round(u.lng*v)/v,S=Math.round(u.lat*v)/v,I=this._map.getBearing(),B=this._map.getPitch();let D="";if(D+=s?`/${w}/${S}/${_}`:`${_}/${S}/${w}`,(I||B)&&(D+="/"+Math.round(10*I)/10),B&&(D+=`/${Math.round(B)}`),this._hashName){const U=this._hashName;let k=!1;const j=window.location.hash.slice(1).split("&").map((W=>{const Q=W.split("=")[0];return Q===U?(k=!0,`${Q}=${D}`):W})).filter((W=>W));return k||j.push(`${U}=${D}`),`#${j.join("&")}`}return`#${D}`}_isValidHash(s){if(s.length<3||s.some(isNaN))return!1;try{new c.U(+s[2],+s[1])}catch{return!1}const u=+s[0],_=+(s[3]||0),m=+(s[4]||0);return u>=this._map.getMinZoom()&&u<=this._map.getMaxZoom()&&_>=-180&&_<=180&&m>=this._map.getMinPitch()&&m<=this._map.getMaxPitch()}}const Fa={linearity:.3,easing:c.cq(0,0,.3,1)},t_=c.e({deceleration:2500,maxSpeed:1400},Fa),e_=c.e({deceleration:20,maxSpeed:1400},Fa),r_=c.e({deceleration:1e3,maxSpeed:360},Fa),pu=c.e({deceleration:1e3,maxSpeed:90},Fa),i_=c.e({deceleration:1e3,maxSpeed:360},Fa);class As{constructor(s){this._map=s,this.clear()}clear(){this._inertiaBuffer=[]}record(s){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:nt(),settings:s})}_drainInertiaBuffer(){const s=this._inertiaBuffer,u=nt();for(;s.length>0&&u-s[0].time>160;)s.shift()}_onMoveEnd(s){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const u={zoom:0,bearing:0,pitch:0,roll:0,pan:new c.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:v}of this._inertiaBuffer)u.zoom+=v.zoomDelta||0,u.bearing+=v.bearingDelta||0,u.pitch+=v.pitchDelta||0,u.roll+=v.rollDelta||0,v.panDelta&&u.pan._add(v.panDelta),v.around&&(u.around=v.around),v.pinchAround&&(u.pinchAround=v.pinchAround);const _=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,m={};if(u.pan.mag()){const v=Oa(u.pan.mag(),_,c.e({},t_,s||{})),w=u.pan.mult(v.amount/u.pan.mag()),S=this._map.cameraHelper.handlePanInertia(w,this._map.transform);m.center=S.easingCenter,m.offset=S.easingOffset,Wi(m,v)}if(u.zoom){const v=Oa(u.zoom,_,e_);m.zoom=this._map.transform.zoom+v.amount,Wi(m,v)}if(u.bearing){const v=Oa(u.bearing,_,r_);m.bearing=this._map.transform.bearing+c.ai(v.amount,-179,179),Wi(m,v)}if(u.pitch){const v=Oa(u.pitch,_,pu);m.pitch=this._map.transform.pitch+v.amount,Wi(m,v)}if(u.roll){const v=Oa(u.roll,_,i_);m.roll=this._map.transform.roll+c.ai(v.amount,-179,179),Wi(m,v)}if(m.zoom||m.bearing){const v=u.pinchAround===void 0?u.around:u.pinchAround;m.around=v?this._map.unproject(v):this._map.getCenter()}return this.clear(),c.e(m,{noMoveStart:!0})}}function Wi(b,s){(!b.duration||b.duration<s.duration)&&(b.duration=s.duration,b.easing=s.easing)}function Oa(b,s,u){const{maxSpeed:_,linearity:m,deceleration:v}=u,w=c.ai(b*m/(s/1e3),-_,_),S=Math.abs(w)/(v*m);return{easing:u.easing,duration:1e3*S,amount:w*(S/2)}}class Nr extends c.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,u,_,m={}){_=_ instanceof MouseEvent?_:new MouseEvent(s,_);const v=K.mousePos(u.getCanvas(),_),w=u.unproject(v);super(s,c.e({point:v,lngLat:w,originalEvent:_},m)),this._defaultPrevented=!1,this.target=u}}class Pl extends c.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,u,_){const m=s==="touchend"?_.changedTouches:_.touches,v=K.touchPos(u.getCanvasContainer(),m),w=v.map((I=>u.unproject(I))),S=v.reduce(((I,B,D,U)=>I.add(B.div(U.length))),new c.P(0,0));super(s,{points:v,point:S,lngLats:w,lngLat:u.unproject(S),originalEvent:_}),this._defaultPrevented=!1}}class Vo extends c.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,u,_){super(s,{originalEvent:_}),this._defaultPrevented=!1}}class h0{constructor(s,u){this._map=s,this._clickTolerance=u.clickTolerance}reset(){delete this._mousedownPos}wheel(s){return this._firePreventable(new Vo(s.type,this._map,s))}mousedown(s,u){return this._mousedownPos=u,this._firePreventable(new Nr(s.type,this._map,s))}mouseup(s){this._map.fire(new Nr(s.type,this._map,s))}click(s,u){this._mousedownPos&&this._mousedownPos.dist(u)>=this._clickTolerance||this._map.fire(new Nr(s.type,this._map,s))}dblclick(s){return this._firePreventable(new Nr(s.type,this._map,s))}mouseover(s){this._map.fire(new Nr(s.type,this._map,s))}mouseout(s){this._map.fire(new Nr(s.type,this._map,s))}touchstart(s){return this._firePreventable(new Pl(s.type,this._map,s))}touchmove(s){this._map.fire(new Pl(s.type,this._map,s))}touchend(s){this._map.fire(new Pl(s.type,this._map,s))}touchcancel(s){this._map.fire(new Pl(s.type,this._map,s))}_firePreventable(s){if(this._map.fire(s),s.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class d0{constructor(s){this._map=s}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(s){this._map.fire(new Nr(s.type,this._map,s))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Nr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(s){this._delayContextMenu?this._contextMenuEvent=s:this._ignoreContextMenu||this._map.fire(new Nr(s.type,this._map,s)),this._map.listens("contextmenu")&&s.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Bl{constructor(s){this._map=s}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(s){return this.transform.screenPointToLocation(c.P.convert(s),this._map.terrain)}}class s_{constructor(s,u){this._map=s,this._tr=new Bl(s),this._el=s.getCanvasContainer(),this._container=s.getContainer(),this._clickTolerance=u.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(s,u){this.isEnabled()&&s.shiftKey&&s.button===0&&(K.disableDrag(),this._startPos=this._lastPos=u,this._active=!0)}mousemoveWindow(s,u){if(!this._active)return;const _=u;if(this._lastPos.equals(_)||!this._box&&_.dist(this._startPos)<this._clickTolerance)return;const m=this._startPos;this._lastPos=_,this._box||(this._box=K.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",s));const v=Math.min(m.x,_.x),w=Math.max(m.x,_.x),S=Math.min(m.y,_.y),I=Math.max(m.y,_.y);K.setTransform(this._box,`translate(${v}px,${S}px)`),this._box.style.width=w-v+"px",this._box.style.height=I-S+"px"}mouseupWindow(s,u){if(!this._active||s.button!==0)return;const _=this._startPos,m=u;if(this.reset(),K.suppressClick(),_.x!==m.x||_.y!==m.y)return this._map.fire(new c.l("boxzoomend",{originalEvent:s})),{cameraAnimation:v=>v.fitScreenCoordinates(_,m,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",s)}keydown(s){this._active&&s.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",s))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(K.remove(this._box),this._box=null),K.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(s,u){return this._map.fire(new c.l(s,{originalEvent:u}))}}function _u(b,s){if(b.length!==s.length)throw new Error(`The number of touches and points are not equal - touches ${b.length}, points ${s.length}`);const u={};for(let _=0;_<b.length;_++)u[b[_].identifier]=s[_];return u}class Dl{constructor(s){this.reset(),this.numTouches=s.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(s,u,_){(this.centroid||_.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=s.timeStamp),_.length===this.numTouches&&(this.centroid=(function(m){const v=new c.P(0,0);for(const w of m)v._add(w);return v.div(m.length)})(u),this.touches=_u(_,u)))}touchmove(s,u,_){if(this.aborted||!this.centroid)return;const m=_u(_,u);for(const v in this.touches){const w=m[v];(!w||w.dist(this.touches[v])>30)&&(this.aborted=!0)}}touchend(s,u,_){if((!this.centroid||s.timeStamp-this.startTime>500)&&(this.aborted=!0),_.length===0){const m=!this.aborted&&this.centroid;if(this.reset(),m)return m}}}class Ys{constructor(s){this.singleTap=new Dl(s),this.numTaps=s.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(s,u,_){this.singleTap.touchstart(s,u,_)}touchmove(s,u,_){this.singleTap.touchmove(s,u,_)}touchend(s,u,_){const m=this.singleTap.touchend(s,u,_);if(m){const v=s.timeStamp-this.lastTime<500,w=!this.lastTap||this.lastTap.dist(m)<30;if(v&&w||this.reset(),this.count++,this.lastTime=s.timeStamp,this.lastTap=m,this.count===this.numTaps)return this.reset(),m}}}class oe{constructor(s){this._tr=new Bl(s),this._zoomIn=new Ys({numTouches:1,numTaps:2}),this._zoomOut=new Ys({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(s,u,_){this._zoomIn.touchstart(s,u,_),this._zoomOut.touchstart(s,u,_)}touchmove(s,u,_){this._zoomIn.touchmove(s,u,_),this._zoomOut.touchmove(s,u,_)}touchend(s,u,_){const m=this._zoomIn.touchend(s,u,_),v=this._zoomOut.touchend(s,u,_),w=this._tr;return m?(this._active=!0,s.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:w.zoom+1,around:w.unproject(m)},{originalEvent:s})}):v?(this._active=!0,s.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:w.zoom-1,around:w.unproject(v)},{originalEvent:s})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ka{constructor(s){this._enabled=!!s.enable,this._moveStateManager=s.moveStateManager,this._clickTolerance=s.clickTolerance||1,this._moveFunction=s.move,this._activateOnStart=!!s.activateOnStart,s.assignEvents(this),this.reset()}reset(s){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(s)}_move(...s){const u=this._moveFunction(...s);if(u.bearingDelta||u.pitchDelta||u.rollDelta||u.around||u.panDelta)return this._active=!0,u}dragStart(s,u){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(s)&&(this._moveStateManager.startMove(s),this._lastPoint=Array.isArray(u)?u[0]:u,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(s,u){if(!this.isEnabled())return;const _=this._lastPoint;if(!_)return;if(s.preventDefault(),!this._moveStateManager.isValidMoveEvent(s))return void this.reset(s);const m=Array.isArray(u)?u[0]:u;return!this._moved&&m.dist(_)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=m,this._move(_,m))}dragEnd(s){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(s)&&(this._moved&&K.suppressClick(),this.reset(s))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const gd=0,n_=2,Fl={[gd]:1,[n_]:2};class Nn{constructor(s){this._correctEvent=s.checkCorrectEvent}startMove(s){const u=K.mouseButton(s);this._eventButton=u}endMove(s){delete this._eventButton}isValidStartEvent(s){return this._correctEvent(s)}isValidMoveEvent(s){return!(function(u,_){const m=Fl[_];return u.buttons===void 0||(u.buttons&m)!==m})(s,this._eventButton)}isValidEndEvent(s){return K.mouseButton(s)===this._eventButton}}class md{constructor(){this._firstTouch=void 0}_isOneFingerTouch(s){return s.targetTouches.length===1}_isSameTouchEvent(s){return s.targetTouches[0].identifier===this._firstTouch}startMove(s){this._firstTouch=s.targetTouches[0].identifier}endMove(s){delete this._firstTouch}isValidStartEvent(s){return this._isOneFingerTouch(s)}isValidMoveEvent(s){return this._isOneFingerTouch(s)&&this._isSameTouchEvent(s)}isValidEndEvent(s){return this._isOneFingerTouch(s)&&this._isSameTouchEvent(s)}}class f0{constructor(s=new Nn({checkCorrectEvent:()=>!0}),u=new md){this.mouseMoveStateManager=s,this.oneFingerTouchMoveStateManager=u}_executeRelevantHandler(s,u,_){return s instanceof MouseEvent?u(s):typeof TouchEvent<"u"&&s instanceof TouchEvent?_(s):void 0}startMove(s){this._executeRelevantHandler(s,(u=>this.mouseMoveStateManager.startMove(u)),(u=>this.oneFingerTouchMoveStateManager.startMove(u)))}endMove(s){this._executeRelevantHandler(s,(u=>this.mouseMoveStateManager.endMove(u)),(u=>this.oneFingerTouchMoveStateManager.endMove(u)))}isValidStartEvent(s){return this._executeRelevantHandler(s,(u=>this.mouseMoveStateManager.isValidStartEvent(u)),(u=>this.oneFingerTouchMoveStateManager.isValidStartEvent(u)))}isValidMoveEvent(s){return this._executeRelevantHandler(s,(u=>this.mouseMoveStateManager.isValidMoveEvent(u)),(u=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(u)))}isValidEndEvent(s){return this._executeRelevantHandler(s,(u=>this.mouseMoveStateManager.isValidEndEvent(u)),(u=>this.oneFingerTouchMoveStateManager.isValidEndEvent(u)))}}const Na=b=>{b.mousedown=b.dragStart,b.mousemoveWindow=b.dragMove,b.mouseup=b.dragEnd,b.contextmenu=s=>{s.preventDefault()}};class yd{constructor(s,u){this._clickTolerance=s.clickTolerance||1,this._map=u,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new c.P(0,0)}_shouldBePrevented(s){return s<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(s,u,_){return this._calculateTransform(s,u,_)}touchmove(s,u,_){if(this._active){if(!this._shouldBePrevented(_.length))return s.preventDefault(),this._calculateTransform(s,u,_);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",s)}}touchend(s,u,_){this._calculateTransform(s,u,_),this._active&&this._shouldBePrevented(_.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(s,u,_){_.length>0&&(this._active=!0);const m=_u(_,u),v=new c.P(0,0),w=new c.P(0,0);let S=0;for(const B in m){const D=m[B],U=this._touches[B];U&&(v._add(D),w._add(D.sub(U)),S++,m[B]=D)}if(this._touches=m,this._shouldBePrevented(S)||!w.mag())return;const I=w.div(S);return this._sum._add(I),this._sum.mag()<this._clickTolerance?void 0:{around:v.div(S),panDelta:I}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class bd{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(s,u,_){this._firstTwoTouches||_.length<2||(this._firstTwoTouches=[_[0].identifier,_[1].identifier],this._start([u[0],u[1]]))}touchmove(s,u,_){if(!this._firstTwoTouches)return;s.preventDefault();const[m,v]=this._firstTwoTouches,w=Ol(_,u,m),S=Ol(_,u,v);if(!w||!S)return;const I=this._aroundCenter?null:w.add(S).div(2);return this._move([w,S],I,s)}touchend(s,u,_){if(!this._firstTwoTouches)return;const[m,v]=this._firstTwoTouches,w=Ol(_,u,m),S=Ol(_,u,v);w&&S||(this._active&&K.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(s){this._enabled=!0,this._aroundCenter=!!s&&s.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Ol(b,s,u){for(let _=0;_<b.length;_++)if(b[_].identifier===u)return s[_]}function o_(b,s){return Math.log(b/s)/Math.LN2}class a_ extends bd{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(s){this._startDistance=this._distance=s[0].dist(s[1])}_move(s,u){const _=this._distance;if(this._distance=s[0].dist(s[1]),this._active||!(Math.abs(o_(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:o_(this._distance,_),pinchAround:u}}}function vd(b,s){return 180*b.angleWith(s)/Math.PI}class l_ extends bd{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(s){this._startVector=this._vector=s[0].sub(s[1]),this._minDiameter=s[0].dist(s[1])}_move(s,u,_){const m=this._vector;if(this._vector=s[0].sub(s[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:vd(this._vector,m),pinchAround:u}}_isBelowThreshold(s){this._minDiameter=Math.min(this._minDiameter,s.mag());const u=25/(Math.PI*this._minDiameter)*360,_=vd(s,this._startVector);return Math.abs(_)<u}}function gu(b){return Math.abs(b.y)>Math.abs(b.x)}class c_ extends bd{constructor(s){super(),this._currentTouchCount=0,this._map=s}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(s,u,_){super.touchstart(s,u,_),this._currentTouchCount=_.length}_start(s){this._lastPoints=s,gu(s[0].sub(s[1]))&&(this._valid=!1)}_move(s,u,_){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const m=s[0].sub(this._lastPoints[0]),v=s[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(m,v,_.timeStamp),this._valid?(this._lastPoints=s,this._active=!0,{pitchDelta:(m.y+v.y)/2*-.5}):void 0}gestureBeginsVertically(s,u,_){if(this._valid!==void 0)return this._valid;const m=s.mag()>=2,v=u.mag()>=2;if(!m&&!v)return;if(!m||!v)return this._firstMove===void 0&&(this._firstMove=_),_-this._firstMove<100&&void 0;const w=s.y>0==u.y>0;return gu(s)&&gu(u)&&w}}const p0={panStep:100,bearingStep:15,pitchStep:10};class Ln{constructor(s){this._tr=new Bl(s);const u=p0;this._panStep=u.panStep,this._bearingStep=u.bearingStep,this._pitchStep=u.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(s){if(s.altKey||s.ctrlKey||s.metaKey)return;let u=0,_=0,m=0,v=0,w=0;switch(s.keyCode){case 61:case 107:case 171:case 187:u=1;break;case 189:case 109:case 173:u=-1;break;case 37:s.shiftKey?_=-1:(s.preventDefault(),v=-1);break;case 39:s.shiftKey?_=1:(s.preventDefault(),v=1);break;case 38:s.shiftKey?m=1:(s.preventDefault(),w=-1);break;case 40:s.shiftKey?m=-1:(s.preventDefault(),w=1);break;default:return}return this._rotationDisabled&&(_=0,m=0),{cameraAnimation:S=>{const I=this._tr;S.easeTo({duration:300,easeId:"keyboardHandler",easing:or,zoom:u?Math.round(I.zoom)+u*(s.shiftKey?2:1):I.zoom,bearing:I.bearing+_*this._bearingStep,pitch:I.pitch+m*this._pitchStep,offset:[-v*this._panStep,-w*this._panStep],center:I.center},{originalEvent:s})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function or(b){return b*(2-b)}const u_=4.000244140625,mu=1/450;class yu{constructor(s,u){this._onTimeout=_=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(_)},this._map=s,this._tr=new Bl(s),this._triggerRenderFrame=u,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=mu}setZoomRate(s){this._defaultZoomRate=s}setWheelZoomRate(s){this._wheelZoomRate=s}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(s){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!s&&s.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(s){return!!this._map.cooperativeGestures.isEnabled()&&!(s.ctrlKey||this._map.cooperativeGestures.isBypassed(s))}wheel(s){if(!this.isEnabled())return;if(this._shouldBePrevented(s))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",s);let u=s.deltaMode===WheelEvent.DOM_DELTA_LINE?40*s.deltaY:s.deltaY;const _=nt(),m=_-(this._lastWheelEventTime||0);this._lastWheelEventTime=_,u!==0&&u%u_==0?this._type="wheel":u!==0&&Math.abs(u)<4?this._type="trackpad":m>400?(this._type=null,this._lastValue=u,this._timeout=setTimeout(this._onTimeout,40,s)):this._type||(this._type=Math.abs(m*u)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,u+=this._lastValue)),s.shiftKey&&u&&(u/=4),this._type&&(this._lastWheelEvent=s,this._delta-=u,this._active||this._start(s)),s.preventDefault()}_start(s){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const u=K.mousePos(this._map.getCanvas(),s),_=this._tr;this._aroundPoint=this._aroundCenter?_.transform.locationToScreenPoint(c.U.convert(_.center)):u,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const s=this._tr.transform;if(typeof this._lastExpectedZoom=="number"){const S=s.zoom-this._lastExpectedZoom;typeof this._startZoom=="number"&&(this._startZoom+=S),typeof this._targetZoom=="number"&&(this._targetZoom+=S)}if(this._delta!==0){const S=this._type==="wheel"&&Math.abs(this._delta)>u_?this._wheelZoomRate:this._defaultZoomRate;let I=2/(1+Math.exp(-Math.abs(this._delta*S)));this._delta<0&&I!==0&&(I=1/I);const B=typeof this._targetZoom!="number"?s.scale:c.al(this._targetZoom);this._targetZoom=s.applyConstrain(s.getCameraLngLat(),c.ao(B*I)).zoom,this._type==="wheel"&&(this._startZoom=s.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const u=typeof this._targetZoom!="number"?s.zoom:this._targetZoom,_=this._startZoom,m=this._easing;let v,w=!1;if(this._type==="wheel"&&_&&m){const S=nt()-this._lastWheelEventTime,I=Math.min((S+5)/200,1),B=m(I);v=c.F.number(_,u,B),I<1?this._frameId||(this._frameId=!0):w=!0}else v=u,w=!0;return this._active=!0,w&&(this._active=!1,this._finishTimeout=setTimeout((()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout}),200)),this._lastExpectedZoom=v,{noInertia:!0,needsRenderFrame:!w,zoomDelta:v-s.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(s){let u=c.cs;if(this._prevEase){const _=this._prevEase,m=(nt()-_.start)/_.duration,v=_.easing(m+.01)-_.easing(m),w=.27/Math.sqrt(v*v+1e-4)*.01,S=Math.sqrt(.0729-w*w);u=c.cq(w,S,.25,1)}return this._prevEase={start:nt(),duration:s,easing:u},u}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class xd{constructor(s,u){this._clickZoom=s,this._tapZoom=u}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class h_{constructor(s){this._tr=new Bl(s),this.reset()}reset(){this._active=!1}dblclick(s,u){return s.preventDefault(),{cameraAnimation:_=>{_.easeTo({duration:300,zoom:this._tr.zoom+(s.shiftKey?-1:1),around:this._tr.unproject(u)},{originalEvent:s})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class d_{constructor(){this._tap=new Ys({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(s,u,_){if(!this._swipePoint)if(this._tapTime){const m=u[0],v=s.timeStamp-this._tapTime<500,w=this._tapPoint.dist(m)<30;v&&w?_.length>0&&(this._swipePoint=m,this._swipeTouch=_[0].identifier):this.reset()}else this._tap.touchstart(s,u,_)}touchmove(s,u,_){if(this._tapTime){if(this._swipePoint){if(_[0].identifier!==this._swipeTouch)return;const m=u[0],v=m.y-this._swipePoint.y;return this._swipePoint=m,s.preventDefault(),this._active=!0,{zoomDelta:v/128}}}else this._tap.touchmove(s,u,_)}touchend(s,u,_){if(this._tapTime)this._swipePoint&&_.length===0&&this.reset();else{const m=this._tap.touchend(s,u,_);m&&(this._tapTime=s.timeStamp,this._tapPoint=m)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class f_{constructor(s,u,_){this._el=s,this._mousePan=u,this._touchPan=_}enable(s){this._inertiaOptions=s||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Ks{constructor(s,u,_,m){this._pitchWithRotate=s.pitchWithRotate,this._rollEnabled=s.rollEnabled,this._mouseRotate=u,this._mousePitch=_,this._mouseRoll=m}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class kl{constructor(s,u,_,m){this._el=s,this._touchZoom=u,this._touchRotate=_,this._tapDragZoom=m,this._rotationDisabled=!1,this._enabled=!0}enable(s){this._touchZoom.enable(s),this._rotationDisabled||this._touchRotate.enable(s),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class fe{constructor(s,u){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=s,this._options=u,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const s=this._map.getCanvasContainer();s.classList.add("maplibregl-cooperative-gestures"),this._container=K.create("div","maplibregl-cooperative-gesture-screen",s);let u=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(u=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const _=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),m=document.createElement("div");m.className="maplibregl-desktop-message",m.textContent=u,this._container.appendChild(m);const v=document.createElement("div");v.className="maplibregl-mobile-message",v.textContent=_,this._container.appendChild(v),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(K.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(s){return s[this._bypassKey]}notifyGestureBlocked(s,u){this._enabled&&(this._map.fire(new c.l("cooperativegestureprevented",{gestureType:s,originalEvent:u})),this._container.classList.add("maplibregl-show"),setTimeout((()=>{this._container.classList.remove("maplibregl-show")}),100))}}const xe=b=>b.zoom||b.drag||b.roll||b.pitch||b.rotate;class Nl extends c.l{}function bu(b){return b.panDelta&&b.panDelta.mag()||b.zoomDelta||b.bearingDelta||b.pitchDelta||b.rollDelta}class vu{constructor(s,u){this.handleWindowEvent=m=>{this.handleEvent(m,`${m.type}Window`)},this.handleEvent=(m,v)=>{if(m.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const w=m.type==="renderFrame"?void 0:m,S={needsRenderFrame:!1},I={},B={};for(const{handlerName:k,handler:j,allowed:W}of this._handlers){if(!j.isEnabled())continue;let Q;if(this._blockedByActive(B,W,k))j.reset();else if(j[v||m.type]){if(c.ct(m,v||m.type)){const et=K.mousePos(this._map.getCanvas(),m);Q=j[v||m.type](m,et)}else if(c.cu(m,v||m.type)){const et=this._getMapTouches(m.touches),st=K.touchPos(this._map.getCanvas(),et);Q=j[v||m.type](m,st,et)}else c.cv(v||m.type)||(Q=j[v||m.type](m));this.mergeHandlerResult(S,I,Q,k,w),Q&&Q.needsRenderFrame&&this._triggerRenderFrame()}(Q||j.isActive())&&(B[k]=j)}const D={};for(const k in this._previousActiveHandlers)B[k]||(D[k]=w);this._previousActiveHandlers=B,(Object.keys(D).length||bu(S))&&(this._changes.push([S,I,D]),this._triggerRenderFrame()),(Object.keys(B).length||bu(S))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:U}=S;U&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],U(this._map))},this._map=s,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new As(s),this._bearingSnap=u.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(u);const _=this._el;this._listeners=[[_,"touchstart",{passive:!0}],[_,"touchmove",{passive:!1}],[_,"touchend",void 0],[_,"touchcancel",void 0],[_,"mousedown",void 0],[_,"mousemove",void 0],[_,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[_,"mouseover",void 0],[_,"mouseout",void 0],[_,"dblclick",void 0],[_,"click",void 0],[_,"keydown",{capture:!1}],[_,"keyup",void 0],[_,"wheel",{passive:!1}],[_,"contextmenu",void 0],[window,"blur",void 0]];for(const[m,v,w]of this._listeners)K.addEventListener(m,v,m===document?this.handleWindowEvent:this.handleEvent,w)}destroy(){for(const[s,u,_]of this._listeners)K.removeEventListener(s,u,s===document?this.handleWindowEvent:this.handleEvent,_)}_addDefaultHandlers(s){const u=this._map,_=u.getCanvasContainer();this._add("mapEvent",new h0(u,s));const m=u.boxZoom=new s_(u,s);this._add("boxZoom",m),s.interactive&&s.boxZoom&&m.enable();const v=u.cooperativeGestures=new fe(u,s.cooperativeGestures);this._add("cooperativeGestures",v),s.cooperativeGestures&&v.enable();const w=new oe(u),S=new h_(u);u.doubleClickZoom=new xd(S,w),this._add("tapZoom",w),this._add("clickZoom",S),s.interactive&&s.doubleClickZoom&&u.doubleClickZoom.enable();const I=new d_;this._add("tapDragZoom",I);const B=u.touchPitch=new c_(u);this._add("touchPitch",B),s.interactive&&s.touchPitch&&u.touchPitch.enable(s.touchPitch);const D=()=>u.project(u.getCenter()),U=(function({enable:lt,clickTolerance:gt,aroundCenter:mt=!0,minPixelCenterThreshold:dt=100,rotateDegreesPerPixelMoved:wt=.8},Ft){const Mt=new Nn({checkCorrectEvent:Rt=>K.mouseButton(Rt)===0&&Rt.ctrlKey||K.mouseButton(Rt)===2&&!Rt.ctrlKey});return new ka({clickTolerance:gt,move:(Rt,Ot)=>{const qt=Ft();if(mt&&Math.abs(qt.y-Rt.y)>dt)return{bearingDelta:c.cr(new c.P(Rt.x,Ot.y),Ot,qt)};let Zt=(Ot.x-Rt.x)*wt;return mt&&Ot.y<qt.y&&(Zt=-Zt),{bearingDelta:Zt}},moveStateManager:Mt,enable:lt,assignEvents:Na})})(s,D),k=(function({enable:lt,clickTolerance:gt,pitchDegreesPerPixelMoved:mt=-.5}){const dt=new Nn({checkCorrectEvent:wt=>K.mouseButton(wt)===0&&wt.ctrlKey||K.mouseButton(wt)===2});return new ka({clickTolerance:gt,move:(wt,Ft)=>({pitchDelta:(Ft.y-wt.y)*mt}),moveStateManager:dt,enable:lt,assignEvents:Na})})(s),j=(function({enable:lt,clickTolerance:gt,rollDegreesPerPixelMoved:mt=.3},dt){const wt=new Nn({checkCorrectEvent:Ft=>K.mouseButton(Ft)===2&&Ft.ctrlKey});return new ka({clickTolerance:gt,move:(Ft,Mt)=>{const Rt=dt();let Ot=(Mt.x-Ft.x)*mt;return Mt.y<Rt.y&&(Ot=-Ot),{rollDelta:Ot}},moveStateManager:wt,enable:lt,assignEvents:Na})})(s,D);u.dragRotate=new Ks(s,U,k,j),this._add("mouseRotate",U,["mousePitch"]),this._add("mousePitch",k,["mouseRotate","mouseRoll"]),this._add("mouseRoll",j,["mousePitch"]),s.interactive&&s.dragRotate&&u.dragRotate.enable();const W=(function({enable:lt,clickTolerance:gt}){const mt=new Nn({checkCorrectEvent:dt=>K.mouseButton(dt)===0&&!dt.ctrlKey});return new ka({clickTolerance:gt,move:(dt,wt)=>({around:wt,panDelta:wt.sub(dt)}),activateOnStart:!0,moveStateManager:mt,enable:lt,assignEvents:Na})})(s),Q=new yd(s,u);u.dragPan=new f_(_,W,Q),this._add("mousePan",W),this._add("touchPan",Q,["touchZoom","touchRotate"]),s.interactive&&s.dragPan&&u.dragPan.enable(s.dragPan);const et=new l_,st=new a_;u.touchZoomRotate=new kl(_,st,et,I),this._add("touchRotate",et,["touchPan","touchZoom"]),this._add("touchZoom",st,["touchPan","touchRotate"]),s.interactive&&s.touchZoomRotate&&u.touchZoomRotate.enable(s.touchZoomRotate),this._add("blockableMapEvent",new d0(u));const ut=u.scrollZoom=new yu(u,(()=>this._triggerRenderFrame()));this._add("scrollZoom",ut,["mousePan"]),s.interactive&&s.scrollZoom&&u.scrollZoom.enable(s.scrollZoom);const _t=u.keyboard=new Ln(u);this._add("keyboard",_t),s.interactive&&s.keyboard&&u.keyboard.enable()}_add(s,u,_){this._handlers.push({handlerName:s,handler:u,allowed:_}),this._handlersById[s]=u}stop(s){if(!this._updatingCamera){for(const{handler:u}of this._handlers)u.reset();this._inertia.clear(),this._fireEvents({},{},s),this._changes=[]}}isActive(){for(const{handler:s}of this._handlers)if(s.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!xe(this._eventsInProgress)||this.isZooming()}_blockedByActive(s,u,_){for(const m in s)if(m!==_&&(!u||u.indexOf(m)<0))return!0;return!1}_getMapTouches(s){const u=[];for(const _ of s)this._el.contains(_.target)&&u.push(_);return u}mergeHandlerResult(s,u,_,m,v){if(!_)return;c.e(s,_);const w={handlerName:m,originalEvent:_.originalEvent||v};_.zoomDelta!==void 0&&(u.zoom=w),_.panDelta!==void 0&&(u.drag=w),_.rollDelta!==void 0&&(u.roll=w),_.pitchDelta!==void 0&&(u.pitch=w),_.bearingDelta!==void 0&&(u.rotate=w)}_applyChanges(){const s={},u={},_={};for(const[m,v,w]of this._changes)m.panDelta&&(s.panDelta=(s.panDelta||new c.P(0,0))._add(m.panDelta)),m.zoomDelta&&(s.zoomDelta=(s.zoomDelta||0)+m.zoomDelta),m.bearingDelta&&(s.bearingDelta=(s.bearingDelta||0)+m.bearingDelta),m.pitchDelta&&(s.pitchDelta=(s.pitchDelta||0)+m.pitchDelta),m.rollDelta&&(s.rollDelta=(s.rollDelta||0)+m.rollDelta),m.around!==void 0&&(s.around=m.around),m.pinchAround!==void 0&&(s.pinchAround=m.pinchAround),m.noInertia&&(s.noInertia=m.noInertia),c.e(u,v),c.e(_,w);this._updateMapTransform(s,u,_),this._changes=[]}_updateMapTransform(s,u,_){const m=this._map,v=m._getTransformForUpdate(),w=m.terrain;if(!(bu(s)||w&&this._terrainMovement))return this._fireEvents(u,_,!0);m._stop(!0);let{panDelta:S,zoomDelta:I,bearingDelta:B,pitchDelta:D,rollDelta:U,around:k,pinchAround:j}=s;j!==void 0&&(k=j),k=k||m.transform.centerPoint,w&&!v.isPointOnMapSurface(k)&&(k=v.centerPoint);const W={panDelta:S,zoomDelta:I,rollDelta:U,pitchDelta:D,bearingDelta:B,around:k};this._map.cameraHelper.useGlobeControls&&!v.isPointOnMapSurface(k)&&(k=v.centerPoint);const Q=k.distSqr(v.centerPoint)<.01?v.center:v.screenPointToLocation(S?k.sub(S):k);this._handleMapControls({terrain:w,tr:v,deltasForHelper:W,preZoomAroundLoc:Q,combinedEventsInProgress:u,panDelta:S}),m._applyUpdatedTransform(v),this._map._update(),s.noInertia||this._inertia.record(s),this._fireEvents(u,_,!0)}_handleMapControls({terrain:s,tr:u,deltasForHelper:_,preZoomAroundLoc:m,combinedEventsInProgress:v,panDelta:w}){const S=this._map.cameraHelper;if(S.handleMapControlsRollPitchBearingZoom(_,u),s)return S.useGlobeControls?(this._terrainMovement||!v.drag&&!v.zoom||(this._terrainMovement=!0,this._map._elevationFreeze=!0),void S.handleMapControlsPan(_,u,m)):this._terrainMovement||!v.drag&&!v.zoom?void(v.drag&&this._terrainMovement&&w?u.setCenter(u.screenPointToLocation(u.centerPoint.sub(w))):S.handleMapControlsPan(_,u,m)):(this._terrainMovement=!0,this._map._elevationFreeze=!0,void S.handleMapControlsPan(_,u,m));S.handleMapControlsPan(_,u,m)}_fireEvents(s,u,_){const m=xe(this._eventsInProgress),v=xe(s),w={};for(const U in s){const{originalEvent:k}=s[U];this._eventsInProgress[U]||(w[`${U}start`]=k),this._eventsInProgress[U]=s[U]}!m&&v&&this._fireEvent("movestart",v.originalEvent);for(const U in w)this._fireEvent(U,w[U]);v&&this._fireEvent("move",v.originalEvent);for(const U in s){const{originalEvent:k}=s[U];this._fireEvent(U,k)}const S={};let I;for(const U in this._eventsInProgress){const{handlerName:k,originalEvent:j}=this._eventsInProgress[U];this._handlersById[k].isActive()||(delete this._eventsInProgress[U],I=u[k]||j,S[`${U}end`]=I)}for(const U in S)this._fireEvent(U,S[U]);const B=xe(this._eventsInProgress),D=(m||v)&&!B;if(D&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const U=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&U.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform(U)}if(_&&D){this._updatingCamera=!0;const U=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),k=j=>j!==0&&-this._bearingSnap<j&&j<this._bearingSnap;!U||!U.essential&&X.prefersReducedMotion?(this._map.fire(new c.l("moveend",{originalEvent:I})),k(this._map.getBearing())&&this._map.resetNorth()):(k(U.bearing||this._map.getBearing())&&(U.bearing=0),U.freezeElevation=!0,this._map.easeTo(U,{originalEvent:I})),this._updatingCamera=!1}}_fireEvent(s,u){this._map.fire(new c.l(s,u?{originalEvent:u}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((s=>{delete this._frameId,this.handleEvent(new Nl("renderFrame",{timeStamp:s})),this._applyChanges()}))}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Xi extends c.E{constructor(s,u,_){super(),this._renderFrameCallback=()=>{const m=Math.min((nt()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(m)),m<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=s,this._bearingSnap=_.bearingSnap,this.cameraHelper=u,this.on("moveend",(()=>{delete this._requestedCameraState}))}migrateProjection(s,u){s.apply(this.transform),this.transform=s,this.cameraHelper=u}getCenter(){return new c.U(this.transform.center.lng,this.transform.center.lat)}setCenter(s,u){return this.jumpTo({center:s},u)}getCenterElevation(){return this.transform.elevation}setCenterElevation(s,u){return this.jumpTo({elevation:s},u),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(s){this._centerClampedToGround=s}panBy(s,u,_){return s=c.P.convert(s).mult(-1),this.panTo(this.transform.center,c.e({offset:s},u),_)}panTo(s,u,_){return this.easeTo(c.e({center:s},u),_)}getZoom(){return this.transform.zoom}setZoom(s,u){return this.jumpTo({zoom:s},u),this}zoomTo(s,u,_){return this.easeTo(c.e({zoom:s},u),_)}zoomIn(s,u){return this.zoomTo(this.getZoom()+1,s,u),this}zoomOut(s,u){return this.zoomTo(this.getZoom()-1,s,u),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(s,u){return s!=this.transform.fov&&(this.transform.setFov(s),this.fire(new c.l("movestart",u)).fire(new c.l("move",u)).fire(new c.l("moveend",u))),this}getBearing(){return this.transform.bearing}setBearing(s,u){return this.jumpTo({bearing:s},u),this}getPadding(){return this.transform.padding}setPadding(s,u){return this.jumpTo({padding:s},u),this}rotateTo(s,u,_){return this.easeTo(c.e({bearing:s},u),_)}resetNorth(s,u){return this.rotateTo(0,c.e({duration:1e3},s),u),this}resetNorthPitch(s,u){return this.easeTo(c.e({bearing:0,pitch:0,roll:0,duration:1e3},s),u),this}snapToNorth(s,u){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(s,u):this}getPitch(){return this.transform.pitch}setPitch(s,u){return this.jumpTo({pitch:s},u),this}getRoll(){return this.transform.roll}setRoll(s,u){return this.jumpTo({roll:s},u),this}cameraForBounds(s,u){s=We.convert(s).adjustAntiMeridian();const _=u&&u.bearing||0;return this._cameraForBoxAndBearing(s.getNorthWest(),s.getSouthEast(),_,u)}_cameraForBoxAndBearing(s,u,_,m){const v={top:0,bottom:0,right:0,left:0};if(typeof(m=c.e({padding:v,offset:[0,0],maxZoom:this.transform.maxZoom},m)).padding=="number"){const B=m.padding;m.padding={top:B,bottom:B,right:B,left:B}}const w=c.e(v,m.padding);m.padding=w;const S=this.transform,I=new We(s,u);return this.cameraHelper.cameraForBoxAndBearing(m,w,I,_,S)}fitBounds(s,u,_){return this._fitInternal(this.cameraForBounds(s,u),u,_)}fitScreenCoordinates(s,u,_,m,v){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(c.P.convert(s)),this.transform.screenPointToLocation(c.P.convert(u)),_,m),m,v)}_fitInternal(s,u,_){return s?(delete(u=c.e(s,u)).padding,u.linear?this.easeTo(u,_):this.flyTo(u,_)):this}jumpTo(s,u){this.stop();const _=this._getTransformForUpdate();let m=!1,v=!1,w=!1;const S=_.zoom;this.cameraHelper.handleJumpToCenterZoom(_,s);const I=_.zoom!==S;return"elevation"in s&&_.elevation!==+s.elevation&&_.setElevation(+s.elevation),"bearing"in s&&_.bearing!==+s.bearing&&(m=!0,_.setBearing(+s.bearing)),"pitch"in s&&_.pitch!==+s.pitch&&(v=!0,_.setPitch(+s.pitch)),"roll"in s&&_.roll!==+s.roll&&(w=!0,_.setRoll(+s.roll)),s.padding==null||_.isPaddingEqual(s.padding)||_.setPadding(s.padding),this._applyUpdatedTransform(_),this.fire(new c.l("movestart",u)).fire(new c.l("move",u)),I&&this.fire(new c.l("zoomstart",u)).fire(new c.l("zoom",u)).fire(new c.l("zoomend",u)),m&&this.fire(new c.l("rotatestart",u)).fire(new c.l("rotate",u)).fire(new c.l("rotateend",u)),v&&this.fire(new c.l("pitchstart",u)).fire(new c.l("pitch",u)).fire(new c.l("pitchend",u)),w&&this.fire(new c.l("rollstart",u)).fire(new c.l("roll",u)).fire(new c.l("rollend",u)),this.fire(new c.l("moveend",u))}calculateCameraOptionsFromTo(s,u,_,m=0){const v=c.a5.fromLngLat(s,u),w=c.a5.fromLngLat(_,m),S=w.x-v.x,I=w.y-v.y,B=w.z-v.z,D=Math.hypot(S,I,B);if(D===0)throw new Error("Can't calculate camera options with same From and To");const U=Math.hypot(S,I),k=c.ao(this.transform.cameraToCenterDistance/D/this.transform.tileSize),j=180*Math.atan2(S,-I)/Math.PI;let W=180*Math.acos(U/D)/Math.PI;return W=B<0?90-W:90+W,{center:w.toLngLat(),elevation:m,zoom:k,pitch:W,bearing:j}}calculateCameraOptionsFromCameraLngLatAltRotation(s,u,_,m,v){const w=this.transform.calculateCenterFromCameraLngLatAlt(s,u,_,m);return{center:w.center,elevation:w.elevation,zoom:w.zoom,bearing:_,pitch:m,roll:v}}easeTo(s,u){this._stop(!1,s.easeId),((s=c.e({offset:[0,0],duration:500,easing:c.cs},s)).animate===!1||!s.essential&&X.prefersReducedMotion)&&(s.duration=0);const _=this._getTransformForUpdate(),m=this.getBearing(),v=_.pitch,w=_.roll,S="bearing"in s?this._normalizeBearing(s.bearing,m):m,I="pitch"in s?+s.pitch:v,B="roll"in s?this._normalizeBearing(s.roll,w):w,D="padding"in s?s.padding:_.padding,U=c.P.convert(s.offset);let k,j;s.around&&(k=c.U.convert(s.around),j=_.locationToScreenPoint(k));const W={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},Q=this.cameraHelper.handleEaseTo(_,{bearing:S,pitch:I,roll:B,padding:D,around:k,aroundPoint:j,offsetAsPoint:U,offset:s.offset,zoom:s.zoom,center:s.center});return this._rotating=this._rotating||m!==S,this._pitching=this._pitching||I!==v,this._rolling=this._rolling||B!==w,this._padding=!_.isPaddingEqual(D),this._zooming=this._zooming||Q.isZooming,this._easeId=s.easeId,this._prepareEase(u,s.noMoveStart,W),this.terrain&&this._prepareElevation(Q.elevationCenter),this._ease((et=>{Q.easeFunc(et),this.terrain&&!s.freezeElevation&&this._updateElevation(et),this._applyUpdatedTransform(_),this._fireMoveEvents(u)}),(et=>{this.terrain&&s.freezeElevation&&this._finalizeElevation(),this._afterEase(u,et)}),s),this}_prepareEase(s,u,_={}){this._moving=!0,u||_.moving||this.fire(new c.l("movestart",s)),this._zooming&&!_.zooming&&this.fire(new c.l("zoomstart",s)),this._rotating&&!_.rotating&&this.fire(new c.l("rotatestart",s)),this._pitching&&!_.pitching&&this.fire(new c.l("pitchstart",s)),this._rolling&&!_.rolling&&this.fire(new c.l("rollstart",s))}_prepareElevation(s){this._elevationCenter=s,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(s,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(s){this._elevationStart!==void 0&&this._elevationCenter!==void 0||this._prepareElevation(this.transform.center),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));const u=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(s<1&&u!==this._elevationTarget){const _=this._elevationTarget-this._elevationStart;this._elevationStart+=s*(_-(u-(_*s+this._elevationStart))/(1-s)),this._elevationTarget=u}this.transform.setElevation(c.F.number(this._elevationStart,this._elevationTarget,s))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(s){if(!this.terrain&&s.elevation>=0&&s.pitch<=90)return{};const u=s.getCameraLngLat(),_=s.getCameraAltitude(),m=this.terrain?this.terrain.getElevationForLngLatZoom(u,s.zoom):0;if(_<m){const v=this.calculateCameraOptionsFromTo(u,m,s.center,s.elevation);return{pitch:v.pitch,zoom:v.zoom}}return{}}_applyUpdatedTransform(s){const u=[];if(u.push((m=>this._elevateCameraIfInsideTerrain(m))),this.transformCameraUpdate&&u.push((m=>this.transformCameraUpdate(m))),!u.length)return;const _=s.clone();for(const m of u){const v=_.clone(),{center:w,zoom:S,roll:I,pitch:B,bearing:D,elevation:U}=m(v);w&&v.setCenter(w),U!==void 0&&v.setElevation(U),S!==void 0&&v.setZoom(S),I!==void 0&&v.setRoll(I),B!==void 0&&v.setPitch(B),D!==void 0&&v.setBearing(D),_.apply(v)}this.transform.apply(_)}_fireMoveEvents(s){this.fire(new c.l("move",s)),this._zooming&&this.fire(new c.l("zoom",s)),this._rotating&&this.fire(new c.l("rotate",s)),this._pitching&&this.fire(new c.l("pitch",s)),this._rolling&&this.fire(new c.l("roll",s))}_afterEase(s,u){if(this._easeId&&u&&this._easeId===u)return;delete this._easeId;const _=this._zooming,m=this._rotating,v=this._pitching,w=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,_&&this.fire(new c.l("zoomend",s)),m&&this.fire(new c.l("rotateend",s)),v&&this.fire(new c.l("pitchend",s)),w&&this.fire(new c.l("rollend",s)),this.fire(new c.l("moveend",s))}flyTo(s,u){if(!s.essential&&X.prefersReducedMotion){const Ot=c.S(s,["center","zoom","bearing","pitch","roll","elevation","padding"]);return this.jumpTo(Ot,u)}this.stop(),s=c.e({offset:[0,0],speed:1.2,curve:1.42,easing:c.cs},s);const _=this._getTransformForUpdate(),m=_.bearing,v=_.pitch,w=_.roll,S=_.padding,I="bearing"in s?this._normalizeBearing(s.bearing,m):m,B="pitch"in s?+s.pitch:v,D="roll"in s?this._normalizeBearing(s.roll,w):w,U="padding"in s?s.padding:_.padding,k=c.P.convert(s.offset);let j=_.centerPoint.add(k);const W=_.screenPointToLocation(j),Q=this.cameraHelper.handleFlyTo(_,{bearing:I,pitch:B,roll:D,padding:U,locationAtOffset:W,offsetAsPoint:k,center:s.center,minZoom:s.minZoom,zoom:s.zoom});let et=s.curve;const st=Math.max(_.width,_.height),ut=st/Q.scaleOfZoom,_t=Q.pixelPathLength;typeof Q.scaleOfMinZoom=="number"&&(et=Math.sqrt(st/Q.scaleOfMinZoom/_t*2));const lt=et*et;function gt(Ot){const qt=(ut*ut-st*st+(Ot?-1:1)*lt*lt*_t*_t)/(2*(Ot?ut:st)*lt*_t);return Math.log(Math.sqrt(qt*qt+1)-qt)}function mt(Ot){return(Math.exp(Ot)-Math.exp(-Ot))/2}function dt(Ot){return(Math.exp(Ot)+Math.exp(-Ot))/2}const wt=gt(!1);let Ft=function(Ot){return dt(wt)/dt(wt+et*Ot)},Mt=function(Ot){return st*((dt(wt)*(mt(qt=wt+et*Ot)/dt(qt))-mt(wt))/lt)/_t;var qt},Rt=(gt(!0)-wt)/et;if(Math.abs(_t)<2e-6||!isFinite(Rt)){if(Math.abs(st-ut)<1e-6)return this.easeTo(s,u);const Ot=ut<st?-1:1;Rt=Math.abs(Math.log(ut/st))/et,Mt=()=>0,Ft=qt=>Math.exp(Ot*et*qt)}return s.duration="duration"in s?+s.duration:1e3*Rt/("screenSpeed"in s?+s.screenSpeed/et:+s.speed),s.maxDuration&&s.duration>s.maxDuration&&(s.duration=0),this._zooming=!0,this._rotating=m!==I,this._pitching=B!==v,this._rolling=D!==w,this._padding=!_.isPaddingEqual(U),this._prepareEase(u,!1),this.terrain&&this._prepareElevation(Q.targetCenter),this._ease((Ot=>{const qt=Ot*Rt,Zt=1/Ft(qt),Gt=Mt(qt);this._rotating&&_.setBearing(c.F.number(m,I,Ot)),this._pitching&&_.setPitch(c.F.number(v,B,Ot)),this._rolling&&_.setRoll(c.F.number(w,D,Ot)),this._padding&&(_.interpolatePadding(S,U,Ot),j=_.centerPoint.add(k)),Q.easeFunc(Ot,Zt,Gt,j),this.terrain&&!s.freezeElevation&&this._updateElevation(Ot),this._applyUpdatedTransform(_),this._fireMoveEvents(u)}),(()=>{this.terrain&&s.freezeElevation&&this._finalizeElevation(),this._afterEase(u)}),s),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(s,u){var _;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const m=this._onEaseEnd;delete this._onEaseEnd,m.call(this,u)}return s||(_=this.handlers)===null||_===void 0||_.stop(!1),this}_ease(s,u,_){_.animate===!1||_.duration===0?(s(1),u()):(this._easeStart=nt(),this._easeOptions=_,this._onEaseFrame=s,this._onEaseEnd=u,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(s,u){s=c.V(s,-180,180);const _=Math.abs(s-u);return Math.abs(s-360-u)<_&&(s-=360),Math.abs(s+360-u)<_&&(s+=360),s}queryTerrainElevation(s){return this.terrain?this.terrain.getElevationForLngLatZoom(c.U.convert(s),this.transform.tileZoom):null}}const wd={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class Es{constructor(s=wd){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=u=>{!u||u.sourceDataType!=="metadata"&&u.sourceDataType!=="visibility"&&u.dataType!=="style"&&u.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=s}getDefaultPosition(){return"bottom-right"}onAdd(s){return this._map=s,this._compact=this.options.compact,this._container=K.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=K.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=K.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){K.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(s,u){const _=this._map._getUIString(`AttributionControl.${u}`);s.title=_,s.setAttribute("aria-label",_)}_updateAttributions(){if(!this._map.style)return;let s=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?s=s.concat(this.options.customAttribution.map((m=>typeof m!="string"?"":m))):typeof this.options.customAttribution=="string"&&s.push(this.options.customAttribution)),this._map.style.stylesheet){const m=this._map.style.stylesheet;this.styleOwner=m.owner,this.styleId=m.id}const u=this._map.style.tileManagers;for(const m in u){const v=u[m];if(v.used||v.usedForTerrain){const w=v.getSource();w.attribution&&s.indexOf(w.attribution)<0&&s.push(w.attribution)}}s=s.filter((m=>String(m).trim())),s.sort(((m,v)=>m.length-v.length)),s=s.filter(((m,v)=>{for(let w=v+1;w<s.length;w++)if(s[w].indexOf(m)>=0)return!1;return!0}));const _=s.join(" | ");_!==this._attribHTML&&(this._attribHTML=_,s.length?(this._innerContainer.innerHTML=K.sanitize(_),this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Td{constructor(s={}){this._updateCompact=()=>{const u=this._container.children;if(u.length){const _=u[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&_.classList.add("maplibregl-compact"):_.classList.remove("maplibregl-compact")}},this.options=s}getDefaultPosition(){return"bottom-left"}onAdd(s){this._map=s,this._compact=this.options&&this.options.compact,this._container=K.create("div","maplibregl-ctrl");const u=K.create("a","maplibregl-ctrl-logo");return u.target="_blank",u.rel="noopener nofollow",u.href="https://maplibre.org/",u.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),u.setAttribute("rel","noopener nofollow"),this._container.appendChild(u),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){K.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class _0{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(s){const u=++this._id;return this._queue.push({callback:s,id:u,cancelled:!1}),u}remove(s){const u=this._currentlyRunning,_=u?this._queue.concat(u):this._queue;for(const m of _)if(m.id===s)return void(m.cancelled=!0)}run(s=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const u=this._currentlyRunning=this._queue;this._queue=[];for(const _ of u)if(!_.cancelled&&(_.callback(s),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var g0=c.aO([{name:"a_pos3d",type:"Int16",components:3}]);class m0 extends c.E{constructor(s){super(),this._lastTilesetChange=nt(),this.tileManager=s,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=s._source.tileSize*2**this.deltaZoom,s.usedForTerrain=!0,s.tileSize=this.tileSize}destruct(){this.tileManager.usedForTerrain=!1,this.tileManager.tileSize=null}getSource(){return this.tileManager._source}update(s,u){this.tileManager.update(s,u),this._renderableTilesKeys=[];const _={};for(const m of Ee(s,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:u,calculateTileZoom:this.tileManager._source.calculateTileZoom}))_[m.key]=!0,this._renderableTilesKeys.push(m.key),this._tiles[m.key]||(m.terrainRttPosMatrix32f=new Float64Array(16),c.c1(m.terrainRttPosMatrix32f,0,c.a3,c.a3,0,0,1),this._tiles[m.key]=new G(m,this.tileSize),this._lastTilesetChange=nt());for(const m in this._tiles)_[m]||delete this._tiles[m]}freeRtt(s){for(const u in this._tiles){const _=this._tiles[u];(!s||_.tileID.equals(s)||_.tileID.isChildOf(s)||s.isChildOf(_.tileID))&&(_.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map((s=>this.getTileByID(s)))}getTileByID(s){return this._tiles[s]}getTerrainCoords(s,u){return u?this._getTerrainCoordsForTileRanges(s,u):this._getTerrainCoordsForRegularTile(s)}_getTerrainCoordsForRegularTile(s){const u={};for(const _ of this._renderableTilesKeys){const m=this._tiles[_].tileID,v=s.clone(),w=c.be();if(m.canonical.equals(s.canonical))c.c1(w,0,c.a3,c.a3,0,0,1);else if(m.canonical.isChildOf(s.canonical)){const S=m.canonical.z-s.canonical.z,I=m.canonical.x-(m.canonical.x>>S<<S),B=m.canonical.y-(m.canonical.y>>S<<S),D=c.a3>>S;c.c1(w,0,D,D,0,0,1),c.N(w,w,[-I*D,-B*D,0])}else{if(!s.canonical.isChildOf(m.canonical))continue;{const S=s.canonical.z-m.canonical.z,I=s.canonical.x-(s.canonical.x>>S<<S),B=s.canonical.y-(s.canonical.y>>S<<S),D=c.a3>>S;c.c1(w,0,c.a3,c.a3,0,0,1),c.N(w,w,[I*D,B*D,0]),c.O(w,w,[1/2**S,1/2**S,0])}}v.terrainRttPosMatrix32f=new Float32Array(w),u[_]=v}return u}_getTerrainCoordsForTileRanges(s,u){const _={};for(const m of this._renderableTilesKeys){const v=this._tiles[m].tileID;if(!this._isWithinTileRanges(v,u))continue;const w=s.clone(),S=c.be();if(v.canonical.z===s.canonical.z){const I=s.canonical.x-v.canonical.x,B=s.canonical.y-v.canonical.y;c.c1(S,0,c.a3,c.a3,0,0,1),c.N(S,S,[I*c.a3,B*c.a3,0])}else if(v.canonical.z>s.canonical.z){const I=v.canonical.z-s.canonical.z,B=v.canonical.x-(v.canonical.x>>I<<I),D=v.canonical.y-(v.canonical.y>>I<<I),U=s.canonical.x-(v.canonical.x>>I),k=s.canonical.y-(v.canonical.y>>I),j=c.a3>>I;c.c1(S,0,j,j,0,0,1),c.N(S,S,[-B*j+U*c.a3,-D*j+k*c.a3,0])}else{const I=s.canonical.z-v.canonical.z,B=s.canonical.x-(s.canonical.x>>I<<I),D=s.canonical.y-(s.canonical.y>>I<<I),U=(s.canonical.x>>I)-v.canonical.x,k=(s.canonical.y>>I)-v.canonical.y,j=c.a3<<I;c.c1(S,0,j,j,0,0,1),c.N(S,S,[B*c.a3+U*j,D*c.a3+k*j,0])}w.terrainRttPosMatrix32f=new Float32Array(S),_[m]=w}return _}getSourceTile(s,u){const _=this.tileManager._source;let m=s.overscaledZ-this.deltaZoom;if(m>_.maxzoom&&(m=_.maxzoom),m<_.minzoom)return null;this._sourceTileCache[s.key]||(this._sourceTileCache[s.key]=s.scaledTo(m).key);let v=this.tileManager.getTileByID(this._sourceTileCache[s.key]);if((!v||!v.dem)&&u)for(;m>=_.minzoom&&(!v||!v.dem);)v=this.tileManager.getTileByID(s.scaledTo(m--).key);return v}anyTilesAfterTime(s=Date.now()){return this._lastTilesetChange>=s}_isWithinTileRanges(s,u){return u[s.canonical.z]&&s.canonical.x>=u[s.canonical.z].minTileX&&s.canonical.x<=u[s.canonical.z].maxTileX&&s.canonical.y>=u[s.canonical.z].minTileY&&s.canonical.y<=u[s.canonical.z].maxTileY}}class Ll{constructor(s,u,_){this._meshCache={},this.painter=s,this.tileManager=new m0(u),this.options=_,this.exaggeration=typeof _.exaggeration=="number"?_.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(s,u,_,m=c.a3){var v;if(!(u>=0&&u<m&&_>=0&&_<m))return 0;const w=this.getTerrainData(s),S=(v=w.tile)===null||v===void 0?void 0:v.dem;if(!S)return 0;const I=c.cw([],[u/m*c.a3,_/m*c.a3],w.u_terrain_matrix),B=[I[0]*S.dim,I[1]*S.dim],D=Math.floor(B[0]),U=Math.floor(B[1]),k=B[0]-D,j=B[1]-U;return S.get(D,U)*(1-k)*(1-j)+S.get(D+1,U)*k*(1-j)+S.get(D,U+1)*(1-k)*j+S.get(D+1,U+1)*k*j}getElevationForLngLatZoom(s,u){if(!c.cx(u,s.wrap()))return 0;const{tileID:_,mercatorX:m,mercatorY:v}=this._getOverscaledTileIDFromLngLatZoom(s,u);return this.getElevation(_,m%c.a3,v%c.a3,c.a3)}getElevation(s,u,_,m=c.a3){return this.getDEMElevation(s,u,_,m)*this.exaggeration}getTerrainData(s){if(!this._emptyDemTexture){const m=this.painter.context,v=new c.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new c.T(m,v,m.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new c.T(m,new c.R({width:1,height:1}),m.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(m.gl.NEAREST,m.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=c.am([])}const u=this.tileManager.getSourceTile(s,!0);if(u&&u.dem&&(!u.demTexture||u.needsTerrainPrepare)){const m=this.painter.context;u.demTexture=this.painter.getTileTexture(u.dem.stride),u.demTexture?u.demTexture.update(u.dem.getPixels(),{premultiply:!1}):u.demTexture=new c.T(m,u.dem.getPixels(),m.gl.RGBA,{premultiply:!1}),u.demTexture.bind(m.gl.NEAREST,m.gl.CLAMP_TO_EDGE),u.needsTerrainPrepare=!1}const _=u&&u+u.tileID.key+s.key;if(_&&!this._demMatrixCache[_]){const m=this.tileManager.getSource().maxzoom;let v=s.canonical.z-u.tileID.canonical.z;s.overscaledZ>s.canonical.z&&(s.canonical.z>=m?v=s.canonical.z-m:c.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const w=s.canonical.x-(s.canonical.x>>v<<v),S=s.canonical.y-(s.canonical.y>>v<<v),I=c.cy(new Float64Array(16),[1/(c.a3<<v),1/(c.a3<<v),0]);c.N(I,I,[w*c.a3,S*c.a3,0]),this._demMatrixCache[s.key]={matrix:I,coord:s}}return{u_depth:2,u_terrain:3,u_terrain_dim:u&&u.dem&&u.dem.dim||1,u_terrain_matrix:_?this._demMatrixCache[s.key].matrix:this._emptyDemMatrix,u_terrain_unpack:u&&u.dem&&u.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(u&&u.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:u}}getFramebuffer(s){const u=this.painter,_=u.width/devicePixelRatio,m=u.height/devicePixelRatio;return!this._fbo||this._fbo.width===_&&this._fbo.height===m||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new c.T(u.context,{width:_,height:m,data:null},u.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(u.context.gl.NEAREST,u.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new c.T(u.context,{width:_,height:m,data:null},u.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(u.context.gl.NEAREST,u.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=u.context.createFramebuffer(_,m,!0,!1),this._fbo.depthAttachment.set(u.context.createRenderbuffer(u.context.gl.DEPTH_COMPONENT16,_,m))),this._fbo.colorAttachment.set(s==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const s=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const u=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let v=0,w=0;v<this._coordsTextureSize;v++)for(let S=0;S<this._coordsTextureSize;S++,w+=4)u[w+0]=255&S,u[w+1]=255&v,u[w+2]=S>>8<<4|v>>8,u[w+3]=0;const _=new c.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(u.buffer)),m=new c.T(s,_,s.gl.RGBA,{premultiply:!1});return m.bind(s.gl.NEAREST,s.gl.CLAMP_TO_EDGE),this._coordsTexture=m,m}pointCoordinate(s){this.painter.maybeDrawDepthAndCoords(!0);const u=new Uint8Array(4),_=this.painter.context,m=_.gl,v=Math.round(s.x*this.painter.pixelRatio/devicePixelRatio),w=Math.round(s.y*this.painter.pixelRatio/devicePixelRatio),S=Math.round(this.painter.height/devicePixelRatio);_.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),m.readPixels(v,S-w-1,1,1,m.RGBA,m.UNSIGNED_BYTE,u),_.bindFramebuffer.set(null);const I=u[0]+(u[2]>>4<<8),B=u[1]+((15&u[2])<<8),D=this.coordsIndex[255-u[3]],U=D&&this.tileManager.getTileByID(D);if(!U)return null;const k=this._coordsTextureSize,j=(1<<U.tileID.canonical.z)*k;return new c.a5((U.tileID.canonical.x*k+I)/j+U.tileID.wrap,(U.tileID.canonical.y*k+B)/j,this.getElevation(U.tileID,I,B,k))}depthAtPoint(s){const u=new Uint8Array(4),_=this.painter.context,m=_.gl;return _.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),m.readPixels(s.x,this.painter.height/devicePixelRatio-s.y-1,1,1,m.RGBA,m.UNSIGNED_BYTE,u),_.bindFramebuffer.set(null),(u[0]/16777216+u[1]/65536+u[2]/256+u[3])/256}getTerrainMesh(s){var u;const _=((u=this.painter.style.projection)===null||u===void 0?void 0:u.transitionState)>0,m=_&&s.canonical.y===0,v=_&&s.canonical.y===(1<<s.canonical.z)-1,w=`m_${m?"n":""}_${v?"s":""}`;if(this._meshCache[w])return this._meshCache[w];const S=this.painter.context,I=new c.cz,B=new c.aS,D=this.meshSize,U=c.a3/D,k=D*D;for(let dt=0;dt<=D;dt++)for(let wt=0;wt<=D;wt++)I.emplaceBack(wt*U,dt*U,0);for(let dt=0;dt<k;dt+=D+1)for(let wt=0;wt<D;wt++)B.emplaceBack(wt+dt,D+wt+dt+1,D+wt+dt+2),B.emplaceBack(wt+dt,D+wt+dt+2,wt+dt+1);const j=I.length,W=j+(D+1),Q=(D+1)*D,et=m?c.bl:0,st=m?0:1,ut=v?c.bm:c.a3,_t=v?0:1;for(let dt=0;dt<=D;dt++)I.emplaceBack(dt*U,et,st);for(let dt=0;dt<=D;dt++)I.emplaceBack(dt*U,ut,_t);for(let dt=0;dt<D;dt++)B.emplaceBack(Q+dt,W+dt,W+dt+1),B.emplaceBack(Q+dt,W+dt+1,Q+dt+1),B.emplaceBack(0+dt,j+dt+1,j+dt),B.emplaceBack(0+dt,0+dt+1,j+dt+1);const lt=I.length,gt=lt+2*(D+1);for(const dt of[0,1])for(let wt=0;wt<=D;wt++)for(const Ft of[0,1])I.emplaceBack(dt*c.a3,wt*U,Ft);for(let dt=0;dt<2*D;dt+=2)B.emplaceBack(lt+dt,lt+dt+1,lt+dt+3),B.emplaceBack(lt+dt,lt+dt+3,lt+dt+2),B.emplaceBack(gt+dt,gt+dt+3,gt+dt+1),B.emplaceBack(gt+dt,gt+dt+2,gt+dt+3);const mt=new uo(S.createVertexBuffer(I,g0.members),S.createIndexBuffer(B),c.aR.simpleSegment(0,0,I.length,B.length));return this._meshCache[w]=mt,mt}getMeshFrameDelta(s){return 2*Math.PI*c.by/Math.pow(2,Math.max(s,0))/5}getMinTileElevationForLngLatZoom(s,u){var _;const{tileID:m}=this._getOverscaledTileIDFromLngLatZoom(s,u);return(_=this.getMinMaxElevation(m).minElevation)!==null&&_!==void 0?_:0}getMinMaxElevation(s){const u=this.getTerrainData(s).tile,_={minElevation:null,maxElevation:null};return u&&u.dem&&(_.minElevation=u.dem.min*this.exaggeration,_.maxElevation=u.dem.max*this.exaggeration),_}_getOverscaledTileIDFromLngLatZoom(s,u){const _=c.a5.fromLngLat(s.wrap()),m=(1<<u)*c.a3,v=_.x*m,w=_.y*m,S=Math.floor(v/c.a3),I=Math.floor(w/c.a3);return{tileID:new c.a0(u,0,u,S,I),mercatorX:v,mercatorY:w}}}class Br{constructor(s,u,_){this._context=s,this._size=u,this._tileSize=_,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const s of this._objects)s.texture.destroy(),s.fbo.destroy()}_createObject(s){const u=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),_=new c.T(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return _.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),u.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),u.colorAttachment.set(_.texture),{id:s,fbo:u,texture:_,stamp:-1,inUse:!1}}getObjectForId(s){return this._objects[s]}useObject(s){s.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter((u=>s.id!==u)),this._recentlyUsed.push(s.id)}stampObject(s){s.stamp=++this._stamp}getOrCreateFreeObject(){for(const u of this._recentlyUsed)if(!this._objects[u].inUse)return this._objects[u];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const s=this._createObject(this._objects.length);return this._objects.push(s),s}freeObject(s){s.inUse=!1}freeAllObjects(){for(const s of this._objects)this.freeObject(s)}isFull(){return!(this._objects.length<this._size)&&this._objects.some((s=>!s.inUse))===!1}}const fr={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0,"color-relief":!0};class p_{constructor(s,u){this.painter=s,this.terrain=u,this.pool=new Br(s.context,30,u.tileManager.tileSize*u.qualityFactor)}destruct(){this.pool.destruct()}getTexture(s){return this.pool.getObjectForId(s.rtt[this._stacks.length-1].id).texture}prepareForRender(s,u){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.tileManager.getRenderableTiles(),this._renderableLayerIds=s._order.filter((_=>!s._layers[_].isHidden(u))),this._coordsAscending={};for(const _ in s.tileManagers){this._coordsAscending[_]={};const m=s.tileManagers[_].getVisibleCoordinates(),v=s.tileManagers[_].getSource(),w=v instanceof Bi?v.terrainTileRanges:null;for(const S of m){const I=this.terrain.tileManager.getTerrainCoords(S,w);for(const B in I)this._coordsAscending[_][B]||(this._coordsAscending[_][B]=[]),this._coordsAscending[_][B].push(I[B])}}this._coordsAscendingStr={};for(const _ of s._order){const m=s._layers[_],v=m.source;if(fr[m.type]&&!this._coordsAscendingStr[v]){this._coordsAscendingStr[v]={};for(const w in this._coordsAscending[v])this._coordsAscendingStr[v][w]=this._coordsAscending[v][w].map((S=>S.key)).sort().join()}}for(const _ of this._renderableTiles)for(const m in this._coordsAscendingStr){const v=this._coordsAscendingStr[m][_.tileID.key];v&&v!==_.rttCoords[m]&&(_.rtt=[])}}renderLayer(s,u){if(s.isHidden(this.painter.transform.zoom))return!1;const _=Object.assign(Object.assign({},u),{isRenderingToTexture:!0}),m=s.type,v=this.painter,w=this._renderableLayerIds[this._renderableLayerIds.length-1]===s.id;if(fr[m]&&(this._prevType&&fr[this._prevType]||this._stacks.push([]),this._prevType=m,this._stacks[this._stacks.length-1].push(s.id),!w))return!0;if(fr[this._prevType]||fr[m]&&w){this._prevType=m;const S=this._stacks.length-1,I=this._stacks[S]||[];for(const B of this._renderableTiles){if(this.pool.isFull()&&(_o(this.painter,this.terrain,this._rttTiles,_),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(B),B.rtt[S]){const U=this.pool.getObjectForId(B.rtt[S].id);if(U.stamp===B.rtt[S].stamp){this.pool.useObject(U);continue}}const D=this.pool.getOrCreateFreeObject();this.pool.useObject(D),this.pool.stampObject(D),B.rtt[S]={id:D.id,stamp:D.stamp},v.context.bindFramebuffer.set(D.fbo.framebuffer),v.context.clear({color:c.bj.transparent,stencil:0}),v.currentStencilSource=void 0;for(let U=0;U<I.length;U++){const k=v.style._layers[I[U]],j=k.source?this._coordsAscending[k.source][B.tileID.key]:[B.tileID];v.context.viewport.set([0,0,D.fbo.width,D.fbo.height]),v._renderTileClippingMasks(k,j,!0),v.renderLayer(v,v.style.tileManagers[k.source],k,j,_),k.source&&(B.rttCoords[k.source]=this._coordsAscendingStr[k.source][B.tileID.key])}}return _o(this.painter,this.terrain,this._rttTiles,_),this._rttTiles=[],this.pool.freeAllObjects(),fr[m]}return!1}}const Ul={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},xu=T,wu={hash:!1,interactive:!0,bearingSnap:7,attributionControl:wd,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:c.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,transformConstrain:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,reduceMotion:void 0,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0,experimentalZoomLevelsToOverscale:void 0},Ad={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class Ed{constructor(s,u,_=!1){this.mousedown=v=>{this.startMove(v,K.mousePos(this.element,v)),K.addEventListener(window,"mousemove",this.mousemove),K.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=v=>{this.move(v,K.mousePos(this.element,v))},this.mouseup=v=>{this._rotatePitchHandler.dragEnd(v),this.offTemp()},this.touchstart=v=>{v.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=K.touchPos(this.element,v.targetTouches)[0],this.startMove(v,this._startPos),K.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),K.addEventListener(window,"touchend",this.touchend))},this.touchmove=v=>{v.targetTouches.length!==1?this.reset():(this._lastPos=K.touchPos(this.element,v.targetTouches)[0],this.move(v,this._lastPos))},this.touchend=v=>{v.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHandler.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=u;const m=new f0;this._rotatePitchHandler=new ka({clickTolerance:3,move:(v,w)=>{const S=u.getBoundingClientRect(),I=new c.P((S.bottom-S.top)/2,(S.right-S.left)/2);return{bearingDelta:c.cr(new c.P(v.x,w.y),w,I),pitchDelta:_?-.5*(w.y-v.y):void 0}},moveStateManager:m,enable:!0,assignEvents:()=>{}}),this.map=s,K.addEventListener(u,"mousedown",this.mousedown),K.addEventListener(u,"touchstart",this.touchstart,{passive:!1}),K.addEventListener(u,"touchcancel",this.reset)}startMove(s,u){this._rotatePitchHandler.dragStart(s,u),K.disableDrag()}move(s,u){const _=this.map,{bearingDelta:m,pitchDelta:v}=this._rotatePitchHandler.dragMove(s,u)||{};m&&_.setBearing(_.getBearing()+m),v&&_.setPitch(_.getPitch()+v)}off(){const s=this.element;K.removeEventListener(s,"mousedown",this.mousedown),K.removeEventListener(s,"touchstart",this.touchstart,{passive:!1}),K.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),K.removeEventListener(window,"touchend",this.touchend),K.removeEventListener(s,"touchcancel",this.reset),this.offTemp()}offTemp(){K.enableDrag(),K.removeEventListener(window,"mousemove",this.mousemove),K.removeEventListener(window,"mouseup",this.mouseup),K.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),K.removeEventListener(window,"touchend",this.touchend)}}let Js;function Tu(b,s,u,_=!1){if(_||!u.getCoveringTilesDetailsProvider().allowWorldCopies())return b?.wrap();const m=new c.U(b.lng,b.lat);if(b=new c.U(b.lng,b.lat),s){const v=new c.U(b.lng-360,b.lat),w=new c.U(b.lng+360,b.lat),S=u.locationToScreenPoint(b).distSqr(s);u.locationToScreenPoint(v).distSqr(s)<S?b=v:u.locationToScreenPoint(w).distSqr(s)<S&&(b=w)}for(;Math.abs(b.lng-u.center.lng)>180;){const v=u.locationToScreenPoint(b);if(v.x>=0&&v.y>=0&&v.x<=u.width&&v.y<=u.height)break;b.lng>u.center.lng?b.lng-=360:b.lng+=360}return b.lng!==m.lng&&u.isPointOnMapSurface(u.locationToScreenPoint(b))?b:m}const zl={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Au(b,s,u){const _=b.classList;for(const m in zl)_.remove(`maplibregl-${u}-anchor-${m}`);_.add(`maplibregl-${u}-anchor-${s}`)}class Vl extends c.E{constructor(s){if(super(),this._onKeyPress=u=>{const _=u.code,m=u.charCode||u.keyCode;_!=="Space"&&_!=="Enter"&&m!==32&&m!==13||this.togglePopup()},this._onMapClick=u=>{const _=u.originalEvent.target,m=this._element;this._popup&&(_===m||m.contains(_))&&this.togglePopup()},this._update=u=>{if(!this._map)return;const _=this._map.loaded()&&!this._map.isMoving();(u?.type==="terrain"||u?.type==="render"&&!_)&&this._map.once("render",this._update),this._lngLat=Tu(this._lngLat,this._flatPos,this._map.transform),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let m="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?m=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(m=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let v="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?v="rotateX(0deg)":this._pitchAlignment==="map"&&(v=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||u&&u.type!=="moveend"||(this._pos=this._pos.round()),K.setTransform(this._element,`${zl[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${v} ${m}`),X.frameAsync(new AbortController).then((()=>{this._updateOpacity(u&&u.type==="moveend")})).catch((()=>{}))},this._onMove=u=>{if(!this._isDragging){const _=this._clickTolerance||this._map._clickTolerance;this._isDragging=u.point.dist(this._pointerdownPos)>=_}this._isDragging&&(this._pos=u.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new c.l("dragstart"))),this.fire(new c.l("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new c.l("dragend")),this._state="inactive"},this._addDragHandler=u=>{this._element.contains(u.originalEvent.target)&&(u.preventDefault(),this._positionDelta=u.point.sub(this._pos).add(this._offset),this._pointerdownPos=u.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=s&&s.anchor||"center",this._color=s&&s.color||"#3FB1CE",this._scale=s&&s.scale||1,this._draggable=s&&s.draggable||!1,this._clickTolerance=s&&s.clickTolerance||0,this._subpixelPositioning=s&&s.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=s&&s.rotation||0,this._rotationAlignment=s&&s.rotationAlignment||"auto",this._pitchAlignment=s&&s.pitchAlignment&&s.pitchAlignment!=="auto"?s.pitchAlignment:this._rotationAlignment,this.setOpacity(s?.opacity,s?.opacityWhenCovered),s&&s.element)this._element=s.element,this._offset=c.P.convert(s&&s.offset||[0,0]);else{this._defaultMarker=!0,this._element=K.create("div");const u=K.createNS("http://www.w3.org/2000/svg","svg"),_=41,m=27;u.setAttributeNS(null,"display","block"),u.setAttributeNS(null,"height",`${_}px`),u.setAttributeNS(null,"width",`${m}px`),u.setAttributeNS(null,"viewBox",`0 0 ${m} ${_}`);const v=K.createNS("http://www.w3.org/2000/svg","g");v.setAttributeNS(null,"stroke","none"),v.setAttributeNS(null,"stroke-width","1"),v.setAttributeNS(null,"fill","none"),v.setAttributeNS(null,"fill-rule","evenodd");const w=K.createNS("http://www.w3.org/2000/svg","g");w.setAttributeNS(null,"fill-rule","nonzero");const S=K.createNS("http://www.w3.org/2000/svg","g");S.setAttributeNS(null,"transform","translate(3.0, 29.0)"),S.setAttributeNS(null,"fill","#000000");const I=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const st of I){const ut=K.createNS("http://www.w3.org/2000/svg","ellipse");ut.setAttributeNS(null,"opacity","0.04"),ut.setAttributeNS(null,"cx","10.5"),ut.setAttributeNS(null,"cy","5.80029008"),ut.setAttributeNS(null,"rx",st.rx),ut.setAttributeNS(null,"ry",st.ry),S.appendChild(ut)}const B=K.createNS("http://www.w3.org/2000/svg","g");B.setAttributeNS(null,"fill",this._color);const D=K.createNS("http://www.w3.org/2000/svg","path");D.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),B.appendChild(D);const U=K.createNS("http://www.w3.org/2000/svg","g");U.setAttributeNS(null,"opacity","0.25"),U.setAttributeNS(null,"fill","#000000");const k=K.createNS("http://www.w3.org/2000/svg","path");k.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),U.appendChild(k);const j=K.createNS("http://www.w3.org/2000/svg","g");j.setAttributeNS(null,"transform","translate(6.0, 7.0)"),j.setAttributeNS(null,"fill","#FFFFFF");const W=K.createNS("http://www.w3.org/2000/svg","g");W.setAttributeNS(null,"transform","translate(8.0, 8.0)");const Q=K.createNS("http://www.w3.org/2000/svg","circle");Q.setAttributeNS(null,"fill","#000000"),Q.setAttributeNS(null,"opacity","0.25"),Q.setAttributeNS(null,"cx","5.5"),Q.setAttributeNS(null,"cy","5.5"),Q.setAttributeNS(null,"r","5.4999962");const et=K.createNS("http://www.w3.org/2000/svg","circle");et.setAttributeNS(null,"fill","#FFFFFF"),et.setAttributeNS(null,"cx","5.5"),et.setAttributeNS(null,"cy","5.5"),et.setAttributeNS(null,"r","5.4999962"),W.appendChild(Q),W.appendChild(et),w.appendChild(S),w.appendChild(B),w.appendChild(U),w.appendChild(j),w.appendChild(W),u.appendChild(w),u.setAttributeNS(null,"height",_*this._scale+"px"),u.setAttributeNS(null,"width",m*this._scale+"px"),this._element.appendChild(u),this._offset=c.P.convert(s&&s.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",(u=>{u.preventDefault()})),this._element.addEventListener("mousedown",(u=>{u.preventDefault()})),Au(this._element,this._anchor,"marker"),s&&s.className)for(const u of s.className.split(" "))this._element.classList.add(u);this._popup=null}addTo(s){return this.remove(),this._map=s,this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label",s._getUIString("Marker.Title")),this._element.hasAttribute("role")||this._element.setAttribute("role","button"),s.getCanvasContainer().appendChild(this._element),s.on("move",this._update),s.on("moveend",this._update),s.on("terrain",this._update),s.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),K.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(s){return this._lngLat=c.U.convert(s),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(s){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),s){if(!("offset"in s.options)){const m=Math.abs(13.5)/Math.SQRT2;s.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[m,-1*(38.1-13.5+m)],"bottom-right":[-m,-1*(38.1-13.5+m)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=s,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(s){return this._subpixelPositioning=s,this}getPopup(){return this._popup}togglePopup(){const s=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:s?(s.isOpen()?s.remove():(s.setLngLat(this._lngLat),s.addTo(this._map)),this):this}_updateOpacity(s=!1){var u,_;const m=(u=this._map)===null||u===void 0?void 0:u.terrain,v=this._map.transform.isLocationOccluded(this._lngLat);if(!m||v){const j=v?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==j&&(this._element.style.opacity=j))}if(s)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout((()=>{this._opacityTimeout=null}),100)}const w=this._map,S=w.terrain.depthAtPoint(this._pos),I=w.terrain.getElevationForLngLatZoom(this._lngLat,w.transform.tileZoom);if(w.transform.lngLatToCameraDepth(this._lngLat,I)-S<.006)return void(this._element.style.opacity=this._opacity);const B=-this._offset.y/w.transform.pixelsPerMeter,D=Math.sin(w.getPitch()*Math.PI/180)*B,U=w.terrain.depthAtPoint(new c.P(this._pos.x,this._pos.y-this._offset.y)),k=w.transform.lngLatToCameraDepth(this._lngLat,I+D)-U>.006;!((_=this._popup)===null||_===void 0)&&_.isOpen()&&k&&this._popup.remove(),this._element.style.opacity=k?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(s){return this._offset=c.P.convert(s),this._update(),this}addClassName(s){this._element.classList.add(s)}removeClassName(s){this._element.classList.remove(s)}toggleClassName(s){return this._element.classList.toggle(s)}setDraggable(s){return this._draggable=!!s,this._map&&(s?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(s){return this._rotation=s||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(s){return this._rotationAlignment=s||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(s){return this._pitchAlignment=s&&s!=="auto"?s:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(s,u){return(this._opacity===void 0||s===void 0&&u===void 0)&&(this._opacity="1",this._opacityWhenCovered="0.2"),s!==void 0&&(this._opacity=s),u!==void 0&&(this._opacityWhenCovered=u),this._map&&this._updateOpacity(!0),this}}const Sd={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let La=0,jo=!1;const Cd={maxWidth:100,unit:"metric"};function Eu(b,s,u){const _=u&&u.maxWidth||100,m=b._container.clientHeight/2,v=b._container.clientWidth/2,w=b.unproject([v-_/2,m]),S=b.unproject([v+_/2,m]),I=Math.round(b.project(S).x-b.project(w).x),B=Math.min(_,I,b._container.clientWidth),D=w.distanceTo(S);if(u&&u.unit==="imperial"){const U=3.2808*D;U>5280?go(s,B,U/5280,b._getUIString("ScaleControl.Miles")):go(s,B,U,b._getUIString("ScaleControl.Feet"))}else u&&u.unit==="nautical"?go(s,B,D/1852,b._getUIString("ScaleControl.NauticalMiles")):D>=1e3?go(s,B,D/1e3,b._getUIString("ScaleControl.Kilometers")):go(s,B,D,b._getUIString("ScaleControl.Meters"))}function go(b,s,u,_){const m=(function(v){const w=Math.pow(10,`${Math.floor(v)}`.length-1);let S=v/w;return S=S>=10?10:S>=5?5:S>=3?3:S>=2?2:S>=1?1:(function(I){const B=Math.pow(10,Math.ceil(-Math.log(I)/Math.LN10));return Math.round(I*B)/B})(S),w*S})(u);b.style.width=s*(m/u)+"px",b.innerHTML=`${m}&nbsp;${_}`}const Id={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1,locationOccludedOpacity:void 0},Md=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function jl(b){if(b){if(typeof b=="number"){const s=Math.round(Math.abs(b)/Math.SQRT2);return{center:new c.P(0,0),top:new c.P(0,b),"top-left":new c.P(s,s),"top-right":new c.P(-s,s),bottom:new c.P(0,-b),"bottom-left":new c.P(s,-s),"bottom-right":new c.P(-s,-s),left:new c.P(b,0),right:new c.P(-b,0)}}if(b instanceof c.P||Array.isArray(b)){const s=c.P.convert(b);return{center:s,top:s,"top-left":s,"top-right":s,bottom:s,"bottom-left":s,"bottom-right":s,left:s,right:s}}return{center:c.P.convert(b.center||[0,0]),top:c.P.convert(b.top||[0,0]),"top-left":c.P.convert(b["top-left"]||[0,0]),"top-right":c.P.convert(b["top-right"]||[0,0]),bottom:c.P.convert(b.bottom||[0,0]),"bottom-left":c.P.convert(b["bottom-left"]||[0,0]),"bottom-right":c.P.convert(b["bottom-right"]||[0,0]),left:c.P.convert(b.left||[0,0]),right:c.P.convert(b.right||[0,0])}}return jl(new c.P(0,0))}const Rd=T;f.AJAXError=c.cD,f.Event=c.l,f.Evented=c.E,f.LngLat=c.U,f.MercatorCoordinate=c.a5,f.Point=c.P,f.addProtocol=c.cE,f.config=c.a,f.removeProtocol=c.cF,f.AttributionControl=Es,f.BoxZoomHandler=s_,f.CanvasSource=co,f.CooperativeGesturesHandler=fe,f.DoubleClickZoomHandler=xd,f.DragPanHandler=f_,f.DragRotateHandler=Ks,f.EdgeInsets=dr,f.FullscreenControl=class extends c.E{constructor(b={}){super(),this._onFullscreenChange=()=>{var s;let u=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((s=u?.shadowRoot)===null||s===void 0)&&s.fullscreenElement;)u=u.shadowRoot.fullscreenElement;u===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,b&&b.container&&(b.container instanceof HTMLElement?this._container=b.container:c.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(b){return this._map=b,this._container||(this._container=this._map.getContainer()),this._controlContainer=K.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){K.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const b=this._fullscreenButton=K.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);K.create("span","maplibregl-ctrl-icon",b).setAttribute("aria-hidden","true"),b.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const b=this._getTitle();this._fullscreenButton.setAttribute("aria-label",b),this._fullscreenButton.title=b}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new c.l("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new c.l("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},f.GeoJSONSource=Dn,f.GeolocateControl=class extends c.E{constructor(b){super(),this._onSuccess=s=>{if(this._map){if(this._isOutOfMapMaxBounds(s))return this._setErrorState(),this.fire(new c.l("outofmaxbounds",s)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=s,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(s),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(s),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new c.l("geolocate",s)),this._finish()}},this._updateCamera=s=>{const u=new c.U(s.coords.longitude,s.coords.latitude),_=s.coords.accuracy,m=this._map.getBearing(),v=c.e({bearing:m},this.options.fitBoundsOptions),w=We.fromLngLat(u,_);this._map.fitBounds(w,v,{geolocateSource:!0})},this._updateMarker=s=>{if(s){const u=new c.U(s.coords.longitude,s.coords.latitude);this._accuracyCircleMarker.setLngLat(u).addTo(this._map),this._userLocationDotMarker.setLngLat(u).addTo(this._map),this._accuracy=s.coords.accuracy,this._updateCircleRadiusIfNeeded()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onUpdate=()=>{this._updateCircleRadiusIfNeeded()},this._onError=s=>{if(this._map){if(s.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const u=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=u,this._geolocateButton.setAttribute("aria-label",u),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(s.code===3&&jo)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new c.l("error",s)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",(s=>s.preventDefault())),this._geolocateButton=K.create("button","maplibregl-ctrl-geolocate",this._container),K.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=s=>{if(this._map){if(s===!1){c.w("Geolocation support is not available so the GeolocateControl will be disabled.");const u=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=u,this._geolocateButton.setAttribute("aria-label",u)}else{const u=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=u,this._geolocateButton.setAttribute("aria-label",u)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=K.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Vl({element:this._dotElement}),this._circleElement=K.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Vl({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onUpdate),this._map.on("move",this._onUpdate),this._map.on("rotate",this._onUpdate),this._map.on("pitch",this._onUpdate)),this._geolocateButton.addEventListener("click",(()=>this.trigger())),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(u=>{const _=u?.[0]instanceof ResizeObserverEntry;u.geolocateSource||this._watchState!=="ACTIVE_LOCK"||_||this._map.isZooming()||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new c.l("trackuserlocationend")),this.fire(new c.l("userlocationlostfocus")))}))}},this.options=c.e({},Sd,b)}onAdd(b){return this._map=b,this._container=K.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),(function(){return c._(this,arguments,void 0,(function*(s=!1){if(Js!==void 0&&!s)return Js;if(window.navigator.permissions===void 0)return Js=!!window.navigator.geolocation,Js;try{Js=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{Js=!!window.navigator.geolocation}return Js}))})().then((s=>this._finishSetupUI(s))),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),K.remove(this._container),this._map.off("zoom",this._onUpdate),this._map.off("move",this._onUpdate),this._map.off("rotate",this._onUpdate),this._map.off("pitch",this._onUpdate),this._map=void 0,La=0,jo=!1}_isOutOfMapMaxBounds(b){const s=this._map.getMaxBounds(),u=b.coords;return s&&(u.longitude<s.getWest()||u.longitude>s.getEast()||u.latitude<s.getSouth()||u.latitude>s.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":case"BACKGROUND_ERROR":case"OFF":case void 0:break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadiusIfNeeded(){const b=this._userLocationDotMarker.getLngLat();if(!(this.options.showUserLocation&&this.options.showAccuracyCircle&&this._accuracy&&b))return;const s=this._map.project(b),u=this._map.unproject([s.x+100,s.y]),_=b.distanceTo(u)/100,m=2*this._accuracy/_;this._circleElement.style.width=`${m.toFixed(2)}px`,this._circleElement.style.height=`${m.toFixed(2)}px`}trigger(){if(!this._setup)return c.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new c.l("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":La--,jo=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new c.l("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new c.l("trackuserlocationstart")),this.fire(new c.l("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let b;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),La++,La>1?(b={maximumAge:6e5,timeout:0},jo=!0):(b=this.options.positionOptions,jo=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,b)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},f.GlobeControl=class{constructor(){this._toggleProjection=()=>{var b;const s=(b=this._map.getProjection())===null||b===void 0?void 0:b.type;this._map.setProjection(s!=="mercator"&&s?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var b;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),((b=this._map.getProjection())===null||b===void 0?void 0:b.type)==="globe"?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(b){return this._map=b,this._container=K.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=K.create("button","maplibregl-ctrl-globe",this._container),K.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._container}onRemove(){K.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},f.Hash=_d,f.ImageSource=Bi,f.KeyboardHandler=Ln,f.LngLatBounds=We,f.LogoControl=Td,f.Map=class extends Xi{constructor(b){var s,u;c.cA.mark(c.cB.create);const _=Object.assign(Object.assign(Object.assign({},wu),b),{canvasContextAttributes:Object.assign(Object.assign({},wu.canvasContextAttributes),b.canvasContextAttributes)});if(_.minZoom!=null&&_.maxZoom!=null&&_.minZoom>_.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(_.minPitch!=null&&_.maxPitch!=null&&_.minPitch>_.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(_.minPitch!=null&&_.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(_.maxPitch!=null&&_.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");const m=new br,v=new es;if(_.minZoom!==void 0&&m.setMinZoom(_.minZoom),_.maxZoom!==void 0&&m.setMaxZoom(_.maxZoom),_.minPitch!==void 0&&m.setMinPitch(_.minPitch),_.maxPitch!==void 0&&m.setMaxPitch(_.maxPitch),_.renderWorldCopies!==void 0&&m.setRenderWorldCopies(_.renderWorldCopies),_.transformConstrain!==null&&m.setConstrainOverride(_.transformConstrain),super(m,v,{bearingSnap:_.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new _0,this._controls=[],this._mapId=c.ab(),this._lostContextStyle={style:null,images:null},this._contextLost=S=>{S.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.painter.destroy();for(const I of Object.values(this.style._layers))if(I.type==="custom"&&console.warn(`Custom layer with id '${I.id}' cannot be restored after WebGL context loss. You will need to re-add it manually after context restoration.`),I._listeners)for(const[B]of Object.entries(I._listeners))console.warn(`Custom layer with id '${I.id}' had event listeners for event '${B}' which cannot be restored after WebGL context loss. You will need to re-add them manually after context restoration.`);this._lostContextStyle=this._getStyleAndImages(),this.style.destroy(),this.style=null,this.fire(new c.l("webglcontextlost",{originalEvent:S}))},this._contextRestored=S=>{this._lostContextStyle.style&&this.setStyle(this._lostContextStyle.style,{diff:!1}),this._lostContextStyle.images&&(this.style.imageManager.images=this._lostContextStyle.images),this._setupPainter(),this.resize(),this._update(),this.fire(new c.l("webglcontextrestored",{originalEvent:S}))},this._onMapScroll=S=>{if(S.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=_.interactive,this._maxTileCacheSize=_.maxTileCacheSize,this._maxTileCacheZoomLevels=_.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},_.canvasContextAttributes),this._trackResize=_.trackResize===!0,this._bearingSnap=_.bearingSnap,this._centerClampedToGround=_.centerClampedToGround,this._refreshExpiredTiles=_.refreshExpiredTiles===!0,this._fadeDuration=_.fadeDuration,this._crossSourceCollisions=_.crossSourceCollisions===!0,this._collectResourceTiming=_.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},Ul),_.locale),this._clickTolerance=_.clickTolerance,this._overridePixelRatio=_.pixelRatio,this._maxCanvasSize=_.maxCanvasSize,this._zoomLevelsToOverscale=_.experimentalZoomLevelsToOverscale,this.transformCameraUpdate=_.transformCameraUpdate,this.transformConstrain=_.transformConstrain,this.cancelPendingTileRequestsWhileZooming=_.cancelPendingTileRequestsWhileZooming===!0,_.reduceMotion!==void 0&&(X.prefersReducedMotion=_.reduceMotion),this._imageQueueHandle=ae.addThrottleControl((()=>this.isMoving())),this._requestManager=new be(_.transformRequest),typeof _.container=="string"){if(this._container=document.getElementById(_.container),!this._container)throw new Error(`Container '${_.container}' not found.`)}else{if(!(_.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=_.container}if(_.maxBounds&&this.setMaxBounds(_.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",(()=>this._update(!1))),this.on("moveend",(()=>this._update(!1))),this.on("zoom",(()=>this._update(!0))),this.on("terrain",(()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)})),this.once("idle",(()=>{this._idleTriggered=!0})),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let S=!1;const I=pd((B=>{this._trackResize&&!this._removed&&(this.resize(B),this.redraw())}),50);this._resizeObserver=new ResizeObserver((B=>{S?I(B):S=!0})),this._resizeObserver.observe(this._container)}this.handlers=new vu(this,_),this._hash=_.hash&&new _d(typeof _.hash=="string"&&_.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:_.center,elevation:_.elevation,zoom:_.zoom,bearing:_.bearing,pitch:_.pitch,roll:_.roll}),_.bounds&&(this.resize(),this.fitBounds(_.bounds,c.e({},_.fitBoundsOptions,{duration:0}))));const w=typeof _.style=="string"||((u=(s=_.style)===null||s===void 0?void 0:s.projection)===null||u===void 0?void 0:u.type)!=="globe";this.resize(null,w),this._localIdeographFontFamily=_.localIdeographFontFamily,this._validateStyle=_.validateStyle,_.style&&this.setStyle(_.style,{localIdeographFontFamily:_.localIdeographFontFamily}),_.attributionControl&&this.addControl(new Es(typeof _.attributionControl=="boolean"?void 0:_.attributionControl)),_.maplibreLogo&&this.addControl(new Td,_.logoPosition),this.on("style.load",(()=>{if(w||this._resizeTransform(),this.transform.unmodified){const S=c.S(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(S)}})),this.on("data",(S=>{this._update(S.dataType==="style"),this.fire(new c.l(`${S.dataType}data`,S))})),this.on("dataloading",(S=>{this.fire(new c.l(`${S.dataType}dataloading`,S))})),this.on("dataabort",(S=>{this.fire(new c.l("sourcedataabort",S))}))}_getMapId(){return this._mapId}setGlobalStateProperty(b,s){return this.style.setGlobalStateProperty(b,s),this._update(!0)}getGlobalState(){return this.style.getGlobalState()}addControl(b,s){if(s===void 0&&(s=b.getDefaultPosition?b.getDefaultPosition():"top-right"),!b||!b.onAdd)return this.fire(new c.k(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const u=b.onAdd(this);this._controls.push(b);const _=this._controlPositions[s];return s.indexOf("bottom")!==-1?_.insertBefore(u,_.firstChild):_.appendChild(u),this}removeControl(b){if(!b||!b.onRemove)return this.fire(new c.k(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const s=this._controls.indexOf(b);return s>-1&&this._controls.splice(s,1),b.onRemove(this),this}hasControl(b){return this._controls.indexOf(b)>-1}coveringTiles(b){return Ee(this.transform,b)}calculateCameraOptionsFromTo(b,s,u,_){return _==null&&this.terrain&&(_=this.terrain.getElevationForLngLatZoom(u,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(b,s,u,_)}resize(b,s=!0){const[u,_]=this._containerDimensions(),m=this._getClampedPixelRatio(u,_);if(this._resizeCanvas(u,_,m),this.painter.resize(u,_,m),this.painter.overLimit()){const w=this.painter.context.gl;this._maxCanvasSize=[w.drawingBufferWidth,w.drawingBufferHeight];const S=this._getClampedPixelRatio(u,_);this._resizeCanvas(u,_,S),this.painter.resize(u,_,S)}this._resizeTransform(s);const v=!this._moving;return v&&(this.stop(),this.fire(new c.l("movestart",b)).fire(new c.l("move",b))),this.fire(new c.l("resize",b)),v&&this.fire(new c.l("moveend",b)),this}_resizeTransform(b=!0){var s;const[u,_]=this._containerDimensions();this.transform.resize(u,_,b),(s=this._requestedCameraState)===null||s===void 0||s.resize(u,_,b)}_getClampedPixelRatio(b,s){const{0:u,1:_}=this._maxCanvasSize,m=this.getPixelRatio(),v=b*m,w=s*m;return Math.min(v>u?u/v:1,w>_?_/w:1)*m}getPixelRatio(){var b;return(b=this._overridePixelRatio)!==null&&b!==void 0?b:devicePixelRatio}setPixelRatio(b){this._overridePixelRatio=b,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(b){return this.transform.setMaxBounds(We.convert(b)),this._update()}setMinZoom(b){if((b=b??-2)>=-2&&b<=this.transform.maxZoom)return this.transform.setMinZoom(b),this._update(),this.getZoom()<b&&this.setZoom(b),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(b){if((b=b??22)>=this.transform.minZoom)return this.transform.setMaxZoom(b),this._update(),this.getZoom()>b&&this.setZoom(b),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(b){if((b=b??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(b>=0&&b<=this.transform.maxPitch)return this.transform.setMinPitch(b),this._update(),this.getPitch()<b&&this.setPitch(b),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(b){if((b=b??60)>180)throw new Error("maxPitch must be less than or equal to 180");if(b>=this.transform.minPitch)return this.transform.setMaxPitch(b),this._update(),this.getPitch()>b&&this.setPitch(b),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(b){return this.transform.setRenderWorldCopies(b),this._update()}setTransformConstrain(b){return this.transform.setConstrainOverride(b),this._update()}project(b){return this.transform.locationToScreenPoint(c.U.convert(b),this.style&&this.terrain)}unproject(b){return this.transform.screenPointToLocation(c.P.convert(b),this.terrain)}isMoving(){var b;return this._moving||((b=this.handlers)===null||b===void 0?void 0:b.isMoving())}isZooming(){var b;return this._zooming||((b=this.handlers)===null||b===void 0?void 0:b.isZooming())}isRotating(){var b;return this._rotating||((b=this.handlers)===null||b===void 0?void 0:b.isRotating())}_createDelegatedListener(b,s,u){if(b==="mouseenter"||b==="mouseover"){let _=!1;return{layers:s,listener:u,delegates:{mousemove:v=>{const w=s.filter((I=>this.getLayer(I))),S=w.length!==0?this.queryRenderedFeatures(v.point,{layers:w}):[];S.length?_||(_=!0,u.call(this,new Nr(b,this,v.originalEvent,{features:S}))):_=!1},mouseout:()=>{_=!1}}}}if(b==="mouseleave"||b==="mouseout"){let _=!1;return{layers:s,listener:u,delegates:{mousemove:w=>{const S=s.filter((I=>this.getLayer(I)));(S.length!==0?this.queryRenderedFeatures(w.point,{layers:S}):[]).length?_=!0:_&&(_=!1,u.call(this,new Nr(b,this,w.originalEvent)))},mouseout:w=>{_&&(_=!1,u.call(this,new Nr(b,this,w.originalEvent)))}}}}{const _=m=>{const v=s.filter((S=>this.getLayer(S))),w=v.length!==0?this.queryRenderedFeatures(m.point,{layers:v}):[];w.length&&(m.features=w,u.call(this,m),delete m.features)};return{layers:s,listener:u,delegates:{[b]:_}}}}_saveDelegatedListener(b,s){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[b]=this._delegatedListeners[b]||[],this._delegatedListeners[b].push(s)}_removeDelegatedListener(b,s,u){if(!this._delegatedListeners||!this._delegatedListeners[b])return;const _=this._delegatedListeners[b];for(let m=0;m<_.length;m++){const v=_[m];if(v.listener===u&&v.layers.length===s.length&&v.layers.every((w=>s.includes(w)))){for(const w in v.delegates)this.off(w,v.delegates[w]);return void _.splice(m,1)}}}on(b,s,u){if(u===void 0)return super.on(b,s);const _=typeof s=="string"?[s]:s,m=this._createDelegatedListener(b,_,u);this._saveDelegatedListener(b,m);for(const v in m.delegates)this.on(v,m.delegates[v]);return{unsubscribe:()=>{this._removeDelegatedListener(b,_,u)}}}once(b,s,u){if(u===void 0)return super.once(b,s);const _=typeof s=="string"?[s]:s,m=this._createDelegatedListener(b,_,u);for(const v in m.delegates){const w=m.delegates[v];m.delegates[v]=(...S)=>{this._removeDelegatedListener(b,_,u),w(...S)}}this._saveDelegatedListener(b,m);for(const v in m.delegates)this.once(v,m.delegates[v]);return this}off(b,s,u){return u===void 0?super.off(b,s):(this._removeDelegatedListener(b,typeof s=="string"?[s]:s,u),this)}queryRenderedFeatures(b,s){if(!this.style)return[];let u;const _=b instanceof c.P||Array.isArray(b),m=_?b:[[0,0],[this.transform.width,this.transform.height]];if(s=s||(_?{}:b)||{},m instanceof c.P||typeof m[0]=="number")u=[c.P.convert(m)];else{const v=c.P.convert(m[0]),w=c.P.convert(m[1]);u=[v,new c.P(w.x,v.y),w,new c.P(v.x,w.y),v]}return this.style.queryRenderedFeatures(u,s,this.transform)}querySourceFeatures(b,s){return this.style.querySourceFeatures(b,s)}setStyle(b,s){return(s=c.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},s)).diff!==!1&&s.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&b?(this._diffStyle(b,s),this):(this._localIdeographFontFamily=s.localIdeographFontFamily,this._updateStyle(b,s))}setTransformRequest(b){return this._requestManager.setTransformRequest(b),this}_getUIString(b){const s=this._locale[b];if(s==null)throw new Error(`Missing UI string '${b}'`);return s}_updateStyle(b,s){var u,_;if(s.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",(()=>this._updateStyle(b,s)));const m=this.style&&s.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!b)),b?(this.style=new ml(this,s||{}),this.style.setEventedParent(this,{style:this.style}),typeof b=="string"?this.style.loadURL(b,s,m):this.style.loadJSON(b,s,m),this):((_=(u=this.style)===null||u===void 0?void 0:u.projection)===null||_===void 0||_.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new ml(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(b,s){if(typeof b=="string"){const u=this._requestManager.transformRequest(b,"Style");c.j(u,new AbortController).then((_=>{this._updateDiff(_.data,s)})).catch((_=>{_&&this.fire(new c.k(_))}))}else typeof b=="object"&&this._updateDiff(b,s)}_updateDiff(b,s){try{this.style.setState(b,s)&&this._update(!0)}catch(u){c.w(`Unable to perform style diff: ${u.message||u.error||u}.  Rebuilding the style from scratch.`),this._updateStyle(b,s)}}getStyle(){if(this.style)return this.style.serialize()}_getStyleAndImages(){return this.style?{style:this.style.serialize(),images:this.style.imageManager.cloneImages()}:{style:null,images:{}}}isStyleLoaded(){return this.style?this.style.loaded():c.w("There is no style added to the map.")}addSource(b,s){return this._lazyInitEmptyStyle(),this.style.addSource(b,s),this._update(!0)}isSourceLoaded(b){const s=this.style&&this.style.tileManagers[b];if(s!==void 0)return s.loaded();this.fire(new c.k(new Error(`There is no tile manager with ID '${b}'`)))}setTerrain(b){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),b){const s=this.style.tileManagers[b.source];if(!s)throw new Error(`cannot load terrain, because there exists no source with ID: ${b.source}`);this.terrain===null&&s.reload();for(const u in this.style._layers){const _=this.style._layers[u];_.type==="hillshade"&&_.source===b.source&&c.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality."),_.type==="color-relief"&&_.source===b.source&&c.w("You are using the same source for a color-relief layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Ll(this.painter,s,b),this.painter.renderToTexture=new p_(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=u=>{var _;u.dataType==="style"?this.terrain.tileManager.freeRtt():u.dataType==="source"&&u.tile&&(u.sourceId!==b.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),((_=u.source)===null||_===void 0?void 0:_.type)==="image"?this.terrain.tileManager.freeRtt():this.terrain.tileManager.freeRtt(u.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.tileManager.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new c.l("terrain",{terrain:b})),this}getTerrain(){var b,s;return(s=(b=this.terrain)===null||b===void 0?void 0:b.options)!==null&&s!==void 0?s:null}areTilesLoaded(){const b=this.style&&this.style.tileManagers;for(const s in b){const u=b[s]._tiles;for(const _ in u){const m=u[_];if(m.state!=="loaded"&&m.state!=="errored")return!1}}return!0}removeSource(b){return this.style.removeSource(b),this._update(!0)}getSource(b){return this.style.getSource(b)}setSourceTileLodParams(b,s,u){if(u){const _=this.getSource(u);if(!_)throw new Error(`There is no source with ID "${u}", cannot set LOD parameters`);_.calculateTileZoom=Ut(Math.max(1,b),Math.max(1,s))}else for(const _ in this.style.tileManagers)this.style.tileManagers[_].getSource().calculateTileZoom=Ut(Math.max(1,b),Math.max(1,s));return this._update(!0),this}refreshTiles(b,s){const u=this.style.tileManagers[b];if(!u)throw new Error(`There is no tile manager with ID "${b}", cannot refresh tile`);s===void 0?u.reload(!0):u.refreshTiles(s.map((_=>new c.a8(_.z,_.x,_.y))))}addImage(b,s,u={}){const{pixelRatio:_=1,sdf:m=!1,stretchX:v,stretchY:w,content:S,textFitWidth:I,textFitHeight:B}=u;if(this._lazyInitEmptyStyle(),!(s instanceof HTMLImageElement||c.b(s))){if(s.width===void 0||s.height===void 0)return this.fire(new c.k(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:D,height:U,data:k}=s,j=s;return this.style.addImage(b,{data:new c.R({width:D,height:U},new Uint8Array(k)),pixelRatio:_,stretchX:v,stretchY:w,content:S,textFitWidth:I,textFitHeight:B,sdf:m,version:0,userImage:j}),j.onAdd&&j.onAdd(this,b),this}}{const{width:D,height:U,data:k}=X.getImageData(s);this.style.addImage(b,{data:new c.R({width:D,height:U},k),pixelRatio:_,stretchX:v,stretchY:w,content:S,textFitWidth:I,textFitHeight:B,sdf:m,version:0})}}updateImage(b,s){const u=this.style.getImage(b);if(!u)return this.fire(new c.k(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const _=s instanceof HTMLImageElement||c.b(s)?X.getImageData(s):s,{width:m,height:v,data:w}=_;if(m===void 0||v===void 0)return this.fire(new c.k(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(m!==u.data.width||v!==u.data.height)return this.fire(new c.k(new Error("The width and height of the updated image must be that same as the previous version of the image")));const S=!(s instanceof HTMLImageElement||c.b(s));return u.data.replace(w,S),this.style.updateImage(b,u),this}getImage(b){return this.style.getImage(b)}hasImage(b){return b?!!this.style.getImage(b):(this.fire(new c.k(new Error("Missing required image id"))),!1)}removeImage(b){this.style.removeImage(b)}loadImage(b){return ae.getImage(this._requestManager.transformRequest(b,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(b,s){return this._lazyInitEmptyStyle(),this.style.addLayer(b,s),this._update(!0)}moveLayer(b,s){return this.style.moveLayer(b,s),this._update(!0)}removeLayer(b){return this.style.removeLayer(b),this._update(!0)}getLayer(b){return this.style.getLayer(b)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(b,s,u){return this.style.setLayerZoomRange(b,s,u),this._update(!0)}setFilter(b,s,u={}){return this.style.setFilter(b,s,u),this._update(!0)}getFilter(b){return this.style.getFilter(b)}setPaintProperty(b,s,u,_={}){return this.style.setPaintProperty(b,s,u,_),this._update(!0)}getPaintProperty(b,s){return this.style.getPaintProperty(b,s)}setLayoutProperty(b,s,u,_={}){return this.style.setLayoutProperty(b,s,u,_),this._update(!0)}getLayoutProperty(b,s){return this.style.getLayoutProperty(b,s)}setGlyphs(b,s={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(b,s),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(b,s,u={}){return this._lazyInitEmptyStyle(),this.style.addSprite(b,s,u,(_=>{_||this._update(!0)})),this}removeSprite(b){return this._lazyInitEmptyStyle(),this.style.removeSprite(b),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(b,s={}){return this._lazyInitEmptyStyle(),this.style.setSprite(b,s,(u=>{u||this._update(!0)})),this}setLight(b,s={}){return this._lazyInitEmptyStyle(),this.style.setLight(b,s),this._update(!0)}getLight(){return this.style.getLight()}setSky(b,s={}){return this._lazyInitEmptyStyle(),this.style.setSky(b,s),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(b,s){return this.style.setFeatureState(b,s),this._update()}removeFeatureState(b,s){return this.style.removeFeatureState(b,s),this._update()}getFeatureState(b){return this.style.getFeatureState(b)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let b=0,s=0;return this._container&&(b=this._container.clientWidth||400,s=this._container.clientHeight||300),[b,s]}_setupContainer(){const b=this._container;b.classList.add("maplibregl-map");const s=this._canvasContainer=K.create("div","maplibregl-canvas-container",b);this._interactive&&s.classList.add("maplibregl-interactive"),this._canvas=K.create("canvas","maplibregl-canvas",s),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const u=this._containerDimensions(),_=this._getClampedPixelRatio(u[0],u[1]);this._resizeCanvas(u[0],u[1],_);const m=this._controlContainer=K.create("div","maplibregl-control-container",b),v=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((w=>{v[w]=K.create("div",`maplibregl-ctrl-${w} `,m)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(b,s,u){this._canvas.width=Math.floor(u*b),this._canvas.height=Math.floor(u*s),this._canvas.style.width=`${b}px`,this._canvas.style.height=`${s}px`}_setupPainter(){const b=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0});let s=null;this._canvas.addEventListener("webglcontextcreationerror",(_=>{s={requestedAttributes:b},_&&(s.statusMessage=_.statusMessage,s.type=_.type)}),{once:!0});let u=null;if(u=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,b):this._canvas.getContext("webgl2",b)||this._canvas.getContext("webgl",b),!u){const _="Failed to initialize WebGL";throw s?(s.message=_,new Error(JSON.stringify(s))):new Error(_)}this.painter=new Qp(u,this.transform),It.testSupport(u)}migrateProjection(b,s){super.migrateProjection(b,s),this.painter.transform=b,this.fire(new c.l("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(b){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||b,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(b){return this._update(),this._renderTaskQueue.add(b)}_cancelRenderFrame(b){this._renderTaskQueue.remove(b)}_render(b){var s,u,_,m,v;const w=this._idleTriggered?this._fadeDuration:0,S=((s=this.style.projection)===null||s===void 0?void 0:s.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(b),this._removed)return;let I=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const U=this.transform.zoom,k=nt();this.style.zoomHistory.update(U,k);const j=new c.G(U,{now:k,fadeDuration:w,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),W=j.crossFadingFactor();W===1&&W===this._crossFadingFactor||(I=!0,this._crossFadingFactor=W),this.style.update(j)}const B=((u=this.style.projection)===null||u===void 0?void 0:u.transitionState)>0!==S;(_=this.style.projection)===null||_===void 0||_.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState((m=this.style.projection)===null||m===void 0?void 0:m.transitionState,(v=this.style.projection)===null||v===void 0?void 0:v.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||B)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.tileManager.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,w,this._crossSourceCollisions,B),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:w,showPadding:this.showPadding}),this.fire(new c.l("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,c.cA.mark(c.cB.load),this.fire(new c.l("load"))),this.style&&(this.style.hasTransitions()||I)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const D=this._sourcesDirty||this._styleDirty||this._placementDirty;return D||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new c.l("idle")),!this._loaded||this._fullyLoaded||D||(this._fullyLoaded=!0,c.cA.mark(c.cB.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var b;this._hash&&this._hash.remove();for(const u of this._controls)u.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),ae.removeThrottleControl(this._imageQueueHandle),(b=this._resizeObserver)===null||b===void 0||b.disconnect();const s=this.painter.context.gl.getExtension("WEBGL_lose_context");s?.loseContext&&s.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),K.remove(this._canvasContainer),K.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),c.cA.clearMetrics(),this._removed=!0,this.fire(new c.l("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,X.frame(this._frameRequest,(b=>{c.cA.frame(b),this._frameRequest=null;try{this._render(b)}catch(s){if(!c.cC(s)&&!(function(u){return u.message===su})(s))throw s}}),(()=>{})))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(b){this._showTileBoundaries!==b&&(this._showTileBoundaries=b,this._update())}get showPadding(){return!!this._showPadding}set showPadding(b){this._showPadding!==b&&(this._showPadding=b,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(b){this._showCollisionBoxes!==b&&(this._showCollisionBoxes=b,b?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(b){this._showOverdrawInspector!==b&&(this._showOverdrawInspector=b,this._update())}get repaint(){return!!this._repaint}set repaint(b){this._repaint!==b&&(this._repaint=b,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(b){this._vertices=b,this._update()}get version(){return xu}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(b){return this._lazyInitEmptyStyle(),this.style.setProjection(b),this._update(!0)}},f.MapMouseEvent=Nr,f.MapTouchEvent=Pl,f.MapWheelEvent=Vo,f.Marker=Vl,f.NavigationControl=class{constructor(b){this._updateZoomButtons=()=>{const s=this._map.getZoom(),u=s===this._map.getMaxZoom(),_=s===this._map.getMinZoom();this._zoomInButton.disabled=u,this._zoomOutButton.disabled=_,this._zoomInButton.setAttribute("aria-disabled",u.toString()),this._zoomOutButton.setAttribute("aria-disabled",_.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(s,u)=>{const _=this._map._getUIString(`NavigationControl.${u}`);s.title=_,s.setAttribute("aria-label",_)},this.options=c.e({},Ad,b),this._container=K.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",(s=>s.preventDefault())),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",(s=>this._map.zoomIn({},{originalEvent:s}))),K.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",(s=>this._map.zoomOut({},{originalEvent:s}))),K.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",(s=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:s}):this._map.resetNorth({},{originalEvent:s})})),this._compassIcon=K.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(b){return this._map=b,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Ed(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){K.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(b,s){const u=K.create("button",b,this._container);return u.type="button",u.addEventListener("click",s),u}},f.Popup=class extends c.E{constructor(b){super(),this._updateOpacity=()=>{this.options.locationOccludedOpacity!==void 0&&(this._container.style.opacity=this._map.transform.isLocationOccluded(this.getLngLat())?`${this.options.locationOccludedOpacity}`:"")},this.remove=()=>(this._content&&K.remove(this._content),this._container&&(K.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new c.l("close"))),this),this._onMouseUp=s=>{this._update(s.point)},this._onMouseMove=s=>{this._update(s.point)},this._onDrag=s=>{this._update(s.point)},this._update=s=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=K.create("div","maplibregl-popup",this._map.getContainer()),this._tip=K.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const w of this.options.className.split(" "))this._container.classList.add(w);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=Tu(this._lngLat,this._flatPos,this._map.transform,this._trackPointer),this._trackPointer&&!s)return;const u=this._flatPos=this._pos=this._trackPointer&&s?s:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&s?s:this._map.transform.locationToScreenPoint(this._lngLat));let _=this.options.anchor;const m=jl(this.options.offset);if(!_){const w=this._container.offsetWidth,S=this._container.offsetHeight;let I;I=u.y+m.bottom.y<S?["top"]:u.y>this._map.transform.height-S?["bottom"]:[],u.x<w/2?I.push("left"):u.x>this._map.transform.width-w/2&&I.push("right"),_=I.length===0?"bottom":I.join("-")}let v=u.add(m[_]);this.options.subpixelPositioning||(v=v.round()),K.setTransform(this._container,`${zl[_]} translate(${v.x}px,${v.y}px)`),Au(this._container,_,"popup"),this._updateOpacity()},this._onClose=()=>{this.remove()},this.options=c.e(Object.create(Id),b)}addTo(b){return this._map&&this.remove(),this._map=b,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new c.l("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(b){return this._lngLat=c.U.convert(b),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(b){return this.setDOMContent(document.createTextNode(b))}setHTML(b){const s=document.createDocumentFragment(),u=document.createElement("body");let _;for(u.innerHTML=b;_=u.firstChild,_;)s.appendChild(_);return this.setDOMContent(s)}getMaxWidth(){var b;return(b=this._container)===null||b===void 0?void 0:b.style.maxWidth}setMaxWidth(b){return this.options.maxWidth=b,this._update(),this}setDOMContent(b){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=K.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(b),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(b){return this._container&&this._container.classList.add(b),this}removeClassName(b){return this._container&&this._container.classList.remove(b),this}setOffset(b){return this.options.offset=b,this._update(),this}toggleClassName(b){if(this._container)return this._container.classList.toggle(b)}setSubpixelPositioning(b){this.options.subpixelPositioning=b}_createCloseButton(){this.options.closeButton&&(this._closeButton=K.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const b=this._container.querySelector(Md);b&&b.focus()}},f.RasterDEMTileSource=$r,f.RasterTileSource=Os,f.ScaleControl=class{constructor(b){this._onMove=()=>{Eu(this._map,this._container,this.options)},this.setUnit=s=>{this.options.unit=s,Eu(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},Cd),b)}getDefaultPosition(){return"bottom-left"}onAdd(b){return this._map=b,this._container=K.create("div","maplibregl-ctrl maplibregl-ctrl-scale",b.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){K.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},f.ScrollZoomHandler=yu,f.Style=ml,f.TerrainControl=class{constructor(b){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=b}onAdd(b){return this._map=b,this._container=K.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=K.create("button","maplibregl-ctrl-terrain",this._container),K.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){K.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},f.TwoFingersTouchPitchHandler=c_,f.TwoFingersTouchRotateHandler=l_,f.TwoFingersTouchZoomHandler=a_,f.TwoFingersTouchZoomRotateHandler=kl,f.VectorTileSource=as,f.VideoSource=Po,f.addSourceType=(b,s)=>c._(void 0,void 0,void 0,(function*(){if(Fn(b))throw new Error(`A source type called "${b}" already exists.`);((u,_)=>{fn[u]=_})(b,s)})),f.clearPrewarmedResources=function(){const b=ur;b&&(b.isPreloaded()&&b.numActive()===1?(b.release(vs),ur=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},f.createTileMesh=jc,f.getMaxParallelImageRequests=function(){return c.a.MAX_PARALLEL_IMAGE_REQUESTS},f.getRTLTextPluginStatus=function(){return ls().getRTLTextPluginStatus()},f.getVersion=function(){return Rd},f.getWorkerCount=function(){return hn.workerCount},f.getWorkerUrl=function(){return c.a.WORKER_URL},f.importScriptInWorkers=function(b){return xs().broadcast("IS",b)},f.isTimeFrozen=function(){return at.isFrozen()},f.now=nt,f.prewarm=function(){hr().acquire(vs)},f.restoreNow=function(){at.restoreNow()},f.setMaxParallelImageRequests=function(b){c.a.MAX_PARALLEL_IMAGE_REQUESTS=b},f.setNow=function(b){at.setNow(b)},f.setRTLTextPlugin=function(b,s){return ls().setRTLTextPlugin(b,s)},f.setWorkerCount=function(b){hn.workerCount=b},f.setWorkerUrl=function(b){c.a.WORKER_URL=b}}));var d=r;return d}))})(Qd)),Qd.exports}var Se=QS();const qu=Ql({__proto__:null,default:mb(Se)},[Se]);async function Zu(e,t,r,n){return n._parse(e,t,r,n)}function Ar(e,t){if(!e)throw new Error(t||"loader assertion failed.")}const tf=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),bb=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);bb&&parseFloat(bb[1]);const vb=globalThis,xb=globalThis.process||{},tC=globalThis.navigator||{};function wb(e){if(typeof window<"u"&&window.process?.type==="renderer"||typeof process<"u"&&process.versions?.electron)return!0;const r=typeof navigator<"u"&&navigator.userAgent;return!!(r&&r.indexOf("Electron")>=0)}function Zo(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process?.browser)||wb()}function eC(e){return Zo()?wb()?"Electron":(tC.userAgent||"").indexOf("Edge")>-1?"Edge":globalThis.chrome?"Chrome":globalThis.safari?"Safari":globalThis.mozInnerScreenX?"Firefox":"Unknown":"Node"}const Tb="4.0.7";function rC(e){try{const t=window[e],r="__storage_test__";return t.setItem(r,r),t.removeItem(r),t}catch{return null}}class iC{constructor(t,r,n="sessionStorage"){this.storage=rC(n),this.id=t,this.config=r,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(t){if(Object.assign(this.config,t),this.storage){const r=JSON.stringify(this.config);this.storage.setItem(this.id,r)}}_loadConfiguration(){let t={};if(this.storage){const r=this.storage.getItem(this.id);t=r?JSON.parse(r):{}}return Object.assign(this.config,t),this}}function sC(e){let t;return e<10?t=`${e.toFixed(2)}ms`:e<100?t=`${e.toFixed(1)}ms`:e<1e3?t=`${e.toFixed(0)}ms`:t=`${(e/1e3).toFixed(2)}s`,t}function nC(e,t=8){const r=Math.max(t-e.length,0);return`${" ".repeat(r)}${e}`}var ef;(function(e){e[e.BLACK=30]="BLACK",e[e.RED=31]="RED",e[e.GREEN=32]="GREEN",e[e.YELLOW=33]="YELLOW",e[e.BLUE=34]="BLUE",e[e.MAGENTA=35]="MAGENTA",e[e.CYAN=36]="CYAN",e[e.WHITE=37]="WHITE",e[e.BRIGHT_BLACK=90]="BRIGHT_BLACK",e[e.BRIGHT_RED=91]="BRIGHT_RED",e[e.BRIGHT_GREEN=92]="BRIGHT_GREEN",e[e.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",e[e.BRIGHT_BLUE=94]="BRIGHT_BLUE",e[e.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",e[e.BRIGHT_CYAN=96]="BRIGHT_CYAN",e[e.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(ef||(ef={}));const oC=10;function Ab(e){return typeof e!="string"?e:(e=e.toUpperCase(),ef[e]||ef.WHITE)}function aC(e,t,r){return!Zo&&typeof e=="string"&&(t&&(e=`\x1B[${Ab(t)}m${e}\x1B[39m`),r&&(e=`\x1B[${Ab(r)+oC}m${e}\x1B[49m`)),e}function lC(e,t=["constructor"]){const r=Object.getPrototypeOf(e),n=Object.getOwnPropertyNames(r),a=e;for(const d of n){const f=a[d];typeof f=="function"&&(t.find(c=>d===c)||(a[d]=f.bind(e)))}}function q_(e,t){if(!e)throw new Error("Assertion failed")}function tc(){let e;if(Zo()&&vb.performance)e=vb?.performance?.now?.();else if("hrtime"in xb){const t=xb?.hrtime?.();e=t[0]*1e3+t[1]/1e6}else e=Date.now();return e}const ec={debug:Zo()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},cC={enabled:!0,level:0};function rc(){}const Eb={},Sb={once:!0};class ic{constructor({id:t}={id:""}){this.VERSION=Tb,this._startTs=tc(),this._deltaTs=tc(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=t,this.userData={},this._storage=new iC(`__probe-${this.id}__`,cC),this.timeStamp(`${this.id} started`),lC(this),Object.seal(this)}set level(t){this.setLevel(t)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((tc()-this._startTs).toPrecision(10))}getDelta(){return Number((tc()-this._deltaTs).toPrecision(10))}set priority(t){this.level=t}get priority(){return this.level}getPriority(){return this.level}enable(t=!0){return this._storage.setConfiguration({enabled:t}),this}setLevel(t){return this._storage.setConfiguration({level:t}),this}get(t){return this._storage.config[t]}set(t,r){this._storage.setConfiguration({[t]:r})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(t,r){if(!t)throw new Error(r||"Assertion failed")}warn(t){return this._getLogFunction(0,t,ec.warn,arguments,Sb)}error(t){return this._getLogFunction(0,t,ec.error,arguments)}deprecated(t,r){return this.warn(`\`${t}\` is deprecated and will be removed in a later version. Use \`${r}\` instead`)}removed(t,r){return this.error(`\`${t}\` has been removed. Use \`${r}\` instead`)}probe(t,r){return this._getLogFunction(t,r,ec.log,arguments,{time:!0,once:!0})}log(t,r){return this._getLogFunction(t,r,ec.debug,arguments)}info(t,r){return this._getLogFunction(t,r,console.info,arguments)}once(t,r){return this._getLogFunction(t,r,ec.debug||ec.info,arguments,Sb)}table(t,r,n){return r?this._getLogFunction(t,r,console.table||rc,n&&[n],{tag:hC(r)}):rc}time(t,r){return this._getLogFunction(t,r,console.time?console.time:console.info)}timeEnd(t,r){return this._getLogFunction(t,r,console.timeEnd?console.timeEnd:console.info)}timeStamp(t,r){return this._getLogFunction(t,r,console.timeStamp||rc)}group(t,r,n={collapsed:!1}){const a=Ib({logLevel:t,message:r,opts:n}),{collapsed:d}=n;return a.method=(d?console.groupCollapsed:console.group)||console.info,this._getLogFunction(a)}groupCollapsed(t,r,n={}){return this.group(t,r,Object.assign({},n,{collapsed:!0}))}groupEnd(t){return this._getLogFunction(t,"",console.groupEnd||rc)}withGroup(t,r,n){this.group(t,r)();try{n()}finally{this.groupEnd(t)()}}trace(){console.trace&&console.trace()}_shouldLog(t){return this.isEnabled()&&this.getLevel()>=Cb(t)}_getLogFunction(t,r,n,a,d){if(this._shouldLog(t)){d=Ib({logLevel:t,message:r,args:a,opts:d}),n=n||d.method,q_(n),d.total=this.getTotal(),d.delta=this.getDelta(),this._deltaTs=tc();const f=d.tag||d.message;if(d.once&&f)if(!Eb[f])Eb[f]=tc();else return rc;return r=uC(this.id,d.message,d),n.bind(console,r,...d.args)}return rc}}ic.VERSION=Tb;function Cb(e){if(!e)return 0;let t;switch(typeof e){case"number":t=e;break;case"object":t=e.logLevel||e.priority||0;break;default:return 0}return q_(Number.isFinite(t)&&t>=0),t}function Ib(e){const{logLevel:t,message:r}=e;e.logLevel=Cb(t);const n=e.args?Array.from(e.args):[];for(;n.length&&n.shift()!==r;);switch(typeof t){case"string":case"function":r!==void 0&&n.unshift(r),e.message=t;break;case"object":Object.assign(e,t);break}typeof e.message=="function"&&(e.message=e.message());const a=typeof e.message;return q_(a==="string"||a==="object"),Object.assign(e,{args:n},e.opts)}function uC(e,t,r){if(typeof t=="string"){const n=r.time?nC(sC(r.total)):"";t=r.time?`${e}: ${n}  ${t}`:`${e}: ${t}`,t=aC(t,r.color,r.background)}return t}function hC(e){for(const t in e)for(const r in e[t])return r||"untitled";return"empty"}globalThis.probe={};const Mb=new ic({id:"@probe.gl/log"}),Z_="4.3.1",dC=Z_[0]>="0"&&Z_[0]<="9"?`v${Z_}`:"";function fC(){const e=new ic({id:"loaders.gl"});return globalThis.loaders=globalThis.loaders||{},globalThis.loaders.log=e,globalThis.loaders.version=dC,globalThis.probe=globalThis.probe||{},globalThis.probe.loaders=e,e}const pC=fC();function _C(e,t){return Rb(e||{},t)}function Rb(e,t,r=0){if(r>3)return t;const n={...e};for(const[a,d]of Object.entries(t))d&&typeof d=="object"&&!Array.isArray(d)?n[a]=Rb(n[a]||{},t[a],r+1):n[a]=t[a];return n}function gC(e){globalThis.loaders||={},globalThis.loaders.modules||={},Object.assign(globalThis.loaders.modules,e)}function mC(e){return globalThis.loaders?.modules?.[e]||null}const yC="latest";function bC(){return globalThis._loadersgl_?.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.3.1"),globalThis._loadersgl_.version}const Pb=bC();function wo(e,t){if(!e)throw new Error(t||"loaders.gl assertion failed.")}const nn=typeof process!="object"||String(process)!=="[object process]"||process.browser,Y_=typeof importScripts=="function",vC=typeof window<"u"&&typeof window.orientation<"u",Bb=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);Bb&&parseFloat(Bb[1]);class xC{name;workerThread;isRunning=!0;result;_resolve=()=>{};_reject=()=>{};constructor(t,r){this.name=t,this.workerThread=r,this.result=new Promise((n,a)=>{this._resolve=n,this._reject=a})}postMessage(t,r){this.workerThread.postMessage({source:"loaders.gl",type:t,payload:r})}done(t){wo(this.isRunning),this.isRunning=!1,this._resolve(t)}error(t){wo(this.isRunning),this.isRunning=!1,this._reject(t)}}class K_{terminate(){}}const J_=new Map;function wC(e){wo(e.source&&!e.url||!e.source&&e.url);let t=J_.get(e.source||e.url);return t||(e.url&&(t=TC(e.url),J_.set(e.url,t)),e.source&&(t=Db(e.source),J_.set(e.source,t))),wo(t),t}function TC(e){if(!e.startsWith("http"))return e;const t=AC(e);return Db(t)}function Db(e){const t=new Blob([e],{type:"application/javascript"});return URL.createObjectURL(t)}function AC(e){return`try {
  importScripts('${e}');
} catch (error) {
  console.error(error);
  throw error;
}`}function Fb(e,t=!0,r){const n=r||new Set;if(e){if(Ob(e))n.add(e);else if(Ob(e.buffer))n.add(e.buffer);else if(!ArrayBuffer.isView(e)){if(t&&typeof e=="object")for(const a in e)Fb(e[a],t,n)}}return r===void 0?Array.from(n):[]}function Ob(e){return e?e instanceof ArrayBuffer||typeof MessagePort<"u"&&e instanceof MessagePort||typeof ImageBitmap<"u"&&e instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas:!1}const Q_=()=>{};class tg{name;source;url;terminated=!1;worker;onMessage;onError;_loadableURL="";static isSupported(){return typeof Worker<"u"&&nn||typeof K_<"u"&&!nn}constructor(t){const{name:r,source:n,url:a}=t;wo(n||a),this.name=r,this.source=n,this.url=a,this.onMessage=Q_,this.onError=d=>console.log(d),this.worker=nn?this._createBrowserWorker():this._createNodeWorker()}destroy(){this.onMessage=Q_,this.onError=Q_,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(t,r){r=r||Fb(t),this.worker.postMessage(t,r)}_getErrorFromErrorEvent(t){let r="Failed to load ";return r+=`worker ${this.name} from ${this.url}. `,t.message&&(r+=`${t.message} in `),t.lineno&&(r+=`:${t.lineno}:${t.colno}`),new Error(r)}_createBrowserWorker(){this._loadableURL=wC({source:this.source,url:this.url});const t=new Worker(this._loadableURL,{name:this.name});return t.onmessage=r=>{r.data?this.onMessage(r.data):this.onError(new Error("No data received"))},t.onerror=r=>{this.onError(this._getErrorFromErrorEvent(r)),this.terminated=!0},t.onmessageerror=r=>console.error(r),t}_createNodeWorker(){let t;if(this.url){const n=this.url.includes(":/")||this.url.startsWith("/")?this.url:`./${this.url}`;t=new K_(n,{eval:!1})}else if(this.source)t=new K_(this.source,{eval:!0});else throw new Error("no worker");return t.on("message",r=>{this.onMessage(r)}),t.on("error",r=>{this.onError(r)}),t.on("exit",r=>{}),t}}class EC{name="unnamed";source;url;maxConcurrency=1;maxMobileConcurrency=1;onDebug=()=>{};reuseWorkers=!0;props={};jobQueue=[];idleQueue=[];count=0;isDestroyed=!1;static isSupported(){return tg.isSupported()}constructor(t){this.source=t.source,this.url=t.url,this.setProps(t)}destroy(){this.idleQueue.forEach(t=>t.destroy()),this.isDestroyed=!0}setProps(t){this.props={...this.props,...t},t.name!==void 0&&(this.name=t.name),t.maxConcurrency!==void 0&&(this.maxConcurrency=t.maxConcurrency),t.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=t.maxMobileConcurrency),t.reuseWorkers!==void 0&&(this.reuseWorkers=t.reuseWorkers),t.onDebug!==void 0&&(this.onDebug=t.onDebug)}async startJob(t,r=(a,d,f)=>a.done(f),n=(a,d)=>a.error(d)){const a=new Promise(d=>(this.jobQueue.push({name:t,onMessage:r,onError:n,onStart:d}),this));return this._startQueuedJob(),await a}async _startQueuedJob(){if(!this.jobQueue.length)return;const t=this._getAvailableWorker();if(!t)return;const r=this.jobQueue.shift();if(r){this.onDebug({message:"Starting job",name:r.name,workerThread:t,backlog:this.jobQueue.length});const n=new xC(r.name,t);t.onMessage=a=>r.onMessage(n,a.type,a.payload),t.onError=a=>r.onError(n,a),r.onStart(n);try{await n.result}catch(a){console.error(`Worker exception: ${a}`)}finally{this.returnWorkerToQueue(t)}}}returnWorkerToQueue(t){!nn||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(t.destroy(),this.count--):this.idleQueue.push(t),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const t=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new tg({name:t,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return vC?this.maxMobileConcurrency:this.maxConcurrency}}const SC={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}};class Yo{props;workerPools=new Map;static _workerFarm;static isSupported(){return tg.isSupported()}static getWorkerFarm(t={}){return Yo._workerFarm=Yo._workerFarm||new Yo({}),Yo._workerFarm.setProps(t),Yo._workerFarm}constructor(t){this.props={...SC},this.setProps(t),this.workerPools=new Map}destroy(){for(const t of this.workerPools.values())t.destroy();this.workerPools=new Map}setProps(t){this.props={...this.props,...t};for(const r of this.workerPools.values())r.setProps(this._getWorkerPoolProps())}getWorkerPool(t){const{name:r,source:n,url:a}=t;let d=this.workerPools.get(r);return d||(d=new EC({name:r,source:n,url:a}),d.setProps(this._getWorkerPoolProps()),this.workerPools.set(r,d)),d}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}function CC(e,t={}){const r=t[e.id]||{},n=nn?`${e.id}-worker.js`:`${e.id}-worker-node.js`;let a=r.workerUrl;if(!a&&e.id==="compression"&&(a=t.workerUrl),t._workerType==="test"&&(nn?a=`modules/${e.module}/dist/${n}`:a=`modules/${e.module}/src/workers/${e.id}-worker-node.ts`),!a){let d=e.version;d==="latest"&&(d=yC);const f=d?`@${d}`:"";a=`https://unpkg.com/@loaders.gl/${e.module}${f}/dist/${n}`}return wo(a),a}function IC(e,t=Pb){wo(e,"no worker provided");const r=e.version;return!(!t||!r)}const eg={};async function Ga(e,t=null,r={},n=null){return t&&(e=MC(e,t,r,n)),eg[e]=eg[e]||RC(e),await eg[e]}function MC(e,t,r={},n=null){if(!r.useLocalLibraries&&e.startsWith("http"))return e;n=n||e;const a=r.modules||{};return a[n]?a[n]:nn?r.CDN?(wo(r.CDN.startsWith("http")),`${r.CDN}/${t}@${Pb}/dist/libs/${n}`):Y_?`../src/libs/${n}`:`modules/${t}/src/libs/${n}`:`modules/${t}/dist/libs/${n}`}async function RC(e){if(e.endsWith("wasm"))return await BC(e);if(!nn)try{const{requireFromFile:r}=globalThis.loaders||{};return await r?.(e)}catch(r){return console.error(r),null}if(Y_)return importScripts(e);const t=await DC(e);return PC(t,e)}function PC(e,t){if(!nn){const{requireFromString:n}=globalThis.loaders||{};return n?.(e,t)}if(Y_)return eval.call(globalThis,e),null;const r=document.createElement("script");r.id=t;try{r.appendChild(document.createTextNode(e))}catch{r.text=e}return document.body.appendChild(r),null}async function BC(e){const{readFileAsArrayBuffer:t}=globalThis.loaders||{};return nn||!t||e.startsWith("http")?await(await fetch(e)).arrayBuffer():await t(e)}async function DC(e){const{readFileAsText:t}=globalThis.loaders||{};return nn||!t||e.startsWith("http")?await(await fetch(e)).text():await t(e)}function FC(e,t){return!Yo.isSupported()||!nn&&!t?._nodeWorkers?!1:e.worker&&t?.worker}async function OC(e,t,r,n,a){const d=e.id,f=CC(e,r),T=Yo.getWorkerFarm(r).getWorkerPool({name:d,url:f});r=JSON.parse(JSON.stringify(r)),n=JSON.parse(JSON.stringify(n||{}));const C=await T.startJob("process-on-worker",kC.bind(null,a));return C.postMessage("process",{input:t,options:r,context:n}),await(await C.result).result}async function kC(e,t,r,n){switch(r){case"done":t.done(n);break;case"error":t.error(new Error(n.error));break;case"process":const{id:a,input:d,options:f}=n;try{const c=await e(d,f);t.postMessage("done",{id:a,result:c})}catch(c){const T=c instanceof Error?c.message:"unknown error";t.postMessage("error",{id:a,error:T})}break;default:console.warn(`parse-with-worker unknown message ${r}`)}}function NC(e,t=5){return typeof e=="string"?e.slice(0,t):ArrayBuffer.isView(e)?kb(e.buffer,e.byteOffset,t):e instanceof ArrayBuffer?kb(e,0,t):""}function kb(e,t,r){if(e.byteLength<=t+r)return"";const n=new DataView(e);let a="";for(let d=0;d<r;d++)a+=String.fromCharCode(n.getUint8(t+d));return a}function LC(e){try{return JSON.parse(e)}catch{throw new Error(`Failed to parse JSON from data starting with "${NC(e)}"`)}}function UC(e,t,r){if(r=r||e.byteLength,e.byteLength<r||t.byteLength<r)return!1;const n=new Uint8Array(e),a=new Uint8Array(t);for(let d=0;d<n.length;++d)if(n[d]!==a[d])return!1;return!0}function zC(...e){return VC(e)}function VC(e){const t=e.map(d=>d instanceof ArrayBuffer?new Uint8Array(d):d),r=t.reduce((d,f)=>d+f.byteLength,0),n=new Uint8Array(r);let a=0;for(const d of t)n.set(d,a),a+=d.byteLength;return n.buffer}function rg(e,t,r){const n=r!==void 0?new Uint8Array(e).subarray(t,t+r):new Uint8Array(e).subarray(t);return new Uint8Array(n).buffer}function Yu(e,t){return Ar(e>=0),Ar(t>0),e+(t-1)&-4}function jC(e,t,r){let n;if(e instanceof ArrayBuffer)n=new Uint8Array(e);else{const a=e.byteOffset,d=e.byteLength;n=new Uint8Array(e.buffer||e.arrayBuffer,a,d)}return t.set(n,r),r+Yu(n.byteLength,4)}async function HC(e){const t=[];for await(const r of e)t.push(r);return zC(...t)}function Nb(){let e;if(typeof window<"u"&&window.performance)e=window.performance.now();else if(typeof process<"u"&&process.hrtime){const t=process.hrtime();e=t[0]*1e3+t[1]/1e6}else e=Date.now();return e}class Lb{constructor(t,r){this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=t,this.type=r,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(t){return this.sampleSize=t,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(t){return this._count+=t,this._samples++,this._checkSampling(),this}subtractCount(t){return this._count-=t,this._samples++,this._checkSampling(),this}addTime(t){return this._time+=t,this.lastTiming=t,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=Nb(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(Nb()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class sc{constructor(t){this.stats={},this.id=t.id,this.stats={},this._initializeStats(t.stats),Object.seal(this)}get(t,r="count"){return this._getOrCreate({name:t,type:r})}get size(){return Object.keys(this.stats).length}reset(){for(const t of Object.values(this.stats))t.reset();return this}forEach(t){for(const r of Object.values(this.stats))t(r)}getTable(){const t={};return this.forEach(r=>{t[r.name]={time:r.time||0,count:r.count||0,average:r.getAverageTime()||0,hz:r.getHz()||0}}),t}_initializeStats(t=[]){t.forEach(r=>this._getOrCreate(r))}_getOrCreate(t){const{name:r,type:n}=t;let a=this.stats[r];return a||(t instanceof Lb?a=t:a=new Lb(r,n),this.stats[r]=a),a}}const GC="Queued Requests",$C="Active Requests",WC="Cancelled Requests",XC="Queued Requests Ever",qC="Active Requests Ever",ZC={id:"request-scheduler",throttleRequests:!0,maxRequests:6,debounceTime:0};class YC{props;stats;activeRequestCount=0;requestQueue=[];requestMap=new Map;updateTimer=null;constructor(t={}){this.props={...ZC,...t},this.stats=new sc({id:this.props.id}),this.stats.get(GC),this.stats.get($C),this.stats.get(WC),this.stats.get(XC),this.stats.get(qC)}scheduleRequest(t,r=()=>0){if(!this.props.throttleRequests)return Promise.resolve({done:()=>{}});if(this.requestMap.has(t))return this.requestMap.get(t);const n={handle:t,priority:0,getPriority:r},a=new Promise(d=>(n.resolve=d,n));return this.requestQueue.push(n),this.requestMap.set(t,a),this._issueNewRequests(),a}_issueRequest(t){const{handle:r,resolve:n}=t;let a=!1;const d=()=>{a||(a=!0,this.requestMap.delete(r),this.activeRequestCount--,this._issueNewRequests())};return this.activeRequestCount++,n?n({done:d}):Promise.resolve({done:d})}_issueNewRequests(){this.updateTimer!==null&&clearTimeout(this.updateTimer),this.updateTimer=setTimeout(()=>this._issueNewRequestsAsync(),this.props.debounceTime)}_issueNewRequestsAsync(){this.updateTimer!==null&&clearTimeout(this.updateTimer),this.updateTimer=null;const t=Math.max(this.props.maxRequests-this.activeRequestCount,0);if(t!==0){this._updateAllRequests();for(let r=0;r<t;++r){const n=this.requestQueue.shift();n&&this._issueRequest(n)}}}_updateAllRequests(){const t=this.requestQueue;for(let r=0;r<t.length;++r){const n=t[r];this._updateRequest(n)||(t.splice(r,1),this.requestMap.delete(n.handle),r--)}t.sort((r,n)=>r.priority-n.priority)}_updateRequest(t){return t.priority=t.getPriority(t.handle),t.priority<0?(t.resolve(null),!1):!0}}let KC="";const Ub={};function JC(e){for(const t in Ub)if(e.startsWith(t)){const r=Ub[t];e=e.replace(t,r)}return!e.startsWith("http://")&&!e.startsWith("https://")&&(e=`${KC}${e}`),e}function lj(e){return e}function QC(e){return e&&typeof e=="object"&&e.isBuffer}function zb(e){if(QC(e))return e;if(e instanceof ArrayBuffer)return e;if(ArrayBuffer.isView(e))return e.byteOffset===0&&e.byteLength===e.buffer.byteLength?e.buffer:e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength);if(typeof e=="string"){const t=e;return new TextEncoder().encode(t).buffer}if(e&&typeof e=="object"&&e._toArrayBuffer)return e._toArrayBuffer();throw new Error("toArrayBuffer")}function t2(){if(typeof process<"u"&&typeof process.cwd<"u")return process.cwd();const e=window.location?.pathname;return e?.slice(0,e.lastIndexOf("/")+1)||""}function Vb(e){const t=e?e.lastIndexOf("/"):-1;return t>=0?e.substr(t+1):""}function ig(e){const t=e?e.lastIndexOf("/"):-1;return t>=0?e.substr(0,t):""}function e2(...e){const t=[];for(let d=0;d<e.length;d++)t[d]=e[d];let r="",n=!1,a;for(let d=t.length-1;d>=-1&&!n;d--){let f;d>=0?f=t[d]:(a===void 0&&(a=t2()),f=a),f.length!==0&&(r=`${f}/${r}`,n=f.charCodeAt(0)===Ku)}return r=r2(r,!n),n?`/${r}`:r.length>0?r:"."}const Ku=47,sg=46;function r2(e,t){let r="",n=-1,a=0,d,f=!1;for(let c=0;c<=e.length;++c){if(c<e.length)d=e.charCodeAt(c);else{if(d===Ku)break;d=Ku}if(d===Ku){if(!(n===c-1||a===1))if(n!==c-1&&a===2){if(r.length<2||!f||r.charCodeAt(r.length-1)!==sg||r.charCodeAt(r.length-2)!==sg){if(r.length>2){const T=r.length-1;let C=T;for(;C>=0&&r.charCodeAt(C)!==Ku;--C);if(C!==T){r=C===-1?"":r.slice(0,C),n=c,a=0,f=!1;continue}}else if(r.length===2||r.length===1){r="",n=c,a=0,f=!1;continue}}t&&(r.length>0?r+="/..":r="..",f=!0)}else{const T=e.slice(n+1,c);r.length>0?r+=`/${T}`:r=T,f=!1}n=c,a=0}else d===sg&&a!==-1?++a:a=-1}return r}const i2=e=>typeof e=="boolean",Ju=e=>typeof e=="function",Qu=e=>e!==null&&typeof e=="object",jb=e=>Qu(e)&&e.constructor==={}.constructor,s2=e=>!!e&&typeof e[Symbol.iterator]=="function",n2=e=>e&&typeof e[Symbol.asyncIterator]=="function",$a=e=>typeof Response<"u"&&e instanceof Response||e&&e.arrayBuffer&&e.text&&e.json,Wa=e=>typeof Blob<"u"&&e instanceof Blob,o2=e=>e&&typeof e=="object"&&e.isBuffer,a2=e=>typeof ReadableStream<"u"&&e instanceof ReadableStream||Qu(e)&&Ju(e.tee)&&Ju(e.cancel)&&Ju(e.getReader),l2=e=>Qu(e)&&Ju(e.read)&&Ju(e.pipe)&&i2(e.readable),Hb=e=>a2(e)||l2(e);class c2 extends Error{constructor(t,r){super(t),this.reason=r.reason,this.url=r.url,this.response=r.response}reason;url;response}const u2=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,h2=/^([-\w.]+\/[-\w.+]+)/;function Gb(e,t){return e.toLowerCase()===t.toLowerCase()}function d2(e){const t=h2.exec(e);return t?t[1]:e}function $b(e){const t=u2.exec(e);return t?t[1]:""}const Wb=/\?.*/;function f2(e){const t=e.match(Wb);return t&&t[0]}function ng(e){return e.replace(Wb,"")}function p2(e){if(e.length<50)return e;const t=e.slice(e.length-15);return`${e.substr(0,32)}...${t}`}function rf(e){return $a(e)?e.url:Wa(e)?e.name||"":typeof e=="string"?e:""}function og(e){if($a(e)){const t=e,r=t.headers.get("content-type")||"",n=ng(t.url);return d2(r)||$b(n)}return Wa(e)?e.type||"":typeof e=="string"?$b(e):""}function _2(e){return $a(e)?e.headers["content-length"]||-1:Wa(e)?e.size:typeof e=="string"?e.length:e instanceof ArrayBuffer||ArrayBuffer.isView(e)?e.byteLength:-1}async function Xb(e){if($a(e))return e;const t={},r=_2(e);r>=0&&(t["content-length"]=String(r));const n=rf(e),a=og(e);a&&(t["content-type"]=a);const d=await y2(e);d&&(t["x-first-bytes"]=d),typeof e=="string"&&(e=new TextEncoder().encode(e));const f=new Response(e,{headers:t});return Object.defineProperty(f,"url",{value:n}),f}async function g2(e){if(!e.ok)throw await m2(e)}async function m2(e){const t=p2(e.url);let r=`Failed to fetch resource (${e.status}) ${e.statusText}: ${t}`;r=r.length>100?`${r.slice(0,100)}...`:r;const n={reason:e.statusText,url:e.url,response:e};try{const a=e.headers.get("Content-Type");n.reason=!e.bodyUsed&&a?.includes("application/json")?await e.json():await e.text()}catch{}return new c2(r,n)}async function y2(e){if(typeof e=="string")return`data:,${e.slice(0,5)}`;if(e instanceof Blob){const r=e.slice(0,5);return await new Promise(n=>{const a=new FileReader;a.onload=d=>n(d?.target?.result),a.readAsDataURL(r)})}if(e instanceof ArrayBuffer){const r=e.slice(0,5);return`data:base64,${b2(r)}`}return null}function b2(e){let t="";const r=new Uint8Array(e);for(let n=0;n<r.byteLength;n++)t+=String.fromCharCode(r[n]);return btoa(t)}function v2(e){return!x2(e)&&!w2(e)}function x2(e){return e.startsWith("http:")||e.startsWith("https:")}function w2(e){return e.startsWith("data:")}async function qb(e,t){if(typeof e=="string"){const r=JC(e);return v2(r)&&globalThis.loaders?.fetchNode?globalThis.loaders?.fetchNode(r,t):await fetch(r,t)}return await Xb(e)}const Zb=new ic({id:"loaders.gl"});class T2{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class A2{console;constructor(){this.console=console}log(...t){return this.console.log.bind(this.console,...t)}info(...t){return this.console.info.bind(this.console,...t)}warn(...t){return this.console.warn.bind(this.console,...t)}error(...t){return this.console.error.bind(this.console,...t)}}const Yb={fetch:null,mimeType:void 0,nothrow:!1,log:new A2,useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:tf,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},E2={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function Kb(){globalThis.loaders=globalThis.loaders||{};const{loaders:e}=globalThis;return e._state||(e._state={}),e._state}function Jb(){const e=Kb();return e.globalOptions=e.globalOptions||{...Yb},e.globalOptions}function S2(e,t,r,n){return r=r||[],r=Array.isArray(r)?r:[r],C2(e,r),M2(t,e,n)}function C2(e,t){Qb(e,null,Yb,E2,t);for(const r of t){const n=e&&e[r.id]||{},a=r.options&&r.options[r.id]||{},d=r.deprecatedOptions&&r.deprecatedOptions[r.id]||{};Qb(n,r.id,a,d,t)}}function Qb(e,t,r,n,a){const d=t||"Top level",f=t?`${t}.`:"";for(const c in e){const T=!t&&Qu(e[c]),C=c==="baseUri"&&!t,R=c==="workerUrl"&&t;if(!(c in r)&&!C&&!R){if(c in n)Zb.warn(`${d} loader option '${f}${c}' no longer supported, use '${n[c]}'`)();else if(!T){const L=I2(c,a);Zb.warn(`${d} loader option '${f}${c}' not recognized. ${L}`)()}}}}function I2(e,t){const r=e.toLowerCase();let n="";for(const a of t)for(const d in a.options){if(e===d)return`Did you mean '${a.id}.${d}'?`;const f=d.toLowerCase();(r.startsWith(f)||f.startsWith(r))&&(n=n||`Did you mean '${a.id}.${d}'?`)}return n}function M2(e,t,r){const a={...e.options||{}};return R2(a,r),a.log===null&&(a.log=new T2),tv(a,Jb()),tv(a,t),a}function tv(e,t){for(const r in t)if(r in t){const n=t[r];jb(n)&&jb(e[r])?e[r]={...e[r],...t[r]}:e[r]=t[r]}}function R2(e,t){t&&!("baseUri"in e)&&(e.baseUri=t)}function ag(e){return e?(Array.isArray(e)&&(e=e[0]),Array.isArray(e?.extensions)):!1}function lg(e){Ar(e,"null loader"),Ar(ag(e),"invalid loader");let t;return Array.isArray(e)&&(t=e[1],e=e[0],e={...e,options:{...e.options,...t}}),(e?.parseTextSync||e?.parseText)&&(e.text=!0),e.text||(e.binary=!0),e}const ev=()=>{const e=Kb();return e.loaderRegistry=e.loaderRegistry||[],e.loaderRegistry};function P2(e){const t=ev();e=Array.isArray(e)?e:[e];for(const r of e){const n=lg(r);t.find(a=>n===a)||t.unshift(n)}}function B2(){return ev()}const D2=/\.([^.]+)$/;async function F2(e,t=[],r,n){if(!iv(e))return null;let a=rv(e,t,{...r,nothrow:!0},n);if(a)return a;if(Wa(e)&&(e=await e.slice(0,10).arrayBuffer(),a=rv(e,t,r,n)),!a&&!r?.nothrow)throw new Error(sv(e));return a}function rv(e,t=[],r,n){if(!iv(e))return null;if(t&&!Array.isArray(t))return lg(t);let a=[];t&&(a=a.concat(t)),r?.ignoreRegisteredLoaders||a.push(...B2()),k2(a);const d=O2(e,a,r,n);if(!d&&!r?.nothrow)throw new Error(sv(e));return d}function O2(e,t,r,n){const a=rf(e),d=og(e),f=ng(a)||n?.url;let c=null,T="";return r?.mimeType&&(c=cg(t,r?.mimeType),T=`match forced by supplied MIME type ${r?.mimeType}`),c=c||N2(t,f),T=T||(c?`matched url ${f}`:""),c=c||cg(t,d),T=T||(c?`matched MIME type ${d}`:""),c=c||U2(t,e),T=T||(c?`matched initial data ${ov(e)}`:""),r?.fallbackMimeType&&(c=c||cg(t,r?.fallbackMimeType),T=T||(c?`matched fallback MIME type ${d}`:"")),T&&pC.log(1,`selectLoader selected ${c?.name}: ${T}.`),c}function iv(e){return!(e instanceof Response&&e.status===204)}function sv(e){const t=rf(e),r=og(e);let n="No valid loader found (";n+=t?`${Vb(t)}, `:"no url provided, ",n+=`MIME type: ${r?`"${r}"`:"not provided"}, `;const a=e?ov(e):"";return n+=a?` first bytes: "${a}"`:"first bytes: not available",n+=")",n}function k2(e){for(const t of e)lg(t)}function N2(e,t){const r=t&&D2.exec(t),n=r&&r[1];return n?L2(e,n):null}function L2(e,t){t=t.toLowerCase();for(const r of e)for(const n of r.extensions)if(n.toLowerCase()===t)return r;return null}function cg(e,t){for(const r of e)if(r.mimeTypes?.some(n=>Gb(t,n))||Gb(t,`application/x.${r.id}`))return r;return null}function U2(e,t){if(!t)return null;for(const r of e)if(typeof t=="string"){if(z2(t,r))return r}else if(ArrayBuffer.isView(t)){if(nv(t.buffer,t.byteOffset,r))return r}else if(t instanceof ArrayBuffer&&nv(t,0,r))return r;return null}function z2(e,t){return t.testText?t.testText(e):(Array.isArray(t.tests)?t.tests:[t.tests]).some(n=>e.startsWith(n))}function nv(e,t,r){return(Array.isArray(r.tests)?r.tests:[r.tests]).some(a=>V2(e,t,r,a))}function V2(e,t,r,n){if(n instanceof ArrayBuffer)return UC(n,e,n.byteLength);switch(typeof n){case"function":return n(e);case"string":const a=ug(e,t,n.length);return n===a;default:return!1}}function ov(e,t=5){return typeof e=="string"?e.slice(0,t):ArrayBuffer.isView(e)?ug(e.buffer,e.byteOffset,t):e instanceof ArrayBuffer?ug(e,0,t):""}function ug(e,t,r){if(e.byteLength<t+r)return"";const n=new DataView(e);let a="";for(let d=0;d<r;d++)a+=String.fromCharCode(n.getUint8(t+d));return a}const j2=256*1024;function*H2(e,t){const r=t?.chunkSize||j2;let n=0;const a=new TextEncoder;for(;n<e.length;){const d=Math.min(e.length-n,r),f=e.slice(n,n+d);n+=d,yield a.encode(f)}}const G2=256*1024;function*$2(e,t={}){const{chunkSize:r=G2}=t;let n=0;for(;n<e.byteLength;){const a=Math.min(e.byteLength-n,r),d=new ArrayBuffer(a),f=new Uint8Array(e,n,a);new Uint8Array(d).set(f),n+=a,yield d}}const W2=1024*1024;async function*X2(e,t){const r=t?.chunkSize||W2;let n=0;for(;n<e.size;){const a=n+r,d=await e.slice(n,a).arrayBuffer();n=a,yield d}}function av(e,t){return tf?q2(e,t):Z2(e)}async function*q2(e,t){const r=e.getReader();let n;try{for(;;){const a=n||r.read();t?._streamReadAhead&&(n=r.read());const{done:d,value:f}=await a;if(d)return;yield zb(f)}}catch{r.releaseLock()}}async function*Z2(e,t){for await(const r of e)yield zb(r)}function Y2(e,t){if(typeof e=="string")return H2(e,t);if(e instanceof ArrayBuffer)return $2(e,t);if(Wa(e))return X2(e,t);if(Hb(e))return av(e,t);if($a(e))return av(e.body,t);throw new Error("makeIterator")}const lv="Cannot convert supplied data type";function K2(e,t,r){if(t.text&&typeof e=="string")return e;if(o2(e)&&(e=e.buffer),e instanceof ArrayBuffer){const n=e;return t.text&&!t.binary?new TextDecoder("utf8").decode(n):n}if(ArrayBuffer.isView(e)){if(t.text&&!t.binary)return new TextDecoder("utf8").decode(e);let n=e.buffer;const a=e.byteLength||e.length;return(e.byteOffset!==0||a!==n.byteLength)&&(n=n.slice(e.byteOffset,e.byteOffset+a)),n}throw new Error(lv)}async function J2(e,t,r){const n=e instanceof ArrayBuffer||ArrayBuffer.isView(e);if(typeof e=="string"||n)return K2(e,t);if(Wa(e)&&(e=await Xb(e)),$a(e)){const a=e;return await g2(a),t.binary?await a.arrayBuffer():await a.text()}if(Hb(e)&&(e=Y2(e,r)),s2(e)||n2(e))return HC(e);throw new Error(lv)}function cv(e,t){const r=Jb(),n=e||r;return typeof n.fetch=="function"?n.fetch:Qu(n.fetch)?a=>qb(a,n.fetch):t?.fetch?t?.fetch:qb}function Q2(e,t,r){if(r)return r;const n={fetch:cv(t,e),...e};if(n.url){const a=ng(n.url);n.baseUrl=a,n.queryString=f2(n.url),n.filename=Vb(a),n.baseUrl=ig(a)}return Array.isArray(n.loaders)||(n.loaders=null),n}function tI(e,t){if(e&&!Array.isArray(e))return e;let r;if(e&&(r=Array.isArray(e)?e:[e]),t&&t.loaders){const n=Array.isArray(t.loaders)?t.loaders:[t.loaders];r=r?[...r,...n]:n}return r&&r.length?r:void 0}async function sf(e,t,r,n){t&&!Array.isArray(t)&&!ag(t)&&(n=void 0,r=t,t=void 0),e=await e,r=r||{};const a=rf(e),f=tI(t,n),c=await F2(e,f,r);return c?(r=S2(r,c,f,a),n=Q2({url:a,_parse:sf,loaders:f},r,n||null),await eI(c,e,r,n)):null}async function eI(e,t,r,n){if(IC(e),r=_C(e.options,r),$a(t)){const d=t,{ok:f,redirected:c,status:T,statusText:C,type:R,url:L}=d,V=Object.fromEntries(d.headers.entries());n.response={headers:V,ok:f,redirected:c,status:T,statusText:C,type:R,url:L}}t=await J2(t,e,r);const a=e;if(a.parseTextSync&&typeof t=="string")return a.parseTextSync(t,r,n);if(FC(e,r))return await OC(e,t,r,n,sf);if(a.parseText&&typeof t=="string")return await a.parseText(t,r,n);if(a.parse)return await a.parse(t,r,n);throw wo(!a.parseSync),new Error(`${e.id} loader - no parser found and worker is disabled`)}function rI(e){switch(e.constructor){case Int8Array:return"int8";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int16Array:return"int16";case Uint16Array:return"uint16";case Int32Array:return"int32";case Uint32Array:return"uint32";case Float32Array:return"float32";case Float64Array:return"float64";default:return"null"}}function uv(e){let t=1/0,r=1/0,n=1/0,a=-1/0,d=-1/0,f=-1/0;const c=e.POSITION?e.POSITION.value:[],T=c&&c.length;for(let C=0;C<T;C+=3){const R=c[C],L=c[C+1],V=c[C+2];t=R<t?R:t,r=L<r?L:r,n=V<n?V:n,a=R>a?R:a,d=L>d?L:d,f=V>f?V:f}return[[t,r,n],[a,d,f]]}function iI(e,t,r){const n=rI(t.value),a=r||sI(t);return{name:e,type:{type:"fixed-size-list",listSize:t.size,children:[{name:"value",type:n}]},nullable:!1,metadata:a}}function sI(e){const t={};return"byteOffset"in e&&(t.byteOffset=e.byteOffset.toString(10)),"byteStride"in e&&(t.byteStride=e.byteStride.toString(10)),"normalized"in e&&(t.normalized=e.normalized.toString()),t}async function Ko(e,t,r,n){let a,d;!Array.isArray(t)&&!ag(t)?(a=[],d=t):(a=t,d=r);const f=cv(d);let c=e;return typeof e=="string"&&(c=await f(e)),Wa(e)&&(c=await f(e)),Array.isArray(a)?await sf(c,a,d):await sf(c,a,d)}const nI="4.3.1",oI=globalThis.loaders?.parseImageNode,hg=typeof Image<"u",dg=typeof ImageBitmap<"u",fg=tf?!0:!!oI;function aI(e){switch(e){case"auto":return dg||hg||fg;case"imagebitmap":return dg;case"image":return hg;case"data":return fg;default:throw new Error(`@loaders.gl/images: image ${e} not supported in this environment`)}}function lI(){if(dg)return"imagebitmap";if(hg)return"image";if(fg)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function cI(e){const t=uI(e);if(!t)throw new Error("Not an image");return t}function hv(e){switch(cI(e)){case"data":return e;case"image":case"imagebitmap":const t=document.createElement("canvas"),r=t.getContext("2d");if(!r)throw new Error("getImageData");return t.width=e.width,t.height=e.height,r.drawImage(e,0,0),r.getImageData(0,0,e.width,e.height);default:throw new Error("getImageData")}}function uI(e){return typeof ImageBitmap<"u"&&e instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&e instanceof Image?"image":e&&typeof e=="object"&&e.data&&e.width&&e.height?"data":null}const hI=/^data:image\/svg\+xml/,dI=/\.svg((\?|#).*)?$/;function pg(e){return e&&(hI.test(e)||dI.test(e))}function fI(e,t){if(pg(t)){let n=new TextDecoder().decode(e);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(n=unescape(encodeURIComponent(n)))}catch(d){throw new Error(d.message)}return`data:image/svg+xml;base64,${btoa(n)}`}return dv(e,t)}function dv(e,t){if(pg(t))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(e)])}async function fv(e,t,r){const n=fI(e,r),a=self.URL||self.webkitURL,d=typeof n!="string"&&a.createObjectURL(n);try{return await pI(d||n,t)}finally{d&&a.revokeObjectURL(d)}}async function pI(e,t){const r=new Image;return r.src=e,t.image&&t.image.decode&&r.decode?(await r.decode(),r):await new Promise((n,a)=>{try{r.onload=()=>n(r),r.onerror=d=>{const f=d instanceof Error?d.message:"error";a(new Error(f))}}catch(d){a(d)}})}const _I={};let pv=!0;async function gI(e,t,r){let n;pg(r)?n=await fv(e,t,r):n=dv(e,r);const a=t&&t.imagebitmap;return await mI(n,a)}async function mI(e,t=null){if((yI(t)||!pv)&&(t=null),t)try{return await createImageBitmap(e,t)}catch(r){console.warn(r),pv=!1}return await createImageBitmap(e)}function yI(e){for(const t in e||_I)return!1;return!0}function bI(e){return!TI(e,"ftyp",4)||(e[8]&96)===0?null:vI(e)}function vI(e){switch(xI(e,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function xI(e,t,r){return String.fromCharCode(...e.slice(t,r))}function wI(e){return[...e].map(t=>t.charCodeAt(0))}function TI(e,t,r=0){const n=wI(t);for(let a=0;a<n.length;++a)if(n[a]!==e[a+r])return!1;return!0}const Yn=!1,th=!0;function _g(e){const t=eh(e);return EI(t)||II(t)||SI(t)||CI(t)||AI(t)}function AI(e){const t=new Uint8Array(e instanceof DataView?e.buffer:e),r=bI(t);return r?{mimeType:r.mimeType,width:0,height:0}:null}function EI(e){const t=eh(e);return t.byteLength>=24&&t.getUint32(0,Yn)===2303741511?{mimeType:"image/png",width:t.getUint32(16,Yn),height:t.getUint32(20,Yn)}:null}function SI(e){const t=eh(e);return t.byteLength>=10&&t.getUint32(0,Yn)===1195984440?{mimeType:"image/gif",width:t.getUint16(6,th),height:t.getUint16(8,th)}:null}function CI(e){const t=eh(e);return t.byteLength>=14&&t.getUint16(0,Yn)===16973&&t.getUint32(2,th)===t.byteLength?{mimeType:"image/bmp",width:t.getUint32(18,th),height:t.getUint32(22,th)}:null}function II(e){const t=eh(e);if(!(t.byteLength>=3&&t.getUint16(0,Yn)===65496&&t.getUint8(2)===255))return null;const{tableMarkers:n,sofMarkers:a}=MI();let d=2;for(;d+9<t.byteLength;){const f=t.getUint16(d,Yn);if(a.has(f))return{mimeType:"image/jpeg",height:t.getUint16(d+5,Yn),width:t.getUint16(d+7,Yn)};if(!n.has(f))return null;d+=2,d+=t.getUint16(d,Yn)}return null}function MI(){const e=new Set([65499,65476,65484,65501,65534]);for(let r=65504;r<65520;++r)e.add(r);return{tableMarkers:e,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function eh(e){if(e instanceof DataView)return e;if(ArrayBuffer.isView(e))return new DataView(e.buffer);if(e instanceof ArrayBuffer)return new DataView(e);throw new Error("toDataView")}async function RI(e,t){const{mimeType:r}=_g(e)||{},n=globalThis.loaders?.parseImageNode;return Ar(n),await n(e,r)}async function PI(e,t,r){t=t||{};const a=(t.image||{}).type||"auto",{url:d}=r||{},f=BI(a);let c;switch(f){case"imagebitmap":c=await gI(e,t,d);break;case"image":c=await fv(e,t,d);break;case"data":c=await RI(e);break;default:Ar(!1)}return a==="data"&&(c=hv(c)),c}function BI(e){switch(e){case"auto":case"data":return lI();default:return aI(e),e}}const _v={dataType:null,batchType:null,id:"image",module:"images",name:"Images",version:nI,mimeTypes:["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],extensions:["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],parse:PI,tests:[e=>!!_g(new DataView(e))],options:{image:{type:"auto",decode:!0}}},gg={};function DI(e){if(gg[e]===void 0){const t=tf?OI(e):FI(e);gg[e]=t}return gg[e]}function FI(e){const t=["image/png","image/jpeg","image/gif"],r=globalThis.loaders?.imageFormatsNode||t;return!!globalThis.loaders?.parseImageNode&&r.includes(e)}function OI(e){switch(e){case"image/avif":case"image/webp":return kI(e);default:return!0}}function kI(e){try{return document.createElement("canvas").toDataURL(e).indexOf(`data:${e}`)===0}catch{return!1}}const Ye=new ic({id:"deck"});let mg={};function NI(e){mg=e}function Yi(e,t,r,n){Ye.level>0&&mg[e]&&mg[e].call(null,t,r,n)}function LI(e){const t=e[0],r=e[e.length-1];return t==="{"&&r==="}"||t==="["&&r==="]"}const UI={dataType:null,batchType:null,id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:LI,parseTextSync:JSON.parse};function zI(){const e="9.0.35",t=globalThis.deck&&globalThis.deck.VERSION;if(t&&t!==e)throw new Error(`deck.gl - multiple versions detected: ${t} vs ${e}`);return t||(Ye.log(1,`deck.gl ${e}`)(),globalThis.deck={...globalThis.deck,VERSION:e,version:e,log:Ye,_registerLoggers:NI},P2([UI,[_v,{imagebitmap:{premultiplyAlpha:"none"}}]])),e}const VI=zI();function Xa(e,t){if(!e)throw new Error(t||"shadertools: assertion failed.")}const yg={number:{type:"number",validate(e,t){return Number.isFinite(e)&&typeof t=="object"&&(t.max===void 0||e<=t.max)&&(t.min===void 0||e>=t.min)}},array:{type:"array",validate(e,t){return Array.isArray(e)||ArrayBuffer.isView(e)}}};function jI(e){const t={};for(const[r,n]of Object.entries(e))t[r]=GI(n);return t}function HI(e,t,r){const n={};for(const[a,d]of Object.entries(t))e&&a in e&&!d.private?(d.validate&&Xa(d.validate(e[a],d),`${r}: invalid ${a}`),n[a]=e[a]):n[a]=d.value;return n}function GI(e){let t=gv(e);if(t!=="object")return{value:e,...yg[t],type:t};if(typeof e=="object")return e?e.type!==void 0?{...e,...yg[e.type],type:e.type}:e.value===void 0?{type:"object",value:e}:(t=gv(e.value),{...e,...yg[t],type:t}):{type:"object",value:null};throw new Error("props")}function gv(e){return Array.isArray(e)||ArrayBuffer.isView(e)?"array":typeof e}const $I={vertex:`#ifdef MODULE_LOGDEPTH
logdepth_adjustPosition(gl_Position);
#endif
`,fragment:`#ifdef MODULE_MATERIAL
gl_FragColor = material_filterColor(gl_FragColor);
#endif
#ifdef MODULE_LIGHTING
gl_FragColor = lighting_filterColor(gl_FragColor);
#endif
#ifdef MODULE_FOG
gl_FragColor = fog_filterColor(gl_FragColor);
#endif
#ifdef MODULE_PICKING
gl_FragColor = picking_filterHighlightColor(gl_FragColor);
gl_FragColor = picking_filterPickingColor(gl_FragColor);
#endif
#ifdef MODULE_LOGDEPTH
logdepth_setFragDepth();
#endif
`},mv=/void\s+main\s*\([^)]*\)\s*\{\n?/,yv=/}\n?[^{}]*$/,bg=[],nf="__LUMA_INJECT_DECLARATIONS__";function WI(e){const t={vertex:{},fragment:{}};for(const r in e){let n=e[r];const a=XI(r);typeof n=="string"&&(n={order:0,injection:n}),t[a][r]=n}return t}function XI(e){const t=e.slice(0,2);switch(t){case"vs":return"vertex";case"fs":return"fragment";default:throw new Error(t)}}function of(e,t,r,n=!1){const a=t==="vertex";for(const d in r){const f=r[d];f.sort((T,C)=>T.order-C.order),bg.length=f.length;for(let T=0,C=f.length;T<C;++T)bg[T]=f[T].injection;const c=`${bg.join(`
`)}
`;switch(d){case"vs:#decl":a&&(e=e.replace(nf,c));break;case"vs:#main-start":a&&(e=e.replace(mv,T=>T+c));break;case"vs:#main-end":a&&(e=e.replace(yv,T=>c+T));break;case"fs:#decl":a||(e=e.replace(nf,c));break;case"fs:#main-start":a||(e=e.replace(mv,T=>T+c));break;case"fs:#main-end":a||(e=e.replace(yv,T=>c+T));break;default:e=e.replace(d,T=>T+c)}}return e=e.replace(nf,""),n&&(e=e.replace(/\}\s*$/,d=>d+$I[t])),e}let qI=1;class qa{name;vs;fs;getModuleUniforms;dependencies;deprecations;defines;injections;uniforms={};uniformTypes={};static instantiateModules(t){return t.map(r=>{if(r instanceof qa)return r;Xa(typeof r!="string",`Shader module use by name is deprecated. Import shader module '${JSON.stringify(r)}' and use it directly.`),r.name||(console.warn("shader module has no name"),r.name=`shader-module-${qI++}`);const n=new qa(r);return n.dependencies=qa.instantiateModules(r.dependencies||[]),n})}constructor(t){const{name:r,vs:n,fs:a,dependencies:d=[],uniformTypes:f={},uniformPropTypes:c={},getUniforms:T,deprecations:C=[],defines:R={},inject:L={}}=t;Xa(typeof r=="string"),this.name=r,this.vs=n,this.fs=a,this.getModuleUniforms=T,this.dependencies=qa.instantiateModules(d),this.deprecations=this._parseDeprecationDefinitions(C),this.defines=R,this.injections=WI(L),this.uniformTypes=f,c&&(this.uniforms=jI(c))}getModuleSource(t){let r;switch(t){case"vertex":r=this.vs||"";break;case"fragment":r=this.fs||"";break;default:Xa(!1)}const n=this.name.toUpperCase().replace(/[^0-9a-z]/gi,"_");return`// ----- MODULE ${this.name} ---------------

#define MODULE_${n}
${r}

`}getUniforms(t,r){return this.getModuleUniforms?this.getModuleUniforms(t,r):HI(t,this.uniforms,this.name)}getDefines(){return this.defines}checkDeprecations(t,r){this.deprecations.forEach(n=>{n.regex?.test(t)&&(n.deprecated?r.deprecated(n.old,n.new)():r.removed(n.old,n.new)())})}_parseDeprecationDefinitions(t){return t.forEach(r=>{switch(r.type){case"function":r.regex=new RegExp(`\\b${r.old}\\(`);break;default:r.regex=new RegExp(`${r.type} ${r.old};`)}}),t}_defaultGetUniforms(t={}){const r={},n=this.uniforms;for(const a in n){const d=n[a];a in t&&!d.private?(d.validate&&Xa(d.validate(t[a],d),`${this.name}: invalid ${a}`),r[a]=t[a]):r[a]=d.value}return r}}function bv(e){if(e.source&&e.platformInfo.type==="webgpu")return{...e,vs:void 0,fs:void 0};if(!e.vs)throw new Error("no vertex shader");const t=vv(e.platformInfo,e.vs);let r;return e.fs&&(r=vv(e.platformInfo,e.fs)),{...e,vs:t,fs:r}}function vv(e,t){if(typeof t=="string")return t;switch(e.type){case"webgpu":if(t?.wgsl)return t.wgsl;throw new Error("WebGPU does not support GLSL shaders");default:if(t?.glsl)return t.glsl;throw new Error("WebGL does not support WGSL shaders")}}function af(e){const t=qa.instantiateModules(e);return ZI(t)}function ZI(e){const t={},r={};return xv({modules:e,level:0,moduleMap:t,moduleDepth:r}),Object.keys(r).sort((n,a)=>r[a]-r[n]).map(n=>t[n])}function xv(e){const{modules:t,level:r,moduleMap:n,moduleDepth:a}=e;if(r>=5)throw new Error("Possible loop in shader dependency graph");for(const d of t)n[d.name]=d,(a[d.name]===void 0||a[d.name]<r)&&(a[d.name]=r);for(const d of t)d.dependencies&&xv({modules:d.dependencies,level:r+1,moduleMap:n,moduleDepth:a})}function YI(e){switch(e?.gpu.toLowerCase()){case"apple":return`#define APPLE_GPU
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"nvidia":return`#define NVIDIA_GPU
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function KI(e,t){if(Number(e.match(/^#version[ \t]+(\d+)/m)?.[1]||100)!==300)throw new Error("luma.gl v9 only supports GLSL 3.00 shader sources");switch(t){case"vertex":return e=Tv(e,JI),e;case"fragment":return e=Tv(e,QI),e;default:throw new Error(t)}}const wv=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],JI=[...wv,[vg("attribute"),"in $1"],[vg("varying"),"out $1"]],QI=[...wv,[vg("varying"),"in $1"]];function Tv(e,t){for(const[r,n]of t)e=e.replace(r,n);return e}function vg(e){return new RegExp(`\\b${e}[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)`,"g")}function Av(e,t){let r="";for(const n in e){const a=e[n];if(r+=`void ${a.signature} {
`,a.header&&(r+=`  ${a.header}`),t[n]){const d=t[n];d.sort((f,c)=>f.order-c.order);for(const f of d)r+=`  ${f.injection}
`}a.footer&&(r+=`  ${a.footer}`),r+=`}
`}return r}function Ev(e){const t={vertex:{},fragment:{}};for(const r of e){let n,a;typeof r!="string"?(n=r,a=n.hook):(n={},a=r),a=a.trim();const[d,f]=a.split(":"),c=a.replace(/\(.+/,""),T=Object.assign(n,{signature:f});switch(d){case"vs":t.vertex[c]=T;break;case"fs":t.fragment[c]=T;break;default:throw new Error(d)}}return t}function tM(e,t){return{name:eM(e,t),language:"glsl",version:rM(e)}}function eM(e,t="unnamed"){const n=/#define[^\S\r\n]*SHADER_NAME[^\S\r\n]*([A-Za-z0-9_-]+)\s*/.exec(e);return n?n[1]:t}function rM(e){let t=100;const r=e.match(/[^\s]+/g);if(r&&r.length>=2&&r[0]==="#version"){const n=parseInt(r[1],10);Number.isFinite(n)&&(t=n)}if(t!==100&&t!==300)throw new Error(`Invalid GLSL version ${t}`);return t}const Sv=`

${nf}
`,iM=`precision highp float;
`;function sM(e){const t=af(e.modules||[]);return{source:xg(e.platformInfo,{...e,source:e.source,stage:"vertex",modules:t}),getUniforms:wg(t)}}function nM(e){const t=af(e.modules||[]);return{vs:xg(e.platformInfo,{...e,source:e.vs,stage:"vertex",modules:t}),fs:xg(e.platformInfo,{...e,source:e.fs,stage:"fragment",modules:t}),getUniforms:wg(t)}}function oM(e){const{vs:t,fs:r}=e,n=af(e.modules||[]);return{vs:Cv(e.platformInfo,{...e,source:t,stage:"vertex",modules:n}),fs:Cv(e.platformInfo,{...e,source:r,stage:"fragment",modules:n}),getUniforms:wg(n)}}function xg(e,t){const{source:r,stage:n,modules:a,hookFunctions:d=[],inject:f={},log:c}=t;Xa(typeof r=="string","shader source must be a string");const T=r;let C="";const R=Ev(d),L={},V={},X={};for(const nt in f){const K=typeof f[nt]=="string"?{injection:f[nt],order:0}:f[nt],It=/^(v|f)s:(#)?([\w-]+)$/.exec(nt);if(It){const St=It[2],Ct=It[3];St?Ct==="decl"?V[nt]=[K]:X[nt]=[K]:L[nt]=[K]}else X[nt]=[K]}const at=e.type!=="webgpu"?a:[];for(const nt of at){c&&nt.checkDeprecations(T,c);const K=nt.getModuleSource(n,"wgsl");C+=K;const It=nt.injections[n];for(const St in It){const Ct=/^(v|f)s:#([\w-]+)$/.exec(St);if(Ct){const Qt=Ct[2]==="decl"?V:X;Qt[St]=Qt[St]||[],Qt[St].push(It[St])}else L[St]=L[St]||[],L[St].push(It[St])}}return C+=Sv,C=of(C,n,V),C+=Av(R[n],L),C+=T,C=of(C,n,X),C}function Cv(e,t){const{id:r,source:n,stage:a,language:d="glsl",modules:f,defines:c={},hookFunctions:T=[],inject:C={},prologue:R=!0,log:L}=t;Xa(typeof n=="string","shader source must be a string");const V=d==="glsl"?tM(n).version:-1,X=e.shaderLanguageVersion,at=V===100?"#version 100":"#version 300 es",K=n.split(`
`).slice(1).join(`
`),It={};f.forEach(ae=>{Object.assign(It,ae.getDefines())}),Object.assign(It,c);let St="";switch(d){case"wgsl":break;case"glsl":St=R?`${at}

// ----- PROLOGUE -------------------------
${aM({id:r,source:n,stage:a})}
${`#define SHADER_TYPE_${a.toUpperCase()}`}
${YI(e)}
${a==="fragment"?iM:""}

// ----- APPLICATION DEFINES -------------------------

${lM(It)}

`:`${at}
`;break}const Ct=Ev(T),Ht={},Qt={},ee={};for(const ae in C){const be=typeof C[ae]=="string"?{injection:C[ae],order:0}:C[ae],ie=/^(v|f)s:(#)?([\w-]+)$/.exec(ae);if(ie){const le=ie[2],Ae=ie[3];le?Ae==="decl"?Qt[ae]=[be]:ee[ae]=[be]:Ht[ae]=[be]}else ee[ae]=[be]}for(const ae of f){L&&ae.checkDeprecations(K,L);const be=ae.getModuleSource(a);St+=be;const ie=ae.injections[a];for(const le in ie){const Ae=/^(v|f)s:#([\w-]+)$/.exec(le);if(Ae){const ze=Ae[2]==="decl"?Qt:ee;ze[le]=ze[le]||[],ze[le].push(ie[le])}else Ht[le]=Ht[le]||[],Ht[le].push(ie[le])}}return St+="// ----- MAIN SHADER SOURCE -------------------------",St+=Sv,St=of(St,a,Qt),St+=Av(Ct[a],Ht),St+=K,St=of(St,a,ee),d==="glsl"&&V!==X&&(St=KI(St,a)),St.trim()}function wg(e){return function(r){const n={};for(const a of e){const d=a.getUniforms(r,n);Object.assign(n,d)}return n}}function aM(e){const{id:t,source:r,stage:n}=e;return t&&r.indexOf("SHADER_NAME")===-1?`
#define SHADER_NAME ${t}_${n}

`:""}function lM(e={}){let t="";for(const r in e){const n=e[r];(n||Number.isFinite(n))&&(t+=`#define ${r.toUpperCase()} ${e[r]}
`)}return t}class Za{static defaultShaderAssembler;_hookFunctions=[];_defaultModules=[];static getDefaultShaderAssembler(){return Za.defaultShaderAssembler=Za.defaultShaderAssembler||new Za,Za.defaultShaderAssembler}addDefaultModule(t){this._defaultModules.find(r=>r.name===(typeof t=="string"?t:t.name))||this._defaultModules.push(t)}removeDefaultModule(t){const r=typeof t=="string"?t:t.name;this._defaultModules=this._defaultModules.filter(n=>n.name!==r)}addShaderHook(t,r){r&&(t=Object.assign(r,{hook:t})),this._hookFunctions.push(t)}assembleShader(t){const r=this._getModuleList(t.modules),n=this._hookFunctions,a=bv(t);return{...sM({platformInfo:t.platformInfo,...a,modules:r,hookFunctions:n}),modules:r}}assembleShaderPair(t){const r=bv(t),n=this._getModuleList(t.modules),a=this._hookFunctions,{platformInfo:d}=t;return{...t.platformInfo.shaderLanguage==="wgsl"?nM({platformInfo:d,...r,modules:n,hookFunctions:a}):oM({platformInfo:d,...r,modules:n,hookFunctions:a}),modules:n}}_getModuleList(t=[]){const r=new Array(this._defaultModules.length+t.length),n={};let a=0;for(let d=0,f=this._defaultModules.length;d<f;++d){const c=this._defaultModules[d],T=c.name;r[a++]=c,n[T]=!0}for(let d=0,f=t.length;d<f;++d){const c=t[d],T=c.name;n[T]||(r[a++]=c,n[T]=!0)}return r.length=a,qa.instantiateModules(r)}}const cM=`#version 300 es
out vec4 transform_output;
void main() {
transform_output = vec4(0);
}`;function uM(e){const{input:t,inputChannels:r,output:n}={};if(!t)return cM;if(!r)throw new Error("inputChannels");const a=hM(r),d=dM(t,r);return`#version 300 es
in ${a} ${t};
out vec4 ${n};
void main() {
  ${n} = ${d};
}`}function hM(e){switch(e){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`invalid channels: ${e}`)}}function dM(e,t){switch(t){case 1:return`vec4(${e}, 0.0, 0.0, 1.0)`;case 2:return`vec4(${e}, 0.0, 1.0)`;case 3:return`vec4(${e}, 1.0)`;case 4:return e;default:throw new Error(`invalid channels: ${t}`)}}const te=new ic({id:"luma.gl"});class fM{stats=new Map;getStats(t){return this.get(t)}get(t){return this.stats.has(t)||this.stats.set(t,new sc({id:t})),this.stats.get(t)}}const Tg=new fM;function pM(){const e="9.0.27",t="set luma.log.level=1 (or higher) to trace rendering";if(globalThis.luma&&globalThis.luma.VERSION!==e)throw new Error(`luma.gl - multiple VERSIONs detected: ${globalThis.luma.VERSION} vs ${e}`);return globalThis.luma||(Zo()&&te.log(1,`${e} - ${t}`)(),globalThis.luma=globalThis.luma||{VERSION:e,version:e,log:te,stats:Tg}),e}const _M=pM();function gM(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)?e:null}function rh(e){return Array.isArray(e)?e.length===0||typeof e[0]=="number"?e:null:gM(e)}const Ag={};function Jo(e="id"){Ag[e]=Ag[e]||1;const t=Ag[e]++;return`${e}-${t}`}function lf(e){let t=!0;for(const r in e){t=!1;break}return t}let _r=class{static defaultProps={id:"undefined",handle:void 0,userData:void 0};id;props;userData={};_device;destroyed=!1;allocatedBytes=0;_attachedResources=new Set;constructor(t,r,n){if(!t)throw new Error("no device");this._device=t,this.props=mM(r,n);const a=this.props.id!=="undefined"?this.props.id:Jo(this[Symbol.toStringTag]);this.props.id=a,this.id=a,this.userData=this.props.userData||{},this.addStats()}destroy(){this.destroyResource()}delete(){return this.destroy(),this}toString(){return`${this[Symbol.toStringTag]||this.constructor.name}(${this.id})`}getProps(){return this.props}attachResource(t){this._attachedResources.add(t)}detachResource(t){this._attachedResources.delete(t)}destroyAttachedResource(t){this._attachedResources.delete(t)&&t.destroy()}destroyAttachedResources(){for(const t of Object.values(this._attachedResources))t.destroy();this._attachedResources=new Set}destroyResource(){this.destroyAttachedResources(),this.removeStats(),this.destroyed=!0}removeStats(){const t=this._device.statsManager.getStats("Resource Counts"),r=this[Symbol.toStringTag];t.get(`${r}s Active`).decrementCount()}trackAllocatedMemory(t,r=this[Symbol.toStringTag]){const n=this._device.statsManager.getStats("Resource Counts");n.get("GPU Memory").addCount(t),n.get(`${r} Memory`).addCount(t),this.allocatedBytes=t}trackDeallocatedMemory(t=this[Symbol.toStringTag]){const r=this._device.statsManager.getStats("Resource Counts");r.get("GPU Memory").subtractCount(this.allocatedBytes),r.get(`${t} Memory`).subtractCount(this.allocatedBytes),this.allocatedBytes=0}addStats(){const t=this._device.statsManager.getStats("Resource Counts"),r=this[Symbol.toStringTag];t.get("Resources Created").incrementCount(),t.get(`${r}s Created`).incrementCount(),t.get(`${r}s Active`).incrementCount()}};function mM(e,t){const r={...t};for(const n in e)e[n]!==void 0&&(r[n]=e[n]);return r}class Fr extends _r{static defaultProps={..._r.defaultProps,usage:0,byteLength:0,byteOffset:0,data:null,indexType:"uint16",mappedAtCreation:!1};static MAP_READ=1;static MAP_WRITE=2;static COPY_SRC=4;static COPY_DST=8;static INDEX=16;static VERTEX=32;static UNIFORM=64;static STORAGE=128;static INDIRECT=256;static QUERY_RESOLVE=512;get[Symbol.toStringTag](){return"Buffer"}usage;indexType;updateTimestamp;constructor(t,r){const n={...r};(r.usage||0)&Fr.INDEX&&!r.indexType&&(r.data instanceof Uint32Array?n.indexType="uint32":r.data instanceof Uint16Array&&(n.indexType="uint16")),super(t,n,Fr.defaultProps),this.usage=r.usage||0,this.indexType=n.indexType,this.updateTimestamp=t.incrementTimestamp()}readSyncWebGL(t,r){throw new Error("not implemented")}static DEBUG_DATA_MAX_LENGTH=32;debugData=new ArrayBuffer(0);_setDebugData(t,r,n){const a=ArrayBuffer.isView(t)?t.buffer:t,d=Math.min(t?t.byteLength:n,Fr.DEBUG_DATA_MAX_LENGTH);t===null?this.debugData=new ArrayBuffer(d):r===0&&n===t.byteLength?this.debugData=a.slice(0,d):this.debugData=a.slice(r,r+d)}}function Iv(e){const t=Mv[e],r=yM(t),n=e.includes("norm"),a=!n&&!e.startsWith("float"),d=e.startsWith("s");return{dataType:Mv[e],byteLength:r,integer:a,signed:d,normalized:n}}function yM(e){return bM[e]}const Mv={uint8:"uint8",sint8:"sint8",unorm8:"uint8",snorm8:"sint8",uint16:"uint16",sint16:"sint16",unorm16:"uint16",snorm16:"sint16",float16:"float16",float32:"float32",uint32:"uint32",sint32:"sint32"},bM={uint8:1,sint8:1,uint16:2,sint16:2,float16:2,float32:4,uint32:4,sint32:4},vM=["bc1","bc2","bc3","bc4","bc5","bc6","bc7","etc1","etc2","eac","atc","astc","pvrtc"],xM=/^(rg?b?a?)([0-9]*)([a-z]*)(-srgb)?(-webgl|-unsized)?$/;function wM(e){return vM.some(t=>e.startsWith(t))}function Rv(e){const t=xM.exec(e);if(t){const[,r,n,a,d,f]=t;if(r){const c=`${a}${n}`,T=Iv(c);return{format:r,components:r.length,srgb:d==="-srgb",unsized:f==="-unsized",webgl:f==="-webgl",...T}}}return AM(e)}const TM={"rgba4unorm-webgl":{format:"rgba",bpp:2},"rgb565unorm-webgl":{format:"rgb",bpp:2},"rgb5a1unorm-webgl":{format:"rgba",bbp:2},rgb9e5ufloat:{format:"rgb",bbp:4},rg11b10ufloat:{format:"rgb",bbp:4},rgb10a2unorm:{format:"rgba",bbp:4},"rgb10a2uint-webgl":{format:"rgba",bbp:4},stencil8:{components:1,bpp:1,a:"stencil"},depth16unorm:{components:1,bpp:2,a:"depth"},depth24plus:{components:1,bpp:3,a:"depth"},depth32float:{components:1,bpp:4,a:"depth"},"depth24plus-stencil8":{components:2,bpp:4,a:"depth-stencil"},"depth24unorm-stencil8":{components:2,bpp:4,a:"depth-stencil"},"depth32float-stencil8":{components:2,bpp:4,a:"depth-stencil"}};function AM(e){const t=TM[e];if(!t)throw new Error(`Unknown format ${e}`);return{format:t.format||"",components:t.components||t.format?.length||1,byteLength:t.bpp||1,srgb:!1,unsized:!1}}class EM{}class SM{features;disabledFeatures;constructor(t=[],r){this.features=new Set(t),this.disabledFeatures=r||{}}*[Symbol.iterator](){yield*this.features}has(t){return!this.disabledFeatures[t]&&this.features.has(t)}}class nc{static defaultProps={id:null,canvas:null,container:null,manageState:!0,width:800,height:600,requestMaxLimits:!0,debug:!!te.get("debug"),spector:!!(te.get("spector")||te.get("spectorjs")),break:[],initalizeFeatures:!0,disabledFeatures:{"compilation-status-async-webgl":!0},gl:null,onError:t=>te.error(t.message)};get[Symbol.toStringTag](){return"Device"}static VERSION=_M;constructor(t){this.props={...nc.defaultProps,...t},this.id=this.props.id||Jo(this[Symbol.toStringTag].toLowerCase())}id;props;userData={};statsManager=Tg;_lumaData={};isTextureFormatCompressed(t){return wM(t)}loseDevice(){return!1}getCanvasContext(){if(!this.canvasContext)throw new Error("Device has no CanvasContext");return this.canvasContext}createTexture(t){return(t instanceof Promise||typeof t=="string")&&(t={data:t}),this._createTexture(t)}createCommandEncoder(t={}){throw new Error("not implemented")}readPixelsToArrayWebGL(t,r){throw new Error("not implemented")}readPixelsToBufferWebGL(t,r){throw new Error("not implemented")}setParametersWebGL(t){throw new Error("not implemented")}getParametersWebGL(t){throw new Error("not implemented")}withParametersWebGL(t,r){throw new Error("not implemented")}clearWebGL(t){throw new Error("not implemented")}resetWebGL(){throw new Error("not implemented")}timestamp=0;incrementTimestamp(){return this.timestamp++}onError(t){this.props.onError(t)}_getBufferProps(t){(t instanceof ArrayBuffer||ArrayBuffer.isView(t))&&(t={data:t});const r={...t};return(t.usage||0)&Fr.INDEX&&!t.indexType&&(t.data instanceof Uint32Array?r.indexType="uint32":t.data instanceof Uint16Array?r.indexType="uint16":te.warn("indices buffer content must be of integer type")()),r}}function tr(e,t){if(!e)throw new Error(t||"luma.gl: assertion failed.")}const ih=new Map;class oc{static defaultProps={...nc.defaultProps,type:"best-available",devices:void 0};static stats=Tg;static log=te;static registerDevices(t){for(const r of t)tr(r.type&&r.isSupported&&r.create),ih.set(r.type,r)}static getAvailableDevices(){return Array.from(ih).map(t=>t.type)}static getSupportedDevices(){return Array.from(ih).filter(t=>t.isSupported()).map(t=>t.type)}static setDefaultDeviceProps(t){Object.assign(nc.defaultProps,t)}static async attachDevice(t){const r=Pv(t.devices)||ih;if(t.handle instanceof WebGL2RenderingContext){const n=r.get("webgl");if(n)return await n.attach(t.handle)}if(t.handle===null){const n=r.get("unknown");if(n)return await n.attach(null)}throw new Error("Failed to attach device. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.")}static async createDevice(t={}){t={...oc.defaultProps,...t},t.gl&&(t.type="webgl");const r=Pv(t.devices)||ih;let n,a;switch(t.type){case"webgpu":if(n=r.get("webgpu"),n)return await n.create(t);break;case"webgl":if(a=r.get("webgl"),a)return await a.create(t);break;case"unknown":const d=r.get("unknown");if(d)return await d.create(t);break;case"best-available":if(n=r.get("webgpu"),n?.isSupported?.())return await n.create(t);if(a=r.get("webgl"),a?.isSupported?.())return await a.create(t);break}throw new Error("No matching device found. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.")}static enforceWebGL2(t=!0){const r=HTMLCanvasElement.prototype;if(!t&&r.originalGetContext){r.getContext=r.originalGetContext,r.originalGetContext=void 0;return}r.originalGetContext=r.getContext,r.getContext=function(n,a){return n==="webgl"||n==="experimental-webgl"?this.originalGetContext("webgl2",a):this.originalGetContext(n,a)}}}function Pv(e){if(!e||e?.length===0)return null;const t=new Map;for(const r of e)t.set(r.type,r);return t}const CM=Zo()&&typeof document<"u",cf=()=>CM&&document.readyState==="complete",IM={canvas:null,width:800,height:600,useDevicePixels:!0,autoResize:!0,container:null,visible:!0,colorSpace:"srgb",alphaMode:"opaque"};class Bv{id;props;canvas;htmlCanvas;offscreenCanvas;type;width=1;height=1;resizeObserver;_canvasSizeInfo={clientWidth:0,clientHeight:0,devicePixelRatio:1};static get isPageLoaded(){return cf()}static pageLoaded=MM();constructor(t){if(this.props={...IM,...t},t=this.props,!Zo()){this.id="node-canvas-context",this.type="node",this.width=this.props.width,this.height=this.props.height,this.canvas=null;return}if(t.canvas)typeof t.canvas=="string"?this.canvas=PM(t.canvas):this.canvas=t.canvas;else{const r=BM(t),n=RM(t?.container||null);n.insertBefore(r,n.firstChild),this.canvas=r,t?.visible||(this.canvas.style.visibility="hidden")}this.canvas instanceof HTMLCanvasElement?(this.id=this.canvas.id,this.type="html-canvas",this.htmlCanvas=this.canvas):(this.id="offscreen-canvas",this.type="offscreen-canvas",this.offscreenCanvas=this.canvas),this.canvas instanceof HTMLCanvasElement&&t.autoResize&&(this.resizeObserver=new ResizeObserver(r=>{for(const n of r)n.target===this.canvas&&this.update()}),this.resizeObserver.observe(this.canvas))}getDevicePixelRatio(t){return typeof OffscreenCanvas<"u"&&this.canvas instanceof OffscreenCanvas||(t=t===void 0?this.props.useDevicePixels:t,!t||t<=0)?1:t===!0?typeof window<"u"&&window.devicePixelRatio||1:t}getPixelSize(){switch(this.type){case"node":return[this.width,this.height];case"offscreen-canvas":return[this.canvas.width,this.canvas.height];case"html-canvas":const t=this.getDevicePixelRatio(),r=this.canvas;return r.parentElement?[r.clientWidth*t,r.clientHeight*t]:[this.canvas.width,this.canvas.height];default:throw new Error(this.type)}}getAspect(){const[t,r]=this.getPixelSize();return t/r}cssToDeviceRatio(){try{const[t]=this.getDrawingBufferSize(),{clientWidth:r}=this._canvasSizeInfo;return r?t/r:1}catch{return 1}}cssToDevicePixels(t,r=!0){const n=this.cssToDeviceRatio(),[a,d]=this.getDrawingBufferSize();return DM(t,n,a,d,r)}setDevicePixelRatio(t,r={}){if(!this.htmlCanvas)return;let n="width"in r?r.width:this.htmlCanvas.clientWidth,a="height"in r?r.height:this.htmlCanvas.clientHeight;(!n||!a)&&(te.log(1,"Canvas clientWidth/clientHeight is 0")(),t=1,n=this.htmlCanvas.width||1,a=this.htmlCanvas.height||1);const d=this._canvasSizeInfo;if(d.clientWidth!==n||d.clientHeight!==a||d.devicePixelRatio!==t){let f=t;const c=Math.floor(n*f),T=Math.floor(a*f);this.htmlCanvas.width=c,this.htmlCanvas.height=T;const[C,R]=this.getDrawingBufferSize();(C!==c||R!==T)&&(f=Math.min(C/n,R/a),this.htmlCanvas.width=Math.floor(n*f),this.htmlCanvas.height=Math.floor(a*f),te.warn("Device pixel ratio clamped")()),this._canvasSizeInfo.clientWidth=n,this._canvasSizeInfo.clientHeight=a,this._canvasSizeInfo.devicePixelRatio=t}}getDrawingBufferSize(){const t=this.device.gl;if(!t)throw new Error("canvas size");return[t.drawingBufferWidth,t.drawingBufferHeight]}_setAutoCreatedCanvasId(t){this.htmlCanvas?.id==="lumagl-auto-created-canvas"&&(this.htmlCanvas.id=t)}}function MM(){return cf()||typeof window>"u"?Promise.resolve():new Promise(e=>{window.addEventListener("load",()=>e())})}function RM(e){if(typeof e=="string"){const t=document.getElementById(e);if(!t&&!cf())throw new Error(`Accessing '${e}' before page was loaded`);if(!t)throw new Error(`${e} is not an HTML element`);return t}else if(e)return e;return document.body}function PM(e){const t=document.getElementById(e);if(!t&&!cf())throw new Error(`Accessing '${e}' before page was loaded`);if(!(t instanceof HTMLCanvasElement))throw new Error("Object is not a canvas element");return t}function BM(e){const{width:t,height:r}=e,n=document.createElement("canvas");return n.id="lumagl-auto-created-canvas",n.width=t||1,n.height=r||1,n.style.width=Number.isFinite(t)?`${t}px`:"100%",n.style.height=Number.isFinite(r)?`${r}px`:"100%",n}function DM(e,t,r,n,a){const d=e,f=Dv(d[0],t,r);let c=Fv(d[1],t,n,a),T=Dv(d[0]+1,t,r);const C=T===r-1?T:T-1;T=Fv(d[1]+1,t,n,a);let R;return a?(T=T===0?T:T+1,R=c,c=T):R=T===n-1?T:T-1,{x:f,y:c,width:Math.max(C-f+1,1),height:Math.max(R-c+1,1)}}function Dv(e,t,r){return Math.min(Math.round(e*t),r-1)}function Fv(e,t,r,n){return n?Math.max(0,r-1-Math.round(e*t)):Math.min(Math.round(e*t),r-1)}class Is extends _r{static defaultProps={..._r.defaultProps,data:null,dimension:"2d",format:"rgba8unorm",width:void 0,height:void 0,depth:1,mipmaps:!0,compressed:!1,usage:0,mipLevels:void 0,samples:void 0,type:void 0,sampler:{},view:void 0};static COPY_SRC=1;static COPY_DST=2;static TEXTURE_BINDING=4;static STORAGE_BINDING=8;static RENDER_ATTACHMENT=16;get[Symbol.toStringTag](){return"Texture"}dimension;format;width;height;depth;updateTimestamp;constructor(t,r,n=Is.defaultProps){super(t,r,n),this.dimension=this.props.dimension,this.format=this.props.format,this.width=this.props.width,this.height=this.props.height,this.depth=this.props.depth,this.updateTimestamp=t.incrementTimestamp()}}class uf extends _r{static defaultProps={..._r.defaultProps,format:void 0,dimension:void 0,aspect:"all",baseMipLevel:0,mipLevelCount:void 0,baseArrayLayer:0,arrayLayerCount:void 0};get[Symbol.toStringTag](){return"TextureView"}constructor(t,r){super(t,r,uf.defaultProps)}}function FM(e,t,r){let n="";const a=t.split(/\r?\n/),d=e.slice().sort((f,c)=>f.lineNum-c.lineNum);switch(r?.showSourceCode||"no"){case"all":let f=0;for(let c=1;c<=a.length;c++)for(n+=kv(a[c-1],c,r);d.length>f&&d[f].lineNum===c;){const T=d[f++];n+=Ov(T,a,T.lineNum,{...r,inlineSource:!1})}return n;case"issues":case"no":for(const c of e)n+=Ov(c,a,c.lineNum,{inlineSource:r?.showSourceCode!=="no"});return n}}function Ov(e,t,r,n){if(n?.inlineSource){const a=OM(t,r),d=e.linePos>0?`${" ".repeat(e.linePos+5)}^^^
`:"";return`
${a}${d}${e.type.toUpperCase()}: ${e.message}

`}return n?.html?`<div class='luma-compiler-log-error' style="color:red;"><b> ${e.type.toUpperCase()}: ${e.message}</b></div>`:`${e.type.toUpperCase()}: ${e.message}`}function OM(e,t,r){let n="";for(let a=t-2;a<=t;a++){const d=e[a-1];d!==void 0&&(n+=kv(d,t,r))}return n}function kv(e,t,r){const n=r?.html?NM(e):e;return`${kM(String(t),4)}: ${n}${r?.html?"<br/>":`
`}`}function kM(e,t){let r="";for(let n=e.length;n<t;++n)r+=" ";return r+e}function NM(e){return e.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}function Nv(e,t){return{name:LM(e,t),language:"glsl",version:UM(e)}}function LM(e,t="unnamed"){const n=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/.exec(e);return n?n[1]:t}function UM(e){let t=100;const r=e.match(/[^\s]+/g);if(r&&r.length>=2&&r[0]==="#version"){const n=parseInt(r[1],10);Number.isFinite(n)&&(t=n)}return t}class hf extends _r{static defaultProps={..._r.defaultProps,language:"auto",stage:void 0,source:"",sourceMap:null,entryPoint:"main",debug:"errors"};get[Symbol.toStringTag](){return"Shader"}stage;source;compilationStatus="pending";constructor(t,r){super(t,{id:zM(r),...r},hf.defaultProps),this.stage=this.props.stage,this.source=this.props.source}getCompilationInfoSync(){return null}getTranslatedSource(){return null}async debugShader(t=this.props.debug){switch(t){case"never":return;case"errors":if(this.compilationStatus==="success")return;break}const r=await this.getCompilationInfo();this.props.debug==="warnings"&&r?.length===0||this._displayShaderLog(r)}_displayShaderLog(t){if(typeof document>"u"||!document?.createElement)return;const r=Nv(this.source).name,n=`${this.stage} ${r}`;let a=FM(t,this.source,{showSourceCode:"all",html:!0});const d=this.getTranslatedSource();d&&(a+=`<br /><br /><h1>Translated Source</h1><br /><br /><code style="user-select:text;"><pre>${d}</pre></code>`);const f=document.createElement("Button");f.innerHTML=`
<h1>Shader Compilation Error in ${n}</h1><br /><br />
<code style="user-select:text;"><pre>
${a}
</pre></code>`,f.style.top="10px",f.style.left="10px",f.style.position="absolute",f.style.zIndex="9999",f.style.width="100%",f.style.textAlign="left",document.body.appendChild(f);const c=document.getElementsByClassName("luma-compiler-log-error");c[0]?.scrollIntoView&&c[0].scrollIntoView(),f.onclick=()=>{const T=`data:text/plain,${encodeURIComponent(this.source)}`;navigator.clipboard.writeText(T)}}}function zM(e){return Nv(e.source).name||e.id||Jo(`unnamed ${e.stage}-shader`)}class df extends _r{static defaultProps={..._r.defaultProps,type:"color-sampler",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",addressModeW:"clamp-to-edge",magFilter:"nearest",minFilter:"nearest",mipmapFilter:"nearest",lodMinClamp:0,lodMaxClamp:32,compare:"less-equal",maxAnisotropy:1};get[Symbol.toStringTag](){return"Sampler"}constructor(t,r){super(t,r,df.defaultProps)}}class ff extends _r{static defaultProps={..._r.defaultProps,width:1,height:1,colorAttachments:[],depthStencilAttachment:null};get[Symbol.toStringTag](){return"Framebuffer"}width;height;colorAttachments=[];depthStencilAttachment=null;constructor(t,r={}){super(t,r,ff.defaultProps),this.width=this.props.width,this.height=this.props.height}resize(t){let r=!t;if(t){const[n,a]=Array.isArray(t)?t:[t.width,t.height];r=r||a!==this.height||n!==this.width,this.width=n,this.height=a}r&&(te.log(2,`Resizing framebuffer ${this.id} to ${this.width}x${this.height}`)(),this.resizeAttachments(this.width,this.height))}autoCreateAttachmentTextures(){if(this.props.colorAttachments.length===0&&!this.props.depthStencilAttachment)throw new Error("Framebuffer has noattachments");this.colorAttachments=this.props.colorAttachments.map(r=>{if(typeof r=="string"){const n=this.createColorTexture(r);return this.attachResource(n),n.view}return r instanceof Is?r.view:r});const t=this.props.depthStencilAttachment;if(t)if(typeof t=="string"){const r=this.createDepthStencilTexture(t);this.attachResource(r),this.depthStencilAttachment=r.view}else t instanceof Is?this.depthStencilAttachment=t.view:this.depthStencilAttachment=t}createColorTexture(t){return this.device.createTexture({id:"color-attachment",usage:Is.RENDER_ATTACHMENT,format:t,width:this.width,height:this.height})}createDepthStencilTexture(t){return this.device.createTexture({id:"depth-stencil-attachment",usage:Is.RENDER_ATTACHMENT,format:t,width:this.width,height:this.height})}resizeAttachments(t,r){for(let n=0;n<this.colorAttachments.length;++n)if(this.colorAttachments[n]){const a=this.device._createTexture({...this.colorAttachments[n].props,width:t,height:r});this.destroyAttachedResource(this.colorAttachments[n]),this.colorAttachments[n]=a.view,this.attachResource(a.view)}if(this.depthStencilAttachment){const n=this.device._createTexture({...this.depthStencilAttachment.props,width:t,height:r});this.destroyAttachedResource(this.depthStencilAttachment),this.depthStencilAttachment=n.view,this.attachResource(n)}}}class ac extends _r{static defaultProps={..._r.defaultProps,vs:null,vertexEntryPoint:"vertexMain",vsConstants:{},fs:null,fragmentEntryPoint:"fragmentMain",fsConstants:{},shaderLayout:null,bufferLayout:[],topology:"triangle-list",parameters:{},bindings:{},uniforms:{}};get[Symbol.toStringTag](){return"RenderPipeline"}shaderLayout;bufferLayout;linkStatus="pending";hash="";constructor(t,r){super(t,r,ac.defaultProps),this.shaderLayout=this.props.shaderLayout,this.bufferLayout=this.props.bufferLayout||[]}setUniformsWebGL(t){throw new Error("Use uniform blocks")}}class Eg extends _r{static defaultProps={..._r.defaultProps,framebuffer:null,parameters:void 0,clearColor:[0,0,0,0],clearDepth:1,clearStencil:0,depthReadOnly:!1,stencilReadOnly:!1,discard:!1,occlusionQuerySet:void 0,timestampQuerySet:void 0,beginTimestampIndex:void 0,endTimestampIndex:void 0};get[Symbol.toStringTag](){return"RenderPass"}constructor(t,r){super(t,r,Eg.defaultProps)}}class pf extends _r{static defaultProps={..._r.defaultProps,shader:void 0,entryPoint:void 0,constants:{},shaderLayout:void 0};get[Symbol.toStringTag](){return"ComputePipeline"}hash="";constructor(t,r){super(t,r,pf.defaultProps)}}class Sg extends _r{static defaultProps={..._r.defaultProps,measureExecutionTime:void 0};get[Symbol.toStringTag](){return"CommandEncoder"}constructor(t,r){super(t,r,Sg.defaultProps)}}class Cg extends _r{static defaultProps={..._r.defaultProps};get[Symbol.toStringTag](){return"CommandBuffer"}constructor(t,r){super(t,r,Cg.defaultProps)}}function VM(e){const[t,r]=HM[e],n=t==="i32"||t==="u32",a=t!=="u32",d=GM[t]*r,f=jM(t,r);return{dataType:t,components:r,defaultVertexFormat:f,byteLength:d,integer:n,signed:a}}function jM(e,t){let r;switch(e){case"f32":r="float32";break;case"i32":r="sint32";break;case"u32":r="uint32";break;case"f16":return t<=2?"float16x2":"float16x4"}return t===1?r:`${r}x${t}`}const HM={f32:["f32",1],"vec2<f32>":["f32",2],"vec3<f32>":["f32",3],"vec4<f32>":["f32",4],f16:["f16",1],"vec2<f16>":["f16",2],"vec3<f16>":["f16",3],"vec4<f16>":["f16",4],i32:["i32",1],"vec2<i32>":["i32",2],"vec3<i32>":["i32",3],"vec4<i32>":["i32",4],u32:["u32",1],"vec2<u32>":["u32",2],"vec3<u32>":["u32",3],"vec4<u32>":["u32",4]},GM={f32:4,f16:2,i32:4,u32:4};function Lv(e){let t;e.endsWith("-webgl")&&(e.replace("-webgl",""),t=!0);const[r,n]=e.split("x"),a=r,d=n?parseInt(n):1,f=Iv(a),c={type:a,components:d,byteLength:f.byteLength*d,integer:f.integer,signed:f.signed,normalized:f.normalized};return t&&(c.webglOnly=!0),c}function Uv(e,t){const r={};for(const n of e.attributes)r[n.name]=WM(e,t,n.name);return r}function $M(e,t,r=16){const n=Uv(e,t),a=new Array(r).fill(null);for(const d of Object.values(n))a[d.location]=d;return a}function WM(e,t,r){const n=XM(e,r),a=qM(t,r);if(!n)return null;const d=VM(n.type),f=a?.vertexFormat||d.defaultVertexFormat,c=Lv(f);return{attributeName:a?.attributeName||n.name,bufferName:a?.bufferName||n.name,location:n.location,shaderType:n.type,shaderDataType:d.dataType,shaderComponents:d.components,vertexFormat:f,bufferDataType:c.type,bufferComponents:c.components,normalized:c.normalized,integer:d.integer,stepMode:a?.stepMode||n.stepMode,byteOffset:a?.byteOffset||0,byteStride:a?.byteStride||0}}function XM(e,t){const r=e.attributes.find(n=>n.name===t);return r||te.warn(`shader layout attribute "${t}" not present in shader`),r||null}function qM(e,t){ZM(e);let r=YM(e,t);return r||(r=KM(e,t),r)?r:(te.warn(`layout for attribute "${t}" not present in buffer layout`),null)}function ZM(e){for(const t of e)(t.attributes&&t.format||!t.attributes&&!t.format)&&te.warn(`BufferLayout ${name} must have either 'attributes' or 'format' field`)}function YM(e,t){for(const r of e)if(r.format&&r.name===t)return{attributeName:r.name,bufferName:t,stepMode:r.stepMode,vertexFormat:r.format,byteOffset:0,byteStride:r.byteStride||0};return null}function KM(e,t){for(const r of e){let n=r.byteStride;if(typeof r.byteStride!="number")for(const d of r.attributes||[]){const f=Lv(d.format);n+=f.byteLength}const a=r.attributes?.find(d=>d.attribute===t);if(a)return{attributeName:a.attribute,bufferName:r.name,stepMode:r.stepMode,vertexFormat:a.format,byteOffset:a.byteOffset,byteStride:n}}return null}function JM(e,t){const r={...e,attributes:e.attributes.map(n=>({...n}))};for(const n of t?.attributes||[]){const a=r.attributes.find(d=>d.name===n.name);a?(a.type=n.type||a.type,a.stepMode=n.stepMode||a.stepMode):te.warn(`shader layout attribute ${n.name} not present in shader`)}return r}class Ig extends _r{static defaultProps={..._r.defaultProps,renderPipeline:null};get[Symbol.toStringTag](){return"VertexArray"}maxVertexAttributes;attributeInfos;indexBuffer=null;attributes;constructor(t,r){super(t,r,Ig.defaultProps),this.maxVertexAttributes=t.limits.maxVertexAttributes,this.attributes=new Array(this.maxVertexAttributes).fill(null),this.attributeInfos=$M(r.renderPipeline.shaderLayout,r.renderPipeline.bufferLayout,this.maxVertexAttributes)}setConstantWebGL(t,r){throw new Error("constant attributes not supported")}}class Mg extends _r{static defaultProps={..._r.defaultProps,layout:void 0,buffers:{}};get[Symbol.toStringTag](){return"TransformFeedback"}constructor(t,r){super(t,r,Mg.defaultProps)}}class Rg extends _r{static defaultProps={..._r.defaultProps,type:void 0,count:void 0};get[Symbol.toStringTag](){return"QuerySet"}constructor(t,r){super(t,r,Rg.defaultProps)}}const QM={f32:{type:"f32",components:1},i32:{type:"i32",components:1},u32:{type:"u32",components:1},"vec2<f32>":{type:"f32",components:2},"vec3<f32>":{type:"f32",components:3},"vec4<f32>":{type:"f32",components:4},"vec2<i32>":{type:"i32",components:2},"vec3<i32>":{type:"i32",components:3},"vec4<i32>":{type:"i32",components:4},"vec2<u32>":{type:"u32",components:2},"vec3<u32>":{type:"u32",components:3},"vec4<u32>":{type:"u32",components:4},"mat2x2<f32>":{type:"f32",components:4},"mat2x3<f32>":{type:"f32",components:6},"mat2x4<f32>":{type:"f32",components:8},"mat3x2<f32>":{type:"f32",components:6},"mat3x3<f32>":{type:"f32",components:9},"mat3x4<f32>":{type:"f32",components:12},"mat4x2<f32>":{type:"f32",components:8},"mat4x3<f32>":{type:"f32",components:12},"mat4x4<f32>":{type:"f32",components:16}};function tR(e){const t=QM[e];return tr(e),t}function eR(e,t){switch(t){case 1:return e;case 2:return e+e%2;default:return e+(4-e%4)%4}}let _f;function zv(e){return(!_f||_f.byteLength<e)&&(_f=new ArrayBuffer(e)),_f}function rR(e,t){const r=zv(e.BYTES_PER_ELEMENT*t);return new e(r,0,t)}function iR(e){const{target:t,source:r,start:n=0,count:a=1}=e,d=r.length,f=a*d;let c=0;for(let T=n;c<d;c++)t[T++]=r[c];for(;c<f;)c<f-c?(t.copyWithin(n+c,n,n+c),c*=2):(t.copyWithin(n+c,n,n+f-c),c=f);return e.target}const Vv=1024;class sR{layout={};byteLength;constructor(t){let r=0;for(const[a,d]of Object.entries(t)){const f=tR(d),{type:c,components:T}=f;r=eR(r,T);const C=r;r+=T,this.layout[a]={type:c,size:T,offset:C}}r+=(4-r%4)%4;const n=r*4;this.byteLength=Math.max(n,Vv)}getData(t){const r=Math.max(this.byteLength,Vv),n=zv(r),a={i32:new Int32Array(n),u32:new Uint32Array(n),f32:new Float32Array(n),f16:new Uint16Array(n)};for(const[d,f]of Object.entries(t)){const c=this.layout[d];if(!c){te.warn(`Supplied uniform value ${d} not present in uniform block layout`)();continue}const{type:T,size:C,offset:R}=c,L=a[T];if(C===1){if(typeof f!="number"&&typeof f!="boolean"){te.warn(`Supplied value for single component uniform ${d} is not a number: ${f}`)();continue}L[R]=Number(f)}else{const V=rh(f);if(!V){te.warn(`Supplied value for multi component / array uniform ${d} is not a numeric array: ${f}`)();continue}L.set(V,R)}}return new Uint8Array(n)}has(t){return!!this.layout[t]}get(t){return this.layout[t]}}function nR(e,t,r=16){if(e!==t)return!1;const n=rh(e);if(!n)return!1;const a=rh(t);if(a&&n.length===a.length){for(let d=0;d<n.length;++d)if(a[d]!==n[d])return!1}return!0}function oR(e){const t=rh(e);return t?t.slice():e}class aR{name;uniforms={};modifiedUniforms={};modified=!0;bindingLayout={};needsRedraw="initialized";constructor(t){if(this.name=t?.name,t?.name&&t?.shaderLayout){const r=t?.shaderLayout.bindings?.find(a=>a.type==="uniform"&&a.name===t?.name);if(!r)throw new Error(t?.name);const n=r;for(const a of n.uniforms||[])this.bindingLayout[a.name]=a}}setUniforms(t){for(const[r,n]of Object.entries(t))this._setUniform(r,n),this.needsRedraw||this.setNeedsRedraw(`${this.name}.${r}=${n}`)}setNeedsRedraw(t){this.needsRedraw=this.needsRedraw||t}getAllUniforms(){return this.modifiedUniforms={},this.needsRedraw=!1,this.uniforms||{}}_setUniform(t,r){nR(this.uniforms[t],r)||(this.uniforms[t]=oR(r),this.modifiedUniforms[t]=!0,this.modified=!0)}}class lR{uniformBlocks=new Map;uniformBufferLayouts=new Map;uniformBuffers=new Map;constructor(t){for(const[r,n]of Object.entries(t)){const a=r,d=new sR(n.uniformTypes||{});this.uniformBufferLayouts.set(a,d);const f=new aR({name:r});f.setUniforms(n.defaultUniforms||{}),this.uniformBlocks.set(a,f)}}destroy(){for(const t of this.uniformBuffers.values())t.destroy()}setUniforms(t){for(const[r,n]of Object.entries(t))this.uniformBlocks.get(r).setUniforms(n);this.updateUniformBuffers()}getUniformBufferByteLength(t){return this.uniformBufferLayouts.get(t).byteLength}getUniformBufferData(t){const r=this.uniformBlocks.get(t).getAllUniforms();return this.uniformBufferLayouts.get(t).getData(r)}createUniformBuffer(t,r,n){n&&this.setUniforms(n);const a=this.getUniformBufferByteLength(r),d=t.createBuffer({usage:Fr.UNIFORM|Fr.COPY_DST,byteLength:a}),f=this.getUniformBufferData(r);return d.write(f),d}getManagedUniformBuffer(t,r){if(!this.uniformBuffers.get(r)){const n=this.getUniformBufferByteLength(r),a=t.createBuffer({usage:Fr.UNIFORM|Fr.COPY_DST,byteLength:n});this.uniformBuffers.set(r,a)}return this.uniformBuffers.get(r)}updateUniformBuffers(){let t=!1;for(const r of this.uniformBlocks.keys()){const n=this.updateUniformBuffer(r);t||=n}return t&&te.log(3,`UniformStore.updateUniformBuffers(): ${t}`)(),t}updateUniformBuffer(t){const r=this.uniformBlocks.get(t),n=this.uniformBuffers.get(t);let a=!1;if(n&&r.needsRedraw){a||=r.needsRedraw;const d=this.getUniformBufferData(t);this.uniformBuffers.get(t).write(d);const c=this.uniformBlocks.get(t).getAllUniforms();te.log(4,`Writing to uniform buffer ${String(t)}`,d,c)()}return a}}function jv(e){const t=ArrayBuffer.isView(e)?e.constructor:e;switch(t){case Float32Array:return"float32";case Uint16Array:return"uint16";case Uint32Array:return"uint32";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int8Array:return"sint8";case Int16Array:return"sint16";case Int32Array:return"sint32";default:throw new Error(t.constructor.name)}}function Hv(e){switch(e){case"float32":return Float32Array;case"uint32":return Uint32Array;case"sint32":return Int32Array;case"uint16":case"unorm16":return Uint16Array;case"sint16":case"snorm16":return Int16Array;case"uint8":case"unorm8":return Uint8Array;case"sint8":case"snorm8":return Int8Array;default:throw new Error(e)}}function cR(e,t,r){if(!t||t>4)throw new Error(`size ${t}`);const n=t;let a=jv(e);if(a==="uint8"&&r&&n===1)return"unorm8-webgl";if(a==="uint8"&&r&&n===3)return"unorm8x3-webgl";if(a==="uint8"||a==="sint8"){if(n===1||n===3)throw new Error(`size: ${t}`);return r&&(a=a.replace("int","norm")),`${a}x${n}`}if(a==="uint16"||a==="sint16"){if(n===1||n===3)throw new Error(`size: ${t}`);return r&&(a=a.replace("int","norm")),`${a}x${n}`}return n===1?a:`${a}x${n}`}function gj(e){return e}function uR(e){return rh(e)!==null||typeof e=="number"||typeof e=="boolean"}function Pg(e){const t={bindings:{},uniforms:{}};return Object.keys(e).forEach(r=>{const n=e[r];uR(n)?t.uniforms[r]=n:t.bindings[r]=n}),t}function hR(e,t,r){const{removedProps:n={},deprecatedProps:a={},replacedProps:d={}}=r;for(const c in n)if(c in t){const C=n[c]?`${e}.${n[c]}`:"N/A";te.removed(`${e}.${c}`,C)()}for(const c in a)if(c in t){const T=a[c];te.deprecated(`${e}.${c}`,`${e}.${T}`)()}let f=null;for(const[c,T]of Object.entries(d))c in t&&(te.deprecated(`${e}.${c}`,`${e}.${T}`)(),f=f||Object.assign({},t),f[T]=t[c],delete f[c]);return f||t}let dR="";async function fR(e,t){return await new Promise((r,n)=>{try{const a=new Image;a.onload=()=>r(a),a.onerror=()=>n(new Error(`Could not load image ${e}.`)),a.crossOrigin=t?.crossOrigin||"anonymous",a.src=e.startsWith("http")?e:dR+e}catch(a){n(a)}})}async function Gv(e,t){const r=document.getElementsByTagName("head")[0];if(!r)throw new Error("loadScript");const n=document.createElement("script");return n.setAttribute("type","text/javascript"),n.setAttribute("src",e),new Promise((a,d)=>{n.onload=a,n.onerror=f=>d(new Error(`Unable to load script '${e}': ${f}`)),r.appendChild(n)})}function Bg(e,t,r){if(e===t)return!0;if(!r||!e||!t)return!1;if(Array.isArray(e)){if(!Array.isArray(t)||e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(!Bg(e[n],t[n],r-1))return!1;return!0}if(Array.isArray(t))return!1;if(typeof e=="object"&&typeof t=="object"){const n=Object.keys(e),a=Object.keys(t);if(n.length!==a.length)return!1;for(const d of n)if(!t.hasOwnProperty(d)||!Bg(e[d],t[d],r-1))return!1;return!0}return!1}function pR(e){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(e):setTimeout(e,1e3/60)}function _R(e){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(e):clearTimeout(e)}class gR{constructor(){this.constants=new Map,this.aliases=new Map,this.structs=new Map}}class To{constructor(){}get isAstNode(){return!0}get astNodeType(){return""}evaluate(t){throw new Error("Cannot evaluate node")}evaluateString(t){return this.evaluate(t).toString()}search(t){}searchBlock(t,r){if(t){r(gf.instance);for(const n of t)n instanceof Array?this.searchBlock(n,r):n.search(r);r(mf.instance)}}}class gf extends To{}gf.instance=new gf;class mf extends To{}mf.instance=new mf;class Ur extends To{constructor(){super()}}class Dg extends Ur{constructor(t,r,n,a,d,f){super(),this.calls=new Set,this.name=t,this.args=r,this.returnType=n,this.body=a,this.startLine=d,this.endLine=f}get astNodeType(){return"function"}search(t){this.searchBlock(this.body,t)}}class mR extends Ur{constructor(t){super(),this.expression=t}get astNodeType(){return"staticAssert"}search(t){this.expression.search(t)}}class yR extends Ur{constructor(t,r){super(),this.condition=t,this.body=r}get astNodeType(){return"while"}search(t){this.condition.search(t),this.searchBlock(this.body,t)}}class bR extends Ur{constructor(t){super(),this.body=t}get astNodeType(){return"continuing"}search(t){this.searchBlock(this.body,t)}}class vR extends Ur{constructor(t,r,n,a){super(),this.init=t,this.condition=r,this.increment=n,this.body=a}get astNodeType(){return"for"}search(t){var r,n,a;(r=this.init)===null||r===void 0||r.search(t),(n=this.condition)===null||n===void 0||n.search(t),(a=this.increment)===null||a===void 0||a.search(t),this.searchBlock(this.body,t)}}class Ya extends Ur{constructor(t,r,n,a,d){super(),this.name=t,this.type=r,this.storage=n,this.access=a,this.value=d}get astNodeType(){return"var"}search(t){var r;t(this),(r=this.value)===null||r===void 0||r.search(t)}}class $v extends Ur{constructor(t,r,n){super(),this.name=t,this.type=r,this.value=n}get astNodeType(){return"override"}search(t){var r;(r=this.value)===null||r===void 0||r.search(t)}}class Fg extends Ur{constructor(t,r,n,a,d){super(),this.name=t,this.type=r,this.storage=n,this.access=a,this.value=d}get astNodeType(){return"let"}search(t){var r;t(this),(r=this.value)===null||r===void 0||r.search(t)}}class Wv extends Ur{constructor(t,r,n,a,d){super(),this.name=t,this.type=r,this.storage=n,this.access=a,this.value=d}get astNodeType(){return"const"}evaluate(t){return this.value.evaluate(t)}search(t){var r;t(this),(r=this.value)===null||r===void 0||r.search(t)}}var lc;(function(e){e.increment="++",e.decrement="--"})(lc||(lc={})),(function(e){function t(r){const n=r;if(n=="parse")throw new Error("Invalid value for IncrementOperator");return e[n]}e.parse=t})(lc||(lc={}));class xR extends Ur{constructor(t,r){super(),this.operator=t,this.variable=r}get astNodeType(){return"increment"}search(t){this.variable.search(t)}}var sh;(function(e){e.assign="=",e.addAssign="+=",e.subtractAssin="-=",e.multiplyAssign="*=",e.divideAssign="/=",e.moduloAssign="%=",e.andAssign="&=",e.orAssign="|=",e.xorAssign="^=",e.shiftLeftAssign="<<=",e.shiftRightAssign=">>="})(sh||(sh={})),(function(e){function t(r){const n=r;if(n=="parse")throw new Error("Invalid value for AssignOperator");return n}e.parse=t})(sh||(sh={}));class wR extends Ur{constructor(t,r,n){super(),this.operator=t,this.variable=r,this.value=n}get astNodeType(){return"assign"}search(t){this.variable.search(t),this.value.search(t)}}class Xv extends Ur{constructor(t,r){super(),this.name=t,this.args=r}get astNodeType(){return"call"}search(t){for(const r of this.args)r.search(t);t(this)}}class TR extends Ur{constructor(t,r){super(),this.body=t,this.continuing=r}get astNodeType(){return"loop"}}class AR extends Ur{constructor(t,r){super(),this.condition=t,this.body=r}get astNodeType(){return"body"}}class ER extends Ur{constructor(t,r,n,a){super(),this.condition=t,this.body=r,this.elseif=n,this.else=a}get astNodeType(){return"if"}search(t){this.condition.search(t),this.searchBlock(this.body,t),this.searchBlock(this.elseif,t),this.searchBlock(this.else,t)}}class SR extends Ur{constructor(t){super(),this.value=t}get astNodeType(){return"return"}search(t){var r;(r=this.value)===null||r===void 0||r.search(t)}}class CR extends Ur{constructor(t){super(),this.name=t}get astNodeType(){return"enable"}}class IR extends Ur{constructor(t){super(),this.extensions=t}get astNodeType(){return"requires"}}class MR extends Ur{constructor(t,r){super(),this.severity=t,this.rule=r}get astNodeType(){return"diagnostic"}}class qv extends Ur{constructor(t,r){super(),this.name=t,this.type=r}get astNodeType(){return"alias"}}class RR extends Ur{constructor(){super()}get astNodeType(){return"discard"}}class PR extends Ur{constructor(){super()}get astNodeType(){return"break"}}class BR extends Ur{constructor(){super()}get astNodeType(){return"continue"}}class Ka extends Ur{constructor(t){super(),this.name=t}get astNodeType(){return"type"}get isStruct(){return!1}get isArray(){return!1}}class Ja extends Ka{constructor(t,r,n,a){super(t),this.members=r,this.startLine=n,this.endLine=a}get astNodeType(){return"struct"}get isStruct(){return!0}getMemberIndex(t){for(let r=0;r<this.members.length;r++)if(this.members[r].name==t)return r;return-1}}class Zv extends Ka{constructor(t,r,n){super(t),this.format=r,this.access=n}get astNodeType(){return"template"}}class DR extends Ka{constructor(t,r,n,a){super(t),this.storage=r,this.type=n,this.access=a}get astNodeType(){return"pointer"}}class Yv extends Ka{constructor(t,r,n,a){super(t),this.attributes=r,this.format=n,this.count=a}get astNodeType(){return"array"}get isArray(){return!0}}class nh extends Ka{constructor(t,r,n){super(t),this.format=r,this.access=n}get astNodeType(){return"sampler"}}class Kn extends To{constructor(){super()}}class FR extends Kn{constructor(t){super(),this.value=t}get astNodeType(){return"stringExpr"}toString(){return this.value}evaluateString(){return this.value}}class cc extends Kn{constructor(t,r){super(),this.type=t,this.args=r}get astNodeType(){return"createExpr"}search(t){if(t(this),this.args)for(const r of this.args)r.search(t)}evaluate(t){return this.args[0].evaluate(t)}}class Kv extends Kn{constructor(t,r){super(),this.name=t,this.args=r}get astNodeType(){return"callExpr"}evaluate(t){switch(this.name){case"abs":return Math.abs(this.args[0].evaluate(t));case"acos":return Math.acos(this.args[0].evaluate(t));case"acosh":return Math.acosh(this.args[0].evaluate(t));case"asin":return Math.asin(this.args[0].evaluate(t));case"asinh":return Math.asinh(this.args[0].evaluate(t));case"atan":return Math.atan(this.args[0].evaluate(t));case"atan2":return Math.atan2(this.args[0].evaluate(t),this.args[1].evaluate(t));case"atanh":return Math.atanh(this.args[0].evaluate(t));case"ceil":return Math.ceil(this.args[0].evaluate(t));case"clamp":return Math.min(Math.max(this.args[0].evaluate(t),this.args[1].evaluate(t)),this.args[2].evaluate(t));case"cos":return Math.cos(this.args[0].evaluate(t));case"degrees":return this.args[0].evaluate(t)*180/Math.PI;case"distance":return Math.sqrt(Math.pow(this.args[0].evaluate(t)-this.args[1].evaluate(t),2));case"dot":case"exp":return Math.exp(this.args[0].evaluate(t));case"exp2":return Math.pow(2,this.args[0].evaluate(t));case"floor":return Math.floor(this.args[0].evaluate(t));case"fma":return this.args[0].evaluate(t)*this.args[1].evaluate(t)+this.args[2].evaluate(t);case"fract":return this.args[0].evaluate(t)-Math.floor(this.args[0].evaluate(t));case"inverseSqrt":return 1/Math.sqrt(this.args[0].evaluate(t));case"log":return Math.log(this.args[0].evaluate(t));case"log2":return Math.log2(this.args[0].evaluate(t));case"max":return Math.max(this.args[0].evaluate(t),this.args[1].evaluate(t));case"min":return Math.min(this.args[0].evaluate(t),this.args[1].evaluate(t));case"mix":return this.args[0].evaluate(t)*(1-this.args[2].evaluate(t))+this.args[1].evaluate(t)*this.args[2].evaluate(t);case"modf":return this.args[0].evaluate(t)-Math.floor(this.args[0].evaluate(t));case"pow":return Math.pow(this.args[0].evaluate(t),this.args[1].evaluate(t));case"radians":return this.args[0].evaluate(t)*Math.PI/180;case"round":return Math.round(this.args[0].evaluate(t));case"sign":return Math.sign(this.args[0].evaluate(t));case"sin":return Math.sin(this.args[0].evaluate(t));case"sinh":return Math.sinh(this.args[0].evaluate(t));case"saturate":return Math.min(Math.max(this.args[0].evaluate(t),0),1);case"smoothstep":return this.args[0].evaluate(t)*this.args[0].evaluate(t)*(3-2*this.args[0].evaluate(t));case"sqrt":return Math.sqrt(this.args[0].evaluate(t));case"step":return this.args[0].evaluate(t)<this.args[1].evaluate(t)?0:1;case"tan":return Math.tan(this.args[0].evaluate(t));case"tanh":return Math.tanh(this.args[0].evaluate(t));case"trunc":return Math.trunc(this.args[0].evaluate(t));default:throw new Error("Non const function: "+this.name)}}search(t){for(const r of this.args)r.search(t);t(this)}}class Og extends Kn{constructor(t){super(),this.name=t}get astNodeType(){return"varExpr"}search(t){t(this),this.postfix&&this.postfix.search(t)}evaluate(t){const r=t.constants.get(this.name);if(!r)throw new Error("Cannot evaluate node");return r.evaluate(t)}}class Jv extends Kn{constructor(t,r){super(),this.name=t,this.initializer=r}get astNodeType(){return"constExpr"}evaluate(t){var r,n;if(this.initializer instanceof cc){const a=(r=this.postfix)===null||r===void 0?void 0:r.evaluateString(t),d=(n=this.initializer.type)===null||n===void 0?void 0:n.name,f=t.structs.get(d),c=f?.getMemberIndex(a);return c!==void 0&&c!=-1?this.initializer.args[c].evaluate(t):this.initializer.evaluate(t)}return this.initializer.evaluate(t)}search(t){this.initializer.search(t)}}class Qv extends Kn{constructor(t){super(),this.value=t}get astNodeType(){return"literalExpr"}evaluate(){return this.value}}class OR extends Kn{constructor(t,r){super(),this.type=t,this.value=r}get astNodeType(){return"bitcastExpr"}search(t){this.value.search(t)}}class tx extends Kn{constructor(t){super(),this.contents=t}get astNodeType(){return"groupExpr"}evaluate(t){return this.contents[0].evaluate(t)}search(t){this.searchBlock(this.contents,t)}}class kR extends Kn{constructor(t){super(),this.index=t}search(t){this.index.search(t)}}class ex extends Kn{constructor(){super()}}class NR extends ex{constructor(t,r){super(),this.operator=t,this.right=r}get astNodeType(){return"unaryOp"}evaluate(t){switch(this.operator){case"+":return this.right.evaluate(t);case"-":return-this.right.evaluate(t);case"!":return this.right.evaluate(t)?0:1;case"~":return~this.right.evaluate(t);default:throw new Error("Unknown unary operator: "+this.operator)}}search(t){this.right.search(t)}}class Jn extends ex{constructor(t,r,n){super(),this.operator=t,this.left=r,this.right=n}get astNodeType(){return"binaryOp"}evaluate(t){switch(this.operator){case"+":return this.left.evaluate(t)+this.right.evaluate(t);case"-":return this.left.evaluate(t)-this.right.evaluate(t);case"*":return this.left.evaluate(t)*this.right.evaluate(t);case"/":return this.left.evaluate(t)/this.right.evaluate(t);case"%":return this.left.evaluate(t)%this.right.evaluate(t);case"==":return this.left.evaluate(t)==this.right.evaluate(t)?1:0;case"!=":return this.left.evaluate(t)!=this.right.evaluate(t)?1:0;case"<":return this.left.evaluate(t)<this.right.evaluate(t)?1:0;case">":return this.left.evaluate(t)>this.right.evaluate(t)?1:0;case"<=":return this.left.evaluate(t)<=this.right.evaluate(t)?1:0;case">=":return this.left.evaluate(t)>=this.right.evaluate(t)?1:0;case"&&":return this.left.evaluate(t)&&this.right.evaluate(t)?1:0;case"||":return this.left.evaluate(t)||this.right.evaluate(t)?1:0;default:throw new Error(`Unknown operator ${this.operator}`)}}search(t){this.left.search(t),this.right.search(t)}}class rx extends To{constructor(){super()}}class LR extends rx{constructor(t,r){super(),this.selector=t,this.body=r}get astNodeType(){return"case"}search(t){this.searchBlock(this.body,t)}}class UR extends rx{constructor(t){super(),this.body=t}get astNodeType(){return"default"}search(t){this.searchBlock(this.body,t)}}class zR extends To{constructor(t,r,n){super(),this.name=t,this.type=r,this.attributes=n}get astNodeType(){return"argument"}}class VR extends To{constructor(t,r){super(),this.condition=t,this.body=r}get astNodeType(){return"elseif"}search(t){this.condition.search(t),this.searchBlock(this.body,t)}}class jR extends To{constructor(t,r,n){super(),this.name=t,this.type=r,this.attributes=n}get astNodeType(){return"member"}}let HR=class extends To{constructor(t,r){super(),this.name=t,this.value=r}get astNodeType(){return"attribute"}};var Dt,At;(function(e){e[e.token=0]="token",e[e.keyword=1]="keyword",e[e.reserved=2]="reserved"})(At||(At={}));class Et{constructor(t,r,n){this.name=t,this.type=r,this.rule=n}toString(){return this.name}}class ot{}Dt=ot,ot.none=new Et("",At.reserved,""),ot.eof=new Et("EOF",At.token,""),ot.reserved={asm:new Et("asm",At.reserved,"asm"),bf16:new Et("bf16",At.reserved,"bf16"),do:new Et("do",At.reserved,"do"),enum:new Et("enum",At.reserved,"enum"),f16:new Et("f16",At.reserved,"f16"),f64:new Et("f64",At.reserved,"f64"),handle:new Et("handle",At.reserved,"handle"),i8:new Et("i8",At.reserved,"i8"),i16:new Et("i16",At.reserved,"i16"),i64:new Et("i64",At.reserved,"i64"),mat:new Et("mat",At.reserved,"mat"),premerge:new Et("premerge",At.reserved,"premerge"),regardless:new Et("regardless",At.reserved,"regardless"),typedef:new Et("typedef",At.reserved,"typedef"),u8:new Et("u8",At.reserved,"u8"),u16:new Et("u16",At.reserved,"u16"),u64:new Et("u64",At.reserved,"u64"),unless:new Et("unless",At.reserved,"unless"),using:new Et("using",At.reserved,"using"),vec:new Et("vec",At.reserved,"vec"),void:new Et("void",At.reserved,"void")},ot.keywords={array:new Et("array",At.keyword,"array"),atomic:new Et("atomic",At.keyword,"atomic"),bool:new Et("bool",At.keyword,"bool"),f32:new Et("f32",At.keyword,"f32"),i32:new Et("i32",At.keyword,"i32"),mat2x2:new Et("mat2x2",At.keyword,"mat2x2"),mat2x3:new Et("mat2x3",At.keyword,"mat2x3"),mat2x4:new Et("mat2x4",At.keyword,"mat2x4"),mat3x2:new Et("mat3x2",At.keyword,"mat3x2"),mat3x3:new Et("mat3x3",At.keyword,"mat3x3"),mat3x4:new Et("mat3x4",At.keyword,"mat3x4"),mat4x2:new Et("mat4x2",At.keyword,"mat4x2"),mat4x3:new Et("mat4x3",At.keyword,"mat4x3"),mat4x4:new Et("mat4x4",At.keyword,"mat4x4"),ptr:new Et("ptr",At.keyword,"ptr"),sampler:new Et("sampler",At.keyword,"sampler"),sampler_comparison:new Et("sampler_comparison",At.keyword,"sampler_comparison"),struct:new Et("struct",At.keyword,"struct"),texture_1d:new Et("texture_1d",At.keyword,"texture_1d"),texture_2d:new Et("texture_2d",At.keyword,"texture_2d"),texture_2d_array:new Et("texture_2d_array",At.keyword,"texture_2d_array"),texture_3d:new Et("texture_3d",At.keyword,"texture_3d"),texture_cube:new Et("texture_cube",At.keyword,"texture_cube"),texture_cube_array:new Et("texture_cube_array",At.keyword,"texture_cube_array"),texture_multisampled_2d:new Et("texture_multisampled_2d",At.keyword,"texture_multisampled_2d"),texture_storage_1d:new Et("texture_storage_1d",At.keyword,"texture_storage_1d"),texture_storage_2d:new Et("texture_storage_2d",At.keyword,"texture_storage_2d"),texture_storage_2d_array:new Et("texture_storage_2d_array",At.keyword,"texture_storage_2d_array"),texture_storage_3d:new Et("texture_storage_3d",At.keyword,"texture_storage_3d"),texture_depth_2d:new Et("texture_depth_2d",At.keyword,"texture_depth_2d"),texture_depth_2d_array:new Et("texture_depth_2d_array",At.keyword,"texture_depth_2d_array"),texture_depth_cube:new Et("texture_depth_cube",At.keyword,"texture_depth_cube"),texture_depth_cube_array:new Et("texture_depth_cube_array",At.keyword,"texture_depth_cube_array"),texture_depth_multisampled_2d:new Et("texture_depth_multisampled_2d",At.keyword,"texture_depth_multisampled_2d"),texture_external:new Et("texture_external",At.keyword,"texture_external"),u32:new Et("u32",At.keyword,"u32"),vec2:new Et("vec2",At.keyword,"vec2"),vec3:new Et("vec3",At.keyword,"vec3"),vec4:new Et("vec4",At.keyword,"vec4"),bitcast:new Et("bitcast",At.keyword,"bitcast"),block:new Et("block",At.keyword,"block"),break:new Et("break",At.keyword,"break"),case:new Et("case",At.keyword,"case"),continue:new Et("continue",At.keyword,"continue"),continuing:new Et("continuing",At.keyword,"continuing"),default:new Et("default",At.keyword,"default"),diagnostic:new Et("diagnostic",At.keyword,"diagnostic"),discard:new Et("discard",At.keyword,"discard"),else:new Et("else",At.keyword,"else"),enable:new Et("enable",At.keyword,"enable"),fallthrough:new Et("fallthrough",At.keyword,"fallthrough"),false:new Et("false",At.keyword,"false"),fn:new Et("fn",At.keyword,"fn"),for:new Et("for",At.keyword,"for"),function:new Et("function",At.keyword,"function"),if:new Et("if",At.keyword,"if"),let:new Et("let",At.keyword,"let"),const:new Et("const",At.keyword,"const"),loop:new Et("loop",At.keyword,"loop"),while:new Et("while",At.keyword,"while"),private:new Et("private",At.keyword,"private"),read:new Et("read",At.keyword,"read"),read_write:new Et("read_write",At.keyword,"read_write"),return:new Et("return",At.keyword,"return"),requires:new Et("requires",At.keyword,"requires"),storage:new Et("storage",At.keyword,"storage"),switch:new Et("switch",At.keyword,"switch"),true:new Et("true",At.keyword,"true"),alias:new Et("alias",At.keyword,"alias"),type:new Et("type",At.keyword,"type"),uniform:new Et("uniform",At.keyword,"uniform"),var:new Et("var",At.keyword,"var"),override:new Et("override",At.keyword,"override"),workgroup:new Et("workgroup",At.keyword,"workgroup"),write:new Et("write",At.keyword,"write"),r8unorm:new Et("r8unorm",At.keyword,"r8unorm"),r8snorm:new Et("r8snorm",At.keyword,"r8snorm"),r8uint:new Et("r8uint",At.keyword,"r8uint"),r8sint:new Et("r8sint",At.keyword,"r8sint"),r16uint:new Et("r16uint",At.keyword,"r16uint"),r16sint:new Et("r16sint",At.keyword,"r16sint"),r16float:new Et("r16float",At.keyword,"r16float"),rg8unorm:new Et("rg8unorm",At.keyword,"rg8unorm"),rg8snorm:new Et("rg8snorm",At.keyword,"rg8snorm"),rg8uint:new Et("rg8uint",At.keyword,"rg8uint"),rg8sint:new Et("rg8sint",At.keyword,"rg8sint"),r32uint:new Et("r32uint",At.keyword,"r32uint"),r32sint:new Et("r32sint",At.keyword,"r32sint"),r32float:new Et("r32float",At.keyword,"r32float"),rg16uint:new Et("rg16uint",At.keyword,"rg16uint"),rg16sint:new Et("rg16sint",At.keyword,"rg16sint"),rg16float:new Et("rg16float",At.keyword,"rg16float"),rgba8unorm:new Et("rgba8unorm",At.keyword,"rgba8unorm"),rgba8unorm_srgb:new Et("rgba8unorm_srgb",At.keyword,"rgba8unorm_srgb"),rgba8snorm:new Et("rgba8snorm",At.keyword,"rgba8snorm"),rgba8uint:new Et("rgba8uint",At.keyword,"rgba8uint"),rgba8sint:new Et("rgba8sint",At.keyword,"rgba8sint"),bgra8unorm:new Et("bgra8unorm",At.keyword,"bgra8unorm"),bgra8unorm_srgb:new Et("bgra8unorm_srgb",At.keyword,"bgra8unorm_srgb"),rgb10a2unorm:new Et("rgb10a2unorm",At.keyword,"rgb10a2unorm"),rg11b10float:new Et("rg11b10float",At.keyword,"rg11b10float"),rg32uint:new Et("rg32uint",At.keyword,"rg32uint"),rg32sint:new Et("rg32sint",At.keyword,"rg32sint"),rg32float:new Et("rg32float",At.keyword,"rg32float"),rgba16uint:new Et("rgba16uint",At.keyword,"rgba16uint"),rgba16sint:new Et("rgba16sint",At.keyword,"rgba16sint"),rgba16float:new Et("rgba16float",At.keyword,"rgba16float"),rgba32uint:new Et("rgba32uint",At.keyword,"rgba32uint"),rgba32sint:new Et("rgba32sint",At.keyword,"rgba32sint"),rgba32float:new Et("rgba32float",At.keyword,"rgba32float"),static_assert:new Et("static_assert",At.keyword,"static_assert")},ot.tokens={decimal_float_literal:new Et("decimal_float_literal",At.token,/((-?[0-9]*\.[0-9]+|-?[0-9]+\.[0-9]*)((e|E)(\+|-)?[0-9]+)?f?)|(-?[0-9]+(e|E)(\+|-)?[0-9]+f?)|([0-9]+f)/),hex_float_literal:new Et("hex_float_literal",At.token,/-?0x((([0-9a-fA-F]*\.[0-9a-fA-F]+|[0-9a-fA-F]+\.[0-9a-fA-F]*)((p|P)(\+|-)?[0-9]+f?)?)|([0-9a-fA-F]+(p|P)(\+|-)?[0-9]+f?))/),int_literal:new Et("int_literal",At.token,/-?0x[0-9a-fA-F]+|0i?|-?[1-9][0-9]*i?/),uint_literal:new Et("uint_literal",At.token,/0x[0-9a-fA-F]+u|0u|[1-9][0-9]*u/),ident:new Et("ident",At.token,/[_a-zA-Z][0-9a-zA-Z_]*/),and:new Et("and",At.token,"&"),and_and:new Et("and_and",At.token,"&&"),arrow:new Et("arrow ",At.token,"->"),attr:new Et("attr",At.token,"@"),forward_slash:new Et("forward_slash",At.token,"/"),bang:new Et("bang",At.token,"!"),bracket_left:new Et("bracket_left",At.token,"["),bracket_right:new Et("bracket_right",At.token,"]"),brace_left:new Et("brace_left",At.token,"{"),brace_right:new Et("brace_right",At.token,"}"),colon:new Et("colon",At.token,":"),comma:new Et("comma",At.token,","),equal:new Et("equal",At.token,"="),equal_equal:new Et("equal_equal",At.token,"=="),not_equal:new Et("not_equal",At.token,"!="),greater_than:new Et("greater_than",At.token,">"),greater_than_equal:new Et("greater_than_equal",At.token,">="),shift_right:new Et("shift_right",At.token,">>"),less_than:new Et("less_than",At.token,"<"),less_than_equal:new Et("less_than_equal",At.token,"<="),shift_left:new Et("shift_left",At.token,"<<"),modulo:new Et("modulo",At.token,"%"),minus:new Et("minus",At.token,"-"),minus_minus:new Et("minus_minus",At.token,"--"),period:new Et("period",At.token,"."),plus:new Et("plus",At.token,"+"),plus_plus:new Et("plus_plus",At.token,"++"),or:new Et("or",At.token,"|"),or_or:new Et("or_or",At.token,"||"),paren_left:new Et("paren_left",At.token,"("),paren_right:new Et("paren_right",At.token,")"),semicolon:new Et("semicolon",At.token,";"),star:new Et("star",At.token,"*"),tilde:new Et("tilde",At.token,"~"),underscore:new Et("underscore",At.token,"_"),xor:new Et("xor",At.token,"^"),plus_equal:new Et("plus_equal",At.token,"+="),minus_equal:new Et("minus_equal",At.token,"-="),times_equal:new Et("times_equal",At.token,"*="),division_equal:new Et("division_equal",At.token,"/="),modulo_equal:new Et("modulo_equal",At.token,"%="),and_equal:new Et("and_equal",At.token,"&="),or_equal:new Et("or_equal",At.token,"|="),xor_equal:new Et("xor_equal",At.token,"^="),shift_right_equal:new Et("shift_right_equal",At.token,">>="),shift_left_equal:new Et("shift_left_equal",At.token,"<<=")},ot.simpleTokens={"@":Dt.tokens.attr,"{":Dt.tokens.brace_left,"}":Dt.tokens.brace_right,":":Dt.tokens.colon,",":Dt.tokens.comma,"(":Dt.tokens.paren_left,")":Dt.tokens.paren_right,";":Dt.tokens.semicolon},ot.literalTokens={"&":Dt.tokens.and,"&&":Dt.tokens.and_and,"->":Dt.tokens.arrow,"/":Dt.tokens.forward_slash,"!":Dt.tokens.bang,"[":Dt.tokens.bracket_left,"]":Dt.tokens.bracket_right,"=":Dt.tokens.equal,"==":Dt.tokens.equal_equal,"!=":Dt.tokens.not_equal,">":Dt.tokens.greater_than,">=":Dt.tokens.greater_than_equal,">>":Dt.tokens.shift_right,"<":Dt.tokens.less_than,"<=":Dt.tokens.less_than_equal,"<<":Dt.tokens.shift_left,"%":Dt.tokens.modulo,"-":Dt.tokens.minus,"--":Dt.tokens.minus_minus,".":Dt.tokens.period,"+":Dt.tokens.plus,"++":Dt.tokens.plus_plus,"|":Dt.tokens.or,"||":Dt.tokens.or_or,"*":Dt.tokens.star,"~":Dt.tokens.tilde,_:Dt.tokens.underscore,"^":Dt.tokens.xor,"+=":Dt.tokens.plus_equal,"-=":Dt.tokens.minus_equal,"*=":Dt.tokens.times_equal,"/=":Dt.tokens.division_equal,"%=":Dt.tokens.modulo_equal,"&=":Dt.tokens.and_equal,"|=":Dt.tokens.or_equal,"^=":Dt.tokens.xor_equal,">>=":Dt.tokens.shift_right_equal,"<<=":Dt.tokens.shift_left_equal},ot.regexTokens={decimal_float_literal:Dt.tokens.decimal_float_literal,hex_float_literal:Dt.tokens.hex_float_literal,int_literal:Dt.tokens.int_literal,uint_literal:Dt.tokens.uint_literal,ident:Dt.tokens.ident},ot.storage_class=[Dt.keywords.function,Dt.keywords.private,Dt.keywords.workgroup,Dt.keywords.uniform,Dt.keywords.storage],ot.access_mode=[Dt.keywords.read,Dt.keywords.write,Dt.keywords.read_write],ot.sampler_type=[Dt.keywords.sampler,Dt.keywords.sampler_comparison],ot.sampled_texture_type=[Dt.keywords.texture_1d,Dt.keywords.texture_2d,Dt.keywords.texture_2d_array,Dt.keywords.texture_3d,Dt.keywords.texture_cube,Dt.keywords.texture_cube_array],ot.multisampled_texture_type=[Dt.keywords.texture_multisampled_2d],ot.storage_texture_type=[Dt.keywords.texture_storage_1d,Dt.keywords.texture_storage_2d,Dt.keywords.texture_storage_2d_array,Dt.keywords.texture_storage_3d],ot.depth_texture_type=[Dt.keywords.texture_depth_2d,Dt.keywords.texture_depth_2d_array,Dt.keywords.texture_depth_cube,Dt.keywords.texture_depth_cube_array,Dt.keywords.texture_depth_multisampled_2d],ot.texture_external_type=[Dt.keywords.texture_external],ot.any_texture_type=[...Dt.sampled_texture_type,...Dt.multisampled_texture_type,...Dt.storage_texture_type,...Dt.depth_texture_type,...Dt.texture_external_type],ot.texel_format=[Dt.keywords.r8unorm,Dt.keywords.r8snorm,Dt.keywords.r8uint,Dt.keywords.r8sint,Dt.keywords.r16uint,Dt.keywords.r16sint,Dt.keywords.r16float,Dt.keywords.rg8unorm,Dt.keywords.rg8snorm,Dt.keywords.rg8uint,Dt.keywords.rg8sint,Dt.keywords.r32uint,Dt.keywords.r32sint,Dt.keywords.r32float,Dt.keywords.rg16uint,Dt.keywords.rg16sint,Dt.keywords.rg16float,Dt.keywords.rgba8unorm,Dt.keywords.rgba8unorm_srgb,Dt.keywords.rgba8snorm,Dt.keywords.rgba8uint,Dt.keywords.rgba8sint,Dt.keywords.bgra8unorm,Dt.keywords.bgra8unorm_srgb,Dt.keywords.rgb10a2unorm,Dt.keywords.rg11b10float,Dt.keywords.rg32uint,Dt.keywords.rg32sint,Dt.keywords.rg32float,Dt.keywords.rgba16uint,Dt.keywords.rgba16sint,Dt.keywords.rgba16float,Dt.keywords.rgba32uint,Dt.keywords.rgba32sint,Dt.keywords.rgba32float],ot.const_literal=[Dt.tokens.int_literal,Dt.tokens.uint_literal,Dt.tokens.decimal_float_literal,Dt.tokens.hex_float_literal,Dt.keywords.true,Dt.keywords.false],ot.literal_or_ident=[Dt.tokens.ident,Dt.tokens.int_literal,Dt.tokens.uint_literal,Dt.tokens.decimal_float_literal,Dt.tokens.hex_float_literal],ot.element_count_expression=[Dt.tokens.int_literal,Dt.tokens.uint_literal,Dt.tokens.ident],ot.template_types=[Dt.keywords.vec2,Dt.keywords.vec3,Dt.keywords.vec4,Dt.keywords.mat2x2,Dt.keywords.mat2x3,Dt.keywords.mat2x4,Dt.keywords.mat3x2,Dt.keywords.mat3x3,Dt.keywords.mat3x4,Dt.keywords.mat4x2,Dt.keywords.mat4x3,Dt.keywords.mat4x4,Dt.keywords.atomic,Dt.keywords.bitcast,...Dt.any_texture_type],ot.attribute_name=[Dt.tokens.ident,Dt.keywords.block,Dt.keywords.diagnostic],ot.assignment_operators=[Dt.tokens.equal,Dt.tokens.plus_equal,Dt.tokens.minus_equal,Dt.tokens.times_equal,Dt.tokens.division_equal,Dt.tokens.modulo_equal,Dt.tokens.and_equal,Dt.tokens.or_equal,Dt.tokens.xor_equal,Dt.tokens.shift_right_equal,Dt.tokens.shift_left_equal],ot.increment_operators=[Dt.tokens.plus_plus,Dt.tokens.minus_minus];class ix{constructor(t,r,n){this.type=t,this.lexeme=r,this.line=n}toString(){return this.lexeme}isTemplateType(){return ot.template_types.indexOf(this.type)!=-1}isArrayType(){return this.type==ot.keywords.array}isArrayOrTemplateType(){return this.isArrayType()||this.isTemplateType()}}class GR{constructor(t){this._tokens=[],this._start=0,this._current=0,this._line=1,this._source=t??""}scanTokens(){for(;!this._isAtEnd();)if(this._start=this._current,!this.scanToken())throw`Invalid syntax at line ${this._line}`;return this._tokens.push(new ix(ot.eof,"",this._line)),this._tokens}scanToken(){let t=this._advance();if(t==`
`)return this._line++,!0;if(this._isWhitespace(t))return!0;if(t=="/"){if(this._peekAhead()=="/"){for(;t!=`
`;){if(this._isAtEnd())return!0;t=this._advance()}return this._line++,!0}else if(this._peekAhead()=="*"){this._advance();let f=1;for(;f>0;){if(this._isAtEnd())return!0;if(t=this._advance(),t==`
`)this._line++;else if(t=="*"){if(this._peekAhead()=="/"&&(this._advance(),f--,f==0))return!0}else t=="/"&&this._peekAhead()=="*"&&(this._advance(),f++)}return!0}}const r=ot.simpleTokens[t];if(r)return this._addToken(r),!0;let n=ot.none;const a=this._isAlpha(t),d=t==="_";if(this._isAlphaNumeric(t)){let f=this._peekAhead();for(;this._isAlphaNumeric(f);)t+=this._advance(),f=this._peekAhead()}if(a){const f=ot.keywords[t];if(f)return this._addToken(f),!0}if(a||d)return this._addToken(ot.tokens.ident),!0;for(;;){let f=this._findType(t);const c=this._peekAhead();if(t=="-"&&this._tokens.length>0){if(c=="=")return this._current++,t+=c,this._addToken(ot.tokens.minus_equal),!0;if(c=="-")return this._current++,t+=c,this._addToken(ot.tokens.minus_minus),!0;const T=this._tokens.length-1;if((ot.literal_or_ident.indexOf(this._tokens[T].type)!=-1||this._tokens[T].type==ot.tokens.paren_right)&&c!=">")return this._addToken(f),!0}if(t==">"&&(c==">"||c=="=")){let T=!1,C=this._tokens.length-1;for(let R=0;R<5&&C>=0&&ot.assignment_operators.indexOf(this._tokens[C].type)===-1;++R,--C)if(this._tokens[C].type===ot.tokens.less_than){C>0&&this._tokens[C-1].isArrayOrTemplateType()&&(T=!0);break}if(T)return this._addToken(f),!0}if(f===ot.none){let T=t,C=0;const R=2;for(let L=0;L<R;++L)if(T+=this._peekAhead(L),f=this._findType(T),f!==ot.none){C=L;break}if(f===ot.none)return n===ot.none?!1:(this._current--,this._addToken(n),!0);t=T,this._current+=C+1}if(n=f,this._isAtEnd())break;t+=this._advance()}return n===ot.none?!1:(this._addToken(n),!0)}_findType(t){for(const n in ot.regexTokens){const a=ot.regexTokens[n];if(this._match(t,a.rule))return a}const r=ot.literalTokens[t];return r||ot.none}_match(t,r){const n=r.exec(t);return n&&n.index==0&&n[0]==t}_isAtEnd(){return this._current>=this._source.length}_isAlpha(t){return t>="a"&&t<="z"||t>="A"&&t<="Z"}_isAlphaNumeric(t){return t>="a"&&t<="z"||t>="A"&&t<="Z"||t=="_"||t>="0"&&t<="9"}_isWhitespace(t){return t==" "||t=="	"||t=="\r"}_advance(t=0){let r=this._source[this._current];return t=t||0,t++,this._current+=t,r}_peekAhead(t=0){return t=t||0,this._current+t>=this._source.length?"\0":this._source[this._current+t]}_addToken(t){const r=this._source.substring(this._start,this._current);this._tokens.push(new ix(t,r,this._line))}}class $R{constructor(){this._tokens=[],this._current=0,this._currentLine=0,this._context=new gR,this._deferArrayCountEval=[]}parse(t){this._initialize(t),this._deferArrayCountEval.length=0;const r=[];for(;!this._isAtEnd();){const n=this._global_decl_or_directive();if(!n)break;r.push(n)}if(this._deferArrayCountEval.length>0){for(const n of this._deferArrayCountEval){const a=n.arrayType,d=n.countNode;if(d instanceof Og){const c=d.name,T=this._context.constants.get(c);if(T)try{const C=T.evaluate(this._context);a.count=C}catch{}}}this._deferArrayCountEval.length=0}return r}_initialize(t){if(t)if(typeof t=="string"){const r=new GR(t);this._tokens=r.scanTokens()}else this._tokens=t;else this._tokens=[];this._current=0}_error(t,r){return{token:t,message:r,toString:function(){return`${r}`}}}_isAtEnd(){return this._current>=this._tokens.length||this._peek().type==ot.eof}_match(t){if(t instanceof Et)return this._check(t)?(this._advance(),!0):!1;for(let r=0,n=t.length;r<n;++r){const a=t[r];if(this._check(a))return this._advance(),!0}return!1}_consume(t,r){if(this._check(t))return this._advance();throw this._error(this._peek(),r)}_check(t){if(this._isAtEnd())return!1;const r=this._peek();if(t instanceof Array){const n=r.type;return t.indexOf(n)!=-1}return r.type==t}_advance(){var t,r;return this._currentLine=(r=(t=this._peek())===null||t===void 0?void 0:t.line)!==null&&r!==void 0?r:-1,this._isAtEnd()||this._current++,this._previous()}_peek(){return this._tokens[this._current]}_previous(){return this._tokens[this._current-1]}_global_decl_or_directive(){for(;this._match(ot.tokens.semicolon)&&!this._isAtEnd(););if(this._match(ot.keywords.alias)){const r=this._type_alias();return this._consume(ot.tokens.semicolon,"Expected ';'"),r}if(this._match(ot.keywords.diagnostic)){const r=this._diagnostic();return this._consume(ot.tokens.semicolon,"Expected ';'"),r}if(this._match(ot.keywords.requires)){const r=this._requires_directive();return this._consume(ot.tokens.semicolon,"Expected ';'"),r}if(this._match(ot.keywords.enable)){const r=this._enable_directive();return this._consume(ot.tokens.semicolon,"Expected ';'"),r}const t=this._attribute();if(this._check(ot.keywords.var)){const r=this._global_variable_decl();return r!=null&&(r.attributes=t),this._consume(ot.tokens.semicolon,"Expected ';'."),r}if(this._check(ot.keywords.override)){const r=this._override_variable_decl();return r!=null&&(r.attributes=t),this._consume(ot.tokens.semicolon,"Expected ';'."),r}if(this._check(ot.keywords.let)){const r=this._global_let_decl();return r!=null&&(r.attributes=t),this._consume(ot.tokens.semicolon,"Expected ';'."),r}if(this._check(ot.keywords.const)){const r=this._global_const_decl();return r!=null&&(r.attributes=t),this._consume(ot.tokens.semicolon,"Expected ';'."),r}if(this._check(ot.keywords.struct)){const r=this._struct_decl();return r!=null&&(r.attributes=t),r}if(this._check(ot.keywords.fn)){const r=this._function_decl();return r!=null&&(r.attributes=t),r}return null}_function_decl(){if(!this._match(ot.keywords.fn))return null;const t=this._currentLine,r=this._consume(ot.tokens.ident,"Expected function name.").toString();this._consume(ot.tokens.paren_left,"Expected '(' for function arguments.");const n=[];if(!this._check(ot.tokens.paren_right))do{if(this._check(ot.tokens.paren_right))break;const c=this._attribute(),T=this._consume(ot.tokens.ident,"Expected argument name.").toString();this._consume(ot.tokens.colon,"Expected ':' for argument type.");const C=this._attribute(),R=this._type_decl();R!=null&&(R.attributes=C,n.push(new zR(T,R,c)))}while(this._match(ot.tokens.comma));this._consume(ot.tokens.paren_right,"Expected ')' after function arguments.");let a=null;if(this._match(ot.tokens.arrow)){const c=this._attribute();a=this._type_decl(),a!=null&&(a.attributes=c)}const d=this._compound_statement(),f=this._currentLine;return new Dg(r,n,a,d,t,f)}_compound_statement(){const t=[];for(this._consume(ot.tokens.brace_left,"Expected '{' for block.");!this._check(ot.tokens.brace_right);){const r=this._statement();r!==null&&t.push(r)}return this._consume(ot.tokens.brace_right,"Expected '}' for block."),t}_statement(){for(;this._match(ot.tokens.semicolon)&&!this._isAtEnd(););if(this._check(ot.tokens.attr)&&this._attribute(),this._check(ot.keywords.if))return this._if_statement();if(this._check(ot.keywords.switch))return this._switch_statement();if(this._check(ot.keywords.loop))return this._loop_statement();if(this._check(ot.keywords.for))return this._for_statement();if(this._check(ot.keywords.while))return this._while_statement();if(this._check(ot.keywords.continuing))return this._continuing_statement();if(this._check(ot.keywords.static_assert))return this._static_assert_statement();if(this._check(ot.tokens.brace_left))return this._compound_statement();let t=null;return this._check(ot.keywords.return)?t=this._return_statement():this._check([ot.keywords.var,ot.keywords.let,ot.keywords.const])?t=this._variable_statement():this._match(ot.keywords.discard)?t=new RR:this._match(ot.keywords.break)?t=new PR:this._match(ot.keywords.continue)?t=new BR:t=this._increment_decrement_statement()||this._func_call_statement()||this._assignment_statement(),t!=null&&this._consume(ot.tokens.semicolon,"Expected ';' after statement."),t}_static_assert_statement(){if(!this._match(ot.keywords.static_assert))return null;const t=this._optional_paren_expression();return new mR(t)}_while_statement(){if(!this._match(ot.keywords.while))return null;const t=this._optional_paren_expression();this._check(ot.tokens.attr)&&this._attribute();const r=this._compound_statement();return new yR(t,r)}_continuing_statement(){if(!this._match(ot.keywords.continuing))return null;const t=this._compound_statement();return new bR(t)}_for_statement(){if(!this._match(ot.keywords.for))return null;this._consume(ot.tokens.paren_left,"Expected '('.");const t=this._check(ot.tokens.semicolon)?null:this._for_init();this._consume(ot.tokens.semicolon,"Expected ';'.");const r=this._check(ot.tokens.semicolon)?null:this._short_circuit_or_expression();this._consume(ot.tokens.semicolon,"Expected ';'.");const n=this._check(ot.tokens.paren_right)?null:this._for_increment();this._consume(ot.tokens.paren_right,"Expected ')'."),this._check(ot.tokens.attr)&&this._attribute();const a=this._compound_statement();return new vR(t,r,n,a)}_for_init(){return this._variable_statement()||this._func_call_statement()||this._assignment_statement()}_for_increment(){return this._func_call_statement()||this._increment_decrement_statement()||this._assignment_statement()}_variable_statement(){if(this._check(ot.keywords.var)){const t=this._variable_decl();if(t===null)throw this._error(this._peek(),"Variable declaration expected.");let r=null;return this._match(ot.tokens.equal)&&(r=this._short_circuit_or_expression()),new Ya(t.name,t.type,t.storage,t.access,r)}if(this._match(ot.keywords.let)){const t=this._consume(ot.tokens.ident,"Expected name for let.").toString();let r=null;if(this._match(ot.tokens.colon)){const a=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=a)}this._consume(ot.tokens.equal,"Expected '=' for let.");const n=this._short_circuit_or_expression();return new Fg(t,r,null,null,n)}if(this._match(ot.keywords.const)){const t=this._consume(ot.tokens.ident,"Expected name for const.").toString();let r=null;if(this._match(ot.tokens.colon)){const a=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=a)}this._consume(ot.tokens.equal,"Expected '=' for const.");const n=this._short_circuit_or_expression();return new Wv(t,r,null,null,n)}return null}_increment_decrement_statement(){const t=this._current,r=this._unary_expression();if(r==null)return null;if(!this._check(ot.increment_operators))return this._current=t,null;const n=this._consume(ot.increment_operators,"Expected increment operator");return new xR(n.type===ot.tokens.plus_plus?lc.increment:lc.decrement,r)}_assignment_statement(){let t=null;if(this._check(ot.tokens.brace_right))return null;let r=this._match(ot.tokens.underscore);if(r||(t=this._unary_expression()),!r&&t==null)return null;const n=this._consume(ot.assignment_operators,"Expected assignment operator."),a=this._short_circuit_or_expression();return new wR(sh.parse(n.lexeme),t,a)}_func_call_statement(){if(!this._check(ot.tokens.ident))return null;const t=this._current,r=this._consume(ot.tokens.ident,"Expected function name."),n=this._argument_expression_list();return n===null?(this._current=t,null):new Xv(r.lexeme,n)}_loop_statement(){if(!this._match(ot.keywords.loop))return null;this._check(ot.tokens.attr)&&this._attribute(),this._consume(ot.tokens.brace_left,"Expected '{' for loop.");const t=[];let r=this._statement();for(;r!==null;){if(Array.isArray(r))for(let a of r)t.push(a);else t.push(r);r=this._statement()}let n=null;return this._match(ot.keywords.continuing)&&(n=this._compound_statement()),this._consume(ot.tokens.brace_right,"Expected '}' for loop."),new TR(t,n)}_switch_statement(){if(!this._match(ot.keywords.switch))return null;const t=this._optional_paren_expression();this._check(ot.tokens.attr)&&this._attribute(),this._consume(ot.tokens.brace_left,"Expected '{' for switch.");const r=this._switch_body();if(r==null||r.length==0)throw this._error(this._previous(),"Expected 'case' or 'default'.");return this._consume(ot.tokens.brace_right,"Expected '}' for switch."),new AR(t,r)}_switch_body(){const t=[];if(this._match(ot.keywords.case)){const r=this._case_selectors();this._match(ot.tokens.colon),this._check(ot.tokens.attr)&&this._attribute(),this._consume(ot.tokens.brace_left,"Exected '{' for switch case.");const n=this._case_body();this._consume(ot.tokens.brace_right,"Exected '}' for switch case."),t.push(new LR(r,n))}if(this._match(ot.keywords.default)){this._match(ot.tokens.colon),this._check(ot.tokens.attr)&&this._attribute(),this._consume(ot.tokens.brace_left,"Exected '{' for switch default.");const r=this._case_body();this._consume(ot.tokens.brace_right,"Exected '}' for switch default."),t.push(new UR(r))}if(this._check([ot.keywords.default,ot.keywords.case])){const r=this._switch_body();t.push(r[0])}return t}_case_selectors(){const t=[this._shift_expression()];for(;this._match(ot.tokens.comma);)t.push(this._shift_expression());return t}_case_body(){if(this._match(ot.keywords.fallthrough))return this._consume(ot.tokens.semicolon,"Expected ';'"),[];let t=this._statement();if(t==null)return[];t instanceof Array||(t=[t]);const r=this._case_body();return r.length==0?t:[...t,r[0]]}_if_statement(){if(!this._match(ot.keywords.if))return null;const t=this._optional_paren_expression();this._check(ot.tokens.attr)&&this._attribute();const r=this._compound_statement();let n=[];this._match_elseif()&&(this._check(ot.tokens.attr)&&this._attribute(),n=this._elseif_statement(n));let a=null;return this._match(ot.keywords.else)&&(this._check(ot.tokens.attr)&&this._attribute(),a=this._compound_statement()),new ER(t,r,n,a)}_match_elseif(){return this._tokens[this._current].type===ot.keywords.else&&this._tokens[this._current+1].type===ot.keywords.if?(this._advance(),this._advance(),!0):!1}_elseif_statement(t=[]){const r=this._optional_paren_expression(),n=this._compound_statement();return t.push(new VR(r,n)),this._match_elseif()&&(this._check(ot.tokens.attr)&&this._attribute(),this._elseif_statement(t)),t}_return_statement(){if(!this._match(ot.keywords.return))return null;const t=this._short_circuit_or_expression();return new SR(t)}_short_circuit_or_expression(){let t=this._short_circuit_and_expr();for(;this._match(ot.tokens.or_or);)t=new Jn(this._previous().toString(),t,this._short_circuit_and_expr());return t}_short_circuit_and_expr(){let t=this._inclusive_or_expression();for(;this._match(ot.tokens.and_and);)t=new Jn(this._previous().toString(),t,this._inclusive_or_expression());return t}_inclusive_or_expression(){let t=this._exclusive_or_expression();for(;this._match(ot.tokens.or);)t=new Jn(this._previous().toString(),t,this._exclusive_or_expression());return t}_exclusive_or_expression(){let t=this._and_expression();for(;this._match(ot.tokens.xor);)t=new Jn(this._previous().toString(),t,this._and_expression());return t}_and_expression(){let t=this._equality_expression();for(;this._match(ot.tokens.and);)t=new Jn(this._previous().toString(),t,this._equality_expression());return t}_equality_expression(){const t=this._relational_expression();return this._match([ot.tokens.equal_equal,ot.tokens.not_equal])?new Jn(this._previous().toString(),t,this._relational_expression()):t}_relational_expression(){let t=this._shift_expression();for(;this._match([ot.tokens.less_than,ot.tokens.greater_than,ot.tokens.less_than_equal,ot.tokens.greater_than_equal]);)t=new Jn(this._previous().toString(),t,this._shift_expression());return t}_shift_expression(){let t=this._additive_expression();for(;this._match([ot.tokens.shift_left,ot.tokens.shift_right]);)t=new Jn(this._previous().toString(),t,this._additive_expression());return t}_additive_expression(){let t=this._multiplicative_expression();for(;this._match([ot.tokens.plus,ot.tokens.minus]);)t=new Jn(this._previous().toString(),t,this._multiplicative_expression());return t}_multiplicative_expression(){let t=this._unary_expression();for(;this._match([ot.tokens.star,ot.tokens.forward_slash,ot.tokens.modulo]);)t=new Jn(this._previous().toString(),t,this._unary_expression());return t}_unary_expression(){return this._match([ot.tokens.minus,ot.tokens.bang,ot.tokens.tilde,ot.tokens.star,ot.tokens.and])?new NR(this._previous().toString(),this._unary_expression()):this._singular_expression()}_singular_expression(){const t=this._primary_expression(),r=this._postfix_expression();return r&&(t.postfix=r),t}_postfix_expression(){if(this._match(ot.tokens.bracket_left)){const t=this._short_circuit_or_expression();this._consume(ot.tokens.bracket_right,"Expected ']'.");const r=new kR(t),n=this._postfix_expression();return n&&(r.postfix=n),r}if(this._match(ot.tokens.period)){const t=this._consume(ot.tokens.ident,"Expected member name."),r=this._postfix_expression(),n=new FR(t.lexeme);return r&&(n.postfix=r),n}return null}_getStruct(t){return this._context.aliases.has(t)?this._context.aliases.get(t).type:this._context.structs.has(t)?this._context.structs.get(t):null}_primary_expression(){if(this._match(ot.tokens.ident)){const n=this._previous().toString();if(this._check(ot.tokens.paren_left)){const a=this._argument_expression_list(),d=this._getStruct(n);return d!=null?new cc(d,a):new Kv(n,a)}if(this._context.constants.has(n)){const a=this._context.constants.get(n);return new Jv(n,a.value)}return new Og(n)}if(this._match(ot.const_literal))return new Qv(parseFloat(this._previous().toString()));if(this._check(ot.tokens.paren_left))return this._paren_expression();if(this._match(ot.keywords.bitcast)){this._consume(ot.tokens.less_than,"Expected '<'.");const n=this._type_decl();this._consume(ot.tokens.greater_than,"Expected '>'.");const a=this._paren_expression();return new OR(n,a)}const t=this._type_decl(),r=this._argument_expression_list();return new cc(t,r)}_argument_expression_list(){if(!this._match(ot.tokens.paren_left))return null;const t=[];do{if(this._check(ot.tokens.paren_right))break;const r=this._short_circuit_or_expression();t.push(r)}while(this._match(ot.tokens.comma));return this._consume(ot.tokens.paren_right,"Expected ')' for agument list"),t}_optional_paren_expression(){this._match(ot.tokens.paren_left);const t=this._short_circuit_or_expression();return this._match(ot.tokens.paren_right),new tx([t])}_paren_expression(){this._consume(ot.tokens.paren_left,"Expected '('.");const t=this._short_circuit_or_expression();return this._consume(ot.tokens.paren_right,"Expected ')'."),new tx([t])}_struct_decl(){if(!this._match(ot.keywords.struct))return null;const t=this._currentLine,r=this._consume(ot.tokens.ident,"Expected name for struct.").toString();this._consume(ot.tokens.brace_left,"Expected '{' for struct body.");const n=[];for(;!this._check(ot.tokens.brace_right);){const f=this._attribute(),c=this._consume(ot.tokens.ident,"Expected variable name.").toString();this._consume(ot.tokens.colon,"Expected ':' for struct member type.");const T=this._attribute(),C=this._type_decl();C!=null&&(C.attributes=T),this._check(ot.tokens.brace_right)?this._match(ot.tokens.comma):this._consume(ot.tokens.comma,"Expected ',' for struct member."),n.push(new jR(c,C,f))}this._consume(ot.tokens.brace_right,"Expected '}' after struct body.");const a=this._currentLine,d=new Ja(r,n,t,a);return this._context.structs.set(r,d),d}_global_variable_decl(){const t=this._variable_decl();return t&&this._match(ot.tokens.equal)&&(t.value=this._const_expression()),t}_override_variable_decl(){const t=this._override_decl();return t&&this._match(ot.tokens.equal)&&(t.value=this._const_expression()),t}_global_const_decl(){if(!this._match(ot.keywords.const))return null;const t=this._consume(ot.tokens.ident,"Expected variable name");let r=null;if(this._match(ot.tokens.colon)){const d=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=d)}let n=null;if(this._match(ot.tokens.equal)){const d=this._short_circuit_or_expression();if(d instanceof cc)n=d;else if(d instanceof Jv&&d.initializer instanceof cc)n=d.initializer;else try{const f=d.evaluate(this._context);n=new Qv(f)}catch{n=d}}const a=new Wv(t.toString(),r,"","",n);return this._context.constants.set(a.name,a),a}_global_let_decl(){if(!this._match(ot.keywords.let))return null;const t=this._consume(ot.tokens.ident,"Expected variable name");let r=null;if(this._match(ot.tokens.colon)){const a=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=a)}let n=null;return this._match(ot.tokens.equal)&&(n=this._const_expression()),new Fg(t.toString(),r,"","",n)}_const_expression(){return this._short_circuit_or_expression()}_variable_decl(){if(!this._match(ot.keywords.var))return null;let t="",r="";this._match(ot.tokens.less_than)&&(t=this._consume(ot.storage_class,"Expected storage_class.").toString(),this._match(ot.tokens.comma)&&(r=this._consume(ot.access_mode,"Expected access_mode.").toString()),this._consume(ot.tokens.greater_than,"Expected '>'."));const n=this._consume(ot.tokens.ident,"Expected variable name");let a=null;if(this._match(ot.tokens.colon)){const d=this._attribute();a=this._type_decl(),a!=null&&(a.attributes=d)}return new Ya(n.toString(),a,t,r,null)}_override_decl(){if(!this._match(ot.keywords.override))return null;const t=this._consume(ot.tokens.ident,"Expected variable name");let r=null;if(this._match(ot.tokens.colon)){const n=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=n)}return new $v(t.toString(),r,null)}_diagnostic(){this._consume(ot.tokens.paren_left,"Expected '('");const t=this._consume(ot.tokens.ident,"Expected severity control name.");this._consume(ot.tokens.comma,"Expected ','");const r=this._consume(ot.tokens.ident,"Expected diagnostic rule name.");return this._consume(ot.tokens.paren_right,"Expected ')'"),new MR(t.toString(),r.toString())}_enable_directive(){const t=this._consume(ot.tokens.ident,"identity expected.");return new CR(t.toString())}_requires_directive(){const t=[this._consume(ot.tokens.ident,"identity expected.").toString()];for(;this._match(ot.tokens.comma);){const r=this._consume(ot.tokens.ident,"identity expected.");t.push(r.toString())}return new IR(t)}_type_alias(){const t=this._consume(ot.tokens.ident,"identity expected.");this._consume(ot.tokens.equal,"Expected '=' for type alias.");let r=this._type_decl();if(r===null)throw this._error(this._peek(),"Expected Type for Alias.");this._context.aliases.has(r.name)&&(r=this._context.aliases.get(r.name).type);const n=new qv(t.toString(),r);return this._context.aliases.set(n.name,n),n}_type_decl(){if(this._check([ot.tokens.ident,...ot.texel_format,ot.keywords.bool,ot.keywords.f32,ot.keywords.i32,ot.keywords.u32])){const n=this._advance(),a=n.toString();return this._context.structs.has(a)?this._context.structs.get(a):this._context.aliases.has(a)?this._context.aliases.get(a).type:new Ka(n.toString())}let t=this._texture_sampler_types();if(t)return t;if(this._check(ot.template_types)){let n=this._advance().toString(),a=null,d=null;return this._match(ot.tokens.less_than)&&(a=this._type_decl(),d=null,this._match(ot.tokens.comma)&&(d=this._consume(ot.access_mode,"Expected access_mode for pointer").toString()),this._consume(ot.tokens.greater_than,"Expected '>' for type.")),new Zv(n,a,d)}if(this._match(ot.keywords.ptr)){let n=this._previous().toString();this._consume(ot.tokens.less_than,"Expected '<' for pointer.");const a=this._consume(ot.storage_class,"Expected storage_class for pointer");this._consume(ot.tokens.comma,"Expected ',' for pointer.");const d=this._type_decl();let f=null;return this._match(ot.tokens.comma)&&(f=this._consume(ot.access_mode,"Expected access_mode for pointer").toString()),this._consume(ot.tokens.greater_than,"Expected '>' for pointer."),new DR(n,a.toString(),d,f)}const r=this._attribute();if(this._match(ot.keywords.array)){let n=null,a=-1;const d=this._previous();let f=null;if(this._match(ot.tokens.less_than)){n=this._type_decl(),this._context.aliases.has(n.name)&&(n=this._context.aliases.get(n.name).type);let T="";if(this._match(ot.tokens.comma)){f=this._shift_expression();try{T=f.evaluate(this._context).toString(),f=null}catch{T="1"}}this._consume(ot.tokens.greater_than,"Expected '>' for array."),a=T?parseInt(T):0}const c=new Yv(d.toString(),r,n,a);return f&&this._deferArrayCountEval.push({arrayType:c,countNode:f}),c}return null}_texture_sampler_types(){if(this._match(ot.sampler_type))return new nh(this._previous().toString(),null,null);if(this._match(ot.depth_texture_type))return new nh(this._previous().toString(),null,null);if(this._match(ot.sampled_texture_type)||this._match(ot.multisampled_texture_type)){const t=this._previous();this._consume(ot.tokens.less_than,"Expected '<' for sampler type.");const r=this._type_decl();return this._consume(ot.tokens.greater_than,"Expected '>' for sampler type."),new nh(t.toString(),r,null)}if(this._match(ot.storage_texture_type)){const t=this._previous();this._consume(ot.tokens.less_than,"Expected '<' for sampler type.");const r=this._consume(ot.texel_format,"Invalid texel format.").toString();this._consume(ot.tokens.comma,"Expected ',' after texel format.");const n=this._consume(ot.access_mode,"Expected access mode for storage texture type.").toString();return this._consume(ot.tokens.greater_than,"Expected '>' for sampler type."),new nh(t.toString(),r,n)}return null}_attribute(){let t=[];for(;this._match(ot.tokens.attr);){const r=this._consume(ot.attribute_name,"Expected attribute name"),n=new HR(r.toString(),null);if(this._match(ot.tokens.paren_left)){if(n.value=this._consume(ot.literal_or_ident,"Expected attribute value").toString(),this._check(ot.tokens.comma)){this._advance();do{const a=this._consume(ot.literal_or_ident,"Expected attribute value").toString();n.value instanceof Array||(n.value=[n.value]),n.value.push(a)}while(this._match(ot.tokens.comma))}this._consume(ot.tokens.paren_right,"Expected ')'")}t.push(n)}return t.length==0?null:t}}class uc{constructor(t,r){this.name=t,this.attributes=r,this.size=0}get isArray(){return!1}get isStruct(){return!1}get isTemplate(){return!1}}class sx{constructor(t,r,n){this.name=t,this.type=r,this.attributes=n,this.offset=0,this.size=0}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray?this.type.format:this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class yf extends uc{constructor(t,r){super(t,r),this.members=[],this.align=0,this.startLine=-1,this.endLine=-1,this.inUse=!1}get isStruct(){return!0}}class kg extends uc{constructor(t,r){super(t,r),this.count=0,this.stride=0}get isArray(){return!0}}class nx extends uc{constructor(t,r,n,a){super(t,n),this.format=r,this.access=a}get isTemplate(){return!0}}var Qo;(function(e){e[e.Uniform=0]="Uniform",e[e.Storage=1]="Storage",e[e.Texture=2]="Texture",e[e.Sampler=3]="Sampler",e[e.StorageTexture=4]="StorageTexture"})(Qo||(Qo={}));class bf{constructor(t,r,n,a,d,f,c){this.name=t,this.type=r,this.group=n,this.binding=a,this.attributes=d,this.resourceType=f,this.access=c}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get size(){return this.type.size}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray?this.type.format:this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class WR{constructor(t,r){this.name=t,this.type=r}}class vf{constructor(t,r){this.align=t,this.size=r}}class XR{constructor(t,r,n,a){this.name=t,this.type=r,this.locationType=n,this.location=a,this.interpolation=null}}class ox{constructor(t,r,n,a){this.name=t,this.type=r,this.locationType=n,this.location=a}}class qR{constructor(t,r,n,a){this.name=t,this.type=r,this.attributes=n,this.id=a}}class ZR{constructor(t,r){this.name=t,this.type=r}}class YR{constructor(t,r=null){this.stage=null,this.inputs=[],this.outputs=[],this.arguments=[],this.returnType=null,this.resources=[],this.overrides=[],this.startLine=-1,this.endLine=-1,this.inUse=!1,this.calls=new Set,this.name=t,this.stage=r}}class KR{constructor(){this.vertex=[],this.fragment=[],this.compute=[]}}class JR{constructor(t){this.resources=null,this.inUse=!1,this.info=null,this.node=t}}class Ao{constructor(t){this.uniforms=[],this.storage=[],this.textures=[],this.samplers=[],this.aliases=[],this.overrides=[],this.structs=[],this.entry=new KR,this.functions=[],this._types=new Map,this._functions=new Map,t&&this.update(t)}_isStorageTexture(t){return t.name=="texture_storage_1d"||t.name=="texture_storage_2d"||t.name=="texture_storage_2d_array"||t.name=="texture_storage_3d"}update(t){const n=new $R().parse(t);for(const a of n)a instanceof Dg&&this._functions.set(a.name,new JR(a));for(const a of n)if(a instanceof Ja){const d=this._getTypeInfo(a,null);d instanceof yf&&this.structs.push(d)}for(const a of n){if(a instanceof qv){this.aliases.push(this._getAliasInfo(a));continue}if(a instanceof $v){const d=a,f=this._getAttributeNum(d.attributes,"id",0),c=d.type!=null?this._getTypeInfo(d.type,d.attributes):null;this.overrides.push(new qR(d.name,c,d.attributes,f));continue}if(this._isUniformVar(a)){const d=a,f=this._getAttributeNum(d.attributes,"group",0),c=this._getAttributeNum(d.attributes,"binding",0),T=this._getTypeInfo(d.type,d.attributes),C=new bf(d.name,T,f,c,d.attributes,Qo.Uniform,d.access);this.uniforms.push(C);continue}if(this._isStorageVar(a)){const d=a,f=this._getAttributeNum(d.attributes,"group",0),c=this._getAttributeNum(d.attributes,"binding",0),T=this._getTypeInfo(d.type,d.attributes),C=this._isStorageTexture(T),R=new bf(d.name,T,f,c,d.attributes,C?Qo.StorageTexture:Qo.Storage,d.access);this.storage.push(R);continue}if(this._isTextureVar(a)){const d=a,f=this._getAttributeNum(d.attributes,"group",0),c=this._getAttributeNum(d.attributes,"binding",0),T=this._getTypeInfo(d.type,d.attributes),C=this._isStorageTexture(T),R=new bf(d.name,T,f,c,d.attributes,C?Qo.StorageTexture:Qo.Texture,d.access);C?this.storage.push(R):this.textures.push(R);continue}if(this._isSamplerVar(a)){const d=a,f=this._getAttributeNum(d.attributes,"group",0),c=this._getAttributeNum(d.attributes,"binding",0),T=this._getTypeInfo(d.type,d.attributes),C=new bf(d.name,T,f,c,d.attributes,Qo.Sampler,d.access);this.samplers.push(C);continue}if(a instanceof Dg){const d=this._getAttribute(a,"vertex"),f=this._getAttribute(a,"fragment"),c=this._getAttribute(a,"compute"),T=d||f||c,C=new YR(a.name,T?.name);C.startLine=a.startLine,C.endLine=a.endLine,this.functions.push(C),this._functions.get(a.name).info=C,T?(this._functions.get(a.name).inUse=!0,C.inUse=!0,C.resources=this._findResources(a,!!T),C.inputs=this._getInputs(a.args),C.outputs=this._getOutputs(a.returnType),this.entry[T.name].push(C)):(C.arguments=a.args.map(R=>new ZR(R.name,this._getTypeInfo(R.type,R.attributes))),C.returnType=a.returnType?this._getTypeInfo(a.returnType,a.attributes):null);continue}}for(const a of this._functions.values())a.info&&(a.info.inUse=a.inUse,this._addCalls(a.node,a.info.calls));for(const a of this._functions.values())a.node.search(d=>{var f;if(d.astNodeType==="varExpr"){const c=d;for(const T of this.overrides)c.name==T.name&&((f=a.info)===null||f===void 0||f.overrides.push(T))}});for(const a of this.uniforms)this._markStructsInUse(a.type);for(const a of this.storage)this._markStructsInUse(a.type)}_markStructsInUse(t){if(t)if(t.isStruct){if(t.inUse=!0,t.members)for(const r of t.members)this._markStructsInUse(r.type)}else if(t.isArray)this._markStructsInUse(t.format);else if(t.isTemplate)t.format&&this._markStructsInUse(t.format);else{const r=this._getAlias(t.name);r&&this._markStructsInUse(r)}}_addCalls(t,r){var n;for(const a of t.calls){const d=(n=this._functions.get(a.name))===null||n===void 0?void 0:n.info;d&&r.add(d)}}findResource(t,r){for(const n of this.uniforms)if(n.group==t&&n.binding==r)return n;for(const n of this.storage)if(n.group==t&&n.binding==r)return n;for(const n of this.textures)if(n.group==t&&n.binding==r)return n;for(const n of this.samplers)if(n.group==t&&n.binding==r)return n;return null}_findResource(t){for(const r of this.uniforms)if(r.name==t)return r;for(const r of this.storage)if(r.name==t)return r;for(const r of this.textures)if(r.name==t)return r;for(const r of this.samplers)if(r.name==t)return r;return null}_markStructsFromAST(t){const r=this._getTypeInfo(t,null);this._markStructsInUse(r)}_findResources(t,r){const n=[],a=this,d=[];return t.search(f=>{if(f instanceof gf)d.push({});else if(f instanceof mf)d.pop();else if(f instanceof Ya){const c=f;r&&c.type!==null&&this._markStructsFromAST(c.type),d.length>0&&(d[d.length-1][c.name]=c)}else if(f instanceof cc){const c=f;r&&c.type!==null&&this._markStructsFromAST(c.type)}else if(f instanceof Fg){const c=f;r&&c.type!==null&&this._markStructsFromAST(c.type),d.length>0&&(d[d.length-1][c.name]=c)}else if(f instanceof Og){const c=f;if(d.length>0&&d[d.length-1][c.name])return;const T=a._findResource(c.name);T&&n.push(T)}else if(f instanceof Kv){const c=f,T=a._functions.get(c.name);T&&(r&&(T.inUse=!0),t.calls.add(T.node),T.resources===null&&(T.resources=a._findResources(T.node,r)),n.push(...T.resources))}else if(f instanceof Xv){const c=f,T=a._functions.get(c.name);T&&(r&&(T.inUse=!0),t.calls.add(T.node),T.resources===null&&(T.resources=a._findResources(T.node,r)),n.push(...T.resources))}}),[...new Map(n.map(f=>[f.name,f])).values()]}getBindGroups(){const t=[];function r(n,a){n>=t.length&&(t.length=n+1),t[n]===void 0&&(t[n]=[]),a>=t[n].length&&(t[n].length=a+1)}for(const n of this.uniforms){r(n.group,n.binding);const a=t[n.group];a[n.binding]=n}for(const n of this.storage){r(n.group,n.binding);const a=t[n.group];a[n.binding]=n}for(const n of this.textures){r(n.group,n.binding);const a=t[n.group];a[n.binding]=n}for(const n of this.samplers){r(n.group,n.binding);const a=t[n.group];a[n.binding]=n}return t}_getOutputs(t,r=void 0){if(r===void 0&&(r=[]),t instanceof Ja)this._getStructOutputs(t,r);else{const n=this._getOutputInfo(t);n!==null&&r.push(n)}return r}_getStructOutputs(t,r){for(const n of t.members)if(n.type instanceof Ja)this._getStructOutputs(n.type,r);else{const a=this._getAttribute(n,"location")||this._getAttribute(n,"builtin");if(a!==null){const d=this._getTypeInfo(n.type,n.type.attributes),f=this._parseInt(a.value),c=new ox(n.name,d,a.name,f);r.push(c)}}}_getOutputInfo(t){const r=this._getAttribute(t,"location")||this._getAttribute(t,"builtin");if(r!==null){const n=this._getTypeInfo(t,t.attributes),a=this._parseInt(r.value);return new ox("",n,r.name,a)}return null}_getInputs(t,r=void 0){r===void 0&&(r=[]);for(const n of t)if(n.type instanceof Ja)this._getStructInputs(n.type,r);else{const a=this._getInputInfo(n);a!==null&&r.push(a)}return r}_getStructInputs(t,r){for(const n of t.members)if(n.type instanceof Ja)this._getStructInputs(n.type,r);else{const a=this._getInputInfo(n);a!==null&&r.push(a)}}_getInputInfo(t){const r=this._getAttribute(t,"location")||this._getAttribute(t,"builtin");if(r!==null){const n=this._getAttribute(t,"interpolation"),a=this._getTypeInfo(t.type,t.attributes),d=this._parseInt(r.value),f=new XR(t.name,a,r.name,d);return n!==null&&(f.interpolation=this._parseString(n.value)),f}return null}_parseString(t){return t instanceof Array&&(t=t[0]),t}_parseInt(t){t instanceof Array&&(t=t[0]);const r=parseInt(t);return isNaN(r)?t:r}_getAlias(t){for(const r of this.aliases)if(r.name==t)return r.type;return null}_getAliasInfo(t){return new WR(t.name,this._getTypeInfo(t.type,null))}_getTypeInfo(t,r){if(this._types.has(t))return this._types.get(t);if(t instanceof Yv){const a=t,d=a.format?this._getTypeInfo(a.format,a.attributes):null,f=new kg(a.name,r);return f.format=d,f.count=a.count,this._types.set(t,f),this._updateTypeInfo(f),f}if(t instanceof Ja){const a=t,d=new yf(a.name,r);d.startLine=a.startLine,d.endLine=a.endLine;for(const f of a.members){const c=this._getTypeInfo(f.type,f.attributes);d.members.push(new sx(f.name,c,f.attributes))}return this._types.set(t,d),this._updateTypeInfo(d),d}if(t instanceof nh){const a=t,d=a.format instanceof Ka,f=a.format?d?this._getTypeInfo(a.format,null):new uc(a.format,null):null,c=new nx(a.name,f,r,a.access);return this._types.set(t,c),this._updateTypeInfo(c),c}if(t instanceof Zv){const a=t,d=a.format?this._getTypeInfo(a.format,null):null,f=new nx(a.name,d,r,a.access);return this._types.set(t,f),this._updateTypeInfo(f),f}const n=new uc(t.name,r);return this._types.set(t,n),this._updateTypeInfo(n),n}_updateTypeInfo(t){var r,n;const a=this._getTypeSize(t);if(t.size=(r=a?.size)!==null&&r!==void 0?r:0,t instanceof kg&&t.format){const d=this._getTypeSize(t.format);t.stride=(n=d?.size)!==null&&n!==void 0?n:0,this._updateTypeInfo(t.format)}t instanceof yf&&this._updateStructInfo(t)}_updateStructInfo(t){var r;let n=0,a=0,d=0,f=0;for(let c=0,T=t.members.length;c<T;++c){const C=t.members[c],R=this._getTypeSize(C);if(!R)continue;(r=this._getAlias(C.type.name))!==null&&r!==void 0||C.type;const L=R.align,V=R.size;n=this._roundUp(L,n+a),a=V,d=n,f=Math.max(f,L),C.offset=n,C.size=V,this._updateTypeInfo(C.type)}t.size=this._roundUp(f,d+a),t.align=f}_getTypeSize(t){var r,n;if(t==null)return null;const a=this._getAttributeNum(t.attributes,"size",0),d=this._getAttributeNum(t.attributes,"align",0);if(t instanceof sx&&(t=t.type),t instanceof uc){const f=this._getAlias(t.name);f!==null&&(t=f)}{const f=Ao._typeInfo[t.name];if(f!==void 0){const c=((r=t.format)===null||r===void 0?void 0:r.name)==="f16"?2:1;return new vf(Math.max(d,f.align/c),Math.max(a,f.size/c))}}{const f=Ao._typeInfo[t.name.substring(0,t.name.length-1)];if(f){const c=t.name[t.name.length-1]==="h"?2:1;return new vf(Math.max(d,f.align/c),Math.max(a,f.size/c))}}if(t instanceof kg){let f=t,c=8,T=8;const C=this._getTypeSize(f.format);C!==null&&(T=C.size,c=C.align);const R=f.count,L=this._getAttributeNum((n=t?.attributes)!==null&&n!==void 0?n:null,"stride",this._roundUp(c,T));return T=R*L,a&&(T=a),new vf(Math.max(d,c),Math.max(a,T))}if(t instanceof yf){let f=0,c=0,T=0,C=0,R=0;for(const L of t.members){const V=this._getTypeSize(L.type);V!==null&&(f=Math.max(V.align,f),T=this._roundUp(V.align,T+C),C=V.size,R=T)}return c=this._roundUp(f,R+C),new vf(Math.max(d,f),Math.max(a,c))}return null}_isUniformVar(t){return t instanceof Ya&&t.storage=="uniform"}_isStorageVar(t){return t instanceof Ya&&t.storage=="storage"}_isTextureVar(t){return t instanceof Ya&&t.type!==null&&Ao._textureTypes.indexOf(t.type.name)!=-1}_isSamplerVar(t){return t instanceof Ya&&t.type!==null&&Ao._samplerTypes.indexOf(t.type.name)!=-1}_getAttribute(t,r){const n=t;if(!n||!n.attributes)return null;const a=n.attributes;for(let d of a)if(d.name==r)return d;return null}_getAttributeNum(t,r,n){if(t===null)return n;for(let a of t)if(a.name==r){let d=a!==null&&a.value!==null?a.value:n;return d instanceof Array&&(d=d[0]),typeof d=="number"?d:typeof d=="string"?parseInt(d):n}return n}_roundUp(t,r){return Math.ceil(r/t)*t}}Ao._typeInfo={f16:{align:2,size:2},i32:{align:4,size:4},u32:{align:4,size:4},f32:{align:4,size:4},atomic:{align:4,size:4},vec2:{align:8,size:8},vec3:{align:16,size:12},vec4:{align:16,size:16},mat2x2:{align:8,size:16},mat3x2:{align:8,size:24},mat4x2:{align:8,size:32},mat2x3:{align:16,size:32},mat3x3:{align:16,size:48},mat4x3:{align:16,size:64},mat2x4:{align:16,size:32},mat3x4:{align:16,size:48},mat4x4:{align:16,size:64}},Ao._textureTypes=ot.any_texture_type.map(e=>e.name),Ao._samplerTypes=ot.sampler_type.map(e=>e.name);function QR(e){const t={attributes:[],bindings:[]};let r;try{r=tP(e)}catch(d){return te.error(d.message)(),t}for(const d of r.uniforms){const f=[];for(const c of d.type?.members||[])f.push({name:c.name,type:ax(c.type)});t.bindings.push({type:"uniform",name:d.name,location:d.binding,group:d.group,members:f})}const n=r.entry.vertex[0],a=n?.inputs.length||0;for(let d=0;d<a;d++){const f=n.inputs[d];if(f.locationType==="location"){const c=ax(f.type);t.attributes.push({name:f.name,location:Number(f.location),type:c})}}return t}function ax(e){return e.format?`${e.name}<${e.format.name}>`:e.name}function tP(e){try{return new Ao(e)}catch(t){if(t instanceof Error)throw t;let r="WGSL parse error";throw typeof t=="object"&&t?.message&&(r+=`: ${t.message} `),typeof t=="object"&&t?.token&&(r+=t.token.line||""),new Error(r,{cause:t})}}const eP={name:"fp32",vs:`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;
const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;
const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;
const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01;
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03;
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04;
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06;
float sin_taylor_fp32(float a) {
float r, s, t, x;
if (a == 0.0) {
return 0.0;
}
x = -a * a;
s = a;
r = a;
r = r * x;
t = r * INVERSE_FACTORIAL_3;
s = s + t;
r = r * x;
t = r * INVERSE_FACTORIAL_5;
s = s + t;
r = r * x;
t = r * INVERSE_FACTORIAL_7;
s = s + t;
r = r * x;
t = r * INVERSE_FACTORIAL_9;
s = s + t;
return s;
}
void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
if (a == 0.0) {
sin_t = 0.0;
cos_t = 1.0;
}
sin_t = sin_taylor_fp32(a);
cos_t = sqrt(1.0 - sin_t * sin_t);
}
float tan_taylor_fp32(float a) {
float sin_a;
float cos_a;
if (a == 0.0) {
return 0.0;
}
float z = floor(a / TWO_PI);
float r = a - TWO_PI * z;
float t;
float q = floor(r / PI_2 + 0.5);
int j = int(q);
if (j < -2 || j > 2) {
return 1.0 / 0.0;
}
t = r - PI_2 * q;
q = floor(t / PI_16 + 0.5);
int k = int(q);
int abs_k = int(abs(float(k)));
if (abs_k > 4) {
return 1.0 / 0.0;
} else {
t = t - PI_16 * q;
}
float u = 0.0;
float v = 0.0;
float sin_t, cos_t;
float s, c;
sincos_taylor_fp32(t, sin_t, cos_t);
if (k == 0) {
s = sin_t;
c = cos_t;
} else {
if (abs(float(abs_k) - 1.0) < 0.5) {
u = COS_TABLE_0;
v = SIN_TABLE_0;
} else if (abs(float(abs_k) - 2.0) < 0.5) {
u = COS_TABLE_1;
v = SIN_TABLE_1;
} else if (abs(float(abs_k) - 3.0) < 0.5) {
u = COS_TABLE_2;
v = SIN_TABLE_2;
} else if (abs(float(abs_k) - 4.0) < 0.5) {
u = COS_TABLE_3;
v = SIN_TABLE_3;
}
if (k > 0) {
s = u * sin_t + v * cos_t;
c = u * cos_t - v * sin_t;
} else {
s = u * sin_t - v * cos_t;
c = u * cos_t + v * sin_t;
}
}
if (j == 0) {
sin_a = s;
cos_a = c;
} else if (j == 1) {
sin_a = c;
cos_a = -s;
} else if (j == -1) {
sin_a = -c;
cos_a = s;
} else {
sin_a = -s;
cos_a = -c;
}
return sin_a / cos_a;
}
#endif
float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
return tan_taylor_fp32(a);
#else
return tan(a);
#endif
}
`},lx={name:"picking",vs:`uniform pickingUniforms {
float isActive;
float isAttribute;
float isHighlightActive;
float useFloatColors;
vec3 highlightedObjectColor;
vec4 highlightColor;
} picking;
out vec4 picking_vRGBcolor_Avalid;
vec3 picking_normalizeColor(vec3 color) {
return picking.useFloatColors > 0.5 ? color : color / 255.0;
}
vec4 picking_normalizeColor(vec4 color) {
return picking.useFloatColors > 0.5 ? color : color / 255.0;
}
bool picking_isColorZero(vec3 color) {
return dot(color, vec3(1.0)) < 0.00001;
}
bool picking_isColorValid(vec3 color) {
return dot(color, vec3(1.0)) > 0.00001;
}
bool isVertexHighlighted(vec3 vertexColor) {
vec3 highlightedObjectColor = picking_normalizeColor(picking.highlightedObjectColor);
return
bool(picking.isHighlightActive) && picking_isColorZero(abs(vertexColor - highlightedObjectColor));
}
void picking_setPickingColor(vec3 pickingColor) {
pickingColor = picking_normalizeColor(pickingColor);
if (bool(picking.isActive)) {
picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));
if (!bool(picking.isAttribute)) {
picking_vRGBcolor_Avalid.rgb = pickingColor;
}
} else {
picking_vRGBcolor_Avalid.a = float(isVertexHighlighted(pickingColor));
}
}
void picking_setPickingAttribute(float value) {
if (bool(picking.isAttribute)) {
picking_vRGBcolor_Avalid.r = value;
}
}
void picking_setPickingAttribute(vec2 value) {
if (bool(picking.isAttribute)) {
picking_vRGBcolor_Avalid.rg = value;
}
}
void picking_setPickingAttribute(vec3 value) {
if (bool(picking.isAttribute)) {
picking_vRGBcolor_Avalid.rgb = value;
}
}
`,fs:`uniform pickingUniforms {
float isActive;
float isAttribute;
float isHighlightActive;
float useFloatColors;
vec3 highlightedObjectColor;
vec4 highlightColor;
} picking;
in vec4 picking_vRGBcolor_Avalid;
vec4 picking_filterHighlightColor(vec4 color) {
if (picking.isActive > 0.5) {
return color;
}
bool selected = bool(picking_vRGBcolor_Avalid.a);
if (selected) {
float highLightAlpha = picking.highlightColor.a;
float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
float highLightRatio = highLightAlpha / blendedAlpha;
vec3 blendedRGB = mix(color.rgb, picking.highlightColor.rgb, highLightRatio);
return vec4(blendedRGB, blendedAlpha);
} else {
return color;
}
}
vec4 picking_filterPickingColor(vec4 color) {
if (bool(picking.isActive)) {
if (picking_vRGBcolor_Avalid.a == 0.0) {
discard;
}
return picking_vRGBcolor_Avalid;
}
return color;
}
vec4 picking_filterColor(vec4 color) {
vec4 highlightColor = picking_filterHighlightColor(color);
return picking_filterPickingColor(highlightColor);
}
`,uniformTypes:{isActive:"f32",isAttribute:"f32",isHighlightActive:"f32",useFloatColors:"f32",highlightedObjectColor:"vec3<f32>",highlightColor:"vec4<f32>"},defaultUniforms:{isActive:!1,isAttribute:!1,isHighlightActive:!1,useFloatColors:!0,highlightedObjectColor:[0,0,0],highlightColor:[0,1,1,1]},getUniforms:rP};function rP(e={},t){const r={};if(e.highlightedObjectColor!==void 0)if(e.highlightedObjectColor===null)r.isHighlightActive=!1;else{r.isHighlightActive=!0;const n=e.highlightedObjectColor.slice(0,3);r.highlightedObjectColor=n}if(e.highlightColor){const n=Array.from(e.highlightColor,a=>a/255);Number.isFinite(n[3])||(n[3]=1),r.highlightColor=n}return e.isActive!==void 0&&(r.isActive=!!e.isActive,r.isAttribute=!!e.isAttribute),e.useFloatColors!==void 0&&(r.useFloatColors=!!e.useFloatColors),r}function cx(e,t=[],r=0){const n=Math.fround(e),a=e-n;return t[r]=n,t[r+1]=a,t}function iP(e){return e-Math.fround(e)}function sP(e){const t=new Float32Array(32);for(let r=0;r<4;++r)for(let n=0;n<4;++n){const a=r*4+n;cx(e[n*4+r],t,a*2)}return t}const nP=`uniform float ONE;
vec2 split(float a) {
const float SPLIT = 4097.0;
float t = a * SPLIT;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
float a_hi = t * ONE - (t - a);
float a_lo = a * ONE - a_hi;
#else
float a_hi = t - (t - a);
float a_lo = a - a_hi;
#endif
return vec2(a_hi, a_lo);
}
vec2 split2(vec2 a) {
vec2 b = split(a.x);
b.y += a.y;
return b;
}
vec2 quickTwoSum(float a, float b) {
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
float sum = (a + b) * ONE;
float err = b - (sum - a) * ONE;
#else
float sum = a + b;
float err = b - (sum - a);
#endif
return vec2(sum, err);
}
vec2 twoSum(float a, float b) {
float s = (a + b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
float v = (s * ONE - a) * ONE;
float err = (a - (s - v) * ONE) * ONE * ONE * ONE + (b - v);
#else
float v = s - a;
float err = (a - (s - v)) + (b - v);
#endif
return vec2(s, err);
}
vec2 twoSub(float a, float b) {
float s = (a - b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
float v = (s * ONE - a) * ONE;
float err = (a - (s - v) * ONE) * ONE * ONE * ONE - (b + v);
#else
float v = s - a;
float err = (a - (s - v)) - (b + v);
#endif
return vec2(s, err);
}
vec2 twoSqr(float a) {
float prod = a * a;
vec2 a_fp64 = split(a);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
float err = ((a_fp64.x * a_fp64.x - prod) * ONE + 2.0 * a_fp64.x *
a_fp64.y * ONE * ONE) + a_fp64.y * a_fp64.y * ONE * ONE * ONE;
#else
float err = ((a_fp64.x * a_fp64.x - prod) + 2.0 * a_fp64.x * a_fp64.y) + a_fp64.y * a_fp64.y;
#endif
return vec2(prod, err);
}
vec2 twoProd(float a, float b) {
float prod = a * b;
vec2 a_fp64 = split(a);
vec2 b_fp64 = split(b);
float err = ((a_fp64.x * b_fp64.x - prod) + a_fp64.x * b_fp64.y +
a_fp64.y * b_fp64.x) + a_fp64.y * b_fp64.y;
return vec2(prod, err);
}
vec2 sum_fp64(vec2 a, vec2 b) {
vec2 s, t;
s = twoSum(a.x, b.x);
t = twoSum(a.y, b.y);
s.y += t.x;
s = quickTwoSum(s.x, s.y);
s.y += t.y;
s = quickTwoSum(s.x, s.y);
return s;
}
vec2 sub_fp64(vec2 a, vec2 b) {
vec2 s, t;
s = twoSub(a.x, b.x);
t = twoSub(a.y, b.y);
s.y += t.x;
s = quickTwoSum(s.x, s.y);
s.y += t.y;
s = quickTwoSum(s.x, s.y);
return s;
}
vec2 mul_fp64(vec2 a, vec2 b) {
vec2 prod = twoProd(a.x, b.x);
prod.y += a.x * b.y;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
prod = split2(prod);
#endif
prod = quickTwoSum(prod.x, prod.y);
prod.y += a.y * b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
prod = split2(prod);
#endif
prod = quickTwoSum(prod.x, prod.y);
return prod;
}
vec2 div_fp64(vec2 a, vec2 b) {
float xn = 1.0 / b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
vec2 yn = mul_fp64(a, vec2(xn, 0));
#else
vec2 yn = a * xn;
#endif
float diff = (sub_fp64(a, mul_fp64(b, yn))).x;
vec2 prod = twoProd(xn, diff);
return sum_fp64(yn, prod);
}
vec2 sqrt_fp64(vec2 a) {
if (a.x == 0.0 && a.y == 0.0) return vec2(0.0, 0.0);
if (a.x < 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);
float x = 1.0 / sqrt(a.x);
float yn = a.x * x;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
vec2 yn_sqr = twoSqr(yn) * ONE;
#else
vec2 yn_sqr = twoSqr(yn);
#endif
float diff = sub_fp64(a, yn_sqr).x;
vec2 prod = twoProd(x * 0.5, diff);
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
return sum_fp64(split(yn), prod);
#else
return sum_fp64(vec2(yn, 0.0), prod);
#endif
}
`,oP={ONE:1};function aP(){return oP}const lP={name:"fp64-arithmetic",vs:nP,getUniforms:aP,fp64ify:cx,fp64LowPart:iP,fp64ifyMatrix4:sP},cP=1/Math.PI*180,uP=1/180*Math.PI,hP={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1};globalThis.mathgl=globalThis.mathgl||{config:{...hP}};const yi=globalThis.mathgl.config;function dP(e,{precision:t=yi.precision}={}){return e=gP(e),`${parseFloat(e.toPrecision(t))}`}function ta(e){return Array.isArray(e)||ArrayBuffer.isView(e)&&!(e instanceof DataView)}function fP(e){return _P(e)}function pP(e){return xn(e)}function _P(e,t){return Ng(e,r=>r*uP,t)}function xn(e,t){return Ng(e,r=>r*cP,t)}function Eo(e,t,r){return Ng(e,n=>Math.max(t,Math.min(r,n)))}function xf(e,t,r){return ta(e)?e.map((n,a)=>xf(n,t[a],r)):r*t+(1-r)*e}function wn(e,t,r){const n=yi.EPSILON;r&&(yi.EPSILON=r);try{if(e===t)return!0;if(ta(e)&&ta(t)){if(e.length!==t.length)return!1;for(let a=0;a<e.length;++a)if(!wn(e[a],t[a]))return!1;return!0}return e&&e.equals?e.equals(t):t&&t.equals?t.equals(e):typeof e=="number"&&typeof t=="number"?Math.abs(e-t)<=yi.EPSILON*Math.max(1,Math.abs(e),Math.abs(t)):!1}finally{yi.EPSILON=n}}function gP(e){return Math.round(e/yi.EPSILON)*yi.EPSILON}function mP(e){return e.clone?e.clone():new Array(e.length)}function Ng(e,t,r){if(ta(e)){const n=e;r=r||mP(n);for(let a=0;a<r.length&&a<n.length;++a){const d=typeof e=="number"?e:e[a];r[a]=t(d,a,r)}return r}return t(e)}class Lg extends Array{clone(){return new this.constructor().copy(this)}fromArray(t,r=0){for(let n=0;n<this.ELEMENTS;++n)this[n]=t[n+r];return this.check()}toArray(t=[],r=0){for(let n=0;n<this.ELEMENTS;++n)t[r+n]=this[n];return t}toObject(t){return t}from(t){return Array.isArray(t)?this.copy(t):this.fromObject(t)}to(t){return t===this?this:ta(t)?this.toArray(t):this.toObject(t)}toTarget(t){return t?this.to(t):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(yi)}formatString(t){let r="";for(let n=0;n<this.ELEMENTS;++n)r+=(n>0?", ":"")+dP(this[n],t);return`${t.printTypes?this.constructor.name:""}[${r}]`}equals(t){if(!t||this.length!==t.length)return!1;for(let r=0;r<this.ELEMENTS;++r)if(!wn(this[r],t[r]))return!1;return!0}exactEquals(t){if(!t||this.length!==t.length)return!1;for(let r=0;r<this.ELEMENTS;++r)if(this[r]!==t[r])return!1;return!0}negate(){for(let t=0;t<this.ELEMENTS;++t)this[t]=-this[t];return this.check()}lerp(t,r,n){if(n===void 0)return this.lerp(this,t,r);for(let a=0;a<this.ELEMENTS;++a){const d=t[a],f=typeof r=="number"?r:r[a];this[a]=d+n*(f-d)}return this.check()}min(t){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(t[r],this[r]);return this.check()}max(t){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.max(t[r],this[r]);return this.check()}clamp(t,r){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],t[n]),r[n]);return this.check()}add(...t){for(const r of t)for(let n=0;n<this.ELEMENTS;++n)this[n]+=r[n];return this.check()}subtract(...t){for(const r of t)for(let n=0;n<this.ELEMENTS;++n)this[n]-=r[n];return this.check()}scale(t){if(typeof t=="number")for(let r=0;r<this.ELEMENTS;++r)this[r]*=t;else for(let r=0;r<this.ELEMENTS&&r<t.length;++r)this[r]*=t[r];return this.check()}multiplyByScalar(t){for(let r=0;r<this.ELEMENTS;++r)this[r]*=t;return this.check()}check(){if(yi.debug&&!this.validate())throw new Error(`math.gl: ${this.constructor.name} some fields set to invalid numbers'`);return this}validate(){let t=this.length===this.ELEMENTS;for(let r=0;r<this.ELEMENTS;++r)t=t&&Number.isFinite(this[r]);return t}sub(t){return this.subtract(t)}setScalar(t){for(let r=0;r<this.ELEMENTS;++r)this[r]=t;return this.check()}addScalar(t){for(let r=0;r<this.ELEMENTS;++r)this[r]+=t;return this.check()}subScalar(t){return this.addScalar(-t)}multiplyScalar(t){for(let r=0;r<this.ELEMENTS;++r)this[r]*=t;return this.check()}divideScalar(t){return this.multiplyByScalar(1/t)}clampScalar(t,r){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],t),r);return this.check()}get elements(){return this}}function yP(e,t){if(e.length!==t)return!1;for(let r=0;r<e.length;++r)if(!Number.isFinite(e[r]))return!1;return!0}function er(e){if(!Number.isFinite(e))throw new Error(`Invalid number ${JSON.stringify(e)}`);return e}function oh(e,t,r=""){if(yi.debug&&!yP(e,t))throw new Error(`math.gl: ${r} some fields set to invalid numbers'`);return e}function Tn(e,t){if(!e)throw new Error(`math.gl assertion ${t}`)}class Ug extends Lg{get x(){return this[0]}set x(t){this[0]=er(t)}get y(){return this[1]}set y(t){this[1]=er(t)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let t=0;for(let r=0;r<this.ELEMENTS;++r)t+=this[r]*this[r];return t}magnitudeSquared(){return this.lengthSquared()}distance(t){return Math.sqrt(this.distanceSquared(t))}distanceSquared(t){let r=0;for(let n=0;n<this.ELEMENTS;++n){const a=this[n]-t[n];r+=a*a}return er(r)}dot(t){let r=0;for(let n=0;n<this.ELEMENTS;++n)r+=this[n]*t[n];return er(r)}normalize(){const t=this.magnitude();if(t!==0)for(let r=0;r<this.ELEMENTS;++r)this[r]/=t;return this.check()}multiply(...t){for(const r of t)for(let n=0;n<this.ELEMENTS;++n)this[n]*=r[n];return this.check()}divide(...t){for(const r of t)for(let n=0;n<this.ELEMENTS;++n)this[n]/=r[n];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(t){return this.distance(t)}distanceToSquared(t){return this.distanceSquared(t)}getComponent(t){return Tn(t>=0&&t<this.ELEMENTS,"index is out of range"),er(this[t])}setComponent(t,r){return Tn(t>=0&&t<this.ELEMENTS,"index is out of range"),this[t]=r,this.check()}addVectors(t,r){return this.copy(t).add(r)}subVectors(t,r){return this.copy(t).subtract(r)}multiplyVectors(t,r){return this.copy(t).multiply(r)}addScaledVector(t,r){return this.add(new this.constructor(t).multiplyScalar(r))}}const ah=1e-6;let An=typeof Float32Array<"u"?Float32Array:Array;function bP(){const e=new An(2);return An!=Float32Array&&(e[0]=0,e[1]=0),e}function ux(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e}function vP(e,t){return e[0]=-t[0],e[1]=-t[1],e}function hx(e,t,r,n){const a=t[0],d=t[1];return e[0]=a+n*(r[0]-a),e[1]=d+n*(r[1]-d),e}function xP(e,t,r){const n=t[0],a=t[1];return e[0]=r[0]*n+r[2]*a,e[1]=r[1]*n+r[3]*a,e}function wP(e,t,r){const n=t[0],a=t[1];return e[0]=r[0]*n+r[2]*a+r[4],e[1]=r[1]*n+r[3]*a+r[5],e}function dx(e,t,r){const n=t[0],a=t[1];return e[0]=r[0]*n+r[3]*a+r[6],e[1]=r[1]*n+r[4]*a+r[7],e}function fx(e,t,r){const n=t[0],a=t[1];return e[0]=r[0]*n+r[4]*a+r[12],e[1]=r[1]*n+r[5]*a+r[13],e}(function(){const e=bP();return function(t,r,n,a,d,f){let c,T;for(r||(r=2),n||(n=0),a?T=Math.min(a*r+n,t.length):T=t.length,c=n;c<T;c+=r)e[0]=t[c],e[1]=t[c+1],d(e,e,f),t[c]=e[0],t[c+1]=e[1];return t}})();function px(e,t,r){const n=t[0],a=t[1],d=r[3]*n+r[7]*a||1;return e[0]=(r[0]*n+r[4]*a)/d,e[1]=(r[1]*n+r[5]*a)/d,e}function _x(e,t,r){const n=t[0],a=t[1],d=t[2],f=r[3]*n+r[7]*a+r[11]*d||1;return e[0]=(r[0]*n+r[4]*a+r[8]*d)/f,e[1]=(r[1]*n+r[5]*a+r[9]*d)/f,e[2]=(r[2]*n+r[6]*a+r[10]*d)/f,e}function TP(e,t,r){const n=t[0],a=t[1];return e[0]=r[0]*n+r[2]*a,e[1]=r[1]*n+r[3]*a,e[2]=t[2],e}function AP(e,t,r){const n=t[0],a=t[1];return e[0]=r[0]*n+r[2]*a,e[1]=r[1]*n+r[3]*a,e[2]=t[2],e[3]=t[3],e}function gx(e,t,r){const n=t[0],a=t[1],d=t[2];return e[0]=r[0]*n+r[3]*a+r[6]*d,e[1]=r[1]*n+r[4]*a+r[7]*d,e[2]=r[2]*n+r[5]*a+r[8]*d,e[3]=t[3],e}class zg extends Ug{constructor(t=0,r=0){super(2),ta(t)&&arguments.length===1?this.copy(t):(yi.debug&&(er(t),er(r)),this[0]=t,this[1]=r)}set(t,r){return this[0]=t,this[1]=r,this.check()}copy(t){return this[0]=t[0],this[1]=t[1],this.check()}fromObject(t){return yi.debug&&(er(t.x),er(t.y)),this[0]=t.x,this[1]=t.y,this.check()}toObject(t){return t.x=this[0],t.y=this[1],t}get ELEMENTS(){return 2}horizontalAngle(){return Math.atan2(this.y,this.x)}verticalAngle(){return Math.atan2(this.x,this.y)}transform(t){return this.transformAsPoint(t)}transformAsPoint(t){return fx(this,this,t),this.check()}transformAsVector(t){return px(this,this,t),this.check()}transformByMatrix3(t){return dx(this,this,t),this.check()}transformByMatrix2x3(t){return wP(this,this,t),this.check()}transformByMatrix2(t){return xP(this,this,t),this.check()}}function mx(){const e=new An(3);return An!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function yx(e){const t=e[0],r=e[1],n=e[2];return Math.sqrt(t*t+r*r+n*n)}function bx(e,t,r){const n=new An(3);return n[0]=e,n[1]=t,n[2]=r,n}function EP(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e}function SP(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function CP(e,t){const r=t[0],n=t[1],a=t[2];let d=r*r+n*n+a*a;return d>0&&(d=1/Math.sqrt(d)),e[0]=t[0]*d,e[1]=t[1]*d,e[2]=t[2]*d,e}function Vg(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function wf(e,t,r){const n=t[0],a=t[1],d=t[2],f=r[0],c=r[1],T=r[2];return e[0]=a*T-d*c,e[1]=d*f-n*T,e[2]=n*c-a*f,e}function jg(e,t,r){const n=t[0],a=t[1],d=t[2];let f=r[3]*n+r[7]*a+r[11]*d+r[15];return f=f||1,e[0]=(r[0]*n+r[4]*a+r[8]*d+r[12])/f,e[1]=(r[1]*n+r[5]*a+r[9]*d+r[13])/f,e[2]=(r[2]*n+r[6]*a+r[10]*d+r[14])/f,e}function vx(e,t,r){const n=t[0],a=t[1],d=t[2];return e[0]=n*r[0]+a*r[3]+d*r[6],e[1]=n*r[1]+a*r[4]+d*r[7],e[2]=n*r[2]+a*r[5]+d*r[8],e}function xx(e,t,r){const n=r[0],a=r[1],d=r[2],f=r[3],c=t[0],T=t[1],C=t[2];let R=a*C-d*T,L=d*c-n*C,V=n*T-a*c,X=a*V-d*L,at=d*R-n*V,nt=n*L-a*R;const K=f*2;return R*=K,L*=K,V*=K,X*=2,at*=2,nt*=2,e[0]=c+R+X,e[1]=T+L+at,e[2]=C+V+nt,e}function IP(e,t,r,n){const a=[],d=[];return a[0]=t[0]-r[0],a[1]=t[1]-r[1],a[2]=t[2]-r[2],d[0]=a[0],d[1]=a[1]*Math.cos(n)-a[2]*Math.sin(n),d[2]=a[1]*Math.sin(n)+a[2]*Math.cos(n),e[0]=d[0]+r[0],e[1]=d[1]+r[1],e[2]=d[2]+r[2],e}function MP(e,t,r,n){const a=[],d=[];return a[0]=t[0]-r[0],a[1]=t[1]-r[1],a[2]=t[2]-r[2],d[0]=a[2]*Math.sin(n)+a[0]*Math.cos(n),d[1]=a[1],d[2]=a[2]*Math.cos(n)-a[0]*Math.sin(n),e[0]=d[0]+r[0],e[1]=d[1]+r[1],e[2]=d[2]+r[2],e}function RP(e,t,r,n){const a=[],d=[];return a[0]=t[0]-r[0],a[1]=t[1]-r[1],a[2]=t[2]-r[2],d[0]=a[0]*Math.cos(n)-a[1]*Math.sin(n),d[1]=a[0]*Math.sin(n)+a[1]*Math.cos(n),d[2]=a[2],e[0]=d[0]+r[0],e[1]=d[1]+r[1],e[2]=d[2]+r[2],e}function PP(e,t){const r=e[0],n=e[1],a=e[2],d=t[0],f=t[1],c=t[2],T=Math.sqrt((r*r+n*n+a*a)*(d*d+f*f+c*c)),C=T&&Vg(e,t)/T;return Math.acos(Math.min(Math.max(C,-1),1))}const BP=EP,DP=yx;(function(){const e=mx();return function(t,r,n,a,d,f){let c,T;for(r||(r=3),n||(n=0),a?T=Math.min(a*r+n,t.length):T=t.length,c=n;c<T;c+=r)e[0]=t[c],e[1]=t[c+1],e[2]=t[c+2],d(e,e,f),t[c]=e[0],t[c+1]=e[1],t[c+2]=e[2];return t}})();const Hg=[0,0,0];let Tf;class Bt extends Ug{static get ZERO(){return Tf||(Tf=new Bt(0,0,0),Object.freeze(Tf)),Tf}constructor(t=0,r=0,n=0){super(-0,-0,-0),arguments.length===1&&ta(t)?this.copy(t):(yi.debug&&(er(t),er(r),er(n)),this[0]=t,this[1]=r,this[2]=n)}set(t,r,n){return this[0]=t,this[1]=r,this[2]=n,this.check()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this.check()}fromObject(t){return yi.debug&&(er(t.x),er(t.y),er(t.z)),this[0]=t.x,this[1]=t.y,this[2]=t.z,this.check()}toObject(t){return t.x=this[0],t.y=this[1],t.z=this[2],t}get ELEMENTS(){return 3}get z(){return this[2]}set z(t){this[2]=er(t)}angle(t){return PP(this,t)}cross(t){return wf(this,this,t),this.check()}rotateX({radians:t,origin:r=Hg}){return IP(this,this,r,t),this.check()}rotateY({radians:t,origin:r=Hg}){return MP(this,this,r,t),this.check()}rotateZ({radians:t,origin:r=Hg}){return RP(this,this,r,t),this.check()}transform(t){return this.transformAsPoint(t)}transformAsPoint(t){return jg(this,this,t),this.check()}transformAsVector(t){return _x(this,this,t),this.check()}transformByMatrix3(t){return vx(this,this,t),this.check()}transformByMatrix2(t){return TP(this,this,t),this.check()}transformByQuaternion(t){return xx(this,this,t),this.check()}}let Af;class Gg extends Ug{static get ZERO(){return Af||(Af=new Gg(0,0,0,0),Object.freeze(Af)),Af}constructor(t=0,r=0,n=0,a=0){super(-0,-0,-0,-0),ta(t)&&arguments.length===1?this.copy(t):(yi.debug&&(er(t),er(r),er(n),er(a)),this[0]=t,this[1]=r,this[2]=n,this[3]=a)}set(t,r,n,a){return this[0]=t,this[1]=r,this[2]=n,this[3]=a,this.check()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this.check()}fromObject(t){return yi.debug&&(er(t.x),er(t.y),er(t.z),er(t.w)),this[0]=t.x,this[1]=t.y,this[2]=t.z,this[3]=t.w,this}toObject(t){return t.x=this[0],t.y=this[1],t.z=this[2],t.w=this[3],t}get ELEMENTS(){return 4}get z(){return this[2]}set z(t){this[2]=er(t)}get w(){return this[3]}set w(t){this[3]=er(t)}transform(t){return jg(this,this,t),this.check()}transformByMatrix3(t){return gx(this,this,t),this.check()}transformByMatrix2(t){return AP(this,this,t),this.check()}transformByQuaternion(t){return xx(this,this,t),this.check()}applyMatrix4(t){return t.transform(this,this),this}}class wx extends Lg{toString(){let t="[";if(yi.printRowMajor){t+="row-major:";for(let r=0;r<this.RANK;++r)for(let n=0;n<this.RANK;++n)t+=` ${this[n*this.RANK+r]}`}else{t+="column-major:";for(let r=0;r<this.ELEMENTS;++r)t+=` ${this[r]}`}return t+="]",t}getElementIndex(t,r){return r*this.RANK+t}getElement(t,r){return this[r*this.RANK+t]}setElement(t,r,n){return this[r*this.RANK+t]=er(n),this}getColumn(t,r=new Array(this.RANK).fill(-0)){const n=t*this.RANK;for(let a=0;a<this.RANK;++a)r[a]=this[n+a];return r}setColumn(t,r){const n=t*this.RANK;for(let a=0;a<this.RANK;++a)this[n+a]=r[a];return this}}function FP(){const e=new An(9);return An!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}function OP(e,t){if(e===t){const r=t[1],n=t[2],a=t[5];e[1]=t[3],e[2]=t[6],e[3]=r,e[5]=t[7],e[6]=n,e[7]=a}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e}function kP(e,t){const r=t[0],n=t[1],a=t[2],d=t[3],f=t[4],c=t[5],T=t[6],C=t[7],R=t[8],L=R*f-c*C,V=-R*d+c*T,X=C*d-f*T;let at=r*L+n*V+a*X;return at?(at=1/at,e[0]=L*at,e[1]=(-R*n+a*C)*at,e[2]=(c*n-a*f)*at,e[3]=V*at,e[4]=(R*r-a*T)*at,e[5]=(-c*r+a*d)*at,e[6]=X*at,e[7]=(-C*r+n*T)*at,e[8]=(f*r-n*d)*at,e):null}function NP(e){const t=e[0],r=e[1],n=e[2],a=e[3],d=e[4],f=e[5],c=e[6],T=e[7],C=e[8];return t*(C*d-f*T)+r*(-C*a+f*c)+n*(T*a-d*c)}function Tx(e,t,r){const n=t[0],a=t[1],d=t[2],f=t[3],c=t[4],T=t[5],C=t[6],R=t[7],L=t[8],V=r[0],X=r[1],at=r[2],nt=r[3],K=r[4],It=r[5],St=r[6],Ct=r[7],Ht=r[8];return e[0]=V*n+X*f+at*C,e[1]=V*a+X*c+at*R,e[2]=V*d+X*T+at*L,e[3]=nt*n+K*f+It*C,e[4]=nt*a+K*c+It*R,e[5]=nt*d+K*T+It*L,e[6]=St*n+Ct*f+Ht*C,e[7]=St*a+Ct*c+Ht*R,e[8]=St*d+Ct*T+Ht*L,e}function LP(e,t,r){const n=t[0],a=t[1],d=t[2],f=t[3],c=t[4],T=t[5],C=t[6],R=t[7],L=t[8],V=r[0],X=r[1];return e[0]=n,e[1]=a,e[2]=d,e[3]=f,e[4]=c,e[5]=T,e[6]=V*n+X*f+C,e[7]=V*a+X*c+R,e[8]=V*d+X*T+L,e}function UP(e,t,r){const n=t[0],a=t[1],d=t[2],f=t[3],c=t[4],T=t[5],C=t[6],R=t[7],L=t[8],V=Math.sin(r),X=Math.cos(r);return e[0]=X*n+V*f,e[1]=X*a+V*c,e[2]=X*d+V*T,e[3]=X*f-V*n,e[4]=X*c-V*a,e[5]=X*T-V*d,e[6]=C,e[7]=R,e[8]=L,e}function Ax(e,t,r){const n=r[0],a=r[1];return e[0]=n*t[0],e[1]=n*t[1],e[2]=n*t[2],e[3]=a*t[3],e[4]=a*t[4],e[5]=a*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function zP(e,t){const r=t[0],n=t[1],a=t[2],d=t[3],f=r+r,c=n+n,T=a+a,C=r*f,R=n*f,L=n*c,V=a*f,X=a*c,at=a*T,nt=d*f,K=d*c,It=d*T;return e[0]=1-L-at,e[3]=R-It,e[6]=V+K,e[1]=R+It,e[4]=1-C-at,e[7]=X-nt,e[2]=V-K,e[5]=X+nt,e[8]=1-C-L,e}var $g;(function(e){e[e.COL0ROW0=0]="COL0ROW0",e[e.COL0ROW1=1]="COL0ROW1",e[e.COL0ROW2=2]="COL0ROW2",e[e.COL1ROW0=3]="COL1ROW0",e[e.COL1ROW1=4]="COL1ROW1",e[e.COL1ROW2=5]="COL1ROW2",e[e.COL2ROW0=6]="COL2ROW0",e[e.COL2ROW1=7]="COL2ROW1",e[e.COL2ROW2=8]="COL2ROW2"})($g||($g={}));const VP=Object.freeze([1,0,0,0,1,0,0,0,1]);class Xr extends wx{static get IDENTITY(){return HP()}static get ZERO(){return jP()}get ELEMENTS(){return 9}get RANK(){return 3}get INDICES(){return $g}constructor(t,...r){super(-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(t)?this.copy(t):r.length>0?this.copy([t,...r]):this.identity()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this[4]=t[4],this[5]=t[5],this[6]=t[6],this[7]=t[7],this[8]=t[8],this.check()}identity(){return this.copy(VP)}fromObject(t){return this.check()}fromQuaternion(t){return zP(this,t),this.check()}set(t,r,n,a,d,f,c,T,C){return this[0]=t,this[1]=r,this[2]=n,this[3]=a,this[4]=d,this[5]=f,this[6]=c,this[7]=T,this[8]=C,this.check()}setRowMajor(t,r,n,a,d,f,c,T,C){return this[0]=t,this[1]=a,this[2]=c,this[3]=r,this[4]=d,this[5]=T,this[6]=n,this[7]=f,this[8]=C,this.check()}determinant(){return NP(this)}transpose(){return OP(this,this),this.check()}invert(){return kP(this,this),this.check()}multiplyLeft(t){return Tx(this,t,this),this.check()}multiplyRight(t){return Tx(this,this,t),this.check()}rotate(t){return UP(this,this,t),this.check()}scale(t){return Array.isArray(t)?Ax(this,this,t):Ax(this,this,[t,t]),this.check()}translate(t){return LP(this,this,t),this.check()}transform(t,r){let n;switch(t.length){case 2:n=dx(r||[-0,-0],t,this);break;case 3:n=vx(r||[-0,-0,-0],t,this);break;case 4:n=gx(r||[-0,-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return oh(n,t.length),n}transformVector(t,r){return this.transform(t,r)}transformVector2(t,r){return this.transform(t,r)}transformVector3(t,r){return this.transform(t,r)}}let Ef,Sf=null;function jP(){return Ef||(Ef=new Xr([0,0,0,0,0,0,0,0,0]),Object.freeze(Ef)),Ef}function HP(){return Sf||(Sf=new Xr,Object.freeze(Sf)),Sf}function GP(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function $P(e,t){if(e===t){const r=t[1],n=t[2],a=t[3],d=t[6],f=t[7],c=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=r,e[6]=t[9],e[7]=t[13],e[8]=n,e[9]=d,e[11]=t[14],e[12]=a,e[13]=f,e[14]=c}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e}function Wg(e,t){const r=t[0],n=t[1],a=t[2],d=t[3],f=t[4],c=t[5],T=t[6],C=t[7],R=t[8],L=t[9],V=t[10],X=t[11],at=t[12],nt=t[13],K=t[14],It=t[15],St=r*c-n*f,Ct=r*T-a*f,Ht=r*C-d*f,Qt=n*T-a*c,ee=n*C-d*c,ae=a*C-d*T,be=R*nt-L*at,ie=R*K-V*at,le=R*It-X*at,Ae=L*K-V*nt,Fe=L*It-X*nt,ze=V*It-X*K;let Ce=St*ze-Ct*Fe+Ht*Ae+Qt*le-ee*ie+ae*be;return Ce?(Ce=1/Ce,e[0]=(c*ze-T*Fe+C*Ae)*Ce,e[1]=(a*Fe-n*ze-d*Ae)*Ce,e[2]=(nt*ae-K*ee+It*Qt)*Ce,e[3]=(V*ee-L*ae-X*Qt)*Ce,e[4]=(T*le-f*ze-C*ie)*Ce,e[5]=(r*ze-a*le+d*ie)*Ce,e[6]=(K*Ht-at*ae-It*Ct)*Ce,e[7]=(R*ae-V*Ht+X*Ct)*Ce,e[8]=(f*Fe-c*le+C*be)*Ce,e[9]=(n*le-r*Fe-d*be)*Ce,e[10]=(at*ee-nt*Ht+It*St)*Ce,e[11]=(L*Ht-R*ee-X*St)*Ce,e[12]=(c*ie-f*Ae-T*be)*Ce,e[13]=(r*Ae-n*ie+a*be)*Ce,e[14]=(nt*Ct-at*Qt-K*St)*Ce,e[15]=(R*Qt-L*Ct+V*St)*Ce,e):null}function WP(e){const t=e[0],r=e[1],n=e[2],a=e[3],d=e[4],f=e[5],c=e[6],T=e[7],C=e[8],R=e[9],L=e[10],V=e[11],X=e[12],at=e[13],nt=e[14],K=e[15],It=t*f-r*d,St=t*c-n*d,Ct=r*c-n*f,Ht=C*at-R*X,Qt=C*nt-L*X,ee=R*nt-L*at,ae=t*ee-r*Qt+n*Ht,be=d*ee-f*Qt+c*Ht,ie=C*Ct-R*St+L*It,le=X*Ct-at*St+nt*It;return T*ae-a*be+K*ie-V*le}function Qa(e,t,r){const n=t[0],a=t[1],d=t[2],f=t[3],c=t[4],T=t[5],C=t[6],R=t[7],L=t[8],V=t[9],X=t[10],at=t[11],nt=t[12],K=t[13],It=t[14],St=t[15];let Ct=r[0],Ht=r[1],Qt=r[2],ee=r[3];return e[0]=Ct*n+Ht*c+Qt*L+ee*nt,e[1]=Ct*a+Ht*T+Qt*V+ee*K,e[2]=Ct*d+Ht*C+Qt*X+ee*It,e[3]=Ct*f+Ht*R+Qt*at+ee*St,Ct=r[4],Ht=r[5],Qt=r[6],ee=r[7],e[4]=Ct*n+Ht*c+Qt*L+ee*nt,e[5]=Ct*a+Ht*T+Qt*V+ee*K,e[6]=Ct*d+Ht*C+Qt*X+ee*It,e[7]=Ct*f+Ht*R+Qt*at+ee*St,Ct=r[8],Ht=r[9],Qt=r[10],ee=r[11],e[8]=Ct*n+Ht*c+Qt*L+ee*nt,e[9]=Ct*a+Ht*T+Qt*V+ee*K,e[10]=Ct*d+Ht*C+Qt*X+ee*It,e[11]=Ct*f+Ht*R+Qt*at+ee*St,Ct=r[12],Ht=r[13],Qt=r[14],ee=r[15],e[12]=Ct*n+Ht*c+Qt*L+ee*nt,e[13]=Ct*a+Ht*T+Qt*V+ee*K,e[14]=Ct*d+Ht*C+Qt*X+ee*It,e[15]=Ct*f+Ht*R+Qt*at+ee*St,e}function Cf(e,t,r){const n=r[0],a=r[1],d=r[2];let f,c,T,C,R,L,V,X,at,nt,K,It;return t===e?(e[12]=t[0]*n+t[4]*a+t[8]*d+t[12],e[13]=t[1]*n+t[5]*a+t[9]*d+t[13],e[14]=t[2]*n+t[6]*a+t[10]*d+t[14],e[15]=t[3]*n+t[7]*a+t[11]*d+t[15]):(f=t[0],c=t[1],T=t[2],C=t[3],R=t[4],L=t[5],V=t[6],X=t[7],at=t[8],nt=t[9],K=t[10],It=t[11],e[0]=f,e[1]=c,e[2]=T,e[3]=C,e[4]=R,e[5]=L,e[6]=V,e[7]=X,e[8]=at,e[9]=nt,e[10]=K,e[11]=It,e[12]=f*n+R*a+at*d+t[12],e[13]=c*n+L*a+nt*d+t[13],e[14]=T*n+V*a+K*d+t[14],e[15]=C*n+X*a+It*d+t[15]),e}function Xg(e,t,r){const n=r[0],a=r[1],d=r[2];return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*a,e[5]=t[5]*a,e[6]=t[6]*a,e[7]=t[7]*a,e[8]=t[8]*d,e[9]=t[9]*d,e[10]=t[10]*d,e[11]=t[11]*d,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function XP(e,t,r,n){let a=n[0],d=n[1],f=n[2],c=Math.sqrt(a*a+d*d+f*f),T,C,R,L,V,X,at,nt,K,It,St,Ct,Ht,Qt,ee,ae,be,ie,le,Ae,Fe,ze,Ce,zr;return c<ah?null:(c=1/c,a*=c,d*=c,f*=c,C=Math.sin(r),T=Math.cos(r),R=1-T,L=t[0],V=t[1],X=t[2],at=t[3],nt=t[4],K=t[5],It=t[6],St=t[7],Ct=t[8],Ht=t[9],Qt=t[10],ee=t[11],ae=a*a*R+T,be=d*a*R+f*C,ie=f*a*R-d*C,le=a*d*R-f*C,Ae=d*d*R+T,Fe=f*d*R+a*C,ze=a*f*R+d*C,Ce=d*f*R-a*C,zr=f*f*R+T,e[0]=L*ae+nt*be+Ct*ie,e[1]=V*ae+K*be+Ht*ie,e[2]=X*ae+It*be+Qt*ie,e[3]=at*ae+St*be+ee*ie,e[4]=L*le+nt*Ae+Ct*Fe,e[5]=V*le+K*Ae+Ht*Fe,e[6]=X*le+It*Ae+Qt*Fe,e[7]=at*le+St*Ae+ee*Fe,e[8]=L*ze+nt*Ce+Ct*zr,e[9]=V*ze+K*Ce+Ht*zr,e[10]=X*ze+It*Ce+Qt*zr,e[11]=at*ze+St*Ce+ee*zr,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)}function Ex(e,t,r){const n=Math.sin(r),a=Math.cos(r),d=t[4],f=t[5],c=t[6],T=t[7],C=t[8],R=t[9],L=t[10],V=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=d*a+C*n,e[5]=f*a+R*n,e[6]=c*a+L*n,e[7]=T*a+V*n,e[8]=C*a-d*n,e[9]=R*a-f*n,e[10]=L*a-c*n,e[11]=V*a-T*n,e}function qP(e,t,r){const n=Math.sin(r),a=Math.cos(r),d=t[0],f=t[1],c=t[2],T=t[3],C=t[8],R=t[9],L=t[10],V=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=d*a-C*n,e[1]=f*a-R*n,e[2]=c*a-L*n,e[3]=T*a-V*n,e[8]=d*n+C*a,e[9]=f*n+R*a,e[10]=c*n+L*a,e[11]=T*n+V*a,e}function Sx(e,t,r){const n=Math.sin(r),a=Math.cos(r),d=t[0],f=t[1],c=t[2],T=t[3],C=t[4],R=t[5],L=t[6],V=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=d*a+C*n,e[1]=f*a+R*n,e[2]=c*a+L*n,e[3]=T*a+V*n,e[4]=C*a-d*n,e[5]=R*a-f*n,e[6]=L*a-c*n,e[7]=V*a-T*n,e}function ZP(e,t){const r=t[0],n=t[1],a=t[2],d=t[4],f=t[5],c=t[6],T=t[8],C=t[9],R=t[10];return e[0]=Math.sqrt(r*r+n*n+a*a),e[1]=Math.sqrt(d*d+f*f+c*c),e[2]=Math.sqrt(T*T+C*C+R*R),e}function YP(e,t){const r=t[0],n=t[1],a=t[2],d=t[3],f=r+r,c=n+n,T=a+a,C=r*f,R=n*f,L=n*c,V=a*f,X=a*c,at=a*T,nt=d*f,K=d*c,It=d*T;return e[0]=1-L-at,e[1]=R+It,e[2]=V-K,e[3]=0,e[4]=R-It,e[5]=1-C-at,e[6]=X+nt,e[7]=0,e[8]=V+K,e[9]=X-nt,e[10]=1-C-L,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function KP(e,t,r,n,a,d,f){const c=1/(r-t),T=1/(a-n),C=1/(d-f);return e[0]=d*2*c,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=d*2*T,e[6]=0,e[7]=0,e[8]=(r+t)*c,e[9]=(a+n)*T,e[10]=(f+d)*C,e[11]=-1,e[12]=0,e[13]=0,e[14]=f*d*2*C,e[15]=0,e}function JP(e,t,r,n,a){const d=1/Math.tan(t/2);if(e[0]=d/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=d,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,a!=null&&a!==1/0){const f=1/(n-a);e[10]=(a+n)*f,e[14]=2*a*n*f}else e[10]=-1,e[14]=-2*n;return e}const QP=JP;function t3(e,t,r,n,a,d,f){const c=1/(t-r),T=1/(n-a),C=1/(d-f);return e[0]=-2*c,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*T,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*C,e[11]=0,e[12]=(t+r)*c,e[13]=(a+n)*T,e[14]=(f+d)*C,e[15]=1,e}const e3=t3;function r3(e,t,r,n){let a,d,f,c,T,C,R,L,V,X;const at=t[0],nt=t[1],K=t[2],It=n[0],St=n[1],Ct=n[2],Ht=r[0],Qt=r[1],ee=r[2];return Math.abs(at-Ht)<ah&&Math.abs(nt-Qt)<ah&&Math.abs(K-ee)<ah?GP(e):(L=at-Ht,V=nt-Qt,X=K-ee,a=1/Math.sqrt(L*L+V*V+X*X),L*=a,V*=a,X*=a,d=St*X-Ct*V,f=Ct*L-It*X,c=It*V-St*L,a=Math.sqrt(d*d+f*f+c*c),a?(a=1/a,d*=a,f*=a,c*=a):(d=0,f=0,c=0),T=V*c-X*f,C=X*d-L*c,R=L*f-V*d,a=Math.sqrt(T*T+C*C+R*R),a?(a=1/a,T*=a,C*=a,R*=a):(T=0,C=0,R=0),e[0]=d,e[1]=T,e[2]=L,e[3]=0,e[4]=f,e[5]=C,e[6]=V,e[7]=0,e[8]=c,e[9]=R,e[10]=X,e[11]=0,e[12]=-(d*at+f*nt+c*K),e[13]=-(T*at+C*nt+R*K),e[14]=-(L*at+V*nt+X*K),e[15]=1,e)}function i3(){const e=new An(4);return An!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function s3(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e}function Cx(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e}function n3(e){const t=e[0],r=e[1],n=e[2],a=e[3];return Math.sqrt(t*t+r*r+n*n+a*a)}function o3(e){const t=e[0],r=e[1],n=e[2],a=e[3];return t*t+r*r+n*n+a*a}function a3(e,t){const r=t[0],n=t[1],a=t[2],d=t[3];let f=r*r+n*n+a*a+d*d;return f>0&&(f=1/Math.sqrt(f)),e[0]=r*f,e[1]=n*f,e[2]=a*f,e[3]=d*f,e}function l3(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function c3(e,t,r,n){const a=t[0],d=t[1],f=t[2],c=t[3];return e[0]=a+n*(r[0]-a),e[1]=d+n*(r[1]-d),e[2]=f+n*(r[2]-f),e[3]=c+n*(r[3]-c),e}function lh(e,t,r){const n=t[0],a=t[1],d=t[2],f=t[3];return e[0]=r[0]*n+r[4]*a+r[8]*d+r[12]*f,e[1]=r[1]*n+r[5]*a+r[9]*d+r[13]*f,e[2]=r[2]*n+r[6]*a+r[10]*d+r[14]*f,e[3]=r[3]*n+r[7]*a+r[11]*d+r[15]*f,e}function u3(e,t,r){const n=t[0],a=t[1],d=t[2],f=r[0],c=r[1],T=r[2],C=r[3],R=C*n+c*d-T*a,L=C*a+T*n-f*d,V=C*d+f*a-c*n,X=-f*n-c*a-T*d;return e[0]=R*C+X*-f+L*-T-V*-c,e[1]=L*C+X*-c+V*-f-R*-T,e[2]=V*C+X*-T+R*-c-L*-f,e[3]=t[3],e}(function(){const e=i3();return function(t,r,n,a,d,f){let c,T;for(r||(r=4),n||(n=0),a?T=Math.min(a*r+n,t.length):T=t.length,c=n;c<T;c+=r)e[0]=t[c],e[1]=t[c+1],e[2]=t[c+2],e[3]=t[c+3],d(e,e,f),t[c]=e[0],t[c+1]=e[1],t[c+2]=e[2],t[c+3]=e[3];return t}})();var qg;(function(e){e[e.COL0ROW0=0]="COL0ROW0",e[e.COL0ROW1=1]="COL0ROW1",e[e.COL0ROW2=2]="COL0ROW2",e[e.COL0ROW3=3]="COL0ROW3",e[e.COL1ROW0=4]="COL1ROW0",e[e.COL1ROW1=5]="COL1ROW1",e[e.COL1ROW2=6]="COL1ROW2",e[e.COL1ROW3=7]="COL1ROW3",e[e.COL2ROW0=8]="COL2ROW0",e[e.COL2ROW1=9]="COL2ROW1",e[e.COL2ROW2=10]="COL2ROW2",e[e.COL2ROW3=11]="COL2ROW3",e[e.COL3ROW0=12]="COL3ROW0",e[e.COL3ROW1=13]="COL3ROW1",e[e.COL3ROW2=14]="COL3ROW2",e[e.COL3ROW3=15]="COL3ROW3"})(qg||(qg={}));const h3=45*Math.PI/180,d3=1,Zg=.1,Yg=500,f3=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class He extends wx{static get IDENTITY(){return _3()}static get ZERO(){return p3()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return qg}constructor(t){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(t)?this.copy(t):this.identity()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this[4]=t[4],this[5]=t[5],this[6]=t[6],this[7]=t[7],this[8]=t[8],this[9]=t[9],this[10]=t[10],this[11]=t[11],this[12]=t[12],this[13]=t[13],this[14]=t[14],this[15]=t[15],this.check()}set(t,r,n,a,d,f,c,T,C,R,L,V,X,at,nt,K){return this[0]=t,this[1]=r,this[2]=n,this[3]=a,this[4]=d,this[5]=f,this[6]=c,this[7]=T,this[8]=C,this[9]=R,this[10]=L,this[11]=V,this[12]=X,this[13]=at,this[14]=nt,this[15]=K,this.check()}setRowMajor(t,r,n,a,d,f,c,T,C,R,L,V,X,at,nt,K){return this[0]=t,this[1]=d,this[2]=C,this[3]=X,this[4]=r,this[5]=f,this[6]=R,this[7]=at,this[8]=n,this[9]=c,this[10]=L,this[11]=nt,this[12]=a,this[13]=T,this[14]=V,this[15]=K,this.check()}toRowMajor(t){return t[0]=this[0],t[1]=this[4],t[2]=this[8],t[3]=this[12],t[4]=this[1],t[5]=this[5],t[6]=this[9],t[7]=this[13],t[8]=this[2],t[9]=this[6],t[10]=this[10],t[11]=this[14],t[12]=this[3],t[13]=this[7],t[14]=this[11],t[15]=this[15],t}identity(){return this.copy(f3)}fromObject(t){return this.check()}fromQuaternion(t){return YP(this,t),this.check()}frustum(t){const{left:r,right:n,bottom:a,top:d,near:f=Zg,far:c=Yg}=t;return c===1/0?g3(this,r,n,a,d,f):KP(this,r,n,a,d,f,c),this.check()}lookAt(t){const{eye:r,center:n=[0,0,0],up:a=[0,1,0]}=t;return r3(this,r,n,a),this.check()}ortho(t){const{left:r,right:n,bottom:a,top:d,near:f=Zg,far:c=Yg}=t;return e3(this,r,n,a,d,f,c),this.check()}orthographic(t){const{fovy:r=h3,aspect:n=d3,focalDistance:a=1,near:d=Zg,far:f=Yg}=t;Ix(r);const c=r/2,T=a*Math.tan(c),C=T*n;return this.ortho({left:-C,right:C,bottom:-T,top:T,near:d,far:f})}perspective(t){const{fovy:r=45*Math.PI/180,aspect:n=1,near:a=.1,far:d=500}=t;return Ix(r),QP(this,r,n,a,d),this.check()}determinant(){return WP(this)}getScale(t=[-0,-0,-0]){return t[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),t[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),t[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),t}getTranslation(t=[-0,-0,-0]){return t[0]=this[12],t[1]=this[13],t[2]=this[14],t}getRotation(t,r){t=t||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],r=r||[-0,-0,-0];const n=this.getScale(r),a=1/n[0],d=1/n[1],f=1/n[2];return t[0]=this[0]*a,t[1]=this[1]*d,t[2]=this[2]*f,t[3]=0,t[4]=this[4]*a,t[5]=this[5]*d,t[6]=this[6]*f,t[7]=0,t[8]=this[8]*a,t[9]=this[9]*d,t[10]=this[10]*f,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}getRotationMatrix3(t,r){t=t||[-0,-0,-0,-0,-0,-0,-0,-0,-0],r=r||[-0,-0,-0];const n=this.getScale(r),a=1/n[0],d=1/n[1],f=1/n[2];return t[0]=this[0]*a,t[1]=this[1]*d,t[2]=this[2]*f,t[3]=this[4]*a,t[4]=this[5]*d,t[5]=this[6]*f,t[6]=this[8]*a,t[7]=this[9]*d,t[8]=this[10]*f,t}transpose(){return $P(this,this),this.check()}invert(){return Wg(this,this),this.check()}multiplyLeft(t){return Qa(this,t,this),this.check()}multiplyRight(t){return Qa(this,this,t),this.check()}rotateX(t){return Ex(this,this,t),this.check()}rotateY(t){return qP(this,this,t),this.check()}rotateZ(t){return Sx(this,this,t),this.check()}rotateXYZ(t){return this.rotateX(t[0]).rotateY(t[1]).rotateZ(t[2])}rotateAxis(t,r){return XP(this,this,t,r),this.check()}scale(t){return Xg(this,this,Array.isArray(t)?t:[t,t,t]),this.check()}translate(t){return Cf(this,this,t),this.check()}transform(t,r){return t.length===4?(r=lh(r||[-0,-0,-0,-0],t,this),oh(r,4),r):this.transformAsPoint(t,r)}transformAsPoint(t,r){const{length:n}=t;let a;switch(n){case 2:a=fx(r||[-0,-0],t,this);break;case 3:a=jg(r||[-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return oh(a,t.length),a}transformAsVector(t,r){let n;switch(t.length){case 2:n=px(r||[-0,-0],t,this);break;case 3:n=_x(r||[-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return oh(n,t.length),n}transformPoint(t,r){return this.transformAsPoint(t,r)}transformVector(t,r){return this.transformAsPoint(t,r)}transformDirection(t,r){return this.transformAsVector(t,r)}makeRotationX(t){return this.identity().rotateX(t)}makeTranslation(t,r,n){return this.identity().translate([t,r,n])}}let If,Mf;function p3(){return If||(If=new He([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(If)),If}function _3(){return Mf||(Mf=new He,Object.freeze(Mf)),Mf}function Ix(e){if(e>Math.PI*2)throw Error("expected radians")}function g3(e,t,r,n,a,d){const f=2*d/(r-t),c=2*d/(a-n),T=(r+t)/(r-t),C=(a+n)/(a-n),R=-1,L=-1,V=-2*d;return e[0]=f,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=c,e[6]=0,e[7]=0,e[8]=T,e[9]=C,e[10]=R,e[11]=L,e[12]=0,e[13]=0,e[14]=V,e[15]=0,e}function Mx(){const e=new An(4);return An!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function m3(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function Rx(e,t,r){r=r*.5;const n=Math.sin(r);return e[0]=n*t[0],e[1]=n*t[1],e[2]=n*t[2],e[3]=Math.cos(r),e}function Px(e,t,r){const n=t[0],a=t[1],d=t[2],f=t[3],c=r[0],T=r[1],C=r[2],R=r[3];return e[0]=n*R+f*c+a*C-d*T,e[1]=a*R+f*T+d*c-n*C,e[2]=d*R+f*C+n*T-a*c,e[3]=f*R-n*c-a*T-d*C,e}function y3(e,t,r){r*=.5;const n=t[0],a=t[1],d=t[2],f=t[3],c=Math.sin(r),T=Math.cos(r);return e[0]=n*T+f*c,e[1]=a*T+d*c,e[2]=d*T-a*c,e[3]=f*T-n*c,e}function b3(e,t,r){r*=.5;const n=t[0],a=t[1],d=t[2],f=t[3],c=Math.sin(r),T=Math.cos(r);return e[0]=n*T-d*c,e[1]=a*T+f*c,e[2]=d*T+n*c,e[3]=f*T-a*c,e}function v3(e,t,r){r*=.5;const n=t[0],a=t[1],d=t[2],f=t[3],c=Math.sin(r),T=Math.cos(r);return e[0]=n*T+a*c,e[1]=a*T-n*c,e[2]=d*T+f*c,e[3]=f*T-d*c,e}function x3(e,t){const r=t[0],n=t[1],a=t[2];return e[0]=r,e[1]=n,e[2]=a,e[3]=Math.sqrt(Math.abs(1-r*r-n*n-a*a)),e}function Rf(e,t,r,n){const a=t[0],d=t[1],f=t[2],c=t[3];let T=r[0],C=r[1],R=r[2],L=r[3],V,X,at,nt,K;return V=a*T+d*C+f*R+c*L,V<0&&(V=-V,T=-T,C=-C,R=-R,L=-L),1-V>ah?(X=Math.acos(V),K=Math.sin(X),at=Math.sin((1-n)*X)/K,nt=Math.sin(n*X)/K):(at=1-n,nt=n),e[0]=at*a+nt*T,e[1]=at*d+nt*C,e[2]=at*f+nt*R,e[3]=at*c+nt*L,e}function w3(e,t){const r=t[0],n=t[1],a=t[2],d=t[3],f=r*r+n*n+a*a+d*d,c=f?1/f:0;return e[0]=-r*c,e[1]=-n*c,e[2]=-a*c,e[3]=d*c,e}function T3(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e}function Bx(e,t){const r=t[0]+t[4]+t[8];let n;if(r>0)n=Math.sqrt(r+1),e[3]=.5*n,n=.5/n,e[0]=(t[5]-t[7])*n,e[1]=(t[6]-t[2])*n,e[2]=(t[1]-t[3])*n;else{let a=0;t[4]>t[0]&&(a=1),t[8]>t[a*3+a]&&(a=2);const d=(a+1)%3,f=(a+2)%3;n=Math.sqrt(t[a*3+a]-t[d*3+d]-t[f*3+f]+1),e[a]=.5*n,n=.5/n,e[3]=(t[d*3+f]-t[f*3+d])*n,e[d]=(t[d*3+a]+t[a*3+d])*n,e[f]=(t[f*3+a]+t[a*3+f])*n}return e}const A3=s3,E3=Cx,S3=l3,C3=c3,I3=n3,M3=o3,Dx=a3,R3=(function(){const e=mx(),t=bx(1,0,0),r=bx(0,1,0);return function(n,a,d){const f=Vg(a,d);return f<-.999999?(wf(e,t,a),DP(e)<1e-6&&wf(e,r,a),CP(e,e),Rx(n,e,Math.PI),n):f>.999999?(n[0]=0,n[1]=0,n[2]=0,n[3]=1,n):(wf(e,a,d),n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=1+f,Dx(n,n))}})();(function(){const e=Mx(),t=Mx();return function(r,n,a,d,f,c){return Rf(e,n,f,c),Rf(t,a,d,c),Rf(r,e,t,2*c*(1-c)),r}})(),(function(){const e=FP();return function(t,r,n,a){return e[0]=n[0],e[3]=n[1],e[6]=n[2],e[1]=a[0],e[4]=a[1],e[7]=a[2],e[2]=-r[0],e[5]=-r[1],e[8]=-r[2],Dx(t,Bx(t,e))}})();const P3=[0,0,0,1];class ch extends Lg{constructor(t=0,r=0,n=0,a=1){super(-0,-0,-0,-0),Array.isArray(t)&&arguments.length===1?this.copy(t):this.set(t,r,n,a)}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this.check()}set(t,r,n,a){return this[0]=t,this[1]=r,this[2]=n,this[3]=a,this.check()}fromObject(t){return this[0]=t.x,this[1]=t.y,this[2]=t.z,this[3]=t.w,this.check()}fromMatrix3(t){return Bx(this,t),this.check()}fromAxisRotation(t,r){return Rx(this,t,r),this.check()}identity(){return m3(this),this.check()}setAxisAngle(t,r){return this.fromAxisRotation(t,r)}get ELEMENTS(){return 4}get x(){return this[0]}set x(t){this[0]=er(t)}get y(){return this[1]}set y(t){this[1]=er(t)}get z(){return this[2]}set z(t){this[2]=er(t)}get w(){return this[3]}set w(t){this[3]=er(t)}len(){return I3(this)}lengthSquared(){return M3(this)}dot(t){return S3(this,t)}rotationTo(t,r){return R3(this,t,r),this.check()}add(t){return A3(this,this,t),this.check()}calculateW(){return x3(this,this),this.check()}conjugate(){return T3(this,this),this.check()}invert(){return w3(this,this),this.check()}lerp(t,r,n){return n===void 0?this.lerp(this,t,r):(C3(this,t,r,n),this.check())}multiplyRight(t){return Px(this,this,t),this.check()}multiplyLeft(t){return Px(this,t,this),this.check()}normalize(){const t=this.len(),r=t>0?1/t:0;return this[0]=this[0]*r,this[1]=this[1]*r,this[2]=this[2]*r,this[3]=this[3]*r,t===0&&(this[3]=1),this.check()}rotateX(t){return y3(this,this,t),this.check()}rotateY(t){return b3(this,this,t),this.check()}rotateZ(t){return v3(this,this,t),this.check()}scale(t){return E3(this,this,t),this.check()}slerp(t,r,n){let a,d,f;switch(arguments.length){case 1:({start:a=P3,target:d,ratio:f}=t);break;case 2:a=this,d=t,f=r;break;default:a=t,d=r,f=n}return Rf(this,a,d,f),this.check()}transformVector4(t,r=new Gg){return u3(r,t,this),oh(r,4)}lengthSq(){return this.lengthSquared()}setFromAxisAngle(t,r){return this.setAxisAngle(t,r)}premultiply(t){return this.multiplyLeft(t)}multiply(t){return this.multiplyRight(t)}}const B3=.1,D3=1e-12,Fx=1e-15,F3=1e-20,Ox=`#if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))
struct AmbientLight {
vec3 color;
};
struct PointLight {
vec3 color;
vec3 position;
vec3 attenuation;
};
struct DirectionalLight {
vec3 color;
vec3 direction;
};
uniform AmbientLight lighting_uAmbientLight;
uniform PointLight lighting_uPointLight[MAX_LIGHTS];
uniform DirectionalLight lighting_uDirectionalLight[MAX_LIGHTS];
uniform int lighting_uPointLightCount;
uniform int lighting_uDirectionalLightCount;
uniform bool lighting_uEnabled;
float getPointLightAttenuation(PointLight pointLight, float distance) {
return pointLight.attenuation.x
+ pointLight.attenuation.y * distance
+ pointLight.attenuation.z * distance * distance;
}
#endif
`,O3={lightSources:{}};function Kg(e={}){const{color:t=[0,0,0],intensity:r=1}=e;return t.map(n=>n*r/255)}function k3({ambientLight:e,pointLights:t=[],directionalLights:r=[]}){const n={};return e?n["lighting_uAmbientLight.color"]=Kg(e):n["lighting_uAmbientLight.color"]=[0,0,0],t.forEach((a,d)=>{n[`lighting_uPointLight[${d}].color`]=Kg(a),n[`lighting_uPointLight[${d}].position`]=a.position,n[`lighting_uPointLight[${d}].attenuation`]=a.attenuation||[1,0,0]}),n.lighting_uPointLightCount=t.length,r.forEach((a,d)=>{n[`lighting_uDirectionalLight[${d}].color`]=Kg(a),n[`lighting_uDirectionalLight[${d}].direction`]=a.direction}),n.lighting_uDirectionalLightCount=r.length,n}function kx(e=O3){if("lightSources"in e){const{ambientLight:t,pointLights:r,directionalLights:n}=e.lightSources||{};return t||r&&r.length>0||n&&n.length>0?Object.assign({},k3({ambientLight:t,pointLights:r,directionalLights:n}),{lighting_uEnabled:!0}):{lighting_uEnabled:!1}}if("lights"in e){const t={pointLights:[],directionalLights:[]};for(const r of e.lights||[])switch(r.type){case"ambient":t.ambientLight=r;break;case"directional":t.directionalLights?.push(r);break;case"point":t.pointLights?.push(r);break}return kx({lightSources:t})}return{}}const Jg={name:"lights",vs:Ox,fs:Ox,getUniforms:kx,defines:{MAX_LIGHTS:3}},Nx=`uniform float lighting_uAmbient;
uniform float lighting_uDiffuse;
uniform float lighting_uShininess;
uniform vec3  lighting_uSpecularColor;
vec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {
vec3 halfway_direction = normalize(light_direction + view_direction);
float lambertian = dot(light_direction, normal_worldspace);
float specular = 0.0;
if (lambertian > 0.0) {
float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
specular = pow(specular_angle, lighting_uShininess);
}
lambertian = max(lambertian, 0.0);
return (lambertian * lighting_uDiffuse * surfaceColor + specular * lighting_uSpecularColor) * color;
}
vec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
vec3 lightColor = surfaceColor;
if (lighting_uEnabled) {
vec3 view_direction = normalize(cameraPosition - position_worldspace);
lightColor = lighting_uAmbient * surfaceColor * lighting_uAmbientLight.color;
for (int i = 0; i < MAX_LIGHTS; i++) {
if (i >= lighting_uPointLightCount) {
break;
}
PointLight pointLight = lighting_uPointLight[i];
vec3 light_position_worldspace = pointLight.position;
vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
}
for (int i = 0; i < MAX_LIGHTS; i++) {
if (i >= lighting_uDirectionalLightCount) {
break;
}
DirectionalLight directionalLight = lighting_uDirectionalLight[i];
lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
}
}
return lightColor;
}
vec3 lighting_getSpecularLightColor(vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
vec3 lightColor = vec3(0, 0, 0);
vec3 surfaceColor = vec3(0, 0, 0);
if (lighting_uEnabled) {
vec3 view_direction = normalize(cameraPosition - position_worldspace);
for (int i = 0; i < MAX_LIGHTS; i++) {
if (i >= lighting_uPointLightCount) {
break;
}
PointLight pointLight = lighting_uPointLight[i];
vec3 light_position_worldspace = pointLight.position;
vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
}
for (int i = 0; i < MAX_LIGHTS; i++) {
if (i >= lighting_uDirectionalLightCount) {
break;
}
DirectionalLight directionalLight = lighting_uDirectionalLight[i];
lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
}
}
return lightColor;
}
`,N3={};function L3(e){const{ambient:t=.35,diffuse:r=.6,shininess:n=32,specularColor:a=[30,30,30]}=e;return{lighting_uAmbient:t,lighting_uDiffuse:r,lighting_uShininess:n,lighting_uSpecularColor:a.map(d=>d/255)}}function Lx(e=N3){if(!("material"in e))return{};const{material:t}=e;return t?L3(t):{lighting_uEnabled:!1}}const U3={name:"gouraud-lighting",dependencies:[Jg],vs:Nx,defines:{LIGHTING_VERTEX:1},getUniforms:Lx},z3={name:"phong-lighting",dependencies:[Jg],fs:Nx,defines:{LIGHTING_FRAGMENT:1},getUniforms:Lx},Qg={name:"pbr",vs:`uniform mat4 u_MVPMatrix;
uniform mat4 u_ModelMatrix;
uniform mat4 u_NormalMatrix;
out vec3 pbr_vPosition;
out vec2 pbr_vUV;
#ifdef HAS_NORMALS
# ifdef HAS_TANGENTS
out mat3 pbr_vTBN;
# else
out vec3 pbr_vNormal;
# endif
#endif
void pbr_setPositionNormalTangentUV(vec4 position, vec4 normal, vec4 tangent, vec2 uv)
{
vec4 pos = u_ModelMatrix * position;
pbr_vPosition = vec3(pos.xyz) / pos.w;
#ifdef HAS_NORMALS
#ifdef HAS_TANGENTS
vec3 normalW = normalize(vec3(u_NormalMatrix * vec4(normal.xyz, 0.0)));
vec3 tangentW = normalize(vec3(u_ModelMatrix * vec4(tangent.xyz, 0.0)));
vec3 bitangentW = cross(normalW, tangentW) * tangent.w;
pbr_vTBN = mat3(tangentW, bitangentW, normalW);
#else
pbr_vNormal = normalize(vec3(u_ModelMatrix * vec4(normal.xyz, 0.0)));
#endif
#endif
#ifdef HAS_UV
pbr_vUV = uv;
#else
pbr_vUV = vec2(0.,0.);
#endif
}
`,fs:`precision highp float;
uniform bool pbr_uUnlit;
#ifdef USE_IBL
uniform samplerCube u_DiffuseEnvSampler;
uniform samplerCube u_SpecularEnvSampler;
uniform sampler2D u_brdfLUT;
uniform vec2 u_ScaleIBLAmbient;
#endif
#ifdef HAS_BASECOLORMAP
uniform sampler2D u_BaseColorSampler;
#endif
#ifdef HAS_NORMALMAP
uniform sampler2D u_NormalSampler;
uniform float u_NormalScale;
#endif
#ifdef HAS_EMISSIVEMAP
uniform sampler2D u_EmissiveSampler;
uniform vec3 u_EmissiveFactor;
#endif
#ifdef HAS_METALROUGHNESSMAP
uniform sampler2D u_MetallicRoughnessSampler;
#endif
#ifdef HAS_OCCLUSIONMAP
uniform sampler2D u_OcclusionSampler;
uniform float u_OcclusionStrength;
#endif
#ifdef ALPHA_CUTOFF
uniform float u_AlphaCutoff;
#endif
uniform vec2 u_MetallicRoughnessValues;
uniform vec4 u_BaseColorFactor;
uniform vec3 u_Camera;
#ifdef PBR_DEBUG
uniform vec4 u_ScaleDiffBaseMR;
uniform vec4 u_ScaleFGDSpec;
#endif
in vec3 pbr_vPosition;
in vec2 pbr_vUV;
#ifdef HAS_NORMALS
#ifdef HAS_TANGENTS
in mat3 pbr_vTBN;
#else
in vec3 pbr_vNormal;
#endif
#endif
struct PBRInfo
{
float NdotL;
float NdotV;
float NdotH;
float LdotH;
float VdotH;
float perceptualRoughness;
float metalness;
vec3 reflectance0;
vec3 reflectance90;
float alphaRoughness;
vec3 diffuseColor;
vec3 specularColor;
vec3 n;
vec3 v;
};
const float M_PI = 3.141592653589793;
const float c_MinRoughness = 0.04;
vec4 SRGBtoLINEAR(vec4 srgbIn)
{
#ifdef MANUAL_SRGB
#ifdef SRGB_FAST_APPROXIMATION
vec3 linOut = pow(srgbIn.xyz,vec3(2.2));
#else
vec3 bLess = step(vec3(0.04045),srgbIn.xyz);
vec3 linOut = mix( srgbIn.xyz/vec3(12.92), pow((srgbIn.xyz+vec3(0.055))/vec3(1.055),vec3(2.4)), bLess );
#endif
return vec4(linOut,srgbIn.w);;
#else
return srgbIn;
#endif
}
vec3 getNormal()
{
#ifndef HAS_TANGENTS
vec3 pos_dx = dFdx(pbr_vPosition);
vec3 pos_dy = dFdy(pbr_vPosition);
vec3 tex_dx = dFdx(vec3(pbr_vUV, 0.0));
vec3 tex_dy = dFdy(vec3(pbr_vUV, 0.0));
vec3 t = (tex_dy.t * pos_dx - tex_dx.t * pos_dy) / (tex_dx.s * tex_dy.t - tex_dy.s * tex_dx.t);
#ifdef HAS_NORMALS
vec3 ng = normalize(pbr_vNormal);
#else
vec3 ng = cross(pos_dx, pos_dy);
#endif
t = normalize(t - ng * dot(ng, t));
vec3 b = normalize(cross(ng, t));
mat3 tbn = mat3(t, b, ng);
#else
mat3 tbn = pbr_vTBN;
#endif
#ifdef HAS_NORMALMAP
vec3 n = texture(u_NormalSampler, pbr_vUV).rgb;
n = normalize(tbn * ((2.0 * n - 1.0) * vec3(u_NormalScale, u_NormalScale, 1.0)));
#else
vec3 n = normalize(tbn[2].xyz);
#endif
return n;
}
#ifdef USE_IBL
vec3 getIBLContribution(PBRInfo pbrInputs, vec3 n, vec3 reflection)
{
float mipCount = 9.0;
float lod = (pbrInputs.perceptualRoughness * mipCount);
vec3 brdf = SRGBtoLINEAR(texture(u_brdfLUT,
vec2(pbrInputs.NdotV, 1.0 - pbrInputs.perceptualRoughness))).rgb;
vec3 diffuseLight = SRGBtoLINEAR(textureCube(u_DiffuseEnvSampler, n)).rgb;
#ifdef USE_TEX_LOD
vec3 specularLight = SRGBtoLINEAR(textureCubeLod(u_SpecularEnvSampler, reflection, lod)).rgb;
#else
vec3 specularLight = SRGBtoLINEAR(textureCube(u_SpecularEnvSampler, reflection)).rgb;
#endif
vec3 diffuse = diffuseLight * pbrInputs.diffuseColor;
vec3 specular = specularLight * (pbrInputs.specularColor * brdf.x + brdf.y);
diffuse *= u_ScaleIBLAmbient.x;
specular *= u_ScaleIBLAmbient.y;
return diffuse + specular;
}
#endif
vec3 diffuse(PBRInfo pbrInputs)
{
return pbrInputs.diffuseColor / M_PI;
}
vec3 specularReflection(PBRInfo pbrInputs)
{
return pbrInputs.reflectance0 +
(pbrInputs.reflectance90 - pbrInputs.reflectance0) *
pow(clamp(1.0 - pbrInputs.VdotH, 0.0, 1.0), 5.0);
}
float geometricOcclusion(PBRInfo pbrInputs)
{
float NdotL = pbrInputs.NdotL;
float NdotV = pbrInputs.NdotV;
float r = pbrInputs.alphaRoughness;
float attenuationL = 2.0 * NdotL / (NdotL + sqrt(r * r + (1.0 - r * r) * (NdotL * NdotL)));
float attenuationV = 2.0 * NdotV / (NdotV + sqrt(r * r + (1.0 - r * r) * (NdotV * NdotV)));
return attenuationL * attenuationV;
}
float microfacetDistribution(PBRInfo pbrInputs)
{
float roughnessSq = pbrInputs.alphaRoughness * pbrInputs.alphaRoughness;
float f = (pbrInputs.NdotH * roughnessSq - pbrInputs.NdotH) * pbrInputs.NdotH + 1.0;
return roughnessSq / (M_PI * f * f);
}
void PBRInfo_setAmbientLight(inout PBRInfo pbrInputs) {
pbrInputs.NdotL = 1.0;
pbrInputs.NdotH = 0.0;
pbrInputs.LdotH = 0.0;
pbrInputs.VdotH = 1.0;
}
void PBRInfo_setDirectionalLight(inout PBRInfo pbrInputs, vec3 lightDirection) {
vec3 n = pbrInputs.n;
vec3 v = pbrInputs.v;
vec3 l = normalize(lightDirection);
vec3 h = normalize(l+v);
pbrInputs.NdotL = clamp(dot(n, l), 0.001, 1.0);
pbrInputs.NdotH = clamp(dot(n, h), 0.0, 1.0);
pbrInputs.LdotH = clamp(dot(l, h), 0.0, 1.0);
pbrInputs.VdotH = clamp(dot(v, h), 0.0, 1.0);
}
void PBRInfo_setPointLight(inout PBRInfo pbrInputs, PointLight pointLight) {
vec3 light_direction = normalize(pointLight.position - pbr_vPosition);
PBRInfo_setDirectionalLight(pbrInputs, light_direction);
}
vec3 calculateFinalColor(PBRInfo pbrInputs, vec3 lightColor) {
vec3 F = specularReflection(pbrInputs);
float G = geometricOcclusion(pbrInputs);
float D = microfacetDistribution(pbrInputs);
vec3 diffuseContrib = (1.0 - F) * diffuse(pbrInputs);
vec3 specContrib = F * G * D / (4.0 * pbrInputs.NdotL * pbrInputs.NdotV);
return pbrInputs.NdotL * lightColor * (diffuseContrib + specContrib);
}
vec4 pbr_filterColor(vec4 colorUnused)
{
#ifdef HAS_BASECOLORMAP
vec4 baseColor = SRGBtoLINEAR(texture(u_BaseColorSampler, pbr_vUV)) * u_BaseColorFactor;
#else
vec4 baseColor = u_BaseColorFactor;
#endif
#ifdef ALPHA_CUTOFF
if (baseColor.a < u_AlphaCutoff) {
discard;
}
#endif
vec3 color = vec3(0, 0, 0);
if(pbr_uUnlit){
color.rgb = baseColor.rgb;
}
else{
float perceptualRoughness = u_MetallicRoughnessValues.y;
float metallic = u_MetallicRoughnessValues.x;
#ifdef HAS_METALROUGHNESSMAP
vec4 mrSample = texture(u_MetallicRoughnessSampler, pbr_vUV);
perceptualRoughness = mrSample.g * perceptualRoughness;
metallic = mrSample.b * metallic;
#endif
perceptualRoughness = clamp(perceptualRoughness, c_MinRoughness, 1.0);
metallic = clamp(metallic, 0.0, 1.0);
float alphaRoughness = perceptualRoughness * perceptualRoughness;
vec3 f0 = vec3(0.04);
vec3 diffuseColor = baseColor.rgb * (vec3(1.0) - f0);
diffuseColor *= 1.0 - metallic;
vec3 specularColor = mix(f0, baseColor.rgb, metallic);
float reflectance = max(max(specularColor.r, specularColor.g), specularColor.b);
float reflectance90 = clamp(reflectance * 25.0, 0.0, 1.0);
vec3 specularEnvironmentR0 = specularColor.rgb;
vec3 specularEnvironmentR90 = vec3(1.0, 1.0, 1.0) * reflectance90;
vec3 n = getNormal();
vec3 v = normalize(u_Camera - pbr_vPosition);
float NdotV = clamp(abs(dot(n, v)), 0.001, 1.0);
vec3 reflection = -normalize(reflect(v, n));
PBRInfo pbrInputs = PBRInfo(
0.0,
NdotV,
0.0,
0.0,
0.0,
perceptualRoughness,
metallic,
specularEnvironmentR0,
specularEnvironmentR90,
alphaRoughness,
diffuseColor,
specularColor,
n,
v
);
#ifdef USE_LIGHTS
PBRInfo_setAmbientLight(pbrInputs);
color += calculateFinalColor(pbrInputs, lighting_uAmbientLight.color);
for(int i = 0; i < lighting_uDirectionalLightCount; i++) {
if (i < lighting_uDirectionalLightCount) {
PBRInfo_setDirectionalLight(pbrInputs, lighting_uDirectionalLight[i].direction);
color += calculateFinalColor(pbrInputs, lighting_uDirectionalLight[i].color);
}
}
for(int i = 0; i < lighting_uPointLightCount; i++) {
if (i < lighting_uPointLightCount) {
PBRInfo_setPointLight(pbrInputs, lighting_uPointLight[i]);
float attenuation = getPointLightAttenuation(lighting_uPointLight[i], distance(lighting_uPointLight[i].position, pbr_vPosition));
color += calculateFinalColor(pbrInputs, lighting_uPointLight[i].color / attenuation);
}
}
#endif
#ifdef USE_IBL
color += getIBLContribution(pbrInputs, n, reflection);
#endif
#ifdef HAS_OCCLUSIONMAP
float ao = texture(u_OcclusionSampler, pbr_vUV).r;
color = mix(color, color * ao, u_OcclusionStrength);
#endif
#ifdef HAS_EMISSIVEMAP
vec3 emissive = SRGBtoLINEAR(texture(u_EmissiveSampler, pbr_vUV)).rgb * u_EmissiveFactor;
color += emissive;
#endif
#ifdef PBR_DEBUG
color = mix(color, baseColor.rgb, u_ScaleDiffBaseMR.y);
color = mix(color, vec3(metallic), u_ScaleDiffBaseMR.z);
color = mix(color, vec3(perceptualRoughness), u_ScaleDiffBaseMR.w);
#endif
}
return vec4(pow(color,vec3(1.0/2.2)), baseColor.a);
}
`,defines:{LIGHTING_FRAGMENT:1},dependencies:[Jg]},Ux="#define SMOOTH_EDGE_RADIUS 0.5",V3=`
${Ux}

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`,j3=`
${Ux}

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,H3={name:"geometry",vs:V3,fs:j3},$e={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty($e,"IDENTITY",{get:()=>(Ye.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const Qn={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},tm={common:0,meters:1,pixels:2},em={click:{handler:"onClick"},panstart:{handler:"onDragStart"},panmove:{handler:"onDrag"},panend:{handler:"onDragEnd"}},G3=Object.keys($e).map(e=>`const int COORDINATE_SYSTEM_${e} = ${$e[e]};`).join(""),$3=Object.keys(Qn).map(e=>`const int PROJECTION_MODE_${e} = ${Qn[e]};`).join(""),W3=Object.keys(tm).map(e=>`const int UNIT_${e.toUpperCase()} = ${tm[e]};`).join(""),X3=`${G3}
${$3}
${W3}
uniform int project_uCoordinateSystem;
uniform int project_uProjectionMode;
uniform float project_uScale;
uniform bool project_uWrapLongitude;
uniform vec3 project_uCommonUnitsPerMeter;
uniform vec3 project_uCommonUnitsPerWorldUnit;
uniform vec3 project_uCommonUnitsPerWorldUnit2;
uniform vec4 project_uCenter;
uniform mat4 project_uModelMatrix;
uniform mat4 project_uViewProjectionMatrix;
uniform vec2 project_uViewportSize;
uniform float project_uDevicePixelRatio;
uniform float project_uFocalDistance;
uniform vec3 project_uCameraPosition;
uniform vec3 project_uCoordinateOrigin;
uniform vec3 project_uCommonOrigin;
uniform bool project_uPseudoMeters;
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
float y = clamp(lat, -89.9, 89.9);
return 1.0 / cos(radians(y));
}
float project_size() {
if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR &&
project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
project_uPseudoMeters == false) {
if (geometry.position.w == 0.0) {
return project_size_at_latitude(geometry.worldPosition.y);
}
float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
float y2 = y * y;
float y4 = y2 * y2;
float y6 = y4 * y2;
return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
}
return 1.0;
}
float project_size_at_latitude(float meters, float lat) {
return meters * project_uCommonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
return meters * project_uCommonUnitsPerMeter.z * project_size();
}
vec2 project_size(vec2 meters) {
return meters * project_uCommonUnitsPerMeter.xy * project_size();
}
vec3 project_size(vec3 meters) {
return meters * project_uCommonUnitsPerMeter * project_size();
}
vec4 project_size(vec4 meters) {
return vec4(meters.xyz * project_uCommonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
vec3 uz = normalize(up);
vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
vec3 uy = cross(uz, ux);
return mat3(ux, uy, uz);
}
bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
transform = project_get_orientation_matrix(commonPosition);
return true;
}
return false;
}
vec3 project_normal(vec3 vector) {
vec4 normal_modelspace = project_uModelMatrix * vec4(vector, 0.0);
vec3 n = normalize(normal_modelspace.xyz * project_uCommonUnitsPerMeter);
mat3 rotation;
if (project_needs_rotation(geometry.position.xyz, rotation)) {
n = rotation * n;
}
return n;
}
vec4 project_offset_(vec4 offset) {
float dy = offset.y;
vec3 commonUnitsPerWorldUnit = project_uCommonUnitsPerWorldUnit + project_uCommonUnitsPerWorldUnit2 * dy;
return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
float x = lnglat.x;
if (project_uWrapLongitude) {
x = mod(x + 180., 360.0) - 180.;
}
float y = clamp(lnglat.y, -89.9, 89.9);
return vec2(
radians(x) + PI,
PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
) * WORLD_SCALE;
}
vec3 project_globe_(vec3 lnglatz) {
float lambda = radians(lnglatz.x);
float phi = radians(lnglatz.y);
float cosPhi = cos(phi);
float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
return vec3(
sin(lambda) * cosPhi,
-cos(lambda) * cosPhi,
sin(phi)
) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
vec4 position_world = project_uModelMatrix * position;
if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR) {
if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_mercator_(position_world.xy),
project_size_at_latitude(position_world.z, position_world.y),
position_world.w
);
}
if (project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
position_world.xyz += project_uCoordinateOrigin;
}
}
if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_globe_(position_world.xyz),
position_world.w
);
}
}
if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
if (abs(position_world.y - project_uCoordinateOrigin.y) > 0.25) {
return vec4(
project_mercator_(position_world.xy) - project_uCommonOrigin.xy,
project_size(position_world.z),
position_world.w
);
}
}
}
if (project_uProjectionMode == PROJECTION_MODE_IDENTITY ||
(project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
(project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
position_world.xyz -= project_uCoordinateOrigin;
}
return project_offset_(position_world) + project_offset_(project_uModelMatrix * vec4(position64Low, 0.0));
}
vec4 project_position(vec4 position) {
return project_position(position, ZERO_64_LOW);
}
vec3 project_position(vec3 position, vec3 position64Low) {
vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
return projected_position.xyz;
}
vec3 project_position(vec3 position) {
vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
return projected_position.xyz;
}
vec2 project_position(vec2 position) {
vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
return projected_position.xy;
}
vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
return project_common_position_to_clipspace(position, project_uViewProjectionMatrix, project_uCenter);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
vec2 offset = pixels / project_uViewportSize * project_uDevicePixelRatio * 2.0;
return offset * project_uFocalDistance;
}
float project_size_to_pixel(float meters) {
return project_size(meters) * project_uScale;
}
float project_size_to_pixel(float size, int unit) {
if (unit == UNIT_METERS) return project_size_to_pixel(size);
if (unit == UNIT_COMMON) return size * project_uScale;
return size;
}
float project_pixel_size(float pixels) {
return pixels / project_uScale;
}
vec2 project_pixel_size(vec2 pixels) {
return pixels / project_uScale;
}
`;function q3(e,t){if(e===t)return!0;if(Array.isArray(e)){const r=e.length;if(!t||t.length!==r)return!1;for(let n=0;n<r;n++)if(e[n]!==t[n])return!1;return!0}return!1}function uh(e){let t={},r;return n=>{for(const a in n)if(!q3(n[a],t[a])){r=e(n),t=n;break}return r}}const zx=[0,0,0,0],Z3=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],Vx=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],Y3=[0,0,0],jx=[0,0,0],K3=uh(tB);function Hx(e,t,r=jx){r.length<3&&(r=[r[0],r[1],0]);let n=r,a,d=!0;switch(t===$e.LNGLAT_OFFSETS||t===$e.METER_OFFSETS?a=r:a=e.isGeospatial?[Math.fround(e.longitude),Math.fround(e.latitude),0]:null,e.projectionMode){case Qn.WEB_MERCATOR:(t===$e.LNGLAT||t===$e.CARTESIAN)&&(a=[0,0,0],d=!1);break;case Qn.WEB_MERCATOR_AUTO_OFFSET:t===$e.LNGLAT?n=a:t===$e.CARTESIAN&&(n=[Math.fround(e.center[0]),Math.fround(e.center[1]),0],a=e.unprojectPosition(n),n[0]-=r[0],n[1]-=r[1],n[2]-=r[2]);break;case Qn.IDENTITY:n=e.position.map(Math.fround),n[2]=n[2]||0;break;case Qn.GLOBE:d=!1,a=null;break;default:d=!1}return{geospatialOrigin:a,shaderCoordinateOrigin:n,offsetMode:d}}function J3(e,t,r){const{viewMatrixUncentered:n,projectionMatrix:a}=e;let{viewMatrix:d,viewProjectionMatrix:f}=e,c=zx,T=zx,C=e.cameraPosition;const{geospatialOrigin:R,shaderCoordinateOrigin:L,offsetMode:V}=Hx(e,t,r);return V&&(T=e.projectPosition(R||L),C=[C[0]-T[0],C[1]-T[1],C[2]-T[2]],T[3]=1,c=lh([],T,f),d=n||d,f=Qa([],a,d),f=Qa([],f,Z3)),{viewMatrix:d,viewProjectionMatrix:f,projectionCenter:c,originCommon:T,cameraPosCommon:C,shaderCoordinateOrigin:L,geospatialOrigin:R}}function Q3({viewport:e,devicePixelRatio:t=1,modelMatrix:r=null,coordinateSystem:n=$e.DEFAULT,coordinateOrigin:a=jx,autoWrapLongitude:d=!1}){n===$e.DEFAULT&&(n=e.isGeospatial?$e.LNGLAT:$e.CARTESIAN);const f=K3({viewport:e,devicePixelRatio:t,coordinateSystem:n,coordinateOrigin:a});return f.project_uWrapLongitude=d,f.project_uModelMatrix=r||Vx,f}function tB({viewport:e,devicePixelRatio:t,coordinateSystem:r,coordinateOrigin:n}){const{projectionCenter:a,viewProjectionMatrix:d,originCommon:f,cameraPosCommon:c,shaderCoordinateOrigin:T,geospatialOrigin:C}=J3(e,r,n),R=e.getDistanceScales(),L=[e.width*t,e.height*t],V=lh([],[0,0,-e.focalDistance,1],e.projectionMatrix)[3]||1,X={project_uCoordinateSystem:r,project_uProjectionMode:e.projectionMode,project_uCoordinateOrigin:T,project_uCommonOrigin:f.slice(0,3),project_uCenter:a,project_uPseudoMeters:!!e._pseudoMeters,project_uViewportSize:L,project_uDevicePixelRatio:t,project_uFocalDistance:V,project_uCommonUnitsPerMeter:R.unitsPerMeter,project_uCommonUnitsPerWorldUnit:R.unitsPerMeter,project_uCommonUnitsPerWorldUnit2:Y3,project_uScale:e.scale,project_uWrapLongitude:!1,project_uViewProjectionMatrix:d,project_uModelMatrix:Vx,project_uCameraPosition:c};if(C){const at=e.getDistanceScales(C);switch(r){case $e.METER_OFFSETS:X.project_uCommonUnitsPerWorldUnit=at.unitsPerMeter,X.project_uCommonUnitsPerWorldUnit2=at.unitsPerMeter2;break;case $e.LNGLAT:case $e.LNGLAT_OFFSETS:e._pseudoMeters||(X.project_uCommonUnitsPerMeter=at.unitsPerMeter),X.project_uCommonUnitsPerWorldUnit=at.unitsPerDegree,X.project_uCommonUnitsPerWorldUnit2=at.unitsPerDegree2;break;case $e.CARTESIAN:X.project_uCommonUnitsPerWorldUnit=[1,1,at.unitsPerMeter[2]],X.project_uCommonUnitsPerWorldUnit2=[0,0,at.unitsPerMeter2[2]];break}}return X}const eB={};function rB(e=eB){return"viewport"in e?Q3(e):{}}const rm={name:"project",dependencies:[eP,H3],vs:X3,getUniforms:rB},im={name:"project32",dependencies:[rm],vs:`
vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`};function iB(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function hc(e,t){const r=lh([],t,e);return Cx(r,r,1/r[3]),r}function Gx(e,t){const r=e%t;return r<0?t+r:r}function sm(e,t,r){return e<t?t:e>r?r:e}function sB(e){return Math.log(e)*Math.LOG2E}const nm=Math.log2||sB;function So(e,t){if(!e)throw new Error(t||"@math.gl/web-mercator: assertion failed.")}const En=Math.PI,$x=En/4,on=En/180,om=180/En,dc=512,Pf=4003e4,Bf=85.051129,nB=1.5;function oB(e){return nm(e)}function hh(e){const[t,r]=e;So(Number.isFinite(t)),So(Number.isFinite(r)&&r>=-90&&r<=90,"invalid latitude");const n=t*on,a=r*on,d=dc*(n+En)/(2*En),f=dc*(En+Math.log(Math.tan($x+a*.5)))/(2*En);return[d,f]}function fc(e){const[t,r]=e,n=t/dc*(2*En)-En,a=2*(Math.atan(Math.exp(r/dc*(2*En)-En))-$x);return[n*om,a*om]}function aB(e){const{latitude:t}=e;So(Number.isFinite(t));const r=Math.cos(t*on);return oB(Pf*r)-9}function Df(e){const t=Math.cos(e*on);return dc/Pf/t}function am(e){const{latitude:t,longitude:r,highPrecision:n=!1}=e;So(Number.isFinite(t)&&Number.isFinite(r));const a=dc,d=Math.cos(t*on),f=a/360,c=f/d,T=a/Pf/d,C={unitsPerMeter:[T,T,T],metersPerUnit:[1/T,1/T,1/T],unitsPerDegree:[f,c,T],degreesPerUnit:[1/f,1/c,1/T]};if(n){const R=on*Math.tan(t*on)/d,L=f*R/2,V=a/Pf*R,X=V/c*T;C.unitsPerDegree2=[0,L,V],C.unitsPerMeter2=[X,0,X]}return C}function Wx(e,t){const[r,n,a]=e,[d,f,c]=t,{unitsPerMeter:T,unitsPerMeter2:C}=am({longitude:r,latitude:n,highPrecision:!0}),R=hh(e);R[0]+=d*(T[0]+C[0]*f),R[1]+=f*(T[1]+C[1]*f);const L=fc(R),V=(a||0)+(c||0);return Number.isFinite(a)||Number.isFinite(c)?[L[0],L[1],V]:L}function lB(e){const{height:t,pitch:r,bearing:n,altitude:a,scale:d,center:f}=e,c=iB();Cf(c,c,[0,0,-a]),Ex(c,c,-r*on),Sx(c,c,n*on);const T=d/t;return Xg(c,c,[T,T,T]),f&&Cf(c,c,SP([],f)),c}function cB(e){const{width:t,height:r,altitude:n,pitch:a=0,offset:d,center:f,scale:c,nearZMultiplier:T=1,farZMultiplier:C=1}=e;let{fovy:R=Ff(nB)}=e;n!==void 0&&(R=Ff(n));const L=R*on,V=a*on,X=Xx(R);let at=X;f&&(at+=f[2]*c/Math.cos(V)/r);const nt=L*(.5+(d?d[1]:0)/r),K=Math.sin(nt)*at/Math.sin(sm(Math.PI/2-V-nt,.01,Math.PI-.01)),It=Math.sin(V)*K+at,St=at*10,Ct=Math.min(It*C,St);return{fov:L,aspect:t/r,focalDistance:X,near:T,far:Ct}}function Ff(e){return 2*Math.atan(.5/e)*om}function Xx(e){return .5/Math.tan(.5*e*on)}function qx(e,t){const[r,n,a=0]=e;return So(Number.isFinite(r)&&Number.isFinite(n)&&Number.isFinite(a)),hc(t,[r,n,a,1])}function lm(e,t,r=0){const[n,a,d]=e;if(So(Number.isFinite(n)&&Number.isFinite(a),"invalid pixel coordinate"),Number.isFinite(d))return hc(t,[n,a,d,1]);const f=hc(t,[n,a,0,1]),c=hc(t,[n,a,1,1]),T=f[2],C=c[2],R=T===C?0:((r||0)-T)/(C-T);return hx([],f,c,R)}function uB(e){const{width:t,height:r,bounds:n,minExtent:a=0,maxZoom:d=24,offset:f=[0,0]}=e,[[c,T],[C,R]]=n,L=hB(e.padding),V=hh([c,sm(R,-Bf,Bf)]),X=hh([C,sm(T,-Bf,Bf)]),at=[Math.max(Math.abs(X[0]-V[0]),a),Math.max(Math.abs(X[1]-V[1]),a)],nt=[t-L.left-L.right-Math.abs(f[0])*2,r-L.top-L.bottom-Math.abs(f[1])*2];So(nt[0]>0&&nt[1]>0);const K=nt[0]/at[0],It=nt[1]/at[1],St=(L.right-L.left)/2/K,Ct=(L.top-L.bottom)/2/It,Ht=[(X[0]+V[0])/2+St,(X[1]+V[1])/2+Ct],Qt=fc(Ht),ee=Math.min(d,nm(Math.abs(Math.min(K,It))));return So(Number.isFinite(ee)),{longitude:Qt[0],latitude:Qt[1],zoom:ee}}function hB(e=0){return typeof e=="number"?{top:e,bottom:e,left:e,right:e}:(So(Number.isFinite(e.top)&&Number.isFinite(e.bottom)&&Number.isFinite(e.left)&&Number.isFinite(e.right)),e)}const Zx=Math.PI/180;function dB(e,t=0){const{width:r,height:n,unproject:a}=e,d={targetZ:t},f=a([0,n],d),c=a([r,n],d);let T,C;const R=e.fovy?.5*e.fovy*Zx:Math.atan(.5/e.altitude),L=(90-e.pitch)*Zx;return R>L-.01?(T=Yx(e,0,t),C=Yx(e,r,t)):(T=a([0,0],d),C=a([r,0],d)),[f,c,C,T]}function Yx(e,t,r){const{pixelUnprojectionMatrix:n}=e,a=hc(n,[t,0,1,1]),d=hc(n,[t,e.height,1,1]),c=(r*e.distanceScales.unitsPerMeter[2]-a[2])/(d[2]-a[2]),T=hx([],a,d,c),C=fc(T);return C.push(r),C}const Kx=512;function fB(e){const{width:t,height:r,pitch:n=0}=e;let{longitude:a,latitude:d,zoom:f,bearing:c=0}=e;(a<-180||a>180)&&(a=Gx(a+180,360)-180),(c<-180||c>180)&&(c=Gx(c+180,360)-180);const T=nm(r/Kx);if(f<=T)f=T,d=0;else{const C=r/2/Math.pow(2,f),R=fc([0,C])[1];if(d<R)d=R;else{const L=fc([0,Kx-C])[1];d>L&&(d=L)}}return{width:t,height:r,longitude:a,latitude:d,zoom:f,pitch:n,bearing:c}}const pB=`
const int max_lights = 2;
uniform mat4 shadow_uViewProjectionMatrices[max_lights];
uniform vec4 shadow_uProjectCenters[max_lights];
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform int shadow_uLightId;
uniform float shadow_uLightCount;

out vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  if (shadow_uDrawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[shadow_uLightId], shadow_uProjectCenters[shadow_uLightId]);
  }
  if (shadow_uUseShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow_uLightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[i], shadow_uProjectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,_B=`
const int max_lights = 2;
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;
uniform vec4 shadow_uColor;
uniform float shadow_uLightCount;

in vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow_uDrawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow_uUseShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow_uLightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow_uColor.a / shadow_uLightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow_uColor.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,gB=uh(xB),mB=uh(wB),yB=[0,0,0,1],bB=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function vB(e,t){const[r,n,a]=e,d=lm([r,n,a],t);return Number.isFinite(a)?d:[d[0],d[1],0]}function xB({viewport:e,center:t}){return new He(e.viewProjectionMatrix).invert().transform(t)}function wB({viewport:e,shadowMatrices:t}){const r=[],n=e.pixelUnprojectionMatrix,a=e.isGeospatial?void 0:1,d=[[0,0,a],[e.width,0,a],[0,e.height,a],[e.width,e.height,a],[0,0,-1],[e.width,0,-1],[0,e.height,-1],[e.width,e.height,-1]].map(f=>vB(f,n));for(const f of t){const c=f.clone().translate(new Bt(e.center).negate()),T=d.map(R=>c.transform(R)),C=new He().ortho({left:Math.min(...T.map(R=>R[0])),right:Math.max(...T.map(R=>R[0])),bottom:Math.min(...T.map(R=>R[1])),top:Math.max(...T.map(R=>R[1])),near:Math.min(...T.map(R=>-R[2])),far:Math.max(...T.map(R=>-R[2]))});r.push(C.multiplyRight(f))}return r}function TB(e,t){const{shadowEnabled:r=!0}=e;if(!r||!e.shadowMatrices||!e.shadowMatrices.length)return{shadow_uDrawShadowMap:!1,shadow_uUseShadowMap:!1,shadow_uShadowMap0:e.dummyShadowMap,shadow_uShadowMap1:e.dummyShadowMap};const n={shadow_uDrawShadowMap:!!e.drawToShadowMap,shadow_uUseShadowMap:e.shadowMaps?e.shadowMaps.length>0:!1,shadow_uColor:e.shadowColor||yB,shadow_uLightId:e.shadowLightId||0,shadow_uLightCount:e.shadowMatrices.length},a=gB({viewport:e.viewport,center:t.project_uCenter}),d=[],f=mB({shadowMatrices:e.shadowMatrices,viewport:e.viewport}).slice();for(let c=0;c<e.shadowMatrices.length;c++){const T=f[c],C=T.clone().translate(new Bt(e.viewport.center).negate());t.project_uCoordinateSystem===$e.LNGLAT&&t.project_uProjectionMode===Qn.WEB_MERCATOR?(f[c]=C,d[c]=a):(f[c]=T.clone().multiplyRight(bB),d[c]=C.transform(a))}for(let c=0;c<f.length;c++)n[`shadow_uViewProjectionMatrices[${c}]`]=f[c],n[`shadow_uProjectCenters[${c}]`]=d[c];for(let c=0;c<2;c++)n[`shadow_uShadowMap${c}`]=e.shadowMaps&&e.shadowMaps[c]||e.dummyShadowMap;return n}const Jx={name:"shadow",dependencies:[rm],vs:pB,fs:_B,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:(e={},t={})=>"viewport"in e&&(e.drawToShadowMap||e.shadowMaps&&e.shadowMaps.length>0)?TB(e,t):{}},cm={...lx,defaultUniforms:{...lx.defaultUniforms,useFloatColors:!1},inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}}},AB=[rm],EB=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"];function SB(){const e=Za.getDefaultShaderAssembler();for(const t of AB)e.addDefaultModule(t);for(const t of EB)e.addShaderHook(t);return e}const CB=[255,255,255],IB=1;let MB=0;class RB{constructor(t={}){this.type="ambient";const{color:r=CB}=t,{intensity:n=IB}=t;this.id=t.id||`ambient-${MB++}`,this.color=r,this.intensity=n}}const PB=[255,255,255],BB=1,DB=[0,0,-1];let FB=0;class Qx{constructor(t={}){this.type="directional";const{color:r=PB}=t,{intensity:n=BB}=t,{direction:a=DB}=t,{_shadow:d=!1}=t;this.id=t.id||`directional-${FB++}`,this.color=r,this.intensity=n,this.type="directional",this.direction=new Bt(a).normalize().toArray(),this.shadow=d}getProjectedLight(t){return this}}class OB{constructor(t,r={id:"pass"}){const{id:n}=r;this.id=n,this.device=t,this.props={...r}}setProps(t){Object.assign(this.props,t)}render(t){}cleanup(){}}class um extends OB{constructor(){super(...arguments),this._lastRenderIndex=-1}render(t){const[r,n]=this.device.canvasContext.getDrawingBufferSize(),a=t.clearCanvas??!0,d=t.clearColor??(a?[0,0,0,0]:!1),f=a?1:!1,c=a?0:!1,T=t.colorMask??15,C={viewport:[0,0,r,n]};t.colorMask&&(C.colorMask=T),t.scissorRect&&(C.scissorRect=t.scissorRect);const R=this.device.beginRenderPass({framebuffer:t.target,parameters:C,clearColor:d,clearDepth:f,clearStencil:c});try{return this._drawLayers(R,t)}finally{R.end()}}_drawLayers(t,r){const{target:n,moduleParameters:a,viewports:d,views:f,onViewportActive:c,clearStack:T=!0}=r;r.pass=r.pass||"unknown",T&&(this._lastRenderIndex=-1);const C=[];for(const R of d){const L=f&&f[R.id];c?.(R);const V=this._getDrawLayerParams(R,r),X=R.subViewports||[R];for(const at of X){const nt=this._drawLayersInViewport(t,{target:n,moduleParameters:a,viewport:at,view:L,pass:r.pass,layers:r.layers},V);C.push(nt)}}return C}_getDrawLayerParams(t,{layers:r,pass:n,isPicking:a=!1,layerFilter:d,cullRect:f,effects:c,moduleParameters:T},C=!1){const R=[],L=t1(this._lastRenderIndex+1),V={layer:r[0],viewport:t,isPicking:a,renderPass:n,cullRect:f},X={};for(let at=0;at<r.length;at++){const nt=r[at],K=this._shouldDrawLayer(nt,V,d,X),It={shouldDrawLayer:K};K&&!C&&(It.layerRenderIndex=L(nt,K),It.moduleParameters=this._getModuleParameters(nt,c,n,T),It.layerParameters={...nt.context.deck?.props.parameters,...this.getLayerParameters(nt,at,t)}),R[at]=It}return R}_drawLayersInViewport(t,{layers:r,moduleParameters:n,pass:a,target:d,viewport:f,view:c},T){const C=kB(this.device,{moduleParameters:n,target:d,viewport:f});if(c&&c.props.clear){const L=c.props.clear===!0?{color:!0,depth:!0}:c.props.clear;this.device.withParametersWebGL({scissorTest:!0,scissor:C},()=>this.device.clearWebGL(L))}const R={totalCount:r.length,visibleCount:0,compositeCount:0,pickableCount:0};t.setParameters({viewport:C});for(let L=0;L<r.length;L++){const V=r[L],{shouldDrawLayer:X,layerRenderIndex:at,moduleParameters:nt,layerParameters:K}=T[L];if(X&&V.props.pickable&&R.pickableCount++,V.isComposite)R.compositeCount++;else if(X){R.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,at),nt.viewport=f,V.context.renderPass=t;try{V._drawLayer({renderPass:t,moduleParameters:nt,uniforms:{layerIndex:at},parameters:K})}catch(It){V.raiseError(It,`drawing ${V} to ${a}`)}}}return R}shouldDrawLayer(t){return!0}getModuleParameters(t,r){return null}getLayerParameters(t,r,n){return t.props.parameters}_shouldDrawLayer(t,r,n,a){if(!(t.props.visible&&this.shouldDrawLayer(t)))return!1;r.layer=t;let f=t.parent;for(;f;){if(!f.props.visible||!f.filterSubLayer(r))return!1;r.layer=f,f=f.parent}if(n){const c=r.layer.id;if(c in a||(a[c]=n(r)),!a[c])return!1}return t.activateViewport(r.viewport),!0}_getModuleParameters(t,r,n,a){const d=this.device.canvasContext.cssToDeviceRatio(),f=Object.assign(Object.create(t.internalState?.propsInTransition||t.props),{autoWrapLongitude:t.wrapLongitude,viewport:t.context.viewport,mousePosition:t.context.mousePosition,picking:{isActive:0},devicePixelRatio:d});if(r)for(const c of r)Object.assign(f,c.getModuleParameters?.(t));return Object.assign(f,this.getModuleParameters(t,r),a)}}function t1(e=0,t={}){const r={},n=(a,d)=>{const f=a.props._offset,c=a.id,T=a.parent&&a.parent.id;let C;if(T&&!(T in t)&&n(a.parent,!1),T in r){const R=r[T]=r[T]||t1(t[T],t);C=R(a,d),r[c]=R}else Number.isFinite(f)?(C=f+(t[T]||0),r[c]=null):C=e;return d&&C>=e&&(e=C+1),t[c]=C,C};return n}function kB(e,{moduleParameters:t,target:r,viewport:n}){const a=t&&t.devicePixelRatio||e.canvasContext.cssToDeviceRatio(),[,d]=e.canvasContext.getDrawingBufferSize(),f=r?r.height:d,c=n;return[c.x*a,f-(c.y+c.height)*a,c.width*a,c.height*a]}class NB extends um{constructor(t,r){super(t,r),this.shadowMap=t.createTexture({width:1,height:1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}}),this.depthBuffer=t.createTexture({format:"depth16unorm",width:1,height:1,mipmaps:!1,dataFormat:6402,type:5125}),this.fbo=t.createFramebuffer({id:"shadowmap",width:1,height:1,colorAttachments:[this.shadowMap],depthStencilAttachment:this.depthBuffer})}render(t){const r=this.fbo,n=this.device.canvasContext.cssToDeviceRatio(),a=t.viewports[0],d=a.width*n,f=a.height*n,c=[1,1,1,1];(d!==r.width||f!==r.height)&&r.resize({width:d,height:f}),super.render({...t,clearColor:c,target:r,pass:"shadow"})}getLayerParameters(t,r,n){return{...t.props.parameters,blend:!1,depthRange:[0,1],depthTest:!0}}shouldDrawLayer(t){return t.props.shadowEnabled!==!1}getModuleParameters(){return{drawToShadowMap:!0}}delete(){this.fbo&&(this.fbo.destroy(),this.fbo=null),this.shadowMap&&(this.shadowMap.destroy(),this.shadowMap=null),this.depthBuffer&&(this.depthBuffer.destroy(),this.depthBuffer=null)}}const LB={color:[255,255,255],intensity:1},e1=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],UB=[0,0,0,200/255];class r1{constructor(t={}){this.id="lighting-effect",this.shadowColor=UB,this.shadow=!1,this.ambientLight=null,this.directionalLights=[],this.pointLights=[],this.shadowPasses=[],this.shadowMaps=[],this.dummyShadowMap=null,this.setProps(t)}setup(t){this.context=t;const{device:r,deck:n}=t;this.shadow&&!this.dummyShadowMap&&(this._createShadowPasses(r),n._addDefaultShaderModule(Jx),this.dummyShadowMap=r.createTexture({width:1,height:1}))}setProps(t){this.ambientLight=null,this.directionalLights=[],this.pointLights=[];for(const r in t){const n=t[r];switch(n.type){case"ambient":this.ambientLight=n;break;case"directional":this.directionalLights.push(n);break;case"point":this.pointLights.push(n);break}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(r=>r.shadow),this.context&&this.setup(this.context),this.props=t}preRender({layers:t,layerFilter:r,viewports:n,onViewportActive:a,views:d}){if(this.shadow){this.shadowMatrices=this._calculateMatrices();for(let f=0;f<this.shadowPasses.length;f++)this.shadowPasses[f].render({layers:t,layerFilter:r,viewports:n,onViewportActive:a,views:d,moduleParameters:{shadowLightId:f,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}})}}getModuleParameters(t){const r=this.shadow?{shadowMaps:this.shadowMaps,dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{};return r.lightSources={ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(n=>n.getProjectedLight({layer:t})),pointLights:this.pointLights.map(n=>n.getProjectedLight({layer:t}))},r}cleanup(t){for(const r of this.shadowPasses)r.delete();this.shadowPasses.length=0,this.shadowMaps.length=0,this.dummyShadowMap&&(this.dummyShadowMap.destroy(),this.dummyShadowMap=null,t.deck._removeDefaultShaderModule(Jx))}_calculateMatrices(){const t=[];for(const r of this.directionalLights){const n=new He().lookAt({eye:new Bt(r.direction).negate()});t.push(n)}return t}_createShadowPasses(t){for(let r=0;r<this.directionalLights.length;r++){const n=new NB(t);this.shadowPasses[r]=n,this.shadowMaps[r]=n.shadowMap}}_applyDefaultLights(){const{ambientLight:t,pointLights:r,directionalLights:n}=this;!t&&r.length===0&&n.length===0&&(this.ambientLight=new RB(LB),this.directionalLights.push(new Qx(e1[0]),new Qx(e1[1])))}}class zB{constructor(t={}){this._pool=[],this.opts={overAlloc:2,poolSize:100},this.setOptions(t)}setOptions(t){Object.assign(this.opts,t)}allocate(t,r,{size:n=1,type:a,padding:d=0,copy:f=!1,initialize:c=!1,maxCount:T}){const C=a||t&&t.constructor||Float32Array,R=r*n+d;if(ArrayBuffer.isView(t)){if(R<=t.length)return t;if(R*t.BYTES_PER_ELEMENT<=t.buffer.byteLength)return new C(t.buffer,0,R)}let L=1/0;T&&(L=T*n+d);const V=this._allocate(C,R,c,L);return t&&f?V.set(t):c||V.fill(0,0,4),this._release(t),V}release(t){this._release(t)}_allocate(t,r,n,a){let d=Math.max(Math.ceil(r*this.opts.overAlloc),1);d>a&&(d=a);const f=this._pool,c=t.BYTES_PER_ELEMENT*d,T=f.findIndex(C=>C.byteLength>=c);if(T>=0){const C=new t(f.splice(T,1)[0],0,d);return n&&C.fill(0),C}return new t(d)}_release(t){if(!ArrayBuffer.isView(t))return;const r=this._pool,{buffer:n}=t,{byteLength:a}=n,d=r.findIndex(f=>f.byteLength>=a);d<0?r.push(n):(d>0||r.length<this.opts.poolSize)&&r.splice(d,0,n),r.length>this.opts.poolSize&&r.shift()}}const dh=new zB;function fh(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function VB(e){return[e[12],e[13],e[14]]}function jB(e){return{left:pc(e[3]+e[0],e[7]+e[4],e[11]+e[8],e[15]+e[12]),right:pc(e[3]-e[0],e[7]-e[4],e[11]-e[8],e[15]-e[12]),bottom:pc(e[3]+e[1],e[7]+e[5],e[11]+e[9],e[15]+e[13]),top:pc(e[3]-e[1],e[7]-e[5],e[11]-e[9],e[15]-e[13]),near:pc(e[3]+e[2],e[7]+e[6],e[11]+e[10],e[15]+e[14]),far:pc(e[3]-e[2],e[7]-e[6],e[11]-e[10],e[15]-e[14])}}const i1=new Bt;function pc(e,t,r,n){i1.set(e,t,r);const a=i1.len();return{distance:n/a,normal:new Bt(-e/a,-t/a,-r/a)}}function HB(e){return e-Math.fround(e)}let ph;function hm(e,t){const{size:r=1,startIndex:n=0}=t,a=t.endIndex!==void 0?t.endIndex:e.length,d=(a-n)/r;ph=dh.allocate(ph,d,{type:Float32Array,size:r*2});let f=n,c=0;for(;f<a;){for(let T=0;T<r;T++){const C=e[f++];ph[c+T]=C,ph[c+T+r]=HB(C)}c+=r*2}return ph.subarray(0,d*r*2)}function GB(e){let t=null,r=!1;for(const n of e)n&&(t?(r||(t=[[t[0][0],t[0][1]],[t[1][0],t[1][1]]],r=!0),t[0][0]=Math.min(t[0][0],n[0][0]),t[0][1]=Math.min(t[0][1],n[0][1]),t[1][0]=Math.max(t[1][0],n[1][0]),t[1][1]=Math.max(t[1][1],n[1][1])):t=n);return t}const $B=Math.PI/180,WB=fh(),s1=[0,0,0],XB={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function qB({width:e,height:t,orthographic:r,fovyRadians:n,focalDistance:a,padding:d,near:f,far:c}){const T=e/t,C=r?new He().orthographic({fovy:n,aspect:T,focalDistance:a,near:f,far:c}):new He().perspective({fovy:n,aspect:T,near:f,far:c});if(d){const{left:R=0,right:L=0,top:V=0,bottom:X=0}=d,at=Eo((R+e-L)/2,0,e)-e/2,nt=Eo((V+t-X)/2,0,t)-t/2;C[8]-=at*2/e,C[9]+=nt*2/t}return C}class _h{constructor(t={}){this._frustumPlanes={},this.id=t.id||this.constructor.displayName||"viewport",this.x=t.x||0,this.y=t.y||0,this.width=t.width||1,this.height=t.height||1,this.zoom=t.zoom||0,this.padding=t.padding,this.distanceScales=t.distanceScales||XB,this.focalDistance=t.focalDistance||1,this.position=t.position||s1,this.modelMatrix=t.modelMatrix||null;const{longitude:r,latitude:n}=t;this.isGeospatial=Number.isFinite(n)&&Number.isFinite(r),this._initProps(t),this._initMatrices(t),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?Qn.WEB_MERCATOR:Qn.WEB_MERCATOR_AUTO_OFFSET:Qn.IDENTITY}equals(t){return t instanceof _h?this===t?!0:t.width===this.width&&t.height===this.height&&t.scale===this.scale&&wn(t.projectionMatrix,this.projectionMatrix)&&wn(t.viewMatrix,this.viewMatrix):!1}project(t,{topLeft:r=!0}={}){const n=this.projectPosition(t),a=qx(n,this.pixelProjectionMatrix),[d,f]=a,c=r?f:this.height-f;return t.length===2?[d,c]:[d,c,a[2]]}unproject(t,{topLeft:r=!0,targetZ:n}={}){const[a,d,f]=t,c=r?d:this.height-d,T=n&&n*this.distanceScales.unitsPerMeter[2],C=lm([a,c,f],this.pixelUnprojectionMatrix,T),[R,L,V]=this.unprojectPosition(C);return Number.isFinite(f)?[R,L,V]:Number.isFinite(n)?[R,L,n]:[R,L]}projectPosition(t){const[r,n]=this.projectFlat(t),a=(t[2]||0)*this.distanceScales.unitsPerMeter[2];return[r,n,a]}unprojectPosition(t){const[r,n]=this.unprojectFlat(t),a=(t[2]||0)*this.distanceScales.metersPerUnit[2];return[r,n,a]}projectFlat(t){if(this.isGeospatial){const r=hh(t);return r[1]=Eo(r[1],-318,830),r}return t}unprojectFlat(t){return this.isGeospatial?fc(t):t}getBounds(t={}){const r={targetZ:t.z||0},n=this.unproject([0,0],r),a=this.unproject([this.width,0],r),d=this.unproject([0,this.height],r),f=this.unproject([this.width,this.height],r);return[Math.min(n[0],a[0],d[0],f[0]),Math.min(n[1],a[1],d[1],f[1]),Math.max(n[0],a[0],d[0],f[0]),Math.max(n[1],a[1],d[1],f[1])]}getDistanceScales(t){return t?am({longitude:t[0],latitude:t[1],highPrecision:!0}):this.distanceScales}containsPixel({x:t,y:r,width:n=1,height:a=1}){return t<this.x+this.width&&this.x<t+n&&r<this.y+this.height&&this.y<r+a}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,jB(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(t,r){return null}_initProps(t){const r=t.longitude,n=t.latitude;this.isGeospatial&&(Number.isFinite(t.zoom)||(this.zoom=aB({latitude:n})+Math.log2(this.focalDistance)),this.distanceScales=t.distanceScales||am({latitude:n,longitude:r}));const a=Math.pow(2,this.zoom);this.scale=a;const{position:d,modelMatrix:f}=t;let c=s1;if(d&&(c=f?new He(f).transformAsVector(d,[]):d),this.isGeospatial){const T=this.projectPosition([r,n,0]);this.center=new Bt(c).scale(this.distanceScales.unitsPerMeter).add(T)}else this.center=this.projectPosition(c)}_initMatrices(t){const{viewMatrix:r=WB,projectionMatrix:n=null,orthographic:a=!1,fovyRadians:d,fovy:f=75,near:c=.1,far:T=1e3,padding:C=null,focalDistance:R=1}=t;this.viewMatrixUncentered=r,this.viewMatrix=new He().multiplyRight(r).translate(new Bt(this.center).negate()),this.projectionMatrix=n||qB({width:this.width,height:this.height,orthographic:a,fovyRadians:d||f*$B,focalDistance:R,padding:C,near:c,far:T});const L=fh();Qa(L,L,this.projectionMatrix),Qa(L,L,this.viewMatrix),this.viewProjectionMatrix=L,this.viewMatrixInverse=Wg([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=VB(this.viewMatrixInverse);const V=fh(),X=fh();Xg(V,V,[this.width/2,-this.height/2,1]),Cf(V,V,[1,-1,0]),Qa(X,V,this.viewProjectionMatrix),this.pixelProjectionMatrix=X,this.pixelUnprojectionMatrix=Wg(fh(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||Ye.warn("Pixel project matrix not invertible")()}}_h.displayName="Viewport";class tl extends _h{constructor(t={}){const{latitude:r=0,longitude:n=0,zoom:a=0,pitch:d=0,bearing:f=0,nearZMultiplier:c=.1,farZMultiplier:T=1.01,nearZ:C,farZ:R,orthographic:L=!1,projectionMatrix:V,repeat:X=!1,worldOffset:at=0,position:nt,padding:K,legacyMeterSizes:It=!1}=t;let{width:St,height:Ct,altitude:Ht=1.5}=t;const Qt=Math.pow(2,a);St=St||1,Ct=Ct||1;let ee,ae=null;if(V)Ht=V[5]/2,ee=Ff(Ht);else{t.fovy?(ee=t.fovy,Ht=Xx(ee)):ee=Ff(Ht);let ie;if(K){const{top:le=0,bottom:Ae=0}=K;ie=[0,Eo((le+Ct-Ae)/2,0,Ct)-Ct/2]}ae=cB({width:St,height:Ct,scale:Qt,center:nt&&[0,0,nt[2]*Df(r)],offset:ie,pitch:d,fovy:ee,nearZMultiplier:c,farZMultiplier:T}),Number.isFinite(C)&&(ae.near=C),Number.isFinite(R)&&(ae.far=R)}let be=lB({height:Ct,pitch:d,bearing:f,scale:Qt,altitude:Ht});at&&(be=new He().translate([512*at,0,0]).multiplyLeft(be)),super({...t,width:St,height:Ct,viewMatrix:be,longitude:n,latitude:r,zoom:a,...ae,fovy:ee,focalDistance:Ht}),this.latitude=r,this.longitude=n,this.zoom=a,this.pitch=d,this.bearing=f,this.altitude=Ht,this.fovy=ee,this.orthographic=L,this._subViewports=X?[]:null,this._pseudoMeters=It,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const t=this.getBounds(),r=Math.floor((t[0]+180)/360),n=Math.ceil((t[2]-180)/360);for(let a=r;a<=n;a++){const d=a?new tl({...this,worldOffset:a}):this;this._subViewports.push(d)}}return this._subViewports}projectPosition(t){if(this._pseudoMeters)return super.projectPosition(t);const[r,n]=this.projectFlat(t),a=(t[2]||0)*Df(t[1]);return[r,n,a]}unprojectPosition(t){if(this._pseudoMeters)return super.unprojectPosition(t);const[r,n]=this.unprojectFlat(t),a=(t[2]||0)/Df(n);return[r,n,a]}addMetersToLngLat(t,r){return Wx(t,r)}panByPosition(t,r){const n=lm(r,this.pixelUnprojectionMatrix),a=this.projectFlat(t),d=ux([],a,vP([],n)),f=ux([],this.center,d),[c,T]=this.unprojectFlat(f);return{longitude:c,latitude:T}}getBounds(t={}){const r=dB(this,t.z||0);return[Math.min(r[0][0],r[1][0],r[2][0],r[3][0]),Math.min(r[0][1],r[1][1],r[2][1],r[3][1]),Math.max(r[0][0],r[1][0],r[2][0],r[3][0]),Math.max(r[0][1],r[1][1],r[2][1],r[3][1])]}fitBounds(t,r={}){const{width:n,height:a}=this,{longitude:d,latitude:f,zoom:c}=uB({width:n,height:a,bounds:t,...r});return new tl({width:n,height:a,longitude:d,latitude:f,zoom:c})}}tl.displayName="WebMercatorViewport";const n1=[0,0,0];function dm(e,t,r=!1){const n=t.projectPosition(e);if(r&&t instanceof tl){const[a,d,f=0]=e,c=t.getDistanceScales([a,d]);n[2]=f*c.unitsPerMeter[2]}return n}function ZB(e){const{viewport:t,modelMatrix:r,coordinateOrigin:n}=e;let{coordinateSystem:a,fromCoordinateSystem:d,fromCoordinateOrigin:f}=e;return a===$e.DEFAULT&&(a=t.isGeospatial?$e.LNGLAT:$e.CARTESIAN),d===void 0&&(d=a),f===void 0&&(f=n),{viewport:t,coordinateSystem:a,coordinateOrigin:n,modelMatrix:r,fromCoordinateSystem:d,fromCoordinateOrigin:f}}function o1(e,{viewport:t,modelMatrix:r,coordinateSystem:n,coordinateOrigin:a,offsetMode:d}){let[f,c,T=0]=e;switch(r&&([f,c,T]=lh([],[f,c,T,1],r)),n){case $e.LNGLAT:return dm([f,c,T],t,d);case $e.LNGLAT_OFFSETS:return dm([f+a[0],c+a[1],T+(a[2]||0)],t,d);case $e.METER_OFFSETS:return dm(Wx(a,[f,c,T]),t,d);case $e.CARTESIAN:default:return t.isGeospatial?[f+a[0],c+a[1],T+a[2]]:t.projectPosition([f,c,T])}}function YB(e,t){const{viewport:r,coordinateSystem:n,coordinateOrigin:a,modelMatrix:d,fromCoordinateSystem:f,fromCoordinateOrigin:c}=ZB(t),{autoOffset:T=!0}=t,{geospatialOrigin:C=n1,shaderCoordinateOrigin:R=n1,offsetMode:L=!1}=T?Hx(r,n,a):{},V=o1(e,{viewport:r,modelMatrix:d,coordinateSystem:f,coordinateOrigin:c,offsetMode:L});if(L){const X=r.projectPosition(C||R);BP(V,V,X)}return V}let KB=1,JB=1;class a1{time=0;channels=new Map;animations=new Map;playing=!1;lastEngineTime=-1;constructor(){}addChannel(t){const{delay:r=0,duration:n=Number.POSITIVE_INFINITY,rate:a=1,repeat:d=1}=t,f=KB++,c={time:0,delay:r,duration:n,rate:a,repeat:d};return this._setChannelTime(c,this.time),this.channels.set(f,c),f}removeChannel(t){this.channels.delete(t);for(const[r,n]of this.animations)n.channel===t&&this.detachAnimation(r)}isFinished(t){const r=this.channels.get(t);return r===void 0?!1:this.time>=r.delay+r.duration*r.repeat}getTime(t){if(t===void 0)return this.time;const r=this.channels.get(t);return r===void 0?-1:r.time}setTime(t){this.time=Math.max(0,t);const r=this.channels.values();for(const a of r)this._setChannelTime(a,this.time);const n=this.animations.values();for(const a of n){const{animation:d,channel:f}=a;d.setTime(this.getTime(f))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(t,r){const n=JB++;return this.animations.set(n,{animation:t,channel:r}),t.setTime(this.getTime(r)),n}detachAnimation(t){this.animations.delete(t)}update(t){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=t),this.setTime(this.time+(t-this.lastEngineTime)),this.lastEngineTime=t)}_setChannelTime(t,r){const n=r-t.delay,a=t.duration*t.repeat;n>=a?t.time=t.duration*t.rate:(t.time=Math.max(0,n)%t.duration,t.time*=t.rate)}}let QB=0;const tD={device:null,onAddHTML:()=>"",onInitialize:async()=>null,onRender:()=>{},onFinalize:()=>{},onError:e=>console.error(e),stats:oc.stats.get(`animation-loop-${QB++}`),useDevicePixels:!0,autoResizeViewport:!1,autoResizeDrawingBuffer:!1};class eD{device=null;canvas=null;props;animationProps=null;timeline=null;stats;cpuTime;gpuTime;frameRate;display;needsRedraw="initialized";_initialized=!1;_running=!1;_animationFrameId=null;_nextFramePromise=null;_resolveNextFrame=null;_cpuStartTime=0;constructor(t){if(this.props={...tD,...t},t=this.props,!t.device)throw new Error("No device provided");const{useDevicePixels:r=!0}=this.props;this.stats=t.stats||new sc({id:"animation-loop-stats"}),this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this.setProps({autoResizeViewport:t.autoResizeViewport,autoResizeDrawingBuffer:t.autoResizeDrawingBuffer,useDevicePixels:r}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}destroy(){this.stop(),this._setDisplay(null)}delete(){this.destroy()}setNeedsRedraw(t){return this.needsRedraw=this.needsRedraw||t,this}setProps(t){return"autoResizeViewport"in t&&(this.props.autoResizeViewport=t.autoResizeViewport||!1),"autoResizeDrawingBuffer"in t&&(this.props.autoResizeDrawingBuffer=t.autoResizeDrawingBuffer||!1),"useDevicePixels"in t&&(this.props.useDevicePixels=t.useDevicePixels||!1),this}async start(){if(this._running)return this;this._running=!0;try{let t;return this._initialized||(this._initialized=!0,await this._initDevice(),this._initialize(),await this.props.onInitialize(this._getAnimationProps())),this._running?(t!==!1&&(this._cancelAnimationFrame(),this._requestAnimationFrame()),this):null}catch(t){const r=t instanceof Error?t:new Error("Unknown error");throw this.props.onError(r),r}}stop(){return this._running&&(this.animationProps&&this.props.onFinalize(this.animationProps),this._cancelAnimationFrame(),this._nextFramePromise=null,this._resolveNextFrame=null,this._running=!1),this}redraw(){return this.device?.isLost?this:(this._beginFrameTimers(),this._setupFrame(),this._updateAnimationProps(),this._renderFrame(this._getAnimationProps()),this._clearNeedsRedraw(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endFrameTimers(),this)}attachTimeline(t){return this.timeline=t,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(t=>{this._resolveNextFrame=t})),this._nextFramePromise}async toDataURL(){if(this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.canvas instanceof HTMLCanvasElement)return this.canvas.toDataURL();throw new Error("OffscreenCanvas")}_initialize(){this._startEventHandling(),this._initializeAnimationProps(),this._updateAnimationProps(),this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_setDisplay(t){this.display&&(this.display.destroy(),this.display.animationLoop=null),t&&(t.animationLoop=this),this.display=t}_requestAnimationFrame(){this._running&&(this._animationFrameId=pR(this._animationFrame.bind(this)))}_cancelAnimationFrame(){this._animationFrameId!==null&&(_R(this._animationFrameId),this._animationFrameId=null)}_animationFrame(){this._running&&(this.redraw(),this._requestAnimationFrame())}_renderFrame(t){if(this.display){this.display._renderFrame(t);return}this.props.onRender(this._getAnimationProps()),this.device.submit()}_clearNeedsRedraw(){this.needsRedraw=!1}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_initializeAnimationProps(){if(!this.device)throw new Error("loop");this.animationProps={animationLoop:this,device:this.device,canvas:this.device?.canvasContext?.canvas,timeline:this.timeline,useDevicePixels:this.props.useDevicePixels,needsRedraw:!1,width:1,height:1,aspect:1,time:0,startTime:Date.now(),engineTime:0,tick:0,tock:0,_mousePosition:null}}_getAnimationProps(){if(!this.animationProps)throw new Error("animationProps");return this.animationProps}_updateAnimationProps(){if(!this.animationProps)return;const{width:t,height:r,aspect:n}=this._getSizeAndAspect();(t!==this.animationProps.width||r!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),n!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=t,this.animationProps.height=r,this.animationProps.aspect=n,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime}async _initDevice(){if(this.device=await this.props.device,!this.device)throw new Error("No device provided");this.canvas=this.device.canvasContext?.canvas||null}_createInfoDiv(){if(this.canvas&&this.props.onAddHTML){const t=document.createElement("div");document.body.appendChild(t),t.style.position="relative";const r=document.createElement("div");r.style.position="absolute",r.style.left="10px",r.style.bottom="10px",r.style.width="300px",r.style.background="white",this.canvas instanceof HTMLCanvasElement&&t.appendChild(this.canvas),t.appendChild(r);const n=this.props.onAddHTML(r);n&&(r.innerHTML=n)}}_getSizeAndAspect(){if(!this.device)return{width:1,height:1,aspect:1};const[t,r]=this.device?.canvasContext?.getPixelSize()||[1,1];let n=1;const a=this.device?.canvasContext?.canvas;return a&&a.clientHeight?n=a.clientWidth/a.clientHeight:t>0&&r>0&&(n=t/r),{width:t,height:r,aspect:n}}_resizeViewport(){this.props.autoResizeViewport&&this.device.gl&&this.device.gl.viewport(0,0,this.device.gl.drawingBufferWidth,this.device.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){this.props.autoResizeDrawingBuffer&&this.device?.canvasContext?.resize({useDevicePixels:this.props.useDevicePixels})}_beginFrameTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this.cpuTime.timeStart()}_endFrameTimers(){this.cpuTime.timeEnd()}_startEventHandling(){this.canvas&&(this.canvas.addEventListener("mousemove",this._onMousemove.bind(this)),this.canvas.addEventListener("mouseleave",this._onMouseleave.bind(this)))}_onMousemove(t){t instanceof MouseEvent&&(this._getAnimationProps()._mousePosition=[t.offsetX,t.offsetY])}_onMouseleave(t){this._getAnimationProps()._mousePosition=null}}class l1{id;userData={};topology;bufferLayout=[];vertexCount;indices;attributes;constructor(t){this.id=t.id||Jo("geometry"),this.topology=t.topology,this.indices=t.indices||null,this.attributes=t.attributes,this.vertexCount=t.vertexCount,this.bufferLayout=t.bufferLayout||[],this.indices&&tr(this.indices.usage===Fr.INDEX)}destroy(){this.indices?.destroy();for(const t of Object.values(this.attributes))t.destroy()}getVertexCount(){return this.vertexCount}getAttributes(){return this.attributes}getIndexes(){return this.indices}_calculateVertexCount(t){return t.byteLength/12}}function rD(e,t){if(t instanceof l1)return t;const r=iD(e,t),{attributes:n,bufferLayout:a}=sD(e,t);return new l1({topology:t.topology||"triangle-list",bufferLayout:a,vertexCount:t.vertexCount,indices:r,attributes:n})}function iD(e,t){if(!t.indices)return;const r=t.indices.value;return e.createBuffer({usage:Fr.INDEX,data:r})}function sD(e,t){const r=[],n={};for(const[d,f]of Object.entries(t.attributes)){let c=d;switch(d){case"POSITION":c="positions";break;case"NORMAL":c="normals";break;case"TEXCOORD_0":c="texCoords";break;case"COLOR_0":c="colors";break}n[c]=e.createBuffer({data:f.value,id:`${d}-buffer`});const{value:T,size:C,normalized:R}=f;r.push({name:c,format:cR(T,C,R)})}const a=t._calculateVertexCount(t.attributes,t.indices);return{attributes:n,bufferLayout:r,vertexCount:a}}class nD{modules;moduleUniforms;moduleBindings;moduleUniformsChanged;constructor(t){const r=af(Object.values(t).filter(n=>n.dependencies));for(const n of r)t[n.name]=n;te.log(1,"Creating ShaderInputs with modules",Object.keys(t))(),this.modules=t,this.moduleUniforms={},this.moduleBindings={};for(const[n,a]of Object.entries(t)){const d=n;this.moduleUniforms[d]=a.defaultUniforms||{},this.moduleBindings[d]={}}}destroy(){}setProps(t){for(const r of Object.keys(t)){const n=r,a=t[n],d=this.modules[n];if(!d){te.warn(`Module ${r} not found`)();continue}const f=this.moduleUniforms[n],c=this.moduleBindings[n],T=d.getUniforms?.(a,f)||a,{uniforms:C,bindings:R}=Pg(T);this.moduleUniforms[n]={...f,...C},this.moduleBindings[n]={...c,...R}}}getModules(){return Object.values(this.modules)}getUniformValues(){return this.moduleUniforms}getBindings(){const t={};for(const r of Object.values(this.moduleBindings))Object.assign(t,r);return t}getDebugTable(){const t={};for(const[r,n]of Object.entries(this.moduleUniforms))for(const[a,d]of Object.entries(n))t[`${r}.${a}`]={type:this.modules[r].uniformTypes?.[a],value:String(d)};return t}}class fm{static defaultProps={...ac.defaultProps};device;_hashCounter=0;_hashes={};_renderPipelineCache={};_computePipelineCache={};static getDefaultPipelineFactory(t){return t._lumaData.defaultPipelineFactory=t._lumaData.defaultPipelineFactory||new fm(t),t._lumaData.defaultPipelineFactory}constructor(t){this.device=t}createRenderPipeline(t){const r={...ac.defaultProps,...t},n=this._hashRenderPipeline(r);if(!this._renderPipelineCache[n]){const a=this.device.createRenderPipeline({...r,id:r.id?`${r.id}-cached`:void 0});a.hash=n,this._renderPipelineCache[n]={pipeline:a,useCount:0}}return this._renderPipelineCache[n].useCount++,this._renderPipelineCache[n].pipeline}createComputePipeline(t){const r={...pf.defaultProps,...t},n=this._hashComputePipeline(r);if(!this._computePipelineCache[n]){const a=this.device.createComputePipeline({...r,id:r.id?`${r.id}-cached`:void 0});a.hash=n,this._computePipelineCache[n]={pipeline:a,useCount:0}}return this._computePipelineCache[n].useCount++,this._computePipelineCache[n].pipeline}release(t){const r=t.hash,n=t instanceof pf?this._computePipelineCache:this._renderPipelineCache;n[r].useCount--,n[r].useCount===0&&(n[r].pipeline.destroy(),delete n[r])}_hashComputePipeline(t){return`${this._getHash(t.shader.source)}`}_hashRenderPipeline(t){const r=this._getHash(t.vs.source),n=t.fs?this._getHash(t.fs.source):0,a="-",d=this._getHash(JSON.stringify(t.bufferLayout));switch(this.device.type){case"webgl":return`${r}/${n}V${a}BL${d}`;default:const f=this._getHash(JSON.stringify(t.parameters));return`${r}/${n}V${a}T${t.topology}P${f}BL${d}`}}_getHash(t){return this._hashes[t]===void 0&&(this._hashes[t]=this._hashCounter++),this._hashes[t]}}class pm{static defaultProps={...hf.defaultProps};device;_cache={};static getDefaultShaderFactory(t){return t._lumaData.defaultShaderFactory||=new pm(t),t._lumaData.defaultShaderFactory}constructor(t){this.device=t}createShader(t){const r=this._hashShader(t);let n=this._cache[r];if(!n){const a=this.device.createShader({...t,id:t.id?`${t.id}-cached`:void 0});this._cache[r]=n={shader:a,useCount:0}}return n.useCount++,n.shader}release(t){const r=this._hashShader(t),n=this._cache[r];n&&(n.useCount--,n.useCount===0&&(delete this._cache[r],n.shader.destroy()))}_hashShader(t){return`${t.stage}:${t.source}`}}function oD(e,t){const r={},n="Values";if(e.attributes.length===0&&!e.varyings?.length)return{"No attributes or varyings":{[n]:"N/A"}};for(const a of e.attributes)if(a){const d=`${a.location} ${a.name}: ${a.type}`;r[`in ${d}`]={[n]:a.stepMode||"vertex"}}for(const a of e.varyings||[]){const d=`${a.location} ${a.name}`;r[`out ${d}`]={[n]:JSON.stringify(a.accessor)}}return r}let Ri=null,_m=null;function aD(e,{id:t,minimap:r,opaque:n,top:a="0",left:d="0",rgbaScale:f=1}){Ri||(Ri=document.createElement("canvas"),Ri.id=t,Ri.title=t,Ri.style.zIndex="100",Ri.style.position="absolute",Ri.style.top=a,Ri.style.left=d,Ri.style.border="blue 1px solid",Ri.style.transform="scaleY(-1)",document.body.appendChild(Ri),_m=Ri.getContext("2d")),(Ri.width!==e.width||Ri.height!==e.height)&&(Ri.width=e.width/2,Ri.height=e.height/2,Ri.style.width="400px",Ri.style.height="400px");const c=e.device.readPixelsToArrayWebGL(e),T=_m.createImageData(e.width,e.height),C=0;for(let R=0;R<c.length;R+=4)T.data[C+R+0]=c[R+0]*f,T.data[C+R+1]=c[R+1]*f,T.data[C+R+2]=c[R+2]*f,T.data[C+R+3]=n?255:c[R+3]*f;_m.putImageData(T,0,0)}const _c=2,lD=1e4;class ea{static defaultProps={...ac.defaultProps,source:null,vs:null,fs:null,id:"unnamed",handle:void 0,userData:{},defines:{},modules:[],moduleSettings:void 0,geometry:null,indexBuffer:null,attributes:{},constantAttributes:{},varyings:[],isInstanced:void 0,instanceCount:0,vertexCount:0,shaderInputs:void 0,pipelineFactory:void 0,shaderFactory:void 0,transformFeedback:void 0,shaderAssembler:Za.getDefaultShaderAssembler(),debugShaders:void 0,disableWarnings:void 0};device;id;source;vs;fs;pipelineFactory;shaderFactory;userData={};parameters;topology;bufferLayout;isInstanced=void 0;instanceCount=0;vertexCount;indexBuffer=null;bufferAttributes={};constantAttributes={};bindings={};uniforms={};vertexArray;transformFeedback=null;pipeline;shaderInputs;_uniformStore;_attributeInfos={};_gpuGeometry=null;_getModuleUniforms;props;_pipelineNeedsUpdate="newly created";_needsRedraw="initializing";_destroyed=!1;_lastDrawTimestamp=-1;constructor(t,r){this.props={...ea.defaultProps,...r},r=this.props,this.id=r.id||Jo("model"),this.device=t,Object.assign(this.userData,r.userData);const n=Object.fromEntries(this.props.modules?.map(c=>[c.name,c])||[]);this.setShaderInputs(r.shaderInputs||new nD(n));const a=cD(t),d=(this.props.modules?.length>0?this.props.modules:this.shaderInputs?.getModules())||[];if(this.device.type==="webgpu"&&this.props.source){this.props.shaderLayout||=QR(this.props.source);const{source:c,getUniforms:T}=this.props.shaderAssembler.assembleShader({platformInfo:a,...this.props,modules:d});this.source=c,this._getModuleUniforms=T}else{const{vs:c,fs:T,getUniforms:C}=this.props.shaderAssembler.assembleShaderPair({platformInfo:a,...this.props,modules:d});this.vs=c,this.fs=T,this._getModuleUniforms=C}this.vertexCount=this.props.vertexCount,this.instanceCount=this.props.instanceCount,this.topology=this.props.topology,this.bufferLayout=this.props.bufferLayout,this.parameters=this.props.parameters,r.geometry&&this.setGeometry(r.geometry),this.pipelineFactory=r.pipelineFactory||fm.getDefaultPipelineFactory(this.device),this.shaderFactory=r.shaderFactory||pm.getDefaultShaderFactory(this.device),this.pipeline=this._updatePipeline(),this.vertexArray=t.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry),"isInstanced"in r&&(this.isInstanced=r.isInstanced),r.instanceCount&&this.setInstanceCount(r.instanceCount),r.vertexCount&&this.setVertexCount(r.vertexCount),r.indexBuffer&&this.setIndexBuffer(r.indexBuffer),r.attributes&&this.setAttributes(r.attributes),r.constantAttributes&&this.setConstantAttributes(r.constantAttributes),r.bindings&&this.setBindings(r.bindings),r.uniforms&&this.setUniforms(r.uniforms),r.moduleSettings&&this.updateModuleSettings(r.moduleSettings),r.transformFeedback&&(this.transformFeedback=r.transformFeedback),Object.seal(this)}destroy(){this._destroyed||(this.pipelineFactory.release(this.pipeline),this.shaderFactory.release(this.pipeline.vs),this.pipeline.fs&&this.shaderFactory.release(this.pipeline.fs),this._uniformStore.destroy(),this._gpuGeometry?.destroy(),this._destroyed=!0)}needsRedraw(){this._getBindingsUpdateTimestamp()>this._lastDrawTimestamp&&this.setNeedsRedraw("contents of bound textures or buffers updated");const t=this._needsRedraw;return this._needsRedraw=!1,t}setNeedsRedraw(t){this._needsRedraw||=t}predraw(){this.updateShaderInputs(),this.pipeline=this._updatePipeline()}draw(t){this.predraw();let r;try{this._logDrawCallStart(),this.pipeline=this._updatePipeline(),this.pipeline.setBindings(this.bindings,{disableWarnings:this.props.disableWarnings}),lf(this.uniforms)||this.pipeline.setUniformsWebGL(this.uniforms);const{indexBuffer:n}=this.vertexArray,a=n?n.byteLength/(n.indexType==="uint32"?4:2):void 0;r=this.pipeline.draw({renderPass:t,vertexArray:this.vertexArray,isInstanced:this.isInstanced,vertexCount:this.vertexCount,instanceCount:this.instanceCount,indexCount:a,transformFeedback:this.transformFeedback||void 0,parameters:this.parameters,topology:this.topology})}finally{this._logDrawCallEnd()}return this._logFramebuffer(t),r?(this._lastDrawTimestamp=this.device.timestamp,this._needsRedraw=!1):this._needsRedraw="waiting for resource initialization",r}setGeometry(t){this._gpuGeometry?.destroy();const r=t&&rD(this.device,t);r&&(this.setTopology(r.topology||"triangle-list"),this.bufferLayout=c1(r.bufferLayout,this.bufferLayout),this.vertexArray&&this._setGeometryAttributes(r)),this._gpuGeometry=r}setTopology(t){t!==this.topology&&(this.topology=t,this._setPipelineNeedsUpdate("topology"))}setBufferLayout(t){this.bufferLayout=this._gpuGeometry?c1(t,this._gpuGeometry.bufferLayout):t,this._setPipelineNeedsUpdate("bufferLayout"),this.pipeline=this._updatePipeline(),this.vertexArray=this.device.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry)}setParameters(t){Bg(t,this.parameters,2)||(this.parameters=t,this._setPipelineNeedsUpdate("parameters"))}setInstanceCount(t){this.instanceCount=t,this.isInstanced===void 0&&t>0&&(this.isInstanced=!0),this.setNeedsRedraw("instanceCount")}setVertexCount(t){this.vertexCount=t,this.setNeedsRedraw("vertexCount")}setShaderInputs(t){this.shaderInputs=t,this._uniformStore=new lR(this.shaderInputs.modules);for(const r of Object.keys(this.shaderInputs.modules)){const n=this._uniformStore.getManagedUniformBuffer(this.device,r);this.bindings[`${r}Uniforms`]=n}this.setNeedsRedraw("shaderInputs")}updateShaderInputs(){this._uniformStore.setUniforms(this.shaderInputs.getUniformValues()),this.setBindings(this.shaderInputs.getBindings()),this.setNeedsRedraw("shaderInputs")}setBindings(t){Object.assign(this.bindings,t),this.setNeedsRedraw("bindings")}setTransformFeedback(t){this.transformFeedback=t,this.setNeedsRedraw("transformFeedback")}setIndexBuffer(t){this.vertexArray.setIndexBuffer(t),this.setNeedsRedraw("indexBuffer")}setAttributes(t,r){t.indices&&te.warn(`Model:${this.id} setAttributes() - indexBuffer should be set using setIndexBuffer()`)();for(const[n,a]of Object.entries(t)){const d=this.bufferLayout.find(T=>u1(T).includes(n));if(!d){te.warn(`Model(${this.id}): Missing layout for buffer "${n}".`)();continue}const f=u1(d);let c=!1;for(const T of f){const C=this._attributeInfos[T];C&&(this.vertexArray.setBuffer(C.location,a),c=!0)}!c&&!(r?.disableWarnings??this.props.disableWarnings)&&te.warn(`Model(${this.id}): Ignoring buffer "${a.id}" for unknown attribute "${n}"`)()}this.setNeedsRedraw("attributes")}setConstantAttributes(t,r){for(const[n,a]of Object.entries(t)){const d=this._attributeInfos[n];d?this.vertexArray.setConstantWebGL(d.location,a):(r?.disableWarnings??this.props.disableWarnings)||te.warn(`Model "${this.id}: Ignoring constant supplied for unknown attribute "${n}"`)()}this.setNeedsRedraw("constants")}setUniforms(t){lf(t)||(this.pipeline.setUniformsWebGL(t),Object.assign(this.uniforms,t)),this.setNeedsRedraw("uniforms")}updateModuleSettings(t){const{bindings:r,uniforms:n}=Pg(this._getModuleUniforms(t));Object.assign(this.bindings,r),Object.assign(this.uniforms,n),this.setNeedsRedraw("moduleSettings")}_getBindingsUpdateTimestamp(){let t=0;for(const r of Object.values(this.bindings))r instanceof uf?t=Math.max(t,r.texture.updateTimestamp):r instanceof Fr||r instanceof Is?t=Math.max(t,r.updateTimestamp):r instanceof df||(t=Math.max(t,r.buffer.updateTimestamp));return t}_setGeometryAttributes(t){const r={...t.attributes};for(const[n]of Object.entries(r))!this.pipeline.shaderLayout.attributes.find(a=>a.name===n)&&n!=="positions"&&delete r[n];this.vertexCount=t.vertexCount,this.setIndexBuffer(t.indices||null),this.setAttributes(t.attributes,{disableWarnings:!0}),this.setAttributes(r,{disableWarnings:this.props.disableWarnings}),this.setNeedsRedraw("geometry attributes")}_setPipelineNeedsUpdate(t){this._pipelineNeedsUpdate||=t,this.setNeedsRedraw(t)}_updatePipeline(){if(this._pipelineNeedsUpdate){let t=null,r=null;this.pipeline&&(te.log(1,`Model ${this.id}: Recreating pipeline because "${this._pipelineNeedsUpdate}".`)(),t=this.pipeline.vs,r=this.pipeline.fs),this._pipelineNeedsUpdate=!1;const n=this.shaderFactory.createShader({id:`${this.id}-vertex`,stage:"vertex",source:this.source||this.vs,debug:this.props.debugShaders});let a=null;this.source?a=n:this.fs&&(a=this.shaderFactory.createShader({id:`${this.id}-fragment`,stage:"fragment",source:this.source||this.fs,debug:this.props.debugShaders})),this.pipeline=this.pipelineFactory.createRenderPipeline({...this.props,bufferLayout:this.bufferLayout,topology:this.topology,parameters:this.parameters,vs:n,fs:a}),this._attributeInfos=Uv(this.pipeline.shaderLayout,this.bufferLayout),t&&this.shaderFactory.release(t),r&&this.shaderFactory.release(r)}return this.pipeline}_lastLogTime=0;_logOpen=!1;_logDrawCallStart(){const t=te.level>3?0:lD;te.level<2||Date.now()-this._lastLogTime<t||(this._lastLogTime=Date.now(),this._logOpen=!0,te.group(_c,`>>> DRAWING MODEL ${this.id}`,{collapsed:te.level<=2})())}_logDrawCallEnd(){if(this._logOpen){const t=oD(this.pipeline.shaderLayout,this.id);te.table(_c,t)();const r=this.shaderInputs.getDebugTable();for(const[a,d]of Object.entries(this.uniforms))r[a]={value:d};te.table(_c,r)();const n=this._getAttributeDebugTable();te.table(_c,this._attributeInfos)(),te.table(_c,n)(),te.groupEnd(_c)(),this._logOpen=!1}}_drawCount=0;_logFramebuffer(t){const r=te.get("framebuffer");if(this._drawCount++,!r||this._drawCount++>3&&this._drawCount%60)return;const n=t.props.framebuffer;n&&aD(n,{id:n.id,minimap:!0})}_getAttributeDebugTable(){const t={};for(const[r,n]of Object.entries(this._attributeInfos))t[n.location]={name:r,type:n.shaderType,values:this._getBufferOrConstantValues(this.vertexArray.attributes[n.location],n.bufferDataType)};if(this.vertexArray.indexBuffer){const{indexBuffer:r}=this.vertexArray,n=r.indexType==="uint32"?new Uint32Array(r.debugData):new Uint16Array(r.debugData);t.indices={name:"indices",type:r.indexType,values:n.toString()}}return t}_getBufferOrConstantValues(t,r){const n=Hv(r);return(t instanceof Fr?new n(t.debugData):t).toString()}}function c1(e,t){const r=[...e];for(const n of t){const a=r.findIndex(d=>d.name===n.name);a<0?r.push(n):r[a]=n}return r}function cD(e){return{type:e.type,shaderLanguage:e.info.shadingLanguage,shaderLanguageVersion:e.info.shadingLanguageVersion,gpu:e.info.gpu,features:e.features}}function u1(e){return e.attributes?e.attributes?.map(t=>t.attribute):[e.name]}class gh{device;model;transformFeedback;static isSupported(t){return t?.info?.type==="webgl"}constructor(t,r=ea.defaultProps){tr(gh.isSupported(t),"BufferTransform not yet implemented on WebGPU"),this.device=t,this.model=new ea(this.device,{id:r.id||"buffer-transform-model",fs:r.fs||uM(),topology:r.topology||"point-list",...r}),this.transformFeedback=this.device.createTransformFeedback({layout:this.model.pipeline.shaderLayout,buffers:r.feedbackBuffers}),this.model.setTransformFeedback(this.transformFeedback),Object.seal(this)}destroy(){this.model&&this.model.destroy()}delete(){this.destroy()}run(t){const r=this.device.beginRenderPass(t);this.model.draw(r),r.end()}update(...t){console.warn("TextureTransform#update() not implemented")}getBuffer(t){return this.transformFeedback.getBuffer(t)}readAsync(t){const r=this.getBuffer(t);if(r instanceof Fr)return r.readAsync();const{buffer:n,byteOffset:a=0,byteLength:d=n.byteLength}=r;return n.readAsync(a,d)}}class gc{id;topology;vertexCount;indices;attributes;userData={};constructor(t){const{attributes:r={},indices:n=null,vertexCount:a=null}=t;this.id=t.id||Jo("geometry"),this.topology=t.topology,n&&(this.indices=ArrayBuffer.isView(n)?{value:n,size:1}:n),this.attributes={};for(const[d,f]of Object.entries(r)){const c=ArrayBuffer.isView(f)?{value:f}:f;tr(ArrayBuffer.isView(c.value),`${this._print(d)}: must be typed array or object with value as typed array`),(d==="POSITION"||d==="positions")&&!c.size&&(c.size=3),d==="indices"?(tr(!this.indices),this.indices=c):this.attributes[d]=c}this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this.vertexCount=a||this._calculateVertexCount(this.attributes,this.indices)}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(t){return`Geometry ${this.id} attribute ${t}`}_setAttributes(t,r){return this}_calculateVertexCount(t,r){if(r)return r.value.length;let n=1/0;for(const a of Object.values(t)){const{value:d,size:f,constant:c}=a;!c&&d&&f>=1&&(n=Math.min(n,d.length/f))}return tr(Number.isFinite(n)),n}}class Of{id;matrix=new He;display=!0;position=new Bt;rotation=new Bt;scale=new Bt(1,1,1);userData={};props={};constructor(t={}){const{id:r}=t;this.id=r||Jo(this.constructor.name),this._setScenegraphNodeProps(t)}getBounds(){return null}destroy(){}delete(){this.destroy()}setProps(t){return this._setScenegraphNodeProps(t),this}toString(){return`{type: ScenegraphNode, id: ${this.id})}`}setPosition(t){return tr(t.length===3,"setPosition requires vector argument"),this.position=t,this}setRotation(t){return tr(t.length===3,"setRotation requires vector argument"),this.rotation=t,this}setScale(t){return tr(t.length===3,"setScale requires vector argument"),this.scale=t,this}setMatrix(t,r=!0){r?this.matrix.copy(t):this.matrix=t}setMatrixComponents(t){const{position:r,rotation:n,scale:a,update:d=!0}=t;return r&&this.setPosition(r),n&&this.setRotation(n),a&&this.setScale(a),d&&this.updateMatrix(),this}updateMatrix(){const t=this.position,r=this.rotation,n=this.scale;return this.matrix.identity(),this.matrix.translate(t),this.matrix.rotateXYZ(r),this.matrix.scale(n),this}update(t={}){const{position:r,rotation:n,scale:a}=t;return r&&this.setPosition(r),n&&this.setRotation(n),a&&this.setScale(a),this.updateMatrix(),this}getCoordinateUniforms(t,r){tr(t),r=r||this.matrix;const n=new He(t).multiplyRight(r),a=n.invert(),d=a.transpose();return{viewMatrix:t,modelMatrix:r,objectMatrix:r,worldMatrix:n,worldInverseMatrix:a,worldInverseTransposeMatrix:d}}_setScenegraphNodeProps(t){"display"in t&&(this.display=t.display),"position"in t&&this.setPosition(t.position),"rotation"in t&&this.setRotation(t.rotation),"scale"in t&&this.setScale(t.scale),"matrix"in t&&this.setMatrix(t.matrix),Object.assign(this.props,t)}}class mc extends Of{children;constructor(t={}){t=Array.isArray(t)?{children:t}:t;const{children:r=[]}=t;te.assert(r.every(n=>n instanceof Of),"every child must an instance of ScenegraphNode"),super(t),this.children=r}getBounds(){const t=[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]];return this.traverse((r,{worldMatrix:n})=>{const a=r.getBounds();if(!a)return;const[d,f]=a,c=new Bt(d).add(f).divide([2,2,2]);n.transformAsPoint(c,c);const T=new Bt(f).subtract(d).divide([2,2,2]);n.transformAsVector(T,T);for(let C=0;C<8;C++){const R=new Bt(C&1?-1:1,C&2?-1:1,C&4?-1:1).multiply(T).add(c);for(let L=0;L<3;L++)t[0][L]=Math.min(t[0][L],R[L]),t[1][L]=Math.max(t[1][L],R[L])}}),Number.isFinite(t[0][0])?t:null}destroy(){this.children.forEach(t=>t.destroy()),this.removeAll(),super.destroy()}add(...t){for(const r of t)Array.isArray(r)?this.add(...r):this.children.push(r);return this}remove(t){const r=this.children,n=r.indexOf(t);return n>-1&&r.splice(n,1),this}removeAll(){return this.children=[],this}traverse(t,{worldMatrix:r=new He}={}){const n=new He(r).multiplyRight(this.matrix);for(const a of this.children)a instanceof mc?a.traverse(t,{worldMatrix:n}):t(a,{worldMatrix:n})}}class gm extends Of{model;bounds=null;managedResources;constructor(t){super(t),this.model=t.model,this.managedResources=t.managedResources||[],this.bounds=t.bounds||null,this.setProps(t)}getBounds(){return this.bounds}destroy(){this.model&&(this.model.destroy(),this.model=null),this.managedResources.forEach(t=>t.destroy()),this.managedResources=[]}draw(t){return this.model.draw(t)}}const uD={blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"zero",blendAlphaOperation:"add",blendAlphaSrcFactor:"constant-alpha",blendAlphaDstFactor:"zero"};class h1 extends um{constructor(){super(...arguments),this._colorEncoderState=null}render(t){return"pickingFBO"in t?this._drawPickingBuffer(t):super.render(t)}_drawPickingBuffer({layers:t,layerFilter:r,views:n,viewports:a,onViewportActive:d,pickingFBO:f,deviceRect:{x:c,y:T,width:C,height:R},cullRect:L,effects:V,pass:X="picking",pickZ:at,moduleParameters:nt}){this.pickZ=at;const K=this._resetColorEncoder(at),It=[c,T,C,R],St=super.render({target:f,layers:t,layerFilter:r,views:n,viewports:a,onViewportActive:d,cullRect:L,effects:V?.filter(Ht=>Ht.useInPicking),pass:X,isPicking:!0,moduleParameters:nt,clearColor:[0,0,0,0],colorMask:15,scissorRect:It});return this._colorEncoderState=null,{decodePickingColor:K&&dD.bind(null,K),stats:St}}shouldDrawLayer(t){const{pickable:r,operation:n}=t.props;return r&&n.includes("draw")||n.includes("terrain")||n.includes("mask")}getModuleParameters(){return{picking:{isActive:1,isAttribute:this.pickZ},lightSources:{}}}getLayerParameters(t,r,n){const a={depthMask:!0,depthTest:!0,depthRange:[0,1],...t.props.parameters},{pickable:d,operation:f}=t.props;return!this._colorEncoderState||f.includes("terrain")?a.blend=!1:d&&f.includes("draw")&&(Object.assign(a,uD),a.blend=!0,a.blendColor=hD(this._colorEncoderState,t,n)),a}_resetColorEncoder(t){return this._colorEncoderState=t?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function hD(e,t,r){const{byLayer:n,byAlpha:a}=e;let d,f=n.get(t);return f?(f.viewports.push(r),d=f.a):(d=n.size+1,d<=255?(f={a:d,layer:t,viewports:[r]},n.set(t,f),a[d]=f):(Ye.warn("Too many pickable layers, only picking the first 255")(),d=0)),[0,0,0,d/255]}function dD(e,t){const r=e.byAlpha[t[3]];return r&&{pickedLayer:r.layer,pickedViewports:r.viewports,pickedObjectIndex:r.layer.decodePickingColor(t)}}const yc={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},kf=Symbol.for("component"),ra=Symbol.for("propTypes"),mm=Symbol.for("deprecatedProps"),bc=Symbol.for("asyncPropDefaults"),el=Symbol.for("asyncPropOriginal"),ia=Symbol.for("asyncPropResolved");function vc(e,t=()=>!0){return Array.isArray(e)?d1(e,t,[]):t(e)?[e]:[]}function d1(e,t,r){let n=-1;for(;++n<e.length;){const a=e[n];Array.isArray(a)?d1(a,t,r):t(a)&&r.push(a)}return r}function fD({target:e,source:t,start:r=0,count:n=1}){const a=t.length,d=n*a;let f=0;for(let c=r;f<a;f++)e[c++]=t[f];for(;f<d;)f<d-f?(e.copyWithin(r+f,r,r+f),f*=2):(e.copyWithin(r+f,r,r+d-f),f=d);return e}class pD{constructor(t,r,n){this._loadCount=0,this._subscribers=new Set,this.id=t,this.context=n,this.setData(r)}subscribe(t){this._subscribers.add(t)}unsubscribe(t){this._subscribers.delete(t)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(t,r){if(t===this._data&&!r)return;this._data=t;const n=++this._loadCount;let a=t;typeof t=="string"&&(a=Ko(t)),a instanceof Promise?(this.isLoaded=!1,this._loader=a.then(d=>{this._loadCount===n&&(this.isLoaded=!0,this._error=void 0,this._content=d)}).catch(d=>{this._loadCount===n&&(this.isLoaded=!0,this._error=d||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=t);for(const d of this._subscribers)d.onChange(this.getData())}}class _D{constructor(t){this.protocol=t.protocol||"resource://",this._context={device:t.device,gl:t.device?.gl,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(t){return t.startsWith(this.protocol)?!0:t in this._resources}add({resourceId:t,data:r,forceUpdate:n=!1,persistent:a=!0}){let d=this._resources[t];d?d.setData(r,n):(d=new pD(t,r,this._context),this._resources[t]=d),d.persistent=a}remove(t){const r=this._resources[t];r&&(r.delete(),delete this._resources[t])}unsubscribe({consumerId:t}){const r=this._consumers[t];if(r){for(const n in r){const a=r[n],d=this._resources[a.resourceId];d&&d.unsubscribe(a)}delete this._consumers[t],this.prune()}}subscribe({resourceId:t,onChange:r,consumerId:n,requestId:a="default"}){const{_resources:d,protocol:f}=this;t.startsWith(f)&&(t=t.replace(f,""),d[t]||this.add({resourceId:t,data:null,persistent:!1}));const c=d[t];if(this._track(n,a,c,r),c)return c.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const t in this._resources)this._resources[t].delete()}_track(t,r,n,a){const d=this._consumers,f=d[t]=d[t]||{};let c=f[r];const T=c&&c.resourceId&&this._resources[c.resourceId];T&&(T.unsubscribe(c),this.prune()),n&&(c?(c.onChange=a,c.resourceId=n.id):c={onChange:a,resourceId:n.id},f[r]=c,n.subscribe(c))}_prune(){this._pruneRequest=null;for(const t of Object.keys(this._resources)){const r=this._resources[t];!r.persistent&&!r.inUse()&&(r.delete(),delete this._resources[t])}}}const gD="layerManager.setLayers",mD="layerManager.activateViewport";class yD{constructor(t,r){this._lastRenderedLayers=[],this._needsRedraw=!1,this._needsUpdate=!1,this._nextLayers=null,this._debug=!1,this._defaultShaderModulesChanged=!1,this.activateViewport=c=>{Yi(mD,this,c),c&&(this.context.viewport=c)};const{deck:n,stats:a,viewport:d,timeline:f}=r||{};this.layers=[],this.resourceManager=new _D({device:t,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,device:t,gl:t?.gl,deck:n,shaderAssembler:SB(),defaultShaderModules:[],renderPass:void 0,stats:a||new sc({id:"deck.gl"}),viewport:d||new _h({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:f||new a1,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const t of this.layers)this._finalizeLayer(t)}needsRedraw(t={clearRedrawFlags:!1}){let r=this._needsRedraw;t.clearRedrawFlags&&(this._needsRedraw=!1);for(const n of this.layers){const a=n.getNeedsRedraw(t);r=r||a}return r}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._defaultShaderModulesChanged?"shader modules changed":this._needsUpdate}setNeedsRedraw(t){this._needsRedraw=this._needsRedraw||t}setNeedsUpdate(t){this._needsUpdate=this._needsUpdate||t}getLayers({layerIds:t}={}){return t?this.layers.filter(r=>t.find(n=>r.id.indexOf(n)===0)):this.layers}setProps(t){"debug"in t&&(this._debug=t.debug),"userData"in t&&(this.context.userData=t.userData),"layers"in t&&(this._nextLayers=t.layers),"onError"in t&&(this.context.onError=t.onError)}setLayers(t,r){Yi(gD,this,r,t),this._lastRenderedLayers=t;const n=vc(t,Boolean);for(const a of n)a.context=this.context;this._updateLayers(this.layers,n)}updateLayers(){const t=this.needsUpdate();t&&(this.setNeedsRedraw(`updating layers: ${t}`),this.setLayers(this._nextLayers||this._lastRenderedLayers,t)),this._nextLayers=null}addDefaultShaderModule(t){const{defaultShaderModules:r}=this.context;r.find(n=>n.name===t.name)||(r.push(t),this._defaultShaderModulesChanged=!0)}removeDefaultShaderModule(t){const{defaultShaderModules:r}=this.context,n=r.findIndex(a=>a.name===t.name);n>=0&&(r.splice(n,1),this._defaultShaderModulesChanged=!0)}_handleError(t,r,n){n.raiseError(r,`${t} of ${n}`)}_updateLayers(t,r){const n={};for(const f of t)n[f.id]?Ye.warn(`Multiple old layers with same id ${f.id}`)():n[f.id]=f;if(this._defaultShaderModulesChanged){for(const f of t)f.setNeedsUpdate(),f.setChangeFlags({extensionsChanged:!0});this._defaultShaderModulesChanged=!1}const a=[];this._updateSublayersRecursively(r,n,a),this._finalizeOldLayers(n);let d=!1;for(const f of a)if(f.hasUniformTransition()){d=`Uniform transition in ${f}`;break}this._needsUpdate=d,this.layers=a}_updateSublayersRecursively(t,r,n){for(const a of t){a.context=this.context;const d=r[a.id];d===null&&Ye.warn(`Multiple new layers with same id ${a.id}`)(),r[a.id]=null;let f=null;try{this._debug&&d!==a&&a.validateProps(),d?(this._transferLayerState(d,a),this._updateLayer(a)):this._initializeLayer(a),n.push(a),f=a.isComposite?a.getSubLayers():null}catch(c){this._handleError("matching",c,a)}f&&this._updateSublayersRecursively(f,r,n)}}_finalizeOldLayers(t){for(const r in t){const n=t[r];n&&this._finalizeLayer(n)}}_initializeLayer(t){try{t._initialize(),t.lifecycle=yc.INITIALIZED}catch(r){this._handleError("initialization",r,t)}}_transferLayerState(t,r){r._transferState(t),r.lifecycle=yc.MATCHED,r!==t&&(t.lifecycle=yc.AWAITING_GC)}_updateLayer(t){try{t._update()}catch(r){this._handleError("update",r,t)}}_finalizeLayer(t){this._needsRedraw=this._needsRedraw||`finalized ${t}`,t.lifecycle=yc.AWAITING_FINALIZATION;try{t._finalize(),t.lifecycle=yc.FINALIZED}catch(r){this._handleError("finalization",r,t)}}}function Sn(e,t,r){if(e===t)return!0;if(!r||!e||!t)return!1;if(Array.isArray(e)){if(!Array.isArray(t)||e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(!Sn(e[n],t[n],r-1))return!1;return!0}if(Array.isArray(t))return!1;if(typeof e=="object"&&typeof t=="object"){const n=Object.keys(e),a=Object.keys(t);if(n.length!==a.length)return!1;for(const d of n)if(!t.hasOwnProperty(d)||!Sn(e[d],t[d],r-1))return!1;return!0}return!1}class bD{constructor(t){this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=t.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=t.eventManager,this._eventCallbacks={onViewStateChange:t.onViewStateChange,onInteractionStateChange:t.onInteractionStateChange},Object.seal(this),this.setProps(t)}finalize(){for(const t in this.controllers){const r=this.controllers[t];r&&r.finalize()}this.controllers={}}needsRedraw(t={clearRedrawFlags:!1}){const r=this._needsRedraw;return t.clearRedrawFlags&&(this._needsRedraw=!1),r}setNeedsUpdate(t){this._needsUpdate=this._needsUpdate||t,this._needsRedraw=this._needsRedraw||t}updateViewStates(){for(const t in this.controllers){const r=this.controllers[t];r&&r.updateTransition()}}getViewports(t){return t?this._viewports.filter(r=>r.containsPixel(t)):this._viewports}getViews(){const t={};return this.views.forEach(r=>{t[r.id]=r}),t}getView(t){return this.views.find(r=>r.id===t)}getViewState(t){const r=typeof t=="string"?this.getView(t):t,n=r&&this.viewState[r.getViewStateId()]||this.viewState;return r?r.filterViewState(n):n}getViewport(t){return this._viewportMap[t]}unproject(t,r){const n=this.getViewports(),a={x:t[0],y:t[1]};for(let d=n.length-1;d>=0;--d){const f=n[d];if(f.containsPixel(a)){const c=t.slice();return c[0]-=f.x,c[1]-=f.y,f.unproject(c,r)}}return null}setProps(t){t.views&&this._setViews(t.views),t.viewState&&this._setViewState(t.viewState),("width"in t||"height"in t)&&this._setSize(t.width,t.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(t,r){(t!==this.width||r!==this.height)&&(this.width=t,this.height=r,this.setNeedsUpdate("Size changed"))}_setViews(t){t=vc(t,Boolean),this._diffViews(t,this.views)&&this.setNeedsUpdate("views changed"),this.views=t}_setViewState(t){t?(!Sn(t,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=t):Ye.warn("missing `viewState` or `initialViewState`")()}_createController(t,r){const n=r.type;return new n({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._eventCallbacks.onViewStateChange,onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:d=>this.getView(t.id)?.makeViewport({viewState:d,width:this.width,height:this.height})})}_updateController(t,r,n,a){const d=t.controller;if(d&&n){const f={...r,...d,id:t.id,x:n.x,y:n.y,width:n.width,height:n.height};return(!a||a.constructor!==d.type)&&(a=this._createController(t,f)),a&&a.setProps(f),a}return null}_rebuildViewports(){const{views:t}=this,r=this.controllers;this._viewports=[],this.controllers={};let n=!1;for(let a=t.length;a--;){const d=t[a],f=this.getViewState(d),c=d.makeViewport({viewState:f,width:this.width,height:this.height});let T=r[d.id];const C=!!d.controller;C&&!T&&(n=!0),(n||!C)&&T&&(T.finalize(),T=null),this.controllers[d.id]=this._updateController(d,f,c,T),c&&this._viewports.unshift(c)}for(const a in r){const d=r[a];d&&!this.controllers[a]&&d.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(t=>{t.id&&(this._viewportMap[t.id]=this._viewportMap[t.id]||t)})}_diffViews(t,r){return t.length!==r.length?!0:t.some((n,a)=>!t[a].equals(r[a]))}}const vD=/([0-9]+\.?[0-9]*)(%|px)/;function sa(e){switch(typeof e){case"number":return{position:e,relative:!1};case"string":const t=vD.exec(e);if(t&&t.length>=3){const r=t[2]==="%",n=parseFloat(t[1]);return{position:r?n/100:n,relative:r}}default:throw new Error(`Could not parse position string ${e}`)}}function na(e,t){return e.relative?Math.round(e.position*t):e.position}class xD{constructor(t){const{id:r,x:n=0,y:a=0,width:d="100%",height:f="100%",padding:c=null}=t;this.id=r||this.constructor.displayName||"view",this.props={...t,id:this.id},this._x=sa(n),this._y=sa(a),this._width=sa(d),this._height=sa(f),this._padding=c&&{left:sa(c.left||0),right:sa(c.right||0),top:sa(c.top||0),bottom:sa(c.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(t){return this===t?!0:this.ViewportType===t.ViewportType&&Sn(this.props,t.props,2)}makeViewport({width:t,height:r,viewState:n}){n=this.filterViewState(n);const a=this.getDimensions({width:t,height:r});return!a.height||!a.width?null:new this.ViewportType({...n,...this.props,...a})}getViewStateId(){const{viewState:t}=this.props;return typeof t=="string"?t:t?.id||this.id}filterViewState(t){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const r={...t};for(const n in this.props.viewState)n!=="id"&&(r[n]=this.props.viewState[n]);return r}return t}getDimensions({width:t,height:r}){const n={x:na(this._x,t),y:na(this._y,r),width:na(this._width,t),height:na(this._height,r)};return this._padding&&(n.padding={left:na(this._padding.left,t),top:na(this._padding.top,r),right:na(this._padding.right,t),bottom:na(this._padding.bottom,r)}),n}get controller(){const t=this.props.controller;return t?t===!0?{type:this.ControllerType}:typeof t=="function"?{type:t}:{type:this.ControllerType,...t}:null}}class Nf{constructor(t){this._inProgress=!1,this._handle=null,this.time=0,this.settings={duration:0},this._timeline=t}get inProgress(){return this._inProgress}start(t){this.cancel(),this.settings=t,this._inProgress=!0,this.settings.onStart?.(this)}end(){this._inProgress&&(this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,this.settings.onEnd?.(this))}cancel(){this._inProgress&&(this.settings.onInterrupt?.(this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1)}update(){if(!this._inProgress)return!1;if(this._handle===null){const{_timeline:t,settings:r}=this;this._handle=t.addChannel({delay:t.getTime(),duration:r.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),this.settings.onUpdate?.(this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const f1=()=>{},ym={BREAK:1,SNAP_TO_END:2,IGNORE:3},wD=e=>e,TD=ym.BREAK;class AD{constructor(t){this._onTransitionUpdate=r=>{const{time:n,settings:{interpolator:a,startProps:d,endProps:f,duration:c,easing:T}}=r,C=T(n/c),R=a.interpolateProps(d,f,C);this.propsInTransition=this.getControllerState({...this.props,...R}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})},this.getControllerState=t.getControllerState,this.propsInTransition=null,this.transition=new Nf(t.timeline),this.onViewStateChange=t.onViewStateChange||f1,this.onStateChange=t.onStateChange||f1}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(t){let r=!1;const n=this.props;if(this.props=t,!n||this._shouldIgnoreViewportChange(n,t))return!1;if(this._isTransitionEnabled(t)){let a=n;if(this.transition.inProgress){const{interruption:d,endProps:f}=this.transition.settings;a={...n,...d===ym.SNAP_TO_END?f:this.propsInTransition||n}}this._triggerTransition(a,t),r=!0}else this.transition.cancel();return r}updateTransition(){this.transition.update()}_isTransitionEnabled(t){const{transitionDuration:r,transitionInterpolator:n}=t;return(r>0||r==="auto")&&!!n}_isUpdateDueToCurrentTransition(t){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(t,this.propsInTransition):!1}_shouldIgnoreViewportChange(t,r){return this.transition.inProgress?this.transition.settings.interruption===ym.IGNORE||this._isUpdateDueToCurrentTransition(r):this._isTransitionEnabled(r)?r.transitionInterpolator.arePropsEqual(t,r):!0}_triggerTransition(t,r){const n=this.getControllerState(t),a=this.getControllerState(r).shortestPathFrom(n),d=r.transitionInterpolator,f=d.getDuration?d.getDuration(t,r):r.transitionDuration;if(f===0)return;const c=d.initializeProps(t,a);this.propsInTransition={};const T={duration:f,easing:r.transitionEasing||wD,interpolator:d,interruption:r.transitionInterruption||TD,startProps:c.start,endProps:c.end,onStart:r.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(r.onTransitionInterrupt),onEnd:this._onTransitionEnd(r.onTransitionEnd)};this.transition.start(T),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(t){return r=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),t?.(r)}}}function bi(e,t){if(!e)throw new Error(t||"deck.gl: assertion failed.")}class ED{constructor(t){const{compare:r,extract:n,required:a}=t;this._propsToCompare=r,this._propsToExtract=n||r,this._requiredProps=a}arePropsEqual(t,r){for(const n of this._propsToCompare)if(!(n in t)||!(n in r)||!wn(t[n],r[n]))return!1;return!0}initializeProps(t,r){const n={},a={};for(const d of this._propsToExtract)(d in t||d in r)&&(n[d]=t[d],a[d]=r[d]);return this._checkRequiredProps(n),this._checkRequiredProps(a),{start:n,end:a}}getDuration(t,r){return r.transitionDuration}_checkRequiredProps(t){this._requiredProps&&this._requiredProps.forEach(r=>{const n=t[r];bi(Number.isFinite(n)||Array.isArray(n),`${r} is required for transition`)})}}const SD=["longitude","latitude","zoom","bearing","pitch"],CD=["longitude","latitude","zoom"];class p1 extends ED{constructor(t={}){const r=Array.isArray(t)?t:t.transitionProps,n=Array.isArray(t)?{}:t;n.transitionProps=Array.isArray(r)?{compare:r,required:r}:r||{compare:SD,required:CD},super(n.transitionProps),this.opts=n}initializeProps(t,r){const n=super.initializeProps(t,r),{makeViewport:a,around:d}=this.opts;if(a&&d){const f=a(t),c=a(r),T=f.unproject(d);n.start.around=d,Object.assign(n.end,{around:c.project(T),aroundPosition:T,width:r.width,height:r.height})}return n}interpolateProps(t,r,n){const a={};for(const d of this._propsToExtract)a[d]=xf(t[d]||0,r[d]||0,n);if(r.aroundPosition&&this.opts.makeViewport){const d=this.opts.makeViewport({...r,...a});Object.assign(a,d.panByPosition(r.aroundPosition,xf(t.around,r.around,n)))}return a}}const oa={transitionDuration:0},ID=300,Lf=e=>1-(1-e)*(1-e),xc={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],TRIPLE_PAN:["tripanstart","tripanmove","tripanend"],DOUBLE_TAP:["doubletap"],KEYBOARD:["keydown"]},rl={};class MD{constructor(t){this.state={},this._events={},this._interactionState={isDragging:!1},this._customEvents=[],this._eventStartBlocked=null,this._panMove=!1,this.invertPan=!1,this.dragMode="rotate",this.inertia=0,this.scrollZoom=!0,this.dragPan=!0,this.dragRotate=!0,this.doubleClickZoom=!0,this.touchZoom=!0,this.touchRotate=!1,this.keyboard=!0,this.transitionManager=new AD({...t,getControllerState:r=>new this.ControllerState(r),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=t.eventManager,this.onViewStateChange=t.onViewStateChange||(()=>{}),this.onStateChange=t.onStateChange||(()=>{}),this.makeViewport=t.makeViewport}set events(t){this.toggleEvents(this._customEvents,!1),this.toggleEvents(t,!0),this._customEvents=t,this.props&&this.setProps(this.props)}finalize(){for(const t in this._events)this._events[t]&&this.eventManager?.off(t,this.handleEvent);this.transitionManager.finalize()}handleEvent(t){this._controllerState=void 0;const r=this._eventStartBlocked;switch(t.type){case"panstart":return r?!1:this._onPanStart(t);case"panmove":return this._onPan(t);case"panend":return this._onPanEnd(t);case"pinchstart":return r?!1:this._onPinchStart(t);case"pinchmove":return this._onPinch(t);case"pinchend":return this._onPinchEnd(t);case"tripanstart":return r?!1:this._onTriplePanStart(t);case"tripanmove":return this._onTriplePan(t);case"tripanend":return this._onTriplePanEnd(t);case"doubletap":return this._onDoubleTap(t);case"wheel":return this._onWheel(t);case"keydown":return this._onKeyDown(t);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(t){const{x:r,y:n}=this.props,{offsetCenter:a}=t;return[a.x-r,a.y-n]}isPointInBounds(t,r){const{width:n,height:a}=this.props;if(r&&r.handled)return!1;const d=t[0]>=0&&t[0]<=n&&t[1]>=0&&t[1]<=a;return d&&r&&r.stopPropagation(),d}isFunctionKeyPressed(t){const{srcEvent:r}=t;return!!(r.metaKey||r.altKey||r.ctrlKey||r.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(t){const r=setTimeout(()=>{this._eventStartBlocked===r&&(this._eventStartBlocked=null)},t);this._eventStartBlocked=r}setProps(t){t.dragMode&&(this.dragMode=t.dragMode),this.props=t,"transitionInterpolator"in t||(t.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(t);const{inertia:r}=t;this.inertia=Number.isFinite(r)?r:r===!0?ID:0;const{scrollZoom:n=!0,dragPan:a=!0,dragRotate:d=!0,doubleClickZoom:f=!0,touchZoom:c=!0,touchRotate:T=!1,keyboard:C=!0}=t,R=!!this.onViewStateChange;this.toggleEvents(xc.WHEEL,R&&n),this.toggleEvents(xc.PAN,R),this.toggleEvents(xc.PINCH,R&&(c||T)),this.toggleEvents(xc.TRIPLE_PAN,R&&T),this.toggleEvents(xc.DOUBLE_TAP,R&&f),this.toggleEvents(xc.KEYBOARD,R&&C),this.scrollZoom=n,this.dragPan=a,this.dragRotate=d,this.doubleClickZoom=f,this.touchZoom=c,this.touchRotate=T,this.keyboard=C}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(t,r){this.eventManager&&t.forEach(n=>{this._events[n]!==r&&(this._events[n]=r,r?this.eventManager.on(n,this.handleEvent):this.eventManager.off(n,this.handleEvent))})}updateViewport(t,r=null,n={}){const a={...t.getViewportProps(),...r},d=this.controllerState!==t;if(this.state=t.getState(),this._setInteractionState(n),d){const f=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:a,interactionState:this._interactionState,oldViewState:f,viewId:this.props.id})}}_onTransition(t){this.onViewStateChange({...t,interactionState:this._interactionState,viewId:this.props.id})}_setInteractionState(t){Object.assign(this._interactionState,t),this.onStateChange(this._interactionState)}_onPanStart(t){const r=this.getCenter(t);if(!this.isPointInBounds(r,t))return!1;let n=this.isFunctionKeyPressed(t)||t.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(n=!n);const a=this.controllerState[n?"panStart":"rotateStart"]({pos:r});return this._panMove=n,this.updateViewport(a,oa,{isDragging:!0}),!0}_onPan(t){return this.isDragging()?this._panMove?this._onPanMove(t):this._onPanRotate(t):!1}_onPanEnd(t){return this.isDragging()?this._panMove?this._onPanMoveEnd(t):this._onPanRotateEnd(t):!1}_onPanMove(t){if(!this.dragPan)return!1;const r=this.getCenter(t),n=this.controllerState.pan({pos:r});return this.updateViewport(n,oa,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(t){const{inertia:r}=this;if(this.dragPan&&r&&t.velocity){const n=this.getCenter(t),a=[n[0]+t.velocityX*r/2,n[1]+t.velocityY*r/2],d=this.controllerState.pan({pos:a}).panEnd();this.updateViewport(d,{...this._getTransitionProps(),transitionDuration:r,transitionEasing:Lf},{isDragging:!1,isPanning:!0})}else{const n=this.controllerState.panEnd();this.updateViewport(n,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(t){if(!this.dragRotate)return!1;const r=this.getCenter(t),n=this.controllerState.rotate({pos:r});return this.updateViewport(n,oa,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(t){const{inertia:r}=this;if(this.dragRotate&&r&&t.velocity){const n=this.getCenter(t),a=[n[0]+t.velocityX*r/2,n[1]+t.velocityY*r/2],d=this.controllerState.rotate({pos:a}).rotateEnd();this.updateViewport(d,{...this._getTransitionProps(),transitionDuration:r,transitionEasing:Lf},{isDragging:!1,isRotating:!0})}else{const n=this.controllerState.rotateEnd();this.updateViewport(n,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(t){if(!this.scrollZoom)return!1;const r=this.getCenter(t);if(!this.isPointInBounds(r,t))return!1;t.srcEvent.preventDefault();const{speed:n=.01,smooth:a=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:d}=t;let f=2/(1+Math.exp(-Math.abs(d*n)));d<0&&f!==0&&(f=1/f);const c=this.controllerState.zoom({pos:r,scale:f});return this.updateViewport(c,{...this._getTransitionProps({around:r}),transitionDuration:a?250:1},{isZooming:!0,isPanning:!0}),!0}_onTriplePanStart(t){const r=this.getCenter(t);if(!this.isPointInBounds(r,t))return!1;const n=this.controllerState.rotateStart({pos:r});return this.updateViewport(n,oa,{isDragging:!0}),!0}_onTriplePan(t){if(!this.touchRotate||!this.isDragging())return!1;const r=this.getCenter(t);r[0]-=t.deltaX;const n=this.controllerState.rotate({pos:r});return this.updateViewport(n,oa,{isDragging:!0,isRotating:!0}),!0}_onTriplePanEnd(t){if(!this.isDragging())return!1;const{inertia:r}=this;if(this.touchRotate&&r&&t.velocityY){const n=this.getCenter(t),a=[n[0],n[1]+=t.velocityY*r/2],d=this.controllerState.rotate({pos:a});this.updateViewport(d,{...this._getTransitionProps(),transitionDuration:r,transitionEasing:Lf},{isDragging:!1,isRotating:!0}),this.blockEvents(r)}else{const n=this.controllerState.rotateEnd();this.updateViewport(n,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(t){const r=this.getCenter(t);if(!this.isPointInBounds(r,t))return!1;const n=this.controllerState.zoomStart({pos:r}).rotateStart({pos:r});return rl._startPinchRotation=t.rotation,rl._lastPinchEvent=t,this.updateViewport(n,oa,{isDragging:!0}),!0}_onPinch(t){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let r=this.controllerState;if(this.touchZoom){const{scale:n}=t,a=this.getCenter(t);r=r.zoom({pos:a,scale:n})}if(this.touchRotate){const{rotation:n}=t;r=r.rotate({deltaAngleX:rl._startPinchRotation-n})}return this.updateViewport(r,oa,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),rl._lastPinchEvent=t,!0}_onPinchEnd(t){if(!this.isDragging())return!1;const{inertia:r}=this,{_lastPinchEvent:n}=rl;if(this.touchZoom&&r&&n&&t.scale!==n.scale){const a=this.getCenter(t);let d=this.controllerState.rotateEnd();const f=Math.log2(t.scale),c=(f-Math.log2(n.scale))/(t.deltaTime-n.deltaTime),T=Math.pow(2,f+c*r/2);d=d.zoom({pos:a,scale:T}).zoomEnd(),this.updateViewport(d,{...this._getTransitionProps({around:a}),transitionDuration:r,transitionEasing:Lf},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(r)}else{const a=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(a,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return rl._startPinchRotation=null,rl._lastPinchEvent=null,!0}_onDoubleTap(t){if(!this.doubleClickZoom)return!1;const r=this.getCenter(t);if(!this.isPointInBounds(r,t))return!1;const n=this.isFunctionKeyPressed(t),a=this.controllerState.zoom({pos:r,scale:n?.5:2});return this.updateViewport(a,this._getTransitionProps({around:r}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(t){if(!this.keyboard)return!1;const r=this.isFunctionKeyPressed(t),{zoomSpeed:n,moveSpeed:a,rotateSpeedX:d,rotateSpeedY:f}=this.keyboard===!0?{}:this.keyboard,{controllerState:c}=this;let T;const C={};switch(t.srcEvent.code){case"Minus":T=r?c.zoomOut(n).zoomOut(n):c.zoomOut(n),C.isZooming=!0;break;case"Equal":T=r?c.zoomIn(n).zoomIn(n):c.zoomIn(n),C.isZooming=!0;break;case"ArrowLeft":r?(T=c.rotateLeft(d),C.isRotating=!0):(T=c.moveLeft(a),C.isPanning=!0);break;case"ArrowRight":r?(T=c.rotateRight(d),C.isRotating=!0):(T=c.moveRight(a),C.isPanning=!0);break;case"ArrowUp":r?(T=c.rotateUp(f),C.isRotating=!0):(T=c.moveUp(a),C.isPanning=!0);break;case"ArrowDown":r?(T=c.rotateDown(f),C.isRotating=!0):(T=c.moveDown(a),C.isPanning=!0);break;default:return!1}return this.updateViewport(T,this._getTransitionProps(),C),!0}_getTransitionProps(t){const{transition:r}=this;return!r||!r.transitionInterpolator?oa:t?{...r,transitionInterpolator:new p1({...t,...r.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:r}}class RD{constructor(t,r){this._viewportProps=this.applyConstraints(t),this._state=r}getViewportProps(){return this._viewportProps}getState(){return this._state}}const _1=5,PD=1.2;class BD extends RD{constructor(t){const{width:r,height:n,latitude:a,longitude:d,zoom:f,bearing:c=0,pitch:T=0,altitude:C=1.5,position:R=[0,0,0],maxZoom:L=20,minZoom:V=0,maxPitch:X=60,minPitch:at=0,startPanLngLat:nt,startZoomLngLat:K,startRotatePos:It,startBearing:St,startPitch:Ct,startZoom:Ht,normalize:Qt=!0}=t;bi(Number.isFinite(d)),bi(Number.isFinite(a)),bi(Number.isFinite(f)),super({width:r,height:n,latitude:a,longitude:d,zoom:f,bearing:c,pitch:T,altitude:C,maxZoom:L,minZoom:V,maxPitch:X,minPitch:at,normalize:Qt,position:R},{startPanLngLat:nt,startZoomLngLat:K,startRotatePos:It,startBearing:St,startPitch:Ct,startZoom:Ht}),this.makeViewport=t.makeViewport}panStart({pos:t}){return this._getUpdatedState({startPanLngLat:this._unproject(t)})}pan({pos:t,startPos:r}){const n=this.getState().startPanLngLat||this._unproject(r);if(!n)return this;const d=this.makeViewport(this.getViewportProps()).panByPosition(n,t);return this._getUpdatedState(d)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:t}){return this._getUpdatedState({startRotatePos:t,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:t,deltaAngleX:r=0,deltaAngleY:n=0}){const{startRotatePos:a,startBearing:d,startPitch:f}=this.getState();if(!a||d===void 0||f===void 0)return this;let c;return t?c=this._getNewRotation(t,a,f,d):c={bearing:d+r,pitch:f+n},this._getUpdatedState(c)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:t}){return this._getUpdatedState({startZoomLngLat:this._unproject(t),startZoom:this.getViewportProps().zoom})}zoom({pos:t,startPos:r,scale:n}){let{startZoom:a,startZoomLngLat:d}=this.getState();if(d||(a=this.getViewportProps().zoom,d=this._unproject(r)||this._unproject(t)),!d)return this;const{maxZoom:f,minZoom:c}=this.getViewportProps();let T=a+Math.log2(n);T=Eo(T,c,f);const C=this.makeViewport({...this.getViewportProps(),zoom:T});return this._getUpdatedState({zoom:T,...C.panByPosition(d,t)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(t=2){return this._zoomFromCenter(t)}zoomOut(t=2){return this._zoomFromCenter(1/t)}moveLeft(t=100){return this._panFromCenter([t,0])}moveRight(t=100){return this._panFromCenter([-t,0])}moveUp(t=100){return this._panFromCenter([0,t])}moveDown(t=100){return this._panFromCenter([0,-t])}rotateLeft(t=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-t})}rotateRight(t=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+t})}rotateUp(t=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+t})}rotateDown(t=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-t})}shortestPathFrom(t){const r=t.getViewportProps(),n={...this.getViewportProps()},{bearing:a,longitude:d}=n;return Math.abs(a-r.bearing)>180&&(n.bearing=a<0?a+360:a-360),Math.abs(d-r.longitude)>180&&(n.longitude=d<0?d+360:d-360),n}applyConstraints(t){const{maxZoom:r,minZoom:n,zoom:a}=t;t.zoom=Eo(a,n,r);const{maxPitch:d,minPitch:f,pitch:c}=t;t.pitch=Eo(c,f,d);const{normalize:T=!0}=t;return T&&Object.assign(t,fB(t)),t}_zoomFromCenter(t){const{width:r,height:n}=this.getViewportProps();return this.zoom({pos:[r/2,n/2],scale:t})}_panFromCenter(t){const{width:r,height:n}=this.getViewportProps();return this.pan({startPos:[r/2,n/2],pos:[r/2+t[0],n/2+t[1]]})}_getUpdatedState(t){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...t})}_unproject(t){const r=this.makeViewport(this.getViewportProps());return t&&r.unproject(t)}_getNewRotation(t,r,n,a){const d=t[0]-r[0],f=t[1]-r[1],c=t[1],T=r[1],{width:C,height:R}=this.getViewportProps(),L=d/C;let V=0;f>0?Math.abs(R-T)>_1&&(V=f/(T-R)*PD):f<0&&T>_1&&(V=1-c/T),V=Eo(V,-1,1);const{minPitch:X,maxPitch:at}=this.getViewportProps(),nt=a+180*L;let K=n;return V>0?K=n+V*(at-n):V<0&&(K=n-V*(X-n)),{pitch:K,bearing:nt}}}class DD extends MD{constructor(){super(...arguments),this.ControllerState=BD,this.transition={transitionDuration:300,transitionInterpolator:new p1({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})},this.dragMode="pan"}setProps(t){t.position=t.position||[0,0,0];const r=this.props;super.setProps(t),(!r||r.height!==t.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...t,...this.state}))}}class bm extends xD{constructor(t={}){super(t)}get ViewportType(){return tl}get ControllerType(){return DD}}bm.displayName="MapView";const FD=new r1;function OD(e,t){const r=e.order??1/0,n=t.order??1/0;return r-n}class kD{constructor(t){this._resolvedEffects=[],this._defaultEffects=[],this.effects=[],this._context=t,this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(t){const r=this._defaultEffects;if(!r.find(n=>n.id===t.id)){const n=r.findIndex(a=>OD(a,t)>0);n<0?r.push(t):r.splice(n,0,t),t.setup(this._context),this._setEffects(this.effects)}}setProps(t){"effects"in t&&(Sn(t.effects,this.effects,1)||this._setEffects(t.effects))}needsRedraw(t={clearRedrawFlags:!1}){const r=this._needsRedraw;return t.clearRedrawFlags&&(this._needsRedraw=!1),r}getEffects(){return this._resolvedEffects}_setEffects(t){const r={};for(const a of this.effects)r[a.id]=a;const n=[];for(const a of t){const d=r[a.id];let f=a;d&&d!==a?d.setProps?(d.setProps(a.props),f=d):d.cleanup(this._context):d||a.setup(this._context),n.push(f),delete r[a.id]}for(const a in r)r[a].cleanup(this._context);this.effects=n,this._resolvedEffects=n.concat(this._defaultEffects),t.some(a=>a instanceof r1)||this._resolvedEffects.push(FD),this._needsRedraw="effects changed"}finalize(){for(const t of this._resolvedEffects)t.cleanup(this._context);this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}class ND extends um{shouldDrawLayer(t){const{operation:r}=t.props;return r.includes("draw")||r.includes("terrain")}}const LD="deckRenderer.renderLayers";class UD{constructor(t){this.device=t,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new ND(t),this.pickLayersPass=new h1(t),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(t){this.layerFilter!==t.layerFilter&&(this.layerFilter=t.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==t.drawPickingColors&&(this.drawPickingColors=t.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(t){if(!t.viewports.length)return;const r=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,n={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...t};n.effects&&this._preRender(n.effects,n);const a=this.lastPostProcessEffect?this.renderBuffers[0]:n.target;this.lastPostProcessEffect&&(n.clearColor=[0,0,0,0],n.clearCanvas=!0);const d=r.render({...n,target:a});n.effects&&this._postRender(n.effects,n),this.renderCount++,Yi(LD,this,d,t)}needsRedraw(t={clearRedrawFlags:!1}){const r=this._needsRedraw;return t.clearRedrawFlags&&(this._needsRedraw=!1),r}finalize(){const{renderBuffers:t}=this;for(const r of t)r.delete();t.length=0}_preRender(t,r){this.lastPostProcessEffect=null,r.preRenderStats=r.preRenderStats||{};for(const n of t)r.preRenderStats[n.id]=n.preRender(r),n.postRender&&(this.lastPostProcessEffect=n.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){const{renderBuffers:t}=this,r=this.device.canvasContext.getDrawingBufferSize();t.length===0&&[0,1].map(n=>{const a=this.device.createTexture({sampler:{minFilter:"linear",magFilter:"linear"}});t.push(this.device.createFramebuffer({id:`deck-renderbuffer-${n}`,colorAttachments:[a]}))});for(const n of t)n.resize(r)}_postRender(t,r){const{renderBuffers:n}=this,a={...r,inputBuffer:n[0],swapBuffer:n[1]};for(const d of t)if(d.postRender){a.target=d.id===this.lastPostProcessEffect?r.target:void 0;const f=d.postRender(a);a.inputBuffer=f,a.swapBuffer=f===n[0]?n[1]:n[0]}}}const zD={pickedColor:null,pickedObjectIndex:-1};function VD({pickedColors:e,decodePickingColor:t,deviceX:r,deviceY:n,deviceRadius:a,deviceRect:d}){const{x:f,y:c,width:T,height:C}=d;let R=a*a,L=-1,V=0;for(let X=0;X<C;X++){const at=X+c-n,nt=at*at;if(nt>R)V+=4*T;else for(let K=0;K<T;K++){if(e[V+3]-1>=0){const St=K+f-r,Ct=St*St+nt;Ct<=R&&(R=Ct,L=V)}V+=4}}if(L>=0){const X=e.slice(L,L+4),at=t(X);if(at){const nt=Math.floor(L/4/T),K=L/4-nt*T;return{...at,pickedColor:X,pickedX:f+K,pickedY:c+nt}}Ye.error("Picked non-existent layer. Is picking buffer corrupt?")()}return zD}function jD({pickedColors:e,decodePickingColor:t}){const r=new Map;if(e){for(let n=0;n<e.length;n+=4)if(e[n+3]-1>=0){const d=e.slice(n,n+4),f=d.join(",");if(!r.has(f)){const c=t(d);c?r.set(f,{...c,color:d}):Ye.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(r.values())}function g1({pickInfo:e,viewports:t,pixelRatio:r,x:n,y:a,z:d}){let f=t[0];t.length>1&&(f=GD(e?.pickedViewports||t,{x:n,y:a}));let c;if(f){const T=[n-f.x,a-f.y];d!==void 0&&(T[2]=d),c=f.unproject(T)}return{color:null,layer:null,viewport:f,index:-1,picked:!1,x:n,y:a,pixel:[n,a],coordinate:c,devicePixel:e&&"pickedX"in e?[e.pickedX,e.pickedY]:void 0,pixelRatio:r}}function HD(e){const{pickInfo:t,lastPickedInfo:r,mode:n,layers:a}=e,{pickedColor:d,pickedLayer:f,pickedObjectIndex:c}=t,T=f?[f]:[];if(n==="hover"){const L=r.index,V=r.layerId,X=f?f.props.id:null;if(X!==V||c!==L){if(X!==V){const at=a.find(nt=>nt.props.id===V);at&&T.unshift(at)}r.layerId=X,r.index=c,r.info=null}}const C=g1(e),R=new Map;return R.set(null,C),T.forEach(L=>{let V={...C};L===f&&(V.color=d,V.index=c,V.picked=!0),V=m1({layer:L,info:V,mode:n});const X=V.layer;L===f&&n==="hover"&&(r.info=V),R.set(X.id,V),n==="hover"&&X.updateAutoHighlight(V)}),R}function m1({layer:e,info:t,mode:r}){for(;e&&t;){const n=t.layer||null;t.sourceLayer=n,t.layer=e,t=e.getPickingInfo({info:t,mode:r,sourceLayer:n}),e=e.parent}return t}function GD(e,t){for(let r=e.length-1;r>=0;r--){const n=e[r];if(n.containsPixel(t))return n}return e[0]}class $D{constructor(t){this._pickable=!0,this.device=t,this.pickLayersPass=new h1(t),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(t){"layerFilter"in t&&(this.layerFilter=t.layerFilter),"_pickable"in t&&(this._pickable=t._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.destroy(),this.depthFBO&&this.depthFBO.destroy()}pickObject(t){return this._pickClosestObject(t)}pickObjects(t){return this._pickVisibleObjects(t)}getLastPickedObject({x:t,y:r,layers:n,viewports:a},d=this.lastPickedInfo.info){const f=d&&d.layer&&d.layer.id,c=d&&d.viewport&&d.viewport.id,T=f?n.find(V=>V.id===f):null,C=c&&a.find(V=>V.id===c)||a[0],R=C&&C.unproject([t-C.x,r-C.y]);return{...d,...{x:t,y:r,viewport:C,coordinate:R,layer:T}}}_resizeBuffer(){if(!this.pickingFBO&&(this.pickingFBO=this.device.createFramebuffer({colorAttachments:["rgba8unorm"],depthStencilAttachment:"depth16unorm"}),this.device.isTextureFormatRenderable("rgba32float"))){const r=this.device.createFramebuffer({colorAttachments:["rgba32float"],depthStencilAttachment:"depth16unorm"});this.depthFBO=r}const{canvas:t}=this.device.getCanvasContext();this.pickingFBO?.resize({width:t.width,height:t.height}),this.depthFBO?.resize({width:t.width,height:t.height})}_getPickable(t){if(this._pickable===!1)return null;const r=t.filter(n=>this.pickLayersPass.shouldDrawLayer(n)&&!n.isComposite);return r.length?r:null}_pickClosestObject({layers:t,views:r,viewports:n,x:a,y:d,radius:f=0,depth:c=1,mode:T="query",unproject3D:C,onViewportActive:R,effects:L}){const V=this.device.canvasContext.cssToDeviceRatio(),X=this._getPickable(t);if(!X||n.length===0)return{result:[],emptyInfo:g1({viewports:n,x:a,y:d,pixelRatio:V})};this._resizeBuffer();const at=this.device.canvasContext.cssToDevicePixels([a,d],!0),nt=[at.x+Math.floor(at.width/2),at.y+Math.floor(at.height/2)],K=Math.round(f*V),{width:It,height:St}=this.pickingFBO,Ct=this._getPickingRect({deviceX:nt[0],deviceY:nt[1],deviceRadius:K,deviceWidth:It,deviceHeight:St}),Ht={x:a-f,y:d-f,width:f*2+1,height:f*2+1};let Qt;const ee=[],ae=new Set;for(let be=0;be<c;be++){let ie;if(Ct){const Ae=this._drawAndSample({layers:X,views:r,viewports:n,onViewportActive:R,deviceRect:Ct,cullRect:Ht,effects:L,pass:`picking:${T}`});ie=VD({...Ae,deviceX:nt[0],deviceY:nt[1],deviceRadius:K,deviceRect:Ct})}else ie={pickedColor:null,pickedObjectIndex:-1};let le;if(ie.pickedLayer&&C&&this.depthFBO){const{pickedColors:Ae}=this._drawAndSample({layers:[ie.pickedLayer],views:r,viewports:n,onViewportActive:R,deviceRect:{x:ie.pickedX,y:ie.pickedY,width:1,height:1},cullRect:Ht,effects:L,pass:`picking:${T}:z`},!0);Ae[3]&&(le=Ae[0])}ie.pickedLayer&&be+1<c&&(ae.add(ie.pickedLayer),ie.pickedLayer.disablePickingIndex(ie.pickedObjectIndex)),Qt=HD({pickInfo:ie,lastPickedInfo:this.lastPickedInfo,mode:T,layers:X,viewports:n,x:a,y:d,z:le,pixelRatio:V});for(const Ae of Qt.values())Ae.layer&&ee.push(Ae);if(!ie.pickedColor)break}for(const be of ae)be.restorePickingColors();return{result:ee,emptyInfo:Qt.get(null)}}_pickVisibleObjects({layers:t,views:r,viewports:n,x:a,y:d,width:f=1,height:c=1,mode:T="query",maxObjects:C=null,onViewportActive:R,effects:L}){const V=this._getPickable(t);if(!V||n.length===0)return[];this._resizeBuffer();const X=this.device.canvasContext.cssToDeviceRatio(),at=this.device.canvasContext.cssToDevicePixels([a,d],!0),nt=at.x,K=at.y+at.height,It=this.device.canvasContext.cssToDevicePixels([a+f,d+c],!0),St=It.x+It.width,Ct=It.y,Ht={x:nt,y:Ct,width:St-nt,height:K-Ct},Qt=this._drawAndSample({layers:V,views:r,viewports:n,onViewportActive:R,deviceRect:Ht,cullRect:{x:a,y:d,width:f,height:c},effects:L,pass:`picking:${T}`}),ee=jD(Qt),ae=new Map,be=[],ie=Number.isFinite(C);for(let le=0;le<ee.length&&!(ie&&be.length>=C);le++){const Ae=ee[le];let Fe={color:Ae.pickedColor,layer:null,index:Ae.pickedObjectIndex,picked:!0,x:a,y:d,pixelRatio:X};Fe=m1({layer:Ae.pickedLayer,info:Fe,mode:T});const ze=Fe.layer.id;ae.has(ze)||ae.set(ze,new Set);const Ce=ae.get(ze),zr=Fe.object??Fe.index;Ce.has(zr)||(Ce.add(zr),be.push(Fe))}return be}_drawAndSample({layers:t,views:r,viewports:n,onViewportActive:a,deviceRect:d,cullRect:f,effects:c,pass:T},C=!1){const R=C?this.depthFBO:this.pickingFBO,L={layers:t,layerFilter:this.layerFilter,views:r,viewports:n,onViewportActive:a,pickingFBO:R,deviceRect:d,cullRect:f,effects:c,pass:T,pickZ:C,preRenderStats:{}};for(const St of c)St.useInPicking&&(L.preRenderStats[St.id]=St.preRender(L));const{decodePickingColor:V}=this.pickLayersPass.render(L),{x:X,y:at,width:nt,height:K}=d,It=new(C?Float32Array:Uint8Array)(nt*K*4);return this.device.readPixelsToArrayWebGL(R,{sourceX:X,sourceY:at,sourceWidth:nt,sourceHeight:K,target:It}),{pickedColors:It,decodePickingColor:V}}_getPickingRect({deviceX:t,deviceY:r,deviceRadius:n,deviceWidth:a,deviceHeight:d}){const f=Math.max(0,t-n),c=Math.max(0,r-n),T=Math.min(a,t+n+1)-f,C=Math.min(d,r+n+1)-c;return T<=0||C<=0?null:{x:f,y:c,width:T,height:C}}}const WD={"top-left":{top:0,left:0},"top-right":{top:0,right:0},"bottom-left":{bottom:0,left:0},"bottom-right":{bottom:0,right:0},fill:{top:0,left:0,bottom:0,right:0}},XD="top-left",y1="__root";class qD{constructor({deck:t,parentElement:r}){this.defaultWidgets=[],this.widgets=[],this.resolvedWidgets=[],this.containers={},this.lastViewports={},this.deck=t,this.parentElement=r}getWidgets(){return this.resolvedWidgets}setProps(t){t.widgets&&!Sn(t.widgets,this.widgets,1)&&this._setWidgets(t.widgets)}finalize(){for(const t of this.getWidgets())this._remove(t);this.defaultWidgets.length=0,this.resolvedWidgets.length=0;for(const t in this.containers)this.containers[t].remove()}addDefault(t){this.defaultWidgets.find(r=>r.id===t.id)||(this._add(t),this.defaultWidgets.push(t),this._setWidgets(this.widgets))}_setWidgets(t){const r={};for(const n of this.resolvedWidgets)r[n.id]=n;this.resolvedWidgets.length=0;for(const n of this.defaultWidgets)r[n.id]=null,this.resolvedWidgets.push(n);for(let n of t){const a=r[n.id];a?a.viewId!==n.viewId||a.placement!==n.placement?(this._remove(a),this._add(n)):n!==a&&(a.setProps(n.props),n=a):this._add(n),r[n.id]=null,this.resolvedWidgets.push(n)}for(const n in r){const a=r[n];a&&this._remove(a)}this.widgets=t}_add(t){const{viewId:r=null,placement:n=XD}=t,a=t.onAdd({deck:this.deck,viewId:r});a&&this._getContainer(r,n).append(a),t._element=a}_remove(t){t.onRemove(),t._element&&t._element.remove(),t._element=void 0}_getContainer(t,r){const n=t||y1;let a=this.containers[n];a||(a=document.createElement("div"),a.style.pointerEvents="none",a.style.position="absolute",a.style.overflow="hidden",this.parentElement?.append(a),this.containers[n]=a);let d=a.querySelector(`.${r}`);return d||(d=document.createElement("div"),d.className=r,d.style.position="absolute",d.style.zIndex="2",Object.assign(d.style,WD[r]),a.append(d)),d}_updateContainers(){const t=this.deck.width,r=this.deck.height;for(const n in this.containers){const a=this.lastViewports[n]||null,d=n===y1||a,f=this.containers[n];d?(f.style.display="block",f.style.left=`${a?a.x:0}px`,f.style.top=`${a?a.y:0}px`,f.style.width=`${a?a.width:t}px`,f.style.height=`${a?a.height:r}px`):f.style.display="none"}}onRedraw({viewports:t,layers:r}){const n=t.reduce((d,f)=>(d[f.id]=f,d),{}),{lastViewports:a}=this;for(const d of this.getWidgets()){const{viewId:f}=d;if(f){const c=n[f];c&&(d.onViewportChange&&!c.equals(a[f])&&d.onViewportChange(c),d.onRedraw?.({viewports:[c],layers:r}))}else{if(d.onViewportChange)for(const c of t)c.equals(a[c.id])||d.onViewportChange(c);d.onRedraw?.({viewports:t,layers:r})}}this.lastViewports=n,this._updateContainers()}onHover(t,r){for(const n of this.getWidgets()){const{viewId:a}=n;(!a||a===t.viewport?.id)&&n.onHover?.(t,r)}}onEvent(t,r){const n=em[r.type];if(n)for(const a of this.getWidgets()){const{viewId:d}=a;(!d||d===t.viewport?.id)&&a[n.handler]?.(t,r)}}}const ZD={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class YD{constructor(){this.id="default-tooltip",this.placement="fill",this.props={},this.isVisible=!1}onAdd({deck:t}){const r=document.createElement("div");return r.className="deck-tooltip",Object.assign(r.style,ZD),this.deck=t,this.element=r,r}onRemove(){this.deck=void 0,this.element=void 0}setProps(){}onViewportChange(t){this.isVisible&&t.id===this.lastViewport?.id&&t!==this.lastViewport&&this.setTooltip(null)}onHover(t){const{deck:r}=this,n=r&&r.props.getTooltip;if(!n)return;const a=n(t);this.lastViewport=t.viewport,this.setTooltip(a,t.x,t.y)}setTooltip(t,r,n){const a=this.element;if(a){if(typeof t=="string")a.innerText=t;else if(t)t.text&&(a.innerText=t.text),t.html&&(a.innerHTML=t.html),t.className&&(a.className=t.className);else{this.isVisible=!1,a.style.display="none";return}this.isVisible=!0,a.style.display="block",a.style.transform=`translate(${r}px, ${n}px)`,t&&typeof t=="object"&&"style"in t&&Object.assign(a.style,t.style)}}}var wc;(function(e){e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN",e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",e[e.FUNC_ADD=32774]="FUNC_ADD",e[e.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",e[e.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",e[e.BLEND_EQUATION=32777]="BLEND_EQUATION",e[e.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",e[e.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",e[e.BLEND_DST_RGB=32968]="BLEND_DST_RGB",e[e.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",e[e.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",e[e.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",e[e.BLEND_COLOR=32773]="BLEND_COLOR",e[e.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",e[e.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",e[e.LINE_WIDTH=2849]="LINE_WIDTH",e[e.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",e[e.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",e[e.CULL_FACE_MODE=2885]="CULL_FACE_MODE",e[e.FRONT_FACE=2886]="FRONT_FACE",e[e.DEPTH_RANGE=2928]="DEPTH_RANGE",e[e.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",e[e.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",e[e.DEPTH_FUNC=2932]="DEPTH_FUNC",e[e.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",e[e.STENCIL_FUNC=2962]="STENCIL_FUNC",e[e.STENCIL_FAIL=2964]="STENCIL_FAIL",e[e.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",e[e.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",e[e.STENCIL_REF=2967]="STENCIL_REF",e[e.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",e[e.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",e[e.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",e[e.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",e[e.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",e[e.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",e[e.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",e[e.VIEWPORT=2978]="VIEWPORT",e[e.SCISSOR_BOX=3088]="SCISSOR_BOX",e[e.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",e[e.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",e[e.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",e[e.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",e[e.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",e[e.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",e[e.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",e[e.RED_BITS=3410]="RED_BITS",e[e.GREEN_BITS=3411]="GREEN_BITS",e[e.BLUE_BITS=3412]="BLUE_BITS",e[e.ALPHA_BITS=3413]="ALPHA_BITS",e[e.DEPTH_BITS=3414]="DEPTH_BITS",e[e.STENCIL_BITS=3415]="STENCIL_BITS",e[e.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",e[e.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",e[e.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",e[e.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",e[e.SAMPLES=32937]="SAMPLES",e[e.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",e[e.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",e[e.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",e[e.VENDOR=7936]="VENDOR",e[e.RENDERER=7937]="RENDERER",e[e.VERSION=7938]="VERSION",e[e.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",e[e.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",e[e.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.BUFFER_SIZE=34660]="BUFFER_SIZE",e[e.BUFFER_USAGE=34661]="BUFFER_USAGE",e[e.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",e[e.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",e[e.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",e[e.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",e[e.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",e[e.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",e[e.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",e[e.CULL_FACE=2884]="CULL_FACE",e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK",e[e.BLEND=3042]="BLEND",e[e.DEPTH_TEST=2929]="DEPTH_TEST",e[e.DITHER=3024]="DITHER",e[e.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",e[e.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",e[e.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",e[e.SCISSOR_TEST=3089]="SCISSOR_TEST",e[e.STENCIL_TEST=2960]="STENCIL_TEST",e[e.NO_ERROR=0]="NO_ERROR",e[e.INVALID_ENUM=1280]="INVALID_ENUM",e[e.INVALID_VALUE=1281]="INVALID_VALUE",e[e.INVALID_OPERATION=1282]="INVALID_OPERATION",e[e.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",e[e.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",e[e.CW=2304]="CW",e[e.CCW=2305]="CCW",e[e.DONT_CARE=4352]="DONT_CARE",e[e.FASTEST=4353]="FASTEST",e[e.NICEST=4354]="NICEST",e[e.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.DOUBLE=5130]="DOUBLE",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER",e[e.COMPILE_STATUS=35713]="COMPILE_STATUS",e[e.DELETE_STATUS=35712]="DELETE_STATUS",e[e.LINK_STATUS=35714]="LINK_STATUS",e[e.VALIDATE_STATUS=35715]="VALIDATE_STATUS",e[e.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",e[e.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",e[e.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",e[e.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",e[e.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",e[e.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",e[e.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",e[e.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",e[e.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",e[e.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",e[e.SHADER_TYPE=35663]="SHADER_TYPE",e[e.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",e[e.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP",e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",e[e.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",e[e.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",e[e.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",e[e.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE=5890]="TEXTURE",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",e[e.TEXTURE0=33984]="TEXTURE0",e[e.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",e[e.REPEAT=10497]="REPEAT",e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e[e.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",e[e.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.LOW_FLOAT=36336]="LOW_FLOAT",e[e.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",e[e.HIGH_FLOAT=36338]="HIGH_FLOAT",e[e.LOW_INT=36339]="LOW_INT",e[e.MEDIUM_INT=36340]="MEDIUM_INT",e[e.HIGH_INT=36341]="HIGH_INT",e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.RENDERBUFFER=36161]="RENDERBUFFER",e[e.RGBA4=32854]="RGBA4",e[e.RGB5_A1=32855]="RGB5_A1",e[e.RGB565=36194]="RGB565",e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX=6401]="STENCIL_INDEX",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",e[e.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",e[e.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",e[e.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",e[e.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",e[e.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",e[e.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",e[e.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",e[e.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",e[e.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",e[e.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",e[e.NONE=0]="NONE",e[e.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",e[e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",e[e.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",e[e.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",e[e.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",e[e.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",e[e.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",e[e.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",e[e.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",e[e.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",e[e.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",e[e.READ_BUFFER=3074]="READ_BUFFER",e[e.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",e[e.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",e[e.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",e[e.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",e[e.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",e[e.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",e[e.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",e[e.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",e[e.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",e[e.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",e[e.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",e[e.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",e[e.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",e[e.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",e[e.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",e[e.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",e[e.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",e[e.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",e[e.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",e[e.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",e[e.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",e[e.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",e[e.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",e[e.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",e[e.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",e[e.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",e[e.RED=6403]="RED",e[e.RGB8=32849]="RGB8",e[e.RGBA8=32856]="RGBA8",e[e.RGB10_A2=32857]="RGB10_A2",e[e.TEXTURE_3D=32879]="TEXTURE_3D",e[e.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",e[e.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",e[e.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",e[e.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",e[e.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",e[e.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",e[e.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",e[e.SRGB=35904]="SRGB",e[e.SRGB8=35905]="SRGB8",e[e.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",e[e.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",e[e.RGBA32F=34836]="RGBA32F",e[e.RGB32F=34837]="RGB32F",e[e.RGBA16F=34842]="RGBA16F",e[e.RGB16F=34843]="RGB16F",e[e.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",e[e.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",e[e.R11F_G11F_B10F=35898]="R11F_G11F_B10F",e[e.RGB9_E5=35901]="RGB9_E5",e[e.RGBA32UI=36208]="RGBA32UI",e[e.RGB32UI=36209]="RGB32UI",e[e.RGBA16UI=36214]="RGBA16UI",e[e.RGB16UI=36215]="RGB16UI",e[e.RGBA8UI=36220]="RGBA8UI",e[e.RGB8UI=36221]="RGB8UI",e[e.RGBA32I=36226]="RGBA32I",e[e.RGB32I=36227]="RGB32I",e[e.RGBA16I=36232]="RGBA16I",e[e.RGB16I=36233]="RGB16I",e[e.RGBA8I=36238]="RGBA8I",e[e.RGB8I=36239]="RGB8I",e[e.RED_INTEGER=36244]="RED_INTEGER",e[e.RGB_INTEGER=36248]="RGB_INTEGER",e[e.RGBA_INTEGER=36249]="RGBA_INTEGER",e[e.R8=33321]="R8",e[e.RG8=33323]="RG8",e[e.R16F=33325]="R16F",e[e.R32F=33326]="R32F",e[e.RG16F=33327]="RG16F",e[e.RG32F=33328]="RG32F",e[e.R8I=33329]="R8I",e[e.R8UI=33330]="R8UI",e[e.R16I=33331]="R16I",e[e.R16UI=33332]="R16UI",e[e.R32I=33333]="R32I",e[e.R32UI=33334]="R32UI",e[e.RG8I=33335]="RG8I",e[e.RG8UI=33336]="RG8UI",e[e.RG16I=33337]="RG16I",e[e.RG16UI=33338]="RG16UI",e[e.RG32I=33339]="RG32I",e[e.RG32UI=33340]="RG32UI",e[e.R8_SNORM=36756]="R8_SNORM",e[e.RG8_SNORM=36757]="RG8_SNORM",e[e.RGB8_SNORM=36758]="RGB8_SNORM",e[e.RGBA8_SNORM=36759]="RGBA8_SNORM",e[e.RGB10_A2UI=36975]="RGB10_A2UI",e[e.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",e[e.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",e[e.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",e[e.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",e[e.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",e[e.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",e[e.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",e[e.HALF_FLOAT=5131]="HALF_FLOAT",e[e.RG=33319]="RG",e[e.RG_INTEGER=33320]="RG_INTEGER",e[e.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",e[e.CURRENT_QUERY=34917]="CURRENT_QUERY",e[e.QUERY_RESULT=34918]="QUERY_RESULT",e[e.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",e[e.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",e[e.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",e[e.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",e[e.DRAW_BUFFER0=34853]="DRAW_BUFFER0",e[e.DRAW_BUFFER1=34854]="DRAW_BUFFER1",e[e.DRAW_BUFFER2=34855]="DRAW_BUFFER2",e[e.DRAW_BUFFER3=34856]="DRAW_BUFFER3",e[e.DRAW_BUFFER4=34857]="DRAW_BUFFER4",e[e.DRAW_BUFFER5=34858]="DRAW_BUFFER5",e[e.DRAW_BUFFER6=34859]="DRAW_BUFFER6",e[e.DRAW_BUFFER7=34860]="DRAW_BUFFER7",e[e.DRAW_BUFFER8=34861]="DRAW_BUFFER8",e[e.DRAW_BUFFER9=34862]="DRAW_BUFFER9",e[e.DRAW_BUFFER10=34863]="DRAW_BUFFER10",e[e.DRAW_BUFFER11=34864]="DRAW_BUFFER11",e[e.DRAW_BUFFER12=34865]="DRAW_BUFFER12",e[e.DRAW_BUFFER13=34866]="DRAW_BUFFER13",e[e.DRAW_BUFFER14=34867]="DRAW_BUFFER14",e[e.DRAW_BUFFER15=34868]="DRAW_BUFFER15",e[e.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",e[e.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",e[e.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",e[e.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",e[e.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",e[e.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",e[e.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",e[e.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",e[e.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",e[e.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",e[e.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",e[e.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",e[e.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",e[e.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",e[e.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",e[e.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",e[e.SAMPLER_3D=35679]="SAMPLER_3D",e[e.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",e[e.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",e[e.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",e[e.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",e[e.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",e[e.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",e[e.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",e[e.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",e[e.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",e[e.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",e[e.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",e[e.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",e[e.MAX_SAMPLES=36183]="MAX_SAMPLES",e[e.SAMPLER_BINDING=35097]="SAMPLER_BINDING",e[e.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",e[e.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",e[e.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",e[e.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",e[e.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",e[e.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",e[e.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",e[e.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",e[e.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",e[e.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",e[e.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",e[e.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",e[e.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",e[e.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",e[e.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",e[e.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",e[e.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",e[e.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",e[e.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",e[e.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",e[e.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",e[e.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",e[e.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",e[e.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",e[e.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",e[e.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",e[e.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",e[e.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",e[e.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",e[e.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",e[e.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",e[e.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",e[e.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",e[e.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",e[e.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",e[e.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",e[e.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",e[e.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",e[e.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",e[e.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",e[e.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",e[e.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",e[e.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",e[e.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",e[e.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",e[e.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",e[e.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",e[e.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",e[e.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",e[e.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",e[e.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",e[e.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",e[e.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",e[e.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",e[e.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",e[e.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",e[e.UNIFORM_TYPE=35383]="UNIFORM_TYPE",e[e.UNIFORM_SIZE=35384]="UNIFORM_SIZE",e[e.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",e[e.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",e[e.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",e[e.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",e[e.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",e[e.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",e[e.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",e[e.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",e[e.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",e[e.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",e[e.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",e[e.OBJECT_TYPE=37138]="OBJECT_TYPE",e[e.SYNC_CONDITION=37139]="SYNC_CONDITION",e[e.SYNC_STATUS=37140]="SYNC_STATUS",e[e.SYNC_FLAGS=37141]="SYNC_FLAGS",e[e.SYNC_FENCE=37142]="SYNC_FENCE",e[e.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",e[e.UNSIGNALED=37144]="UNSIGNALED",e[e.SIGNALED=37145]="SIGNALED",e[e.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",e[e.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",e[e.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",e[e.WAIT_FAILED=37149]="WAIT_FAILED",e[e.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",e[e.COLOR=6144]="COLOR",e[e.DEPTH=6145]="DEPTH",e[e.STENCIL=6146]="STENCIL",e[e.MIN=32775]="MIN",e[e.MAX=32776]="MAX",e[e.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",e[e.STREAM_READ=35041]="STREAM_READ",e[e.STREAM_COPY=35042]="STREAM_COPY",e[e.STATIC_READ=35045]="STATIC_READ",e[e.STATIC_COPY=35046]="STATIC_COPY",e[e.DYNAMIC_READ=35049]="DYNAMIC_READ",e[e.DYNAMIC_COPY=35050]="DYNAMIC_COPY",e[e.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",e[e.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",e[e.INVALID_INDEX=4294967295]="INVALID_INDEX",e[e.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",e[e.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",e[e.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",e[e.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",e[e.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",e[e.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",e[e.R16_EXT=33322]="R16_EXT",e[e.RG16_EXT=33324]="RG16_EXT",e[e.RGB16_EXT=32852]="RGB16_EXT",e[e.RGBA16_EXT=32859]="RGBA16_EXT",e[e.R16_SNORM_EXT=36760]="R16_SNORM_EXT",e[e.RG16_SNORM_EXT=36761]="RG16_SNORM_EXT",e[e.RGB16_SNORM_EXT=36762]="RGB16_SNORM_EXT",e[e.RGBA16_SNORM_EXT=36763]="RGBA16_SNORM_EXT",e[e.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",e[e.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",e[e.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",e[e.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",e[e.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",e[e.COMPRESSED_RED_RGTC1_EXT=36283]="COMPRESSED_RED_RGTC1_EXT",e[e.COMPRESSED_SIGNED_RED_RGTC1_EXT=36284]="COMPRESSED_SIGNED_RED_RGTC1_EXT",e[e.COMPRESSED_RED_GREEN_RGTC2_EXT=36285]="COMPRESSED_RED_GREEN_RGTC2_EXT",e[e.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT=36286]="COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT",e[e.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",e[e.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",e[e.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",e[e.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",e[e.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",e[e.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",e[e.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",e[e.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",e[e.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",e[e.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",e[e.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",e[e.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",e[e.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",e[e.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",e[e.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",e[e.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",e[e.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",e[e.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",e[e.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",e[e.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",e[e.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",e[e.COMPRESSED_RGBA_ASTC_5x4_KHR=37809]="COMPRESSED_RGBA_ASTC_5x4_KHR",e[e.COMPRESSED_RGBA_ASTC_5x5_KHR=37810]="COMPRESSED_RGBA_ASTC_5x5_KHR",e[e.COMPRESSED_RGBA_ASTC_6x5_KHR=37811]="COMPRESSED_RGBA_ASTC_6x5_KHR",e[e.COMPRESSED_RGBA_ASTC_6x6_KHR=37812]="COMPRESSED_RGBA_ASTC_6x6_KHR",e[e.COMPRESSED_RGBA_ASTC_8x5_KHR=37813]="COMPRESSED_RGBA_ASTC_8x5_KHR",e[e.COMPRESSED_RGBA_ASTC_8x6_KHR=37814]="COMPRESSED_RGBA_ASTC_8x6_KHR",e[e.COMPRESSED_RGBA_ASTC_8x8_KHR=37815]="COMPRESSED_RGBA_ASTC_8x8_KHR",e[e.COMPRESSED_RGBA_ASTC_10x5_KHR=37816]="COMPRESSED_RGBA_ASTC_10x5_KHR",e[e.COMPRESSED_RGBA_ASTC_10x6_KHR=37817]="COMPRESSED_RGBA_ASTC_10x6_KHR",e[e.COMPRESSED_RGBA_ASTC_10x8_KHR=37818]="COMPRESSED_RGBA_ASTC_10x8_KHR",e[e.COMPRESSED_RGBA_ASTC_10x10_KHR=37819]="COMPRESSED_RGBA_ASTC_10x10_KHR",e[e.COMPRESSED_RGBA_ASTC_12x10_KHR=37820]="COMPRESSED_RGBA_ASTC_12x10_KHR",e[e.COMPRESSED_RGBA_ASTC_12x12_KHR=37821]="COMPRESSED_RGBA_ASTC_12x12_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840]="COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR=37841]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR=37842]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR=37843]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR=37844]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR=37845]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR=37846]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR=37848]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR=37849]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR=37850]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR=37851]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR=37852]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR=37853]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR",e[e.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",e[e.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",e[e.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",e[e.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",e[e.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",e[e.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",e[e.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT",e[e.COMPLETION_STATUS_KHR=37297]="COMPLETION_STATUS_KHR",e[e.DEPTH_CLAMP_EXT=34383]="DEPTH_CLAMP_EXT",e[e.FIRST_VERTEX_CONVENTION_WEBGL=36429]="FIRST_VERTEX_CONVENTION_WEBGL",e[e.LAST_VERTEX_CONVENTION_WEBGL=36430]="LAST_VERTEX_CONVENTION_WEBGL",e[e.PROVOKING_VERTEX_WEBL=36431]="PROVOKING_VERTEX_WEBL",e[e.POLYGON_MODE_WEBGL=2880]="POLYGON_MODE_WEBGL",e[e.POLYGON_OFFSET_LINE_WEBGL=10754]="POLYGON_OFFSET_LINE_WEBGL",e[e.LINE_WEBGL=6913]="LINE_WEBGL",e[e.FILL_WEBGL=6914]="FILL_WEBGL",e[e.MAX_CLIP_DISTANCES_WEBGL=3378]="MAX_CLIP_DISTANCES_WEBGL",e[e.MAX_CULL_DISTANCES_WEBGL=33529]="MAX_CULL_DISTANCES_WEBGL",e[e.MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL=33530]="MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL",e[e.CLIP_DISTANCE0_WEBGL=12288]="CLIP_DISTANCE0_WEBGL",e[e.CLIP_DISTANCE1_WEBGL=12289]="CLIP_DISTANCE1_WEBGL",e[e.CLIP_DISTANCE2_WEBGL=12290]="CLIP_DISTANCE2_WEBGL",e[e.CLIP_DISTANCE3_WEBGL=12291]="CLIP_DISTANCE3_WEBGL",e[e.CLIP_DISTANCE4_WEBGL=12292]="CLIP_DISTANCE4_WEBGL",e[e.CLIP_DISTANCE5_WEBGL=12293]="CLIP_DISTANCE5_WEBGL",e[e.CLIP_DISTANCE6_WEBGL=12294]="CLIP_DISTANCE6_WEBGL",e[e.CLIP_DISTANCE7_WEBGL=12295]="CLIP_DISTANCE7_WEBGL",e[e.POLYGON_OFFSET_CLAMP_EXT=36379]="POLYGON_OFFSET_CLAMP_EXT",e[e.LOWER_LEFT_EXT=36001]="LOWER_LEFT_EXT",e[e.UPPER_LEFT_EXT=36002]="UPPER_LEFT_EXT",e[e.NEGATIVE_ONE_TO_ONE_EXT=37726]="NEGATIVE_ONE_TO_ONE_EXT",e[e.ZERO_TO_ONE_EXT=37727]="ZERO_TO_ONE_EXT",e[e.CLIP_ORIGIN_EXT=37724]="CLIP_ORIGIN_EXT",e[e.CLIP_DEPTH_MODE_EXT=37725]="CLIP_DEPTH_MODE_EXT",e[e.SRC1_COLOR_WEBGL=35065]="SRC1_COLOR_WEBGL",e[e.SRC1_ALPHA_WEBGL=34185]="SRC1_ALPHA_WEBGL",e[e.ONE_MINUS_SRC1_COLOR_WEBGL=35066]="ONE_MINUS_SRC1_COLOR_WEBGL",e[e.ONE_MINUS_SRC1_ALPHA_WEBGL=35067]="ONE_MINUS_SRC1_ALPHA_WEBGL",e[e.MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL=35068]="MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL",e[e.MIRROR_CLAMP_TO_EDGE_EXT=34627]="MIRROR_CLAMP_TO_EDGE_EXT"})(wc||(wc={}));const vm={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,35725:null,36006:null,36007:null,34229:null,34964:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32926:!1,32928:!1,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],36389:null,36662:null,36663:null,35053:null,35055:null,35723:4352,36010:null,35977:!1,3333:4,3317:4,37440:!1,37441:!1,37443:37444,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},oi=(e,t,r)=>t?e.enable(r):e.disable(r),b1=(e,t,r)=>e.hint(r,t),Ms=(e,t,r)=>e.pixelStorei(r,t),v1=(e,t,r)=>{const n=r===36006?36009:36008;return e.bindFramebuffer(n,t)},mh=(e,t,r)=>{const a={34964:34962,36662:36662,36663:36663,35053:35051,35055:35052}[r];e.bindBuffer(a,t)};function xm(e){return Array.isArray(e)||ArrayBuffer.isView(e)&&!(e instanceof DataView)}const KD={3042:oi,32773:(e,t)=>e.blendColor(...t),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(e,t)=>e.clearColor(...t),3107:(e,t)=>e.colorMask(...t),2884:oi,2885:(e,t)=>e.cullFace(t),2929:oi,2931:(e,t)=>e.clearDepth(t),2932:(e,t)=>e.depthFunc(t),2928:(e,t)=>e.depthRange(...t),2930:(e,t)=>e.depthMask(t),3024:oi,35723:b1,35725:(e,t)=>e.useProgram(t),36007:(e,t)=>e.bindRenderbuffer(36161,t),36389:(e,t)=>e.bindTransformFeedback?.(36386,t),34229:(e,t)=>e.bindVertexArray(t),36006:v1,36010:v1,34964:mh,36662:mh,36663:mh,35053:mh,35055:mh,2886:(e,t)=>e.frontFace(t),33170:b1,2849:(e,t)=>e.lineWidth(t),32823:oi,32824:"polygonOffset",10752:"polygonOffset",35977:oi,32926:oi,32928:oi,32938:"sampleCoverage",32939:"sampleCoverage",3089:oi,3088:(e,t)=>e.scissor(...t),2960:oi,2961:(e,t)=>e.clearStencil(t),2968:(e,t)=>e.stencilMaskSeparate(1028,t),36005:(e,t)=>e.stencilMaskSeparate(1029,t),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(e,t)=>e.viewport(...t),34383:oi,10754:oi,12288:oi,12289:oi,12290:oi,12291:oi,12292:oi,12293:oi,12294:oi,12295:oi,3333:Ms,3317:Ms,37440:Ms,37441:Ms,37443:Ms,3330:Ms,3332:Ms,3331:Ms,3314:Ms,32878:Ms,3316:Ms,3315:Ms,32877:Ms,framebuffer:(e,t)=>{const r=t&&"handle"in t?t.handle:t;return e.bindFramebuffer(36160,r)},blend:(e,t)=>t?e.enable(3042):e.disable(3042),blendColor:(e,t)=>e.blendColor(...t),blendEquation:(e,t)=>{const r=typeof t=="number"?[t,t]:t;e.blendEquationSeparate(...r)},blendFunc:(e,t)=>{const r=t?.length===2?[...t,...t]:t;e.blendFuncSeparate(...r)},clearColor:(e,t)=>e.clearColor(...t),clearDepth:(e,t)=>e.clearDepth(t),clearStencil:(e,t)=>e.clearStencil(t),colorMask:(e,t)=>e.colorMask(...t),cull:(e,t)=>t?e.enable(2884):e.disable(2884),cullFace:(e,t)=>e.cullFace(t),depthTest:(e,t)=>t?e.enable(2929):e.disable(2929),depthFunc:(e,t)=>e.depthFunc(t),depthMask:(e,t)=>e.depthMask(t),depthRange:(e,t)=>e.depthRange(...t),dither:(e,t)=>t?e.enable(3024):e.disable(3024),derivativeHint:(e,t)=>{e.hint(35723,t)},frontFace:(e,t)=>e.frontFace(t),mipmapHint:(e,t)=>e.hint(33170,t),lineWidth:(e,t)=>e.lineWidth(t),polygonOffsetFill:(e,t)=>t?e.enable(32823):e.disable(32823),polygonOffset:(e,t)=>e.polygonOffset(...t),sampleCoverage:(e,t)=>e.sampleCoverage(...t),scissorTest:(e,t)=>t?e.enable(3089):e.disable(3089),scissor:(e,t)=>e.scissor(...t),stencilTest:(e,t)=>t?e.enable(2960):e.disable(2960),stencilMask:(e,t)=>{t=xm(t)?t:[t,t];const[r,n]=t;e.stencilMaskSeparate(1028,r),e.stencilMaskSeparate(1029,n)},stencilFunc:(e,t)=>{t=xm(t)&&t.length===3?[...t,...t]:t;const[r,n,a,d,f,c]=t;e.stencilFuncSeparate(1028,r,n,a),e.stencilFuncSeparate(1029,d,f,c)},stencilOp:(e,t)=>{t=xm(t)&&t.length===3?[...t,...t]:t;const[r,n,a,d,f,c]=t;e.stencilOpSeparate(1028,r,n,a),e.stencilOpSeparate(1029,d,f,c)},viewport:(e,t)=>e.viewport(...t)};function qr(e,t,r){return t[e]!==void 0?t[e]:r[e]}const JD={blendEquation:(e,t,r)=>e.blendEquationSeparate(qr(32777,t,r),qr(34877,t,r)),blendFunc:(e,t,r)=>e.blendFuncSeparate(qr(32969,t,r),qr(32968,t,r),qr(32971,t,r),qr(32970,t,r)),polygonOffset:(e,t,r)=>e.polygonOffset(qr(32824,t,r),qr(10752,t,r)),sampleCoverage:(e,t,r)=>e.sampleCoverage(qr(32938,t,r),qr(32939,t,r)),stencilFuncFront:(e,t,r)=>e.stencilFuncSeparate(1028,qr(2962,t,r),qr(2967,t,r),qr(2963,t,r)),stencilFuncBack:(e,t,r)=>e.stencilFuncSeparate(1029,qr(34816,t,r),qr(36003,t,r),qr(36004,t,r)),stencilOpFront:(e,t,r)=>e.stencilOpSeparate(1028,qr(2964,t,r),qr(2965,t,r),qr(2966,t,r)),stencilOpBack:(e,t,r)=>e.stencilOpSeparate(1029,qr(34817,t,r),qr(34818,t,r),qr(34819,t,r))},x1={enable:(e,t)=>e({[t]:!0}),disable:(e,t)=>e({[t]:!1}),pixelStorei:(e,t,r)=>e({[t]:r}),hint:(e,t,r)=>e({[t]:r}),useProgram:(e,t)=>e({35725:t}),bindRenderbuffer:(e,t,r)=>e({36007:r}),bindTransformFeedback:(e,t,r)=>e({36389:r}),bindVertexArray:(e,t)=>e({34229:t}),bindFramebuffer:(e,t,r)=>{switch(t){case 36160:return e({36006:r,36010:r});case 36009:return e({36006:r});case 36008:return e({36010:r});default:return null}},bindBuffer:(e,t,r)=>{const n={34962:[34964],36662:[36662],36663:[36663],35051:[35053],35052:[35055]}[t];return n?e({[n]:r}):{valueChanged:!0}},blendColor:(e,t,r,n,a)=>e({32773:new Float32Array([t,r,n,a])}),blendEquation:(e,t)=>e({32777:t,34877:t}),blendEquationSeparate:(e,t,r)=>e({32777:t,34877:r}),blendFunc:(e,t,r)=>e({32969:t,32968:r,32971:t,32970:r}),blendFuncSeparate:(e,t,r,n,a)=>e({32969:t,32968:r,32971:n,32970:a}),clearColor:(e,t,r,n,a)=>e({3106:new Float32Array([t,r,n,a])}),clearDepth:(e,t)=>e({2931:t}),clearStencil:(e,t)=>e({2961:t}),colorMask:(e,t,r,n,a)=>e({3107:[t,r,n,a]}),cullFace:(e,t)=>e({2885:t}),depthFunc:(e,t)=>e({2932:t}),depthRange:(e,t,r)=>e({2928:new Float32Array([t,r])}),depthMask:(e,t)=>e({2930:t}),frontFace:(e,t)=>e({2886:t}),lineWidth:(e,t)=>e({2849:t}),polygonOffset:(e,t,r)=>e({32824:t,10752:r}),sampleCoverage:(e,t,r)=>e({32938:t,32939:r}),scissor:(e,t,r,n,a)=>e({3088:new Int32Array([t,r,n,a])}),stencilMask:(e,t)=>e({2968:t,36005:t}),stencilMaskSeparate:(e,t,r)=>e({[t===1028?2968:36005]:r}),stencilFunc:(e,t,r,n)=>e({2962:t,2967:r,2963:n,34816:t,36003:r,36004:n}),stencilFuncSeparate:(e,t,r,n,a)=>e({[t===1028?2962:34816]:r,[t===1028?2967:36003]:n,[t===1028?2963:36004]:a}),stencilOp:(e,t,r,n)=>e({2964:t,2965:r,2966:n,34817:t,34818:r,34819:n}),stencilOpSeparate:(e,t,r,n,a)=>e({[t===1028?2964:34817]:r,[t===1028?2965:34818]:n,[t===1028?2966:34819]:a}),viewport:(e,t,r,n,a)=>e({2978:[t,r,n,a]})},to=(e,t)=>e.isEnabled(t),w1={3042:to,2884:to,2929:to,3024:to,32823:to,32926:to,32928:to,3089:to,2960:to,35977:to},QD=new Set([34016,36388,36387,35983,35368,34965,35739,35738,3074,34853,34854,34855,34856,34857,34858,34859,34860,34861,34862,34863,34864,34865,34866,34867,34868,35097,32873,35869,32874,34068]);function Tc(e,t){if(eF(t))return;const r={};for(const a in t){const d=Number(a),f=KD[a];f&&(typeof f=="string"?r[f]=!0:f(e,t[a],d))}const n=e.state&&e.state.cache;if(n)for(const a in r){const d=JD[a];d(e,t,n)}}function T1(e,t=vm){if(typeof t=="number"){const a=t,d=w1[a];return d?d(e,a):e.getParameter(a)}const r=Array.isArray(t)?t:Object.keys(t),n={};for(const a of r){const d=w1[a];n[a]=d?d(e,Number(a)):e.getParameter(Number(a))}return n}function tF(e){Tc(e,vm)}function eF(e){for(const t in e)return!1;return!0}function rF(e,t){if(e===t)return!0;const r=Array.isArray(e)||ArrayBuffer.isView(e),n=Array.isArray(t)||ArrayBuffer.isView(t);if(r&&n&&e.length===t.length){for(let a=0;a<e.length;++a)if(e[a]!==t[a])return!1;return!0}return!1}class iF{gl;program=null;stateStack=[];enable=!0;cache;log;constructor(t,{copyState:r=!1,log:n=()=>{}}={}){this.gl=t,this.cache=r?T1(t):Object.assign({},vm),this.log=n,this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(t={}){this.stateStack.push({})}pop(){tr(this.stateStack.length>0);const t=this.stateStack[this.stateStack.length-1];Tc(this.gl,t),this.stateStack.pop()}_updateCache(t){let r=!1,n;const a=this.stateStack.length>0?this.stateStack[this.stateStack.length-1]:null;for(const d in t){tr(d!==void 0);const f=t[d],c=this.cache[d];rF(f,c)||(r=!0,n=c,a&&!(d in a)&&(a[d]=c),this.cache[d]=f)}return{valueChanged:r,oldValue:n}}}function il(e){return e.state}function A1(e,t){const{enable:r=!0,copyState:n}=t;if(tr(n!==void 0),!e.state){e.state=new iF(e,{copyState:n}),nF(e);for(const d in x1){const f=x1[d];sF(e,d,f)}E1(e,"getParameter"),E1(e,"isEnabled")}const a=il(e);return a.enable=r,e}function Uf(e){let t=il(e);t||(A1(e,{copyState:!1}),t=il(e)),t.push()}function yh(e){const t=il(e);tr(t),t.pop()}function E1(e,t){const r=e[t].bind(e);e[t]=function(a){if(a===void 0||QD.has(a))return r(a);const d=il(e);return a in d.cache||(d.cache[a]=r(a)),d.enable?d.cache[a]:r(a)},Object.defineProperty(e[t],"name",{value:`${t}-from-cache`,configurable:!1})}function sF(e,t,r){if(!e[t])return;const n=e[t].bind(e);e[t]=function(...d){const f=il(e),{valueChanged:c,oldValue:T}=r(f._updateCache,...d);return c&&n(...d),T},Object.defineProperty(e[t],"name",{value:`${t}-to-cache`,configurable:!1})}function nF(e){const t=e.useProgram.bind(e);e.useProgram=function(n){const a=il(e);a.program!==n&&(t(n),a.program=n)}}const oF={powerPreference:"high-performance",onContextLost:()=>console.error("WebGL context lost"),onContextRestored:()=>console.info("WebGL context restored")};function aF(e,t){t={...oF,...t};let r=null;const n=d=>r=d.statusMessage||r;e.addEventListener("webglcontextcreationerror",n,!1);let a=null;if(a||=e.getContext("webgl2",t),e.removeEventListener("webglcontextcreationerror",n,!1),!a)throw new Error(`Failed to create WebGL context: ${r||"Unknown error"}`);if(t.onContextLost){const{onContextLost:d}=t;e.addEventListener("webglcontextlost",f=>d(f),!1)}if(t.onContextRestored){const{onContextRestored:d}=t;e.addEventListener("webglcontextrestored",f=>d(f),!1)}return a}function aa(e,t,r){return r[t]===void 0&&(r[t]=e.getExtension(t)||null),r[t]}function lF(e,t){const r=e.getParameter(7936),n=e.getParameter(7937);aa(e,"WEBGL_debug_renderer_info",t);const a=t.WEBGL_debug_renderer_info,d=e.getParameter(a?a.UNMASKED_VENDOR_WEBGL:7936),f=e.getParameter(a?a.UNMASKED_RENDERER_WEBGL:7937),c=d||r,T=f||n,C=e.getParameter(7938),R=S1(c,T),L=cF(c,T),V=uF(c,T);return{type:"webgl",gpu:R,gpuType:V,gpuBackend:L,vendor:c,renderer:T,version:C,shadingLanguage:"glsl",shadingLanguageVersion:300}}function S1(e,t){return/NVIDIA/i.exec(e)||/NVIDIA/i.exec(t)?"nvidia":/INTEL/i.exec(e)||/INTEL/i.exec(t)?"intel":/Apple/i.exec(e)||/Apple/i.exec(t)?"apple":/AMD/i.exec(e)||/AMD/i.exec(t)||/ATI/i.exec(e)||/ATI/i.exec(t)?"amd":/SwiftShader/i.exec(e)||/SwiftShader/i.exec(t)?"software":"unknown"}function cF(e,t){return/Metal/i.exec(e)||/Metal/i.exec(t)?"metal":/ANGLE/i.exec(e)||/ANGLE/i.exec(t)?"opengl":"unknown"}function uF(e,t){if(/SwiftShader/i.exec(e)||/SwiftShader/i.exec(t))return"cpu";switch(S1(e,t)){case"intel":return"integrated";case"software":return"cpu";case"unknown":return"unknown";default:return"discrete"}}function C1(e){switch(e){case"uint8":return 5121;case"sint8":return 5120;case"unorm8":return 5121;case"snorm8":return 5120;case"uint16":return 5123;case"sint16":return 5122;case"unorm16":return 5123;case"snorm16":return 5122;case"uint32":return 5125;case"sint32":return 5124;case"float16":return 5131;case"float32":return 5126}throw new Error(String(e))}const Ki="texture-compression-bc",gr="texture-compression-astc",eo="texture-compression-etc2",hF="texture-compression-etc1-webgl",zf="texture-compression-pvrtc-webgl",wm="texture-compression-atc-webgl",bh="float32-renderable-webgl",Tm="float16-renderable-webgl",dF="rgb9e5ufloat_renderable-webgl",Am="snorm8-renderable-webgl",vh="norm16-renderable-webgl",Em="snorm16-renderable-webgl",Vf="float32-filterable",I1="float16-filterable-webgl",xh="WEBGL_compressed_texture_s3tc",wh="WEBGL_compressed_texture_s3tc_srgb",Ac="EXT_texture_compression_rgtc",Ec="EXT_texture_compression_bptc",fF="WEBGL_compressed_texture_etc",pF="WEBGL_compressed_texture_astc",_F="WEBGL_compressed_texture_etc1",gF="WEBGL_compressed_texture_pvrtc",mF="WEBGL_compressed_texture_atc",M1="EXT_texture_norm16",R1="EXT_render_snorm",yF="EXT_color_buffer_float",Sm={"float32-renderable-webgl":["EXT_color_buffer_float"],"float16-renderable-webgl":["EXT_color_buffer_half_float"],"rgb9e5ufloat_renderable-webgl":["WEBGL_render_shared_exponent"],"snorm8-renderable-webgl":[R1],"norm16-renderable-webgl":[M1],"snorm16-renderable-webgl":[M1,R1],"float32-filterable":["OES_texture_float_linear"],"float16-filterable-webgl":["OES_texture_half_float_linear"],"texture-filterable-anisotropic-webgl":["EXT_texture_filter_anisotropic"],"texture-blend-float-webgl":["EXT_float_blend"],"texture-compression-bc":[xh,wh,Ac,Ec],"texture-compression-bc5-webgl":[Ac],"texture-compression-bc7-webgl":[Ec],"texture-compression-etc2":[fF],"texture-compression-astc":[pF],"texture-compression-etc1-webgl":[_F],"texture-compression-pvrtc-webgl":[gF],"texture-compression-atc-webgl":[mF]};function bF(e){return e in Sm}function vF(e,t,r){return(Sm[t]||[]).every(a=>aa(e,a,r))}const jf={"rgb8unorm-unsized":{gl:6407,b:4,c:2,bpp:4,dataFormat:6407,types:[5121,33635]},"rgba8unorm-unsized":{gl:6408,b:4,c:2,bpp:4,dataFormat:6408,types:[5121,32819,32820]},r8unorm:{gl:33321,b:1,c:1,rb:!0},r8snorm:{gl:36756,b:1,c:1,render:Am},r8uint:{gl:33330,b:1,c:1,rb:!0},r8sint:{gl:33329,b:1,c:1,rb:!0},rg8unorm:{gl:33323,b:2,c:2,rb:!0},rg8snorm:{gl:36757,b:2,c:2,render:Am},rg8uint:{gl:33336,b:2,c:2,rb:!0},rg8sint:{gl:33335,b:2,c:2,rb:!0},r16uint:{gl:33332,b:2,c:1,rb:!0},r16sint:{gl:33331,b:2,c:1,rb:!0},r16float:{gl:33325,b:2,c:1,render:Tm,filter:"float16-filterable-webgl",rb:!0},"r16unorm-webgl":{gl:33322,b:2,c:1,f:vh,rb:!0},"r16snorm-webgl":{gl:36760,b:2,c:1,f:Em},"rgba4unorm-webgl":{gl:32854,b:2,c:4,wgpu:!1,rb:!0},"rgb565unorm-webgl":{gl:36194,b:2,c:4,wgpu:!1,rb:!0},"rgb5a1unorm-webgl":{gl:32855,b:2,c:4,wgpu:!1,rb:!0},"rgb8unorm-webgl":{gl:32849,b:3,c:3,wgpu:!1},"rgb8snorm-webgl":{gl:36758,b:3,c:3,wgpu:!1},rgba8unorm:{gl:32856,b:4,c:2,bpp:4},"rgba8unorm-srgb":{gl:35907,b:4,c:4,bpp:4},rgba8snorm:{gl:36759,b:4,c:4,render:Am},rgba8uint:{gl:36220,b:4,c:4,bpp:4},rgba8sint:{gl:36238,b:4,c:4,bpp:4},bgra8unorm:{b:4,c:4},"bgra8unorm-srgb":{b:4,c:4},rg16uint:{gl:33338,b:4,c:1,bpp:4},rg16sint:{gl:33337,b:4,c:2,bpp:4},rg16float:{gl:33327,bpp:4,b:4,c:2,render:Tm,filter:I1,rb:!0},"rg16unorm-webgl":{gl:33324,b:2,c:2,render:vh},"rg16snorm-webgl":{gl:36761,b:2,c:2,render:Em},r32uint:{gl:33334,b:4,c:1,bpp:4,rb:!0},r32sint:{gl:33333,b:4,c:1,bpp:4,rb:!0},r32float:{gl:33326,bpp:4,b:4,c:1,render:bh,filter:Vf},rgb9e5ufloat:{gl:35901,b:4,c:3,p:1,render:dF},rg11b10ufloat:{gl:35898,b:4,c:3,p:1,render:bh,rb:!0},rgb10a2unorm:{gl:32857,b:4,c:4,p:1,rb:!0},"rgb10a2uint-webgl":{b:4,c:4,gl:36975,p:1,wgpu:!1,bpp:4,rb:!0},"rgb16unorm-webgl":{gl:32852,b:2,c:3,f:vh},"rgb16snorm-webgl":{gl:36762,b:2,c:3,f:vh},rg32uint:{gl:33340,b:8,c:2,rb:!0},rg32sint:{gl:33339,b:8,c:2,rb:!0},rg32float:{gl:33328,b:8,c:2,render:bh,filter:Vf,rb:!0},rgba16uint:{gl:36214,b:8,c:4,rb:!0},rgba16sint:{gl:36232,b:8,c:4,rb:!0},rgba16float:{gl:34842,b:8,c:4,render:Tm,filter:I1},"rgba16unorm-webgl":{gl:32859,b:2,c:4,render:vh,rb:!0},"rgba16snorm-webgl":{gl:36763,b:2,c:4,render:Em},"rgb32float-webgl":{gl:34837,render:bh,filter:Vf,gl2ext:yF,dataFormat:6407,types:[5126]},rgba32uint:{gl:36208,b:16,c:4,rb:!0},rgba32sint:{gl:36226,b:16,c:4,rb:!0},rgba32float:{gl:34836,b:16,c:4,render:bh,filter:Vf,rb:!0},stencil8:{gl:36168,b:1,c:1,attachment:36128,rb:!0},depth16unorm:{gl:33189,b:2,c:1,attachment:36096,dataFormat:6402,types:[5123],rb:!0},depth24plus:{gl:33190,b:3,c:1,attachment:36096,dataFormat:6402,types:[5125]},depth32float:{gl:36012,b:4,c:1,attachment:36096,dataFormat:6402,types:[5126],rb:!0},"depth24plus-stencil8":{gl:35056,b:4,c:2,p:1,attachment:33306,rb:!0,depthTexture:!0,dataFormat:34041,types:[34042]},"depth24unorm-stencil8":{gl:35056,b:4,c:2,p:1,attachment:33306,dataFormat:34041,types:[34042],rb:!0},"depth32float-stencil8":{gl:36013,b:5,c:2,p:1,attachment:33306,dataFormat:34041,types:[36269],rb:!0},"bc1-rgb-unorm-webgl":{gl:33776,x:xh,f:Ki},"bc1-rgb-unorm-srgb-webgl":{gl:35916,x:wh,f:Ki},"bc1-rgba-unorm":{gl:33777,x:xh,f:Ki},"bc1-rgba-unorm-srgb":{gl:35916,x:wh,f:Ki},"bc2-rgba-unorm":{gl:33778,x:xh,f:Ki},"bc2-rgba-unorm-srgb":{gl:35918,x:wh,f:Ki},"bc3-rgba-unorm":{gl:33779,x:xh,f:Ki},"bc3-rgba-unorm-srgb":{gl:35919,x:wh,f:Ki},"bc4-r-unorm":{gl:36283,x:Ac,f:Ki},"bc4-r-snorm":{gl:36284,x:Ac,f:Ki},"bc5-rg-unorm":{gl:36285,x:Ac,f:Ki},"bc5-rg-snorm":{gl:36286,x:Ac,f:Ki},"bc6h-rgb-ufloat":{gl:36495,x:Ec,f:Ki},"bc6h-rgb-float":{gl:36494,x:Ec,f:Ki},"bc7-rgba-unorm":{gl:36492,x:Ec,f:Ki},"bc7-rgba-unorm-srgb":{gl:36493,x:Ec,f:Ki},"etc2-rgb8unorm":{gl:37492,f:eo},"etc2-rgb8unorm-srgb":{gl:37494,f:eo},"etc2-rgb8a1unorm":{gl:37496,f:eo},"etc2-rgb8a1unorm-srgb":{gl:37497,f:eo},"etc2-rgba8unorm":{gl:37493,f:eo},"etc2-rgba8unorm-srgb":{gl:37495,f:eo},"eac-r11unorm":{gl:37488,f:eo},"eac-r11snorm":{gl:37489,f:eo},"eac-rg11unorm":{gl:37490,f:eo},"eac-rg11snorm":{gl:37491,f:eo},"astc-4x4-unorm":{gl:37808,f:gr},"astc-4x4-unorm-srgb":{gl:37840,f:gr},"astc-5x4-unorm":{gl:37809,f:gr},"astc-5x4-unorm-srgb":{gl:37841,f:gr},"astc-5x5-unorm":{gl:37810,f:gr},"astc-5x5-unorm-srgb":{gl:37842,f:gr},"astc-6x5-unorm":{gl:37811,f:gr},"astc-6x5-unorm-srgb":{gl:37843,f:gr},"astc-6x6-unorm":{gl:37812,f:gr},"astc-6x6-unorm-srgb":{gl:37844,f:gr},"astc-8x5-unorm":{gl:37813,f:gr},"astc-8x5-unorm-srgb":{gl:37845,f:gr},"astc-8x6-unorm":{gl:37814,f:gr},"astc-8x6-unorm-srgb":{gl:37846,f:gr},"astc-8x8-unorm":{gl:37815,f:gr},"astc-8x8-unorm-srgb":{gl:37847,f:gr},"astc-10x5-unorm":{gl:37819,f:gr},"astc-10x5-unorm-srgb":{gl:37851,f:gr},"astc-10x6-unorm":{gl:37817,f:gr},"astc-10x6-unorm-srgb":{gl:37849,f:gr},"astc-10x8-unorm":{gl:37818,f:gr},"astc-10x8-unorm-srgb":{gl:37850,f:gr},"astc-10x10-unorm":{gl:37819,f:gr},"astc-10x10-unorm-srgb":{gl:37851,f:gr},"astc-12x10-unorm":{gl:37820,f:gr},"astc-12x10-unorm-srgb":{gl:37852,f:gr},"astc-12x12-unorm":{gl:37821,f:gr},"astc-12x12-unorm-srgb":{gl:37853,f:gr},"pvrtc-rgb4unorm-webgl":{gl:35840,f:zf},"pvrtc-rgba4unorm-webgl":{gl:35842,f:zf},"pvrtc-rbg2unorm-webgl":{gl:35841,f:zf},"pvrtc-rgba2unorm-webgl":{gl:35843,f:zf},"etc1-rbg-unorm-webgl":{gl:36196,f:hF},"atc-rgb-unorm-webgl":{gl:35986,f:wm},"atc-rgba-unorm-webgl":{gl:35986,f:wm},"atc-rgbai-unorm-webgl":{gl:34798,f:wm}},xF={6403:1,36244:1,33319:2,33320:2,6407:3,36248:3,6408:4,36249:4,6402:1,34041:1,6406:1,6409:1,6410:2},wF={5126:4,5125:4,5124:4,5123:2,5122:2,5131:2,5120:1,5121:1};function Cm(e,t,r){const n=jf[t];if(!n||n.gl===void 0)return!1;const a=n.x||n.gl2ext;return a?!!aa(e,a,r):!0}function P1(e){const r=jf[e]?.gl;if(r===void 0)throw new Error(`Unsupported texture format ${e}`);return r}function TF(e,t,r){if(!Cm(e,t,r)||t.startsWith("depth")||t.startsWith("stencil"))return!1;try{if(Rv(t).signed)return!1}catch{return!1}return t.endsWith("32float")?!!aa(e,"OES_texture_float_linear, extensions",r):t.endsWith("16float")?!!aa(e,"OES_texture_half_float_linear, extensions",r):!0}function AF(e,t,r){return!(!Cm(e,t,r)||typeof t=="number")}function Hf(e){const t=jf[e],r=P1(e),n=Rv(e);return{format:r,dataFormat:t?.dataFormat||SF(n.format,n.integer,n.normalized,r),type:n.dataType?C1(n.dataType):t?.types?.[0]||5121,compressed:n.compressed}}function EF(e){const t=jf[e];if(!t?.attachment)throw new Error(`${e} is not a depth stencil format`);return t.attachment}function B1(e){const t=Hf(e),r=xF[t.dataFormat]||4,n=wF[t.type]||1;return r*n}function SF(e,t,r,n){if(n===6408||n===6407)return n;switch(e){case"r":return t&&!r?36244:6403;case"rg":return t&&!r?33320:33319;case"rgb":return t&&!r?36248:6407;case"rgba":return t&&!r?36249:6408;default:return 6408}}const D1={"depth-clip-control":"EXT_depth_clamp","timer-query-webgl":"EXT_disjoint_timer_query_webgl2","compilation-status-async-webgl":"KHR_parallel_shader_compile","polygon-mode-webgl":"WEBGL_polygon_mode","provoking-vertex-webgl":"WEBGL_provoking_vertex","shader-clip-cull-distance-webgl":"WEBGL_clip_cull_distance","shader-noperspective-interpolation-webgl":"NV_shader_noperspective_interpolation","shader-conservative-depth-webgl":"EXT_conservative_depth"};class CF extends SM{gl;extensions;testedFeatures=new Set;constructor(t,r,n){super([],n),this.gl=t,this.extensions=r,aa(t,"EXT_color_buffer_float",r)}*[Symbol.iterator](){const t=this.getFeatures();for(const r of t)this.has(r)&&(yield r);return[]}has(t){return this.disabledFeatures[t]?!1:(this.testedFeatures.has(t)||(this.testedFeatures.add(t),bF(t)&&vF(this.gl,t,this.extensions)&&this.features.add(t),this.getWebGLFeature(t)&&this.features.add(t)),this.features.has(t))}initializeFeatures(){const t=this.getFeatures().filter(r=>r!=="polygon-mode-webgl");for(const r of t)this.has(r)}getFeatures(){return[...Object.keys(D1),...Object.keys(Sm)]}getWebGLFeature(t){const r=D1[t];return typeof r=="string"?!!aa(this.gl,r,this.extensions):!!r}}class IF extends EM{get maxTextureDimension1D(){return 0}get maxTextureDimension2D(){return this.getParameter(3379)}get maxTextureDimension3D(){return this.getParameter(32883)}get maxTextureArrayLayers(){return this.getParameter(35071)}get maxBindGroups(){return 0}get maxDynamicUniformBuffersPerPipelineLayout(){return 0}get maxDynamicStorageBuffersPerPipelineLayout(){return 0}get maxSampledTexturesPerShaderStage(){return this.getParameter(35660)}get maxSamplersPerShaderStage(){return this.getParameter(35661)}get maxStorageBuffersPerShaderStage(){return 0}get maxStorageTexturesPerShaderStage(){return 0}get maxUniformBuffersPerShaderStage(){return this.getParameter(35375)}get maxUniformBufferBindingSize(){return this.getParameter(35376)}get maxStorageBufferBindingSize(){return 0}get minUniformBufferOffsetAlignment(){return this.getParameter(35380)}get minStorageBufferOffsetAlignment(){return 0}get maxVertexBuffers(){return 16}get maxVertexAttributes(){return this.getParameter(34921)}get maxVertexBufferArrayStride(){return 2048}get maxInterStageShaderComponents(){return this.getParameter(35659)}get maxComputeWorkgroupStorageSize(){return 0}get maxComputeInvocationsPerWorkgroup(){return 0}get maxComputeWorkgroupSizeX(){return 0}get maxComputeWorkgroupSizeY(){return 0}get maxComputeWorkgroupSizeZ(){return 0}get maxComputeWorkgroupsPerDimension(){return 0}gl;limits={};constructor(t){super(),this.gl=t}getParameter(t){return this.limits[t]===void 0&&(this.limits[t]=this.gl.getParameter(t)),this.limits[t]}}function la(e,t,r){if(MF(t))return r(e);const{nocatch:n=!0}=t;Uf(e),Tc(e,t);let a;if(n)a=r(e),yh(e);else try{a=r(e)}finally{yh(e)}return a}function MF(e){for(const t in e)return!1;return!0}function RF(e,t,r,n){if(lf(t))return n(e);const a=e;Uf(a.gl);try{return PF(e,t),Tc(a.gl,r),n(e)}finally{yh(a.gl)}}function PF(e,t){const r=e,{gl:n}=r;if(t.cullMode)switch(t.cullMode){case"none":n.disable(2884);break;case"front":n.enable(2884),n.cullFace(1028);break;case"back":n.enable(2884),n.cullFace(1029);break}if(t.frontFace&&n.frontFace(sl("frontFace",t.frontFace,{ccw:2305,cw:2304})),t.unclippedDepth&&e.features.has("depth-clip-control")&&n.enable(34383),t.depthBias!==void 0&&(n.enable(32823),n.polygonOffset(t.depthBias,t.depthBiasSlopeScale||0)),t.provokingVertex&&e.features.has("provoking-vertex-webgl")){const d=r.getExtension("WEBGL_provoking_vertex").WEBGL_provoking_vertex,f=sl("provokingVertex",t.provokingVertex,{first:36429,last:36430});d?.provokingVertexWEBGL(f)}if((t.polygonMode||t.polygonOffsetLine)&&e.features.has("polygon-mode-webgl")){if(t.polygonMode){const d=r.getExtension("WEBGL_polygon_mode").WEBGL_polygon_mode,f=sl("polygonMode",t.polygonMode,{fill:6914,line:6913});d?.polygonModeWEBGL(1028,f),d?.polygonModeWEBGL(1029,f)}t.polygonOffsetLine&&n.enable(10754)}if(e.features.has("shader-clip-cull-distance-webgl")&&(t.clipDistance0&&n.enable(12288),t.clipDistance1&&n.enable(12289),t.clipDistance2&&n.enable(12290),t.clipDistance3&&n.enable(12291),t.clipDistance4&&n.enable(12292),t.clipDistance5&&n.enable(12293),t.clipDistance6&&n.enable(12294),t.clipDistance7&&n.enable(12295)),t.depthWriteEnabled!==void 0&&n.depthMask(DF("depthWriteEnabled",t.depthWriteEnabled)),t.depthCompare&&(t.depthCompare!=="always"?n.enable(2929):n.disable(2929),n.depthFunc(Im("depthCompare",t.depthCompare))),t.stencilWriteMask){const a=t.stencilWriteMask;n.stencilMaskSeparate(1028,a),n.stencilMaskSeparate(1029,a)}if(t.stencilReadMask&&te.warn("stencilReadMask not supported under WebGL"),t.stencilCompare){const a=t.stencilReadMask||4294967295,d=Im("depthCompare",t.stencilCompare);t.stencilCompare!=="always"?n.enable(2960):n.disable(2960),n.stencilFuncSeparate(1028,d,0,a),n.stencilFuncSeparate(1029,d,0,a)}if(t.stencilPassOperation&&t.stencilFailOperation&&t.stencilDepthFailOperation){const a=Mm("stencilPassOperation",t.stencilPassOperation),d=Mm("stencilFailOperation",t.stencilFailOperation),f=Mm("stencilDepthFailOperation",t.stencilDepthFailOperation);n.stencilOpSeparate(1028,d,f,a),n.stencilOpSeparate(1029,d,f,a)}if(t.blendColorOperation||t.blendAlphaOperation){n.enable(3042);const a=F1("blendColorOperation",t.blendColorOperation||"add"),d=F1("blendAlphaOperation",t.blendAlphaOperation||"add");n.blendEquationSeparate(a,d);const f=Gf("blendColorSrcFactor",t.blendColorSrcFactor||"one"),c=Gf("blendColorDstFactor",t.blendColorDstFactor||"zero"),T=Gf("blendAlphaSrcFactor",t.blendAlphaSrcFactor||"one"),C=Gf("blendAlphaDstFactor",t.blendAlphaDstFactor||"zero");n.blendFuncSeparate(f,c,T,C)}}function Im(e,t){return sl(e,t,{never:512,less:513,equal:514,"less-equal":515,greater:516,"not-equal":517,"greater-equal":518,always:519})}function Mm(e,t){return sl(e,t,{keep:7680,zero:0,replace:7681,invert:5386,"increment-clamp":7682,"decrement-clamp":7683,"increment-wrap":34055,"decrement-wrap":34056})}function F1(e,t){return sl(e,t,{add:32774,subtract:32778,"reverse-subtract":32779,min:32775,max:32776})}function Gf(e,t){return sl(e,t,{one:1,zero:0,"src-color":768,"one-minus-src-color":769,"dst-color":774,"one-minus-dst-color":775,"src-alpha":770,"one-minus-src-alpha":771,"dst-alpha":772,"one-minus-dst-alpha":773,"src-alpha-saturated":776,"constant-color":32769,"one-minus-constant-color":32770,"constant-alpha":32771,"one-minus-constant-alpha":32772})}function BF(e,t){return`Illegal parameter ${t} for ${e}`}function sl(e,t,r){if(!(t in r))throw new Error(BF(e,t));return r[t]}function DF(e,t){return t}function O1(e){const t={};return e.addressModeU&&(t[10242]=Rm(e.addressModeU)),e.addressModeV&&(t[10243]=Rm(e.addressModeV)),e.addressModeW&&(t[32882]=Rm(e.addressModeW)),e.magFilter&&(t[10240]=k1(e.magFilter)),(e.minFilter||e.mipmapFilter)&&(t[10241]=FF(e.minFilter||"linear",e.mipmapFilter)),e.lodMinClamp!==void 0&&(t[33082]=e.lodMinClamp),e.lodMaxClamp!==void 0&&(t[33083]=e.lodMaxClamp),e.type==="comparison-sampler"&&(t[34892]=34894),e.compare&&(t[34893]=Im("compare",e.compare)),e.maxAnisotropy&&(t[34046]=e.maxAnisotropy),t}function Rm(e){switch(e){case"clamp-to-edge":return 33071;case"repeat":return 10497;case"mirror-repeat":return 33648}}function k1(e){switch(e){case"nearest":return 9728;case"linear":return 9729}}function FF(e,t){if(!t)return k1(e);switch(e){case"nearest":return t==="nearest"?9984:9986;case"linear":return t==="nearest"?9985:9987}}class ca extends Fr{device;gl;handle;glTarget;glUsage;glIndexType=5123;byteLength;bytesUsed;constructor(t,r={}){super(t,r),this.device=t,this.gl=this.device.gl;const n=typeof r=="object"?r.handle:void 0;this.handle=n||this.gl.createBuffer(),t.setSpectorMetadata(this.handle,{...this.props,data:typeof this.props.data}),this.glTarget=OF(this.props.usage),this.glUsage=kF(this.props.usage),this.glIndexType=this.props.indexType==="uint32"?5125:5123,r.data?this._initWithData(r.data,r.byteOffset,r.byteLength):this._initWithByteLength(r.byteLength||0)}_initWithData(t,r=0,n=t.byteLength+r){const a=this.glTarget;this.gl.bindBuffer(a,this.handle),this.gl.bufferData(a,n,this.glUsage),this.gl.bufferSubData(a,r,t),this.gl.bindBuffer(a,null),this.bytesUsed=n,this.byteLength=n,this._setDebugData(t,r,n),this.trackAllocatedMemory(n)}_initWithByteLength(t){tr(t>=0);let r=t;t===0&&(r=new Float32Array(0));const n=this.glTarget;return this.gl.bindBuffer(n,this.handle),this.gl.bufferData(n,r,this.glUsage),this.gl.bindBuffer(n,null),this.bytesUsed=t,this.byteLength=t,this._setDebugData(null,0,t),this.trackAllocatedMemory(t),this}destroy(){!this.destroyed&&this.handle&&(this.removeStats(),this.trackDeallocatedMemory(),this.gl.deleteBuffer(this.handle),this.destroyed=!0,this.handle=null)}write(t,r=0){this.gl.bindBuffer(36663,this.handle),this.gl.bufferSubData(36663,r,t),this.gl.bindBuffer(36663,null),this._setDebugData(t,r,t.byteLength)}async readAsync(t=0,r){return this.readSyncWebGL(t,r)}readSyncWebGL(t=0,r){r=r??this.byteLength-t;const n=new Uint8Array(r),a=0;return this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,t,n,a,r),this.gl.bindBuffer(36662,null),this._setDebugData(n,t,r),n}}function OF(e){return e&Fr.INDEX?34963:e&Fr.VERTEX?34962:e&Fr.UNIFORM?35345:34962}function kF(e){return e&Fr.INDEX||e&Fr.VERTEX?35044:e&Fr.UNIFORM?35048:35044}class Pm extends df{device;handle;parameters;constructor(t,r){super(t,r),this.device=t,this.parameters=O1(r),this.handle=this.handle||this.device.gl.createSampler(),this._setSamplerParameters(this.parameters)}destroy(){this.handle&&(this.device.gl.deleteSampler(this.handle),this.handle=void 0)}toString(){return`Sampler(${this.id},${JSON.stringify(this.props)})`}_setSamplerParameters(t){for(const[r,n]of Object.entries(t)){const a=Number(r);switch(a){case 33082:case 33083:this.device.gl.samplerParameterf(this.handle,a,n);break;default:this.device.gl.samplerParameteri(this.handle,a,n);break}}}}class Sc extends uf{device;gl;handle;texture;constructor(t,r){super(t,{...Is.defaultProps,...r}),this.device=t,this.gl=this.device.gl,this.handle=null,this.texture=r.texture}}const NF={parameters:{},pixelStore:{},pixels:null,border:0,dataFormat:void 0,textureUnit:void 0,target:void 0};class Cn extends Is{static FACES=[34069,34070,34071,34072,34073,34074];MAX_ATTRIBUTES;device;gl;handle;sampler=void 0;view=void 0;glFormat=void 0;type=void 0;dataFormat=void 0;mipmaps=void 0;target;textureUnit=void 0;loaded=!1;_video;constructor(t,r){super(t,{...NF,format:"rgba8unorm",...r}),this.device=t,this.gl=this.device.gl,this.handle=this.props.handle||this.gl.createTexture(),this.device.setSpectorMetadata(this.handle,{...this.props,data:typeof this.props.data}),this.glFormat=6408,this.target=LF(this.props),this.loaded=!1,typeof this.props?.data=="string"&&Object.assign(this.props,{data:fR(this.props.data)}),this.initialize(this.props),Object.seal(this)}destroy(){this.handle&&(this.gl.deleteTexture(this.handle),this.removeStats(),this.trackDeallocatedMemory("Texture"),this.destroyed=!0)}toString(){return`Texture(${this.id},${this.width}x${this.height})`}createView(t){return new Sc(this.device,{...t,texture:this})}initialize(t={}){if(this.props.dimension==="cube")return this.initializeCube(t);let r=t.data;if(r instanceof Promise)return r.then(K=>this.initialize(Object.assign({},t,{pixels:K,data:K}))),this;const n=typeof HTMLVideoElement<"u"&&r instanceof HTMLVideoElement;if(n&&r.readyState<HTMLVideoElement.HAVE_METADATA)return this._video=null,r.addEventListener("loadeddata",()=>this.initialize(t)),this;const{parameters:a={}}=t,{pixels:d=null,pixelStore:f={},textureUnit:c=void 0,mipmaps:T=!0}=t;r||(r=d);let{width:C,height:R,dataFormat:L,type:V,compressed:X=!1}=t;const{depth:at=0}=t,nt=P1(t.format);return{width:C,height:R,compressed:X,dataFormat:L,type:V}=this._deduceParameters({format:t.format,type:V,dataFormat:L,compressed:X,data:r,width:C,height:R}),this.width=C,this.height=R,this.glFormat=nt,this.type=V,this.dataFormat=L,this.textureUnit=c,Number.isFinite(this.textureUnit)&&(this.gl.activeTexture(33984+this.textureUnit),this.gl.bindTexture(this.target,this.handle)),this.mipmaps=T,this.setImageData({data:r,width:C,height:R,depth:at,format:t.format,type:V,dataFormat:L,parameters:f,compressed:X}),this.setSampler(t.sampler),this._setSamplerParameters(a),this.view=this.createView({...this.props,mipLevelCount:1,arrayLayerCount:1}),T&&this.device.isTextureFormatFilterable(t.format)&&this.generateMipmap(),n&&(this._video={video:r,parameters:a,lastTime:r.readyState>=HTMLVideoElement.HAVE_CURRENT_DATA?r.currentTime:-1}),this}initializeCube(t){const{mipmaps:r=!0,parameters:n={}}=t;return this.setCubeMapImageData(t).then(()=>{this.loaded=!0,r&&this.generateMipmap(t),this.setSampler(t.sampler),this._setSamplerParameters(n)}),this}setSampler(t={}){let r;t instanceof Pm?(this.sampler=t,r=t.props):(this.sampler=new Pm(this.device,t),r=t);const n=O1(r);return this._setSamplerParameters(n),this}resize(t){const{height:r,width:n,mipmaps:a=!1}=t;return n!==this.width||r!==this.height?this.initialize({width:n,height:r,format:this.format,type:this.type,dataFormat:this.dataFormat,mipmaps:a}):this}update(){if(this._video){const{video:t,parameters:r,lastTime:n}=this._video;if(n===t.currentTime||t.readyState<HTMLVideoElement.HAVE_CURRENT_DATA)return;this.setSubImageData({data:t,parameters:r}),this.mipmaps&&this.generateMipmap(),this._video.lastTime=t.currentTime}}generateMipmap(t={}){return this.mipmaps=!0,this.gl.bindTexture(this.target,this.handle),la(this.gl,t,()=>{this.gl.generateMipmap(this.target)}),this.gl.bindTexture(this.target,null),this}setImageData(t){if(this.props.dimension==="3d"||this.props.dimension==="2d-array")return this.setImageData3D(t);this.trackDeallocatedMemory("Texture");const{target:r=this.target,pixels:n=null,level:a=0,glFormat:d=this.glFormat,offset:f=0,parameters:c={}}=t;let{data:T=null,type:C=this.type,width:R=this.width,height:L=this.height,dataFormat:V=this.dataFormat,compressed:X=!1}=t;T||(T=n),{type:C,dataFormat:V,compressed:X,width:R,height:L}=this._deduceParameters({format:this.props.format,type:C,dataFormat:V,compressed:X,data:T,width:R,height:L});const{gl:at}=this;at.bindTexture(this.target,this.handle);let nt=null;if({data:T,dataType:nt}=this._getDataType({data:T,compressed:X}),la(this.gl,c,()=>{switch(nt){case"null":at.texImage2D(r,a,d,R,L,0,V,C,T);break;case"typed-array":at.texImage2D(r,a,d,R,L,0,V,C,T,f);break;case"buffer":this.device.gl.bindBuffer(35052,T.handle||T),this.device.gl.texImage2D(r,a,d,R,L,0,V,C,f),this.device.gl.bindBuffer(35052,null);break;case"browser-object":at.texImage2D(r,a,d,R,L,0,V,C,T);break;case"compressed":for(const[K,It]of T.entries())at.compressedTexImage2D(r,K,It.format,It.width,It.height,0,It.data);break;default:tr(!1,"Unknown image data type")}}),T&&T.byteLength)this.trackAllocatedMemory(T.byteLength,"Texture");else{const K=B1(this.props.format);this.trackAllocatedMemory(this.width*this.height*K,"Texture")}return this.loaded=!0,this}setSubImageData({target:t=this.target,pixels:r=null,data:n=null,x:a=0,y:d=0,width:f=this.width,height:c=this.height,level:T=0,glFormat:C=this.glFormat,type:R=this.type,dataFormat:L=this.dataFormat,compressed:V=!1,offset:X=0,parameters:at={}}){if({type:R,dataFormat:L,compressed:V,width:f,height:c}=this._deduceParameters({format:this.props.format,type:R,dataFormat:L,compressed:V,data:n,width:f,height:c}),tr(this.depth===1,"texSubImage not supported for 3D textures"),n||(n=r),n&&n.data){const nt=n;n=nt.data,f=nt.shape[0],c=nt.shape[1]}n instanceof ca&&(n=n.handle),this.gl.bindTexture(this.target,this.handle),la(this.gl,at,()=>{V?this.gl.compressedTexSubImage2D(t,T,a,d,f,c,C,n):n===null?this.gl.texSubImage2D(t,T,a,d,f,c,L,R,null):ArrayBuffer.isView(n)?this.gl.texSubImage2D(t,T,a,d,f,c,L,R,n,X):typeof WebGLBuffer<"u"&&n instanceof WebGLBuffer?(this.device.gl.bindBuffer(35052,n),this.device.gl.texSubImage2D(t,T,a,d,f,c,L,R,X),this.device.gl.bindBuffer(35052,null)):this.device.gl.texSubImage2D(t,T,a,d,f,c,L,R,n)}),this.gl.bindTexture(this.target,null)}copyFramebuffer(t={}){return te.error("Texture.copyFramebuffer({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(t=this.textureUnit){const{gl:r}=this;return t!==void 0&&(this.textureUnit=t,r.activeTexture(33984+t)),r.bindTexture(this.target,this.handle),t}unbind(t=this.textureUnit){const{gl:r}=this;return t!==void 0&&(this.textureUnit=t,r.activeTexture(33984+t)),r.bindTexture(this.target,null),t}_getDataType({data:t,compressed:r=!1}){return r?{data:t,dataType:"compressed"}:t===null?{data:t,dataType:"null"}:ArrayBuffer.isView(t)?{data:t,dataType:"typed-array"}:t instanceof ca?{data:t.handle,dataType:"buffer"}:typeof WebGLBuffer<"u"&&t instanceof WebGLBuffer?{data:t,dataType:"buffer"}:{data:t,dataType:"browser-object"}}_deduceParameters(t){const{format:r,data:n}=t;let{width:a,height:d,dataFormat:f,type:c,compressed:T}=t;const C=Hf(r);return f=f||C.dataFormat,c=c||C.type,T=T||C.compressed,{width:a,height:d}=this._deduceImageSize(n,a,d),{dataFormat:f,type:c,compressed:T,width:a,height:d,format:r,data:n}}_deduceImageSize(t,r,n){let a;return typeof ImageData<"u"&&t instanceof ImageData?a={width:t.width,height:t.height}:typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement?a={width:t.naturalWidth,height:t.naturalHeight}:typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement?a={width:t.width,height:t.height}:typeof ImageBitmap<"u"&&t instanceof ImageBitmap?a={width:t.width,height:t.height}:typeof HTMLVideoElement<"u"&&t instanceof HTMLVideoElement?a={width:t.videoWidth,height:t.videoHeight}:t?a={width:r,height:n}:a={width:r>=0?r:1,height:n>=0?n:1},tr(a,"Could not deduced texture size"),tr(r===void 0||a.width===r,"Deduced texture width does not match supplied width"),tr(n===void 0||a.height===n,"Deduced texture height does not match supplied height"),a}async setCubeMapImageData(t){const{gl:r}=this,{width:n,height:a,pixels:d,data:f,format:c=6408,type:T=5121}=t,C=d||f,R=await Promise.all(Cn.FACES.map(L=>{const V=C[L];return Promise.all(Array.isArray(V)?V:[V])}));this.bind(),Cn.FACES.forEach((L,V)=>{R[V].length>1&&this.props.mipmaps!==!1&&te.warn(`${this.id} has mipmap and multiple LODs.`)(),R[V].forEach((X,at)=>{n&&a?r.texImage2D(L,at,c,n,a,0,c,T,X):r.texImage2D(L,at,c,c,T,X)})}),this.unbind()}setImageDataForFace(t){const{face:r,width:n,height:a,pixels:d,data:f,format:c=6408,type:T=5121}=t,{gl:C}=this,R=d||f;return this.bind(),R instanceof Promise?R.then(L=>this.setImageDataForFace(Object.assign({},t,{face:r,data:L,pixels:L}))):this.width||this.height?C.texImage2D(r,0,c,n,a,0,c,T,R):C.texImage2D(r,0,c,c,T,R),this}setImageData3D(t){const{level:r=0,dataFormat:n,format:a,type:d,width:f,height:c,depth:T=1,offset:C=0,data:R,parameters:L={}}=t;this.trackDeallocatedMemory("Texture"),this.gl.bindTexture(this.target,this.handle);const V=Hf(a);if(la(this.gl,L,()=>{ArrayBuffer.isView(R)&&this.gl.texImage3D(this.target,r,V.format,f,c,T,0,V.dataFormat,V.type,R),R instanceof ca&&(this.gl.bindBuffer(35052,R.handle),this.gl.texImage3D(this.target,r,n,f,c,T,0,a,d,C))}),R&&R.byteLength)this.trackAllocatedMemory(R.byteLength,"Texture");else{const X=B1(this.props.format);this.trackAllocatedMemory(this.width*this.height*this.depth*X,"Texture")}return this.loaded=!0,this}_setSamplerParameters(t){if(!lf(t)){UF(t),this.gl.bindTexture(this.target,this.handle);for(const[r,n]of Object.entries(t)){const a=Number(r),d=n;switch(a){case 33082:case 33083:this.gl.texParameterf(this.target,a,d);break;default:this.gl.texParameteri(this.target,a,d);break}}this.gl.bindTexture(this.target,null)}}}function LF(e){switch(e.dimension){case"2d":return 3553;case"cube":return 34067;case"2d-array":return 35866;case"3d":return 32879;case"1d":case"cube-array":default:throw new Error(e.dimension)}}function UF(e){te.log(1,"texture sampler parameters",e)()}class Th extends ff{device;gl;handle;get texture(){return this.colorAttachments[0]}constructor(t,r){super(t,r);const n=r.handle===null;if(this.device=t,this.gl=t.gl,this.handle=this.props.handle||n?this.props.handle:this.gl.createFramebuffer(),!n){t.setSpectorMetadata(this.handle,{id:this.props.id,props:this.props}),this.autoCreateAttachmentTextures();const a=this.gl.bindFramebuffer(36160,this.handle);for(let d=0;d<this.colorAttachments.length;++d){const f=this.colorAttachments[d],c=36064+d;f&&this._attachOne(c,f)}if(this.depthStencilAttachment&&this._attachOne(EF(this.depthStencilAttachment.props.format),this.depthStencilAttachment),r.check!==!1){const d=this.gl.checkFramebufferStatus(36160);if(d!==36053)throw new Error(`Framebuffer ${VF(d)}`)}this.gl.bindFramebuffer(36160,a)}}destroy(){super.destroy(),!this.destroyed&&this.handle!==null&&this.gl.deleteFramebuffer(this.handle)}createDepthStencilTexture(t){return new Cn(this.device,{id:`${this.id}-depth-stencil`,format:t,width:this.width,height:this.height,mipmaps:!1})}resizeAttachments(t,r){if(this.handle===null)return this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight,this;t===void 0&&(t=this.gl.drawingBufferWidth),r===void 0&&(r=this.gl.drawingBufferHeight);for(const n of this.colorAttachments)n.texture.resize({width:t,height:r});return this.depthStencilAttachment&&this.depthStencilAttachment.texture.resize({width:t,height:r}),this}_attachOne(t,r){if(Array.isArray(r)){const[n,a=0,d=0]=r;return this._attachTexture(t,n,a,d),n}if(r instanceof Cn)return this._attachTexture(t,r,0,0),r;if(r instanceof Sc){const n=r;return this._attachTexture(t,n.texture,n.props.baseMipLevel,n.props.baseArrayLayer),r.texture}throw new Error("attach")}_attachTexture(t,r,n,a){const{gl:d}=this.device;switch(d.bindTexture(r.target,r.handle),r.target){case 35866:case 32879:d.framebufferTextureLayer(36160,t,r.target,a,n);break;case 34067:const f=zF(n);d.framebufferTexture2D(36160,t,f,r.handle,a);break;case 3553:d.framebufferTexture2D(36160,t,3553,r.handle,a);break;default:tr(!1,"Illegal texture type")}d.bindTexture(r.target,null)}}function zF(e){return e<34069?e+34069:e}function VF(e){switch(e){case 36053:return"success";case 36054:return"Mismatched attachments";case 36055:return"No attachments";case 36057:return"Height/width mismatch";case 36061:return"Unsupported or split attachments";case 36182:return"Samples mismatch";default:return`${e}`}}class jF extends Bv{device;presentationSize;_framebuffer=null;constructor(t,r){super(r),this.device=t,this.presentationSize=[-1,-1],this._setAutoCreatedCanvasId(`${this.device.id}-canvas`),this.update()}getCurrentFramebuffer(){return this.update(),this._framebuffer=this._framebuffer||new Th(this.device,{handle:null}),this._framebuffer}update(){const t=this.getPixelSize();(t[0]!==this.presentationSize[0]||t[1]!==this.presentationSize[1])&&(this.presentationSize=t,this.resize())}resize(t){if(this.device.gl&&this.canvas){const r=this.getDevicePixelRatio(t?.useDevicePixels);this.setDevicePixelRatio(r,t);return}}commit(){}}const HF={spector:te.get("spector")||te.get("spectorjs")},GF="https://cdn.jsdelivr.net/npm/spectorjs@0.9.30/dist/spector.bundle.js",$F=1;let _s=null,N1=!1;async function WF(e){if(!globalThis.SPECTOR)try{await Gv(GF)}catch(t){te.warn(String(t))}}function XF(e){if(e={...HF,...e},!e?.spector||(!_s&&globalThis.SPECTOR&&(te.probe($F,"SPECTOR found and initialized")(),_s=new globalThis.SPECTOR.Spector,globalThis.luma&&(globalThis.luma.spector=_s)),!_s))return null;if(N1||(N1=!0,_s.spyCanvases(),_s?.onCaptureStarted.add(t=>te.info("Spector capture started:",t)()),_s?.onCapture.add(t=>{te.info("Spector capture complete:",t)(),_s?.getResultUI(),_s?.resultView.display(),_s?.resultView.addCapture(t)})),e?.canvas){if(typeof e.spector=="string"&&e.spector!==e.canvas.id)return _s;_s?.startCapture(e?.canvas,500),new Promise(t=>setTimeout(t,2e3)).then(t=>{te.info("Spector capture stopped after 2 seconds")(),_s?.stopCapture()})}return _s}const qF="https://unpkg.com/webgl-debug@2.0.1/index.js";function L1(e){return e.luma=e.luma||{},e.luma}async function ZF(){Zo()&&!globalThis.WebGLDebugUtils&&(globalThis.global=globalThis.global||globalThis,globalThis.global.module={},await Gv(qF))}function YF(e,t={}){return e?t.debug?JF(e,t):KF(e):null}function KF(e){const t=L1(e);return t.realContext?t.realContext:e}function JF(e,t){if(!globalThis.WebGLDebugUtils)return te.warn("webgl-debug not loaded")(),e;const r=L1(e);if(r.debugContext)return r.debugContext;globalThis.WebGLDebugUtils.init({...wc,...e});const n=globalThis.WebGLDebugUtils.makeDebugContext(e,QF.bind(null,t),tO.bind(null,t));for(const f in wc)!(f in n)&&typeof wc[f]=="number"&&(n[f]=wc[f]);class a{}Object.setPrototypeOf(n,Object.getPrototypeOf(e)),Object.setPrototypeOf(a,n);const d=Object.create(a);return r.realContext=e,r.debugContext=d,d.debug=!0,d}function Bm(e,t){t=Array.from(t).map(n=>n===void 0?"undefined":n);let r=globalThis.WebGLDebugUtils.glFunctionArgsToString(e,t);return r=`${r.slice(0,100)}${r.length>100?"...":""}`,`gl.${e}(${r})`}function QF(e,t,r,n){n=Array.from(n).map(c=>c===void 0?"undefined":c);const a=globalThis.WebGLDebugUtils.glEnumToString(t),d=globalThis.WebGLDebugUtils.glFunctionArgsToString(r,n),f=`${a} in gl.${r}(${d})`;te.error(f)();debugger;if(e.throwOnError)throw new Error(f)}function tO(e,t,r){let n="";if(te.level>=1&&(n=Bm(t,r),te.log(1,n)()),e.break&&e.break.length>0&&(n=n||Bm(t,r),e.break.every(d=>n.indexOf(d)!==-1)))debugger;for(const a of r)if(a===void 0){if(n=n||Bm(t,r),e.throwOnError)throw new Error(`Undefined argument: ${n}`);te.error(`Undefined argument: ${n}`)();debugger}}function eO(e){const t=e.split(/\r?\n/),r=[];for(const n of t){if(n.length<=1)continue;const a=n.split(":");if(a.length===2){const[L,V]=a;r.push({message:V.trim(),type:U1(L),lineNum:0,linePos:0});continue}const[d,f,c,...T]=a;let C=parseInt(c,10);isNaN(C)&&(C=0);let R=parseInt(f,10);isNaN(R)&&(R=0),r.push({message:T.join(":").trim(),type:U1(d),lineNum:C,linePos:R})}return r}function U1(e){const t=["warning","error","info"],r=e.toLowerCase();return t.includes(r)?r:"info"}class rO extends hf{device;handle;constructor(t,r){switch(super(t,r),this.device=t,this.props.stage){case"vertex":this.handle=this.props.handle||this.device.gl.createShader(35633);break;case"fragment":this.handle=this.props.handle||this.device.gl.createShader(35632);break;default:throw new Error(this.props.stage)}this._compile(this.source)}destroy(){this.handle&&(this.removeStats(),this.device.gl.deleteShader(this.handle),this.destroyed=!0)}async getCompilationInfo(){return await this._waitForCompilationComplete(),this.getCompilationInfoSync()}getCompilationInfoSync(){const t=this.device.gl.getShaderInfoLog(this.handle);return eO(t)}getTranslatedSource(){return this.device.getExtension("WEBGL_debug_shaders").WEBGL_debug_shaders?.getTranslatedShaderSource(this.handle)}async _compile(t){t=(a=>a.startsWith("#version ")?a:`#version 100
${a}`)(t);const{gl:n}=this.device;if(n.shaderSource(this.handle,t),n.compileShader(this.handle),te.level===0){this.compilationStatus="pending";return}if(!this.device.features.has("compilation-status-async-webgl")){if(this._getCompilationStatus(),this.debugShader(),this.compilationStatus==="error")throw new Error(`GLSL compilation errors in ${this.props.stage} shader ${this.props.id}`);return}te.once(1,"Shader compilation is asynchronous")(),await this._waitForCompilationComplete(),te.info(2,`Shader ${this.id} - async compilation complete: ${this.compilationStatus}`)(),this._getCompilationStatus(),this.debugShader()}async _waitForCompilationComplete(){const t=async a=>await new Promise(d=>setTimeout(d,a));if(!this.device.features.has("compilation-status-async-webgl")){await t(10);return}const{gl:n}=this.device;for(;;){if(n.getShaderParameter(this.handle,37297))return;await t(10)}}_getCompilationStatus(){this.compilationStatus=this.device.gl.getShaderParameter(this.handle,35713)?"success":"error"}}const iO=256,sO=1024,nO=16384,Dm=6144,oO=[1,2,4,8];class aO extends Eg{device;glParameters;constructor(t,r){super(t,r),this.device=t,Uf(this.device.gl),this.setParameters(this.props.parameters),this.clear()}end(){yh(this.device.gl)}pushDebugGroup(t){}popDebugGroup(){}insertDebugMarker(t){}setParameters(t={}){const r={...this.glParameters};this.props.framebuffer&&(r.framebuffer=this.props.framebuffer),this.props.depthReadOnly&&(r.depthMask=!this.props.depthReadOnly),r.stencilMask=this.props.stencilReadOnly?0:1,r[35977]=this.props.discard,t.viewport&&(t.viewport.length>=6?(r.viewport=t.viewport.slice(0,4),r.depthRange=[t.viewport[4],t.viewport[5]]):r.viewport=t.viewport),t.scissorRect&&(r.scissorTest=!0,r.scissor=t.scissorRect),t.blendConstant&&(r.blendColor=t.blendConstant),t.stencilReference&&(console.warn("RenderPassParameters.stencilReference not yet implemented in WebGL"),t[2967]=t.stencilReference),t.colorMask&&(r.colorMask=oO.map(n=>!!(n&t.colorMask))),this.glParameters=r,Tc(this.device.gl,r)}beginOcclusionQuery(t){this.props.occlusionQuerySet?.beginOcclusionQuery()}endOcclusionQuery(){this.props.occlusionQuerySet?.endOcclusionQuery()}clear(){const t={...this.glParameters};let r=0;this.props.clearColor!==!1&&(r|=nO,t.clearColor=this.props.clearColor),this.props.clearDepth!==!1&&(r|=iO,t.clearDepth=this.props.clearDepth),this.props.clearStencil!==!1&&(r|=sO,t.clearStencil=this.props.clearStencil),r!==0&&la(this.device.gl,t,()=>{this.device.gl.clear(r)})}clearColorBuffer(t=0,r=[0,0,0,0]){la(this.device.gl,{framebuffer:this.props.framebuffer},()=>{switch(r.constructor){case Int32Array:this.device.gl.clearBufferiv(Dm,t,r);break;case Uint32Array:this.device.gl.clearBufferuiv(Dm,t,r);break;case Float32Array:default:this.device.gl.clearBufferfv(Dm,t,r);break}})}}const lO="Failed to deduce GL constant from typed array";function cO(e){switch(ArrayBuffer.isView(e)?e.constructor:e){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:return 5121;case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(lO)}}function Fm(e,t){const{clamped:r=!0}=t||{};switch(e){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return r?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}const uO={offset:0,stride:0,type:5126,size:1,divisor:0,normalized:!1,integer:!1},hO={deprecatedProps:{instanced:"divisor",isInstanced:"divisor"}};class Ah{offset;stride;type;size;divisor;normalized;integer;buffer;index;static getBytesPerElement(t){return Fm(t.type||5126).BYTES_PER_ELEMENT}static getBytesPerVertex(t){return tr(t.size),Fm(t.type||5126).BYTES_PER_ELEMENT*t.size}static resolve(...t){return new Ah(uO,...t)}constructor(...t){t.forEach(r=>this._assign(r)),Object.freeze(this)}toString(){return JSON.stringify(this)}get BYTES_PER_ELEMENT(){return Ah.getBytesPerElement(this)}get BYTES_PER_VERTEX(){return Ah.getBytesPerVertex(this)}_assign(t={}){return t=hR("Accessor",t,hO),t.type!==void 0&&(this.type=t.type,(t.type===5124||t.type===5125)&&(this.integer=!0)),t.size!==void 0&&(this.size=t.size),t.offset!==void 0&&(this.offset=t.offset),t.stride!==void 0&&(this.stride=t.stride),t.normalize!==void 0&&(this.normalized=t.normalize),t.normalized!==void 0&&(this.normalized=t.normalized),t.integer!==void 0&&(this.integer=t.integer),t.divisor!==void 0&&(this.divisor=t.divisor),t.buffer!==void 0&&(this.buffer=t.buffer),t.index!==void 0&&(typeof t.index=="boolean"?this.index=t.index?1:0:this.index=t.index),t.instanced!==void 0&&(this.divisor=t.instanced?1:0),t.isInstanced!==void 0&&(this.divisor=t.isInstanced?1:0),this.offset===void 0&&delete this.offset,this.stride===void 0&&delete this.stride,this.type===void 0&&delete this.type,this.size===void 0&&delete this.size,this.divisor===void 0&&delete this.divisor,this.normalized===void 0&&delete this.normalized,this.integer===void 0&&delete this.integer,this.buffer===void 0&&delete this.buffer,this.index===void 0&&delete this.index,this}}function dO(e){return fO.includes(e)}const fO=[35678,35680,35679,35682,36289,36292,36293,36298,36299,36300,36303,36306,36307,36308,36311],z1={5126:[5126,1,"float","f32","float32"],35664:[5126,2,"vec2","vec2<f32>","float32x2"],35665:[5126,3,"vec3","vec3<f32>","float32x3"],35666:[5126,4,"vec4","vec4<f32>","float32x4"],5124:[5124,1,"int","i32","sint32"],35667:[5124,2,"ivec2","vec2<i32>","sint32x2"],35668:[5124,3,"ivec3","vec3<i32>","sint32x3"],35669:[5124,4,"ivec4","vec4<i32>","sint32x4"],5125:[5125,1,"uint","u32","uint32"],36294:[5125,2,"uvec2","vec2<u32>","uint32x2"],36295:[5125,3,"uvec3","vec3<u32>","uint32x3"],36296:[5125,4,"uvec4","vec4<u32>","uint32x4"],35670:[5126,1,"bool","f32","float32"],35671:[5126,2,"bvec2","vec2<f32>","float32x2"],35672:[5126,3,"bvec3","vec3<f32>","float32x3"],35673:[5126,4,"bvec4","vec4<f32>","float32x4"],35674:[5126,8,"mat2","mat2x2<f32>"],35685:[5126,8,"mat2x3","mat2x3<f32>"],35686:[5126,8,"mat2x4","mat2x4<f32>"],35687:[5126,12,"mat3x2","mat3x2<f32>"],35675:[5126,12,"mat3","mat3x3<f32>"],35688:[5126,12,"mat3x4","mat3x4<f32>"],35689:[5126,16,"mat4x2","mat4x2<f32>"],35690:[5126,16,"mat4x3","mat4x3<f32>"],35676:[5126,16,"mat4","mat4x4<f32>"]};function V1(e){const t=z1[e];if(!t)throw new Error("uniform");const[r,n,,a]=t;return{format:a,components:n,glType:r}}function pO(e){const t=z1[e];if(!t)throw new Error("attribute");const[,r,,n,a]=t;return{attributeType:n,vertexFormat:a,components:r}}function _O(e,t){const r={attributes:[],bindings:[]};r.attributes=gO(e,t);const n=bO(e,t);for(const c of n){const T=c.uniforms.map(C=>({name:C.name,format:C.format,byteOffset:C.byteOffset,byteStride:C.byteStride,arrayLength:C.arrayLength}));r.bindings.push({type:"uniform",name:c.name,location:c.location,visibility:(c.vertex?1:0)&(c.fragment?2:0),minBindingSize:c.byteLength,uniforms:T})}const a=yO(e,t);let d=0;for(const c of a)if(dO(c.type)){const{viewDimension:T,sampleType:C}=xO(c.type);r.bindings.push({type:"texture",name:c.name,location:d,viewDimension:T,sampleType:C}),c.textureUnit=d,d+=1}a.length&&(r.uniforms=a);const f=mO(e,t);return f?.length&&(r.varyings=f),r}function gO(e,t){const r=[],n=e.getProgramParameter(t,35721);for(let a=0;a<n;a++){const d=e.getActiveAttrib(t,a);if(!d)throw new Error("activeInfo");const{name:f,type:c}=d,T=e.getAttribLocation(t,f);if(T>=0){const{attributeType:C}=pO(c),R=/instance/i.test(f)?"instance":"vertex";r.push({name:f,location:T,stepMode:R,type:C})}}return r.sort((a,d)=>a.location-d.location),r}function mO(e,t){const r=[],n=e.getProgramParameter(t,35971);for(let a=0;a<n;a++){const d=e.getTransformFeedbackVarying(t,a);if(!d)throw new Error("activeInfo");const{name:f,type:c,size:T}=d,{glType:C,components:R}=V1(c),L=new Ah({type:C,size:T*R}),V={location:a,name:f,accessor:L};r.push(V)}return r.sort((a,d)=>a.location-d.location),r}function yO(e,t){const r=[],n=e.getProgramParameter(t,35718);for(let a=0;a<n;a++){const d=e.getActiveUniform(t,a);if(!d)throw new Error("activeInfo");const{name:f,size:c,type:T}=d,{name:C,isArray:R}=wO(f);let L=e.getUniformLocation(t,C);const V={location:L,name:C,size:c,type:T,isArray:R};if(r.push(V),V.size>1)for(let X=0;X<V.size;X++){const at=`${C}[${X}]`;L=e.getUniformLocation(t,at);const nt={...V,name:at,location:L};r.push(nt)}}return r}function bO(e,t){const r=(d,f)=>e.getActiveUniformBlockParameter(t,d,f),n=[],a=e.getProgramParameter(t,35382);for(let d=0;d<a;d++){const f={name:e.getActiveUniformBlockName(t,d)||"",location:r(d,35391),byteLength:r(d,35392),vertex:r(d,35396),fragment:r(d,35398),uniformCount:r(d,35394),uniforms:[]},c=r(d,35395)||[],T=e.getActiveUniforms(t,c,35383),C=e.getActiveUniforms(t,c,35384),R=e.getActiveUniforms(t,c,35387),L=e.getActiveUniforms(t,c,35388);for(let V=0;V<f.uniformCount;++V){const X=e.getActiveUniform(t,c[V]);if(!X)throw new Error("activeInfo");f.uniforms.push({name:X.name,format:V1(T[V]).format,type:T[V],arrayLength:C[V],byteOffset:R[V],byteStride:L[V]})}n.push(f)}return n.sort((d,f)=>d.location-f.location),n}const vO={35678:["2d","float"],35680:["cube","float"],35679:["3d","float"],35682:["3d","depth"],36289:["2d-array","float"],36292:["2d-array","depth"],36293:["cube","float"],36298:["2d","sint"],36299:["3d","sint"],36300:["cube","sint"],36303:["2d-array","uint"],36306:["2d","uint"],36307:["3d","uint"],36308:["cube","uint"],36311:["2d-array","uint"]};function xO(e){const t=vO[e];if(!t)throw new Error("sampler");const[r,n]=t;return{viewDimension:r,sampleType:n}}function wO(e){if(e[e.length-1]!=="]")return{name:e,length:1,isArray:!1};const r=/([^[]*)(\[[0-9]+\])?/.exec(e);if(!r||r.length<2)throw new Error(`Failed to parse GLSL uniform name ${e}`);return{name:r[1],length:r[2]?1:0,isArray:!!r[2]}}function TO(e,t,r,n){const a=e;let d=n;d===!0&&(d=1),d===!1&&(d=0);const f=typeof d=="number"?[d]:d;switch(r){case 35678:case 35680:case 35679:case 35682:case 36289:case 36292:case 36293:case 36298:case 36299:case 36300:case 36303:case 36306:case 36307:case 36308:case 36311:if(typeof n!="number")throw new Error("samplers must be set to integers");return e.uniform1i(t,n);case 5126:return e.uniform1fv(t,f);case 35664:return e.uniform2fv(t,f);case 35665:return e.uniform3fv(t,f);case 35666:return e.uniform4fv(t,f);case 5124:return e.uniform1iv(t,f);case 35667:return e.uniform2iv(t,f);case 35668:return e.uniform3iv(t,f);case 35669:return e.uniform4iv(t,f);case 35670:return e.uniform1iv(t,f);case 35671:return e.uniform2iv(t,f);case 35672:return e.uniform3iv(t,f);case 35673:return e.uniform4iv(t,f);case 5125:return a.uniform1uiv(t,f,1);case 36294:return a.uniform2uiv(t,f,2);case 36295:return a.uniform3uiv(t,f,3);case 36296:return a.uniform4uiv(t,f,4);case 35674:return e.uniformMatrix2fv(t,!1,f);case 35675:return e.uniformMatrix3fv(t,!1,f);case 35676:return e.uniformMatrix4fv(t,!1,f);case 35685:return a.uniformMatrix2x3fv(t,!1,f);case 35686:return a.uniformMatrix2x4fv(t,!1,f);case 35687:return a.uniformMatrix3x2fv(t,!1,f);case 35688:return a.uniformMatrix3x4fv(t,!1,f);case 35689:return a.uniformMatrix4x2fv(t,!1,f);case 35690:return a.uniformMatrix4x3fv(t,!1,f)}throw new Error("Illegal uniform")}function AO(e){switch(e){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 3;case"line-loop-webgl":return 2;case"triangle-list":return 4;case"triangle-strip":return 5;case"triangle-fan-webgl":return 6;default:throw new Error(e)}}function EO(e){switch(e){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 1;case"line-loop-webgl":return 1;case"triangle-list":return 4;case"triangle-strip":return 4;case"triangle-fan-webgl":return 4;default:throw new Error(e)}}const j1=4;class SO extends ac{device;handle;vs;fs;introspectedLayout;uniforms={};bindings={};varyings=null;_uniformCount=0;_uniformSetters={};constructor(t,r){super(t,r),this.device=t,this.handle=this.props.handle||this.device.gl.createProgram(),this.device.setSpectorMetadata(this.handle,{id:this.props.id}),this.vs=r.vs,this.fs=r.fs;const{varyings:n,bufferMode:a=35981}=r;switch(n&&n.length>0&&(this.varyings=n,this.device.gl.transformFeedbackVaryings(this.handle,n,a)),this._linkShaders(),te.time(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.introspectedLayout=_O(this.device.gl,this.handle),te.timeEnd(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.shaderLayout=JM(this.introspectedLayout,r.shaderLayout),this.props.topology){case"triangle-fan-webgl":case"line-loop-webgl":te.warn(`Primitive topology ${this.props.topology} is deprecated and will be removed in v9.1`);break}}destroy(){this.handle&&(this.device.gl.deleteProgram(this.handle),this.destroyed=!0)}setBindings(t,r){for(const[n,a]of Object.entries(t)){const d=this.shaderLayout.bindings.find(f=>f.name===n)||this.shaderLayout.bindings.find(f=>f.name===`${n}Uniforms`);if(!d){const f=this.shaderLayout.bindings.map(c=>`"${c.name}"`).join(", ");r?.disableWarnings||te.warn(`Unknown binding "${n}" in render pipeline "${this.id}", expected one of ${f}`)();continue}switch(a||te.warn(`Unsetting binding "${n}" in render pipeline "${this.id}"`)(),d.type){case"uniform":if(!(a instanceof ca)&&!(a.buffer instanceof ca))throw new Error("buffer value");break;case"texture":if(!(a instanceof Sc||a instanceof Cn||a instanceof Th))throw new Error("texture value");break;case"sampler":te.warn(`Ignoring sampler ${n}`)();break;default:throw new Error(d.type)}this.bindings[n]=a}}draw(t){const{renderPass:r,parameters:n=this.props.parameters,topology:a=this.props.topology,vertexArray:d,vertexCount:f,instanceCount:c,isInstanced:T=!1,firstVertex:C=0,transformFeedback:R}=t,L=AO(a),V=!!d.indexBuffer,X=d.indexBuffer?.glIndexType;if(this.linkStatus!=="success")return te.info(2,`RenderPipeline:${this.id}.draw() aborted - waiting for shader linking`)(),!1;if(!this._areTexturesRenderable()||f===0)return te.info(2,`RenderPipeline:${this.id}.draw() aborted - textures not yet loaded`)(),!1;if(f===0)return te.info(2,`RenderPipeline:${this.id}.draw() aborted - no vertices to draw`)(),!0;this.device.gl.useProgram(this.handle),d.bindBeforeRender(r),R&&R.begin(this.props.topology),this._applyBindings(),this._applyUniforms();const at=r;return RF(this.device,n,at.glParameters,()=>{V&&T?this.device.gl.drawElementsInstanced(L,f||0,X,C,c||0):V?this.device.gl.drawElements(L,f||0,X,C):T?this.device.gl.drawArraysInstanced(L,C,f||0,c||0):this.device.gl.drawArrays(L,C,f||0),R&&R.end()}),d.unbindAfterRender(r),!0}setUniformsWebGL(t){const{bindings:r}=Pg(t);Object.keys(r).forEach(n=>{te.warn(`Unsupported value "${JSON.stringify(r[n])}" used in setUniforms() for key ${n}. Use setBindings() instead?`)()}),Object.assign(this.uniforms,t)}async _linkShaders(){const{gl:t}=this.device;if(t.attachShader(this.handle,this.vs.handle),t.attachShader(this.handle,this.fs.handle),te.time(j1,`linkProgram for ${this.id}`)(),t.linkProgram(this.handle),te.timeEnd(j1,`linkProgram for ${this.id}`)(),te.level,!this.device.features.has("compilation-status-async-webgl")){const n=this._getLinkStatus();this._reportLinkStatus(n);return}te.once(1,"RenderPipeline linking is asynchronous")(),await this._waitForLinkComplete(),te.info(2,`RenderPipeline ${this.id} - async linking complete: ${this.linkStatus}`)();const r=this._getLinkStatus();this._reportLinkStatus(r)}_reportLinkStatus(t){switch(t){case"success":return;default:throw this.vs.compilationStatus==="error"?(this.vs.debugShader(),new Error(`Error during compilation of shader ${this.vs.id}`)):this.fs?.compilationStatus==="error"?(this.fs.debugShader(),new Error(`Error during compilation of shader ${this.fs.id}`)):new Error(`Error during ${t}: ${this.device.gl.getProgramInfoLog(this.handle)}`)}}_getLinkStatus(){const{gl:t}=this.device;return t.getProgramParameter(this.handle,35714)?(t.validateProgram(this.handle),t.getProgramParameter(this.handle,35715)?(this.linkStatus="success","success"):(this.linkStatus="error","validation")):(this.linkStatus="error","linking")}async _waitForLinkComplete(){const t=async a=>await new Promise(d=>setTimeout(d,a));if(!this.device.features.has("compilation-status-async-webgl")){await t(10);return}const{gl:n}=this.device;for(;;){if(n.getProgramParameter(this.handle,37297))return;await t(10)}}_areTexturesRenderable(){let t=!0;for(const[,r]of Object.entries(this.bindings))r instanceof Cn&&(r.update(),t=t&&r.loaded);return t}_applyBindings(){if(this.linkStatus!=="success")return;const{gl:t}=this.device;t.useProgram(this.handle);let r=0,n=0;for(const a of this.shaderLayout.bindings){const d=this.bindings[a.name]||this.bindings[a.name.replace(/Uniforms$/,"")];if(!d)throw new Error(`No value for binding ${a.name} in ${this.id}`);switch(a.type){case"uniform":const{name:f}=a,c=t.getUniformBlockIndex(this.handle,f);if(c===4294967295)throw new Error(`Invalid uniform block name ${f}`);t.uniformBlockBinding(this.handle,n,c),d instanceof ca?t.bindBufferBase(35345,n,d.handle):t.bindBufferRange(35345,n,d.buffer.handle,d.offset||0,d.size||d.buffer.byteLength-d.offset),n+=1;break;case"texture":if(!(d instanceof Sc||d instanceof Cn||d instanceof Th))throw new Error("texture");let T;if(d instanceof Sc)T=d.texture;else if(d instanceof Cn)T=d;else if(d instanceof Th&&d.colorAttachments[0]instanceof Sc)te.warn("Passing framebuffer in texture binding may be deprecated. Use fbo.colorAttachments[0] instead")(),T=d.colorAttachments[0].texture;else throw new Error("No texture");t.activeTexture(33984+r),t.bindTexture(T.target,T.handle),r+=1;break;case"sampler":break;case"storage":case"read-only-storage":throw new Error(`binding type '${a.type}' not supported in WebGL`)}}}_applyUniforms(){for(const t of this.shaderLayout.uniforms||[]){const{name:r,location:n,type:a,textureUnit:d}=t,f=this.uniforms[r]??d;f!==void 0&&TO(this.device.gl,n,a,f)}}}function Aj(e){return e}class CO extends Cg{device;commands=[];constructor(t){super(t,{}),this.device=t}submitCommands(t=this.commands){for(const r of t)switch(r.name){case"copy-buffer-to-buffer":IO(this.device,r.options);break;case"copy-buffer-to-texture":MO(this.device,r.options);break;case"copy-texture-to-buffer":RO(this.device,r.options);break;case"copy-texture-to-texture":PO(this.device,r.options);break}}}function IO(e,t){const r=t.source,n=t.destination;e.gl.bindBuffer(36662,r.handle),e.gl.bindBuffer(36663,n.handle),e.gl.copyBufferSubData(36662,36663,t.sourceOffset??0,t.destinationOffset??0,t.size),e.gl.bindBuffer(36662,null),e.gl.bindBuffer(36663,null)}function MO(e,t){throw new Error("Not implemented")}function RO(e,t){const{source:r,mipLevel:n=0,aspect:a="all",width:d=t.source.width,height:f=t.source.height,depthOrArrayLayers:c=0,origin:T=[0,0],destination:C,byteOffset:R=0,bytesPerRow:L,rowsPerImage:V}=t;if(a!=="all")throw new Error("not supported");if(n!==0||c!==0||L||V)throw new Error("not implemented");const{framebuffer:X,destroyFramebuffer:at}=H1(r);let nt;try{const K=C,It=d||X.width,St=f||X.height,Ct=Hf(X.texture.props.format),Ht=Ct.dataFormat,Qt=Ct.type;e.gl.bindBuffer(35051,K.handle),nt=e.gl.bindFramebuffer(36160,X.handle),e.gl.readPixels(T[0],T[1],It,St,Ht,Qt,R)}finally{e.gl.bindBuffer(35051,null),nt!==void 0&&e.gl.bindFramebuffer(36160,nt),at&&X.destroy()}}function PO(e,t){const{source:r,destinationMipLevel:n=0,origin:a=[0,0],destinationOrigin:d=[0,0],destination:f}=t;let{width:c=t.destination.width,height:T=t.destination.height}=t;const{framebuffer:C,destroyFramebuffer:R}=H1(r),[L,V]=a,[X,at,nt]=d,K=e.gl.bindFramebuffer(36160,C.handle);let It=null,St;if(f instanceof Cn)It=f,c=Number.isFinite(c)?c:It.width,T=Number.isFinite(T)?T:It.height,It.bind(0),St=It.target;else throw new Error("invalid destination");switch(St){case 3553:case 34067:e.gl.copyTexSubImage2D(St,n,X,at,L,V,c,T);break;case 35866:case 32879:e.gl.copyTexSubImage3D(St,n,X,at,nt,L,V,c,T);break}It&&It.unbind(),e.gl.bindFramebuffer(36160,K),R&&C.destroy()}function H1(e){if(e instanceof Is){const{width:t,height:r,id:n}=e;return{framebuffer:e.device.createFramebuffer({id:`framebuffer-for-${n}`,width:t,height:r,colorAttachments:[e]}),destroyFramebuffer:!0}}return{framebuffer:e,destroyFramebuffer:!1}}class BO extends Sg{device;commandBuffer;constructor(t,r){super(t,r),this.device=t,this.commandBuffer=new CO(t)}destroy(){}finish(){this.commandBuffer.submitCommands()}copyBufferToBuffer(t){this.commandBuffer.commands.push({name:"copy-buffer-to-buffer",options:t})}copyBufferToTexture(t){this.commandBuffer.commands.push({name:"copy-buffer-to-texture",options:t})}copyTextureToBuffer(t){this.commandBuffer.commands.push({name:"copy-texture-to-buffer",options:t})}copyTextureToTexture(t){this.commandBuffer.commands.push({name:"copy-texture-to-texture",options:t})}pushDebugGroup(t){}popDebugGroup(){}insertDebugMarker(t){}resolveQuerySet(t,r,n){}}class Om extends Ig{get[Symbol.toStringTag](){return"VertexArray"}device;handle;buffer=null;bufferValue=null;static isConstantAttributeZeroSupported(t){return eC()==="Chrome"}constructor(t,r){super(t,r),this.device=t,this.handle=this.device.gl.createVertexArray()}destroy(){super.destroy(),this.buffer&&this.buffer?.destroy(),this.handle&&(this.device.gl.deleteVertexArray(this.handle),this.handle=void 0)}setIndexBuffer(t){const r=t;if(r&&r.glTarget!==34963)throw new Error("Use .setBuffer()");this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34963,r?r.handle:null),this.indexBuffer=r,this.device.gl.bindVertexArray(null)}setBuffer(t,r){const n=r;if(n.glTarget===34963)throw new Error("Use .setIndexBuffer()");const{size:a,type:d,stride:f,offset:c,normalized:T,integer:C,divisor:R}=this._getAccessor(t);this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34962,n.handle),C?this.device.gl.vertexAttribIPointer(t,a,d,f,c):this.device.gl.vertexAttribPointer(t,a,d,T,f,c),this.device.gl.bindBuffer(34962,null),this.device.gl.enableVertexAttribArray(t),this.device.gl.vertexAttribDivisor(t,R||0),this.attributes[t]=n,this.device.gl.bindVertexArray(null)}setConstantWebGL(t,r){this._enable(t,!1),this.attributes[t]=r}bindBeforeRender(){this.device.gl.bindVertexArray(this.handle),this._applyConstantAttributes()}unbindAfterRender(){this.device.gl.bindVertexArray(null)}_applyConstantAttributes(){for(let t=0;t<this.maxVertexAttributes;++t){const r=this.attributes[t];ArrayBuffer.isView(r)&&this.device.setConstantAttributeWebGL(t,r)}}_getAccessor(t){const r=this.attributeInfos[t];if(!r)throw new Error(`Unknown attribute location ${t}`);const n=C1(r.bufferDataType);return{size:r.bufferComponents,type:n,stride:r.byteStride,offset:r.byteOffset,normalized:r.normalized,integer:r.integer,divisor:r.stepMode==="instance"?1:0}}_enable(t,r=!0){const a=Om.isConstantAttributeZeroSupported(this.device)||t!==0;(r||a)&&(t=Number(t),this.device.gl.bindVertexArray(this.handle),r?this.device.gl.enableVertexAttribArray(t):this.device.gl.disableVertexAttribArray(t),this.device.gl.bindVertexArray(null))}getConstantBuffer(t,r){const n=DO(r),a=n.byteLength*t,d=n.length*t;if(this.buffer&&a!==this.buffer.byteLength)throw new Error(`Buffer size is immutable, byte length ${a} !== ${this.buffer.byteLength}.`);let f=!this.buffer;if(this.buffer=this.buffer||this.device.createBuffer({byteLength:a}),f=f||!FO(n,this.bufferValue),f){const c=rR(r.constructor,d);iR({target:c,source:n,start:0,count:d}),this.buffer.write(c),this.bufferValue=r}return this.buffer}}function DO(e){return Array.isArray(e)?new Float32Array(e):e}function FO(e,t){if(!e||!t||e.length!==t.length||e.constructor!==t.constructor)return!1;for(let r=0;r<e.length;++r)if(e[r]!==t[r])return!1;return!0}class OO extends Mg{device;gl;handle;layout;buffers={};unusedBuffers={};bindOnUse=!0;_bound=!1;constructor(t,r){super(t,r),this.device=t,this.gl=t.gl,this.handle=this.props.handle||this.gl.createTransformFeedback(),this.layout=this.props.layout,r.buffers&&this.setBuffers(r.buffers),Object.seal(this)}destroy(){this.gl.deleteTransformFeedback(this.handle),super.destroy()}begin(t="point-list"){this.gl.bindTransformFeedback(36386,this.handle),this.bindOnUse&&this._bindBuffers(),this.gl.beginTransformFeedback(EO(t))}end(){this.gl.endTransformFeedback(),this.bindOnUse&&this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null)}setBuffers(t){this.buffers={},this.unusedBuffers={},this.bind(()=>{for(const r in t)this.setBuffer(r,t[r])})}setBuffer(t,r){const n=this._getVaryingIndex(t),{buffer:a,byteLength:d,byteOffset:f}=this._getBufferRange(r);if(n<0){this.unusedBuffers[t]=a,te.warn(`${this.id} unusedBuffers varying buffer ${t}`)();return}this.buffers[n]={buffer:a,byteLength:d,byteOffset:f},this.bindOnUse||this._bindBuffer(n,a,f,d)}getBuffer(t){if(G1(t))return this.buffers[t]||null;const r=this._getVaryingIndex(t);return r>=0?this.buffers[r]:null}bind(t=this.handle){if(typeof t!="function")return this.gl.bindTransformFeedback(36386,t),this;let r;return this._bound?r=t():(this.gl.bindTransformFeedback(36386,this.handle),this._bound=!0,r=t(),this._bound=!1,this.gl.bindTransformFeedback(36386,null)),r}unbind(){this.bind(null)}_getBufferRange(t){if(t instanceof ca)return{buffer:t,byteOffset:0,byteLength:t.byteLength};const{buffer:r,byteOffset:n=0,byteLength:a=t.buffer.byteLength}=t;return{buffer:r,byteOffset:n,byteLength:a}}_getVaryingIndex(t){if(G1(t))return Number(t);for(const r of this.layout.varyings)if(t===r.name)return r.location;return-1}_bindBuffers(){for(const t in this.buffers){const{buffer:r,byteLength:n,byteOffset:a}=this._getBufferRange(this.buffers[t]);this._bindBuffer(Number(t),r,a,n)}}_unbindBuffers(){for(const t in this.buffers)this.gl.bindBufferBase(35982,Number(t),null)}_bindBuffer(t,r,n=0,a){const d=r&&r.handle;!d||a===void 0?this.gl.bindBufferBase(35982,t,d):this.gl.bindBufferRange(35982,t,d,n,a)}}function G1(e){return typeof e=="number"?Number.isInteger(e):/^\d+$/.test(e)}class kO extends Rg{device;handle;target=null;_queryPending=!1;_pollingPromise=null;get[Symbol.toStringTag](){return"Query"}constructor(t,r){if(super(t,r),this.device=t,r.count>1)throw new Error("WebGL QuerySet can only have one value");this.handle=this.device.gl.createQuery(),Object.seal(this)}destroy(){this.device.gl.deleteQuery(this.handle)}beginTimestampQuery(){return this._begin(35007)}endTimestampQuery(){this._end()}beginOcclusionQuery(t){return this._begin(t?.conservative?36202:35887)}endOcclusionQuery(){this._end()}beginTransformFeedbackQuery(){return this._begin(35976)}endTransformFeedbackQuery(){this._end()}async resolveQuery(){return[await this.pollQuery()]}_begin(t){this._queryPending||(this.target=t,this.device.gl.beginQuery(this.target,this.handle))}_end(){this._queryPending||this.target&&(this.device.gl.endQuery(this.target),this.target=null,this._queryPending=!0)}isResultAvailable(){if(!this._queryPending)return!1;const t=this.device.gl.getQueryParameter(this.handle,34919);return t&&(this._queryPending=!1),t}isTimerDisjoint(){return this.device.gl.getParameter(36795)}getResult(){return this.device.gl.getQueryParameter(this.handle,34918)}getTimerMilliseconds(){return this.getResult()/1e6}pollQuery(t=Number.POSITIVE_INFINITY){if(this._pollingPromise)return this._pollingPromise;let r=0;return this._pollingPromise=new Promise((n,a)=>{const d=()=>{this.isResultAvailable()?(n(this.getResult()),this._pollingPromise=null):r++>t?(a("Timed out"),this._pollingPromise=null):requestAnimationFrame(d)};requestAnimationFrame(d)}),this._pollingPromise}}function $1(e){switch(e){case 6406:case 33326:case 6403:return 1;case 33328:case 33319:return 2;case 6407:case 34837:return 3;case 6408:case 34836:return 4;default:return tr(!1),0}}function NO(e){switch(e){case 5121:return 1;case 33635:case 32819:case 32820:return 2;case 5126:return 4;default:return tr(!1),0}}function LO(e,t){const{sourceX:r=0,sourceY:n=0,sourceFormat:a=6408,sourceAttachment:d=36064}=t||{};let{target:f=null,sourceWidth:c,sourceHeight:T,sourceType:C}=t||{};const{framebuffer:R,deleteFramebuffer:L}=W1(e);tr(R);const{gl:V,handle:X}=R;c=c||R.width,T=T||R.height;const at=d-36064;C=C||R.colorAttachments[at]?.texture?.type||5121,f=VO(f,C,a,c,T),C=C||cO(f);const nt=V.bindFramebuffer(36160,X);return V.readPixels(r,n,c,T,a,C,f),V.bindFramebuffer(36160,nt||null),L&&R.destroy(),f}function UO(e,t){const{target:r,sourceX:n=0,sourceY:a=0,sourceFormat:d=6408,targetByteOffset:f=0}=t||{};let{sourceWidth:c,sourceHeight:T,sourceType:C}=t||{};const{framebuffer:R,deleteFramebuffer:L}=W1(e);tr(R),c=c||R.width,T=T||R.height;const V=R;C=C||5121;let X=r;if(!X){const nt=$1(d),K=NO(C),It=f+c*T*nt*K;X=V.device.createBuffer({byteLength:It})}const at=e.device.createCommandEncoder();return at.copyTextureToBuffer({source:e,width:c,height:T,origin:[n,a],destination:X,byteOffset:f}),at.destroy(),L&&R.destroy(),X}function W1(e){return e instanceof ff?{framebuffer:e,deleteFramebuffer:!1}:{framebuffer:zO(e),deleteFramebuffer:!0}}function zO(e,t){const{device:r,width:n,height:a,id:d}=e;return r.createFramebuffer({...t,id:`framebuffer-for-${d}`,width:n,height:a,colorAttachments:[e]})}function VO(e,t,r,n,a){if(e)return e;t=t||5121;const d=Fm(t,{clamped:!1}),f=$1(r);return new d(n*a*f)}const jO=256,HO=1024,GO=16384,$O="clear: bad arguments";function WO(e,t){const{framebuffer:r=null,color:n=null,depth:a=null,stencil:d=null}=t||{},f={};r&&(f.framebuffer=r);let c=0;n&&(c|=GO,n!==!0&&(f.clearColor=n)),a&&(c|=jO,a!==!0&&(f.clearDepth=a)),d&&(c|=HO,a!==!0&&(f.clearStencil=a)),tr(c!==0,$O);const T=e.gl;la(T,f,()=>{T.clear(c)})}const Eh=1;class ua extends nc{static type="webgl";type="webgl";handle;features;limits;info;canvasContext;lost;_resolveContextLost;static isSupported(){return typeof WebGL2RenderingContext<"u"}static attach(t){if(t instanceof ua)return t;if(t?.device instanceof nc)return t.device;if(!XO(t))throw new Error("Invalid WebGL2RenderingContext");return new ua({gl:t})}static async create(t={}){te.groupCollapsed(Eh,"WebGLDevice created")();const r=[];t.debug&&r.push(ZF()),t.spector&&r.push(WF()),typeof t.canvas=="string"&&r.push(Bv.pageLoaded);const n=await Promise.allSettled(r);for(const f of n)f.status==="rejected"&&te.error(`Failed to initialize debug libraries ${f.reason}`)();if(te.probe(Eh+1,"DOM is loaded")(),t.gl?.device)return te.warn("reattaching existing device")(),ua.attach(t.gl);const a=new ua(t),d=`Created ${a.type}${a.debug?" debug":""} context: ${a.info.vendor}, ${a.info.renderer} for canvas: ${a.canvasContext.id}`;return te.probe(Eh,d)(),te.table(Eh,a.info)(),te.groupEnd(Eh)(),a}constructor(t){super({...t,id:t.id||Jo("webgl-device")});const r=t.gl?.device;if(r)throw new Error(`WebGL context already attached to device ${r.id}`);const n=t.gl?.canvas||t.canvas;this.canvasContext=new jF(this,{...t,canvas:n}),this.lost=new Promise(c=>{this._resolveContextLost=c});let a=t.gl||null;if(a||=aF(this.canvasContext.canvas,{...t,onContextLost:c=>this._resolveContextLost?.({reason:"destroyed",message:"Entered sleep mode, or too many apps or browser tabs are using the GPU."})}),!a)throw new Error("WebGL context creation failed");this.handle=a,this.gl=a,this.gl.device=this,this.gl._version=2,t.spector&&(this.spectorJS=XF({...this.props,canvas:this.handle.canvas})),this.info=lF(this.gl,this._extensions),this.limits=new IF(this.gl),this.features=new CF(this.gl,this._extensions,this.props.disabledFeatures),this.props.initalizeFeatures&&this.features.initializeFeatures(),this.canvasContext.resize();const{enable:d=!0,copyState:f=!1}=t;A1(this.gl,{enable:d,copyState:f}),t.debug&&(this.gl=YF(this.gl,{...t,throwOnError:!0}),this.debug=!0,te.level=Math.max(te.level,1),te.warn("WebGL debug mode activated. Performance reduced.")())}destroy(){}get isLost(){return this.gl.isContextLost()}getSize(){return[this.gl.drawingBufferWidth,this.gl.drawingBufferHeight]}isTextureFormatSupported(t){return Cm(this.gl,t,this._extensions)}isTextureFormatFilterable(t){return TF(this.gl,t,this._extensions)}isTextureFormatRenderable(t){return AF(this.gl,t,this._extensions)}createCanvasContext(t){throw new Error("WebGL only supports a single canvas")}createBuffer(t){const r=this._getBufferProps(t);return new ca(this,r)}_createTexture(t){return new Cn(this,t)}createExternalTexture(t){throw new Error("createExternalTexture() not implemented")}createSampler(t){return new Pm(this,t)}createShader(t){return new rO(this,t)}createFramebuffer(t){return new Th(this,t)}createVertexArray(t){return new Om(this,t)}createTransformFeedback(t){return new OO(this,t)}createQuerySet(t){return new kO(this,t)}createRenderPipeline(t){return new SO(this,t)}beginRenderPass(t){return new aO(this,t)}createComputePipeline(t){throw new Error("ComputePipeline not supported in WebGL")}beginComputePass(t){throw new Error("ComputePass not supported in WebGL")}renderPass=null;createCommandEncoder(t){return new BO(this,t)}submit(){this.renderPass?.end(),this.renderPass=null}readPixelsToArrayWebGL(t,r){return LO(t,r)}readPixelsToBufferWebGL(t,r){return UO(t,r)}setParametersWebGL(t){Tc(this.gl,t)}getParametersWebGL(t){return T1(this.gl,t)}withParametersWebGL(t,r){return la(this.gl,t,r)}clearWebGL(t){WO(this,t)}resetWebGL(){te.warn("WebGLDevice.resetWebGL is deprecated, use only for debugging")(),tF(this.gl)}gl;debug=!1;_canvasSizeInfo={clientWidth:0,clientHeight:0,devicePixelRatio:1};_extensions={};_polyfilled=!1;spectorJS;loseDevice(){let t=!1;const n=this.getExtension("WEBGL_lose_context").WEBGL_lose_context;return n&&(t=!0,n.loseContext()),this._resolveContextLost?.({reason:"destroyed",message:"Application triggered context loss"}),t}pushState(){Uf(this.gl)}popState(){yh(this.gl)}setSpectorMetadata(t,r){t.__SPECTOR_Metadata=r}getGLKey(t,r){r=r||this.gl2||this.gl;const n=Number(t);for(const a in r)if(r[a]===n)return`GL.${a}`;return String(t)}_constants;setConstantAttributeWebGL(t,r){const n=this.limits.maxVertexAttributes;this._constants=this._constants||new Array(n).fill(null);const a=this._constants[t];switch(a&&KO(a,r)&&te.info(1,`setConstantAttributeWebGL(${t}) could have been skipped, value unchanged`)(),this._constants[t]=r,r.constructor){case Float32Array:qO(this,t,r);break;case Int32Array:ZO(this,t,r);break;case Uint32Array:YO(this,t,r);break;default:tr(!1)}}getExtension(t){return aa(this.gl,t,this._extensions),this._extensions}}function XO(e){return typeof WebGL2RenderingContext<"u"&&e instanceof WebGL2RenderingContext?!0:!!(e&&Number.isFinite(e._version))}function qO(e,t,r){switch(r.length){case 1:e.gl.vertexAttrib1fv(t,r);break;case 2:e.gl.vertexAttrib2fv(t,r);break;case 3:e.gl.vertexAttrib3fv(t,r);break;case 4:e.gl.vertexAttrib4fv(t,r);break;default:tr(!1)}}function ZO(e,t,r){e.gl.vertexAttribI4iv(t,r)}function YO(e,t,r){e.gl.vertexAttribI4uiv(t,r)}function KO(e,t){if(!e||!t||e.length!==t.length||e.constructor!==t.constructor)return!1;for(let r=0;r<e.length;++r)if(e[r]!==t[r])return!1;return!0}var km={exports:{}};var X1;function JO(){return X1||(X1=1,(function(e){(function(t,r,n,a){var d=["","webkit","Moz","MS","ms","o"],f=r.createElement("div"),c="function",T=Math.round,C=Math.abs,R=Date.now;function L(Y,it,bt){return setTimeout(Ct(Y,bt),it)}function V(Y,it,bt){return Array.isArray(Y)?(X(Y,bt[it],bt),!0):!1}function X(Y,it,bt){var Nt;if(Y)if(Y.forEach)Y.forEach(it,bt);else if(Y.length!==a)for(Nt=0;Nt<Y.length;)it.call(bt,Y[Nt],Nt,Y),Nt++;else for(Nt in Y)Y.hasOwnProperty(Nt)&&it.call(bt,Y[Nt],Nt,Y)}function at(Y,it,bt){var Nt="DEPRECATED METHOD: "+it+`
`+bt+` AT 
`;return function(){var Jt=new Error("get-stack-trace"),de=Jt&&Jt.stack?Jt.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",Re=t.console&&(t.console.warn||t.console.log);return Re&&Re.call(t.console,Nt,de),Y.apply(this,arguments)}}var nt;typeof Object.assign!="function"?nt=function(it){if(it===a||it===null)throw new TypeError("Cannot convert undefined or null to object");for(var bt=Object(it),Nt=1;Nt<arguments.length;Nt++){var Jt=arguments[Nt];if(Jt!==a&&Jt!==null)for(var de in Jt)Jt.hasOwnProperty(de)&&(bt[de]=Jt[de])}return bt}:nt=Object.assign;var K=at(function(it,bt,Nt){for(var Jt=Object.keys(bt),de=0;de<Jt.length;)(!Nt||Nt&&it[Jt[de]]===a)&&(it[Jt[de]]=bt[Jt[de]]),de++;return it},"extend","Use `assign`."),It=at(function(it,bt){return K(it,bt,!0)},"merge","Use `assign`.");function St(Y,it,bt){var Nt=it.prototype,Jt;Jt=Y.prototype=Object.create(Nt),Jt.constructor=Y,Jt._super=Nt,bt&&nt(Jt,bt)}function Ct(Y,it){return function(){return Y.apply(it,arguments)}}function Ht(Y,it){return typeof Y==c?Y.apply(it&&it[0]||a,it):Y}function Qt(Y,it){return Y===a?it:Y}function ee(Y,it,bt){X(le(it),function(Nt){Y.addEventListener(Nt,bt,!1)})}function ae(Y,it,bt){X(le(it),function(Nt){Y.removeEventListener(Nt,bt,!1)})}function be(Y,it){for(;Y;){if(Y==it)return!0;Y=Y.parentNode}return!1}function ie(Y,it){return Y.indexOf(it)>-1}function le(Y){return Y.trim().split(/\s+/g)}function Ae(Y,it,bt){if(Y.indexOf&&!bt)return Y.indexOf(it);for(var Nt=0;Nt<Y.length;){if(bt&&Y[Nt][bt]==it||!bt&&Y[Nt]===it)return Nt;Nt++}return-1}function Fe(Y){return Array.prototype.slice.call(Y,0)}function ze(Y,it,bt){for(var Nt=[],Jt=[],de=0;de<Y.length;){var Re=Y[de][it];Ae(Jt,Re)<0&&Nt.push(Y[de]),Jt[de]=Re,de++}return Nt=Nt.sort(function(Te,nr){return Te[it]>nr[it]}),Nt}function Ce(Y,it){for(var bt,Nt,Jt=it[0].toUpperCase()+it.slice(1),de=0;de<d.length;){if(bt=d[de],Nt=bt?bt+Jt:it,Nt in Y)return Nt;de++}return a}var zr=1;function ns(){return zr++}function Hr(Y){var it=Y.ownerDocument||Y;return it.defaultView||it.parentWindow||t}var lo=/mobile|tablet|ip(ad|hone|od)|android/i,Le="ontouchstart"in t,vi=Ce(t,"PointerEvent")!==a,xi=Le&&lo.test(navigator.userAgent),li="touch",_a="pen",vs="mouse",hn="kinect",wi=25,ur=1,Rr=2,hr=4,Or=8,xs=1,ci=2,Fs=4,Je=8,Ti=16,Gr=ci|Fs,We=Je|Ti,os=Gr|We,as=["x","y"],Os=["clientX","clientY"];function $r(Y,it){var bt=this;this.manager=Y,this.callback=it,this.element=Y.element,this.target=Y.options.inputTarget,this.domHandler=function(Nt){Ht(Y.options.enable,[Y])&&bt.handler(Nt)},this.init()}$r.prototype={handler:function(){},init:function(){this.evEl&&ee(this.element,this.evEl,this.domHandler),this.evTarget&&ee(this.target,this.evTarget,this.domHandler),this.evWin&&ee(Hr(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&ae(this.element,this.evEl,this.domHandler),this.evTarget&&ae(this.target,this.evTarget,this.domHandler),this.evWin&&ae(Hr(this.element),this.evWin,this.domHandler)}};function ws(Y){var it,bt=Y.options.inputClass;return bt?it=bt:vi?it=xt:xi?it=Pe:Le?it=Qe:it=Z,new it(Y,dn)}function dn(Y,it,bt){var Nt=bt.pointers.length,Jt=bt.changedPointers.length,de=it&ur&&Nt-Jt===0,Re=it&(hr|Or)&&Nt-Jt===0;bt.isFirst=!!de,bt.isFinal=!!Re,de&&(Y.session={}),bt.eventType=it,Dn(Y,bt),Y.emit("hammer.input",bt),Y.recognize(bt),Y.session.prevInput=bt}function Dn(Y,it){var bt=Y.session,Nt=it.pointers,Jt=Nt.length;bt.firstInput||(bt.firstInput=co(it)),Jt>1&&!bt.firstMultiple?bt.firstMultiple=co(it):Jt===1&&(bt.firstMultiple=!1);var de=bt.firstInput,Re=bt.firstMultiple,yr=Re?Re.center:de.center,Te=it.center=fn(Nt);it.timeStamp=R(),it.deltaTime=it.timeStamp-de.timeStamp,it.angle=Ls(yr,Te),it.distance=Ns(yr,Te),Bi(bt,it),it.offsetDirection=ks(it.deltaX,it.deltaY);var nr=Fn(it.deltaTime,it.deltaX,it.deltaY);it.overallVelocityX=nr.x,it.overallVelocityY=nr.y,it.overallVelocity=C(nr.x)>C(nr.y)?nr.x:nr.y,it.scale=Re?ji(Re.pointers,Nt):1,it.rotation=Re?ls(Re.pointers,Nt):0,it.maxPointers=bt.prevInput?it.pointers.length>bt.prevInput.maxPointers?it.pointers.length:bt.prevInput.maxPointers:it.pointers.length,Po(bt,it);var Ie=Y.element;be(it.srcEvent.target,Ie)&&(Ie=it.srcEvent.target),it.target=Ie}function Bi(Y,it){var bt=it.center,Nt=Y.offsetDelta||{},Jt=Y.prevDelta||{},de=Y.prevInput||{};(it.eventType===ur||de.eventType===hr)&&(Jt=Y.prevDelta={x:de.deltaX||0,y:de.deltaY||0},Nt=Y.offsetDelta={x:bt.x,y:bt.y}),it.deltaX=Jt.x+(bt.x-Nt.x),it.deltaY=Jt.y+(bt.y-Nt.y)}function Po(Y,it){var bt=Y.lastInterval||it,Nt=it.timeStamp-bt.timeStamp,Jt,de,Re,yr;if(it.eventType!=Or&&(Nt>wi||bt.velocity===a)){var Te=it.deltaX-bt.deltaX,nr=it.deltaY-bt.deltaY,Ie=Fn(Nt,Te,nr);de=Ie.x,Re=Ie.y,Jt=C(Ie.x)>C(Ie.y)?Ie.x:Ie.y,yr=ks(Te,nr),Y.lastInterval=it}else Jt=bt.velocity,de=bt.velocityX,Re=bt.velocityY,yr=bt.direction;it.velocity=Jt,it.velocityX=de,it.velocityY=Re,it.direction=yr}function co(Y){for(var it=[],bt=0;bt<Y.pointers.length;)it[bt]={clientX:T(Y.pointers[bt].clientX),clientY:T(Y.pointers[bt].clientY)},bt++;return{timeStamp:R(),pointers:it,center:fn(it),deltaX:Y.deltaX,deltaY:Y.deltaY}}function fn(Y){var it=Y.length;if(it===1)return{x:T(Y[0].clientX),y:T(Y[0].clientY)};for(var bt=0,Nt=0,Jt=0;Jt<it;)bt+=Y[Jt].clientX,Nt+=Y[Jt].clientY,Jt++;return{x:T(bt/it),y:T(Nt/it)}}function Fn(Y,it,bt){return{x:it/Y||0,y:bt/Y||0}}function ks(Y,it){return Y===it?xs:C(Y)>=C(it)?Y<0?ci:Fs:it<0?Je:Ti}function Ns(Y,it,bt){bt||(bt=as);var Nt=it[bt[0]]-Y[bt[0]],Jt=it[bt[1]]-Y[bt[1]];return Math.sqrt(Nt*Nt+Jt*Jt)}function Ls(Y,it,bt){bt||(bt=as);var Nt=it[bt[0]]-Y[bt[0]],Jt=it[bt[1]]-Y[bt[1]];return Math.atan2(Jt,Nt)*180/Math.PI}function ls(Y,it){return Ls(it[1],it[0],Os)+Ls(Y[1],Y[0],Os)}function ji(Y,it){return Ns(it[0],it[1],Os)/Ns(Y[0],Y[1],Os)}var yt={mousedown:ur,mousemove:Rr,mouseup:hr},G="mousedown",$="mousemove mouseup";function Z(){this.evEl=G,this.evWin=$,this.pressed=!1,$r.apply(this,arguments)}St(Z,$r,{handler:function(it){var bt=yt[it.type];bt&ur&&it.button===0&&(this.pressed=!0),bt&Rr&&it.which!==1&&(bt=hr),this.pressed&&(bt&hr&&(this.pressed=!1),this.callback(this.manager,bt,{pointers:[it],changedPointers:[it],pointerType:vs,srcEvent:it}))}});var ht={pointerdown:ur,pointermove:Rr,pointerup:hr,pointercancel:Or,pointerout:Or},ft={2:li,3:_a,4:vs,5:hn},Tt="pointerdown",tt="pointermove pointerup pointercancel";t.MSPointerEvent&&!t.PointerEvent&&(Tt="MSPointerDown",tt="MSPointerMove MSPointerUp MSPointerCancel");function xt(){this.evEl=Tt,this.evWin=tt,$r.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}St(xt,$r,{handler:function(it){var bt=this.store,Nt=!1,Jt=it.type.toLowerCase().replace("ms",""),de=ht[Jt],Re=ft[it.pointerType]||it.pointerType,yr=Re==li,Te=Ae(bt,it.pointerId,"pointerId");de&ur&&(it.button===0||yr)?Te<0&&(bt.push(it),Te=bt.length-1):de&(hr|Or)&&(Nt=!0),!(Te<0)&&(bt[Te]=it,this.callback(this.manager,de,{pointers:bt,changedPointers:[it],pointerType:Re,srcEvent:it}),Nt&&bt.splice(Te,1))}});var kt={touchstart:ur,touchmove:Rr,touchend:hr,touchcancel:Or},Lt="touchstart",Ut="touchstart touchmove touchend touchcancel";function ne(){this.evTarget=Lt,this.evWin=Ut,this.started=!1,$r.apply(this,arguments)}St(ne,$r,{handler:function(it){var bt=kt[it.type];if(bt===ur&&(this.started=!0),!!this.started){var Nt=ge.call(this,it,bt);bt&(hr|Or)&&Nt[0].length-Nt[1].length===0&&(this.started=!1),this.callback(this.manager,bt,{pointers:Nt[0],changedPointers:Nt[1],pointerType:li,srcEvent:it})}}});function ge(Y,it){var bt=Fe(Y.touches),Nt=Fe(Y.changedTouches);return it&(hr|Or)&&(bt=ze(bt.concat(Nt),"identifier")),[bt,Nt]}var Ee={touchstart:ur,touchmove:Rr,touchend:hr,touchcancel:Or},Sr="touchstart touchmove touchend touchcancel";function Pe(){this.evTarget=Sr,this.targetIds={},$r.apply(this,arguments)}St(Pe,$r,{handler:function(it){var bt=Ee[it.type],Nt=Ve.call(this,it,bt);Nt&&this.callback(this.manager,bt,{pointers:Nt[0],changedPointers:Nt[1],pointerType:li,srcEvent:it})}});function Ve(Y,it){var bt=Fe(Y.touches),Nt=this.targetIds;if(it&(ur|Rr)&&bt.length===1)return Nt[bt[0].identifier]=!0,[bt,bt];var Jt,de,Re=Fe(Y.changedTouches),yr=[],Te=this.target;if(de=bt.filter(function(nr){return be(nr.target,Te)}),it===ur)for(Jt=0;Jt<de.length;)Nt[de[Jt].identifier]=!0,Jt++;for(Jt=0;Jt<Re.length;)Nt[Re[Jt].identifier]&&yr.push(Re[Jt]),it&(hr|Or)&&delete Nt[Re[Jt].identifier],Jt++;if(yr.length)return[ze(de.concat(yr),"identifier"),yr]}var rr=2500,Wt=25;function Qe(){$r.apply(this,arguments);var Y=Ct(this.handler,this);this.touch=new Pe(this.manager,Y),this.mouse=new Z(this.manager,Y),this.primaryTouch=null,this.lastTouches=[]}St(Qe,$r,{handler:function(it,bt,Nt){var Jt=Nt.pointerType==li,de=Nt.pointerType==vs;if(!(de&&Nt.sourceCapabilities&&Nt.sourceCapabilities.firesTouchEvents)){if(Jt)ir.call(this,bt,Nt);else if(de&&sr.call(this,Nt))return;this.callback(it,bt,Nt)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function ir(Y,it){Y&ur?(this.primaryTouch=it.changedPointers[0].identifier,kr.call(this,it)):Y&(hr|Or)&&kr.call(this,it)}function kr(Y){var it=Y.changedPointers[0];if(it.identifier===this.primaryTouch){var bt={x:it.clientX,y:it.clientY};this.lastTouches.push(bt);var Nt=this.lastTouches,Jt=function(){var de=Nt.indexOf(bt);de>-1&&Nt.splice(de,1)};setTimeout(Jt,rr)}}function sr(Y){for(var it=Y.srcEvent.clientX,bt=Y.srcEvent.clientY,Nt=0;Nt<this.lastTouches.length;Nt++){var Jt=this.lastTouches[Nt],de=Math.abs(it-Jt.x),Re=Math.abs(bt-Jt.y);if(de<=Wt&&Re<=Wt)return!0}return!1}var Xt=Ce(f.style,"touchAction"),ue=Xt!==a,ve="compute",Ai="auto",Us="manipulation",mr="none",we="pan-x",Hi="pan-y",zs=On();function pn(Y,it){this.manager=Y,this.set(it)}pn.prototype={set:function(Y){Y==ve&&(Y=this.compute()),ue&&this.manager.element.style&&zs[Y]&&(this.manager.element.style[Xt]=Y),this.actions=Y.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var Y=[];return X(this.manager.recognizers,function(it){Ht(it.options.enable,[it])&&(Y=Y.concat(it.getTouchAction()))}),cs(Y.join(" "))},preventDefaults:function(Y){var it=Y.srcEvent,bt=Y.offsetDirection;if(this.manager.session.prevented){it.preventDefault();return}var Nt=this.actions,Jt=ie(Nt,mr)&&!zs[mr],de=ie(Nt,Hi)&&!zs[Hi],Re=ie(Nt,we)&&!zs[we];if(Jt){var yr=Y.pointers.length===1,Te=Y.distance<2,nr=Y.deltaTime<250;if(yr&&Te&&nr)return}if(!(Re&&de)&&(Jt||de&&bt&Gr||Re&&bt&We))return this.preventSrc(it)},preventSrc:function(Y){this.manager.session.prevented=!0,Y.preventDefault()}};function cs(Y){if(ie(Y,mr))return mr;var it=ie(Y,we),bt=ie(Y,Hi);return it&&bt?mr:it||bt?it?we:Hi:ie(Y,Us)?Us:Ai}function On(){if(!ue)return!1;var Y={},it=t.CSS&&t.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(bt){Y[bt]=it?t.CSS.supports("touch-action",bt):!0}),Y}var Vs=1,ei=2,Zr=4,Ue=8,js=Ue,Di=16,Fi=32;function Ge(Y){this.options=nt({},this.defaults,Y||{}),this.id=ns(),this.manager=null,this.options.enable=Qt(this.options.enable,!0),this.state=Vs,this.simultaneous={},this.requireFail=[]}Ge.prototype={defaults:{},set:function(Y){return nt(this.options,Y),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(Y){if(V(Y,"recognizeWith",this))return this;var it=this.simultaneous;return Y=Gs(Y,this),it[Y.id]||(it[Y.id]=Y,Y.recognizeWith(this)),this},dropRecognizeWith:function(Y){return V(Y,"dropRecognizeWith",this)?this:(Y=Gs(Y,this),delete this.simultaneous[Y.id],this)},requireFailure:function(Y){if(V(Y,"requireFailure",this))return this;var it=this.requireFail;return Y=Gs(Y,this),Ae(it,Y)===-1&&(it.push(Y),Y.requireFailure(this)),this},dropRequireFailure:function(Y){if(V(Y,"dropRequireFailure",this))return this;Y=Gs(Y,this);var it=Ae(this.requireFail,Y);return it>-1&&this.requireFail.splice(it,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(Y){return!!this.simultaneous[Y.id]},emit:function(Y){var it=this,bt=this.state;function Nt(Jt){it.manager.emit(Jt,Y)}bt<Ue&&Nt(it.options.event+Hs(bt)),Nt(it.options.event),Y.additionalEvent&&Nt(Y.additionalEvent),bt>=Ue&&Nt(it.options.event+Hs(bt))},tryEmit:function(Y){if(this.canEmit())return this.emit(Y);this.state=Fi},canEmit:function(){for(var Y=0;Y<this.requireFail.length;){if(!(this.requireFail[Y].state&(Fi|Vs)))return!1;Y++}return!0},recognize:function(Y){var it=nt({},Y);if(!Ht(this.options.enable,[this,it])){this.reset(),this.state=Fi;return}this.state&(js|Di|Fi)&&(this.state=Vs),this.state=this.process(it),this.state&(ei|Zr|Ue|Di)&&this.tryEmit(it)},process:function(Y){},getTouchAction:function(){},reset:function(){}};function Hs(Y){return Y&Di?"cancel":Y&Ue?"end":Y&Zr?"move":Y&ei?"start":""}function ga(Y){return Y==Ti?"down":Y==Je?"up":Y==ci?"left":Y==Fs?"right":""}function Gs(Y,it){var bt=it.manager;return bt?bt.get(Y):Y}function Gi(){Ge.apply(this,arguments)}St(Gi,Ge,{defaults:{pointers:1},attrTest:function(Y){var it=this.options.pointers;return it===0||Y.pointers.length===it},process:function(Y){var it=this.state,bt=Y.eventType,Nt=it&(ei|Zr),Jt=this.attrTest(Y);return Nt&&(bt&Or||!Jt)?it|Di:Nt||Jt?bt&hr?it|Ue:it&ei?it|Zr:ei:Fi}});function $s(){Gi.apply(this,arguments),this.pX=null,this.pY=null}St($s,Gi,{defaults:{event:"pan",threshold:10,pointers:1,direction:os},getTouchAction:function(){var Y=this.options.direction,it=[];return Y&Gr&&it.push(Hi),Y&We&&it.push(we),it},directionTest:function(Y){var it=this.options,bt=!0,Nt=Y.distance,Jt=Y.direction,de=Y.deltaX,Re=Y.deltaY;return Jt&it.direction||(it.direction&Gr?(Jt=de===0?xs:de<0?ci:Fs,bt=de!=this.pX,Nt=Math.abs(Y.deltaX)):(Jt=Re===0?xs:Re<0?Je:Ti,bt=Re!=this.pY,Nt=Math.abs(Y.deltaY))),Y.direction=Jt,bt&&Nt>it.threshold&&Jt&it.direction},attrTest:function(Y){return Gi.prototype.attrTest.call(this,Y)&&(this.state&ei||!(this.state&ei)&&this.directionTest(Y))},emit:function(Y){this.pX=Y.deltaX,this.pY=Y.deltaY;var it=ga(Y.direction);it&&(Y.additionalEvent=this.options.event+it),this._super.emit.call(this,Y)}});function ma(){Gi.apply(this,arguments)}St(ma,Gi,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[mr]},attrTest:function(Y){return this._super.attrTest.call(this,Y)&&(Math.abs(Y.scale-1)>this.options.threshold||this.state&ei)},emit:function(Y){if(Y.scale!==1){var it=Y.scale<1?"in":"out";Y.additionalEvent=this.options.event+it}this._super.emit.call(this,Y)}});function ya(){Ge.apply(this,arguments),this._timer=null,this._input=null}St(ya,Ge,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[Ai]},process:function(Y){var it=this.options,bt=Y.pointers.length===it.pointers,Nt=Y.distance<it.threshold,Jt=Y.deltaTime>it.time;if(this._input=Y,!Nt||!bt||Y.eventType&(hr|Or)&&!Jt)this.reset();else if(Y.eventType&ur)this.reset(),this._timer=L(function(){this.state=js,this.tryEmit()},it.time,this);else if(Y.eventType&hr)return js;return Fi},reset:function(){clearTimeout(this._timer)},emit:function(Y){this.state===js&&(Y&&Y.eventType&hr?this.manager.emit(this.options.event+"up",Y):(this._input.timeStamp=R(),this.manager.emit(this.options.event,this._input)))}});function ul(){Gi.apply(this,arguments)}St(ul,Gi,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[mr]},attrTest:function(Y){return this._super.attrTest.call(this,Y)&&(Math.abs(Y.rotation)>this.options.threshold||this.state&ei)}});function ba(){Gi.apply(this,arguments)}St(ba,Gi,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:Gr|We,pointers:1},getTouchAction:function(){return $s.prototype.getTouchAction.call(this)},attrTest:function(Y){var it=this.options.direction,bt;return it&(Gr|We)?bt=Y.overallVelocity:it&Gr?bt=Y.overallVelocityX:it&We&&(bt=Y.overallVelocityY),this._super.attrTest.call(this,Y)&&it&Y.offsetDirection&&Y.distance>this.options.threshold&&Y.maxPointers==this.options.pointers&&C(bt)>this.options.velocity&&Y.eventType&hr},emit:function(Y){var it=ga(Y.offsetDirection);it&&this.manager.emit(this.options.event+it,Y),this.manager.emit(this.options.event,Y)}});function Bo(){Ge.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}St(Bo,Ge,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[Us]},process:function(Y){var it=this.options,bt=Y.pointers.length===it.pointers,Nt=Y.distance<it.threshold,Jt=Y.deltaTime<it.time;if(this.reset(),Y.eventType&ur&&this.count===0)return this.failTimeout();if(Nt&&Jt&&bt){if(Y.eventType!=hr)return this.failTimeout();var de=this.pTime?Y.timeStamp-this.pTime<it.interval:!0,Re=!this.pCenter||Ns(this.pCenter,Y.center)<it.posThreshold;this.pTime=Y.timeStamp,this.pCenter=Y.center,!Re||!de?this.count=1:this.count+=1,this._input=Y;var yr=this.count%it.taps;if(yr===0)return this.hasRequireFailures()?(this._timer=L(function(){this.state=js,this.tryEmit()},it.interval,this),ei):js}return Fi},failTimeout:function(){return this._timer=L(function(){this.state=Fi},this.options.interval,this),Fi},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==js&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function Ws(Y,it){return it=it||{},it.recognizers=Qt(it.recognizers,Ws.defaults.preset),new xa(Y,it)}Ws.VERSION="2.0.7",Ws.defaults={domEvents:!1,touchAction:ve,enable:!0,inputTarget:null,inputClass:null,preset:[[ul,{enable:!1}],[ma,{enable:!1},["rotate"]],[ba,{direction:Gr}],[$s,{direction:Gr},["swipe"]],[Bo],[Bo,{event:"doubletap",taps:2},["tap"]],[ya]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var hl=1,va=2;function xa(Y,it){this.options=nt({},Ws.defaults,it||{}),this.options.inputTarget=this.options.inputTarget||Y,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=Y,this.input=ws(this),this.touchAction=new pn(this,this.options.touchAction),wa(this,!0),X(this.options.recognizers,function(bt){var Nt=this.add(new bt[0](bt[1]));bt[2]&&Nt.recognizeWith(bt[2]),bt[3]&&Nt.requireFailure(bt[3])},this)}xa.prototype={set:function(Y){return nt(this.options,Y),Y.touchAction&&this.touchAction.update(),Y.inputTarget&&(this.input.destroy(),this.input.target=Y.inputTarget,this.input.init()),this},stop:function(Y){this.session.stopped=Y?va:hl},recognize:function(Y){var it=this.session;if(!it.stopped){this.touchAction.preventDefaults(Y);var bt,Nt=this.recognizers,Jt=it.curRecognizer;(!Jt||Jt&&Jt.state&js)&&(Jt=it.curRecognizer=null);for(var de=0;de<Nt.length;)bt=Nt[de],it.stopped!==va&&(!Jt||bt==Jt||bt.canRecognizeWith(Jt))?bt.recognize(Y):bt.reset(),!Jt&&bt.state&(ei|Zr|Ue)&&(Jt=it.curRecognizer=bt),de++}},get:function(Y){if(Y instanceof Ge)return Y;for(var it=this.recognizers,bt=0;bt<it.length;bt++)if(it[bt].options.event==Y)return it[bt];return null},add:function(Y){if(V(Y,"add",this))return this;var it=this.get(Y.options.event);return it&&this.remove(it),this.recognizers.push(Y),Y.manager=this,this.touchAction.update(),Y},remove:function(Y){if(V(Y,"remove",this))return this;if(Y=this.get(Y),Y){var it=this.recognizers,bt=Ae(it,Y);bt!==-1&&(it.splice(bt,1),this.touchAction.update())}return this},on:function(Y,it){if(Y!==a&&it!==a){var bt=this.handlers;return X(le(Y),function(Nt){bt[Nt]=bt[Nt]||[],bt[Nt].push(it)}),this}},off:function(Y,it){if(Y!==a){var bt=this.handlers;return X(le(Y),function(Nt){it?bt[Nt]&&bt[Nt].splice(Ae(bt[Nt],it),1):delete bt[Nt]}),this}},emit:function(Y,it){this.options.domEvents&&dl(Y,it);var bt=this.handlers[Y]&&this.handlers[Y].slice();if(!(!bt||!bt.length)){it.type=Y,it.preventDefault=function(){it.srcEvent.preventDefault()};for(var Nt=0;Nt<bt.length;)bt[Nt](it),Nt++}},destroy:function(){this.element&&wa(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function wa(Y,it){var bt=Y.element;if(bt.style){var Nt;X(Y.options.cssProps,function(Jt,de){Nt=Ce(bt.style,de),it?(Y.oldCssProps[Nt]=bt.style[Nt],bt.style[Nt]=Jt):bt.style[Nt]=Y.oldCssProps[Nt]||""}),it||(Y.oldCssProps={})}}function dl(Y,it){var bt=r.createEvent("Event");bt.initEvent(Y,!0,!0),bt.gesture=it,it.target.dispatchEvent(bt)}nt(Ws,{INPUT_START:ur,INPUT_MOVE:Rr,INPUT_END:hr,INPUT_CANCEL:Or,STATE_POSSIBLE:Vs,STATE_BEGAN:ei,STATE_CHANGED:Zr,STATE_ENDED:Ue,STATE_RECOGNIZED:js,STATE_CANCELLED:Di,STATE_FAILED:Fi,DIRECTION_NONE:xs,DIRECTION_LEFT:ci,DIRECTION_RIGHT:Fs,DIRECTION_UP:Je,DIRECTION_DOWN:Ti,DIRECTION_HORIZONTAL:Gr,DIRECTION_VERTICAL:We,DIRECTION_ALL:os,Manager:xa,Input:$r,TouchAction:pn,TouchInput:Pe,MouseInput:Z,PointerEventInput:xt,TouchMouseInput:Qe,SingleTouchInput:ne,Recognizer:Ge,AttrRecognizer:Gi,Tap:Bo,Pan:$s,Swipe:ba,Pinch:ma,Rotate:ul,Press:ya,on:ee,off:ae,each:X,merge:It,extend:K,assign:nt,inherit:St,bindFn:Ct,prefixed:Ce});var zc=typeof t<"u"?t:typeof self<"u"?self:{};zc.Hammer=Ws,e.exports?e.exports=Ws:t[n]=Ws})(window,document,"Hammer")})(km)),km.exports}var Sh=JO();const ro=Ql({__proto__:null,default:mb(Sh)},[Sh]),q1=1,Z1=2,Nm=4,QO={mousedown:q1,mousemove:Z1,mouseup:Nm};function tk(e,t){for(let r=0;r<e.length;r++)if(t(e[r]))return!0;return!1}function ek(e){const t=e.prototype.handler;e.prototype.handler=function(n){const a=this.store;n.button>0&&n.type==="pointerdown"&&(tk(a,d=>d.pointerId===n.pointerId)||a.push(n)),t.call(this,n)}}function rk(e){e.prototype.handler=function(r){let n=QO[r.type];n&q1&&r.button>=0&&(this.pressed=!0),n&Z1&&r.buttons===0&&(n=Nm),this.pressed&&(n&Nm&&(this.pressed=!1),this.callback(this.manager,n,{pointers:[r],changedPointers:[r],pointerType:"mouse",srcEvent:r}))}}ek(Sh.PointerEventInput),rk(Sh.MouseInput);const ik=Sh.Manager;class $f{constructor(t,r,n){this.element=t,this.callback=r,this.options={enable:!0,...n}}}const sk=ro?[[ro.Pan,{event:"tripan",pointers:3,threshold:0,enable:!1}],[ro.Rotate,{enable:!1}],[ro.Pinch,{enable:!1}],[ro.Swipe,{enable:!1}],[ro.Pan,{threshold:0,enable:!1}],[ro.Press,{enable:!1}],[ro.Tap,{event:"doubletap",taps:2,enable:!1}],[ro.Tap,{event:"anytap",enable:!1}],[ro.Tap,{enable:!1}]]:null,Y1={tripan:["rotate","pinch","pan"],rotate:["pinch"],pinch:["pan"],pan:["press","doubletap","anytap","tap"],doubletap:["anytap"],anytap:["tap"]},nk={doubletap:["tap"]},ok={pointerdown:"pointerdown",pointermove:"pointermove",pointerup:"pointerup",touchstart:"pointerdown",touchmove:"pointermove",touchend:"pointerup",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup"},Lm={KEY_EVENTS:["keydown","keyup"],MOUSE_EVENTS:["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"],WHEEL_EVENTS:["wheel","mousewheel"]},ak={tap:"tap",anytap:"anytap",doubletap:"doubletap",press:"press",pinch:"pinch",pinchin:"pinch",pinchout:"pinch",pinchstart:"pinch",pinchmove:"pinch",pinchend:"pinch",pinchcancel:"pinch",rotate:"rotate",rotatestart:"rotate",rotatemove:"rotate",rotateend:"rotate",rotatecancel:"rotate",tripan:"tripan",tripanstart:"tripan",tripanmove:"tripan",tripanup:"tripan",tripandown:"tripan",tripanleft:"tripan",tripanright:"tripan",tripanend:"tripan",tripancancel:"tripan",pan:"pan",panstart:"pan",panmove:"pan",panup:"pan",pandown:"pan",panleft:"pan",panright:"pan",panend:"pan",pancancel:"pan",swipe:"swipe",swipeleft:"swipe",swiperight:"swipe",swipeup:"swipe",swipedown:"swipe"},K1={click:"tap",anyclick:"anytap",dblclick:"doubletap",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup",mouseover:"pointerover",mouseout:"pointerout",mouseleave:"pointerleave"},lk=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",Cc=typeof window<"u"?window:global;let Um=!1;try{const e={get passive(){return Um=!0,!0}};Cc.addEventListener("test",null,e),Cc.removeEventListener("test",null)}catch{Um=!1}const ck=lk.indexOf("firefox")!==-1,{WHEEL_EVENTS:uk}=Lm,J1="wheel",Q1=4.000244140625,hk=40,dk=.25;class fk extends $f{constructor(t,r,n){super(t,r,n),this.handleEvent=a=>{if(!this.options.enable)return;let d=a.deltaY;Cc.WheelEvent&&(ck&&a.deltaMode===Cc.WheelEvent.DOM_DELTA_PIXEL&&(d/=Cc.devicePixelRatio),a.deltaMode===Cc.WheelEvent.DOM_DELTA_LINE&&(d*=hk)),d!==0&&d%Q1===0&&(d=Math.floor(d/Q1)),a.shiftKey&&d&&(d=d*dk),this.callback({type:J1,center:{x:a.clientX,y:a.clientY},delta:-d,srcEvent:a,pointerType:"mouse",target:a.target})},this.events=(this.options.events||[]).concat(uk),this.events.forEach(a=>t.addEventListener(a,this.handleEvent,Um?{passive:!1}:!1))}destroy(){this.events.forEach(t=>this.element.removeEventListener(t,this.handleEvent))}enableEventType(t,r){t===J1&&(this.options.enable=r)}}const{MOUSE_EVENTS:pk}=Lm,tw="pointermove",ew="pointerover",rw="pointerout",iw="pointerenter",sw="pointerleave";class _k extends $f{constructor(t,r,n){super(t,r,n),this.handleEvent=d=>{this.handleOverEvent(d),this.handleOutEvent(d),this.handleEnterEvent(d),this.handleLeaveEvent(d),this.handleMoveEvent(d)},this.pressed=!1;const{enable:a}=this.options;this.enableMoveEvent=a,this.enableLeaveEvent=a,this.enableEnterEvent=a,this.enableOutEvent=a,this.enableOverEvent=a,this.events=(this.options.events||[]).concat(pk),this.events.forEach(d=>t.addEventListener(d,this.handleEvent))}destroy(){this.events.forEach(t=>this.element.removeEventListener(t,this.handleEvent))}enableEventType(t,r){t===tw&&(this.enableMoveEvent=r),t===ew&&(this.enableOverEvent=r),t===rw&&(this.enableOutEvent=r),t===iw&&(this.enableEnterEvent=r),t===sw&&(this.enableLeaveEvent=r)}handleOverEvent(t){this.enableOverEvent&&t.type==="mouseover"&&this._emit(ew,t)}handleOutEvent(t){this.enableOutEvent&&t.type==="mouseout"&&this._emit(rw,t)}handleEnterEvent(t){this.enableEnterEvent&&t.type==="mouseenter"&&this._emit(iw,t)}handleLeaveEvent(t){this.enableLeaveEvent&&t.type==="mouseleave"&&this._emit(sw,t)}handleMoveEvent(t){if(this.enableMoveEvent)switch(t.type){case"mousedown":t.button>=0&&(this.pressed=!0);break;case"mousemove":t.buttons===0&&(this.pressed=!1),this.pressed||this._emit(tw,t);break;case"mouseup":this.pressed=!1;break}}_emit(t,r){this.callback({type:t,center:{x:r.clientX,y:r.clientY},srcEvent:r,pointerType:"mouse",target:r.target})}}const{KEY_EVENTS:gk}=Lm,nw="keydown",ow="keyup";class mk extends $f{constructor(t,r,n){super(t,r,n),this.handleEvent=a=>{const d=a.target||a.srcElement;d.tagName==="INPUT"&&d.type==="text"||d.tagName==="TEXTAREA"||(this.enableDownEvent&&a.type==="keydown"&&this.callback({type:nw,srcEvent:a,key:a.key,target:a.target}),this.enableUpEvent&&a.type==="keyup"&&this.callback({type:ow,srcEvent:a,key:a.key,target:a.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,this.events=(this.options.events||[]).concat(gk),t.tabIndex=this.options.tabIndex||0,t.style.outline="none",this.events.forEach(a=>t.addEventListener(a,this.handleEvent))}destroy(){this.events.forEach(t=>this.element.removeEventListener(t,this.handleEvent))}enableEventType(t,r){t===nw&&(this.enableDownEvent=r),t===ow&&(this.enableUpEvent=r)}}const aw="contextmenu";class yk extends $f{constructor(t,r,n){super(t,r,n),this.handleEvent=a=>{this.options.enable&&this.callback({type:aw,center:{x:a.clientX,y:a.clientY},srcEvent:a,pointerType:"mouse",target:a.target})},t.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(t,r){t===aw&&(this.options.enable=r)}}const lw=1,zm=2,cw=4,bk={pointerdown:lw,pointermove:zm,pointerup:cw,mousedown:lw,mousemove:zm,mouseup:cw},vk=0,xk=1,wk=2,Tk=1,Ak=2,Ek=4;function Sk(e){const t=bk[e.srcEvent.type];if(!t)return null;const{buttons:r,button:n}=e.srcEvent;let a=!1,d=!1,f=!1;return t===zm?(a=!!(r&Tk),d=!!(r&Ek),f=!!(r&Ak)):(a=n===vk,d=n===xk,f=n===wk),{leftButton:a,middleButton:d,rightButton:f}}function Ck(e,t){const r=e.center;if(!r)return null;const n=t.getBoundingClientRect(),a=n.width/t.offsetWidth||1,d=n.height/t.offsetHeight||1,f={x:(r.x-n.left-t.clientLeft)/a,y:(r.y-n.top-t.clientTop)/d};return{center:r,offsetCenter:f}}const Vm={srcElement:"root",priority:0};class Ik{constructor(t){this.handleEvent=r=>{if(this.isEmpty())return;const n=this._normalizeEvent(r);let a=r.srcEvent.target;for(;a&&a!==n.rootElement;){if(this._emit(n,a),n.handled)return;a=a.parentNode}this._emit(n,"root")},this.eventManager=t,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(t,r,n,a=!1,d=!1){const{handlers:f,handlersByElement:c}=this;let T=Vm;typeof n=="string"||n&&n.addEventListener?T={...Vm,srcElement:n}:n&&(T={...Vm,...n});let C=c.get(T.srcElement);C||(C=[],c.set(T.srcElement,C));const R={type:t,handler:r,srcElement:T.srcElement,priority:T.priority};a&&(R.once=!0),d&&(R.passive=!0),f.push(R),this._active=this._active||!R.passive;let L=C.length-1;for(;L>=0&&!(C[L].priority>=R.priority);)L--;C.splice(L+1,0,R)}remove(t,r){const{handlers:n,handlersByElement:a}=this;for(let d=n.length-1;d>=0;d--){const f=n[d];if(f.type===t&&f.handler===r){n.splice(d,1);const c=a.get(f.srcElement);c.splice(c.indexOf(f),1),c.length===0&&a.delete(f.srcElement)}}this._active=n.some(d=>!d.passive)}_emit(t,r){const n=this.handlersByElement.get(r);if(n){let a=!1;const d=()=>{t.handled=!0},f=()=>{t.handled=!0,a=!0},c=[];for(let T=0;T<n.length;T++){const{type:C,handler:R,once:L}=n[T];if(R({...t,type:C,stopPropagation:d,stopImmediatePropagation:f}),L&&c.push(n[T]),a)break}for(let T=0;T<c.length;T++){const{type:C,handler:R}=c[T];this.remove(C,R)}}}_normalizeEvent(t){const r=this.eventManager.getElement();return{...t,...Sk(t),...Ck(t,r),preventDefault:()=>{t.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:r}}}const Mk={events:null,recognizers:null,recognizerOptions:{},Manager:ik,touchAction:"none",tabIndex:0};class Rk{constructor(t=null,r){this._onBasicInput=a=>{const{srcEvent:d}=a,f=ok[d.type];f&&this.manager.emit(f,a)},this._onOtherEvent=a=>{this.manager.emit(a.type,a)},this.options={...Mk,...r},this.events=new Map,this.setElement(t);const{events:n}=this.options;n&&this.on(n)}getElement(){return this.element}setElement(t){if(this.element&&this.destroy(),this.element=t,!t)return;const{options:r}=this,n=r.Manager;this.manager=new n(t,{touchAction:r.touchAction,recognizers:r.recognizers||sk}).on("hammer.input",this._onBasicInput),r.recognizers||Object.keys(Y1).forEach(a=>{const d=this.manager.get(a);d&&Y1[a].forEach(f=>{d.recognizeWith(f)})});for(const a in r.recognizerOptions){const d=this.manager.get(a);if(d){const f=r.recognizerOptions[a];delete f.enable,d.set(f)}}this.wheelInput=new fk(t,this._onOtherEvent,{enable:!1}),this.moveInput=new _k(t,this._onOtherEvent,{enable:!1}),this.keyInput=new mk(t,this._onOtherEvent,{enable:!1,tabIndex:r.tabIndex}),this.contextmenuInput=new yk(t,this._onOtherEvent,{enable:!1});for(const[a,d]of this.events)d.isEmpty()||(this._toggleRecognizer(d.recognizerName,!0),this.manager.on(a,d.handleEvent))}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy(),this.wheelInput=null,this.moveInput=null,this.keyInput=null,this.contextmenuInput=null,this.manager=null,this.element=null)}on(t,r,n){this._addEventHandler(t,r,n,!1)}once(t,r,n){this._addEventHandler(t,r,n,!0)}watch(t,r,n){this._addEventHandler(t,r,n,!1,!0)}off(t,r){this._removeEventHandler(t,r)}_toggleRecognizer(t,r){const{manager:n}=this;if(!n)return;const a=n.get(t);if(a&&a.options.enable!==r){a.set({enable:r});const d=nk[t];d&&!this.options.recognizers&&d.forEach(f=>{const c=n.get(f);r?(c.requireFailure(t),a.dropRequireFailure(f)):c.dropRequireFailure(t)})}this.wheelInput.enableEventType(t,r),this.moveInput.enableEventType(t,r),this.keyInput.enableEventType(t,r),this.contextmenuInput.enableEventType(t,r)}_addEventHandler(t,r,n,a,d){if(typeof t!="string"){n=r;for(const R in t)this._addEventHandler(R,t[R],n,a,d);return}const{manager:f,events:c}=this,T=K1[t]||t;let C=c.get(T);C||(C=new Ik(this),c.set(T,C),C.recognizerName=ak[T]||T,f&&f.on(T,C.handleEvent)),C.add(t,r,n,a,d),C.isEmpty()||this._toggleRecognizer(C.recognizerName,!0)}_removeEventHandler(t,r){if(typeof t!="string"){for(const f in t)this._removeEventHandler(f,t[f]);return}const{events:n}=this,a=K1[t]||t,d=n.get(a);if(d&&(d.remove(t,r),d.isEmpty())){const{recognizerName:f}=d;let c=!1;for(const T of n.values())if(T.recognizerName===f&&!T.isEmpty()){c=!0;break}c||this._toggleRecognizer(f,!1)}}}function ha(){}const uw={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,parameters:{},parent:null,device:null,deviceProps:{type:"webgl"},gl:null,glOptions:{},canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,widgets:[],onDeviceInitialized:ha,onWebGLInitialized:ha,onResize:ha,onViewStateChange:ha,onInteractionStateChange:ha,onBeforeRender:ha,onAfterRender:ha,onLoad:ha,onError:e=>Ye.error(e.message,e.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:({isDragging:e})=>e?"grabbing":"grab",getTooltip:null,debug:!1,drawPickingColors:!1};class Ch{constructor(t){this.width=0,this.height=0,this.userData={},this.device=null,this.canvas=null,this.viewManager=null,this.layerManager=null,this.effectManager=null,this.deckRenderer=null,this.deckPicker=null,this.eventManager=null,this.widgetManager=null,this.tooltip=null,this.animationLoop=null,this.cursorState={isHovering:!1,isDragging:!1},this.stats=new sc({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this._lastPointerDownInfo=null,this._onPointerMove=n=>{const{_pickRequest:a}=this;if(n.type==="pointerleave")a.x=-1,a.y=-1,a.radius=0;else{if(n.leftButton||n.rightButton)return;{const d=n.offsetCenter;if(!d)return;a.x=d.x,a.y=d.y,a.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:a.x,y:a.y}),a.event=n},this._onEvent=n=>{const a=em[n.type],d=n.offsetCenter;if(!a||!d||!this.layerManager)return;const f=this.layerManager.getLayers(),c=this.deckPicker.getLastPickedObject({x:d.x,y:d.y,layers:f,viewports:this.getViewports(d)},this._lastPointerDownInfo),{layer:T}=c,C=T&&(T[a.handler]||T.props[a.handler]),R=this.props[a.handler];let L=!1;C&&(L=C.call(T,c,n)),L||(R?.(c,n),this.widgetManager.onEvent(c,n))},this._onPointerDown=n=>{const a=n.offsetCenter,d=this._pick("pickObject","pickObject Time",{x:a.x,y:a.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=d.result[0]||d.emptyInfo},this.props={...uw,...t},t=this.props,t.viewState&&t.initialViewState&&Ye.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),this.viewState=this.props.initialViewState,t.device?this.device=t.device:t.gl&&(t.gl instanceof WebGLRenderingContext&&Ye.error("WebGL1 context not supported.")(),this.device=ua.attach(t.gl));let r=this.device;r||(oc.registerDevices([ua]),r=oc.createDevice({...t.deviceProps,canvas:this._createCanvas(t)})),this.animationLoop=this._createAnimationLoop(r,t),this.setProps(t),t._typedArrayManagerProps&&dh.setOptions(t._typedArrayManagerProps),this.animationLoop.start()}finalize(){this.animationLoop?.stop(),this.animationLoop?.destroy(),this.animationLoop=null,this._lastPointerDownInfo=null,this.layerManager?.finalize(),this.layerManager=null,this.viewManager?.finalize(),this.viewManager=null,this.effectManager?.finalize(),this.effectManager=null,this.deckRenderer?.finalize(),this.deckRenderer=null,this.deckPicker?.finalize(),this.deckPicker=null,this.eventManager?.destroy(),this.eventManager=null,this.widgetManager?.finalize(),this.widgetManager=null,!this.props.canvas&&!this.props.device&&!this.props.gl&&this.canvas&&(this.canvas.parentElement?.removeChild(this.canvas),this.canvas=null)}setProps(t){this.stats.get("setProps Time").timeStart(),"onLayerHover"in t&&Ye.removed("onLayerHover","onHover")(),"onLayerClick"in t&&Ye.removed("onLayerClick","onClick")(),t.initialViewState&&!Sn(this.props.initialViewState,t.initialViewState,3)&&(this.viewState=t.initialViewState),Object.assign(this.props,t),this._setCanvasSize(this.props);const r=Object.create(this.props);Object.assign(r,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),this.animationLoop?.setProps(r),this.layerManager&&(this.viewManager.setProps(r),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(r),this.effectManager.setProps(r),this.deckRenderer.setProps(r),this.deckPicker.setProps(r),this.widgetManager.setProps(r)),this.stats.get("setProps Time").timeEnd()}needsRedraw(t={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let r=this._needsRedraw;t.clearRedrawFlags&&(this._needsRedraw=!1);const n=this.viewManager.needsRedraw(t),a=this.layerManager.needsRedraw(t),d=this.effectManager.needsRedraw(t),f=this.deckRenderer.needsRedraw(t);return r=r||n||a||d||f,r}redraw(t){if(!this.layerManager)return;let r=this.needsRedraw({clearRedrawFlags:!0});r=t||r,r&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(r):this._drawLayers(r))}get isInitialized(){return this.viewManager!==null}getViews(){return bi(this.viewManager),this.viewManager.views}getViewports(t){return bi(this.viewManager),this.viewManager.getViewports(t)}getCanvas(){return this.canvas}pickObject(t){const r=this._pick("pickObject","pickObject Time",t).result;return r.length?r[0]:null}pickMultipleObjects(t){return t.depth=t.depth||10,this._pick("pickObject","pickMultipleObjects Time",t).result}pickObjects(t){return this._pick("pickObjects","pickObjects Time",t)}_addResources(t,r=!1){for(const n in t)this.layerManager.resourceManager.add({resourceId:n,data:t[n],forceUpdate:r})}_removeResources(t){for(const r of t)this.layerManager.resourceManager.remove(r)}_addDefaultEffect(t){this.effectManager.addDefaultEffect(t)}_addDefaultShaderModule(t){this.layerManager.addDefaultShaderModule(t)}_removeDefaultShaderModule(t){this.layerManager?.removeDefaultShaderModule(t)}_pick(t,r,n){bi(this.deckPicker);const{stats:a}=this;a.get("Pick Count").incrementCount(),a.get(r).timeStart();const d=this.deckPicker[t]({layers:this.layerManager.getLayers(n),views:this.viewManager.getViews(),viewports:this.getViewports(n),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...n});return a.get(r).timeEnd(),d}_createCanvas(t){let r=t.canvas;return typeof r=="string"&&(r=document.getElementById(r),bi(r)),r||(r=document.createElement("canvas"),r.id=t.id||"deckgl-overlay",(t.parent||document.body).appendChild(r)),Object.assign(r.style,t.style),r}_setCanvasSize(t){if(!this.canvas)return;const{width:r,height:n}=t;if(r||r===0){const a=Number.isFinite(r)?`${r}px`:r;this.canvas.style.width=a}if(n||n===0){const a=Number.isFinite(n)?`${n}px`:n;this.canvas.style.position=t.style?.position||"absolute",this.canvas.style.height=a}}_updateCanvasSize(){const{canvas:t}=this;if(!t)return;const r=t.clientWidth??t.width,n=t.clientHeight??t.height;(r!==this.width||n!==this.height)&&(this.width=r,this.height=n,this.viewManager?.setProps({width:r,height:n}),this.layerManager?.activateViewport(this.getViewports()[0]),this.props.onResize({width:r,height:n}))}_createAnimationLoop(t,r){const{gl:n,onError:a,useDevicePixels:d}=r;return new eD({device:t,useDevicePixels:d,autoResizeDrawingBuffer:!n,autoResizeViewport:!1,onInitialize:f=>this._setDevice(f.device),onRender:this._onRenderFrame.bind(this),onError:a})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){const{views:t}=this.props,r=Array.isArray(t)?t:t?[t]:[new bm({id:"default-view"})];return r.length&&this.props.controller&&(r[0].props.controller=this.props.controller),r}_onContextLost(){const{onError:t}=this.props;this.animationLoop&&t&&t(new Error("WebGL context is lost"))}_pickAndCallback(){const{_pickRequest:t}=this;if(t.event){const{result:r,emptyInfo:n}=this._pick("pickObject","pickObject Time",t);this.cursorState.isHovering=r.length>0;let a=n,d=!1;for(const f of r)a=f,d=f.layer?.onHover(f,t.event)||d;d||(this.props.onHover?.(a,t.event),this.widgetManager.onHover(a,t.event)),t.event=null}}_updateCursor(){const t=this.props.parent||this.canvas;t&&(t.style.cursor=this.props.getCursor(this.cursorState))}_setDevice(t){if(this.device=t,!this.animationLoop)return;this.canvas||(this.canvas=this.device.canvasContext?.canvas),this.device.setParametersWebGL({blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onDeviceInitialized(this.device),this.device instanceof ua&&this.props.onWebGLInitialized(this.device.gl);const r=new a1;r.play(),this.animationLoop.attachTimeline(r),this.eventManager=new Rk(this.props.parent||this.canvas,{touchAction:this.props.touchAction,recognizerOptions:this.props.eventRecognizerOptions,events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const a in em)this.eventManager.on(a,this._onEvent);this.viewManager=new bD({timeline:r,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const n=this.viewManager.getViewports()[0];this.layerManager=new yD(this.device,{deck:this,stats:this.stats,viewport:n,timeline:r}),this.effectManager=new kD({deck:this,device:this.device}),this.deckRenderer=new UD(this.device),this.deckPicker=new $D(this.device),this.widgetManager=new qD({deck:this,parentElement:this.canvas?.parentElement}),this.widgetManager.addDefault(new YD),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(t,r){const{device:n,gl:a}=this.layerManager.context;this.props.onBeforeRender({device:n,gl:a});const d={target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...r};this.deckRenderer?.renderLayers(d),d.pass==="screen"&&this.widgetManager.onRedraw({viewports:d.viewports,layers:d.layers}),this.props.onAfterRender({device:n,gl:a})}_onRenderFrame(){this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),Ye.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.layerManager.updateLayers(),this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(t){const r=this.props.onViewStateChange(t)||t.viewState;this.viewState&&(this.viewState={...this.viewState,[t.viewId]:r},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(t){this.cursorState.isDragging=t.isDragging||!1,this.props.onInteractionStateChange(t)}_getFrameStats(){const{stats:t}=this;t.get("frameRate").timeEnd(),t.get("frameRate").timeStart();const r=this.animationLoop.stats;t.get("GPU Time").addTime(r.get("GPU Time").lastTiming),t.get("CPU Time").addTime(r.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:t,stats:r}=this;t.fps=r.get("frameRate").getHz(),t.setPropsTime=r.get("setProps Time").time,t.updateAttributesTime=r.get("Update Attributes").time,t.framesRedrawn=r.get("Redraw Count").count,t.pickTime=r.get("pickObject Time").time+r.get("pickMultipleObjects Time").time+r.get("pickObjects Time").time,t.pickCount=r.get("Pick Count").count,t.gpuTime=r.get("GPU Time").time,t.cpuTime=r.get("CPU Time").time,t.gpuTimePerFrame=r.get("GPU Time").getAverageTime(),t.cpuTimePerFrame=r.get("CPU Time").getAverageTime();const n=oc.stats.get("Memory Usage");t.bufferMemory=n.get("Buffer Memory").count,t.textureMemory=n.get("Texture Memory").count,t.renderbufferMemory=n.get("Renderbuffer Memory").count,t.gpuMemory=n.get("GPU Memory").count}}Ch.defaultProps=uw,Ch.VERSION=VI;function Pk(e){switch(e){case"float64":return Float64Array;case"uint8":case"unorm8":return Uint8ClampedArray;default:return Hv(e)}}const Bk=jv;function Wf(e,t){return{attribute:e,format:t.size>1?`${t.type}x${t.size}`:t.type,byteOffset:t.offset||0}}function nl(e){return e.stride||e.size*e.bytesPerElement}function Dk(e,t){return e.type===t.type&&e.size===t.size&&nl(e)===nl(t)&&(e.offset||0)===(t.offset||0)}function jm(e,t){t.offset&&Ye.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const r=nl(e),n=t.vertexOffset!==void 0?t.vertexOffset:e.vertexOffset||0,a=t.elementOffset||0,d=n*r+a*e.bytesPerElement+(e.offset||0);return{...t,offset:d,stride:r}}function Fk(e,t){const r=jm(e,t);return{high:r,low:{...r,offset:r.offset+e.size*4}}}class Ok{constructor(t,r,n){this._buffer=null,this.device=t,this.id=r.id||"",this.size=r.size||1;const a=r.logicalType||r.type,d=a==="float64";let{defaultValue:f}=r;f=Number.isFinite(f)?[f]:f||new Array(this.size).fill(0);let c;d?c="float32":!a&&r.isIndexed?c="uint32":c=a||"float32";let T=Pk(a||c);this.doublePrecision=d,d&&r.fp64===!1&&(T=Float32Array),this.value=null,this.settings={...r,defaultType:T,defaultValue:f,logicalType:a,type:c,normalized:c.includes("norm"),size:this.size,bytesPerElement:T.BYTES_PER_ELEMENT},this.state={...n,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1}}get isConstant(){return this.state.constant}get buffer(){return this._buffer}get byteOffset(){const t=this.getAccessor();return t.vertexOffset?t.vertexOffset*nl(t):0}get numInstances(){return this.state.numInstances}set numInstances(t){this.state.numInstances=t}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),dh.release(this.state.allocatedValue)}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(t=this.id,r=null){const n={};if(this.state.constant){const a=this.value;if(r){const d=jm(this.getAccessor(),r),f=d.offset/a.BYTES_PER_ELEMENT,c=d.size||this.size;n[t]=a.subarray(f,f+c)}else n[t]=a}else n[t]=this.getBuffer();return this.doublePrecision&&(this.value instanceof Float64Array?n[`${t}64Low`]=n[t]:n[`${t}64Low`]=new Float32Array(this.size)),n}_getBufferLayout(t=this.id,r=null){const n=this.getAccessor(),a=[],d={name:this.id,byteStride:nl(n),attributes:a};if(this.doublePrecision){const f=Fk(n,r||{});a.push(Wf(t,{...n,...f.high}),Wf(`${t}64Low`,{...n,...f.low}))}else if(r){const f=jm(n,r);a.push(Wf(t,{...n,...f}))}else a.push(Wf(t,n));return d}setAccessor(t){this.state.bufferAccessor=t}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let t=null;if(this.state.constant&&this.value){const r=Array.from(this.value);t=[r,r]}else{const{value:r,numInstances:n,size:a}=this,d=n*a;if(r&&d&&r.length>=d){const f=new Array(a).fill(1/0),c=new Array(a).fill(-1/0);for(let T=0;T<d;)for(let C=0;C<a;C++){const R=r[T++];R<f[C]&&(f[C]=R),R>c[C]&&(c[C]=R)}t=[f,c]}}return this.state.bounds=t,t}setData(t){const{state:r}=this;let n;ArrayBuffer.isView(t)?n={value:t}:t instanceof Fr?n={buffer:t}:n=t;const a={...this.settings,...n};if(ArrayBuffer.isView(n.value)){if(!n.type)if(this.doublePrecision&&n.value instanceof Float64Array)a.type="float32";else{const f=Bk(n.value);a.type=a.normalized?f.replace("int","norm"):f}a.bytesPerElement=n.value.BYTES_PER_ELEMENT,a.stride=nl(a)}if(r.bounds=null,n.constant){let d=n.value;if(d=this._normalizeValue(d,[],0),this.settings.normalized&&(d=this.normalizeConstant(d)),!(!r.constant||!this._areValuesEqual(d,this.value)))return!1;r.externalBuffer=null,r.constant=!0,this.value=ArrayBuffer.isView(d)?d:new Float32Array(d)}else if(n.buffer){const d=n.buffer;r.externalBuffer=d,r.constant=!1,this.value=n.value||null}else if(n.value){this._checkExternalBuffer(n);let d=n.value;r.externalBuffer=null,r.constant=!1,this.value=d;let{buffer:f}=this;const c=nl(a),T=(a.vertexOffset||0)*c;if(this.doublePrecision&&d instanceof Float64Array&&(d=hm(d,a)),this.settings.isIndexed){const R=this.settings.defaultType;d.constructor!==R&&(d=new R(d))}const C=d.byteLength+T+c*2;(!f||f.byteLength<C)&&(f=this._createBuffer(C)),f.write(d,T)}return this.setAccessor(a),!0}updateSubBuffer(t={}){this.state.bounds=null;const r=this.value,{startOffset:n=0,endOffset:a}=t;this.buffer.write(this.doublePrecision&&r instanceof Float64Array?hm(r,{size:this.size,startIndex:n,endIndex:a}):r.subarray(n,a),n*r.BYTES_PER_ELEMENT+this.byteOffset)}allocate(t,r=!1){const{state:n}=this,a=n.allocatedValue,d=dh.allocate(a,t+1,{size:this.size,type:this.settings.defaultType,copy:r});this.value=d;const{byteOffset:f}=this;let{buffer:c}=this;return(!c||c.byteLength<d.byteLength+f)&&(c=this._createBuffer(d.byteLength+f),r&&a&&c.write(a instanceof Float64Array?hm(a,this):a,f)),n.allocatedValue=d,n.constant=!1,n.externalBuffer=null,this.setAccessor(this.settings),!0}_checkExternalBuffer(t){const{value:r}=t;if(!ArrayBuffer.isView(r))throw new Error(`Attribute ${this.id} value is not TypedArray`);const n=this.settings.defaultType;let a=!1;if(this.doublePrecision&&(a=r.BYTES_PER_ELEMENT<4),a)throw new Error(`Attribute ${this.id} does not support ${r.constructor.name}`);!(r instanceof n)&&this.settings.normalized&&!("normalized"in t)&&Ye.warn(`Attribute ${this.id} is normalized`)()}normalizeConstant(t){switch(this.settings.type){case"snorm8":return new Float32Array(t).map(r=>(r+128)/255*2-1);case"snorm16":return new Float32Array(t).map(r=>(r+32768)/65535*2-1);case"unorm8":return new Float32Array(t).map(r=>r/255);case"unorm16":return new Float32Array(t).map(r=>r/65535);default:return t}}_normalizeValue(t,r,n){const{defaultValue:a,size:d}=this.settings;if(Number.isFinite(t))return r[n]=t,r;if(!t){let f=d;for(;--f>=0;)r[n+f]=a[f];return r}switch(d){case 4:r[n+3]=Number.isFinite(t[3])?t[3]:a[3];case 3:r[n+2]=Number.isFinite(t[2])?t[2]:a[2];case 2:r[n+1]=Number.isFinite(t[1])?t[1]:a[1];case 1:r[n+0]=Number.isFinite(t[0])?t[0]:a[0];break;default:let f=d;for(;--f>=0;)r[n+f]=Number.isFinite(t[f])?t[f]:a[f]}return r}_areValuesEqual(t,r){if(!t||!r)return!1;const{size:n}=this;for(let a=0;a<n;a++)if(t[a]!==r[a])return!1;return!0}_createBuffer(t){this._buffer&&this._buffer.destroy();const{isIndexed:r,type:n}=this.settings;return this._buffer=this.device.createBuffer({...this._buffer?.props,id:this.id,usage:r?Fr.INDEX:Fr.VERTEX,indexType:r?n:void 0,byteLength:t}),this._buffer}}const hw=[],dw=[];function fw(e,t=0,r=1/0){let n=hw;const a={index:-1,data:e,target:[]};return e?typeof e[Symbol.iterator]=="function"?n=e:e.length>0&&(dw.length=e.length,n=dw):n=hw,(t>0||Number.isFinite(r))&&(n=(Array.isArray(n)?n:Array.from(n)).slice(t,r),a.index=t-1),{iterable:n,objectInfo:a}}function pw(e){return e&&e[Symbol.asyncIterator]}function kk(e,t){const{size:r,stride:n,offset:a,startIndices:d,nested:f}=t,c=e.BYTES_PER_ELEMENT,T=n?n/c:r,C=a?a/c:0,R=Math.floor((e.length-C)/T);return(L,{index:V,target:X})=>{if(!d){const It=V*T+C;for(let St=0;St<r;St++)X[St]=e[It+St];return X}const at=d[V],nt=d[V+1]||R;let K;if(f){K=new Array(nt-at);for(let It=at;It<nt;It++){const St=It*T+C;X=new Array(r);for(let Ct=0;Ct<r;Ct++)X[Ct]=e[St+Ct];K[It-at]=X}}else if(T===r)K=e.subarray(at*r+C,nt*r+C);else{K=new e.constructor((nt-at)*r);let It=0;for(let St=at;St<nt;St++){const Ct=St*T+C;for(let Ht=0;Ht<r;Ht++)K[It++]=e[Ct+Ht]}}return K}}const Nk=[],Xf=[[0,1/0]];function Lk(e,t){if(e===Xf||(t[0]<0&&(t[0]=0),t[0]>=t[1]))return e;const r=[],n=e.length;let a=0;for(let d=0;d<n;d++){const f=e[d];f[1]<t[0]?(r.push(f),a=d+1):f[0]>t[1]?r.push(f):t=[Math.min(f[0],t[0]),Math.max(f[1],t[1])]}return r.splice(a,0,t),r}const Uk={interpolation:{duration:0,easing:e=>e},spring:{stiffness:.05,damping:.5}};function _w(e,t){if(!e)return null;Number.isFinite(e)&&(e={type:"interpolation",duration:e});const r=e.type||"interpolation";return{...Uk[r],...t,...e,type:r}}class gw extends Ok{constructor(t,r){super(t,r,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,layoutChanged:!1,updateRanges:Xf}),this.constant=!1,this.settings.update=r.update||(r.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(t){this.state.startIndices=t}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:t=!1}={}){const r=this.state.needsRedraw;return this.state.needsRedraw=r&&!t,r}layoutChanged(){return this.state.layoutChanged}setAccessor(t){var r;(r=this.state).layoutChanged||(r.layoutChanged=!Dk(t,this.getAccessor())),super.setAccessor(t)}getUpdateTriggers(){const{accessor:t}=this.settings;return[this.id].concat(typeof t!="function"&&t||[])}supportsTransition(){return!!this.settings.transition}getTransitionSetting(t){if(!t||!this.supportsTransition())return null;const{accessor:r}=this.settings,n=this.settings.transition,a=Array.isArray(r)?t[r.find(d=>t[d])]:t[r];return _w(a,n)}setNeedsUpdate(t=this.id,r){if(this.state.needsUpdate=this.state.needsUpdate||t,this.setNeedsRedraw(t),r){const{startRow:n=0,endRow:a=1/0}=r;this.state.updateRanges=Lk(this.state.updateRanges,[n,a])}else this.state.updateRanges=Xf}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=Nk}setNeedsRedraw(t=this.id){this.state.needsRedraw=this.state.needsRedraw||t}allocate(t){const{state:r,settings:n}=this;return n.noAlloc?!1:n.update?(super.allocate(t,r.updateRanges!==Xf),!0):!1}updateBuffer({numInstances:t,data:r,props:n,context:a}){if(!this.needsUpdate())return!1;const{state:{updateRanges:d},settings:{update:f,noAlloc:c}}=this;let T=!0;if(f){for(const[C,R]of d)f.call(a,this,{data:r,startRow:C,endRow:R,props:n,numInstances:t});if(this.value)if(this.constant||!this.buffer||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[C,R]of d){const L=Number.isFinite(C)?this.getVertexOffset(C):0,V=Number.isFinite(R)?this.getVertexOffset(R):c||!Number.isFinite(t)?this.value.length:t*this.size;super.updateSubBuffer({startOffset:L,endOffset:V})}this._checkAttributeArray()}else T=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),T}setConstantValue(t){return t===void 0||typeof t=="function"?!1:(this.setData({constant:!0,value:t})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}setExternalBuffer(t){const{state:r}=this;return t?(this.clearNeedsUpdate(),r.lastExternalBuffer===t||(r.lastExternalBuffer=t,this.setNeedsRedraw(),this.setData(t)),!0):(r.lastExternalBuffer=null,!1)}setBinaryValue(t,r=null){const{state:n,settings:a}=this;if(!t)return n.binaryValue=null,n.binaryAccessor=null,!1;if(a.noAlloc)return!1;if(n.binaryValue===t)return this.clearNeedsUpdate(),!0;if(n.binaryValue=t,this.setNeedsRedraw(),a.transform||r!==this.startIndices){ArrayBuffer.isView(t)&&(t={value:t});const f=t;bi(ArrayBuffer.isView(f.value),`invalid ${a.accessor}`);const c=!!f.size&&f.size!==this.size;return n.binaryAccessor=kk(f.value,{size:f.size||this.size,stride:f.stride,offset:f.offset,startIndices:r,nested:c}),!1}return this.clearNeedsUpdate(),this.setData(t),!0}getVertexOffset(t){const{startIndices:r}=this;return(r?t<r.length?r[t]:this.numInstances:t)*this.size}getValue(){const t=this.settings.shaderAttributes,r=super.getValue();if(!t)return r;for(const n in t)Object.assign(r,super.getValue(n,t[n]));return r}getBufferLayout(t){this.state.layoutChanged=!1;const r=this.settings.shaderAttributes,n=super._getBufferLayout(),{stepMode:a}=this.settings;if(a==="dynamic"?n.stepMode=t?t.isInstanced?"instance":"vertex":"instance":n.stepMode=a??"vertex",!r)return n;for(const d in r){const f=super._getBufferLayout(d,r[d]);n.attributes.push(...f.attributes)}return n}_autoUpdater(t,{data:r,startRow:n,endRow:a,props:d,numInstances:f}){if(t.constant)return;const{settings:c,state:T,value:C,size:R,startIndices:L}=t,{accessor:V,transform:X}=c,at=T.binaryAccessor||(typeof V=="function"?V:d[V]);bi(typeof at=="function",`accessor "${V}" is not a function`);let nt=t.getVertexOffset(n);const{iterable:K,objectInfo:It}=fw(r,n,a);for(const St of K){It.index++;let Ct=at(St,It);if(X&&(Ct=X.call(this,Ct)),L){const Ht=(It.index<L.length-1?L[It.index+1]:f)-L[It.index];if(Ct&&Array.isArray(Ct[0])){let Qt=nt;for(const ee of Ct)t._normalizeValue(ee,C,Qt),Qt+=R}else Ct&&Ct.length>R?C.set(Ct,nt):(t._normalizeValue(Ct,It.target,0),fD({target:C,source:It.target,start:nt,count:Ht}));nt+=Ht*R}else t._normalizeValue(Ct,C,nt),nt+=R}}_validateAttributeUpdaters(){const{settings:t}=this;if(!(t.noAlloc||typeof t.update=="function"))throw new Error(`Attribute ${this.id} missing update or accessor`)}_checkAttributeArray(){const{value:t}=this,r=Math.min(4,this.size);if(t&&t.length>=r){let n=!0;switch(r){case 4:n=n&&Number.isFinite(t[3]);case 3:n=n&&Number.isFinite(t[2]);case 2:n=n&&Number.isFinite(t[1]);case 1:n=n&&Number.isFinite(t[0]);break;default:n=!1}if(!n)throw new Error(`Illegal attribute generated for ${this.id}`)}}}function Hm(e){const{source:t,target:r,start:n=0,size:a,getData:d}=e,f=e.end||r.length,c=t.length,T=f-n;if(c>T){r.set(t.subarray(0,T),n);return}if(r.set(t,n),!d)return;let C=c;for(;C<T;){const R=d(C,t);for(let L=0;L<a;L++)r[n+C]=R[L]||0,C++}}function zk({source:e,target:t,size:r,getData:n,sourceStartIndices:a,targetStartIndices:d}){if(!a||!d)return Hm({source:e,target:t,size:r,getData:n}),t;let f=0,c=0;const T=n&&((R,L)=>n(R+c,L)),C=Math.min(a.length,d.length);for(let R=1;R<C;R++){const L=a[R]*r,V=d[R]*r;Hm({source:e.subarray(f,L),target:t,start:c,end:V,size:r,getData:T}),f=L,c=V}return c<t.length&&Hm({source:[],target:t,start:c,size:r,getData:T}),t}function Vk(e){const{device:t,settings:r,value:n}=e,a=new gw(t,r);return a.setData({value:n instanceof Float64Array?new Float64Array(0):new Float32Array(0),normalized:r.normalized}),a}function mw(e){switch(e){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`No defined attribute type for size "${e}"`)}}function yw(e){switch(e){case 1:return"float32";case 2:return"float32x2";case 3:return"float32x3";case 4:return"float32x4";default:throw new Error("invalid type size")}}function bw(e){e.push(e.shift())}function jk(e,t){const{doublePrecision:r,settings:n,value:a,size:d}=e,f=r&&a instanceof Float64Array?2:1;let c=0;const{shaderAttributes:T}=e.settings;if(T)for(const C of Object.values(T))c=Math.max(c,C.vertexOffset??0);return(n.noAlloc?a.length:(t+c)*d)*f}function vw({device:e,source:t,target:r}){return(!r||r.byteLength<t.byteLength)&&(r?.destroy(),r=e.createBuffer({byteLength:t.byteLength,usage:t.usage})),r}function xw({device:e,buffer:t,attribute:r,fromLength:n,toLength:a,fromStartIndices:d,getData:f=c=>c}){const c=r.doublePrecision&&r.value instanceof Float64Array?2:1,T=r.size*c,C=r.byteOffset,R=r.settings.bytesPerElement<4?C/r.settings.bytesPerElement*4:C,L=r.startIndices,V=d&&L,X=r.isConstant;if(!V&&t&&n>=a)return t;const at=r.value instanceof Float64Array?Float32Array:r.value.constructor,nt=X?r.value:new at(r.getBuffer().readSyncWebGL(C,a*at.BYTES_PER_ELEMENT).buffer);if(r.settings.normalized&&!X){const Ct=f;f=(Ht,Qt)=>r.normalizeConstant(Ct(Ht,Qt))}const K=X?(Ct,Ht)=>f(nt,Ht):(Ct,Ht)=>f(nt.subarray(Ct+C,Ct+C+T),Ht),It=t?new Float32Array(t.readSyncWebGL(R,n*4).buffer):new Float32Array(0),St=new Float32Array(a);return zk({source:It,target:St,sourceStartIndices:d,targetStartIndices:L,size:T,getData:K}),(!t||t.byteLength<St.byteLength+R)&&(t?.destroy(),t=e.createBuffer({byteLength:St.byteLength+R,usage:35050})),t.write(St,R),t}class ww{constructor({device:t,attribute:r,timeline:n}){this.buffers=[],this.currentLength=0,this.device=t,this.transition=new Nf(n),this.attribute=r,this.attributeInTransition=Vk(r),this.currentStartIndices=r.startIndices}get inProgress(){return this.transition.inProgress}start(t,r,n=1/0){this.settings=t,this.currentStartIndices=this.attribute.startIndices,this.currentLength=jk(this.attribute,r),this.transition.start({...t,duration:n})}update(){const t=this.transition.update();return t&&this.onUpdate(),t}setBuffer(t){this.attributeInTransition.setData({buffer:t,normalized:this.attribute.settings.normalized,value:this.attributeInTransition.value})}cancel(){this.transition.cancel()}delete(){this.cancel();for(const t of this.buffers)t.destroy();this.buffers.length=0}}class Hk extends ww{constructor({device:t,attribute:r,timeline:n}){super({device:t,attribute:r,timeline:n}),this.type="interpolation",this.transform=Wk(t,r)}start(t,r){const n=this.currentLength,a=this.currentStartIndices;if(super.start(t,r,t.duration),t.duration<=0){this.transition.cancel();return}const{buffers:d,attribute:f}=this;bw(d),d[0]=xw({device:this.device,buffer:d[0],attribute:f,fromLength:n,toLength:this.currentLength,fromStartIndices:a,getData:t.enter}),d[1]=vw({device:this.device,source:d[0],target:d[1]}),this.setBuffer(d[1]);const{transform:c}=this,T=c.model;let C=Math.floor(this.currentLength/f.size);Tw(f)&&(C/=2),T.setVertexCount(C),f.isConstant?(T.setAttributes({aFrom:d[0]}),T.setConstantAttributes({aTo:f.value})):T.setAttributes({aFrom:d[0],aTo:f.getBuffer()}),c.transformFeedback.setBuffers({vCurrent:d[1]})}onUpdate(){const{duration:t,easing:r}=this.settings,{time:n}=this.transition;let a=n/t;r&&(a=r(a));const{model:d}=this.transform;d.setUniforms({time:a}),this.transform.run({discard:!0})}delete(){super.delete(),this.transform.destroy()}}const Gk=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

uniform float time;
in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, time);
  gl_Position = vec4(0.0);
}
`,$k=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

uniform float time;
in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aFrom64Low;
in ATTRIBUTE_TYPE aTo;
in ATTRIBUTE_TYPE aTo64Low;
out ATTRIBUTE_TYPE vCurrent;
out ATTRIBUTE_TYPE vCurrent64Low;

vec2 mix_fp64(vec2 a, vec2 b, float x) {
  vec2 range = sub_fp64(b, a);
  return sum_fp64(a, mul_fp64(range, vec2(x, 0.0)));
}

void main(void) {
  for (int i=0; i<ATTRIBUTE_SIZE; i++) {
    vec2 value = mix_fp64(vec2(aFrom[i], aFrom64Low[i]), vec2(aTo[i], aTo64Low[i]), time);
    vCurrent[i] = value.x;
    vCurrent64Low[i] = value.y;
  }
  gl_Position = vec4(0.0);
}
`;function Tw(e){return e.doublePrecision&&e.value instanceof Float64Array}function Wk(e,t){const r=t.size,n=mw(r),a=yw(r),d=t.getBufferLayout();return Tw(t)?new gh(e,{vs:$k,bufferLayout:[{name:"aFrom",byteStride:8*r,attributes:[{attribute:"aFrom",format:a,byteOffset:0},{attribute:"aFrom64Low",format:a,byteOffset:4*r}]},{name:"aTo",byteStride:8*r,attributes:[{attribute:"aTo",format:a,byteOffset:0},{attribute:"aTo64Low",format:a,byteOffset:4*r}]}],modules:[lP],defines:{ATTRIBUTE_TYPE:n,ATTRIBUTE_SIZE:r},moduleSettings:{},varyings:["vCurrent","vCurrent64Low"],bufferMode:35980,disableWarnings:!0}):new gh(e,{vs:Gk,bufferLayout:[{name:"aFrom",format:a},{name:"aTo",format:d.attributes[0].format}],defines:{ATTRIBUTE_TYPE:n},varyings:["vCurrent"],disableWarnings:!0})}class Xk extends ww{constructor({device:t,attribute:r,timeline:n}){super({device:t,attribute:r,timeline:n}),this.type="spring",this.texture=Kk(t),this.framebuffer=Jk(t,this.texture),this.transform=Yk(t,r)}start(t,r){const n=this.currentLength,a=this.currentStartIndices;super.start(t,r);const{buffers:d,attribute:f}=this;for(let T=0;T<2;T++)d[T]=xw({device:this.device,buffer:d[T],attribute:f,fromLength:n,toLength:this.currentLength,fromStartIndices:a,getData:t.enter});d[2]=vw({device:this.device,source:d[0],target:d[2]}),this.setBuffer(d[1]);const{model:c}=this.transform;c.setVertexCount(Math.floor(this.currentLength/f.size)),f.isConstant?c.setConstantAttributes({aTo:f.value}):c.setAttributes({aTo:f.getBuffer()})}onUpdate(){const{buffers:t,transform:r,framebuffer:n,transition:a}=this,d=this.settings;r.model.setAttributes({aPrev:t[0],aCur:t[1]}),r.transformFeedback.setBuffers({vNext:t[2]}),r.model.setUniforms({stiffness:d.stiffness,damping:d.damping}),r.run({framebuffer:n,discard:!1,parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]}),bw(t),this.setBuffer(t[1]),this.device.readPixelsToArrayWebGL(n)[0]>0||a.end()}delete(){super.delete(),this.transform.destroy(),this.texture.destroy(),this.framebuffer.destroy()}}const qk=`#version 300 es
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

uniform float stiffness;
uniform float damping;
in ATTRIBUTE_TYPE aPrev;
in ATTRIBUTE_TYPE aCur;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vNext;
out float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE spring = delta * stiffness;
  ATTRIBUTE_TYPE damper = velocity * -1.0 * damping;
  return spring + damper + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,Zk=`#version 300 es
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

in float vIsTransitioningFlag;

out vec4 fragColor;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  fragColor = vec4(1.0);
}`;function Yk(e,t){const r=mw(t.size),n=yw(t.size);return new gh(e,{vs:qk,fs:Zk,bufferLayout:[{name:"aPrev",format:n},{name:"aCur",format:n},{name:"aTo",format:t.getBufferLayout().attributes[0].format}],varyings:["vNext"],defines:{ATTRIBUTE_TYPE:r},parameters:{depthCompare:"always",blendColorOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaOperation:"max",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}})}function Kk(e){return e.createTexture({data:new Uint8Array(4),format:"rgba8unorm",mipmaps:!1,width:1,height:1})}function Jk(e,t){return e.createFramebuffer({id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,colorAttachments:[t]})}const Qk={interpolation:Hk,spring:Xk};class tN{constructor(t,{id:r,timeline:n}){if(!t)throw new Error("AttributeTransitionManager is constructed without device");this.id=r,this.device=t,this.timeline=n,this.transitions={},this.needsRedraw=!1,this.numInstances=1}finalize(){for(const t in this.transitions)this._removeTransition(t)}update({attributes:t,transitions:r,numInstances:n}){this.numInstances=n||1;for(const a in t){const d=t[a],f=d.getTransitionSetting(r);f&&this._updateAttribute(a,d,f)}for(const a in this.transitions){const d=t[a];(!d||!d.getTransitionSetting(r))&&this._removeTransition(a)}}hasAttribute(t){const r=this.transitions[t];return r&&r.inProgress}getAttributes(){const t={};for(const r in this.transitions){const n=this.transitions[r];n.inProgress&&(t[r]=n.attributeInTransition)}return t}run(){if(this.numInstances===0)return!1;for(const r in this.transitions)this.transitions[r].update()&&(this.needsRedraw=!0);const t=this.needsRedraw;return this.needsRedraw=!1,t}_removeTransition(t){this.transitions[t].delete(),delete this.transitions[t]}_updateAttribute(t,r,n){const a=this.transitions[t];let d=!a||a.type!==n.type;if(d){a&&this._removeTransition(t);const f=Qk[n.type];f?this.transitions[t]=new f({attribute:r,timeline:this.timeline,device:this.device}):(Ye.error(`unsupported transition type '${n.type}'`)(),d=!1)}(d||r.needsRedraw())&&(this.needsRedraw=!0,this.transitions[t].start(n,this.numInstances))}}const Aw="attributeManager.invalidate",eN="attributeManager.updateStart",rN="attributeManager.updateEnd",iN="attribute.updateStart",sN="attribute.allocate",nN="attribute.updateEnd";class oN{constructor(t,{id:r="attribute-manager",stats:n,timeline:a}={}){this.mergeBoundsMemoized=uh(GB),this.id=r,this.device=t,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=n,this.attributeTransitionManager=new tN(t,{id:`${r}-transitions`,timeline:a}),Object.seal(this)}finalize(){for(const t in this.attributes)this.attributes[t].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(t={clearRedrawFlags:!1}){const r=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!t.clearRedrawFlags,r&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(t){this._add(t)}addInstanced(t){this._add(t,{stepMode:"instance"})}remove(t){for(const r of t)this.attributes[r]!==void 0&&(this.attributes[r].delete(),delete this.attributes[r])}invalidate(t,r){const n=this._invalidateTrigger(t,r);Yi(Aw,this,t,n)}invalidateAll(t){for(const r in this.attributes)this.attributes[r].setNeedsUpdate(r,t);Yi(Aw,this,"all")}update({data:t,numInstances:r,startIndices:n=null,transitions:a,props:d={},buffers:f={},context:c={}}){let T=!1;Yi(eN,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const C in this.attributes){const R=this.attributes[C],L=R.settings.accessor;R.startIndices=n,R.numInstances=r,d[C]&&Ye.removed(`props.${C}`,`data.attributes.${C}`)(),R.setExternalBuffer(f[C])||R.setBinaryValue(typeof L=="string"?f[L]:void 0,t.startIndices)||typeof L=="string"&&!f[L]&&R.setConstantValue(d[L])||R.needsUpdate()&&(T=!0,this._updateAttribute({attribute:R,numInstances:r,data:t,props:d,context:c})),this.needsRedraw=this.needsRedraw||R.needsRedraw()}T&&Yi(rN,this,r),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:r,transitions:a})}updateTransition(){const{attributeTransitionManager:t}=this,r=t.run();return this.needsRedraw=this.needsRedraw||r,r}getAttributes(){return{...this.attributes,...this.attributeTransitionManager.getAttributes()}}getBounds(t){const r=t.map(n=>this.attributes[n]?.getBounds());return this.mergeBoundsMemoized(r)}getChangedAttributes(t={clearChangedFlags:!1}){const{attributes:r,attributeTransitionManager:n}=this,a={...n.getAttributes()};for(const d in r){const f=r[d];f.needsRedraw(t)&&!n.hasAttribute(d)&&(a[d]=f)}return a}getBufferLayouts(t){return Object.values(this.getAttributes()).map(r=>r.getBufferLayout(t))}_add(t,r){for(const n in t){const a=t[n],d={...a,id:n,size:a.isIndexed&&1||a.size||1,...r};this.attributes[n]=new gw(this.device,d)}this._mapUpdateTriggersToAttributes()}_mapUpdateTriggersToAttributes(){const t={};for(const r in this.attributes)this.attributes[r].getUpdateTriggers().forEach(a=>{t[a]||(t[a]=[]),t[a].push(r)});this.updateTriggers=t}_invalidateTrigger(t,r){const{attributes:n,updateTriggers:a}=this,d=a[t];return d&&d.forEach(f=>{const c=n[f];c&&c.setNeedsUpdate(c.id,r)}),d}_updateAttribute(t){const{attribute:r,numInstances:n}=t;if(Yi(iN,r),r.constant){r.setConstantValue(r.value);return}r.allocate(n)&&Yi(sN,r,n),r.updateBuffer(t)&&(this.needsRedraw=!0,Yi(nN,r,n))}}class aN extends Nf{get value(){return this._value}_onUpdate(){const{time:t,settings:{fromValue:r,toValue:n,duration:a,easing:d}}=this,f=d(t/a);this._value=xf(r,n,f)}}const Ew=1e-5;function Sw(e,t,r,n,a){const d=t-e,c=(r-t)*a,T=-d*n;return c+T+d+t}function lN(e,t,r,n,a){if(Array.isArray(r)){const d=[];for(let f=0;f<r.length;f++)d[f]=Sw(e[f],t[f],r[f],n,a);return d}return Sw(e,t,r,n,a)}function Cw(e,t){if(Array.isArray(e)){let r=0;for(let n=0;n<e.length;n++){const a=e[n]-t[n];r+=a*a}return Math.sqrt(r)}return Math.abs(e-t)}class cN extends Nf{get value(){return this._currValue}_onUpdate(){const{fromValue:t,toValue:r,damping:n,stiffness:a}=this.settings,{_prevValue:d=t,_currValue:f=t}=this;let c=lN(d,f,r,n,a);const T=Cw(c,r),C=Cw(c,f);T<Ew&&C<Ew&&(c=r,this.end()),this._prevValue=f,this._currValue=c}}const uN={interpolation:aN,spring:cN};class hN{constructor(t){this.transitions=new Map,this.timeline=t}get active(){return this.transitions.size>0}add(t,r,n,a){const{transitions:d}=this;if(d.has(t)){const T=d.get(t),{value:C=T.settings.fromValue}=T;r=C,this.remove(t)}if(a=_w(a),!a)return;const f=uN[a.type];if(!f){Ye.error(`unsupported transition type '${a.type}'`)();return}const c=new f(this.timeline);c.start({...a,fromValue:r,toValue:n}),d.set(t,c)}remove(t){const{transitions:r}=this;r.has(t)&&(r.get(t).cancel(),r.delete(t))}update(){const t={};for(const[r,n]of this.transitions)n.update(),t[r]=n.value,n.inProgress||this.remove(r);return t}clear(){for(const t of this.transitions.keys())this.remove(t)}}function dN(e){const t=e[ra];for(const r in t){const n=t[r],{validate:a}=n;if(a&&!a(e[r],n))throw new Error(`Invalid prop ${r}: ${e[r]}`)}}function fN(e,t){const r=Iw({newProps:e,oldProps:t,propTypes:e[ra],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),n=_N(e,t);let a=!1;return n||(a=gN(e,t)),{dataChanged:n,propsChanged:r,updateTriggersChanged:a,extensionsChanged:mN(e,t),transitionsChanged:pN(e,t)}}function pN(e,t){if(!e.transitions)return!1;const r={},n=e[ra];let a=!1;for(const d in e.transitions){const f=n[d],c=f&&f.type;(c==="number"||c==="color"||c==="array")&&Gm(e[d],t[d],f)&&(r[d]=!0,a=!0)}return a?r:!1}function Iw({newProps:e,oldProps:t,ignoreProps:r={},propTypes:n={},triggerName:a="props"}){if(t===e)return!1;if(typeof e!="object"||e===null)return`${a} changed shallowly`;if(typeof t!="object"||t===null)return`${a} changed shallowly`;for(const d of Object.keys(e))if(!(d in r)){if(!(d in t))return`${a}.${d} added`;const f=Gm(e[d],t[d],n[d]);if(f)return`${a}.${d} ${f}`}for(const d of Object.keys(t))if(!(d in r)){if(!(d in e))return`${a}.${d} dropped`;if(!Object.hasOwnProperty.call(e,d)){const f=Gm(e[d],t[d],n[d]);if(f)return`${a}.${d} ${f}`}}return!1}function Gm(e,t,r){let n=r&&r.equal;return n&&!n(e,t,r)||!n&&(n=e&&t&&e.equals,n&&!n.call(e,t))?"changed deeply":!n&&t!==e?"changed shallowly":null}function _N(e,t){if(t===null)return"oldProps is null, initial diff";let r=!1;const{dataComparator:n,_dataDiff:a}=e;return n?n(e.data,t.data)||(r="Data comparator detected a change"):e.data!==t.data&&(r="A new data container was supplied"),r&&a&&(r=a(e.data,t.data)||r),r}function gN(e,t){if(t===null)return{all:!0};if("all"in e.updateTriggers&&Mw(e,t,"all"))return{all:!0};const r={};let n=!1;for(const a in e.updateTriggers)a!=="all"&&Mw(e,t,a)&&(r[a]=!0,n=!0);return n?r:!1}function mN(e,t){if(t===null)return!0;const r=t.extensions,{extensions:n}=e;if(n===r)return!1;if(!r||!n||n.length!==r.length)return!0;for(let a=0;a<n.length;a++)if(!n[a].equals(r[a]))return!0;return!1}function Mw(e,t,r){let n=e.updateTriggers[r];n=n??{};let a=t.updateTriggers[r];return a=a??{},Iw({oldProps:a,newProps:n,triggerName:r})}const yN="count(): argument not an object",bN="count(): argument not a container";function vN(e){if(!wN(e))throw new Error(yN);if(typeof e.count=="function")return e.count();if(Number.isFinite(e.size))return e.size;if(Number.isFinite(e.length))return e.length;if(xN(e))return Object.keys(e).length;throw new Error(bN)}function xN(e){return e!==null&&typeof e=="object"&&e.constructor===Object}function wN(e){return e!==null&&typeof e=="object"}function Rw(e,t){if(!t)return e;const r={...e,...t};if("defines"in t&&(r.defines={...e.defines,...t.defines}),"modules"in t&&(r.modules=(e.modules||[]).concat(t.modules),t.modules.some(n=>n.name==="project64"))){const n=r.modules.findIndex(a=>a.name==="project32");n>=0&&r.modules.splice(n,1)}if("inject"in t)if(!e.inject)r.inject=t.inject;else{const n={...e.inject};for(const a in t.inject)n[a]=(n[a]||"")+t.inject[a];r.inject=n}return r}const TN={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},$m={};function AN(e,t,r,n){if(r instanceof Is)return r;r.constructor&&r.constructor.name!=="Object"&&(r={data:r});let a=null;r.compressed&&(a={minFilter:"linear",mipmapFilter:r.data.length>1?"nearest":"linear"});const d=t.createTexture({...r,sampler:{...TN,...a,...n}});return $m[d.id]=e,d}function EN(e,t){!t||!(t instanceof Is)||$m[t.id]===e&&(t.delete(),delete $m[t.id])}const SN={boolean:{validate(e,t){return!0},equal(e,t,r){return!!e==!!t}},number:{validate(e,t){return Number.isFinite(e)&&(!("max"in t)||e<=t.max)&&(!("min"in t)||e>=t.min)}},color:{validate(e,t){return t.optional&&!e||Wm(e)&&(e.length===3||e.length===4)},equal(e,t,r){return Sn(e,t,1)}},accessor:{validate(e,t){const r=qf(e);return r==="function"||r===qf(t.value)},equal(e,t,r){return typeof t=="function"?!0:Sn(e,t,1)}},array:{validate(e,t){return t.optional&&!e||Wm(e)},equal(e,t,r){const{compare:n}=r,a=Number.isInteger(n)?n:n?1:0;return n?Sn(e,t,a):e===t}},object:{equal(e,t,r){if(r.ignore)return!0;const{compare:n}=r,a=Number.isInteger(n)?n:n?1:0;return n?Sn(e,t,a):e===t}},function:{validate(e,t){return t.optional&&!e||typeof e=="function"},equal(e,t,r){return!r.compare&&r.ignore!==!1||e===t}},data:{transform:(e,t,r)=>{if(!e)return e;const{dataTransform:n}=r.props;return n?n(e):typeof e.shape=="string"&&e.shape.endsWith("-table")&&Array.isArray(e.data)?e.data:e}},image:{transform:(e,t,r)=>{const n=r.context;return!n||!n.device?null:AN(r.id,n.device,e,{...t.parameters,...r.props.textureParameters})},release:(e,t,r)=>{EN(r.id,e)}}};function CN(e){const t={},r={},n={};for(const[a,d]of Object.entries(e)){const f=d?.deprecatedFor;if(f)n[a]=Array.isArray(f)?f:[f];else{const c=IN(a,d);t[a]=c,r[a]=c.value}}return{propTypes:t,defaultProps:r,deprecatedProps:n}}function IN(e,t){switch(qf(t)){case"object":return Ih(e,t);case"array":return Ih(e,{type:"array",value:t,compare:!1});case"boolean":return Ih(e,{type:"boolean",value:t});case"number":return Ih(e,{type:"number",value:t});case"function":return Ih(e,{type:"function",value:t,compare:!0});default:return{name:e,type:"unknown",value:t}}}function Ih(e,t){return"type"in t?{name:e,...SN[t.type],...t}:"value"in t?{name:e,type:qf(t.value),...t}:{name:e,type:"object",value:t}}function Wm(e){return Array.isArray(e)||ArrayBuffer.isView(e)}function qf(e){return Wm(e)?"array":e===null?"null":typeof e}function MN(e,t){let r;for(let d=t.length-1;d>=0;d--){const f=t[d];"extensions"in f&&(r=f.extensions)}const n=Xm(e.constructor,r),a=Object.create(n);a[kf]=e,a[el]={},a[ia]={};for(let d=0;d<t.length;++d){const f=t[d];for(const c in f)a[c]=f[c]}return Object.freeze(a),a}const RN="_mergedDefaultProps";function Xm(e,t){if(!(e instanceof Zf.constructor))return{};let r=RN;if(t)for(const a of t){const d=a.constructor;d&&(r+=`:${d.extensionName||d.name}`)}const n=Pw(e,r);return n||(e[r]=PN(e,t||[]))}function PN(e,t){if(!e.prototype)return null;const n=Object.getPrototypeOf(e),a=Xm(n),d=Pw(e,"defaultProps")||{},f=CN(d),c=Object.assign(Object.create(null),a,f.defaultProps),T=Object.assign(Object.create(null),a?.[ra],f.propTypes),C=Object.assign(Object.create(null),a?.[mm],f.deprecatedProps);for(const R of t){const L=Xm(R.constructor);L&&(Object.assign(c,L),Object.assign(T,L[ra]),Object.assign(C,L[mm]))}return BN(c,e),FN(c,T),DN(c,C),c[ra]=T,c[mm]=C,t.length===0&&!qm(e,"_propTypes")&&(e._propTypes=T),c}function BN(e,t){const r=kN(t);Object.defineProperties(e,{id:{writable:!0,value:r}})}function DN(e,t){for(const r in t)Object.defineProperty(e,r,{enumerable:!1,set(n){const a=`${this.id}: ${r}`;for(const d of t[r])qm(this,d)||(this[d]=n);Ye.deprecated(a,t[r].join("/"))()}})}function FN(e,t){const r={},n={};for(const a in t){const d=t[a],{name:f,value:c}=d;d.async&&(r[f]=c,n[f]=ON(f))}e[bc]=r,e[el]={},Object.defineProperties(e,n)}function ON(e){return{enumerable:!0,set(t){typeof t=="string"||t instanceof Promise||pw(t)?this[el][e]=t:this[ia][e]=t},get(){if(this[ia]){if(e in this[ia])return this[ia][e]||this[bc][e];if(e in this[el]){const t=this[kf]&&this[kf].internalState;if(t&&t.hasAsyncProp(e))return t.getAsyncProp(e)||this[bc][e]}}return this[bc][e]}}}function qm(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function Pw(e,t){return qm(e,t)&&e[t]}function kN(e){const t=e.componentName;return t||Ye.warn(`${e.name}.componentName not specified`)(),t||e.name}let NN=0;class Zf{constructor(...t){this.props=MN(this,t),this.id=this.props.id,this.count=NN++}clone(t){const{props:r}=this,n={};for(const a in r[bc])a in r[ia]?n[a]=r[ia][a]:a in r[el]&&(n[a]=r[el][a]);return new this.constructor({...r,...n,...t})}}Zf.componentName="Component",Zf.defaultProps={};const LN=Object.freeze({});class UN{constructor(t){this.component=t,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const t in this.asyncProps){const r=this.asyncProps[t];r&&r.type&&r.type.release&&r.type.release(r.resolvedValue,r.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||LN}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(t){return t in this.asyncProps}getAsyncProp(t){const r=this.asyncProps[t];return r&&r.resolvedValue}isAsyncPropLoading(t){if(t){const r=this.asyncProps[t];return!!(r&&r.pendingLoadCount>0&&r.pendingLoadCount!==r.resolvedLoadCount)}for(const r in this.asyncProps)if(this.isAsyncPropLoading(r))return!0;return!1}reloadAsyncProp(t,r){this._watchPromise(t,Promise.resolve(r))}setAsyncProps(t){this.component=t[kf]||this.component;const r=t[ia]||{},n=t[el]||t,a=t[bc]||{};for(const d in r){const f=r[d];this._createAsyncPropData(d,a[d]),this._updateAsyncProp(d,f),r[d]=this.getAsyncProp(d)}for(const d in n){const f=n[d];this._createAsyncPropData(d,a[d]),this._updateAsyncProp(d,f)}}_fetch(t,r){return null}_onResolve(t,r){}_onError(t,r){}_updateAsyncProp(t,r){if(this._didAsyncInputValueChange(t,r)){if(typeof r=="string"&&(r=this._fetch(t,r)),r instanceof Promise){this._watchPromise(t,r);return}if(pw(r)){this._resolveAsyncIterable(t,r);return}this._setPropValue(t,r)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const t in this.asyncProps)Object.defineProperty(this.oldAsyncProps,t,{enumerable:!0,value:this.oldProps[t]})}}_didAsyncInputValueChange(t,r){const n=this.asyncProps[t];return r===n.resolvedValue||r===n.lastValue?!1:(n.lastValue=r,!0)}_setPropValue(t,r){this._freezeAsyncOldProps();const n=this.asyncProps[t];n&&(r=this._postProcessValue(n,r),n.resolvedValue=r,n.pendingLoadCount++,n.resolvedLoadCount=n.pendingLoadCount)}_setAsyncPropValue(t,r,n){const a=this.asyncProps[t];a&&n>=a.resolvedLoadCount&&r!==void 0&&(this._freezeAsyncOldProps(),a.resolvedValue=r,a.resolvedLoadCount=n,this.onAsyncPropUpdated(t,r))}_watchPromise(t,r){const n=this.asyncProps[t];if(n){n.pendingLoadCount++;const a=n.pendingLoadCount;r.then(d=>{this.component&&(d=this._postProcessValue(n,d),this._setAsyncPropValue(t,d,a),this._onResolve(t,d))}).catch(d=>{this._onError(t,d)})}}async _resolveAsyncIterable(t,r){if(t!=="data"){this._setPropValue(t,r);return}const n=this.asyncProps[t];if(!n)return;n.pendingLoadCount++;const a=n.pendingLoadCount;let d=[],f=0;for await(const c of r){if(!this.component)return;const{dataTransform:T}=this.component.props;T?d=T(c,d):d=d.concat(c),Object.defineProperty(d,"__diff",{enumerable:!1,value:[{startRow:f,endRow:d.length}]}),f=d.length,this._setAsyncPropValue(t,d,a)}this._onResolve(t,d)}_postProcessValue(t,r){const n=t.type;return n&&this.component&&(n.release&&n.release(t.resolvedValue,n,this.component),n.transform)?n.transform(r,n,this.component):r}_createAsyncPropData(t,r){if(!this.asyncProps[t]){const a=this.component&&this.component.props[ra];this.asyncProps[t]={type:a&&a[t],lastValue:null,resolvedValue:r,pendingLoadCount:0,resolvedLoadCount:0}}}}class zN extends UN{constructor({attributeManager:t,layer:r}){super(r),this.attributeManager=t,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(t,r){const n=this.layer,a=n?.props.fetch;return a?a(r,{propName:t,layer:n}):super._fetch(t,r)}_onResolve(t,r){const n=this.layer;if(n){const a=n.props.onDataLoad;t==="data"&&a&&a(r,{propName:t,layer:n})}}_onError(t,r){const n=this.layer;n&&n.raiseError(r,`loading ${t} of ${this.layer}`)}}const VN="layer.changeFlag",jN="layer.initialize",HN="layer.update",GN="layer.finalize",$N="layer.matched",Bw=2**24-1,WN=Object.freeze([]),XN=uh(({oldViewport:e,viewport:t})=>e.equals(t));let io=new Uint8ClampedArray(0);const qN={data:{type:"data",value:WN,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:e=>e&&e.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(e,{propName:t,layer:r,loaders:n,loadOptions:a,signal:d})=>{const{resourceManager:f}=r.context;a=a||r.getLoadOptions(),n=n||r.props.loaders,d&&(a={...a,fetch:{...a?.fetch,signal:d}});let c=f.contains(e);return!c&&!a&&(f.add({resourceId:e,data:Ko(e,n),persistent:!1}),c=!0),c?f.subscribe({resourceId:e,onChange:T=>r.internalState?.reloadAsyncProp(t,T),consumerId:r.id,requestId:t}):Ko(e,n,a)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:$e.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:({layerIndex:e})=>[0,-e*100]},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class Ic extends Zf{constructor(){super(...arguments),this.internalState=null,this.lifecycle=yc.NO_STATE,this.parent=null}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let t=this;for(;t.parent;)t=t.parent;return t}toString(){return`${this.constructor.layerName||this.constructor.name}({id: '${this.props.id}'})`}project(t){bi(this.internalState);const r=this.internalState.viewport||this.context.viewport,n=o1(t,{viewport:r,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[a,d,f]=qx(n,r.pixelProjectionMatrix);return t.length===2?[a,d]:[a,d,f]}unproject(t){return bi(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(t)}projectPosition(t,r){bi(this.internalState);const n=this.internalState.viewport||this.context.viewport;return YB(t,{viewport:n,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...r})}get isComposite(){return!1}setState(t){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,t),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){const t=this.state;return t&&(t.models||t.model&&[t.model])||[]}setModuleParameters(t){for(const r of this.getModels())r.updateModuleSettings(t)}setShaderModuleProps(...t){for(const r of this.getModels())r.shaderInputs.setProps(...t)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:t}=this.props;return t===$e.DEFAULT||t===$e.LNGLAT||t===$e.CARTESIAN}onHover(t,r){return this.props.onHover&&this.props.onHover(t,r)||!1}onClick(t,r){return this.props.onClick&&this.props.onClick(t,r)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(t,r=[]){return r[0]=t+1&255,r[1]=t+1>>8&255,r[2]=t+1>>8>>8&255,r}decodePickingColor(t){bi(t instanceof Uint8Array);const[r,n,a]=t;return r+n*256+a*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:vN(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){return this.getAttributeManager()?.getBounds(["positions","instancePositions"])}getShaders(t){t=Rw(t,{disableWarnings:!0,modules:this.context.defaultShaderModules});for(const r of this.props.extensions)t=Rw(t,r.getShaders.call(this,r));return t}shouldUpdateState(t){return t.changeFlags.propsOrDataChanged}updateState(t){const r=this.getAttributeManager(),{dataChanged:n}=t.changeFlags;if(n&&r)if(Array.isArray(n))for(const a of n)r.invalidateAll(a);else r.invalidateAll();if(r){const{props:a}=t,d=this.internalState.hasPickingBuffer,f=Number.isInteger(a.highlightedObjectIndex)||a.pickable||a.extensions.some(c=>c.getNeedsPickingBuffer.call(this,c));if(d!==f){this.internalState.hasPickingBuffer=f;const{pickingColors:c,instancePickingColors:T}=r.attributes,C=c||T;C&&(f&&C.constant&&(C.constant=!1,r.invalidate(C.id)),!C.value&&!f&&(C.constant=!0,C.value=[0,0,0]))}}}finalizeState(t){for(const n of this.getModels())n.destroy();const r=this.getAttributeManager();r&&r.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(t){for(const r of this.getModels())r.draw(t)}getPickingInfo({info:t,mode:r,sourceLayer:n}){const{index:a}=t;return a>=0&&Array.isArray(this.props.data)&&(t.object=this.props.data[a]),t}raiseError(t,r){r&&(t=new Error(`${r}: ${t.message}`,{cause:t})),this.props.onError?.(t)||this.context?.onError?.(t,this)}getNeedsRedraw(t={clearRedrawFlags:!1}){return this._getNeedsRedraw(t)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){return this.internalState?.uniformTransitions.active||!1}activateViewport(t){if(!this.internalState)return;const r=this.internalState.viewport;this.internalState.viewport=t,(!r||!XN({oldViewport:r,viewport:t}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(t="all"){const r=this.getAttributeManager();r&&(t==="all"?r.invalidateAll():r.invalidate(t))}updateAttributes(t){let r=!1;for(const n in t)t[n].layoutChanged()&&(r=!0);for(const n of this.getModels())this._setModelAttributes(n,t,r)}_updateAttributes(){const t=this.getAttributeManager();if(!t)return;const r=this.props,n=this.getNumInstances(),a=this.getStartIndices();t.update({data:r.data,numInstances:n,startIndices:a,props:r,transitions:r.transitions,buffers:r.data.attributes,context:this});const d=t.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(d)}_updateAttributeTransition(){const t=this.getAttributeManager();t&&t.updateTransition()}_updateUniformTransition(){const{uniformTransitions:t}=this.internalState;if(t.active){const r=t.update(),n=Object.create(this.props);for(const a in r)Object.defineProperty(n,a,{value:r[a]});return n}return this.props}calculateInstancePickingColors(t,{numInstances:r}){if(t.constant)return;const n=Math.floor(io.length/4);if(this.internalState.usesPickingColorCache=!0,n<r){r>Bw&&Ye.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),io=dh.allocate(io,r,{size:4,copy:!0,maxCount:Math.max(r,Bw)});const a=Math.floor(io.length/4),d=[];for(let f=n;f<a;f++)this.encodePickingColor(f,d),io[f*4+0]=d[0],io[f*4+1]=d[1],io[f*4+2]=d[2]}t.value=io.subarray(0,r*4)}_setModelAttributes(t,r,n=!1){if(!Object.keys(r).length)return;if(n){const c=this.getAttributeManager();t.setBufferLayout(c.getBufferLayouts(t)),r=c.getAttributes()}const a=t.userData?.excludeAttributes||{},d={},f={};for(const c in r){if(a[c])continue;const T=r[c].getValue();for(const C in T){const R=T[C];R instanceof Fr?r[c].settings.isIndexed?t.setIndexBuffer(R):d[C]=R:R&&(f[C]=R)}}t.setAttributes(d),t.setConstantAttributes(f)}disablePickingIndex(t){const r=this.props.data;if(!("attributes"in r)){this._disablePickingIndex(t);return}const{pickingColors:n,instancePickingColors:a}=this.getAttributeManager().attributes,d=n||a,f=d&&r.attributes&&r.attributes[d.id];if(f&&f.value){const c=f.value,T=this.encodePickingColor(t);for(let C=0;C<r.length;C++){const R=d.getVertexOffset(C);c[R]===T[0]&&c[R+1]===T[1]&&c[R+2]===T[2]&&this._disablePickingIndex(C)}}else this._disablePickingIndex(t)}_disablePickingIndex(t){const{pickingColors:r,instancePickingColors:n}=this.getAttributeManager().attributes,a=r||n;if(!a)return;const d=a.getVertexOffset(t),f=a.getVertexOffset(t+1);a.buffer.write(new Uint8Array(f-d),d)}restorePickingColors(){const{pickingColors:t,instancePickingColors:r}=this.getAttributeManager().attributes,n=t||r;n&&(this.internalState.usesPickingColorCache&&n.value.buffer!==io.buffer&&(n.value=io.subarray(0,n.value.length)),n.updateSubBuffer({startOffset:0}))}_initialize(){bi(!this.internalState),bi(Number.isFinite(this.props.coordinateSystem)),Yi(jN,this);const t=this._getAttributeManager();t&&t.addInstanced({instancePickingColors:{type:"uint8",size:4,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new zN({attributeManager:t,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(Ye.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),t)}),this.internalState.uniformTransitions=new hN(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const r of this.props.extensions)r.initializeState.call(this,this.context,r);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(t){Yi($N,this,this===t);const{state:r,internalState:n}=t;this!==t&&(this.internalState=n,this.state=r,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const t=this.needsUpdate();if(Yi(HN,this,t),!t)return;const r=this.props,n=this.context,a=this.internalState,d=n.viewport,f=this._updateUniformTransition();a.propsInTransition=f,n.viewport=a.viewport||d,this.props=f;try{const c=this._getUpdateParams(),T=this.getModels();if(n.device)this.updateState(c);else try{this.updateState(c)}catch{}for(const R of this.props.extensions)R.updateState.call(this,c,R);const C=this.getModels()[0]!==T[0];this._postUpdate(c,C)}finally{n.viewport=d,this.props=r,this._clearChangeFlags(),a.needsUpdate=!1,a.resetOldProps()}}_finalize(){Yi(GN,this),this.finalizeState(this.context);for(const t of this.props.extensions)t.finalizeState.call(this,this.context,t)}_drawLayer({renderPass:t,moduleParameters:r=null,uniforms:n={},parameters:a={}}){this._updateAttributeTransition();const d=this.props,f=this.context;this.props=this.internalState.propsInTransition||d;const c=this.props.opacity;n.opacity=Math.pow(c,1/2.2);try{if(r){const{isActive:R,isAttribute:L}=r.picking;this.setModuleParameters(r),this.setShaderModuleProps({picking:{isActive:R,isAttribute:L}})}const{getPolygonOffset:T}=this.props,C=T&&T(n)||[0,0];f.device.setParametersWebGL({polygonOffset:C});for(const R of this.getModels())R.setParameters(a);f.device.withParametersWebGL(a,()=>{const R={renderPass:t,moduleParameters:r,uniforms:n,parameters:a,context:f};for(const L of this.props.extensions)L.draw.call(this,R,L);this.draw(R)})}finally{this.props=d}}getChangeFlags(){return this.internalState?.changeFlags}setChangeFlags(t){if(!this.internalState)return;const{changeFlags:r}=this.internalState;for(const a in t)if(t[a]){let d=!1;switch(a){case"dataChanged":const f=t[a],c=r[a];f&&Array.isArray(c)&&(r.dataChanged=Array.isArray(f)?c.concat(f):f,d=!0);default:r[a]||(r[a]=t[a],d=!0)}d&&Yi(VN,this,a,t)}const n=!!(r.dataChanged||r.updateTriggersChanged||r.propsChanged||r.extensionsChanged);r.propsOrDataChanged=n,r.somethingChanged=n||r.viewportChanged||r.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(t,r){const n=fN(t,r);if(n.updateTriggersChanged)for(const a in n.updateTriggersChanged)n.updateTriggersChanged[a]&&this.invalidateAttribute(a);if(n.transitionsChanged)for(const a in n.transitionsChanged)this.internalState.uniformTransitions.add(a,r[a],t[a],t.transitions?.[a]);return this.setChangeFlags(n)}validateProps(){dN(this.props)}updateAutoHighlight(t){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(t)}_updateAutoHighlight(t){const r={highlightedObjectColor:t.picked?t.color:null},{highlightColor:n}=this.props;t.picked&&typeof n=="function"&&(r.highlightColor=n(t)),this.setShaderModuleProps({picking:r}),this.setNeedsRedraw()}_getAttributeManager(){const t=this.context;return new oN(t.device,{id:this.props.id,stats:t.stats,timeline:t.timeline})}_postUpdate(t,r){const{props:n,oldProps:a}=t;this.setNeedsRedraw(),this._updateAttributes();const d=this.state.model;d?.isInstanced&&d.setInstanceCount(this.getNumInstances());const{autoHighlight:f,highlightedObjectIndex:c,highlightColor:T}=n;if(r||a.autoHighlight!==f||a.highlightedObjectIndex!==c||a.highlightColor!==T){const C={};Array.isArray(T)&&(C.highlightColor=T),(r||a.autoHighlight!==f||c!==a.highlightedObjectIndex)&&(C.highlightedObjectColor=Number.isFinite(c)&&c>=0?this.encodePickingColor(c):null),this.setShaderModuleProps({picking:C})}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(t){if(!this.internalState)return!1;let r=!1;r=r||this.internalState.needsRedraw&&this.id;const n=this.getAttributeManager(),a=n?n.getNeedsRedraw(t):!1;if(r=r||a,r)for(const d of this.props.extensions)d.onNeedsRedraw.call(this,d);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!t.clearRedrawFlags,r}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}Ic.defaultProps=qN,Ic.layerName="Layer";const ZN="compositeLayer.renderLayers";class Dw extends Ic{get isComposite(){return!0}get isLoaded(){return super.isLoaded&&this.getSubLayers().every(t=>t.isLoaded)}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(t){}setState(t){super.setState(t),this.setNeedsUpdate()}getPickingInfo({info:t}){const{object:r}=t;return r&&r.__source&&r.__source.parent&&r.__source.parent.id===this.id&&(t.object=r.__source.object,t.index=r.__source.index),t}filterSubLayer(t){return!0}shouldRenderSubLayer(t,r){return r&&r.length}getSubLayerClass(t,r){const{_subLayerProps:n}=this.props;return n&&n[t]&&n[t].type||r}getSubLayerRow(t,r,n){return t.__source={parent:this,object:r,index:n},t}getSubLayerAccessor(t){if(typeof t=="function"){const r={index:-1,data:this.props.data,target:[]};return(n,a)=>n&&n.__source?(r.index=n.__source.index,t(n.__source.object,r)):t(n,a)}return t}getSubLayerProps(t={}){const{opacity:r,pickable:n,visible:a,parameters:d,getPolygonOffset:f,highlightedObjectIndex:c,autoHighlight:T,highlightColor:C,coordinateSystem:R,coordinateOrigin:L,wrapLongitude:V,positionFormat:X,modelMatrix:at,extensions:nt,fetch:K,operation:It,_subLayerProps:St}=this.props,Ct={id:"",updateTriggers:{},opacity:r,pickable:n,visible:a,parameters:d,getPolygonOffset:f,highlightedObjectIndex:c,autoHighlight:T,highlightColor:C,coordinateSystem:R,coordinateOrigin:L,wrapLongitude:V,positionFormat:X,modelMatrix:at,extensions:nt,fetch:K,operation:It},Ht=St&&t.id&&St[t.id],Qt=Ht&&Ht.updateTriggers,ee=t.id||"sublayer";if(Ht){const ae=this.props[ra],be=t.type?t.type._propTypes:{};for(const ie in Ht){const le=be[ie]||ae[ie];le&&le.type==="accessor"&&(Ht[ie]=this.getSubLayerAccessor(Ht[ie]))}}Object.assign(Ct,t,Ht),Ct.id=`${this.props.id}-${ee}`,Ct.updateTriggers={all:this.props.updateTriggers?.all,...t.updateTriggers,...Qt};for(const ae of nt){const be=ae.getSubLayerProps.call(this,ae);be&&Object.assign(Ct,be,{updateTriggers:Object.assign(Ct.updateTriggers,be.updateTriggers)})}return Ct}_updateAutoHighlight(t){for(const r of this.getSubLayers())r.updateAutoHighlight(t)}_getAttributeManager(){return null}_postUpdate(t,r){let n=this.internalState.subLayers;const a=!n||this.needsUpdate();if(a){const d=this.renderLayers();n=vc(d,Boolean),this.internalState.subLayers=n}Yi(ZN,this,a,n);for(const d of n)d.parent=this}}Dw.layerName="CompositeLayer";const YN=`#version 300 es
#define SHADER_NAME point-cloud-layer-vertex-shader
in vec3 positions;
in vec3 instanceNormals;
in vec4 instanceColors;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec3 instancePickingColors;
uniform float opacity;
uniform float radiusPixels;
uniform int sizeUnits;
out vec4 vColor;
out vec2 unitPosition;
void main(void) {
geometry.worldPosition = instancePositions;
geometry.normal = project_normal(instanceNormals);
unitPosition = positions.xy;
geometry.uv = unitPosition;
geometry.pickingColor = instancePickingColors;
vec3 offset = vec3(positions.xy * project_size_to_pixel(radiusPixels, sizeUnits), 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
vec3 lightColor = lighting_getLightColor(instanceColors.rgb, project_uCameraPosition, geometry.position.xyz, geometry.normal);
vColor = vec4(lightColor, instanceColors.a * opacity);
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,KN=`#version 300 es
#define SHADER_NAME point-cloud-layer-fragment-shader
precision highp float;
in vec4 vColor;
in vec2 unitPosition;
out vec4 fragColor;
void main(void) {
geometry.uv = unitPosition;
float distToCenter = length(unitPosition);
if (distToCenter > 1.0) {
discard;
}
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,Fw=[0,0,0,255],Ow=[0,0,1],JN={sizeUnits:"pixels",pointSize:{type:"number",min:0,value:10},getPosition:{type:"accessor",value:e=>e.position},getNormal:{type:"accessor",value:Ow},getColor:{type:"accessor",value:Fw},material:!0,radiusPixels:{deprecatedFor:"pointSize"}};function QN(e){const{header:t,attributes:r}=e;if(!(!t||!r)&&(e.length=t.vertexCount,r.POSITION&&(r.instancePositions=r.POSITION),r.NORMAL&&(r.instanceNormals=r.NORMAL),r.COLOR_0)){const{size:n,value:a}=r.COLOR_0;r.instanceColors={size:n,type:"unorm8",value:a}}}class Zm extends Ic{getShaders(){return super.getShaders({vs:YN,fs:KN,modules:[im,U3,cm]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceNormals:{size:3,transition:!0,accessor:"getNormal",defaultValue:Ow},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getColor",defaultValue:Fw}})}updateState(t){const{changeFlags:r,props:n}=t;super.updateState(t),r.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll()),r.dataChanged&&QN(n.data)}draw({uniforms:t}){const{pointSize:r,sizeUnits:n}=this.props,a=this.state.model;a.setUniforms(t),a.setUniforms({sizeUnits:tm[n],radiusPixels:r}),a.draw(this.context.renderPass)}_getModel(){const t=[];for(let r=0;r<3;r++){const n=r/3*Math.PI*2;t.push(Math.cos(n)*2,Math.sin(n)*2,0)}return new ea(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new gc({topology:"triangle-list",attributes:{positions:new Float32Array(t)}}),isInstanced:!0})}}Zm.layerName="PointCloudLayer",Zm.defaultProps=JN;const Rs={OUTSIDE:-1,INTERSECTING:0,INSIDE:1};new Bt,new Bt;const Mh=new Bt,kw=new Bt;class Rh{constructor(t=[0,0,0],r=0){this.radius=-0,this.center=new Bt,this.fromCenterRadius(t,r)}fromCenterRadius(t,r){return this.center.from(t),this.radius=r,this}fromCornerPoints(t,r){return r=Mh.from(r),this.center=new Bt().from(t).add(r).scale(.5),this.radius=this.center.distance(r),this}equals(t){return this===t||!!t&&this.center.equals(t.center)&&this.radius===t.radius}clone(){return new Rh(this.center,this.radius)}union(t){const r=this.center,n=this.radius,a=t.center,d=t.radius,f=Mh.copy(a).subtract(r),c=f.magnitude();if(n>=c+d)return this.clone();if(d>=c+n)return t.clone();const T=(n+c+d)*.5;return kw.copy(f).scale((-n+T)/c).add(r),this.center.copy(kw),this.radius=T,this}expand(t){const n=Mh.from(t).subtract(this.center).magnitude();return n>this.radius&&(this.radius=n),this}transform(t){this.center.transform(t);const r=ZP(Mh,t);return this.radius=Math.max(r[0],Math.max(r[1],r[2]))*this.radius,this}distanceSquaredTo(t){const r=this.distanceTo(t);return r*r}distanceTo(t){const n=Mh.from(t).subtract(this.center);return Math.max(0,n.len()-this.radius)}intersectPlane(t){const r=this.center,n=this.radius,d=t.normal.dot(r)+t.distance;return d<-n?Rs.OUTSIDE:d<n?Rs.INTERSECTING:Rs.INSIDE}}const tL=new Bt,eL=new Bt,Yf=new Bt,Kf=new Bt,Jf=new Bt,rL=new Bt,iL=new Bt,Co={COLUMN0ROW0:0,COLUMN0ROW1:1,COLUMN0ROW2:2,COLUMN1ROW0:3,COLUMN1ROW1:4,COLUMN1ROW2:5,COLUMN2ROW0:6,COLUMN2ROW1:7,COLUMN2ROW2:8};class Ph{constructor(t=[0,0,0],r=[0,0,0,0,0,0,0,0,0]){this.center=new Bt().from(t),this.halfAxes=new Xr(r)}get halfSize(){const t=this.halfAxes.getColumn(0),r=this.halfAxes.getColumn(1),n=this.halfAxes.getColumn(2);return[new Bt(t).len(),new Bt(r).len(),new Bt(n).len()]}get quaternion(){const t=this.halfAxes.getColumn(0),r=this.halfAxes.getColumn(1),n=this.halfAxes.getColumn(2),a=new Bt(t).normalize(),d=new Bt(r).normalize(),f=new Bt(n).normalize();return new ch().fromMatrix3(new Xr([...a,...d,...f]))}fromCenterHalfSizeQuaternion(t,r,n){const a=new ch(n),d=new Xr().fromQuaternion(a);return d[0]=d[0]*r[0],d[1]=d[1]*r[0],d[2]=d[2]*r[0],d[3]=d[3]*r[1],d[4]=d[4]*r[1],d[5]=d[5]*r[1],d[6]=d[6]*r[2],d[7]=d[7]*r[2],d[8]=d[8]*r[2],this.center=new Bt().from(t),this.halfAxes=d,this}clone(){return new Ph(this.center,this.halfAxes)}equals(t){return this===t||!!t&&this.center.equals(t.center)&&this.halfAxes.equals(t.halfAxes)}getBoundingSphere(t=new Rh){const r=this.halfAxes,n=r.getColumn(0,Yf),a=r.getColumn(1,Kf),d=r.getColumn(2,Jf),f=tL.copy(n).add(a).add(d);return t.center.copy(this.center),t.radius=f.magnitude(),t}intersectPlane(t){const r=this.center,n=t.normal,a=this.halfAxes,d=n.x,f=n.y,c=n.z,T=Math.abs(d*a[Co.COLUMN0ROW0]+f*a[Co.COLUMN0ROW1]+c*a[Co.COLUMN0ROW2])+Math.abs(d*a[Co.COLUMN1ROW0]+f*a[Co.COLUMN1ROW1]+c*a[Co.COLUMN1ROW2])+Math.abs(d*a[Co.COLUMN2ROW0]+f*a[Co.COLUMN2ROW1]+c*a[Co.COLUMN2ROW2]),C=n.dot(r)+t.distance;return C<=-T?Rs.OUTSIDE:C>=T?Rs.INSIDE:Rs.INTERSECTING}distanceTo(t){return Math.sqrt(this.distanceSquaredTo(t))}distanceSquaredTo(t){const r=eL.from(t).subtract(this.center),n=this.halfAxes,a=n.getColumn(0,Yf),d=n.getColumn(1,Kf),f=n.getColumn(2,Jf),c=a.magnitude(),T=d.magnitude(),C=f.magnitude();a.normalize(),d.normalize(),f.normalize();let R=0,L;return L=Math.abs(r.dot(a))-c,L>0&&(R+=L*L),L=Math.abs(r.dot(d))-T,L>0&&(R+=L*L),L=Math.abs(r.dot(f))-C,L>0&&(R+=L*L),R}computePlaneDistances(t,r,n=[-0,-0]){let a=Number.POSITIVE_INFINITY,d=Number.NEGATIVE_INFINITY;const f=this.center,c=this.halfAxes,T=c.getColumn(0,Yf),C=c.getColumn(1,Kf),R=c.getColumn(2,Jf),L=rL.copy(T).add(C).add(R).add(f),V=iL.copy(L).subtract(t);let X=r.dot(V);return a=Math.min(X,a),d=Math.max(X,d),L.copy(f).add(T).add(C).subtract(R),V.copy(L).subtract(t),X=r.dot(V),a=Math.min(X,a),d=Math.max(X,d),L.copy(f).add(T).subtract(C).add(R),V.copy(L).subtract(t),X=r.dot(V),a=Math.min(X,a),d=Math.max(X,d),L.copy(f).add(T).subtract(C).subtract(R),V.copy(L).subtract(t),X=r.dot(V),a=Math.min(X,a),d=Math.max(X,d),f.copy(L).subtract(T).add(C).add(R),V.copy(L).subtract(t),X=r.dot(V),a=Math.min(X,a),d=Math.max(X,d),f.copy(L).subtract(T).add(C).subtract(R),V.copy(L).subtract(t),X=r.dot(V),a=Math.min(X,a),d=Math.max(X,d),f.copy(L).subtract(T).subtract(C).add(R),V.copy(L).subtract(t),X=r.dot(V),a=Math.min(X,a),d=Math.max(X,d),f.copy(L).subtract(T).subtract(C).subtract(R),V.copy(L).subtract(t),X=r.dot(V),a=Math.min(X,a),d=Math.max(X,d),n[0]=a,n[1]=d,n}transform(t){this.center.transformAsPoint(t);const r=this.halfAxes.getColumn(0,Yf);r.transformAsPoint(t);const n=this.halfAxes.getColumn(1,Kf);n.transformAsPoint(t);const a=this.halfAxes.getColumn(2,Jf);return a.transformAsPoint(t),this.halfAxes=new Xr([...r,...n,...a]),this}getTransform(){throw new Error("not implemented")}}const Nw=new Bt,Lw=new Bt;class so{constructor(t=[0,0,1],r=0){this.normal=new Bt,this.distance=-0,this.fromNormalDistance(t,r)}fromNormalDistance(t,r){return Tn(Number.isFinite(r)),this.normal.from(t).normalize(),this.distance=r,this}fromPointNormal(t,r){t=Nw.from(t),this.normal.from(r).normalize();const n=-this.normal.dot(t);return this.distance=n,this}fromCoefficients(t,r,n,a){return this.normal.set(t,r,n),Tn(wn(this.normal.len(),1)),this.distance=a,this}clone(){return new so(this.normal,this.distance)}equals(t){return wn(this.distance,t.distance)&&wn(this.normal,t.normal)}getPointDistance(t){return this.normal.dot(t)+this.distance}transform(t){const r=Lw.copy(this.normal).transformAsVector(t).normalize(),n=this.normal.scale(-this.distance).transform(t);return this.fromPointNormal(n,r)}projectPointOntoPlane(t,r=[0,0,0]){const n=Nw.from(t),a=this.getPointDistance(n),d=Lw.copy(this.normal).scale(a);return n.subtract(d).to(r)}}const Uw=[new Bt([1,0,0]),new Bt([0,1,0]),new Bt([0,0,1])],zw=new Bt,sL=new Bt;class an{constructor(t=[]){this.planes=t}fromBoundingSphere(t){this.planes.length=2*Uw.length;const r=t.center,n=t.radius;let a=0;for(const d of Uw){let f=this.planes[a],c=this.planes[a+1];f||(f=this.planes[a]=new so),c||(c=this.planes[a+1]=new so);const T=zw.copy(d).scale(-n).add(r);f.fromPointNormal(T,d);const C=zw.copy(d).scale(n).add(r),R=sL.copy(d).negate();c.fromPointNormal(C,R),a+=2}return this}computeVisibility(t){let r=Rs.INSIDE;for(const n of this.planes)switch(t.intersectPlane(n)){case Rs.OUTSIDE:return Rs.OUTSIDE;case Rs.INTERSECTING:r=Rs.INTERSECTING;break}return r}computeVisibilityWithPlaneMask(t,r){if(Tn(Number.isFinite(r),"parentPlaneMask is required."),r===an.MASK_OUTSIDE||r===an.MASK_INSIDE)return r;let n=an.MASK_INSIDE;const a=this.planes;for(let d=0;d<this.planes.length;++d){const f=d<31?1<<d:0;if(d<31&&(r&f)===0)continue;const c=a[d],T=t.intersectPlane(c);if(T===Rs.OUTSIDE)return an.MASK_OUTSIDE;T===Rs.INTERSECTING&&(n|=f)}return n}}an.MASK_OUTSIDE=4294967295,an.MASK_INSIDE=0,an.MASK_INDETERMINATE=2147483647,new Bt,new Bt,new Bt,new Bt,new Bt,new Bt,new Bt,new Bt,new Bt,new Bt,new Bt,new Bt,new Bt,new Bt,new Bt,new Bt,new Bt;const no=new Xr,nL=new Xr,oL=new Xr,Qf=new Xr,Vw=new Xr;function aL(e,t={}){const r=F3,n=10;let a=0,d=0;const f=nL,c=oL;f.identity(),c.copy(e);const T=r*lL(c);for(;d<n&&cL(c)>T;)uL(c,Qf),Vw.copy(Qf).transpose(),c.multiplyRight(Qf),c.multiplyLeft(Vw),f.multiplyRight(Qf),++a>2&&(++d,a=0);return t.unitary=f.toTarget(t.unitary),t.diagonal=c.toTarget(t.diagonal),t}function lL(e){let t=0;for(let r=0;r<9;++r){const n=e[r];t+=n*n}return Math.sqrt(t)}const Ym=[1,0,0],Km=[2,2,1];function cL(e){let t=0;for(let r=0;r<3;++r){const n=e[no.getElementIndex(Km[r],Ym[r])];t+=2*n*n}return Math.sqrt(t)}function uL(e,t){const r=Fx;let n=0,a=1;for(let C=0;C<3;++C){const R=Math.abs(e[no.getElementIndex(Km[C],Ym[C])]);R>n&&(a=C,n=R)}const d=Ym[a],f=Km[a];let c=1,T=0;if(Math.abs(e[no.getElementIndex(f,d)])>r){const C=e[no.getElementIndex(f,f)],R=e[no.getElementIndex(d,d)],L=e[no.getElementIndex(f,d)],V=(C-R)/2/L;let X;V<0?X=-1/(-V+Math.sqrt(1+V*V)):X=1/(V+Math.sqrt(1+V*V)),c=1/Math.sqrt(1+X*X),T=X*c}return Xr.IDENTITY.to(t),t[no.getElementIndex(d,d)]=t[no.getElementIndex(f,f)]=c,t[no.getElementIndex(f,d)]=T,t[no.getElementIndex(d,f)]=-T,t}const da=new Bt,hL=new Bt,dL=new Bt,fL=new Bt,pL=new Bt,_L=new Xr,gL={diagonal:new Xr,unitary:new Xr};function mL(e,t=new Ph){if(!e||e.length===0)return t.halfAxes=new Xr([0,0,0,0,0,0,0,0,0]),t.center=new Bt,t;const r=e.length,n=new Bt(0,0,0);for(const ie of e)n.add(ie);const a=1/r;n.multiplyByScalar(a);let d=0,f=0,c=0,T=0,C=0,R=0;for(const ie of e){const le=da.copy(ie).subtract(n);d+=le.x*le.x,f+=le.x*le.y,c+=le.x*le.z,T+=le.y*le.y,C+=le.y*le.z,R+=le.z*le.z}d*=a,f*=a,c*=a,T*=a,C*=a,R*=a;const L=_L;L[0]=d,L[1]=f,L[2]=c,L[3]=f,L[4]=T,L[5]=C,L[6]=c,L[7]=C,L[8]=R;const{unitary:V}=aL(L,gL),X=t.halfAxes.copy(V);let at=X.getColumn(0,dL),nt=X.getColumn(1,fL),K=X.getColumn(2,pL),It=-Number.MAX_VALUE,St=-Number.MAX_VALUE,Ct=-Number.MAX_VALUE,Ht=Number.MAX_VALUE,Qt=Number.MAX_VALUE,ee=Number.MAX_VALUE;for(const ie of e)da.copy(ie),It=Math.max(da.dot(at),It),St=Math.max(da.dot(nt),St),Ct=Math.max(da.dot(K),Ct),Ht=Math.min(da.dot(at),Ht),Qt=Math.min(da.dot(nt),Qt),ee=Math.min(da.dot(K),ee);at=at.multiplyByScalar(.5*(Ht+It)),nt=nt.multiplyByScalar(.5*(Qt+St)),K=K.multiplyByScalar(.5*(ee+Ct)),t.center.copy(at).add(nt).add(K);const ae=hL.set(It-Ht,St-Qt,Ct-ee).multiplyByScalar(.5),be=new Xr([ae[0],0,0,0,ae[1],0,0,0,ae[2]]);return t.halfAxes.multiplyRight(be),t}const Jm=Math.PI/180,tp=new Float32Array(16),jw=new Float32Array(12);function Hw(e,t,r){const n=t[0]*Jm,a=t[1]*Jm,d=t[2]*Jm,f=Math.sin(d),c=Math.sin(n),T=Math.sin(a),C=Math.cos(d),R=Math.cos(n),L=Math.cos(a),V=r[0],X=r[1],at=r[2];e[0]=V*L*R,e[1]=V*T*R,e[2]=V*-c,e[3]=X*(-T*C+L*c*f),e[4]=X*(L*C+T*c*f),e[5]=X*R*f,e[6]=at*(T*f+L*c*C),e[7]=at*(-L*f+T*c*C),e[8]=at*R*C}function Gw(e){return e[0]=e[0],e[1]=e[1],e[2]=e[2],e[3]=e[4],e[4]=e[5],e[5]=e[6],e[6]=e[8],e[7]=e[9],e[8]=e[10],e[9]=e[12],e[10]=e[13],e[11]=e[14],e.subarray(0,12)}const $w={size:12,accessor:["getOrientation","getScale","getTranslation","getTransformMatrix"],shaderAttributes:{instanceModelMatrixCol0:{size:3,elementOffset:0},instanceModelMatrixCol1:{size:3,elementOffset:3},instanceModelMatrixCol2:{size:3,elementOffset:6},instanceTranslation:{size:3,elementOffset:9}},update(e,{startRow:t,endRow:r}){const{data:n,getOrientation:a,getScale:d,getTranslation:f,getTransformMatrix:c}=this.props,T=Array.isArray(c),C=T&&c.length===16,R=Array.isArray(d),L=Array.isArray(a),V=Array.isArray(f),X=C||!T&&!!c(n[0]);X?e.constant=C:e.constant=L&&R&&V;const at=e.value;if(e.constant){let nt;X?(tp.set(c),nt=Gw(tp)):(nt=jw,Hw(nt,a,d),nt.set(f,9)),e.value=new Float32Array(nt)}else{let nt=t*e.size;const{iterable:K,objectInfo:It}=fw(n,t,r);for(const St of K){It.index++;let Ct;if(X)tp.set(C?c:c(St,It)),Ct=Gw(tp);else{Ct=jw;const Ht=L?a:a(St,It),Qt=R?d:d(St,It);Hw(Ct,Ht,Qt),Ct.set(V?f:f(St,It),9)}at[nt++]=Ct[0],at[nt++]=Ct[1],at[nt++]=Ct[2],at[nt++]=Ct[3],at[nt++]=Ct[4],at[nt++]=Ct[5],at[nt++]=Ct[6],at[nt++]=Ct[7],at[nt++]=Ct[8],at[nt++]=Ct[9],at[nt++]=Ct[10],at[nt++]=Ct[11]}}}};function Ww(e,t){return t===$e.CARTESIAN||t===$e.METER_OFFSETS||t===$e.DEFAULT&&!e.isGeospatial}const yL=`#version 300 es
#define SHADER_NAME simple-mesh-layer-vs
uniform float sizeScale;
uniform bool composeModelMatrix;
in vec3 positions;
in vec3 normals;
in vec3 colors;
in vec2 texCoords;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec3 instanceModelMatrixCol0;
in vec3 instanceModelMatrixCol1;
in vec3 instanceModelMatrixCol2;
in vec3 instanceTranslation;
out vec2 vTexCoord;
out vec3 cameraPosition;
out vec3 normals_commonspace;
out vec4 position_commonspace;
out vec4 vColor;
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = texCoords;
geometry.pickingColor = instancePickingColors;
vTexCoord = texCoords;
cameraPosition = project_uCameraPosition;
vColor = vec4(colors * instanceColors.rgb, instanceColors.a);
mat3 instanceModelMatrix = mat3(instanceModelMatrixCol0, instanceModelMatrixCol1, instanceModelMatrixCol2);
vec3 pos = (instanceModelMatrix * positions) * sizeScale + instanceTranslation;
if (composeModelMatrix) {
DECKGL_FILTER_SIZE(pos, geometry);
normals_commonspace = project_normal(instanceModelMatrix * normals);
geometry.worldPosition += pos;
gl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), position_commonspace);
geometry.position = position_commonspace;
}
else {
pos = project_size(pos);
DECKGL_FILTER_SIZE(pos, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, position_commonspace);
geometry.position = position_commonspace;
normals_commonspace = project_normal(instanceModelMatrix * normals);
}
geometry.normal = normals_commonspace;
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,bL=`#version 300 es
#define SHADER_NAME simple-mesh-layer-fs
precision highp float;
uniform bool hasTexture;
uniform sampler2D sampler;
uniform bool flatShading;
uniform float opacity;
in vec2 vTexCoord;
in vec3 cameraPosition;
in vec3 normals_commonspace;
in vec4 position_commonspace;
in vec4 vColor;
out vec4 fragColor;
void main(void) {
geometry.uv = vTexCoord;
vec3 normal;
if (flatShading) {
normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
} else {
normal = normals_commonspace;
}
vec4 color = hasTexture ? texture(sampler, vTexCoord) : vColor;
DECKGL_FILTER_COLOR(color, geometry);
vec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);
fragColor = vec4(lightColor, color.a * opacity);
}
`;function Qm(e){const t=e.positions||e.POSITION;Ye.assert(t,'no "postions" or "POSITION" attribute in mesh');const r=t.value.length/t.size;let n=e.COLOR_0||e.colors;n||(n={size:3,value:new Float32Array(r*3).fill(1)});let a=e.NORMAL||e.normals;a||(a={size:3,value:new Float32Array(r*3).fill(0)});let d=e.TEXCOORD_0||e.texCoords;return d||(d={size:2,value:new Float32Array(r*2).fill(0)}),{positions:t,colors:n,normals:a,texCoords:d}}function Xw(e){return e instanceof gc?(e.attributes=Qm(e.attributes),e):e.attributes?new gc({...e,topology:"triangle-list",attributes:Qm(e.attributes)}):new gc({topology:"triangle-list",attributes:Qm(e)})}const vL={mesh:{type:"object",value:null,async:!0},texture:{type:"image",value:null,async:!0},sizeScale:{type:"number",value:1,min:0},_instanced:!0,wireframe:!1,material:!0,getPosition:{type:"accessor",value:e=>e.position},getColor:{type:"accessor",value:[0,0,0,255]},getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]},textureParameters:{type:"object",ignore:!0,value:null}};class ty extends Ic{getShaders(){return super.getShaders({vs:yL,fs:bL,modules:[im,z3,cm]})}getBounds(){if(this.props._instanced)return super.getBounds();let t=this.state.positionBounds;if(t)return t;const{mesh:r}=this.props;if(!r)return null;if(t=r.header?.boundingBox,!t){const{attributes:n}=Xw(r);n.POSITION=n.POSITION||n.positions,t=uv(n)}return this.state.positionBounds=t,t}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{transition:!0,type:"float64",fp64:this.use64bitPositions(),size:3,accessor:"getPosition"},instanceColors:{type:"unorm8",transition:!0,size:this.props.colorFormat.length,accessor:"getColor",defaultValue:[0,0,0,255]},instanceModelMatrix:$w}),this.setState({emptyTexture:this.context.device.createTexture({data:new Uint8Array(4),width:1,height:1})})}updateState(t){super.updateState(t);const{props:r,oldProps:n,changeFlags:a}=t;if(r.mesh!==n.mesh||a.extensionsChanged){if(this.state.positionBounds=null,this.state.model?.destroy(),r.mesh){this.state.model=this.getModel(r.mesh);const d=r.mesh.attributes||r.mesh;this.setState({hasNormals:!!(d.NORMAL||d.normals)})}this.getAttributeManager().invalidateAll()}r.texture!==n.texture&&r.texture instanceof Is&&this.setTexture(r.texture),this.state.model&&this.state.model.setTopology(this.props.wireframe?"line-strip":"triangle-list")}finalizeState(t){super.finalizeState(t),this.state.emptyTexture.delete()}draw({uniforms:t}){const{model:r}=this.state;if(!r)return;const{viewport:n,renderPass:a}=this.context,{sizeScale:d,coordinateSystem:f,_instanced:c}=this.props;r.setUniforms(t),r.setUniforms({sizeScale:d,composeModelMatrix:!c||Ww(n,f),flatShading:!this.state.hasNormals}),r.draw(a)}get isLoaded(){return!!(this.state?.model&&super.isLoaded)}getModel(t){const r=new ea(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:Xw(t),isInstanced:!0}),{texture:n}=this.props,{emptyTexture:a}=this.state;return r.setBindings({sampler:n||a}),r.setUniforms({hasTexture:!!n}),r}setTexture(t){const{emptyTexture:r,model:n}=this.state;n&&(n.setBindings({sampler:t||r}),n.setUniforms({hasTexture:!!t}))}}ty.defaultProps=vL,ty.layerName="SimpleMeshLayer";var In;(function(e){e[e.FUNC_ADD=32774]="FUNC_ADD",e[e.ONE=1]="ONE",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",e[e.LINEAR=9729]="LINEAR",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL"})(In||(In={}));function qw(e,t,r,n){const a={defines:{MANUAL_SRGB:1,SRGB_FAST_APPROXIMATION:1},bindings:{},uniforms:{u_Camera:[0,0,0],u_MetallicRoughnessValues:[1,1]},parameters:{},glParameters:{},generatedTextures:[]};a.defines.USE_TEX_LOD=1;const{imageBasedLightingEnvironment:d}=n;return d&&(a.bindings.u_DiffuseEnvSampler=d.diffuseEnvSampler,a.bindings.u_SpecularEnvSampler=d.specularEnvSampler,a.bindings.u_brdfLUT=d.brdfLutTexture,a.uniforms.u_ScaleIBLAmbient=[1,1]),n?.pbrDebug&&(a.defines.PBR_DEBUG=1,a.uniforms.u_ScaleDiffBaseMR=[0,0,0,0],a.uniforms.u_ScaleFGDSpec=[0,0,0,0]),r.NORMAL&&(a.defines.HAS_NORMALS=1),r.TANGENT&&n?.useTangents&&(a.defines.HAS_TANGENTS=1),r.TEXCOORD_0&&(a.defines.HAS_UV=1),n?.imageBasedLightingEnvironment&&(a.defines.USE_IBL=1),n?.lights&&(a.defines.USE_LIGHTS=1),t&&xL(e,t,a),a}function xL(e,t,r){if(r.uniforms.pbr_uUnlit=!!t.unlit,t.pbrMetallicRoughness&&wL(e,t.pbrMetallicRoughness,r),t.normalTexture){Bh(e,t.normalTexture,"u_NormalSampler","HAS_NORMALMAP",r);const{scale:n=1}=t.normalTexture;r.uniforms.u_NormalScale=n}if(t.occlusionTexture){Bh(e,t.occlusionTexture,"u_OcclusionSampler","HAS_OCCLUSIONMAP",r);const{strength:n=1}=t.occlusionTexture;r.uniforms.u_OcclusionStrength=n}switch(t.emissiveTexture&&(Bh(e,t.emissiveTexture,"u_EmissiveSampler","HAS_EMISSIVEMAP",r),r.uniforms.u_EmissiveFactor=t.emissiveFactor||[0,0,0]),t.alphaMode){case"MASK":const{alphaCutoff:n=.5}=t;r.defines.ALPHA_CUTOFF=1,r.uniforms.u_AlphaCutoff=n;break;case"BLEND":te.warn("glTF BLEND alphaMode might not work well because it requires mesh sorting")(),r.parameters.blendColorOperation="add",r.parameters.blendColorSrcFactor="src-alpha",r.parameters.blendColorDstFactor="one-minus-src-alpha",r.parameters.blendAlphaOperation="add",r.parameters.blendAlphaSrcFactor="one",r.parameters.blendAlphaDstFactor="one-minus-src-alpha",r.glParameters.blend=!0,r.glParameters.blendEquation=In.FUNC_ADD,r.glParameters.blendFunc=[In.SRC_ALPHA,In.ONE_MINUS_SRC_ALPHA,In.ONE,In.ONE_MINUS_SRC_ALPHA];break}}function wL(e,t,r){t.baseColorTexture&&Bh(e,t.baseColorTexture,"u_BaseColorSampler","HAS_BASECOLORMAP",r),r.uniforms.u_BaseColorFactor=t.baseColorFactor||[1,1,1,1],t.metallicRoughnessTexture&&Bh(e,t.metallicRoughnessTexture,"u_MetallicRoughnessSampler","HAS_METALROUGHNESSMAP",r);const{metallicFactor:n=1,roughnessFactor:a=1}=t;r.uniforms.u_MetallicRoughnessValues=[n,a]}function Bh(e,t,r,n=null,a){const d=t?.texture?.sampler?.parameters||{},f=t.texture.source.image;let c,T={};f.compressed?(c=f,T={[In.TEXTURE_MIN_FILTER]:f.data.length>1?In.LINEAR_MIPMAP_NEAREST:In.LINEAR}):c={data:f};const C=e.createTexture({id:t.uniformName||t.id,parameters:{...d,...T},pixelStore:{[In.UNPACK_FLIP_Y_WEBGL]:!1},...c});a.bindings[r]=C,n&&(a.defines[n]=1),a.generatedTextures.push(C)}const TL="4.3.1",ep={TRANSCODER:"basis_transcoder.js",TRANSCODER_WASM:"basis_transcoder.wasm",ENCODER:"basis_encoder.js",ENCODER_WASM:"basis_encoder.wasm"};let Zw;async function Yw(e){gC(e.modules);const t=mC("basis");return t||(Zw||=AL(e),await Zw)}async function AL(e){let t=null,r=null;return[t,r]=await Promise.all([await Ga(ep.TRANSCODER,"textures",e),await Ga(ep.TRANSCODER_WASM,"textures",e)]),t=t||globalThis.BASIS,await EL(t,r)}function EL(e,t){const r={};return t&&(r.wasmBinary=t),new Promise(n=>{e(r).then(a=>{const{BasisFile:d,initializeBasis:f}=a;f(),n({BasisFile:d})})})}let ey;async function Kw(e){const t=e.modules||{};return t.basisEncoder?t.basisEncoder:(ey=ey||SL(e),await ey)}async function SL(e){let t=null,r=null;return[t,r]=await Promise.all([await Ga(ep.ENCODER,"textures",e),await Ga(ep.ENCODER_WASM,"textures",e)]),t=t||globalThis.BASIS,await CL(t,r)}function CL(e,t){const r={};return t&&(r.wasmBinary=t),new Promise(n=>{e(r).then(a=>{const{BasisFile:d,KTX2File:f,initializeBasis:c,BasisEncoder:T}=a;c(),n({BasisFile:d,KTX2File:f,BasisEncoder:T})})})}const Mc={COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGB_ETC1_WEBGL:36196,COMPRESSED_RGBA_ASTC_4X4_KHR:37808},IL=["","WEBKIT_","MOZ_"],Jw={WEBGL_compressed_texture_s3tc:"dxt",WEBGL_compressed_texture_s3tc_srgb:"dxt-srgb",WEBGL_compressed_texture_etc1:"etc1",WEBGL_compressed_texture_etc:"etc2",WEBGL_compressed_texture_pvrtc:"pvrtc",WEBGL_compressed_texture_atc:"atc",WEBGL_compressed_texture_astc:"astc",EXT_texture_compression_rgtc:"rgtc"};let rp=null;function ML(e){if(!rp){e=e||RL()||void 0,rp=new Set;for(const t of IL)for(const r in Jw)if(e&&e.getExtension(`${t}${r}`)){const n=Jw[r];rp.add(n)}}return rp}function RL(){try{return document.createElement("canvas").getContext("webgl")}catch{return null}}const Ps=[171,75,84,88,32,50,48,187,13,10,26,10];function PL(e){const t=new Uint8Array(e);return!(t.byteLength<Ps.length||t[0]!==Ps[0]||t[1]!==Ps[1]||t[2]!==Ps[2]||t[3]!==Ps[3]||t[4]!==Ps[4]||t[5]!==Ps[5]||t[6]!==Ps[6]||t[7]!==Ps[7]||t[8]!==Ps[8]||t[9]!==Ps[9]||t[10]!==Ps[10]||t[11]!==Ps[11])}const BL={etc1:{basisFormat:0,compressed:!0,format:Mc.COMPRESSED_RGB_ETC1_WEBGL},etc2:{basisFormat:1,compressed:!0},bc1:{basisFormat:2,compressed:!0,format:Mc.COMPRESSED_RGB_S3TC_DXT1_EXT},bc3:{basisFormat:3,compressed:!0,format:Mc.COMPRESSED_RGBA_S3TC_DXT5_EXT},bc4:{basisFormat:4,compressed:!0},bc5:{basisFormat:5,compressed:!0},"bc7-m6-opaque-only":{basisFormat:6,compressed:!0},"bc7-m5":{basisFormat:7,compressed:!0},"pvrtc1-4-rgb":{basisFormat:8,compressed:!0,format:Mc.COMPRESSED_RGB_PVRTC_4BPPV1_IMG},"pvrtc1-4-rgba":{basisFormat:9,compressed:!0,format:Mc.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG},"astc-4x4":{basisFormat:10,compressed:!0,format:Mc.COMPRESSED_RGBA_ASTC_4X4_KHR},"atc-rgb":{basisFormat:11,compressed:!0},"atc-rgba-interpolated-alpha":{basisFormat:12,compressed:!0},rgba32:{basisFormat:13,compressed:!1},rgb565:{basisFormat:14,compressed:!1},bgr565:{basisFormat:15,compressed:!1},rgba4444:{basisFormat:16,compressed:!1}};async function DL(e,t){if(t.basis.containerFormat==="auto"){if(PL(e)){const n=await Kw(t);return Qw(n.KTX2File,e,t)}const{BasisFile:r}=await Yw(t);return ry(r,e,t)}switch(t.basis.module){case"encoder":const r=await Kw(t);switch(t.basis.containerFormat){case"ktx2":return Qw(r.KTX2File,e,t);case"basis":default:return ry(r.BasisFile,e,t)}case"transcoder":default:const{BasisFile:n}=await Yw(t);return ry(n,e,t)}}function ry(e,t,r){const n=new e(new Uint8Array(t));try{if(!n.startTranscoding())throw new Error("Failed to start basis transcoding");const a=n.getNumImages(),d=[];for(let f=0;f<a;f++){const c=n.getNumLevels(f),T=[];for(let C=0;C<c;C++)T.push(FL(n,f,C,r));d.push(T)}return d}finally{n.close(),n.delete()}}function FL(e,t,r,n){const a=e.getImageWidth(t,r),d=e.getImageHeight(t,r),f=e.getHasAlpha(),{compressed:c,format:T,basisFormat:C}=tT(n,f),R=e.getImageTranscodedSizeInBytes(t,r,C),L=new Uint8Array(R);if(!e.transcodeImage(L,t,r,C,0,0))throw new Error("failed to start Basis transcoding");return{width:a,height:d,data:L,compressed:c,format:T,hasAlpha:f}}function Qw(e,t,r){const n=new e(new Uint8Array(t));try{if(!n.startTranscoding())throw new Error("failed to start KTX2 transcoding");const a=n.getLevels(),d=[];for(let f=0;f<a;f++)d.push(OL(n,f,r));return[d]}finally{n.close(),n.delete()}}function OL(e,t,r){const{alphaFlag:n,height:a,width:d}=e.getImageLevelInfo(t,0,0),{compressed:f,format:c,basisFormat:T}=tT(r,n),C=e.getImageTranscodedSizeInBytes(t,0,0,T),R=new Uint8Array(C);if(!e.transcodeImage(R,t,0,0,T,0,-1,-1))throw new Error("Failed to transcode KTX2 image");return{width:d,height:a,data:R,compressed:f,levelSize:C,hasAlpha:n,format:c}}function tT(e,t){let r=e&&e.basis&&e.basis.format;return r==="auto"&&(r=eT()),typeof r=="object"&&(r=t?r.alpha:r.noAlpha),r=r.toLowerCase(),BL[r]}function eT(){const e=ML();return e.has("astc")?"astc-4x4":e.has("dxt")?{alpha:"bc3",noAlpha:"bc1"}:e.has("pvrtc")?{alpha:"pvrtc1-4-rgba",noAlpha:"pvrtc1-4-rgb"}:e.has("etc1")?"etc1":e.has("etc2")?"etc2":"rgb565"}const kL={...{dataType:null,batchType:null,name:"Basis",id:"basis",module:"textures",version:TL,worker:!0,extensions:["basis","ktx2"],mimeTypes:["application/octet-stream","image/ktx2"],tests:["sB"],binary:!0,options:{basis:{format:"auto",libraryPath:"libs/",containerFormat:"auto",module:"transcoder"}}},parse:DL},NL={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},LL={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};class UL{name;startTime=0;playing=!0;speed=1;channels=[];constructor(t){Object.assign(this,t)}animate(t){if(!this.playing)return;const n=(t/1e3-this.startTime)*this.speed;this.channels.forEach(({sampler:a,target:d,path:f})=>{XL(n,a,d,f),jL(d,d._node)})}}class zL{animations;constructor(t){this.animations=t.animations.map((r,n)=>{const a=r.name||`Animation-${n}`,d=r.samplers.map(({input:c,interpolation:T="LINEAR",output:C})=>({input:rT(t.accessors[c]),interpolation:T,output:rT(t.accessors[C])})),f=r.channels.map(({sampler:c,target:T})=>({sampler:d[c],target:t.nodes[T.node],path:T.path}));return new UL({name:a,channels:f})})}animate(t){this.setTime(t)}setTime(t){this.animations.forEach(r=>r.animate(t))}getAnimations(){return this.animations}}function rT(e){if(!e._animation){const t=LL[e.componentType],r=NL[e.type],n=r*e.count,{buffer:a,byteOffset:d}=e.bufferView.data,f=new t(a,d+(e.byteOffset||0),n);if(r===1)e._animation=Array.from(f);else{const c=[];for(let T=0;T<f.length;T+=r)c.push(Array.from(f.slice(T,T+r)));e._animation=c}}return e._animation}const VL=new He;function jL(e,t){if(t.matrix.identity(),e.translation&&t.matrix.translate(e.translation),e.rotation){const r=VL.fromQuaternion(e.rotation);t.matrix.multiplyRight(r)}e.scale&&t.matrix.scale(e.scale)}const iy=new ch;function HL(e,t,r,n,a){if(t==="rotation"){iy.slerp({start:r,target:n,ratio:a});for(let d=0;d<iy.length;d++)e[t][d]=iy[d]}else for(let d=0;d<r.length;d++)e[t][d]=a*n[d]+(1-a)*r[d]}function $L(e,t,{p0:r,outTangent0:n,inTangent1:a,p1:d,tDiff:f,ratio:c}){for(let T=0;T<e[t].length;T++){const C=n[T]*f,R=a[T]*f;e[t][T]=(2*Math.pow(c,3)-3*Math.pow(c,2)+1)*r[T]+(Math.pow(c,3)-2*Math.pow(c,2)+c)*C+(-2*Math.pow(c,3)+3*Math.pow(c,2))*d[T]+(Math.pow(c,3)-Math.pow(c,2))*R}}function WL(e,t,r){for(let n=0;n<r.length;n++)e[t][n]=r[n]}function XL(e,{input:t,interpolation:r,output:n},a,d){const f=t[t.length-1],c=e%f,T=t.findIndex(V=>V>=c),C=Math.max(0,T-1);if(!Array.isArray(a[d]))switch(d){case"translation":a[d]=[0,0,0];break;case"rotation":a[d]=[0,0,0,1];break;case"scale":a[d]=[1,1,1];break;default:te.warn(`Bad animation path ${d}`)()}tr(a[d].length===n[C].length);const R=t[C],L=t[T];switch(r){case"STEP":WL(a,d,n[C]);break;case"LINEAR":if(L>R){const V=(c-R)/(L-R);HL(a,d,n[C],n[T],V)}break;case"CUBICSPLINE":if(L>R){const V=(c-R)/(L-R),X=L-R,at=n[3*C+1],nt=n[3*C+2],K=n[3*T+0],It=n[3*T+1];$L(a,d,{p0:at,outTangent0:nt,inTangent1:K,p1:It,tDiff:X,ratio:V})}break;default:te.warn(`Interpolation ${r} not supported`)();break}}const qL=`
#pragma vscode_glsllint_stage: vert
#if (__VERSION__ < 300)
  #define _attr attribute
#else
  #define _attr in
#endif

  // _attr vec4 POSITION;
  _attr vec4 positions;

  #ifdef HAS_NORMALS
    // _attr vec4 NORMAL;
    _attr vec4 normals;
  #endif

  #ifdef HAS_TANGENTS
    _attr vec4 TANGENT;
  #endif

  #ifdef HAS_UV
    // _attr vec2 TEXCOORD_0;
    _attr vec2 texCoords;
  #endif

  void main(void) {
    vec4 _NORMAL = vec4(0.);
    vec4 _TANGENT = vec4(0.);
    vec2 _TEXCOORD_0 = vec2(0.);

    #ifdef HAS_NORMALS
      _NORMAL = normals;
    #endif

    #ifdef HAS_TANGENTS
      _TANGENT = TANGENT;
    #endif

    #ifdef HAS_UV
      _TEXCOORD_0 = texCoords;
    #endif

    pbr_setPositionNormalTangentUV(positions, _NORMAL, _TANGENT, _TEXCOORD_0);
    gl_Position = u_MVPMatrix * positions;
  }
`,ZL=`
#pragma vscode_glsllint_stage: frag
#if (__VERSION__ < 300)
  #define fragmentColor gl_FragColor
#else
  out vec4 fragmentColor;
#endif

  void main(void) {
    vec3 pos = pbr_vPosition;
    fragmentColor = pbr_filterColor(vec4(1.0));
  }
`;function YL(e,t){const{id:r,geometry:n,material:a,vertexCount:d,materialOptions:f,modelOptions:c}=t,T=qw(e,a,n.attributes,f);te.info(4,"createGLTFModel defines: ",T.defines)();const C=[],R={depthWriteEnabled:!0,depthCompare:"less",depthFormat:"depth24plus",cullMode:"back"},L={id:r,geometry:n,topology:n.topology,vertexCount:d,modules:[Qg],vs:iT(e,qL),fs:iT(e,ZL),...c,bindings:{...T.bindings,...c.bindings},defines:{...T.defines,...c.defines},parameters:{...R,...T.parameters,...c.parameters},uniforms:{...T.uniforms,...c.uniforms}},V=new ea(e,L);return new gm({managedResources:C,model:V})}function iT(e,t){return`#version 300 es
${t}`}const KL={modelOptions:{},pbrDebug:!1,imageBasedLightingEnvironment:null,lights:!0,useTangents:!1};class JL{device;options;gltf;constructor(t,r={}){this.device=t,this.options={...KL,...r}}instantiate(t){return this.gltf=t,(t.scenes||[]).map(n=>this.createScene(n))}createAnimator(){return Array.isArray(this.gltf.animations)?new zL(this.gltf):null}createScene(t){const n=(t.nodes||[]).map(d=>this.createNode(d));return new mc({id:t.name||t.id,children:n})}createNode(t){if(!t._node){const n=(t.children||[]).map(d=>this.createNode(d));t.mesh&&n.push(this.createMesh(t.mesh));const a=new mc({id:t.name||t.id,children:n});if(t.matrix)a.setMatrix(t.matrix);else{if(a.matrix.identity(),t.translation&&a.matrix.translate(t.translation),t.rotation){const d=new He().fromQuaternion(t.rotation);a.matrix.multiplyRight(d)}t.scale&&a.matrix.scale(t.scale)}t._node=a}return t._node}createMesh(t){if(!t._mesh){const n=(t.primitives||[]).map((d,f)=>this.createPrimitive(d,f,t)),a=new mc({id:t.name||t.id,children:n});t._mesh=a}return t._mesh}createPrimitive(t,r,n){const a=t.name||`${n.name||n.id}-primitive-${r}`,d=QL(t.mode||4),f=t.indices?t.indices.count:this.getVertexCount(t.attributes),c=YL(this.device,{id:a,geometry:this.createGeometry(a,t,d),material:t.material,materialOptions:this.options,modelOptions:this.options.modelOptions,vertexCount:f});return c.bounds=[t.attributes.POSITION.min,t.attributes.POSITION.max],c}getVertexCount(t){throw new Error("getVertexCount not implemented")}createGeometry(t,r,n){const a={};for(const[d,f]of Object.entries(r.attributes)){const{components:c,size:T,value:C}=f;a[d]={size:T??c,value:C}}return new gc({id:t,topology:n,indices:r.indices.value,attributes:a})}createBuffer(t,r){t.bufferView||(t.bufferView={});const{bufferView:n}=t;return n.lumaBuffers||(n.lumaBuffers={}),n.lumaBuffers[r]||(n.lumaBuffers[r]=this.device.createBuffer({id:`from-${n.id}`,data:n.data||t.value})),n.lumaBuffers[r]}createSampler(t){return t}needsPOT(){return!1}}var Io;(function(e){e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN"})(Io||(Io={}));function QL(e){switch(e){case Io.POINTS:return"point-list";case Io.LINES:return"line-list";case Io.LINE_STRIP:return"line-strip";case Io.LINE_LOOP:return"line-loop-webgl";case Io.TRIANGLES:return"triangle-list";case Io.TRIANGLE_STRIP:return"triangle-strip";case Io.TRIANGLE_FAN:return"triangle-fan-webgl";default:throw new Error(e)}}function tU(e,t,r){const n=new JL(e,r),a=n.instantiate(t),d=n.createAnimator();return{scenes:a,animator:d}}function Bs(e,t){if(!e)throw new Error(t||"assert failed: gltf")}const sT={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},nT={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},eU=1.33,oT=["SCALAR","VEC2","VEC3","VEC4"],rU=[[Int8Array,5120],[Uint8Array,5121],[Int16Array,5122],[Uint16Array,5123],[Uint32Array,5125],[Float32Array,5126],[Float64Array,5130]],iU=new Map(rU),sU={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},nU={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},oU={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function aT(e){return oT[e-1]||oT[0]}function ip(e){const t=iU.get(e.constructor);if(!t)throw new Error("Illegal typed array");return t}function sy(e,t){const r=oU[e.componentType],n=sU[e.type],a=nU[e.componentType],d=e.count*n,f=e.count*n*a;Bs(f>=0&&f<=t.byteLength);const c=nT[e.componentType],T=sT[e.type];return{ArrayType:r,length:d,byteLength:f,componentByteSize:c,numberOfComponentsInElement:T}}function lT(e){let{images:t,bufferViews:r}=e;t=t||[],r=r||[];const n=t.map(f=>f.bufferView);r=r.filter(f=>!n.includes(f));const a=r.reduce((f,c)=>f+c.byteLength,0),d=t.reduce((f,c)=>{const{width:T,height:C}=c.image;return f+T*C},0);return a+Math.ceil(4*d*eU)}function aU(e,t,r){const n=e.bufferViews[r];Bs(n);const a=n.buffer,d=t[a];Bs(d);const f=(n.byteOffset||0)+d.byteOffset;return new Uint8Array(d.arrayBuffer,f,n.byteLength)}function lU(e,t,r){const n=typeof r=="number"?e.accessors?.[r]:r;if(!n)throw new Error(`No gltf accessor ${JSON.stringify(r)}`);const a=e.bufferViews?.[n.bufferView||0];if(!a)throw new Error(`No gltf buffer view for accessor ${a}`);const{arrayBuffer:d,byteOffset:f}=t[a.buffer],c=(f||0)+(n.byteOffset||0)+(a.byteOffset||0),{ArrayType:T,length:C,componentByteSize:R,numberOfComponentsInElement:L}=sy(n,a),V=R*L,X=a.byteStride||V;if(typeof a.byteStride>"u"||a.byteStride===V)return new T(d,c,C);const at=new T(C);for(let nt=0;nt<n.count;nt++){const K=new T(d,c+nt*X,L);at.set(K,nt*L)}return at}function cU(){return{asset:{version:"2.0",generator:"loaders.gl"},buffers:[],extensions:{},extensionsRequired:[],extensionsUsed:[]}}class Pi{gltf;sourceBuffers;byteLength;constructor(t){this.gltf={json:t?.json||cU(),buffers:t?.buffers||[],images:t?.images||[]},this.sourceBuffers=[],this.byteLength=0,this.gltf.buffers&&this.gltf.buffers[0]&&(this.byteLength=this.gltf.buffers[0].byteLength,this.sourceBuffers=[this.gltf.buffers[0]])}get json(){return this.gltf.json}getApplicationData(t){return this.json[t]}getExtraData(t){return(this.json.extras||{})[t]}hasExtension(t){const r=this.getUsedExtensions().find(a=>a===t),n=this.getRequiredExtensions().find(a=>a===t);return typeof r=="string"||typeof n=="string"}getExtension(t){const r=this.getUsedExtensions().find(a=>a===t),n=this.json.extensions||{};return r?n[t]:null}getRequiredExtension(t){return this.getRequiredExtensions().find(n=>n===t)?this.getExtension(t):null}getRequiredExtensions(){return this.json.extensionsRequired||[]}getUsedExtensions(){return this.json.extensionsUsed||[]}getRemovedExtensions(){return this.json.extensionsRemoved||[]}getObjectExtension(t,r){return(t.extensions||{})[r]}getScene(t){return this.getObject("scenes",t)}getNode(t){return this.getObject("nodes",t)}getSkin(t){return this.getObject("skins",t)}getMesh(t){return this.getObject("meshes",t)}getMaterial(t){return this.getObject("materials",t)}getAccessor(t){return this.getObject("accessors",t)}getTexture(t){return this.getObject("textures",t)}getSampler(t){return this.getObject("samplers",t)}getImage(t){return this.getObject("images",t)}getBufferView(t){return this.getObject("bufferViews",t)}getBuffer(t){return this.getObject("buffers",t)}getObject(t,r){if(typeof r=="object")return r;const n=this.json[t]&&this.json[t][r];if(!n)throw new Error(`glTF file error: Could not find ${t}[${r}]`);return n}getTypedArrayForBufferView(t){t=this.getBufferView(t);const r=t.buffer,n=this.gltf.buffers[r];Bs(n);const a=(t.byteOffset||0)+n.byteOffset;return new Uint8Array(n.arrayBuffer,a,t.byteLength)}getTypedArrayForAccessor(t){const r=this.getAccessor(t);return lU(this.gltf.json,this.gltf.buffers,r)}getTypedArrayForImageData(t){t=this.getAccessor(t);const r=this.getBufferView(t.bufferView),a=this.getBuffer(r.buffer).data,d=r.byteOffset||0;return new Uint8Array(a,d,r.byteLength)}addApplicationData(t,r){return this.json[t]=r,this}addExtraData(t,r){return this.json.extras=this.json.extras||{},this.json.extras[t]=r,this}addObjectExtension(t,r,n){return t.extensions=t.extensions||{},t.extensions[r]=n,this.registerUsedExtension(r),this}setObjectExtension(t,r,n){const a=t.extensions||{};a[r]=n}removeObjectExtension(t,r){const n=t?.extensions||{};if(n[r]){this.json.extensionsRemoved=this.json.extensionsRemoved||[];const a=this.json.extensionsRemoved;a.includes(r)||a.push(r)}delete n[r]}addExtension(t,r={}){return Bs(r),this.json.extensions=this.json.extensions||{},this.json.extensions[t]=r,this.registerUsedExtension(t),r}addRequiredExtension(t,r={}){return Bs(r),this.addExtension(t,r),this.registerRequiredExtension(t),r}registerUsedExtension(t){this.json.extensionsUsed=this.json.extensionsUsed||[],this.json.extensionsUsed.find(r=>r===t)||this.json.extensionsUsed.push(t)}registerRequiredExtension(t){this.registerUsedExtension(t),this.json.extensionsRequired=this.json.extensionsRequired||[],this.json.extensionsRequired.find(r=>r===t)||this.json.extensionsRequired.push(t)}removeExtension(t){if(this.json.extensions?.[t]){this.json.extensionsRemoved=this.json.extensionsRemoved||[];const r=this.json.extensionsRemoved;r.includes(t)||r.push(t)}this.json.extensions&&delete this.json.extensions[t],this.json.extensionsRequired&&this._removeStringFromArray(this.json.extensionsRequired,t),this.json.extensionsUsed&&this._removeStringFromArray(this.json.extensionsUsed,t)}setDefaultScene(t){this.json.scene=t}addScene(t){const{nodeIndices:r}=t;return this.json.scenes=this.json.scenes||[],this.json.scenes.push({nodes:r}),this.json.scenes.length-1}addNode(t){const{meshIndex:r,matrix:n}=t;this.json.nodes=this.json.nodes||[];const a={mesh:r};return n&&(a.matrix=n),this.json.nodes.push(a),this.json.nodes.length-1}addMesh(t){const{attributes:r,indices:n,material:a,mode:d=4}=t,c={primitives:[{attributes:this._addAttributes(r),mode:d}]};if(n){const T=this._addIndices(n);c.primitives[0].indices=T}return Number.isFinite(a)&&(c.primitives[0].material=a),this.json.meshes=this.json.meshes||[],this.json.meshes.push(c),this.json.meshes.length-1}addPointCloud(t){const n={primitives:[{attributes:this._addAttributes(t),mode:0}]};return this.json.meshes=this.json.meshes||[],this.json.meshes.push(n),this.json.meshes.length-1}addImage(t,r){const n=_g(t),a=r||n?.mimeType,f={bufferView:this.addBufferView(t),mimeType:a};return this.json.images=this.json.images||[],this.json.images.push(f),this.json.images.length-1}addBufferView(t,r=0,n=this.byteLength){const a=t.byteLength;Bs(Number.isFinite(a)),this.sourceBuffers=this.sourceBuffers||[],this.sourceBuffers.push(t);const d={buffer:r,byteOffset:n,byteLength:a};return this.byteLength+=Yu(a,4),this.json.bufferViews=this.json.bufferViews||[],this.json.bufferViews.push(d),this.json.bufferViews.length-1}addAccessor(t,r){const n={bufferView:t,type:aT(r.size),componentType:r.componentType,count:r.count,max:r.max,min:r.min};return this.json.accessors=this.json.accessors||[],this.json.accessors.push(n),this.json.accessors.length-1}addBinaryBuffer(t,r={size:3}){const n=this.addBufferView(t);let a={min:r.min,max:r.max};(!a.min||!a.max)&&(a=this._getAccessorMinMax(t,r.size));const d={size:r.size,componentType:ip(t),count:Math.round(t.length/r.size),min:a.min,max:a.max};return this.addAccessor(n,Object.assign(d,r))}addTexture(t){const{imageIndex:r}=t,n={source:r};return this.json.textures=this.json.textures||[],this.json.textures.push(n),this.json.textures.length-1}addMaterial(t){return this.json.materials=this.json.materials||[],this.json.materials.push(t),this.json.materials.length-1}createBinaryChunk(){const t=this.byteLength,r=new ArrayBuffer(t),n=new Uint8Array(r);let a=0;for(const d of this.sourceBuffers||[])a=jC(d,n,a);this.json?.buffers?.[0]?this.json.buffers[0].byteLength=t:this.json.buffers=[{byteLength:t}],this.gltf.binary=r,this.sourceBuffers=[r],this.gltf.buffers=[{arrayBuffer:r,byteOffset:0,byteLength:r.byteLength}]}_removeStringFromArray(t,r){let n=!0;for(;n;){const a=t.indexOf(r);a>-1?t.splice(a,1):n=!1}}_addAttributes(t={}){const r={};for(const n in t){const a=t[n],d=this._getGltfAttributeName(n),f=this.addBinaryBuffer(a.value,a);r[d]=f}return r}_addIndices(t){return this.addBinaryBuffer(t,{size:1})}_getGltfAttributeName(t){switch(t.toLowerCase()){case"position":case"positions":case"vertices":return"POSITION";case"normal":case"normals":return"NORMAL";case"color":case"colors":return"COLOR_0";case"texcoord":case"texcoords":return"TEXCOORD_0";default:return t}}_getAccessorMinMax(t,r){const n={min:null,max:null};if(t.length<r)return n;n.min=[],n.max=[];const a=t.subarray(0,r);for(const d of a)n.min.push(d),n.max.push(d);for(let d=r;d<t.length;d+=r)for(let f=0;f<r;f++)n.min[0+f]=Math.min(n.min[0+f],t[d+f]),n.max[0+f]=Math.max(n.max[0+f],t[d+f]);return n}}function cT(e){return(e%1+1)%1}const uT={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16,BOOLEAN:1,STRING:1,ENUM:1},uU={INT8:Int8Array,UINT8:Uint8Array,INT16:Int16Array,UINT16:Uint16Array,INT32:Int32Array,UINT32:Uint32Array,INT64:BigInt64Array,UINT64:BigUint64Array,FLOAT32:Float32Array,FLOAT64:Float64Array},hT={INT8:1,UINT8:1,INT16:2,UINT16:2,INT32:4,UINT32:4,INT64:8,UINT64:8,FLOAT32:4,FLOAT64:8};function ny(e,t){return hT[t]*uT[e]}function sp(e,t,r,n){if(r!=="UINT8"&&r!=="UINT16"&&r!=="UINT32"&&r!=="UINT64")return null;const a=e.getTypedArrayForBufferView(t),d=np(a,"SCALAR",r,n+1);return d instanceof BigInt64Array||d instanceof BigUint64Array?null:d}function np(e,t,r,n=1){const a=uT[t],d=uU[r],f=hT[r],c=n*a,T=c*f;let C=e.buffer,R=e.byteOffset;return R%f!==0&&(C=new Uint8Array(C).slice(R,R+T).buffer,R=0),new d(C,R,c)}function oy(e,t,r){const n=`TEXCOORD_${t.texCoord||0}`,a=r.attributes[n],d=e.getTypedArrayForAccessor(a),f=e.gltf.json,c=t.index,T=f.textures?.[c]?.source;if(typeof T<"u"){const C=f.images?.[T]?.mimeType,R=e.gltf.images?.[T];if(R&&typeof R.width<"u"){const L=[];for(let V=0;V<d.length;V+=2){const X=hU(R,C,d,V,t.channels);L.push(X)}return L}}return[]}function dT(e,t,r,n,a){if(!r?.length)return;const d=[];for(const R of r){let L=n.findIndex(V=>V===R);L===-1&&(L=n.push(R)-1),d.push(L)}const f=new Uint32Array(d),c=e.gltf.buffers.push({arrayBuffer:f.buffer,byteOffset:f.byteOffset,byteLength:f.byteLength})-1,T=e.addBufferView(f,c,0),C=e.addAccessor(T,{size:1,componentType:ip(f),count:f.length});a.attributes[t]=C}function hU(e,t,r,n,a=[0]){const d={r:{offset:0,shift:0},g:{offset:1,shift:8},b:{offset:2,shift:16},a:{offset:3,shift:24}},f=r[n],c=r[n+1];let T=1;t&&(t.indexOf("image/jpeg")!==-1||t.indexOf("image/png")!==-1)&&(T=4);const C=dU(f,c,e,T);let R=0;for(const L of a){const V=typeof L=="number"?Object.values(d)[L]:d[L],X=C+V.offset,at=hv(e);if(at.data.length<=X)throw new Error(`${at.data.length} <= ${X}`);const nt=at.data[X];R|=nt<<V.shift}return R}function dU(e,t,r,n=1){const a=r.width,d=cT(e)*(a-1),f=Math.round(d),c=r.height,T=cT(t)*(c-1),C=Math.round(T),R=r.components?r.components:n;return(C*a+f)*R}function fT(e,t,r,n,a){const d=[];for(let f=0;f<t;f++){const c=r[f],T=r[f+1]-r[f];if(T+c>n)break;const C=c/a,R=T/a;d.push(e.slice(C,C+R))}return d}function pT(e,t,r){const n=[];for(let a=0;a<t;a++){const d=a*r;n.push(e.slice(d,d+r))}return n}function _T(e,t,r,n){if(r)throw new Error("Not implemented - arrayOffsets for strings is specified");if(n){const a=[],d=new TextDecoder("utf8");let f=0;for(let c=0;c<e;c++){const T=n[c+1]-n[c];if(T+f<=t.length){const C=t.subarray(f,T+f),R=d.decode(C);a.push(R),f+=T}}return a}return[]}const Rc="EXT_mesh_features",fU=Rc;async function pU(e,t){const r=new Pi(e);gU(r,t)}function _U(e,t){const r=new Pi(e);return yU(r),r.createBinaryChunk(),r.gltf}function gU(e,t){const r=e.gltf.json;if(r.meshes)for(const n of r.meshes)for(const a of n.primitives)mU(e,a,t)}function mU(e,t,r){if(!r?.gltf?.loadBuffers)return;const a=t.extensions?.[Rc]?.featureIds;if(a)for(const d of a){let f;if(typeof d.attribute<"u"){const c=`_FEATURE_ID_${d.attribute}`,T=t.attributes[c];f=e.getTypedArrayForAccessor(T)}else typeof d.texture<"u"&&r?.gltf?.loadImages?f=oy(e,d.texture,t):f=[];d.data=f}}function yU(e,t){const r=e.gltf.json.meshes;if(r)for(const n of r)for(const a of n.primitives)vU(e,a)}function bU(e,t,r,n){t.extensions||(t.extensions={});let a=t.extensions[Rc];a||(a={featureIds:[]},t.extensions[Rc]=a);const{featureIds:d}=a,f={featureCount:r.length,propertyTable:n,data:r};d.push(f),e.addObjectExtension(t,Rc,a)}function vU(e,t){const r=t.extensions?.[Rc];if(!r)return;const n=r.featureIds;n.forEach((a,d)=>{if(a.data){const{accessorKey:f,index:c}=xU(t.attributes),T=new Uint32Array(a.data);n[d]={featureCount:T.length,propertyTable:a.propertyTable,attribute:c},e.gltf.buffers.push({arrayBuffer:T.buffer,byteOffset:T.byteOffset,byteLength:T.byteLength});const C=e.addBufferView(T),R=e.addAccessor(C,{size:1,componentType:ip(T),count:T.length});t.attributes[f]=R}})}function xU(e){const t="_FEATURE_ID_",r=Object.keys(e).filter(d=>d.indexOf(t)===0);let n=-1;for(const d of r){const f=Number(d.substring(t.length));f>n&&(n=f)}return n++,{accessorKey:`${t}${n}`,index:n}}const wU=Object.freeze(Object.defineProperty({__proto__:null,createExtMeshFeatures:bU,decode:pU,encode:_U,name:fU},Symbol.toStringTag,{value:"Module"})),Pc="EXT_structural_metadata",TU=Pc;async function AU(e,t){const r=new Pi(e);SU(r,t)}function EU(e,t){const r=new Pi(e);return jU(r),r.createBinaryChunk(),r.gltf}function SU(e,t){if(!t.gltf?.loadBuffers)return;const r=e.getExtension(Pc);r&&(t.gltf?.loadImages&&CU(e,r),IU(e,r))}function CU(e,t){const r=t.propertyTextures,n=e.gltf.json;if(r&&n.meshes)for(const a of n.meshes)for(const d of a.primitives)RU(e,r,d,t)}function IU(e,t){const r=t.schema;if(!r)return;const n=r.classes,a=t.propertyTables;if(n&&a)for(const d in n){const f=MU(a,d);f&&BU(e,r,f)}}function MU(e,t){for(const r of e)if(r.class===t)return r;return null}function RU(e,t,r,n){if(!t)return;const d=r.extensions?.[Pc]?.propertyTextures;if(d)for(const f of d){const c=t[f];PU(e,c,r,n)}}function PU(e,t,r,n){if(!t.properties)return;n.dataAttributeNames||(n.dataAttributeNames=[]);const a=t.class;for(const d in t.properties){const f=`${a}_${d}`,c=t.properties?.[d];if(!c)continue;c.data||(c.data=[]);const T=c.data,C=oy(e,c,r);C!==null&&(dT(e,f,C,T,r),c.data=T,n.dataAttributeNames.push(f))}}function BU(e,t,r){const n=t.classes?.[r.class];if(!n)throw new Error(`Incorrect data in the EXT_structural_metadata extension: no schema class with name ${r.class}`);const a=r.count;for(const d in n.properties){const f=n.properties[d],c=r.properties?.[d];if(c){const T=DU(e,t,f,a,c);c.data=T}}}function DU(e,t,r,n,a){let d=[];const f=a.values,c=e.getTypedArrayForBufferView(f),T=FU(e,r,a,n),C=OU(e,a,n);switch(r.type){case"SCALAR":case"VEC2":case"VEC3":case"VEC4":case"MAT2":case"MAT3":case"MAT4":{d=kU(r,n,c,T);break}case"BOOLEAN":throw new Error(`Not implemented - classProperty.type=${r.type}`);case"STRING":{d=_T(n,c,T,C);break}case"ENUM":{d=NU(t,r,n,c,T);break}default:throw new Error(`Unknown classProperty type ${r.type}`)}return d}function FU(e,t,r,n){return t.array&&typeof t.count>"u"&&typeof r.arrayOffsets<"u"?sp(e,r.arrayOffsets,r.arrayOffsetType||"UINT32",n):null}function OU(e,t,r){return typeof t.stringOffsets<"u"?sp(e,t.stringOffsets,t.stringOffsetType||"UINT32",r):null}function kU(e,t,r,n){const a=e.array,d=e.count,f=ny(e.type,e.componentType),c=r.byteLength/f;let T;return e.componentType?T=np(r,e.type,e.componentType,c):T=r,a?n?fT(T,t,n,r.length,f):d?pT(T,t,d):[]:T}function NU(e,t,r,n,a){const d=t.enumType;if(!d)throw new Error("Incorrect data in the EXT_structural_metadata extension: classProperty.enumType is not set for type ENUM");const f=e.enums?.[d];if(!f)throw new Error(`Incorrect data in the EXT_structural_metadata extension: schema.enums does't contain ${d}`);const c=f.valueType||"UINT16",T=ny(t.type,c),C=n.byteLength/T;let R=np(n,t.type,c,C);if(R||(R=n),t.array){if(a)return LU({valuesData:R,numberOfElements:r,arrayOffsets:a,valuesDataBytesLength:n.length,elementSize:T,enumEntry:f});const L=t.count;return L?UU(R,r,L,f):[]}return ay(R,0,r,f)}function LU(e){const{valuesData:t,numberOfElements:r,arrayOffsets:n,valuesDataBytesLength:a,elementSize:d,enumEntry:f}=e,c=[];for(let T=0;T<r;T++){const C=n[T],R=n[T+1]-n[T];if(R+C>a)break;const L=C/d,V=R/d,X=ay(t,L,V,f);c.push(X)}return c}function UU(e,t,r,n){const a=[];for(let d=0;d<t;d++){const f=r*d,c=ay(e,f,r,n);a.push(c)}return a}function ay(e,t,r,n){const a=[];for(let d=0;d<r;d++)if(e instanceof BigInt64Array||e instanceof BigUint64Array)a.push("");else{const f=e[t+d],c=zU(n,f);c?a.push(c.name):a.push("")}return a}function zU(e,t){for(const r of e.values)if(r.value===t)return r;return null}const VU="schemaClassId";function jU(e,t){const r=e.getExtension(Pc);if(r&&r.propertyTables)for(const n of r.propertyTables){const a=n.class,d=r.schema?.classes?.[a];n.properties&&d&&HU(n,d,e)}}function HU(e,t,r){for(const n in e.properties){const a=e.properties[n].data;if(a){const d=t.properties[n];if(d){const f=XU(a,d,r);e.properties[n]=f}}}}function GU(e,t,r=VU){let n=e.getExtension(Pc);n||(n=e.addExtension(Pc)),n.schema=$U(t,r,n.schema);const a=WU(t,r,n.schema);return n.propertyTables||(n.propertyTables=[]),n.propertyTables.push(a)-1}function $U(e,t,r){const n=r??{id:"schema_id"},a={properties:{}};for(const d of e){const f={type:d.elementType,componentType:d.componentType};a.properties[d.name]=f}return n.classes={},n.classes[t]=a,n}function WU(e,t,r){const n={class:t,count:0};let a=0;const d=r.classes?.[t];for(const f of e){if(a===0&&(a=f.values.length),a!==f.values.length&&f.values.length)throw new Error("Illegal values in attributes");d?.properties[f.name]&&(n.properties||(n.properties={}),n.properties[f.name]={values:0,data:f.values})}return n.count=a,n}function XU(e,t,r){const n={values:0};if(t.type==="STRING"){const{stringData:a,stringOffsets:d}=YU(e);n.stringOffsets=ly(d,r),n.values=ly(a,r)}else if(t.type==="SCALAR"&&t.componentType){const a=ZU(e,t.componentType);n.values=ly(a,r)}return n}const qU={INT8:Int8Array,UINT8:Uint8Array,INT16:Int16Array,UINT16:Uint16Array,INT32:Int32Array,UINT32:Uint32Array,INT64:Int32Array,UINT64:Uint32Array,FLOAT32:Float32Array,FLOAT64:Float64Array};function ZU(e,t){const r=[];for(const a of e)r.push(Number(a));const n=qU[t];if(!n)throw new Error("Illegal component type");return new n(r)}function YU(e){const t=new TextEncoder,r=[];let n=0;for(const T of e){const C=t.encode(T);n+=C.length,r.push(C)}const a=new Uint8Array(n),d=[];let f=0;for(const T of r)a.set(T,f),d.push(f),f+=T.length;d.push(f);const c=new Uint32Array(d);return{stringData:a,stringOffsets:c}}function ly(e,t){return t.gltf.buffers.push({arrayBuffer:e.buffer,byteOffset:e.byteOffset,byteLength:e.byteLength}),t.addBufferView(e)}const KU=Object.freeze(Object.defineProperty({__proto__:null,createExtStructuralMetadata:GU,decode:AU,encode:EU,name:TU},Symbol.toStringTag,{value:"Module"})),gT="EXT_feature_metadata",JU=gT;async function QU(e,t){const r=new Pi(e);tz(r,t)}function tz(e,t){if(!t.gltf?.loadBuffers)return;const r=e.getExtension(gT);r&&(t.gltf?.loadImages&&ez(e,r),rz(e,r))}function ez(e,t){const r=t.schema;if(!r)return;const n=r.classes,{featureTextures:a}=t;if(n&&a)for(const d in n){const f=n[d],c=sz(a,d);c&&oz(e,c,f)}}function rz(e,t){const r=t.schema;if(!r)return;const n=r.classes,a=t.featureTables;if(n&&a)for(const d in n){const f=iz(a,d);f&&nz(e,r,f)}}function iz(e,t){for(const r in e){const n=e[r];if(n.class===t)return n}return null}function sz(e,t){for(const r in e){const n=e[r];if(n.class===t)return n}return null}function nz(e,t,r){if(!r.class)return;const n=t.classes?.[r.class];if(!n)throw new Error(`Incorrect data in the EXT_structural_metadata extension: no schema class with name ${r.class}`);const a=r.count;for(const d in n.properties){const f=n.properties[d],c=r.properties?.[d];if(c){const T=az(e,t,f,a,c);c.data=T}}}function oz(e,t,r){const n=t.class;for(const a in r.properties){const d=t?.properties?.[a];if(d){const f=dz(e,d,n);d.data=f}}}function az(e,t,r,n,a){let d=[];const f=a.bufferView,c=e.getTypedArrayForBufferView(f),T=lz(e,r,a,n),C=cz(e,r,a,n);return r.type==="STRING"||r.componentType==="STRING"?d=_T(n,c,T,C):uz(r)&&(d=hz(r,n,c,T)),d}function lz(e,t,r,n){return t.type==="ARRAY"&&typeof t.componentCount>"u"&&typeof r.arrayOffsetBufferView<"u"?sp(e,r.arrayOffsetBufferView,r.offsetType||"UINT32",n):null}function cz(e,t,r,n){return typeof r.stringOffsetBufferView<"u"?sp(e,r.stringOffsetBufferView,r.offsetType||"UINT32",n):null}function uz(e){const t=["UINT8","INT16","UINT16","INT32","UINT32","INT64","UINT64","FLOAT32","FLOAT64"];return t.includes(e.type)||typeof e.componentType<"u"&&t.includes(e.componentType)}function hz(e,t,r,n){const a=e.type==="ARRAY",d=e.componentCount,f="SCALAR",c=e.componentType||e.type,T=ny(f,c),C=r.byteLength/T,R=np(r,f,c,C);return a?n?fT(R,t,n,r.length,T):d?pT(R,t,d):[]:R}function dz(e,t,r){const n=e.gltf.json;if(!n.meshes)return[];const a=[];for(const d of n.meshes)for(const f of d.primitives)fz(e,r,t,a,f);return a}function fz(e,t,r,n,a){const d={channels:r.channels,...r.texture},f=oy(e,d,a);f&&dT(e,t,f,n,a)}const pz=Object.freeze(Object.defineProperty({__proto__:null,decode:QU,name:JU},Symbol.toStringTag,{value:"Module"})),_z="4.3.1",Bc=!0,mT=1735152710,cy=12,op=8,gz=1313821514,mz=5130562,yz=0,bz=0,vz=1;function xz(e,t=0){return`${String.fromCharCode(e.getUint8(t+0))}${String.fromCharCode(e.getUint8(t+1))}${String.fromCharCode(e.getUint8(t+2))}${String.fromCharCode(e.getUint8(t+3))}`}function wz(e,t=0,r={}){const n=new DataView(e),{magic:a=mT}=r,d=n.getUint32(t,!1);return d===a||d===mT}function Tz(e,t,r=0,n={}){const a=new DataView(t),d=xz(a,r+0),f=a.getUint32(r+4,Bc),c=a.getUint32(r+8,Bc);switch(Object.assign(e,{header:{byteOffset:r,byteLength:c,hasBinChunk:!1},type:d,version:f,json:{},binChunks:[]}),r+=cy,e.version){case 1:return Az(e,a,r);case 2:return Ez(e,a,r,n={});default:throw new Error(`Invalid GLB version ${e.version}. Only supports version 1 and 2.`)}}function Az(e,t,r){Ar(e.header.byteLength>cy+op);const n=t.getUint32(r+0,Bc),a=t.getUint32(r+4,Bc);return r+=op,Ar(a===yz),uy(e,t,r,n),r+=n,r+=hy(e,t,r,e.header.byteLength),r}function Ez(e,t,r,n){return Ar(e.header.byteLength>cy+op),Sz(e,t,r,n),r+e.header.byteLength}function Sz(e,t,r,n){for(;r+8<=e.header.byteLength;){const a=t.getUint32(r+0,Bc),d=t.getUint32(r+4,Bc);switch(r+=op,d){case gz:uy(e,t,r,a);break;case mz:hy(e,t,r,a);break;case bz:n.strict||uy(e,t,r,a);break;case vz:n.strict||hy(e,t,r,a);break}r+=Yu(a,4)}return r}function uy(e,t,r,n){const a=new Uint8Array(t.buffer,r,n),f=new TextDecoder("utf8").decode(a);return e.json=JSON.parse(f),Yu(n,4)}function hy(e,t,r,n){return e.header.hasBinChunk=!0,e.binChunks.push({byteOffset:r,byteLength:n,arrayBuffer:t.buffer}),Yu(n,4)}function yT(e,t){if(e.startsWith("data:")||e.startsWith("http:")||e.startsWith("https:"))return e;const n=t.baseUri||t.uri;if(!n)throw new Error(`'baseUri' must be provided to resolve relative url ${e}`);return n.substr(0,n.lastIndexOf("/")+1)+e}const Cz="B9h9z9tFBBBF8fL9gBB9gLaaaaaFa9gEaaaB9gFaFa9gEaaaFaEMcBFFFGGGEIIILF9wFFFLEFBFKNFaFCx/IFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBF8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBGy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBEn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBIi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBKI9z9iqlBOc+x8ycGBM/qQFTa8jUUUUBCU/EBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAGTkUUUBRNCUoBAG9uC/wgBZHKCUGAKCUG9JyRVAECFJRICBRcGXEXAcAF9PQFAVAFAclAcAVJAF9JyRMGXGXAG9FQBAMCbJHKC9wZRSAKCIrCEJCGrRQANCUGJRfCBRbAIRTEXGXAOATlAQ9PQBCBRISEMATAQJRIGXAS9FQBCBRtCBREEXGXAOAIlCi9PQBCBRISLMANCU/CBJAEJRKGXGXGXGXGXATAECKrJ2BBAtCKZrCEZfIBFGEBMAKhB83EBAKCNJhB83EBSEMAKAI2BIAI2BBHmCKrHYAYCE6HYy86BBAKCFJAICIJAYJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCGJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCEJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCIJAYAmJHY2BBAI2BFHmCKrHPAPCE6HPy86BBAKCLJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCKJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCOJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCNJAYAmJHY2BBAI2BGHmCKrHPAPCE6HPy86BBAKCVJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCcJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCMJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCSJAYAmJHm2BBAI2BEHICKrHYAYCE6HYy86BBAKCQJAmAYJHm2BBAICIrCEZHYAYCE6HYy86BBAKCfJAmAYJHm2BBAICGrCEZHYAYCE6HYy86BBAKCbJAmAYJHK2BBAICEZHIAICE6HIy86BBAKAIJRISGMAKAI2BNAI2BBHmCIrHYAYCb6HYy86BBAKCFJAICNJAYJHY2BBAmCbZHmAmCb6Hmy86BBAKCGJAYAmJHm2BBAI2BFHYCIrHPAPCb6HPy86BBAKCEJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCIJAmAYJHm2BBAI2BGHYCIrHPAPCb6HPy86BBAKCLJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCKJAmAYJHm2BBAI2BEHYCIrHPAPCb6HPy86BBAKCOJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCNJAmAYJHm2BBAI2BIHYCIrHPAPCb6HPy86BBAKCVJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCcJAmAYJHm2BBAI2BLHYCIrHPAPCb6HPy86BBAKCMJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCSJAmAYJHm2BBAI2BKHYCIrHPAPCb6HPy86BBAKCQJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCfJAmAYJHm2BBAI2BOHICIrHYAYCb6HYy86BBAKCbJAmAYJHK2BBAICbZHIAICb6HIy86BBAKAIJRISFMAKAI8pBB83BBAKCNJAICNJ8pBB83BBAICTJRIMAtCGJRtAECTJHEAS9JQBMMGXAIQBCBRISEMGXAM9FQBANAbJ2BBRtCBRKAfREEXAEANCU/CBJAKJ2BBHTCFrCBATCFZl9zAtJHt86BBAEAGJREAKCFJHKAM9HQBMMAfCFJRfAIRTAbCFJHbAG9HQBMMABAcAG9sJANCUGJAMAG9sTkUUUBpANANCUGJAMCaJAG9sJAGTkUUUBpMAMCBAIyAcJRcAIQBMC9+RKSFMCBC99AOAIlAGCAAGCA9Ly6yRKMALCU/EBJ8kUUUUBAKM+OmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUFT+JUUUBpALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM+lLKFaF99GaG99FaG99GXGXAGCI9HQBAF9FQFEXGXGX9DBBB8/9DBBB+/ABCGJHG1BB+yAB1BBHE+yHI+L+TABCFJHL1BBHK+yHO+L+THN9DBBBB9gHVyAN9DBB/+hANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE86BBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG86BBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG86BBABCIJRBAFCaJHFQBSGMMAF9FQBEXGXGX9DBBB8/9DBBB+/ABCIJHG8uFB+yAB8uFBHE+yHI+L+TABCGJHL8uFBHK+yHO+L+THN9DBBBB9gHVyAN9DB/+g6ANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE87FBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG87FBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG87FBABCNJRBAFCaJHFQBMMM/SEIEaE99EaF99GXAF9FQBCBREABRIEXGXGX9D/zI818/AICKJ8uFBHLCEq+y+VHKAI8uFB+y+UHO9DB/+g6+U9DBBB8/9DBBB+/AO9DBBBB9gy+SHN+L9DBBB9P9d9FQBAN+oRVSFMCUUUU94RVMAICIJ8uFBRcAICGJ8uFBRMABALCFJCEZAEqCFWJAV87FBGXGXAKAM+y+UHN9DB/+g6+U9DBBB8/9DBBB+/AN9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRMSFMCUUUU94RMMABALCGJCEZAEqCFWJAM87FBGXGXAKAc+y+UHK9DB/+g6+U9DBBB8/9DBBB+/AK9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRcSFMCUUUU94RcMABALCaJCEZAEqCFWJAc87FBGXGX9DBBU8/AOAO+U+TANAN+U+TAKAK+U+THO9DBBBBAO9DBBBB9gy+R9DB/+g6+U9DBBB8/+SHO+L9DBBB9P9d9FQBAO+oRcSFMCUUUU94RcMABALCEZAEqCFWJAc87FBAICNJRIAECIJREAFCaJHFQBMMM9JBGXAGCGrAF9sHF9FQBEXABAB8oGBHGCNWCN91+yAGCi91CnWCUUU/8EJ+++U84GBABCIJRBAFCaJHFQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEM/lFFFaGXGXAFABqCEZ9FQBABRESFMGXGXAGCT9PQBABRESFMABREEXAEAF8oGBjGBAECIJAFCIJ8oGBjGBAECNJAFCNJ8oGBjGBAECSJAFCSJ8oGBjGBAECTJREAFCTJRFAGC9wJHGCb9LQBMMAGCI9JQBEXAEAF8oGBjGBAFCIJRFAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF2BB86BBAECFJREAFCFJRFAGCaJHGQBMMABMoFFGaGXGXABCEZ9FQBABRESFMAFCgFZC+BwsN9sRIGXGXAGCT9PQBABRESFMABREEXAEAIjGBAECSJAIjGBAECNJAIjGBAECIJAIjGBAECTJREAGC9wJHGCb9LQBMMAGCI9JQBEXAEAIjGBAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF86BBAECFJREAGCaJHGQBMMABMMMFBCUNMIT9kBB",Iz="B9h9z9tFBBBF8dL9gBB9gLaaaaaFa9gEaaaB9gGaaB9gFaFaEQSBBFBFFGEGEGIILF9wFFFLEFBFKNFaFCx/aFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBG8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBIy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBKi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBNn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBcI9z9iqlBMc/j9JSIBTEM9+FLa8jUUUUBCTlRBCBRFEXCBRGCBREEXABCNJAGJAECUaAFAGrCFZHIy86BBAEAIJREAGCFJHGCN9HQBMAFCx+YUUBJAE86BBAFCEWCxkUUBJAB8pEN83EBAFCFJHFCUG9HQBMMkRIbaG97FaK978jUUUUBCU/KBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAG/8cBBCUoBAG9uC/wgBZHKCUGAKCUG9JyRNAECFJRKCBRVGXEXAVAF9PQFANAFAVlAVANJAF9JyRcGXGXAG9FQBAcCbJHIC9wZHMCE9sRSAMCFWRQAICIrCEJCGrRfCBRbEXAKRTCBRtGXEXGXAOATlAf9PQBCBRKSLMALCU/CBJAtAM9sJRmATAfJRKCBREGXAMCoB9JQBAOAKlC/gB9JQBCBRIEXAmAIJREGXGXGXGXGXATAICKrJ2BBHYCEZfIBFGEBMAECBDtDMIBSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIBAKCTJRKMGXGXGXGXGXAYCGrCEZfIBFGEBMAECBDtDMITSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMITAKCTJRKMGXGXGXGXGXAYCIrCEZfIBFGEBMAECBDtDMIASEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIAAKCTJRKMGXGXGXGXGXAYCKrfIBFGEBMAECBDtDMI8wSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCIJAnDeBJAYCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCNJAnDeBJAYCx+YUUBJ2BBJRKSFMAEAKDBBBDMI8wAKCTJRKMAICoBJREAICUFJAM9LQFAERIAOAKlC/fB9LQBMMGXAEAM9PQBAECErRIEXGXAOAKlCi9PQBCBRKSOMAmAEJRYGXGXGXGXGXATAECKrJ2BBAICKZrCEZfIBFGEBMAYCBDtDMIBSEMAYAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAYAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAYAKDBBBDMIBAKCTJRKMAICGJRIAECTJHEAM9JQBMMGXAK9FQBAKRTAtCFJHtCI6QGSFMMCBRKSEMGXAM9FQBALCUGJAbJREALAbJDBGBRnCBRYEXAEALCU/CBJAYJHIDBIBHdCFD9tAdCFDbHPD9OD9hD9RHdAIAMJDBIBHiCFD9tAiAPD9OD9hD9RHiDQBTFtGmEYIPLdKeOnH8ZAIAQJDBIBHpCFD9tApAPD9OD9hD9RHpAIASJDBIBHyCFD9tAyAPD9OD9hD9RHyDQBTFtGmEYIPLdKeOnH8cDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGEAnD9uHnDyBjGBAEAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnA8ZA8cDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNiV8ZcpMyS8cQ8df8eb8fHdApAyDQNiV8ZcpMyS8cQ8df8eb8fHiDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJREAYCTJHYAM9JQBMMAbCIJHbAG9JQBMMABAVAG9sJALCUGJAcAG9s/8cBBALALCUGJAcCaJAG9sJAG/8cBBMAcCBAKyAVJRVAKQBMC9+RKSFMCBC99AOAKlAGCAAGCA9Ly6yRKMALCU/KBJ8kUUUUBAKMNBT+BUUUBM+KmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUF/8MBALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM/xLGEaK978jUUUUBCAlHE8kUUUUBGXGXAGCI9HQBGXAFC98ZHI9FQBABRGCBRLEXAGAGDBBBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMBBAGCTJRGALCIJHLAI9JQBMMAIAF9PQFAEAFCEZHLCGWHGqCBCTAGl/8MBAEABAICGWJHIAG/8cBBGXAL9FQBAEAEDBIBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMIBMAIAEAG/8cBBSFMABAFC98ZHGT+HUUUBAGAF9PQBAEAFCEZHICEWHLJCBCAALl/8MBAEABAGCEWJHGAL/8cBBAEAIT+HUUUBAGAEAL/8cBBMAECAJ8kUUUUBM+yEGGaO97GXAF9FQBCBRGEXABCTJHEAEDBBBHICBDtHLCUU98D8cFCUU98D8cEHKD9OABDBBBHOAIDQILKOSQfbPden8c8d8e8fCggFDtD9OD/6FAOAIDQBFGENVcMTtmYi8ZpyHICTD+sFD/6FHND/gFAICTD+rFCTD+sFD/6FHVD/gFD/kFD/lFHI9DB/+g6DYAVAIALD+2FHLAVCUUUU94DtHcD9OD9RD/kFHVAVD/mFAIAID/mFANALANAcD9OD9RD/kFHIAID/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHLD/kFCTD+rFAVAND/mFALD/kFCggEDtD9OD9QHVAIAND/mFALD/kFCaDbCBDnGCBDnECBDnKCBDnOCBDncCBDnMCBDnfCBDnbD9OHIDQNVi8ZcMpySQ8c8dfb8e8fD9QDMBBABAOAKD9OAVAIDQBFTtGEmYILPdKOenD9QDMBBABCAJRBAGCIJHGAF9JQBMMM94FEa8jUUUUBCAlHE8kUUUUBABAFC98ZHIT+JUUUBGXAIAF9PQBAEAFCEZHLCEWHFJCBCAAFl/8MBAEABAICEWJHBAF/8cBBAEALT+JUUUBABAEAF/8cBBMAECAJ8kUUUUBM/hEIGaF97FaL978jUUUUBCTlRGGXAF9FQBCBREEXAGABDBBBHIABCTJHLDBBBHKDQILKOSQfbPden8c8d8e8fHOCTD+sFHNCID+rFDMIBAB9DBBU8/DY9D/zI818/DYANCEDtD9QD/6FD/nFHNAIAKDQBFGENVcMTtmYi8ZpyHICTD+rFCTD+sFD/6FD/mFHKAKD/mFANAICTD+sFD/6FD/mFHVAVD/mFANAOCTD+rFCTD+sFD/6FD/mFHOAOD/mFD/kFD/kFD/lFCBDtD+4FD/jF9DB/+g6DYHND/mF9DBBX9LDYHID/kFCggEDtHcD9OAVAND/mFAID/kFCTD+rFD9QHVAOAND/mFAID/kFCTD+rFAKAND/mFAID/kFAcD9OD9QHNDQBFTtGEmYILPdKOenHID8dBAGDBIBDyB+t+J83EBABCNJAID8dFAGDBIBDyF+t+J83EBALAVANDQNVi8ZcMpySQ8c8dfb8e8fHND8dBAGDBIBDyG+t+J83EBABCiJAND8dFAGDBIBDyE+t+J83EBABCAJRBAECIJHEAF9JQBMMM/3FGEaF978jUUUUBCoBlREGXAGCGrAF9sHIC98ZHL9FQBCBRGABRFEXAFAFDBBBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMBBAFCTJRFAGCIJHGAL9JQBMMGXALAI9PQBAEAICEZHGCGWHFqCBCoBAFl/8MBAEABALCGWJHLAF/8cBBGXAG9FQBAEAEDBIBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMIBMALAEAF/8cBBMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEMMMFBCUNMIT9tBB",Mz=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),Rz=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]),Pz={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},Bz={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};async function Dz(e,t,r,n,a,d="NONE"){const f=await Fz();Nz(f,f.exports[Bz[a]],e,t,r,n,f.exports[Pz[d||"NONE"]])}let dy;async function Fz(){return dy||(dy=Oz()),dy}async function Oz(){let e=Cz;WebAssembly.validate(Mz)&&(e=Iz,console.log("Warning: meshopt_decoder is using experimental SIMD support"));const t=await WebAssembly.instantiate(kz(e),{});return await t.instance.exports.__wasm_call_ctors(),t.instance}function kz(e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;++n){const a=e.charCodeAt(n);t[n]=a>96?a-71:a>64?a-65:a>47?a+4:a>46?63:62}let r=0;for(let n=0;n<e.length;++n)t[r++]=t[n]<60?Rz[t[n]]:(t[n]-60)*64+t[++n];return t.buffer.slice(0,r)}function Nz(e,t,r,n,a,d,f){const c=e.exports.sbrk,T=n+3&-4,C=c(T*a),R=c(d.length),L=new Uint8Array(e.exports.memory.buffer);L.set(d,R);const V=t(C,n,a,R,d.length);if(V===0&&f&&f(C,T,a),r.set(L.subarray(C,C+n*a)),c(C-c(0)),V!==0)throw new Error(`Malformed buffer data: ${V}`)}const ap="EXT_meshopt_compression",Lz=ap;async function Uz(e,t){const r=new Pi(e);if(!t?.gltf?.decompressMeshes||!t.gltf?.loadBuffers)return;const n=[];for(const a of e.json.bufferViews||[])n.push(zz(r,a));await Promise.all(n),r.removeExtension(ap)}async function zz(e,t){const r=e.getObjectExtension(t,ap);if(r){const{byteOffset:n=0,byteLength:a=0,byteStride:d,count:f,mode:c,filter:T="NONE",buffer:C}=r,R=e.gltf.buffers[C],L=new Uint8Array(R.arrayBuffer,R.byteOffset+n,a),V=new Uint8Array(e.gltf.buffers[t.buffer].arrayBuffer,t.byteOffset,t.byteLength);await Dz(V,f,d,L,c,T),e.removeObjectExtension(t,ap)}}const Vz=Object.freeze(Object.defineProperty({__proto__:null,decode:Uz,name:Lz},Symbol.toStringTag,{value:"Module"})),Dc="EXT_texture_webp",jz=Dc;function Hz(e,t){const r=new Pi(e);if(!DI("image/webp")){if(r.getRequiredExtensions().includes(Dc))throw new Error(`gltf: Required extension ${Dc} not supported by browser`);return}const{json:n}=r;for(const a of n.textures||[]){const d=r.getObjectExtension(a,Dc);d&&(a.source=d.source),r.removeObjectExtension(a,Dc)}r.removeExtension(Dc)}const Gz=Object.freeze(Object.defineProperty({__proto__:null,name:jz,preprocess:Hz},Symbol.toStringTag,{value:"Module"})),lp="KHR_texture_basisu",$z=lp;function Wz(e,t){const r=new Pi(e),{json:n}=r;for(const a of n.textures||[]){const d=r.getObjectExtension(a,lp);d&&(a.source=d.source,r.removeObjectExtension(a,lp))}r.removeExtension(lp)}const Xz=Object.freeze(Object.defineProperty({__proto__:null,name:$z,preprocess:Wz},Symbol.toStringTag,{value:"Module"})),qz={dataType:null,batchType:null,name:"Draco",id:"draco",module:"draco",version:"4.3.1",worker:!0,extensions:["drc"],mimeTypes:["application/octet-stream"],binary:!0,tests:["DRACO"],options:{draco:{decoderType:typeof WebAssembly=="object"?"wasm":"js",libraryPath:"libs/",extraAttributes:{},attributeNameEntry:void 0}}};function Zz(e,t,r){const n=vT(t.metadata),a=[],d=Yz(t.attributes);for(const f in e){const c=e[f],T=bT(f,c,d[f]);a.push(T)}if(r){const f=bT("indices",r);a.push(f)}return{fields:a,metadata:n}}function Yz(e){const t={};for(const r in e){const n=e[r];t[n.name||"undefined"]=n}return t}function bT(e,t,r){const n=r?vT(r.metadata):void 0;return iI(e,t,n)}function vT(e){Object.entries(e);const t={};for(const r in e)t[`${r}.string`]=JSON.stringify(e[r]);return t}const xT={POSITION:"POSITION",NORMAL:"NORMAL",COLOR:"COLOR_0",TEX_COORD:"TEXCOORD_0"},Kz={1:Int8Array,2:Uint8Array,3:Int16Array,4:Uint16Array,5:Int32Array,6:Uint32Array,9:Float32Array},Jz=4;class Qz{draco;decoder;metadataQuerier;constructor(t){this.draco=t,this.decoder=new this.draco.Decoder,this.metadataQuerier=new this.draco.MetadataQuerier}destroy(){this.draco.destroy(this.decoder),this.draco.destroy(this.metadataQuerier)}parseSync(t,r={}){const n=new this.draco.DecoderBuffer;n.Init(new Int8Array(t),t.byteLength),this._disableAttributeTransforms(r);const a=this.decoder.GetEncodedGeometryType(n),d=a===this.draco.TRIANGULAR_MESH?new this.draco.Mesh:new this.draco.PointCloud;try{let f;switch(a){case this.draco.TRIANGULAR_MESH:f=this.decoder.DecodeBufferToMesh(n,d);break;case this.draco.POINT_CLOUD:f=this.decoder.DecodeBufferToPointCloud(n,d);break;default:throw new Error("DRACO: Unknown geometry type.")}if(!f.ok()||!d.ptr){const V=`DRACO decompression failed: ${f.error_msg()}`;throw new Error(V)}const c=this._getDracoLoaderData(d,a,r),T=this._getMeshData(d,c,r),C=uv(T.attributes),R=Zz(T.attributes,c,T.indices);return{loader:"draco",loaderData:c,header:{vertexCount:d.num_points(),boundingBox:C},...T,schema:R}}finally{this.draco.destroy(n),d&&this.draco.destroy(d)}}_getDracoLoaderData(t,r,n){const a=this._getTopLevelMetadata(t),d=this._getDracoAttributes(t,n);return{geometry_type:r,num_attributes:t.num_attributes(),num_points:t.num_points(),num_faces:t instanceof this.draco.Mesh?t.num_faces():0,metadata:a,attributes:d}}_getDracoAttributes(t,r){const n={};for(let a=0;a<t.num_attributes();a++){const d=this.decoder.GetAttribute(t,a),f=this._getAttributeMetadata(t,a);n[d.unique_id()]={unique_id:d.unique_id(),attribute_type:d.attribute_type(),data_type:d.data_type(),num_components:d.num_components(),byte_offset:d.byte_offset(),byte_stride:d.byte_stride(),normalized:d.normalized(),attribute_index:a,metadata:f};const c=this._getQuantizationTransform(d,r);c&&(n[d.unique_id()].quantization_transform=c);const T=this._getOctahedronTransform(d,r);T&&(n[d.unique_id()].octahedron_transform=T)}return n}_getMeshData(t,r,n){const a=this._getMeshAttributes(r,t,n);if(!a.POSITION)throw new Error("DRACO: No position attribute found.");if(t instanceof this.draco.Mesh)switch(n.topology){case"triangle-strip":return{topology:"triangle-strip",mode:4,attributes:a,indices:{value:this._getTriangleStripIndices(t),size:1}};case"triangle-list":default:return{topology:"triangle-list",mode:5,attributes:a,indices:{value:this._getTriangleListIndices(t),size:1}}}return{topology:"point-list",mode:0,attributes:a}}_getMeshAttributes(t,r,n){const a={};for(const d of Object.values(t.attributes)){const f=this._deduceAttributeName(d,n);d.name=f;const c=this._getAttributeValues(r,d);if(c){const{value:T,size:C}=c;a[f]={value:T,size:C,byteOffset:d.byte_offset,byteStride:d.byte_stride,normalized:d.normalized}}}return a}_getTriangleListIndices(t){const n=t.num_faces()*3,a=n*Jz,d=this.draco._malloc(a);try{return this.decoder.GetTrianglesUInt32Array(t,a,d),new Uint32Array(this.draco.HEAPF32.buffer,d,n).slice()}finally{this.draco._free(d)}}_getTriangleStripIndices(t){const r=new this.draco.DracoInt32Array;try{return this.decoder.GetTriangleStripsFromMesh(t,r),r4(r)}finally{this.draco.destroy(r)}}_getAttributeValues(t,r){const n=Kz[r.data_type];if(!n)return console.warn(`DRACO: Unsupported attribute type ${r.data_type}`),null;const a=r.num_components,f=t.num_points()*a,c=f*n.BYTES_PER_ELEMENT,T=t4(this.draco,n);let C;const R=this.draco._malloc(c);try{const L=this.decoder.GetAttribute(t,r.attribute_index);this.decoder.GetAttributeDataArrayForAllPoints(t,L,T,c,R),C=new n(this.draco.HEAPF32.buffer,R,f).slice()}finally{this.draco._free(R)}return{value:C,size:a}}_deduceAttributeName(t,r){const n=t.unique_id;for(const[f,c]of Object.entries(r.extraAttributes||{}))if(c===n)return f;const a=t.attribute_type;for(const f in xT)if(this.draco[f]===a)return xT[f];const d=r.attributeNameEntry||"name";return t.metadata[d]?t.metadata[d].string:`CUSTOM_ATTRIBUTE_${n}`}_getTopLevelMetadata(t){const r=this.decoder.GetMetadata(t);return this._getDracoMetadata(r)}_getAttributeMetadata(t,r){const n=this.decoder.GetAttributeMetadata(t,r);return this._getDracoMetadata(n)}_getDracoMetadata(t){if(!t||!t.ptr)return{};const r={},n=this.metadataQuerier.NumEntries(t);for(let a=0;a<n;a++){const d=this.metadataQuerier.GetEntryName(t,a);r[d]=this._getDracoMetadataField(t,d)}return r}_getDracoMetadataField(t,r){const n=new this.draco.DracoInt32Array;try{this.metadataQuerier.GetIntEntryArray(t,r,n);const a=e4(n);return{int:this.metadataQuerier.GetIntEntry(t,r),string:this.metadataQuerier.GetStringEntry(t,r),double:this.metadataQuerier.GetDoubleEntry(t,r),intArray:a}}finally{this.draco.destroy(n)}}_disableAttributeTransforms(t){const{quantizedAttributes:r=[],octahedronAttributes:n=[]}=t,a=[...r,...n];for(const d of a)this.decoder.SkipAttributeTransform(this.draco[d])}_getQuantizationTransform(t,r){const{quantizedAttributes:n=[]}=r,a=t.attribute_type();if(n.map(f=>this.decoder[f]).includes(a)){const f=new this.draco.AttributeQuantizationTransform;try{if(f.InitFromAttribute(t))return{quantization_bits:f.quantization_bits(),range:f.range(),min_values:new Float32Array([1,2,3]).map(c=>f.min_value(c))}}finally{this.draco.destroy(f)}}return null}_getOctahedronTransform(t,r){const{octahedronAttributes:n=[]}=r,a=t.attribute_type();if(n.map(f=>this.decoder[f]).includes(a)){const f=new this.draco.AttributeQuantizationTransform;try{if(f.InitFromAttribute(t))return{quantization_bits:f.quantization_bits()}}finally{this.draco.destroy(f)}}return null}}function t4(e,t){switch(t){case Float32Array:return e.DT_FLOAT32;case Int8Array:return e.DT_INT8;case Int16Array:return e.DT_INT16;case Int32Array:return e.DT_INT32;case Uint8Array:return e.DT_UINT8;case Uint16Array:return e.DT_UINT16;case Uint32Array:return e.DT_UINT32;default:return e.DT_INVALID}}function e4(e){const t=e.size(),r=new Int32Array(t);for(let n=0;n<t;n++)r[n]=e.GetValue(n);return r}function r4(e){const t=e.size(),r=new Int32Array(t);for(let n=0;n<t;n++)r[n]=e.GetValue(n);return r}const i4="1.5.6",s4="1.4.1",fy=`https://www.gstatic.com/draco/versioned/decoders/${i4}`,gs={DECODER:"draco_wasm_wrapper.js",DECODER_WASM:"draco_decoder.wasm",FALLBACK_DECODER:"draco_decoder.js",ENCODER:"draco_encoder.js"},py={[gs.DECODER]:`${fy}/${gs.DECODER}`,[gs.DECODER_WASM]:`${fy}/${gs.DECODER_WASM}`,[gs.FALLBACK_DECODER]:`${fy}/${gs.FALLBACK_DECODER}`,[gs.ENCODER]:`https://raw.githubusercontent.com/google/draco/${s4}/javascript/${gs.ENCODER}`};let _y;async function n4(e){const t=e.modules||{};return t.draco3d?_y||=t.draco3d.createDecoderModule({}).then(r=>({draco:r})):_y||=o4(e),await _y}async function o4(e){let t,r;switch(e.draco&&e.draco.decoderType){case"js":t=await Ga(py[gs.FALLBACK_DECODER],"draco",e,gs.FALLBACK_DECODER);break;case"wasm":default:[t,r]=await Promise.all([await Ga(py[gs.DECODER],"draco",e,gs.DECODER),await Ga(py[gs.DECODER_WASM],"draco",e,gs.DECODER_WASM)])}return t=t||globalThis.DracoDecoderModule,await a4(t,r)}function a4(e,t){const r={};return t&&(r.wasmBinary=t),new Promise(n=>{e({...r,onModuleLoaded:a=>n({draco:a})})})}const wT={...qz,parse:l4};async function l4(e,t){const{draco:r}=await n4(t),n=new Qz(r);try{return n.parseSync(e,t?.draco)}finally{n.destroy()}}function c4(e){const t={};for(const r in e){const n=e[r];if(r!=="indices"){const a=TT(n);t[r]=a}}return t}function TT(e){const{buffer:t,size:r,count:n}=u4(e);return{value:t,size:r,byteOffset:0,count:n,type:aT(r),componentType:ip(t)}}function u4(e){let t=e,r=1,n=0;return e&&e.value&&(t=e.value,r=e.size||1),t&&(ArrayBuffer.isView(t)||(t=h4(t,Float32Array)),n=t.length/r),{buffer:t,size:r,count:n}}function h4(e,t,r=!1){return e?Array.isArray(e)?new t(e):r&&!(e instanceof t)?new t(e):e:null}const fa="KHR_draco_mesh_compression",d4=fa;function f4(e,t,r){const n=new Pi(e);for(const a of AT(n))n.getObjectExtension(a,fa)}async function p4(e,t,r){if(!t?.gltf?.decompressMeshes)return;const n=new Pi(e),a=[];for(const d of AT(n))n.getObjectExtension(d,fa)&&a.push(g4(n,d,t,r));await Promise.all(a),n.removeExtension(fa)}function _4(e,t={}){const r=new Pi(e);for(const n of r.json.meshes||[])m4(n),r.addRequiredExtension(fa)}async function g4(e,t,r,n){const a=e.getObjectExtension(t,fa);if(!a)return;const d=e.getTypedArrayForBufferView(a.bufferView),f=rg(d.buffer,d.byteOffset),c={...r};delete c["3d-tiles"];const T=await Zu(f,wT,c,n),C=c4(T.attributes);for(const[R,L]of Object.entries(C))if(R in t.attributes){const V=t.attributes[R],X=e.getAccessor(V);X?.min&&X?.max&&(L.min=X.min,L.max=X.max)}t.attributes=C,T.indices&&(t.indices=TT(T.indices)),e.removeObjectExtension(t,fa),y4(t)}function m4(e,t,r=4,n,a){if(!n.DracoWriter)throw new Error("options.gltf.DracoWriter not provided");const d=n.DracoWriter.encodeSync({attributes:e}),f=a?.parseSync?.({attributes:e}),c=n._addFauxAttributes(f.attributes),T=n.addBufferView(d);return{primitives:[{attributes:c,mode:r,extensions:{[fa]:{bufferView:T,attributes:c}}}]}}function y4(e){if(!e.attributes&&Object.keys(e.attributes).length>0)throw new Error("glTF: Empty primitive detected: Draco decompression failure?")}function*AT(e){for(const t of e.json.meshes||[])for(const r of t.primitives)yield r}const b4=Object.freeze(Object.defineProperty({__proto__:null,decode:p4,encode:_4,name:d4,preprocess:f4},Symbol.toStringTag,{value:"Module"})),cp="KHR_texture_transform",v4=cp,up=new Bt,x4=new Xr,w4=new Xr;async function T4(e,t){if(!new Pi(e).hasExtension(cp)||!t.gltf?.loadBuffers)return;const a=e.json.materials||[];for(let d=0;d<a.length;d++)A4(d,e)}function A4(e,t){const r=t.json.materials?.[e],n=[r?.pbrMetallicRoughness?.baseColorTexture,r?.emissiveTexture,r?.normalTexture,r?.occlusionTexture,r?.pbrMetallicRoughness?.metallicRoughnessTexture],a=[];for(const d of n)d&&d?.extensions?.[cp]&&E4(t,e,d,a)}function E4(e,t,r,n){const a=S4(r,n);if(!a)return;const d=e.json.meshes||[];for(const f of d)for(const c of f.primitives){const T=c.material;Number.isFinite(T)&&t===T&&C4(e,c,a)}}function S4(e,t){const r=e.extensions?.[cp],{texCoord:n=0}=e,{texCoord:a=n}=r;if(!(t.findIndex(([f,c])=>f===n&&c===a)!==-1)){const f=R4(r);return n!==a&&(e.texCoord=a),t.push([n,a]),{originalTexCoord:n,texCoord:a,matrix:f}}return null}function C4(e,t,r){const{originalTexCoord:n,texCoord:a,matrix:d}=r,f=t.attributes[`TEXCOORD_${n}`];if(Number.isFinite(f)){const c=e.json.accessors?.[f];if(c&&c.bufferView){const T=e.json.bufferViews?.[c.bufferView];if(T){const{arrayBuffer:C,byteOffset:R}=e.buffers[T.buffer],L=(R||0)+(c.byteOffset||0)+(T.byteOffset||0),{ArrayType:V,length:X}=sy(c,T),at=nT[c.componentType],nt=sT[c.type],K=T.byteStride||at*nt,It=new Float32Array(X);for(let St=0;St<c.count;St++){const Ct=new V(C,L+St*K,2);up.set(Ct[0],Ct[1],1),up.transformByMatrix3(d),It.set([up[0],up[1]],St*nt)}n===a?I4(c,T,e.buffers,It):M4(a,c,t,e,It)}}}}function I4(e,t,r,n){e.componentType=5126,r.push({arrayBuffer:n.buffer,byteOffset:0,byteLength:n.buffer.byteLength}),t.buffer=r.length-1,t.byteLength=n.buffer.byteLength,t.byteOffset=0,delete t.byteStride}function M4(e,t,r,n,a){n.buffers.push({arrayBuffer:a.buffer,byteOffset:0,byteLength:a.buffer.byteLength});const d=n.json.bufferViews;if(!d)return;d.push({buffer:n.buffers.length-1,byteLength:a.buffer.byteLength,byteOffset:0});const f=n.json.accessors;f&&(f.push({bufferView:d?.length-1,byteOffset:0,componentType:5126,count:t.count,type:"VEC2"}),r.attributes[`TEXCOORD_${e}`]=f.length-1)}function R4(e){const{offset:t=[0,0],rotation:r=0,scale:n=[1,1]}=e,a=new Xr().set(1,0,0,0,1,0,t[0],t[1],1),d=x4.set(Math.cos(r),Math.sin(r),0,-Math.sin(r),Math.cos(r),0,0,0,1),f=w4.set(n[0],0,0,0,n[1],0,0,0,1);return a.multiplyRight(d).multiplyRight(f)}const P4=Object.freeze(Object.defineProperty({__proto__:null,decode:T4,name:v4},Symbol.toStringTag,{value:"Module"})),ol="KHR_lights_punctual",B4=ol;async function D4(e){const t=new Pi(e),{json:r}=t,n=t.getExtension(ol);n&&(t.json.lights=n.lights,t.removeExtension(ol));for(const a of r.nodes||[]){const d=t.getObjectExtension(a,ol);d&&(a.light=d.light),t.removeObjectExtension(a,ol)}}async function F4(e){const t=new Pi(e),{json:r}=t;if(r.lights){const n=t.addExtension(ol);Bs(!n.lights),n.lights=r.lights,delete r.lights}if(t.json.lights){for(const n of t.json.lights){const a=n.node;t.addObjectExtension(a,ol,n)}delete t.json.lights}}const O4=Object.freeze(Object.defineProperty({__proto__:null,decode:D4,encode:F4,name:B4},Symbol.toStringTag,{value:"Module"})),Dh="KHR_materials_unlit",k4=Dh;async function N4(e){const t=new Pi(e),{json:r}=t;for(const n of r.materials||[])n.extensions&&n.extensions.KHR_materials_unlit&&(n.unlit=!0),t.removeObjectExtension(n,Dh);t.removeExtension(Dh)}function L4(e){const t=new Pi(e),{json:r}=t;if(t.materials)for(const n of r.materials||[])n.unlit&&(delete n.unlit,t.addObjectExtension(n,Dh,{}),t.addExtension(Dh))}const U4=Object.freeze(Object.defineProperty({__proto__:null,decode:N4,encode:L4,name:k4},Symbol.toStringTag,{value:"Module"})),Fh="KHR_techniques_webgl",z4=Fh;async function V4(e){const t=new Pi(e),{json:r}=t,n=t.getExtension(Fh);if(n){const a=H4(n,t);for(const d of r.materials||[]){const f=t.getObjectExtension(d,Fh);f&&(d.technique=Object.assign({},f,a[f.technique]),d.technique.values=G4(d.technique,t)),t.removeObjectExtension(d,Fh)}t.removeExtension(Fh)}}async function j4(e,t){}function H4(e,t){const{programs:r=[],shaders:n=[],techniques:a=[]}=e,d=new TextDecoder;return n.forEach(f=>{if(Number.isFinite(f.bufferView))f.code=d.decode(t.getTypedArrayForBufferView(f.bufferView));else throw new Error("KHR_techniques_webgl: no shader code")}),r.forEach(f=>{f.fragmentShader=n[f.fragmentShader],f.vertexShader=n[f.vertexShader]}),a.forEach(f=>{f.program=r[f.program]}),a}function G4(e,t){const r=Object.assign({},e.values);return Object.keys(e.uniforms||{}).forEach(n=>{e.uniforms[n].value&&!(n in r)&&(r[n]=e.uniforms[n].value)}),Object.keys(r).forEach(n=>{typeof r[n]=="object"&&r[n].index!==void 0&&(r[n].texture=t.getTexture(r[n].index))}),r}const ET=[KU,wU,Vz,Gz,Xz,b4,O4,U4,Object.freeze(Object.defineProperty({__proto__:null,decode:V4,encode:j4,name:z4},Symbol.toStringTag,{value:"Module"})),P4,pz];function $4(e,t={},r){const n=ET.filter(a=>ST(a.name,t));for(const a of n)a.preprocess?.(e,t,r)}async function W4(e,t={},r){const n=ET.filter(a=>ST(a.name,t));for(const a of n)await a.decode?.(e,t,r)}function ST(e,t){const r=t?.gltf?.excludeExtensions||{};return!(e in r&&!r[e])}const gy="KHR_binary_glTF";function X4(e){const t=new Pi(e),{json:r}=t;for(const n of r.images||[]){const a=t.getObjectExtension(n,gy);a&&Object.assign(n,a),t.removeObjectExtension(n,gy)}r.buffers&&r.buffers[0]&&delete r.buffers[0].uri,t.removeExtension(gy)}const CT={accessors:"accessor",animations:"animation",buffers:"buffer",bufferViews:"bufferView",images:"image",materials:"material",meshes:"mesh",nodes:"node",samplers:"sampler",scenes:"scene",skins:"skin",textures:"texture"},q4={accessor:"accessors",animations:"animation",buffer:"buffers",bufferView:"bufferViews",image:"images",material:"materials",mesh:"meshes",node:"nodes",sampler:"samplers",scene:"scenes",skin:"skins",texture:"textures"};class Z4{idToIndexMap={animations:{},accessors:{},buffers:{},bufferViews:{},images:{},materials:{},meshes:{},nodes:{},samplers:{},scenes:{},skins:{},textures:{}};json;normalize(t,r){this.json=t.json;const n=t.json;switch(n.asset&&n.asset.version){case"2.0":return;case void 0:case"1.0":break;default:console.warn(`glTF: Unknown version ${n.asset.version}`);return}if(!r.normalize)throw new Error("glTF v1 is not supported.");console.warn("Converting glTF v1 to glTF v2 format. This is experimental and may fail."),this._addAsset(n),this._convertTopLevelObjectsToArrays(n),X4(t),this._convertObjectIdsToArrayIndices(n),this._updateObjects(n),this._updateMaterial(n)}_addAsset(t){t.asset=t.asset||{},t.asset.version="2.0",t.asset.generator=t.asset.generator||"Normalized to glTF 2.0 by loaders.gl"}_convertTopLevelObjectsToArrays(t){for(const r in CT)this._convertTopLevelObjectToArray(t,r)}_convertTopLevelObjectToArray(t,r){const n=t[r];if(!(!n||Array.isArray(n))){t[r]=[];for(const a in n){const d=n[a];d.id=d.id||a;const f=t[r].length;t[r].push(d),this.idToIndexMap[r][a]=f}}}_convertObjectIdsToArrayIndices(t){for(const r in CT)this._convertIdsToIndices(t,r);"scene"in t&&(t.scene=this._convertIdToIndex(t.scene,"scene"));for(const r of t.textures)this._convertTextureIds(r);for(const r of t.meshes)this._convertMeshIds(r);for(const r of t.nodes)this._convertNodeIds(r);for(const r of t.scenes)this._convertSceneIds(r)}_convertTextureIds(t){t.source&&(t.source=this._convertIdToIndex(t.source,"image"))}_convertMeshIds(t){for(const r of t.primitives){const{attributes:n,indices:a,material:d}=r;for(const f in n)n[f]=this._convertIdToIndex(n[f],"accessor");a&&(r.indices=this._convertIdToIndex(a,"accessor")),d&&(r.material=this._convertIdToIndex(d,"material"))}}_convertNodeIds(t){t.children&&(t.children=t.children.map(r=>this._convertIdToIndex(r,"node"))),t.meshes&&(t.meshes=t.meshes.map(r=>this._convertIdToIndex(r,"mesh")))}_convertSceneIds(t){t.nodes&&(t.nodes=t.nodes.map(r=>this._convertIdToIndex(r,"node")))}_convertIdsToIndices(t,r){t[r]||(console.warn(`gltf v1: json doesn't contain attribute ${r}`),t[r]=[]);for(const n of t[r])for(const a in n){const d=n[a],f=this._convertIdToIndex(d,a);n[a]=f}}_convertIdToIndex(t,r){const n=q4[r];if(n in this.idToIndexMap){const a=this.idToIndexMap[n][t];if(!Number.isFinite(a))throw new Error(`gltf v1: failed to resolve ${r} with id ${t}`);return a}return t}_updateObjects(t){for(const r of this.json.buffers)delete r.type}_updateMaterial(t){for(const r of t.materials){r.pbrMetallicRoughness={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1};const n=r.values?.tex||r.values?.texture2d_0||r.values?.diffuseTex,a=t.textures.findIndex(d=>d.id===n);a!==-1&&(r.pbrMetallicRoughness.baseColorTexture={index:a})}}}function Y4(e,t={}){return new Z4().normalize(e,t)}async function K4(e,t,r=0,n,a){return J4(e,t,r,n),Y4(e,{normalize:n?.gltf?.normalize}),$4(e,n,a),n?.gltf?.loadBuffers&&e.json.buffers&&await Q4(e,n,a),n?.gltf?.loadImages&&await t6(e,n,a),await W4(e,n,a),e}function J4(e,t,r,n){if(n.uri&&(e.baseUri=n.uri),t instanceof ArrayBuffer&&!wz(t,r,n)&&(t=new TextDecoder().decode(t)),typeof t=="string")e.json=LC(t);else if(t instanceof ArrayBuffer){const f={};r=Tz(f,t,r,n.glb),Bs(f.type==="glTF",`Invalid GLB magic string ${f.type}`),e._glb=f,e.json=f.json}else Bs(!1,"GLTF: must be ArrayBuffer or string");const a=e.json.buffers||[];if(e.buffers=new Array(a.length).fill(null),e._glb&&e._glb.header.hasBinChunk){const{binChunks:f}=e._glb;e.buffers[0]={arrayBuffer:f[0].arrayBuffer,byteOffset:f[0].byteOffset,byteLength:f[0].byteLength}}const d=e.json.images||[];e.images=new Array(d.length).fill({})}async function Q4(e,t,r){const n=e.json.buffers||[];for(let a=0;a<n.length;++a){const d=n[a];if(d.uri){const{fetch:f}=r;Bs(f);const c=yT(d.uri,t),C=await(await r?.fetch?.(c))?.arrayBuffer?.();e.buffers[a]={arrayBuffer:C,byteOffset:0,byteLength:C.byteLength},delete d.uri}else e.buffers[a]===null&&(e.buffers[a]={arrayBuffer:new ArrayBuffer(d.byteLength),byteOffset:0,byteLength:d.byteLength})}}async function t6(e,t,r){const n=e6(e),a=e.json.images||[],d=[];for(const f of n)d.push(r6(e,a[f],f,t,r));return await Promise.all(d)}function e6(e){const t=new Set,r=e.json.textures||[];for(const n of r)n.source!==void 0&&t.add(n.source);return Array.from(t).sort()}async function r6(e,t,r,n,a){let d;if(t.uri&&!t.hasOwnProperty("bufferView")){const c=yT(t.uri,n),{fetch:T}=a;d=await(await T(c)).arrayBuffer(),t.bufferView={data:d}}if(Number.isFinite(t.bufferView)){const c=aU(e.json,e.buffers,t.bufferView);d=rg(c.buffer,c.byteOffset,c.byteLength)}Bs(d,"glTF image has no data");let f=await Zu(d,[_v,kL],{...n,mimeType:t.mimeType,basis:n.basis||{format:eT()}},a);f&&f[0]&&(f={compressed:!0,mipmaps:!1,width:f[0].width,height:f[0].height,data:f[0]}),e.images=e.images||[],e.images[r]=f}const Oh={dataType:null,batchType:null,name:"glTF",id:"gltf",module:"gltf",version:_z,extensions:["gltf","glb"],mimeTypes:["model/gltf+json","model/gltf-binary"],text:!0,binary:!0,tests:["glTF"],parse:i6,options:{gltf:{normalize:!0,loadBuffers:!0,loadImages:!0,decompressMeshes:!0},log:console}};async function i6(e,t={},r){t={...Oh.options,...t},t.gltf={...Oh.options.gltf,...t.gltf};const{byteOffset:n=0}=t;return await K4({},e,n,t,r)}const s6={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},n6={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},ln={TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,REPEAT:10497,LINEAR:9729,NEAREST_MIPMAP_LINEAR:9986},o6={magFilter:ln.TEXTURE_MAG_FILTER,minFilter:ln.TEXTURE_MIN_FILTER,wrapS:ln.TEXTURE_WRAP_S,wrapT:ln.TEXTURE_WRAP_T},a6={[ln.TEXTURE_MAG_FILTER]:ln.LINEAR,[ln.TEXTURE_MIN_FILTER]:ln.NEAREST_MIPMAP_LINEAR,[ln.TEXTURE_WRAP_S]:ln.REPEAT,[ln.TEXTURE_WRAP_T]:ln.REPEAT};function l6(){return{id:"default-sampler",parameters:a6}}function c6(e){return n6[e]}function u6(e){return s6[e]}class h6{baseUri="";jsonUnprocessed;json;buffers=[];images=[];postProcess(t,r={}){const{json:n,buffers:a=[],images:d=[]}=t,{baseUri:f=""}=t;return Bs(n),this.baseUri=f,this.buffers=a,this.images=d,this.jsonUnprocessed=n,this.json=this._resolveTree(t.json,r),this.json}_resolveTree(t,r={}){const n={...t};return this.json=n,t.bufferViews&&(n.bufferViews=t.bufferViews.map((a,d)=>this._resolveBufferView(a,d))),t.images&&(n.images=t.images.map((a,d)=>this._resolveImage(a,d))),t.samplers&&(n.samplers=t.samplers.map((a,d)=>this._resolveSampler(a,d))),t.textures&&(n.textures=t.textures.map((a,d)=>this._resolveTexture(a,d))),t.accessors&&(n.accessors=t.accessors.map((a,d)=>this._resolveAccessor(a,d))),t.materials&&(n.materials=t.materials.map((a,d)=>this._resolveMaterial(a,d))),t.meshes&&(n.meshes=t.meshes.map((a,d)=>this._resolveMesh(a,d))),t.nodes&&(n.nodes=t.nodes.map((a,d)=>this._resolveNode(a,d)),n.nodes=n.nodes.map((a,d)=>this._resolveNodeChildren(a))),t.skins&&(n.skins=t.skins.map((a,d)=>this._resolveSkin(a,d))),t.scenes&&(n.scenes=t.scenes.map((a,d)=>this._resolveScene(a,d))),typeof this.json.scene=="number"&&n.scenes&&(n.scene=n.scenes[this.json.scene]),n}getScene(t){return this._get(this.json.scenes,t)}getNode(t){return this._get(this.json.nodes,t)}getSkin(t){return this._get(this.json.skins,t)}getMesh(t){return this._get(this.json.meshes,t)}getMaterial(t){return this._get(this.json.materials,t)}getAccessor(t){return this._get(this.json.accessors,t)}getCamera(t){return this._get(this.json.cameras,t)}getTexture(t){return this._get(this.json.textures,t)}getSampler(t){return this._get(this.json.samplers,t)}getImage(t){return this._get(this.json.images,t)}getBufferView(t){return this._get(this.json.bufferViews,t)}getBuffer(t){return this._get(this.json.buffers,t)}_get(t,r){if(typeof r=="object")return r;const n=t&&t[r];return n||console.warn(`glTF file error: Could not find ${t}[${r}]`),n}_resolveScene(t,r){return{...t,id:t.id||`scene-${r}`,nodes:(t.nodes||[]).map(n=>this.getNode(n))}}_resolveNode(t,r){const n={...t,id:t?.id||`node-${r}`};return t.mesh!==void 0&&(n.mesh=this.getMesh(t.mesh)),t.camera!==void 0&&(n.camera=this.getCamera(t.camera)),t.skin!==void 0&&(n.skin=this.getSkin(t.skin)),t.meshes!==void 0&&t.meshes.length&&(n.mesh=t.meshes.reduce((a,d)=>{const f=this.getMesh(d);return a.id=f.id,a.primitives=a.primitives.concat(f.primitives),a},{primitives:[]})),n}_resolveNodeChildren(t){return t.children&&(t.children=t.children.map(r=>this.getNode(r))),t}_resolveSkin(t,r){const n=typeof t.inverseBindMatrices=="number"?this.getAccessor(t.inverseBindMatrices):void 0;return{...t,id:t.id||`skin-${r}`,inverseBindMatrices:n}}_resolveMesh(t,r){const n={...t,id:t.id||`mesh-${r}`,primitives:[]};return t.primitives&&(n.primitives=t.primitives.map(a=>{const d={...a,attributes:{},indices:void 0,material:void 0},f=a.attributes;for(const c in f)d.attributes[c]=this.getAccessor(f[c]);return a.indices!==void 0&&(d.indices=this.getAccessor(a.indices)),a.material!==void 0&&(d.material=this.getMaterial(a.material)),d})),n}_resolveMaterial(t,r){const n={...t,id:t.id||`material-${r}`};if(n.normalTexture&&(n.normalTexture={...n.normalTexture},n.normalTexture.texture=this.getTexture(n.normalTexture.index)),n.occlusionTexture&&(n.occlusionTexture={...n.occlusionTexture},n.occlusionTexture.texture=this.getTexture(n.occlusionTexture.index)),n.emissiveTexture&&(n.emissiveTexture={...n.emissiveTexture},n.emissiveTexture.texture=this.getTexture(n.emissiveTexture.index)),n.emissiveFactor||(n.emissiveFactor=n.emissiveTexture?[1,1,1]:[0,0,0]),n.pbrMetallicRoughness){n.pbrMetallicRoughness={...n.pbrMetallicRoughness};const a=n.pbrMetallicRoughness;a.baseColorTexture&&(a.baseColorTexture={...a.baseColorTexture},a.baseColorTexture.texture=this.getTexture(a.baseColorTexture.index)),a.metallicRoughnessTexture&&(a.metallicRoughnessTexture={...a.metallicRoughnessTexture},a.metallicRoughnessTexture.texture=this.getTexture(a.metallicRoughnessTexture.index))}return n}_resolveAccessor(t,r){const n=c6(t.componentType),a=u6(t.type),d=n*a,f={...t,id:t.id||`accessor-${r}`,bytesPerComponent:n,components:a,bytesPerElement:d,value:void 0,bufferView:void 0,sparse:void 0};if(t.bufferView!==void 0&&(f.bufferView=this.getBufferView(t.bufferView)),f.bufferView){const c=f.bufferView.buffer,{ArrayType:T,byteLength:C}=sy(f,f.bufferView),R=(f.bufferView.byteOffset||0)+(f.byteOffset||0)+c.byteOffset;let L=c.arrayBuffer.slice(R,R+C);f.bufferView.byteStride&&(L=this._getValueFromInterleavedBuffer(c,R,f.bufferView.byteStride,f.bytesPerElement,f.count)),f.value=new T(L)}return f}_getValueFromInterleavedBuffer(t,r,n,a,d){const f=new Uint8Array(d*a);for(let c=0;c<d;c++){const T=r+c*n;f.set(new Uint8Array(t.arrayBuffer.slice(T,T+a)),c*a)}return f.buffer}_resolveTexture(t,r){return{...t,id:t.id||`texture-${r}`,sampler:typeof t.sampler=="number"?this.getSampler(t.sampler):l6(),source:typeof t.source=="number"?this.getImage(t.source):void 0}}_resolveSampler(t,r){const n={id:t.id||`sampler-${r}`,...t,parameters:{}};for(const a in n){const d=this._enumSamplerParameter(a);d!==void 0&&(n.parameters[d]=n[a])}return n}_enumSamplerParameter(t){return o6[t]}_resolveImage(t,r){const n={...t,id:t.id||`image-${r}`,image:null,bufferView:t.bufferView!==void 0?this.getBufferView(t.bufferView):void 0},a=this.images[r];return a&&(n.image=a),n}_resolveBufferView(t,r){const n=t.buffer,a=this.buffers[n].arrayBuffer;let d=this.buffers[n].byteOffset||0;return t.byteOffset&&(d+=t.byteOffset),{id:`bufferView-${r}`,...t,buffer:this.buffers[n],data:new Uint8Array(a,d,t.byteLength)}}_resolveCamera(t,r){const n={...t,id:t.id||`camera-${r}`};return n.perspective,n.orthographic,n}}function my(e,t){return new h6().postProcess(e,t)}async function d6(e){const t=[];return e.scenes.forEach(r=>{r.traverse(n=>{Object.values(n.model.uniforms).forEach(a=>{a.loaded===!1&&t.push(a)})})}),await f6(()=>t.some(r=>!r.loaded))}async function f6(e){for(;e();)await new Promise(t=>requestAnimationFrame(t))}const p6=`#version 300 es
#define SHADER_NAME scenegraph-layer-vertex-shader
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec3 instanceModelMatrixCol0;
in vec3 instanceModelMatrixCol1;
in vec3 instanceModelMatrixCol2;
in vec3 instanceTranslation;
uniform float sizeScale;
uniform float sizeMinPixels;
uniform float sizeMaxPixels;
uniform mat4 sceneModelMatrix;
uniform bool composeModelMatrix;
in vec3 positions;
#ifdef HAS_UV
in vec2 texCoords;
#endif
#ifdef MODULE_PBR
#ifdef HAS_NORMALS
in vec3 normals;
#endif
#endif
out vec4 vColor;
#ifndef MODULE_PBR
#ifdef HAS_UV
out vec2 vTEXCOORD_0;
#endif
#endif
void main(void) {
#if defined(HAS_UV) && !defined(MODULE_PBR)
vTEXCOORD_0 = texCoords;
geometry.uv = texCoords;
#endif
geometry.worldPosition = instancePositions;
geometry.pickingColor = instancePickingColors;
mat3 instanceModelMatrix = mat3(instanceModelMatrixCol0, instanceModelMatrixCol1, instanceModelMatrixCol2);
vec3 normal = vec3(0.0, 0.0, 1.0);
#ifdef MODULE_PBR
#ifdef HAS_NORMALS
normal = instanceModelMatrix * (sceneModelMatrix * vec4(normals, 0.0)).xyz;
#endif
#endif
float originalSize = project_size_to_pixel(sizeScale);
float clampedSize = clamp(originalSize, sizeMinPixels, sizeMaxPixels);
vec3 pos = (instanceModelMatrix * (sceneModelMatrix * vec4(positions, 1.0)).xyz) * sizeScale * (clampedSize / originalSize) + instanceTranslation;
if(composeModelMatrix) {
DECKGL_FILTER_SIZE(pos, geometry);
geometry.normal = project_normal(normal);
geometry.worldPosition += pos;
gl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
}
else {
pos = project_size(pos);
DECKGL_FILTER_SIZE(pos, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, geometry.position);
geometry.normal = project_normal(normal);
}
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
#ifdef MODULE_PBR
pbr_vPosition = geometry.position.xyz;
#ifdef HAS_NORMALS
pbr_vNormal = geometry.normal;
#endif
#ifdef HAS_UV
pbr_vUV = texCoords;
#else
pbr_vUV = vec2(0., 0.);
#endif
geometry.uv = pbr_vUV;
#endif
vColor = instanceColors;
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,_6=`#version 300 es
#define SHADER_NAME scenegraph-layer-fragment-shader
uniform float opacity;
in vec4 vColor;
out vec4 fragColor;
#ifndef MODULE_PBR
#if defined(HAS_UV) && defined(HAS_BASECOLORMAP)
in vec2 vTEXCOORD_0;
uniform sampler2D u_BaseColorSampler;
#endif
#endif
void main(void) {
#ifdef MODULE_PBR
fragColor = vColor * pbr_filterColor(vec4(0));
geometry.uv = pbr_vUV;
#else
#if defined(HAS_UV) && defined(HAS_BASECOLORMAP)
fragColor = vColor * texture(u_BaseColorSampler, vTEXCOORD_0);
geometry.uv = vTEXCOORD_0;
#else
fragColor = vColor;
#endif
#endif
fragColor.a *= opacity;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,IT=[255,255,255,255],g6={scenegraph:{type:"object",value:null,async:!0},getScene:e=>e&&e.scenes?typeof e.scene=="object"?e.scene:e.scenes[e.scene||0]:e,getAnimator:e=>e&&e.animator,_animations:null,sizeScale:{type:"number",value:1,min:0},sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},getPosition:{type:"accessor",value:e=>e.position},getColor:{type:"accessor",value:IT},_lighting:"flat",_imageBasedLightingEnvironment:void 0,getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]},loaders:[Oh]};class yy extends Ic{getShaders(){const t=[im,cm];return this.props._lighting==="pbr"&&t.push(Qg),super.getShaders({vs:p6,fs:_6,modules:t})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),accessor:"getPosition",transition:!0},instanceColors:{type:"unorm8",size:this.props.colorFormat.length,accessor:"getColor",defaultValue:IT,transition:!0},instanceModelMatrix:$w})}updateState(t){super.updateState(t);const{props:r,oldProps:n}=t;r.scenegraph!==n.scenegraph?this._updateScenegraph():r._animations!==n._animations&&this._applyAnimationsProp(this.state.animator,r._animations)}finalizeState(t){super.finalizeState(t),this.state.scenegraph?.destroy()}get isLoaded(){return!!(this.state?.scenegraph&&super.isLoaded)}_updateScenegraph(){const t=this.props,{device:r}=this.context;let n=null;if(t.scenegraph instanceof Of)n={scenes:[t.scenegraph]};else if(t.scenegraph&&typeof t.scenegraph=="object"){const c=t.scenegraph,T=c.json?my(c):c,C=tU(r,T,this._getModelOptions());n={gltf:T,...C},d6(C).then(()=>{this.setNeedsRedraw()}).catch(R=>{this.raiseError(R,"loading glTF")})}const a={layer:this,device:this.context.device},d=t.getScene(n,a),f=t.getAnimator(n,a);if(d instanceof mc){this.state.scenegraph?.destroy(),this._applyAnimationsProp(f,t._animations);const c=[];d.traverse(T=>{T instanceof gm&&c.push(T.model)}),this.setState({scenegraph:d,animator:f,models:c}),this.getAttributeManager().invalidateAll()}else d!==null&&Ye.warn("invalid scenegraph:",d)()}_applyAnimationsProp(t,r){if(!t||!r)return;const n=t.getAnimations();Object.keys(r).sort().forEach(a=>{const d=r[a];if(a==="*")n.forEach(f=>{Object.assign(f,d)});else if(Number.isFinite(Number(a))){const f=Number(a);f>=0&&f<n.length?Object.assign(n[f],d):Ye.warn(`animation ${a} not found`)()}else{const f=n.find(({name:c})=>c===a);f?Object.assign(f,d):Ye.warn(`animation ${a} not found`)()}})}_getModelOptions(){const{_imageBasedLightingEnvironment:t}=this.props;let r;return t&&(typeof t=="function"?r=t({gl:this.context.gl,layer:this}):r=t),{imageBasedLightingEnvironment:r,modelOptions:{id:this.props.id,isInstanced:!0,bufferLayout:this.getAttributeManager().getBufferLayouts(),...this.getShaders()},useTangents:!1}}draw({context:t}){if(!this.state.scenegraph)return;this.props._animations&&this.state.animator&&(this.state.animator.animate(t.timeline.getTime()),this.setNeedsRedraw());const{viewport:r,renderPass:n}=this.context,{sizeScale:a,sizeMinPixels:d,sizeMaxPixels:f,opacity:c,coordinateSystem:T}=this.props,C=this.getNumInstances();this.state.scenegraph.traverse((R,{worldMatrix:L})=>{if(R instanceof gm){const{model:V}=R;V.setInstanceCount(C),V.setUniforms({sizeScale:a,opacity:c,sizeMinPixels:d,sizeMaxPixels:f,composeModelMatrix:Ww(r,T),sceneModelMatrix:L,u_Camera:V.uniforms.project_uCameraPosition}),V.draw(n)}})}}yy.defaultProps=g6,yy.layerName="ScenegraphLayer";const m6=`#version 300 es
#define SHADER_NAME simple-mesh-layer-vs
uniform float sizeScale;
uniform bool composeModelMatrix;
uniform bool pickFeatureIds;
in vec3 positions;
in vec3 normals;
in vec3 colors;
in vec2 texCoords;
in vec4 uvRegions;
in vec3 featureIdsPickingColors;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec3 instanceModelMatrixCol0;
in vec3 instanceModelMatrixCol1;
in vec3 instanceModelMatrixCol2;
out vec2 vTexCoord;
out vec3 cameraPosition;
out vec3 normals_commonspace;
out vec4 position_commonspace;
out vec4 vColor;
vec2 applyUVRegion(vec2 uv) {
#ifdef HAS_UV_REGIONS
return fract(uv) * (uvRegions.zw - uvRegions.xy) + uvRegions.xy;
#else
return uv;
#endif
}
void main(void) {
vec2 uv = applyUVRegion(texCoords);
geometry.uv = uv;
if (pickFeatureIds) {
geometry.pickingColor = featureIdsPickingColors;
} else {
geometry.pickingColor = instancePickingColors;
}
mat3 instanceModelMatrix = mat3(instanceModelMatrixCol0, instanceModelMatrixCol1, instanceModelMatrixCol2);
vTexCoord = uv;
cameraPosition = project_uCameraPosition;
vColor = vec4(colors * instanceColors.rgb, instanceColors.a);
vec3 pos = (instanceModelMatrix * positions) * sizeScale;
vec3 projectedPosition = project_position(positions);
position_commonspace = vec4(projectedPosition, 1.0);
gl_Position = project_common_position_to_clipspace(position_commonspace);
geometry.position = position_commonspace;
normals_commonspace = project_normal(instanceModelMatrix * normals);
geometry.normal = normals_commonspace;
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
#ifdef MODULE_PBR
pbr_vPosition = geometry.position.xyz;
#ifdef HAS_NORMALS
pbr_vNormal = geometry.normal;
#endif
#ifdef HAS_UV
pbr_vUV = uv;
#else
pbr_vUV = vec2(0., 0.);
#endif
geometry.uv = pbr_vUV;
#endif
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,y6=`#version 300 es
#define SHADER_NAME simple-mesh-layer-fs
precision highp float;
uniform bool hasTexture;
uniform sampler2D sampler;
uniform bool flatShading;
uniform float opacity;
in vec2 vTexCoord;
in vec3 cameraPosition;
in vec3 normals_commonspace;
in vec4 position_commonspace;
in vec4 vColor;
out vec4 fragColor;
void main(void) {
#ifdef MODULE_PBR
fragColor = vColor * pbr_filterColor(vec4(0));
geometry.uv = pbr_vUV;
fragColor.a *= opacity;
#else
geometry.uv = vTexCoord;
vec3 normal;
if (flatShading) {
normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
} else {
normal = normals_commonspace;
}
vec4 color = hasTexture ? texture(sampler, vTexCoord) : vColor;
vec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);
fragColor = vec4(lightColor, color.a * opacity);
#endif
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;function b6(e){const t=e.positions||e.POSITION,r=t.value.length/t.size;e.COLOR_0||e.colors||(e.colors={size:4,value:new Uint8Array(r*4).fill(255),normalized:!0})}const v6={pbrMaterial:{type:"object",value:null},featureIds:{type:"array",value:null,optional:!0}};class by extends ty{getShaders(){const t=super.getShaders();return t.modules.push(Qg),{...t,vs:m6,fs:y6}}initializeState(){const{featureIds:t}=this.props;super.initializeState();const r=this.getAttributeManager();t&&r.add({featureIdsPickingColors:{type:"uint8",size:3,noAlloc:!0,update:this.calculateFeatureIdsPickingColors}})}updateState(t){super.updateState(t);const{props:r,oldProps:n}=t;r.pbrMaterial!==n.pbrMaterial&&this.updatePbrMaterialUniforms(r.pbrMaterial)}draw(t){const{featureIds:r}=this.props;this.state.model&&(this.state.model.setUniforms({u_Camera:this.state.model.uniforms.project_uCameraPosition,pickFeatureIds:!!r}),super.draw(t))}getModel(t){const{id:r,pbrMaterial:n}=this.props,a=this.parseMaterial(n,t);this.setState({parsedPBRMaterial:a});const d=this.getShaders();return b6(t.attributes),new ea(this.context.device,{...this.getShaders(),id:r,geometry:t,bufferLayout:this.getAttributeManager().getBufferLayouts(),defines:{...d.defines,...a?.defines,HAS_UV_REGIONS:t.attributes.uvRegions?1:0},parameters:a?.parameters,isInstanced:!0})}updatePbrMaterialUniforms(t){const{model:r}=this.state;if(r){const{mesh:n}=this.props,a=this.parseMaterial(t,n);this.setState({parsedPBRMaterial:a}),r.setBindings(a.bindings),r.setUniforms(a.uniforms)}}parseMaterial(t,r){const n=!!(t.pbrMetallicRoughness&&t.pbrMetallicRoughness.baseColorTexture);return qw(this.context.device,{unlit:n,...t},{NORMAL:r.attributes.normals,TEXCOORD_0:r.attributes.texCoords},{pbrDebug:!1,lights:!0,useTangents:!1})}calculateFeatureIdsPickingColors(t){const r=this.props.featureIds,n=new Uint8ClampedArray(r.length*t.size),a=[];for(let d=0;d<r.length;d++)this.encodePickingColor(r[d],a),n[d*3]=a[0],n[d*3+1]=a[1],n[d*3+2]=a[2];t.value=n}finalizeState(t){super.finalizeState(t),this.state.parsedPBRMaterial?.generatedTextures.forEach(r=>r.destroy()),this.setState({parsedPBRMaterial:null})}}by.layerName="MeshLayer",by.defaultProps=v6;const x6=6378137,w6=6378137,T6=6356752314245179e-9;function hp(e){return e}new Bt;function A6(e,t=[],r=hp){return"longitude"in e?(t[0]=r(e.longitude),t[1]=r(e.latitude),t[2]=e.height):"x"in e?(t[0]=r(e.x),t[1]=r(e.y),t[2]=e.z):(t[0]=r(e[0]),t[1]=r(e[1]),t[2]=e[2]),t}function E6(e,t=[]){return A6(e,t,yi._cartographicRadians?hp:fP)}function S6(e,t,r=hp){return"longitude"in t?(t.longitude=r(e[0]),t.latitude=r(e[1]),t.height=e[2]):"x"in t?(t.x=r(e[0]),t.y=r(e[1]),t.z=e[2]):(t[0]=r(e[0]),t[1]=r(e[1]),t[2]=e[2]),t}function C6(e,t){return S6(e,t,yi._cartographicRadians?hp:pP)}const MT=1e-14,I6=new Bt,RT={up:{south:"east",north:"west",west:"south",east:"north"},down:{south:"west",north:"east",west:"north",east:"south"},south:{up:"west",down:"east",west:"down",east:"up"},north:{up:"east",down:"west",west:"up",east:"down"},west:{up:"north",down:"south",north:"down",south:"up"},east:{up:"south",down:"north",north:"up",south:"down"}},vy={north:[-1,0,0],east:[0,1,0],up:[0,0,1],south:[1,0,0],west:[0,-1,0],down:[0,0,-1]},kh={east:new Bt,north:new Bt,up:new Bt,west:new Bt,south:new Bt,down:new Bt},M6=new Bt,R6=new Bt,P6=new Bt;function PT(e,t,r,n,a,d){const f=RT[t]&&RT[t][r];Tn(f&&(!n||n===f));let c,T,C;const R=I6.copy(a);if(wn(R.x,0,MT)&&wn(R.y,0,MT)){const V=Math.sign(R.z);c=M6.fromArray(vy[t]),t!=="east"&&t!=="west"&&c.scale(V),T=R6.fromArray(vy[r]),r!=="east"&&r!=="west"&&T.scale(V),C=P6.fromArray(vy[n]),n!=="east"&&n!=="west"&&C.scale(V)}else{const{up:V,east:X,north:at}=kh;X.set(-R.y,R.x,0).normalize(),e.geodeticSurfaceNormal(R,V),at.copy(V).cross(X);const{down:nt,west:K,south:It}=kh;nt.copy(V).scale(-1),K.copy(X).scale(-1),It.copy(at).scale(-1),c=kh[t],T=kh[r],C=kh[n]}return d[0]=c.x,d[1]=c.y,d[2]=c.z,d[3]=0,d[4]=T.x,d[5]=T.y,d[6]=T.z,d[7]=0,d[8]=C.x,d[9]=C.y,d[10]=C.z,d[11]=0,d[12]=R.x,d[13]=R.y,d[14]=R.z,d[15]=1,d}const Fc=new Bt,B6=new Bt,D6=new Bt;function F6(e,t,r=[]){const{oneOverRadii:n,oneOverRadiiSquared:a,centerToleranceSquared:d}=t;Fc.from(e);const f=Fc.x,c=Fc.y,T=Fc.z,C=n.x,R=n.y,L=n.z,V=f*f*C*C,X=c*c*R*R,at=T*T*L*L,nt=V+X+at,K=Math.sqrt(1/nt);if(!Number.isFinite(K))return;const It=B6;if(It.copy(e).scale(K),nt<d)return It.to(r);const St=a.x,Ct=a.y,Ht=a.z,Qt=D6;Qt.set(It.x*St*2,It.y*Ct*2,It.z*Ht*2);let ee=(1-K)*Fc.len()/(.5*Qt.len()),ae=0,be,ie,le,Ae;do{ee-=ae,be=1/(1+ee*St),ie=1/(1+ee*Ct),le=1/(1+ee*Ht);const Fe=be*be,ze=ie*ie,Ce=le*le,zr=Fe*be,ns=ze*ie,Hr=Ce*le;Ae=V*Fe+X*ze+at*Ce-1;const Le=-2*(V*zr*St+X*ns*Ct+at*Hr*Ht);ae=Ae/Le}while(Math.abs(Ae)>D3);return Fc.scale([be,ie,le]).to(r)}const dp=new Bt,BT=new Bt,O6=new Bt,Mn=new Bt,k6=new Bt,fp=new Bt;class Er{constructor(t=0,r=0,n=0){this.centerToleranceSquared=B3,Tn(t>=0),Tn(r>=0),Tn(n>=0),this.radii=new Bt(t,r,n),this.radiiSquared=new Bt(t*t,r*r,n*n),this.radiiToTheFourth=new Bt(t*t*t*t,r*r*r*r,n*n*n*n),this.oneOverRadii=new Bt(t===0?0:1/t,r===0?0:1/r,n===0?0:1/n),this.oneOverRadiiSquared=new Bt(t===0?0:1/(t*t),r===0?0:1/(r*r),n===0?0:1/(n*n)),this.minimumRadius=Math.min(t,r,n),this.maximumRadius=Math.max(t,r,n),this.radiiSquared.z!==0&&(this.squaredXOverSquaredZ=this.radiiSquared.x/this.radiiSquared.z),Object.freeze(this)}equals(t){return this===t||!!(t&&this.radii.equals(t.radii))}toString(){return this.radii.toString()}cartographicToCartesian(t,r=[0,0,0]){const n=BT,a=O6,[,,d]=t;this.geodeticSurfaceNormalCartographic(t,n),a.copy(this.radiiSquared).scale(n);const f=Math.sqrt(n.dot(a));return a.scale(1/f),n.scale(d),a.add(n),a.to(r)}cartesianToCartographic(t,r=[0,0,0]){fp.from(t);const n=this.scaleToGeodeticSurface(fp,Mn);if(!n)return;const a=this.geodeticSurfaceNormal(n,BT),d=k6;d.copy(fp).subtract(n);const f=Math.atan2(a.y,a.x),c=Math.asin(a.z),T=Math.sign(Vg(d,fp))*yx(d);return C6([f,c,T],r)}eastNorthUpToFixedFrame(t,r=new He){return PT(this,"east","north","up",t,r)}localFrameToFixedFrame(t,r,n,a,d=new He){return PT(this,t,r,n,a,d)}geocentricSurfaceNormal(t,r=[0,0,0]){return dp.from(t).normalize().to(r)}geodeticSurfaceNormalCartographic(t,r=[0,0,0]){const n=E6(t),a=n[0],d=n[1],f=Math.cos(d);return dp.set(f*Math.cos(a),f*Math.sin(a),Math.sin(d)).normalize(),dp.to(r)}geodeticSurfaceNormal(t,r=[0,0,0]){return dp.from(t).scale(this.oneOverRadiiSquared).normalize().to(r)}scaleToGeodeticSurface(t,r){return F6(t,this,r)}scaleToGeocentricSurface(t,r=[0,0,0]){Mn.from(t);const n=Mn.x,a=Mn.y,d=Mn.z,f=this.oneOverRadiiSquared,c=1/Math.sqrt(n*n*f.x+a*a*f.y+d*d*f.z);return Mn.multiplyScalar(c).to(r)}transformPositionToScaledSpace(t,r=[0,0,0]){return Mn.from(t).scale(this.oneOverRadii).to(r)}transformPositionFromScaledSpace(t,r=[0,0,0]){return Mn.from(t).scale(this.radii).to(r)}getSurfaceNormalIntersectionWithZAxis(t,r=0,n=[0,0,0]){Tn(wn(this.radii.x,this.radii.y,Fx)),Tn(this.radii.z>0),Mn.from(t);const a=Mn.z*(1-this.squaredXOverSquaredZ);if(!(Math.abs(a)>=this.radii.z-r))return Mn.set(0,0,a).to(n)}}Er.WGS84=new Er(x6,w6,T6);class N6{item;previous;next;constructor(t,r,n){this.item=t,this.previous=r,this.next=n}}class L6{head=null;tail=null;_length=0;get length(){return this._length}add(t){const r=new N6(t,this.tail,null);return this.tail?(this.tail.next=r,this.tail=r):(this.head=r,this.tail=r),++this._length,r}remove(t){t&&(t.previous&&t.next?(t.previous.next=t.next,t.next.previous=t.previous):t.previous?(t.previous.next=null,this.tail=t.previous):t.next?(t.next.previous=null,this.head=t.next):(this.head=null,this.tail=null),t.next=null,t.previous=null,--this._length)}splice(t,r){t!==r&&(this.remove(r),this._insert(t,r))}_insert(t,r){const n=t.next;t.next=r,this.tail===t?this.tail=r:n.previous=r,r.next=n,r.previous=t,++this._length}}class U6{_list;_sentinel;_trimTiles;constructor(){this._list=new L6,this._sentinel=this._list.add("sentinel"),this._trimTiles=!1}reset(){this._list.splice(this._list.tail,this._sentinel)}touch(t){const r=t._cacheNode;r&&this._list.splice(this._sentinel,r)}add(t,r,n){r._cacheNode||(r._cacheNode=this._list.add(r),n&&n(t,r))}unloadTile(t,r,n){const a=r._cacheNode;a&&(this._list.remove(a),r._cacheNode=null,n&&n(t,r))}unloadTiles(t,r){const n=this._trimTiles;this._trimTiles=!1;const a=this._list,d=t.maximumMemoryUsage*1024*1024,f=this._sentinel;let c=a.head;for(;c!==f&&(t.gpuMemoryUsageInBytes>d||n);){const T=c.item;c=c.next,this.unloadTile(t,T,r)}}trim(){this._trimTiles=!0}}function z6(e,t){Ar(e),Ar(t);const{rtcCenter:r,gltfUpAxis:n}=t,{computedTransform:a,boundingVolume:{center:d}}=e;let f=new He(a);switch(r&&f.translate(r),n){case"Z":break;case"Y":const L=new He().rotateX(Math.PI/2);f=f.multiplyRight(L);break;case"X":const V=new He().rotateY(-Math.PI/2);f=f.multiplyRight(V);break}t.isQuantized&&f.translate(t.quantizedVolumeOffset).scale(t.quantizedVolumeScale);const c=new Bt(d);t.cartesianModelMatrix=f,t.cartesianOrigin=c;const T=Er.WGS84.cartesianToCartographic(c,new Bt),R=Er.WGS84.eastNorthUpToFixedFrame(c).invert();t.cartographicModelMatrix=R.multiplyRight(f),t.cartographicOrigin=T,t.coordinateSystem||(t.modelMatrix=t.cartographicModelMatrix)}const DT=new Bt,xy=new Bt,wy=new an([new so,new so,new so,new so,new so,new so]);function V6(e,t){const{cameraDirection:r,cameraUp:n,height:a}=e,{metersPerUnit:d}=e.distanceScales,f=pp(e,e.center),c=Er.WGS84.eastNorthUpToFixedFrame(f),T=e.unprojectPosition(e.cameraPosition),C=Er.WGS84.cartographicToCartesian(T,new Bt),R=new Bt(c.transformAsVector(new Bt(r).scale(d))).normalize(),L=new Bt(c.transformAsVector(new Bt(n).scale(d))).normalize();H6(e);const V=e.constructor,{longitude:X,latitude:at,width:nt,bearing:K,zoom:It}=e,St=new V({longitude:X,latitude:at,height:a,width:nt,bearing:K,zoom:It,pitch:0});return{camera:{position:C,direction:R,up:L},viewport:e,topDownViewport:St,height:a,cullingVolume:wy,frameNumber:t,sseDenominator:1.15}}function j6(e,t,r){if(r===0||e.length<=r)return[e,[]];const n=[],{longitude:a,latitude:d}=t.viewport;for(const[C,R]of e.entries()){const[L,V]=R.header.mbs,X=Math.abs(a-L),at=Math.abs(d-V),nt=Math.sqrt(at*at+X*X);n.push([C,nt])}const f=n.sort((C,R)=>C[1]-R[1]),c=[];for(let C=0;C<r;C++)c.push(e[f[C][0]]);const T=[];for(let C=r;C<f.length;C++)T.push(e[f[C][0]]);return[c,T]}function H6(e){const t=e.getFrustumPlanes(),r=FT(t.near,e.cameraPosition),n=pp(e,r),a=pp(e,e.cameraPosition,xy);let d=0;wy.planes[d++].fromPointNormal(n,DT.copy(n).subtract(a));for(const f in t){if(f==="near")continue;const c=t[f],T=FT(c,r,xy),C=pp(e,T,xy);wy.planes[d++].fromPointNormal(C,DT.copy(n).subtract(C))}}function FT(e,t,r=new Bt){const n=e.normal.dot(t);return r.copy(e.normal).scale(e.distance-n).add(t),r}function pp(e,t,r=new Bt){const n=e.unprojectPosition(t);return Er.WGS84.cartographicToCartesian(n,r)}const G6=6378137,$6=6378137,Ty=6356752314245179e-9,Oc=new Bt;function W6(e,t){if(e instanceof Ph){const{halfAxes:r}=e,n=q6(r);return Math.log2(Ty/(n+t[2]))}else if(e instanceof Rh){const{radius:r}=e;return Math.log2(Ty/(r+t[2]))}else if(e.width&&e.height){const{width:r,height:n}=e,a=Math.log2(G6/r),d=Math.log2($6/n);return(a+d)/2}return 1}function OT(e,t,r){Er.WGS84.cartographicToCartesian([e.xmax,e.ymax,e.zmax],Oc);const n=Math.sqrt(Math.pow(Oc[0]-r[0],2)+Math.pow(Oc[1]-r[1],2)+Math.pow(Oc[2]-r[2],2));return Math.log2(Ty/(n+t[2]))}function X6(e,t,r){const[n,a,d,f]=e;return OT({xmax:d,ymax:f,zmax:0},t,r)}function q6(e){e.getColumn(0,Oc);const t=e.getColumn(1),r=e.getColumn(2);return Oc.add(t).add(r).len()}const Ds={UNLOADED:0,LOADING:1,PROCESSING:2,READY:3,EXPIRED:4,FAILED:5};var Rn;(function(e){e[e.ADD=1]="ADD",e[e.REPLACE=2]="REPLACE"})(Rn||(Rn={}));var Mo;(function(e){e.EMPTY="empty",e.SCENEGRAPH="scenegraph",e.POINTCLOUD="pointcloud",e.MESH="mesh"})(Mo||(Mo={}));var ms;(function(e){e.I3S="I3S",e.TILES3D="TILES3D"})(ms||(ms={}));var kc;(function(e){e.GEOMETRIC_ERROR="geometricError",e.MAX_SCREEN_THRESHOLD="maxScreenThreshold"})(kc||(kc={}));const Z6={USE_OPTIMIZATION:1};function kT(e){return e!=null}const Ji=new Bt,_p=new Bt,Y6=new Bt,K6=new Bt,al=new Bt,NT=new Bt,LT=new Bt,UT=new Bt;function Ay(e,t,r){if(Ar(e,"3D Tile: boundingVolume must be defined"),e.box)return zT(e.box,t,r);if(e.region)return t5(e.region);if(e.sphere)return Q6(e.sphere,t,r);throw new Error("3D Tile: boundingVolume must contain a sphere, region, or box")}function J6(e,t){if(e.box)return e5(t);if(e.region){const[r,n,a,d,f,c]=e.region;return[[xn(r),xn(n),f],[xn(a),xn(d),c]]}if(e.sphere)return r5(t);throw new Error("Unkown boundingVolume type")}function zT(e,t,r){const n=new Bt(e[0],e[1],e[2]);t.transform(n,n);let a=[];if(e.length===10){const C=e.slice(3,6),R=new ch;R.fromArray(e,6);const L=new Bt([1,0,0]),V=new Bt([0,1,0]),X=new Bt([0,0,1]);L.transformByQuaternion(R),L.scale(C[0]),V.transformByQuaternion(R),V.scale(C[1]),X.transformByQuaternion(R),X.scale(C[2]),a=[...L.toArray(),...V.toArray(),...X.toArray()]}else a=[...e.slice(3,6),...e.slice(6,9),...e.slice(9,12)];const d=t.transformAsVector(a.slice(0,3)),f=t.transformAsVector(a.slice(3,6)),c=t.transformAsVector(a.slice(6,9)),T=new Xr([d[0],d[1],d[2],f[0],f[1],f[2],c[0],c[1],c[2]]);return kT(r)?(r.center=n,r.halfAxes=T,r):new Ph(n,T)}function Q6(e,t,r){const n=new Bt(e[0],e[1],e[2]);t.transform(n,n);const a=t.getScale(_p),d=Math.max(Math.max(a[0],a[1]),a[2]),f=e[3]*d;return kT(r)?(r.center=n,r.radius=f,r):new Rh(n,f)}function t5(e){const[t,r,n,a,d,f]=e,c=Er.WGS84.cartographicToCartesian([xn(t),xn(a),d],Y6),T=Er.WGS84.cartographicToCartesian([xn(n),xn(r),f],K6),C=new Bt().addVectors(c,T).multiplyByScalar(.5);return Er.WGS84.cartesianToCartographic(C,al),Er.WGS84.cartographicToCartesian([xn(n),al[1],al[2]],NT),Er.WGS84.cartographicToCartesian([al[0],xn(a),al[2]],LT),Er.WGS84.cartographicToCartesian([al[0],al[1],f],UT),zT([...C,...NT.subtract(C),...LT.subtract(C),...UT.subtract(C)],new He)}function e5(e){const t=VT(),{halfAxes:r}=e,n=new Bt(r.getColumn(0)),a=new Bt(r.getColumn(1)),d=new Bt(r.getColumn(2));for(let f=0;f<2;f++){for(let c=0;c<2;c++){for(let T=0;T<2;T++)Ji.copy(e.center),Ji.add(n),Ji.add(a),Ji.add(d),jT(t,Ji),d.negate();a.negate()}n.negate()}return t}function r5(e){const t=VT(),{center:r,radius:n}=e,a=Er.WGS84.scaleToGeodeticSurface(r,Ji);let d;a?d=Er.WGS84.geodeticSurfaceNormal(a):d=new Bt(0,0,1);let f=new Bt(d[2],-d[1],0);f.len()>0?f.normalize():f=new Bt(0,1,0);const c=f.clone().cross(d);for(const T of[f,c,d]){_p.copy(T).scale(n);for(let C=0;C<2;C++)Ji.copy(r),Ji.add(_p),jT(t,Ji),_p.negate()}return t}function VT(){return[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]]}function jT(e,t){Er.WGS84.cartesianToCartographic(t,Ji),e[0][0]=Math.min(e[0][0],Ji[0]),e[0][1]=Math.min(e[0][1],Ji[1]),e[0][2]=Math.min(e[0][2],Ji[2]),e[1][0]=Math.max(e[1][0],Ji[0]),e[1][1]=Math.max(e[1][1],Ji[1]),e[1][2]=Math.max(e[1][2],Ji[2])}new Bt,new Bt,new He,new Bt,new Bt,new Bt;function i5(e,t){const r=e*t;return 1-Math.exp(-(r*r))}function s5(e,t){if(e.dynamicScreenSpaceError&&e.dynamicScreenSpaceErrorComputedDensity){const r=e.dynamicScreenSpaceErrorComputedDensity,n=e.dynamicScreenSpaceErrorFactor;return i5(t,r)*n}return 0}function n5(e,t,r){const n=e.tileset,a=e.parent&&e.parent.lodMetricValue||e.lodMetricValue,d=r?a:e.lodMetricValue;if(d===0)return 0;const f=Math.max(e._distanceToCamera,1e-7),{height:c,sseDenominator:T}=t,{viewDistanceScale:C}=n.options;let R=d*c*(C||1)/(f*T);return R-=s5(n,f),R}const Ey=new Bt,HT=new Bt,pa=new Bt,GT=new Bt,o5=new Bt,Sy=new He,$T=new He;function a5(e,t){if(e.lodMetricValue===0||isNaN(e.lodMetricValue))return"DIG";const r=2*WT(e,t);return r<2?"OUT":!e.header.children||r<=e.lodMetricValue?"DRAW":e.header.children?"DIG":"OUT"}function WT(e,t){const{topDownViewport:r}=t,n=e.header.mbs[1],a=e.header.mbs[0],d=e.header.mbs[2],f=e.header.mbs[3],c=[...e.boundingVolume.center],T=r.unprojectPosition(r.cameraPosition);Er.WGS84.cartographicToCartesian(T,Ey),HT.copy(Ey).subtract(c).normalize(),Er.WGS84.eastNorthUpToFixedFrame(c,Sy),$T.copy(Sy).invert(),pa.copy(Ey).transform($T);const C=Math.sqrt(pa[0]*pa[0]+pa[1]*pa[1]),R=C*C/pa[2];GT.copy([pa[0],pa[1],R]);const V=GT.transform(Sy).subtract(c).normalize(),at=HT.cross(V).normalize().scale(f).add(c),nt=Er.WGS84.cartesianToCartographic(at),K=r.project([a,n,d]),It=r.project(nt);return o5.copy(K).subtract(It).magnitude()}function l5(e){return{assetGltfUpAxis:e.asset&&e.asset.gltfUpAxis||"Y"}}class XT{_map=new Map;_array;_length;constructor(t=0){this._array=new Array(t),this._length=t}get length(){return this._length}set length(t){this._length=t,t>this._array.length&&(this._array.length=t)}get values(){return this._array}get(t){return Ar(t<this._array.length),this._array[t]}set(t,r){Ar(t>=0),t>=this.length&&(this.length=t+1),this._map.has(this._array[t])&&this._map.delete(this._array[t]),this._array[t]=r,this._map.set(r,t)}delete(t){const r=this._map.get(t);r>=0&&(this._array.splice(r,1),this._map.delete(t),this.length--)}peek(){return this._array[this._length-1]}push(t){if(!this._map.has(t)){const r=this.length++;this._array[r]=t,this._map.set(t,r)}}pop(){const t=this._array[--this.length];return this._map.delete(t),t}reserve(t){Ar(t>=0),t>this._array.length&&(this._array.length=t)}resize(t){Ar(t>=0),this.length=t}trim(t){t==null&&(t=this.length),this._array.length=t}reset(){this._array=[],this._map=new Map,this._length=0}find(t){return this._map.has(t)}}const c5={loadSiblings:!1,skipLevelOfDetail:!1,updateTransforms:!0,onTraversalEnd:()=>{},viewportTraversersMap:{},basePath:""};class gp{options;root=null;selectedTiles={};requestedTiles={};emptyTiles={};lastUpdate=new Date().getTime();updateDebounceTime=1e3;_traversalStack=new XT;_emptyTraversalStack=new XT;_frameNumber=null;traversalFinished(t){return!0}constructor(t){this.options={...c5,...t}}traverse(t,r,n){this.root=t,this.options={...this.options,...n},this.reset(),this.updateTile(t,r),this._frameNumber=r.frameNumber,this.executeTraversal(t,r)}reset(){this.requestedTiles={},this.selectedTiles={},this.emptyTiles={},this._traversalStack.reset(),this._emptyTraversalStack.reset()}executeTraversal(t,r){const n=this._traversalStack;for(t._selectionDepth=1,n.push(t);n.length>0;){const d=n.pop();let f=!1;this.canTraverse(d,r)&&(this.updateChildTiles(d,r),f=this.updateAndPushChildren(d,r,n,d.hasRenderContent?d._selectionDepth+1:d._selectionDepth));const c=d.parent,T=!!(!c||c._shouldRefine),C=!f;d.hasRenderContent?d.refine===Rn.ADD?(this.loadTile(d,r),this.selectTile(d,r)):d.refine===Rn.REPLACE&&(this.loadTile(d,r),C&&this.selectTile(d,r)):(this.emptyTiles[d.id]=d,this.loadTile(d,r),C&&this.selectTile(d,r)),this.touchTile(d,r),d._shouldRefine=f&&T}const a=new Date().getTime();(this.traversalFinished(r)||a-this.lastUpdate>this.updateDebounceTime)&&(this.lastUpdate=a,this.options.onTraversalEnd(r))}updateChildTiles(t,r){const n=t.children;for(const a of n)this.updateTile(a,r)}updateAndPushChildren(t,r,n,a){const{loadSiblings:d,skipLevelOfDetail:f}=this.options,c=t.children;c.sort(this.compareDistanceToCamera.bind(this));const T=t.refine===Rn.REPLACE&&t.hasRenderContent&&!f;let C=!1,R=!0;for(const L of c)if(L._selectionDepth=a,L.isVisibleAndInRequestVolume?(n.find(L)&&n.delete(L),n.push(L),C=!0):(T||d)&&(this.loadTile(L,r),this.touchTile(L,r)),T){let V;if(L._inRequestVolume?L.hasRenderContent?V=L.contentAvailable:V=this.executeEmptyTraversal(L,r):V=!1,R=R&&V,!R)return!1}return C||(R=!1),R}updateTile(t,r){this.updateTileVisibility(t,r)}selectTile(t,r){this.shouldSelectTile(t)&&(t._selectedFrame=r.frameNumber,this.selectedTiles[t.id]=t)}loadTile(t,r){this.shouldLoadTile(t)&&(t._requestedFrame=r.frameNumber,t._priority=t._getPriority(),this.requestedTiles[t.id]=t)}touchTile(t,r){t.tileset._cache.touch(t),t._touchedFrame=r.frameNumber}canTraverse(t,r){return t.hasChildren?t.hasTilesetContent?!t.contentExpired:this.shouldRefine(t,r):!1}shouldLoadTile(t){return t.hasUnloadedContent||t.contentExpired}shouldSelectTile(t){return t.contentAvailable&&!this.options.skipLevelOfDetail}shouldRefine(t,r,n=!1){let a=t._screenSpaceError;return n&&(a=t.getScreenSpaceError(r,!0)),a>t.tileset.memoryAdjustedScreenSpaceError}updateTileVisibility(t,r){const n=[];if(this.options.viewportTraversersMap)for(const a in this.options.viewportTraversersMap)this.options.viewportTraversersMap[a]===r.viewport.id&&n.push(a);else n.push(r.viewport.id);t.updateVisibility(r,n)}compareDistanceToCamera(t,r){return t._distanceToCamera-r._distanceToCamera}anyChildrenVisible(t,r){let n=!1;for(const a of t.children)a.updateVisibility(r),n=n||a.isVisibleAndInRequestVolume;return n}executeEmptyTraversal(t,r){let n=!0;const a=this._emptyTraversalStack;for(a.push(t);a.length>0;){const d=a.pop(),f=!d.hasRenderContent&&this.canTraverse(d,r),c=!d.hasRenderContent&&d.children.length===0;if(!f&&!d.contentAvailable&&!c&&(n=!1),this.updateTile(d,r),d.isVisibleAndInRequestVolume||(this.loadTile(d,r),this.touchTile(d,r)),f){const T=d.children;for(const C of T)a.push(C)}}return n}}const qT=new Bt;function u5(e){return e!=null}class Cy{tileset;header;id;url;parent;refine;type;contentUrl;lodMetricType="geometricError";lodMetricValue=0;boundingVolume=null;content=null;contentState=Ds.UNLOADED;gpuMemoryUsageInBytes=0;children=[];depth=0;viewportIds=[];transform=new He;extensions=null;implicitTiling=null;userData={};computedTransform;hasEmptyContent=!1;hasTilesetContent=!1;traverser=new gp({});_cacheNode=null;_frameNumber=null;_expireDate=null;_expiredContent=null;_boundingBox=void 0;_distanceToCamera=0;_screenSpaceError=0;_visibilityPlaneMask;_visible=void 0;_contentBoundingVolume;_viewerRequestVolume;_initialTransform=new He;_priority=0;_selectedFrame=0;_requestedFrame=0;_selectionDepth=0;_touchedFrame=0;_centerZDepth=0;_shouldRefine=!1;_stackLength=0;_visitedFrame=0;_inRequestVolume=!1;_lodJudge=null;constructor(t,r,n,a=""){this.header=r,this.tileset=t,this.id=a||r.id,this.url=r.url,this.parent=n,this.refine=this._getRefine(r.refine),this.type=r.type,this.contentUrl=r.contentUrl,this._initializeLodMetric(r),this._initializeTransforms(r),this._initializeBoundingVolumes(r),this._initializeContent(r),this._initializeRenderingState(r),Object.seal(this)}destroy(){this.header=null}isDestroyed(){return this.header===null}get selected(){return this._selectedFrame===this.tileset._frameNumber}get isVisible(){return this._visible}get isVisibleAndInRequestVolume(){return this._visible&&this._inRequestVolume}get hasRenderContent(){return!this.hasEmptyContent&&!this.hasTilesetContent}get hasChildren(){return this.children.length>0||this.header.children&&this.header.children.length>0}get contentReady(){return this.contentState===Ds.READY||this.hasEmptyContent}get contentAvailable(){return!!(this.contentReady&&this.hasRenderContent||this._expiredContent&&!this.contentFailed)}get hasUnloadedContent(){return this.hasRenderContent&&this.contentUnloaded}get contentUnloaded(){return this.contentState===Ds.UNLOADED}get contentExpired(){return this.contentState===Ds.EXPIRED}get contentFailed(){return this.contentState===Ds.FAILED}get distanceToCamera(){return this._distanceToCamera}get screenSpaceError(){return this._screenSpaceError}get boundingBox(){return this._boundingBox||(this._boundingBox=J6(this.header.boundingVolume,this.boundingVolume)),this._boundingBox}getScreenSpaceError(t,r){switch(this.tileset.type){case ms.I3S:return WT(this,t);case ms.TILES3D:return n5(this,t,r);default:throw new Error("Unsupported tileset type")}}unselect(){this._selectedFrame=0}_getGpuMemoryUsageInBytes(){return this.content.gpuMemoryUsageInBytes||this.content.byteLength||0}_getPriority(){const t=this.tileset._traverser,{skipLevelOfDetail:r}=t.options,n=this.refine===Rn.ADD||r;if(n&&!this.isVisible&&this._visible!==void 0||this.tileset._frameNumber-this._touchedFrame>=1||this.contentState===Ds.UNLOADED)return-1;const a=this.parent,f=a&&(!n||this._screenSpaceError===0||a.hasTilesetContent)?a._screenSpaceError:this._screenSpaceError,c=t.root?t.root._screenSpaceError:0;return Math.max(c-f,0)}async loadContent(){if(this.hasEmptyContent)return!1;if(this.content)return!0;this.contentExpired&&(this._expireDate=null),this.contentState=Ds.LOADING;const r=await this.tileset._requestScheduler.scheduleRequest(this.id,this._getPriority.bind(this));if(!r)return this.contentState=Ds.UNLOADED,!1;try{const n=this.tileset.getTileUrl(this.contentUrl),a=this.tileset.loader,d={...this.tileset.loadOptions,[a.id]:{...this.tileset.loadOptions[a.id],isTileset:this.type==="json",...this._getLoaderSpecificOptions(a.id)}};return this.content=await Ko(n,a,d),this.tileset.options.contentLoader&&await this.tileset.options.contentLoader(this),this._isTileset()&&this.tileset._initializeTileHeaders(this.content,this),this.contentState=Ds.READY,this._onContentLoaded(),!0}catch(n){throw this.contentState=Ds.FAILED,n}finally{r.done()}}unloadContent(){return this.content&&this.content.destroy&&this.content.destroy(),this.content=null,this.header.content&&this.header.content.destroy&&this.header.content.destroy(),this.header.content=null,this.contentState=Ds.UNLOADED,!0}updateVisibility(t,r){if(this._frameNumber===t.frameNumber)return;const n=this.parent,a=n?n._visibilityPlaneMask:an.MASK_INDETERMINATE;if(this.tileset._traverser.options.updateTransforms){const d=n?n.computedTransform:this.tileset.modelMatrix;this._updateTransform(d)}this._distanceToCamera=this.distanceToTile(t),this._screenSpaceError=this.getScreenSpaceError(t,!1),this._visibilityPlaneMask=this.visibility(t,a),this._visible=this._visibilityPlaneMask!==an.MASK_OUTSIDE,this._inRequestVolume=this.insideViewerRequestVolume(t),this._frameNumber=t.frameNumber,this.viewportIds=r}visibility(t,r){const{cullingVolume:n}=t,{boundingVolume:a}=this;return n.computeVisibilityWithPlaneMask(a,r)}contentVisibility(){return!0}distanceToTile(t){const r=this.boundingVolume;return Math.sqrt(Math.max(r.distanceSquaredTo(t.camera.position),0))}cameraSpaceZDepth({camera:t}){const r=this.boundingVolume;return qT.subVectors(r.center,t.position),t.direction.dot(qT)}insideViewerRequestVolume(t){const r=this._viewerRequestVolume;return!r||r.distanceSquaredTo(t.camera.position)<=0}updateExpiration(){if(u5(this._expireDate)&&this.contentReady&&!this.hasEmptyContent){const t=Date.now();Date.lessThan(this._expireDate,t)&&(this.contentState=Ds.EXPIRED,this._expiredContent=this.content)}}get extras(){return this.header.extras}_initializeLodMetric(t){"lodMetricType"in t?this.lodMetricType=t.lodMetricType:(this.lodMetricType=this.parent&&this.parent.lodMetricType||this.tileset.lodMetricType,console.warn("3D Tile: Required prop lodMetricType is undefined. Using parent lodMetricType")),"lodMetricValue"in t?this.lodMetricValue=t.lodMetricValue:(this.lodMetricValue=this.parent&&this.parent.lodMetricValue||this.tileset.lodMetricValue,console.warn("3D Tile: Required prop lodMetricValue is undefined. Using parent lodMetricValue"))}_initializeTransforms(t){this.transform=t.transform?new He(t.transform):new He;const r=this.parent,n=this.tileset,a=r&&r.computedTransform?r.computedTransform.clone():n.modelMatrix.clone();this.computedTransform=new He(a).multiplyRight(this.transform);const d=r&&r._initialTransform?r._initialTransform.clone():new He;this._initialTransform=new He(d).multiplyRight(this.transform)}_initializeBoundingVolumes(t){this._contentBoundingVolume=null,this._viewerRequestVolume=null,this._updateBoundingVolume(t)}_initializeContent(t){this.content={_tileset:this.tileset,_tile:this},this.hasEmptyContent=!0,this.contentState=Ds.UNLOADED,this.hasTilesetContent=!1,t.contentUrl&&(this.content=null,this.hasEmptyContent=!1)}_initializeRenderingState(t){this.depth=t.level||(this.parent?this.parent.depth+1:0),this._shouldRefine=!1,this._distanceToCamera=0,this._centerZDepth=0,this._screenSpaceError=0,this._visibilityPlaneMask=an.MASK_INDETERMINATE,this._visible=void 0,this._inRequestVolume=!1,this._stackLength=0,this._selectionDepth=0,this._frameNumber=0,this._touchedFrame=0,this._visitedFrame=0,this._selectedFrame=0,this._requestedFrame=0,this._priority=0}_getRefine(t){return t||this.parent&&this.parent.refine||Rn.REPLACE}_isTileset(){return this.contentUrl.indexOf(".json")!==-1}_onContentLoaded(){switch(this.content&&this.content.type){case"vctr":case"geom":this.tileset._traverser.disableSkipLevelOfDetail=!0;break}this._isTileset()?this.hasTilesetContent=!0:this.gpuMemoryUsageInBytes=this._getGpuMemoryUsageInBytes()}_updateBoundingVolume(t){this.boundingVolume=Ay(t.boundingVolume,this.computedTransform,this.boundingVolume);const r=t.content;r&&(r.boundingVolume&&(this._contentBoundingVolume=Ay(r.boundingVolume,this.computedTransform,this._contentBoundingVolume)),t.viewerRequestVolume&&(this._viewerRequestVolume=Ay(t.viewerRequestVolume,this.computedTransform,this._viewerRequestVolume)))}_updateTransform(t=new He){const r=t.clone().multiplyRight(this.transform);r.equals(this.computedTransform)||(this.computedTransform=r,this._updateBoundingVolume(this.header))}_getLoaderSpecificOptions(t){switch(t){case"i3s":return{...this.tileset.options.i3s,_tileOptions:{attributeUrls:this.header.attributeUrls,textureUrl:this.header.textureUrl,textureFormat:this.header.textureFormat,textureLoaderOptions:this.header.textureLoaderOptions,materialDefinition:this.header.materialDefinition,isDracoGeometry:this.header.isDracoGeometry,mbs:this.header.mbs},_tilesetOptions:{store:this.tileset.tileset.store,attributeStorageInfo:this.tileset.tileset.attributeStorageInfo,fields:this.tileset.tileset.fields},isTileHeader:!1};case"3d-tiles":case"cesium-ion":default:return l5(this.tileset.tileset)}}}class h5 extends gp{compareDistanceToCamera(t,r){return r._distanceToCamera===0&&t._distanceToCamera===0?r._centerZDepth-t._centerZDepth:r._distanceToCamera-t._distanceToCamera}updateTileVisibility(t,r){if(super.updateTileVisibility(t,r),!t.isVisibleAndInRequestVolume)return;const n=t.children.length>0;if(t.hasTilesetContent&&n){const f=t.children[0];this.updateTileVisibility(f,r),t._visible=f._visible;return}if(this.meetsScreenSpaceErrorEarly(t,r)){t._visible=!1;return}const a=t.refine===Rn.REPLACE,d=t._optimChildrenWithinParent===Z6.USE_OPTIMIZATION;if(a&&d&&n&&!this.anyChildrenVisible(t,r)){t._visible=!1;return}}meetsScreenSpaceErrorEarly(t,r){const{parent:n}=t;return!n||n.hasTilesetContent||n.refine!==Rn.ADD?!1:!this.shouldRefine(t,r,!0)}}class d5{frameNumberMap=new Map;register(t,r){const n=this.frameNumberMap.get(t)||new Map,a=n.get(r)||0;n.set(r,a+1),this.frameNumberMap.set(t,n)}deregister(t,r){const n=this.frameNumberMap.get(t);if(!n)return;const a=n.get(r)||1;n.set(r,a-1)}isZero(t,r){return(this.frameNumberMap.get(t)?.get(r)||0)===0}}const Iy={REQUESTED:"REQUESTED",COMPLETED:"COMPLETED",ERROR:"ERROR"};class f5{_statusMap;pendingTilesRegister=new d5;constructor(){this._statusMap={}}add(t,r,n,a){if(!this._statusMap[r]){const{frameNumber:d,viewport:{id:f}}=a;this._statusMap[r]={request:t,callback:n,key:r,frameState:a,status:Iy.REQUESTED},this.pendingTilesRegister.register(f,d),t().then(c=>{this._statusMap[r].status=Iy.COMPLETED;const{frameNumber:T,viewport:{id:C}}=this._statusMap[r].frameState;this.pendingTilesRegister.deregister(C,T),this._statusMap[r].callback(c,a)}).catch(c=>{this._statusMap[r].status=Iy.ERROR;const{frameNumber:T,viewport:{id:C}}=this._statusMap[r].frameState;this.pendingTilesRegister.deregister(C,T),n(c)})}}update(t,r){if(this._statusMap[t]){const{frameNumber:n,viewport:{id:a}}=this._statusMap[t].frameState;this.pendingTilesRegister.deregister(a,n);const{frameNumber:d,viewport:{id:f}}=r;this.pendingTilesRegister.register(f,d),this._statusMap[t].frameState=r}}find(t){return this._statusMap[t]}hasPendingTiles(t,r){return!this.pendingTilesRegister.isZero(t,r)}}class p5 extends gp{_tileManager;constructor(t){super(t),this._tileManager=new f5}traversalFinished(t){return!this._tileManager.hasPendingTiles(t.viewport.id,this._frameNumber||0)}shouldRefine(t,r){return t._lodJudge=a5(t,r),t._lodJudge==="DIG"}updateChildTiles(t,r){const n=t.header.children||[],a=t.children,d=t.tileset;for(const f of n){const c=`${f.id}-${r.viewport.id}`,T=a&&a.find(C=>C.id===c);if(T)T&&this.updateTile(T,r);else{let C=()=>this._loadTile(f.id,d);this._tileManager.find(c)?this._tileManager.update(c,r):(d.tileset.nodePages&&(C=()=>d.tileset.nodePagesTile.formTileFromNodePages(f.id)),this._tileManager.add(C,c,L=>this._onTileLoad(L,t,c),r))}}return!1}async _loadTile(t,r){const{loader:n}=r,a=r.getTileUrl(`${r.url}/nodes/${t}`),d={...r.loadOptions,i3s:{...r.loadOptions.i3s,isTileHeader:!0}};return await Ko(a,n,d)}_onTileLoad(t,r,n){const a=new Cy(r.tileset,t,r,n);r.children.push(a);const d=this._tileManager.find(a.id).frameState;this.updateTile(a,d),this._frameNumber===d.frameNumber&&(this.traversalFinished(d)||new Date().getTime()-this.lastUpdate>this.updateDebounceTime)&&this.executeTraversal(a,d)}}const _5={description:"",ellipsoid:Er.WGS84,modelMatrix:new He,throttleRequests:!0,maxRequests:64,maximumMemoryUsage:32,memoryCacheOverflow:1,maximumTilesSelected:0,debounceTime:0,onTileLoad:()=>{},onTileUnload:()=>{},onTileError:()=>{},onTraversalComplete:e=>e,contentLoader:void 0,viewDistanceScale:1,maximumScreenSpaceError:8,memoryAdjustedScreenSpaceError:!1,loadTiles:!0,updateTransforms:!0,viewportTraversersMap:null,loadOptions:{fetch:{}},attributions:[],basePath:"",i3s:{}},mp="Tiles In Tileset(s)",My="Tiles In Memory",ZT="Tiles In View",YT="Tiles To Render",KT="Tiles Loaded",Ry="Tiles Loading",JT="Tiles Unloaded",QT="Failed Tile Loads",tA="Points/Vertices",Py="Tile Memory Use",eA="Maximum Screen Space Error";class g5{options;loadOptions;type;tileset;loader;url;basePath;modelMatrix;ellipsoid;lodMetricType;lodMetricValue;refine;root=null;roots={};asset={};description="";properties;extras=null;attributions={};credits={};stats;contentFormats={draco:!1,meshopt:!1,dds:!1,ktx2:!1};cartographicCenter=null;cartesianCenter=null;zoom=1;boundingVolume=null;dynamicScreenSpaceErrorComputedDensity=0;maximumMemoryUsage=32;gpuMemoryUsageInBytes=0;memoryAdjustedScreenSpaceError=0;_cacheBytes=0;_cacheOverflowBytes=0;_frameNumber=0;_queryParams={};_extensionsUsed=[];_tiles={};_pendingCount=0;selectedTiles=[];traverseCounter=0;geometricError=0;lastUpdatedVieports=null;_requestedTiles=[];_emptyTiles=[];frameStateData={};_traverser;_cache=new U6;_requestScheduler;updatePromise=null;tilesetInitializationPromise;constructor(t,r){this.options={..._5,...r},this.tileset=t,this.loader=t.loader,this.type=t.type,this.url=t.url,this.basePath=t.basePath||ig(this.url),this.modelMatrix=this.options.modelMatrix,this.ellipsoid=this.options.ellipsoid,this.lodMetricType=t.lodMetricType,this.lodMetricValue=t.lodMetricValue,this.refine=t.root.refine,this.loadOptions=this.options.loadOptions||{},this._traverser=this._initializeTraverser(),this._requestScheduler=new YC({throttleRequests:this.options.throttleRequests,maxRequests:this.options.maxRequests}),this.memoryAdjustedScreenSpaceError=this.options.maximumScreenSpaceError,this._cacheBytes=this.options.maximumMemoryUsage*1024*1024,this._cacheOverflowBytes=this.options.memoryCacheOverflow*1024*1024,this.stats=new sc({id:this.url}),this._initializeStats(),this.tilesetInitializationPromise=this._initializeTileSet(t)}destroy(){this._destroy()}isLoaded(){return this._pendingCount===0&&this._frameNumber!==0&&this._requestedTiles.length===0}get tiles(){return Object.values(this._tiles)}get frameNumber(){return this._frameNumber}get queryParams(){return new URLSearchParams(this._queryParams).toString()}setProps(t){this.options={...this.options,...t}}getTileUrl(t){if(t.startsWith("data:"))return t;let n=t;return this.queryParams.length&&(n=`${t}${t.includes("?")?"&":"?"}${this.queryParams}`),n}hasExtension(t){return this._extensionsUsed.indexOf(t)>-1}update(t=null){this.tilesetInitializationPromise.then(()=>{!t&&this.lastUpdatedVieports?t=this.lastUpdatedVieports:this.lastUpdatedVieports=t,t&&this.doUpdate(t)})}async selectTiles(t=null){return await this.tilesetInitializationPromise,t&&(this.lastUpdatedVieports=t),this.updatePromise||(this.updatePromise=new Promise(r=>{setTimeout(()=>{this.lastUpdatedVieports&&this.doUpdate(this.lastUpdatedVieports),r(this._frameNumber),this.updatePromise=null},this.options.debounceTime)})),this.updatePromise}adjustScreenSpaceError(){this.gpuMemoryUsageInBytes<this._cacheBytes?this.memoryAdjustedScreenSpaceError=Math.max(this.memoryAdjustedScreenSpaceError/1.02,this.options.maximumScreenSpaceError):this.gpuMemoryUsageInBytes>this._cacheBytes+this._cacheOverflowBytes&&(this.memoryAdjustedScreenSpaceError*=1.02)}doUpdate(t){if("loadTiles"in this.options&&!this.options.loadTiles||this.traverseCounter>0)return;const r=t instanceof Array?t:[t];this._cache.reset(),this._frameNumber++,this.traverseCounter=r.length;const n=[];for(const a of r){const d=a.id;this._needTraverse(d)?n.push(d):this.traverseCounter--}for(const a of r){const d=a.id;if(this.roots[d]||(this.roots[d]=this._initializeTileHeaders(this.tileset,null)),!n.includes(d))continue;const f=V6(a,this._frameNumber);this._traverser.traverse(this.roots[d],f,this.options)}}_needTraverse(t){let r=t;return this.options.viewportTraversersMap&&(r=this.options.viewportTraversersMap[t]),r===t}_onTraversalEnd(t){const r=t.viewport.id;this.frameStateData[r]||(this.frameStateData[r]={selectedTiles:[],_requestedTiles:[],_emptyTiles:[]});const n=this.frameStateData[r],a=Object.values(this._traverser.selectedTiles),[d,f]=j6(a,t,this.options.maximumTilesSelected);n.selectedTiles=d;for(const c of f)c.unselect();n._requestedTiles=Object.values(this._traverser.requestedTiles),n._emptyTiles=Object.values(this._traverser.emptyTiles),this.traverseCounter--,!(this.traverseCounter>0)&&this._updateTiles()}_updateTiles(){this.selectedTiles=[],this._requestedTiles=[],this._emptyTiles=[];for(const t in this.frameStateData){const r=this.frameStateData[t];this.selectedTiles=this.selectedTiles.concat(r.selectedTiles),this._requestedTiles=this._requestedTiles.concat(r._requestedTiles),this._emptyTiles=this._emptyTiles.concat(r._emptyTiles)}this.selectedTiles=this.options.onTraversalComplete(this.selectedTiles);for(const t of this.selectedTiles)this._tiles[t.id]=t;this._loadTiles(),this._unloadTiles(),this._updateStats()}_tilesChanged(t,r){if(t.length!==r.length)return!0;const n=new Set(t.map(f=>f.id)),a=new Set(r.map(f=>f.id));let d=t.filter(f=>!a.has(f.id)).length>0;return d=d||r.filter(f=>!n.has(f.id)).length>0,d}_loadTiles(){for(const t of this._requestedTiles)t.contentUnloaded&&this._loadTile(t)}_unloadTiles(){this._cache.unloadTiles(this,(t,r)=>t._unloadTile(r))}_updateStats(){let t=0,r=0;for(const n of this.selectedTiles)n.contentAvailable&&n.content&&(t++,n.content.pointCount?r+=n.content.pointCount:r+=n.content.vertexCount);this.stats.get(ZT).count=this.selectedTiles.length,this.stats.get(YT).count=t,this.stats.get(tA).count=r,this.stats.get(eA).count=this.memoryAdjustedScreenSpaceError}async _initializeTileSet(t){this.type===ms.I3S&&(this.calculateViewPropsI3S(),t.root=await t.root),this.root=this._initializeTileHeaders(t,null),this.type===ms.TILES3D&&(this._initializeTiles3DTileset(t),this.calculateViewPropsTiles3D()),this.type===ms.I3S&&this._initializeI3STileset()}calculateViewPropsI3S(){const t=this.tileset.fullExtent;if(t){const{xmin:n,xmax:a,ymin:d,ymax:f,zmin:c,zmax:T}=t;this.cartographicCenter=new Bt(n+(a-n)/2,d+(f-d)/2,c+(T-c)/2),this.cartesianCenter=new Bt,Er.WGS84.cartographicToCartesian(this.cartographicCenter,this.cartesianCenter),this.zoom=OT(t,this.cartographicCenter,this.cartesianCenter);return}const r=this.tileset.store?.extent;if(r){const[n,a,d,f]=r;this.cartographicCenter=new Bt(n+(d-n)/2,a+(f-a)/2,0),this.cartesianCenter=new Bt,Er.WGS84.cartographicToCartesian(this.cartographicCenter,this.cartesianCenter),this.zoom=X6(r,this.cartographicCenter,this.cartesianCenter);return}console.warn("Extent is not defined in the tileset header"),this.cartographicCenter=new Bt,this.zoom=1}calculateViewPropsTiles3D(){const t=this.root,{center:r}=t.boundingVolume;if(!r){console.warn("center was not pre-calculated for the root tile"),this.cartographicCenter=new Bt,this.zoom=1;return}r[0]!==0||r[1]!==0||r[2]!==0?(this.cartographicCenter=new Bt,Er.WGS84.cartesianToCartographic(r,this.cartographicCenter)):this.cartographicCenter=new Bt(0,0,-Er.WGS84.radii[0]),this.cartesianCenter=r,this.zoom=W6(t.boundingVolume,this.cartographicCenter)}_initializeStats(){this.stats.get(mp),this.stats.get(Ry),this.stats.get(My),this.stats.get(ZT),this.stats.get(YT),this.stats.get(KT),this.stats.get(JT),this.stats.get(QT),this.stats.get(tA),this.stats.get(Py,"memory"),this.stats.get(eA)}_initializeTileHeaders(t,r){const n=new Cy(this,t.root,r);if(r&&(r.children.push(n),n.depth=r.depth+1),this.type===ms.TILES3D){const a=[];for(a.push(n);a.length>0;){const d=a.pop();this.stats.get(mp).incrementCount();const f=d.header.children||[];for(const c of f){const T=new Cy(this,c,d);if(T.contentUrl?.includes("?session=")){const R=new URL(T.contentUrl).searchParams.get("session");R&&(this._queryParams.session=R)}d.children.push(T),T.depth=d.depth+1,a.push(T)}}}return n}_initializeTraverser(){let t;switch(this.type){case ms.TILES3D:t=h5;break;case ms.I3S:t=p5;break;default:t=gp}return new t({basePath:this.basePath,onTraversalEnd:this._onTraversalEnd.bind(this)})}_destroyTileHeaders(t){this._destroySubtree(t)}async _loadTile(t){let r;try{this._onStartTileLoading(),r=await t.loadContent()}catch(n){this._onTileLoadError(t,n instanceof Error?n:new Error("load failed"))}finally{this._onEndTileLoading(),this._onTileLoad(t,r)}}_onTileLoadError(t,r){this.stats.get(QT).incrementCount();const n=r.message||r.toString(),a=t.url;console.error(`A 3D tile failed to load: ${t.url} ${n}`),this.options.onTileError(t,n,a)}_onTileLoad(t,r){if(r){if(this.type===ms.I3S){const n=this.tileset?.nodePagesTile?.nodesInNodePages||0;this.stats.get(mp).reset(),this.stats.get(mp).addCount(n)}t&&t.content&&z6(t,t.content),this.updateContentTypes(t),this._addTileToCache(t),this.options.onTileLoad(t)}}updateContentTypes(t){if(this.type===ms.I3S)switch(t.header.isDracoGeometry&&(this.contentFormats.draco=!0),t.header.textureFormat){case"dds":this.contentFormats.dds=!0;break;case"ktx2":this.contentFormats.ktx2=!0;break}else if(this.type===ms.TILES3D){const{extensionsRemoved:r=[]}=t.content?.gltf||{};r.includes("KHR_draco_mesh_compression")&&(this.contentFormats.draco=!0),r.includes("EXT_meshopt_compression")&&(this.contentFormats.meshopt=!0),r.includes("KHR_texture_basisu")&&(this.contentFormats.ktx2=!0)}}_onStartTileLoading(){this._pendingCount++,this.stats.get(Ry).incrementCount()}_onEndTileLoading(){this._pendingCount--,this.stats.get(Ry).decrementCount()}_addTileToCache(t){this._cache.add(this,t,r=>r._updateCacheStats(t))}_updateCacheStats(t){this.stats.get(KT).incrementCount(),this.stats.get(My).incrementCount(),this.gpuMemoryUsageInBytes+=t.gpuMemoryUsageInBytes||0,this.stats.get(Py).count=this.gpuMemoryUsageInBytes,this.options.memoryAdjustedScreenSpaceError&&this.adjustScreenSpaceError()}_unloadTile(t){this.gpuMemoryUsageInBytes-=t.gpuMemoryUsageInBytes||0,this.stats.get(My).decrementCount(),this.stats.get(JT).incrementCount(),this.stats.get(Py).count=this.gpuMemoryUsageInBytes,this.options.onTileUnload(t),t.unloadContent()}_destroy(){const t=[];for(this.root&&t.push(this.root);t.length>0;){const r=t.pop();for(const n of r.children)t.push(n);this._destroyTile(r)}this.root=null}_destroySubtree(t){const r=t,n=[];for(n.push(r);n.length>0;){t=n.pop();for(const a of t.children)n.push(a);t!==r&&this._destroyTile(t)}r.children=[]}_destroyTile(t){this._cache.unloadTile(this,t),this._unloadTile(t),t.destroy()}_initializeTiles3DTileset(t){if(t.queryString){const r=new URLSearchParams(t.queryString),n=Object.fromEntries(r.entries());this._queryParams={...this._queryParams,...n}}if(this.asset=t.asset,!this.asset)throw new Error("Tileset must have an asset property.");if(this.asset.version!=="0.0"&&this.asset.version!=="1.0"&&this.asset.version!=="1.1")throw new Error("The tileset must be 3D Tiles version either 0.0 or 1.0 or 1.1.");"tilesetVersion"in this.asset&&(this._queryParams.v=this.asset.tilesetVersion),this.credits={attributions:this.options.attributions||[]},this.description=this.options.description||"",this.properties=t.properties,this.geometricError=t.geometricError,this._extensionsUsed=t.extensionsUsed||[],this.extras=t.extras}_initializeI3STileset(){this.loadOptions.i3s&&"token"in this.loadOptions.i3s&&(this._queryParams.token=this.loadOptions.i3s.token)}}const rA="4.3.1",Nh={COMPOSITE:"cmpt",POINT_CLOUD:"pnts",BATCHED_3D_MODEL:"b3dm",INSTANCED_3D_MODEL:"i3dm",GLTF:"glTF"};function iA(e,t,r){Ar(e instanceof ArrayBuffer);const n=new TextDecoder("utf8"),a=new Uint8Array(e,t,r);return n.decode(a)}function m5(e,t=0){const r=new DataView(e);return`${String.fromCharCode(r.getUint8(t+0))}${String.fromCharCode(r.getUint8(t+1))}${String.fromCharCode(r.getUint8(t+2))}${String.fromCharCode(r.getUint8(t+3))}`}const y5={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},ai={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DOUBLE:5130},Ze={...y5,...ai},By={[ai.DOUBLE]:Float64Array,[ai.FLOAT]:Float32Array,[ai.UNSIGNED_SHORT]:Uint16Array,[ai.UNSIGNED_INT]:Uint32Array,[ai.UNSIGNED_BYTE]:Uint8Array,[ai.BYTE]:Int8Array,[ai.SHORT]:Int16Array,[ai.INT]:Int32Array},b5={DOUBLE:ai.DOUBLE,FLOAT:ai.FLOAT,UNSIGNED_SHORT:ai.UNSIGNED_SHORT,UNSIGNED_INT:ai.UNSIGNED_INT,UNSIGNED_BYTE:ai.UNSIGNED_BYTE,BYTE:ai.BYTE,SHORT:ai.SHORT,INT:ai.INT},Dy="Failed to convert GL type";class oo{static fromTypedArray(t){t=ArrayBuffer.isView(t)?t.constructor:t;for(const r in By)if(By[r]===t)return r;throw new Error(Dy)}static fromName(t){const r=b5[t];if(!r)throw new Error(Dy);return r}static getArrayType(t){switch(t){case ai.UNSIGNED_SHORT_5_6_5:case ai.UNSIGNED_SHORT_4_4_4_4:case ai.UNSIGNED_SHORT_5_5_5_1:return Uint16Array;default:const r=By[t];if(!r)throw new Error(Dy);return r}}static getByteSize(t){return oo.getArrayType(t).BYTES_PER_ELEMENT}static validate(t){return!!oo.getArrayType(t)}static createTypedArray(t,r,n=0,a){a===void 0&&(a=(r.byteLength-n)/oo.getByteSize(t));const d=oo.getArrayType(t);return new d(r,n,a)}}function v5(e,t){if(!e)throw new Error(`math.gl assertion failed. ${t}`)}function x5(e,t=[0,0,0]){const r=e>>11&31,n=e>>5&63,a=e&31;return t[0]=r<<3,t[1]=n<<2,t[2]=a<<3,t}new zg,new Bt,new zg,new zg;function sA(e,t=255){return Eo(e,0,t)/t*2-1}function nA(e){return e<0?-1:1}function w5(e,t,r,n){if(v5(n),e<0||e>r||t<0||t>r)throw new Error(`x and y must be unsigned normalized integers between 0 and ${r}`);if(n.x=sA(e,r),n.y=sA(t,r),n.z=1-(Math.abs(n.x)+Math.abs(n.y)),n.z<0){const a=n.x;n.x=(1-Math.abs(n.y))*nA(a),n.y=(1-Math.abs(a))*nA(n.y)}return n.normalize()}function T5(e,t,r){return w5(e,t,255,r)}class Fy{json;buffer;featuresLength=0;_cachedTypedArrays={};constructor(t,r){this.json=t,this.buffer=r}getExtension(t){return this.json.extensions&&this.json.extensions[t]}hasProperty(t){return!!this.json[t]}getGlobalProperty(t,r=Ze.UNSIGNED_INT,n=1){const a=this.json[t];return a&&Number.isFinite(a.byteOffset)?this._getTypedArrayFromBinary(t,r,n,1,a.byteOffset):a}getPropertyArray(t,r,n){const a=this.json[t];return a&&Number.isFinite(a.byteOffset)?("componentType"in a&&(r=oo.fromName(a.componentType)),this._getTypedArrayFromBinary(t,r,n,this.featuresLength,a.byteOffset)):this._getTypedArrayFromArray(t,r,a)}getProperty(t,r,n,a,d){const f=this.json[t];if(!f)return f;const c=this.getPropertyArray(t,r,n);if(n===1)return c[a];for(let T=0;T<n;++T)d[T]=c[n*a+T];return d}_getTypedArrayFromBinary(t,r,n,a,d){const f=this._cachedTypedArrays;let c=f[t];return c||(c=oo.createTypedArray(r,this.buffer.buffer,this.buffer.byteOffset+d,a*n),f[t]=c),c}_getTypedArrayFromArray(t,r,n){const a=this._cachedTypedArrays;let d=a[t];return d||(d=oo.createTypedArray(r,n),a[t]=d),d}}const A5={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},E5={SCALAR:(e,t)=>e[t],VEC2:(e,t)=>[e[2*t+0],e[2*t+1]],VEC3:(e,t)=>[e[3*t+0],e[3*t+1],e[3*t+2]],VEC4:(e,t)=>[e[4*t+0],e[4*t+1],e[4*t+2],e[4*t+3]],MAT2:(e,t)=>[e[4*t+0],e[4*t+1],e[4*t+2],e[4*t+3]],MAT3:(e,t)=>[e[9*t+0],e[9*t+1],e[9*t+2],e[9*t+3],e[9*t+4],e[9*t+5],e[9*t+6],e[9*t+7],e[9*t+8]],MAT4:(e,t)=>[e[16*t+0],e[16*t+1],e[16*t+2],e[16*t+3],e[16*t+4],e[16*t+5],e[16*t+6],e[16*t+7],e[16*t+8],e[16*t+9],e[16*t+10],e[16*t+11],e[16*t+12],e[16*t+13],e[16*t+14],e[16*t+15]]},S5={SCALAR:(e,t,r)=>{t[r]=e},VEC2:(e,t,r)=>{t[2*r+0]=e[0],t[2*r+1]=e[1]},VEC3:(e,t,r)=>{t[3*r+0]=e[0],t[3*r+1]=e[1],t[3*r+2]=e[2]},VEC4:(e,t,r)=>{t[4*r+0]=e[0],t[4*r+1]=e[1],t[4*r+2]=e[2],t[4*r+3]=e[3]},MAT2:(e,t,r)=>{t[4*r+0]=e[0],t[4*r+1]=e[1],t[4*r+2]=e[2],t[4*r+3]=e[3]},MAT3:(e,t,r)=>{t[9*r+0]=e[0],t[9*r+1]=e[1],t[9*r+2]=e[2],t[9*r+3]=e[3],t[9*r+4]=e[4],t[9*r+5]=e[5],t[9*r+6]=e[6],t[9*r+7]=e[7],t[9*r+8]=e[8],t[9*r+9]=e[9]},MAT4:(e,t,r)=>{t[16*r+0]=e[0],t[16*r+1]=e[1],t[16*r+2]=e[2],t[16*r+3]=e[3],t[16*r+4]=e[4],t[16*r+5]=e[5],t[16*r+6]=e[6],t[16*r+7]=e[7],t[16*r+8]=e[8],t[16*r+9]=e[9],t[16*r+10]=e[10],t[16*r+11]=e[11],t[16*r+12]=e[12],t[16*r+13]=e[13],t[16*r+14]=e[14],t[16*r+15]=e[15]}};function C5(e,t,r,n){const{componentType:a}=e;Ar(e.componentType);const d=typeof a=="string"?oo.fromName(a):a,f=A5[e.type],c=E5[e.type],T=S5[e.type];return r+=e.byteOffset,{values:oo.createTypedArray(d,t,r,f*n),type:d,size:f,unpacker:c,packer:T}}const ao=e=>e!==void 0;function I5(e,t,r){if(!t)return null;let n=e.getExtension("3DTILES_batch_table_hierarchy");const a=t.HIERARCHY;return a&&(console.warn("3D Tile Parser: HIERARCHY is deprecated. Use 3DTILES_batch_table_hierarchy."),t.extensions=t.extensions||{},t.extensions["3DTILES_batch_table_hierarchy"]=a,n=a),n?M5(n,r):null}function M5(e,t){let r,n,a;const d=e.instancesLength,f=e.classes;let c=e.classIds,T=e.parentCounts,C=e.parentIds,R=d;ao(c.byteOffset)&&(c.componentType=defaultValue(c.componentType,GL.UNSIGNED_SHORT),c.type=AttributeType.SCALAR,a=getBinaryAccessor(c),c=a.createArrayBufferView(t.buffer,t.byteOffset+c.byteOffset,d));let L;if(ao(T))for(ao(T.byteOffset)&&(T.componentType=defaultValue(T.componentType,GL.UNSIGNED_SHORT),T.type=AttributeType.SCALAR,a=getBinaryAccessor(T),T=a.createArrayBufferView(t.buffer,t.byteOffset+T.byteOffset,d)),L=new Uint16Array(d),R=0,r=0;r<d;++r)L[r]=R,R+=T[r];ao(C)&&ao(C.byteOffset)&&(C.componentType=defaultValue(C.componentType,GL.UNSIGNED_SHORT),C.type=AttributeType.SCALAR,a=getBinaryAccessor(C),C=a.createArrayBufferView(t.buffer,t.byteOffset+C.byteOffset,R));const V=f.length;for(r=0;r<V;++r){const K=f[r].length,It=f[r].instances,St=getBinaryProperties(K,It,t);f[r].instances=combine(St,It)}const X=new Array(V).fill(0),at=new Uint16Array(d);for(r=0;r<d;++r)n=c[r],at[r]=X[n],++X[n];const nt={classes:f,classIds:c,classIndexes:at,parentCounts:T,parentIndexes:L,parentIds:C};return B5(nt),nt}function Lh(e,t,r){if(!e)return;const n=e.parentCounts;return e.parentIds?r(e,t):n>0?R5(e,t,r):P5(e,t,r)}function R5(e,t,r){const n=e.classIds,a=e.parentCounts,d=e.parentIds,f=e.parentIndexes,c=n.length,T=scratchVisited;T.length=Math.max(T.length,c);const C=++marker,R=scratchStack;for(R.length=0,R.push(t);R.length>0;){if(t=R.pop(),T[t]===C)continue;T[t]=C;const L=r(e,t);if(ao(L))return L;const V=a[t],X=f[t];for(let at=0;at<V;++at){const nt=d[X+at];nt!==t&&R.push(nt)}}return null}function P5(e,t,r){let n=!0;for(;n;){const a=r(e,t);if(ao(a))return a;const d=e.parentIds[t];n=d!==t,t=d}throw new Error("traverseHierarchySingleParent")}function B5(e){const r=e.classIds.length;for(let n=0;n<r;++n)oA(e,n,stack)}function oA(e,t,r){const n=e.parentCounts,a=e.parentIds,d=e.parentIndexes,c=e.classIds.length;if(!ao(a))return;assert(t<c,`Parent index ${t} exceeds the total number of instances: ${c}`),assert(r.indexOf(t)===-1,"Circular dependency detected in the batch table hierarchy."),r.push(t);const T=ao(n)?n[t]:1,C=ao(n)?d[t]:t;for(let R=0;R<T;++R){const L=a[C+R];L!==t&&oA(e,L,r)}r.pop(t)}function ys(e){return e!=null}const yp=(e,t)=>e,D5={HIERARCHY:!0,extensions:!0,extras:!0};class aA{json;binary;featureCount;_extensions;_properties;_binaryProperties;_hierarchy;constructor(t,r,n,a={}){Ar(n>=0),this.json=t||{},this.binary=r,this.featureCount=n,this._extensions=this.json?.extensions||{},this._properties={};for(const d in this.json)D5[d]||(this._properties[d]=this.json[d]);this._binaryProperties=this._initializeBinaryProperties(),a["3DTILES_batch_table_hierarchy"]&&(this._hierarchy=I5(this,this.json,this.binary))}getExtension(t){return this.json&&this.json.extensions&&this.json.extensions[t]}memorySizeInBytes(){return 0}isClass(t,r){if(this._checkBatchId(t),Ar(typeof r=="string",r),this._hierarchy){const n=Lh(this._hierarchy,t,(a,d)=>{const f=a.classIds[d];return a.classes[f].name===r});return ys(n)}return!1}isExactClass(t,r){return Ar(typeof r=="string",r),this.getExactClassName(t)===r}getExactClassName(t){if(this._checkBatchId(t),this._hierarchy){const r=this._hierarchy.classIds[t];return this._hierarchy.classes[r].name}}hasProperty(t,r){return this._checkBatchId(t),Ar(typeof r=="string",r),ys(this._properties[r])||this._hasPropertyInHierarchy(t,r)}getPropertyNames(t,r){this._checkBatchId(t),r=ys(r)?r:[],r.length=0;const n=Object.keys(this._properties);return r.push(...n),this._hierarchy&&this._getPropertyNamesInHierarchy(t,r),r}getProperty(t,r){if(this._checkBatchId(t),Ar(typeof r=="string",r),this._binaryProperties){const a=this._binaryProperties[r];if(ys(a))return this._getBinaryProperty(a,t)}const n=this._properties[r];if(ys(n))return yp(n[t]);if(this._hierarchy){const a=this._getHierarchyProperty(t,r);if(ys(a))return a}}setProperty(t,r,n){const a=this.featureCount;if(this._checkBatchId(t),Ar(typeof r=="string",r),this._binaryProperties){const f=this._binaryProperties[r];if(f){this._setBinaryProperty(f,t,n);return}}if(this._hierarchy&&this._setHierarchyProperty(this,t,r,n))return;let d=this._properties[r];ys(d)||(this._properties[r]=new Array(a),d=this._properties[r]),d[t]=yp(n)}_checkBatchId(t){if(!(t>=0&&t<this.featureCount))throw new Error("batchId not in range [0, featureCount - 1].")}_getBinaryProperty(t,r){return t.unpack(t.typedArray,r)}_setBinaryProperty(t,r,n){t.pack(n,t.typedArray,r)}_initializeBinaryProperties(){let t=null;for(const r in this._properties){const n=this._properties[r],a=this._initializeBinaryProperty(r,n);a&&(t=t||{},t[r]=a)}return t}_initializeBinaryProperty(t,r){if("byteOffset"in r){const n=r;Ar(this.binary,`Property ${t} requires a batch table binary.`),Ar(n.type,`Property ${t} requires a type.`);const a=C5(n,this.binary.buffer,this.binary.byteOffset|0,this.featureCount);return{typedArray:a.values,componentCount:a.size,unpack:a.unpacker,pack:a.packer}}return null}_hasPropertyInHierarchy(t,r){if(!this._hierarchy)return!1;const n=Lh(this._hierarchy,t,(a,d)=>{const f=a.classIds[d],c=a.classes[f].instances;return ys(c[r])});return ys(n)}_getPropertyNamesInHierarchy(t,r){Lh(this._hierarchy,t,(n,a)=>{const d=n.classIds[a],f=n.classes[d].instances;for(const c in f)f.hasOwnProperty(c)&&r.indexOf(c)===-1&&r.push(c)})}_getHierarchyProperty(t,r){return Lh(this._hierarchy,t,(n,a)=>{const d=n.classIds[a],f=n.classes[d],c=n.classIndexes[a],T=f.instances[r];return ys(T)?ys(T.typedArray)?this._getBinaryProperty(T,c):yp(T[c]):null})}_setHierarchyProperty(t,r,n,a){const d=Lh(this._hierarchy,r,(f,c)=>{const T=f.classIds[c],C=f.classes[T],R=f.classIndexes[c],L=C.instances[n];return ys(L)?(Ar(c===r,`Inherited property "${n}" is read-only.`),ys(L.typedArray)?this._setBinaryProperty(L,R,a):L[R]=yp(a),!0):!1});return ys(d)}}const Oy=4;function bp(e,t,r=0){const n=new DataView(t);if(e.magic=n.getUint32(r,!0),r+=Oy,e.version=n.getUint32(r,!0),r+=Oy,e.byteLength=n.getUint32(r,!0),r+=Oy,e.version!==1)throw new Error(`3D Tile Version ${e.version} not supported`);return r}const Nc=4,lA="b3dm tile in legacy format.";function ky(e,t,r){const n=new DataView(t);let a;e.header=e.header||{};let d=n.getUint32(r,!0);r+=Nc;let f=n.getUint32(r,!0);r+=Nc;let c=n.getUint32(r,!0);r+=Nc;let T=n.getUint32(r,!0);return r+=Nc,c>=570425344?(r-=Nc*2,a=d,c=f,T=0,d=0,f=0,console.warn(lA)):T>=570425344&&(r-=Nc,a=c,c=d,T=f,d=0,f=0,console.warn(lA)),e.header.featureTableJsonByteLength=d,e.header.featureTableBinaryByteLength=f,e.header.batchTableJsonByteLength=c,e.header.batchTableBinaryByteLength=T,e.header.batchLength=a,r}function Ny(e,t,r,n){return r=F5(e,t,r),r=O5(e,t,r),r}function F5(e,t,r,n){const{featureTableJsonByteLength:a,featureTableBinaryByteLength:d,batchLength:f}=e.header||{};if(e.featureTableJson={BATCH_LENGTH:f||0},a&&a>0){const c=iA(t,r,a);e.featureTableJson=JSON.parse(c)}return r+=a||0,e.featureTableBinary=new Uint8Array(t,r,d),r+=d||0,r}function O5(e,t,r,n){const{batchTableJsonByteLength:a,batchTableBinaryByteLength:d}=e.header||{};if(a&&a>0){const f=iA(t,r,a);e.batchTableJson=JSON.parse(f),r+=a,d&&d>0&&(e.batchTableBinary=new Uint8Array(t,r,d),e.batchTableBinary=new Uint8Array(e.batchTableBinary),r+=d)}return r}function cA(e,t,r){if(!t&&(!e||!e.batchIds||!r))return null;const{batchIds:n,isRGB565:a,pointCount:d=0}=e;if(n&&r){const f=new Uint8ClampedArray(d*3);for(let c=0;c<d;c++){const T=n[c],R=r.getProperty(T,"dimensions").map(L=>L*255);f[c*3]=R[0],f[c*3+1]=R[1],f[c*3+2]=R[2]}return{type:Ze.UNSIGNED_BYTE,value:f,size:3,normalized:!0}}if(t&&a){const f=new Uint8ClampedArray(d*3);for(let c=0;c<d;c++){const T=x5(t[c]);f[c*3]=T[0],f[c*3+1]=T[1],f[c*3+2]=T[2]}return{type:Ze.UNSIGNED_BYTE,value:f,size:3,normalized:!0}}return t&&t.length===d*3?{type:Ze.UNSIGNED_BYTE,value:t,size:3,normalized:!0}:{type:Ze.UNSIGNED_BYTE,value:t||new Uint8ClampedArray,size:4,normalized:!0}}const uA=new Bt;function k5(e,t){if(!t)return null;if(e.isOctEncoded16P){const r=new Float32Array((e.pointsLength||0)*3);for(let n=0;n<(e.pointsLength||0);n++)T5(t[n*2],t[n*2+1],uA),uA.toArray(r,n*3);return{type:Ze.FLOAT,size:2,value:r}}return{type:Ze.FLOAT,size:2,value:t}}function N5(e,t,r){return e.isQuantized?r["3d-tiles"]&&r["3d-tiles"].decodeQuantizedPositions?(e.isQuantized=!1,L5(e,t)):{type:Ze.UNSIGNED_SHORT,value:t,size:3,normalized:!0}:t}function L5(e,t){const r=new Bt,n=new Float32Array(e.pointCount*3);for(let a=0;a<e.pointCount;a++)r.set(t[a*3],t[a*3+1],t[a*3+2]).scale(1/e.quantizedRange).multiply(e.quantizedVolumeScale).add(e.quantizedVolumeOffset).toArray(n,a*3);return n}async function U5(e,t,r,n,a){r=bp(e,t,r),r=ky(e,t,r),r=Ny(e,t,r),z5(e);const{featureTable:d,batchTable:f}=V5(e);return await W5(e,d,f,n,a),j5(e,d,n),H5(e,d,f),G5(e,d),r}function z5(e){e.attributes={positions:null,colors:null,normals:null,batchIds:null},e.isQuantized=!1,e.isTranslucent=!1,e.isRGB565=!1,e.isOctEncoded16P=!1}function V5(e){const t=new Fy(e.featureTableJson,e.featureTableBinary),r=t.getGlobalProperty("POINTS_LENGTH");if(!Number.isFinite(r))throw new Error("POINTS_LENGTH must be defined");t.featuresLength=r,e.featuresLength=r,e.pointsLength=r,e.pointCount=r,e.rtcCenter=t.getGlobalProperty("RTC_CENTER",Ze.FLOAT,3);const n=$5(e,t);return{featureTable:t,batchTable:n}}function j5(e,t,r){if(e.attributes=e.attributes||{positions:null,colors:null,normals:null,batchIds:null},!e.attributes.positions){if(t.hasProperty("POSITION"))e.attributes.positions=t.getPropertyArray("POSITION",Ze.FLOAT,3);else if(t.hasProperty("POSITION_QUANTIZED")){const n=t.getPropertyArray("POSITION_QUANTIZED",Ze.UNSIGNED_SHORT,3);if(e.isQuantized=!0,e.quantizedRange=65535,e.quantizedVolumeScale=t.getGlobalProperty("QUANTIZED_VOLUME_SCALE",Ze.FLOAT,3),!e.quantizedVolumeScale)throw new Error("QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");if(e.quantizedVolumeOffset=t.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",Ze.FLOAT,3),!e.quantizedVolumeOffset)throw new Error("QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");e.attributes.positions=N5(e,n,r)}}if(!e.attributes.positions)throw new Error("Either POSITION or POSITION_QUANTIZED must be defined.")}function H5(e,t,r){if(e.attributes=e.attributes||{positions:null,colors:null,normals:null,batchIds:null},!e.attributes.colors){let n=null;t.hasProperty("RGBA")?(n=t.getPropertyArray("RGBA",Ze.UNSIGNED_BYTE,4),e.isTranslucent=!0):t.hasProperty("RGB")?n=t.getPropertyArray("RGB",Ze.UNSIGNED_BYTE,3):t.hasProperty("RGB565")&&(n=t.getPropertyArray("RGB565",Ze.UNSIGNED_SHORT,1),e.isRGB565=!0),e.attributes.colors=cA(e,n,r)}t.hasProperty("CONSTANT_RGBA")&&(e.constantRGBA=t.getGlobalProperty("CONSTANT_RGBA",Ze.UNSIGNED_BYTE,4))}function G5(e,t){if(e.attributes=e.attributes||{positions:null,colors:null,normals:null,batchIds:null},!e.attributes.normals){let r=null;t.hasProperty("NORMAL")?r=t.getPropertyArray("NORMAL",Ze.FLOAT,3):t.hasProperty("NORMAL_OCT16P")&&(r=t.getPropertyArray("NORMAL_OCT16P",Ze.UNSIGNED_BYTE,2),e.isOctEncoded16P=!0),e.attributes.normals=k5(e,r)}}function $5(e,t){let r=null;if(!e.batchIds&&t.hasProperty("BATCH_ID")&&(e.batchIds=t.getPropertyArray("BATCH_ID",Ze.UNSIGNED_SHORT,1),e.batchIds)){const n=t.getGlobalProperty("BATCH_LENGTH");if(!n)throw new Error("Global property: BATCH_LENGTH must be defined when BATCH_ID is defined.");const{batchTableJson:a,batchTableBinary:d}=e;r=new aA(a,d,n)}return r}async function W5(e,t,r,n,a){let d,f,c;const T=e.batchTableJson&&e.batchTableJson.extensions&&e.batchTableJson.extensions["3DTILES_draco_point_compression"];T&&(c=T.properties);const C=t.getExtension("3DTILES_draco_point_compression");if(C){f=C.properties;const L=C.byteOffset,V=C.byteLength;if(!f||!Number.isFinite(L)||!V)throw new Error("Draco properties, byteOffset, and byteLength must be defined");d=(e.featureTableBinary||[]).slice(L,L+V),e.hasPositions=Number.isFinite(f.POSITION),e.hasColors=Number.isFinite(f.RGB)||Number.isFinite(f.RGBA),e.hasNormals=Number.isFinite(f.NORMAL),e.hasBatchIds=Number.isFinite(f.BATCH_ID),e.isTranslucent=Number.isFinite(f.RGBA)}if(!d)return!0;const R={buffer:d,properties:{...f,...c},batchTableProperties:c};return await X5(e,R,n,a)}async function X5(e,t,r,n){if(!n)return;const a={...r,draco:{...r?.draco,extraAttributes:t.batchTableProperties||{}}};delete a["3d-tiles"];const d=await Zu(t.buffer,wT,a,n),f=d.attributes.POSITION&&d.attributes.POSITION.value,c=d.attributes.COLOR_0&&d.attributes.COLOR_0.value,T=d.attributes.NORMAL&&d.attributes.NORMAL.value,C=d.attributes.BATCH_ID&&d.attributes.BATCH_ID.value,R=f&&d.attributes.POSITION.value.quantization,L=T&&d.attributes.NORMAL.value.quantization;if(R){const X=d.POSITION.data.quantization,at=X.range;e.quantizedVolumeScale=new Bt(at,at,at),e.quantizedVolumeOffset=new Bt(X.minValues),e.quantizedRange=(1<<X.quantizationBits)-1,e.isQuantizedDraco=!0}L&&(e.octEncodedRange=(1<<d.NORMAL.data.quantization.quantizationBits)-1,e.isOctEncodedDraco=!0);const V={};if(t.batchTableProperties)for(const X of Object.keys(t.batchTableProperties))d.attributes[X]&&d.attributes[X].value&&(V[X.toLowerCase()]=d.attributes[X].value);e.attributes={positions:f,colors:cA(e,c,void 0),normals:T,batchIds:C,...V}}const Ly={URI:0,EMBEDDED:1};function hA(e,t,r,n){e.rotateYtoZ=!0;const a=(e.byteOffset||0)+(e.byteLength||0)-r;if(a===0)throw new Error("glTF byte length must be greater than 0.");return e.gltfUpAxis=n?.["3d-tiles"]&&n["3d-tiles"].assetGltfUpAxis?n["3d-tiles"].assetGltfUpAxis:"Y",e.gltfArrayBuffer=rg(t,r,a),e.gltfByteOffset=0,e.gltfByteLength=a,r%4===0||console.warn(`${e.type}: embedded glb is not aligned to a 4-byte boundary.`),(e.byteOffset||0)+(e.byteLength||0)}async function dA(e,t,r,n){const a=r?.["3d-tiles"]||{};if(q5(e,t),a.loadGLTF){if(!n)return;if(e.gltfUrl){const{fetch:d}=n,f=await d(e.gltfUrl,r);e.gltfArrayBuffer=await f.arrayBuffer(),e.gltfByteOffset=0}if(e.gltfArrayBuffer){const d=await Zu(e.gltfArrayBuffer,Oh,r,n);e.gltf=my(d),e.gpuMemoryUsageInBytes=lT(e.gltf),delete e.gltfArrayBuffer,delete e.gltfByteOffset,delete e.gltfByteLength}}}function q5(e,t,r){switch(t){case Ly.URI:if(e.gltfArrayBuffer){const n=new Uint8Array(e.gltfArrayBuffer,e.gltfByteOffset),d=new TextDecoder().decode(n);e.gltfUrl=d.replace(/[\s\0]+$/,"")}delete e.gltfArrayBuffer,delete e.gltfByteOffset,delete e.gltfByteLength;break;case Ly.EMBEDDED:break;default:throw new Error("b3dm: Illegal glTF format field")}}async function Z5(e,t,r,n,a){r=Y5(e,t,r,n),await dA(e,Ly.EMBEDDED,n,a);const d=e?.gltf?.extensions;return d&&d.CESIUM_RTC&&(e.rtcCenter=d.CESIUM_RTC.center),r}function Y5(e,t,r,n,a){r=bp(e,t,r),r=ky(e,t,r),r=Ny(e,t,r),r=hA(e,t,r,n);const d=new Fy(e.featureTableJson,e.featureTableBinary);return e.rtcCenter=d.getGlobalProperty("RTC_CENTER",Ze.FLOAT,3),r}async function K5(e,t,r,n,a){return r=J5(e,t,r,n),await dA(e,e.gltfFormat||0,n,a),r}function J5(e,t,r,n,a){if(r=bp(e,t,r),e.version!==1)throw new Error(`Instanced 3D Model version ${e.version} is not supported`);r=ky(e,t,r);const d=new DataView(t);if(e.gltfFormat=d.getUint32(r,!0),r+=4,r=Ny(e,t,r),r=hA(e,t,r,n),!e?.header?.featureTableJsonByteLength||e.header.featureTableJsonByteLength===0)throw new Error("i3dm parser: featureTableJsonByteLength is zero.");const f=new Fy(e.featureTableJson,e.featureTableBinary),c=f.getGlobalProperty("INSTANCES_LENGTH");if(f.featuresLength=c,!Number.isFinite(c))throw new Error("i3dm parser: INSTANCES_LENGTH must be defined");e.eastNorthUp=f.getGlobalProperty("EAST_NORTH_UP"),e.rtcCenter=f.getGlobalProperty("RTC_CENTER",Ze.FLOAT,3);const T=new aA(e.batchTableJson,e.batchTableBinary,c);return Q5(e,f,T,c),r}function Q5(e,t,r,n){const a=new Array(n),d=new Bt;new Bt,new Bt,new Bt;const f=new Xr,c=new ch,T=new Bt,C={},R=new He,L=[],V=[],X=[],at=[];for(let nt=0;nt<n;nt++){let K;if(t.hasProperty("POSITION"))K=t.getProperty("POSITION",Ze.FLOAT,3,nt,d);else if(t.hasProperty("POSITION_QUANTIZED")){K=t.getProperty("POSITION_QUANTIZED",Ze.UNSIGNED_SHORT,3,nt,d);const ee=t.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",Ze.FLOAT,3);if(!ee)throw new Error("i3dm parser: QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");const ae=t.getGlobalProperty("QUANTIZED_VOLUME_SCALE",Ze.FLOAT,3);if(!ae)throw new Error("i3dm parser: QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");const be=65535;for(let ie=0;ie<3;ie++)K[ie]=K[ie]/be*ae[ie]+ee[ie]}if(!K)throw new Error("i3dm: POSITION or POSITION_QUANTIZED must be defined for each instance.");if(d.copy(K),C.translation=d,e.normalUp=t.getProperty("NORMAL_UP",Ze.FLOAT,3,nt,L),e.normalRight=t.getProperty("NORMAL_RIGHT",Ze.FLOAT,3,nt,V),e.normalUp){if(!e.normalRight)throw new Error("i3dm: Custom orientation requires both NORMAL_UP and NORMAL_RIGHT.");e.hasCustomOrientation=!0}else{if(e.octNormalUp=t.getProperty("NORMAL_UP_OCT32P",Ze.UNSIGNED_SHORT,2,nt,L),e.octNormalRight=t.getProperty("NORMAL_RIGHT_OCT32P",Ze.UNSIGNED_SHORT,2,nt,V),e.octNormalUp)throw e.octNormalRight?new Error("i3dm: oct-encoded orientation not implemented"):new Error("i3dm: oct-encoded orientation requires NORMAL_UP_OCT32P and NORMAL_RIGHT_OCT32P");e.eastNorthUp?(Er.WGS84.eastNorthUpToFixedFrame(d,R),R.getRotationMatrix3(f)):f.identity()}c.fromMatrix3(f),C.rotation=c,T.set(1,1,1);const It=t.getProperty("SCALE",Ze.FLOAT,1,nt,X);Number.isFinite(It)&&T.multiplyByScalar(It);const St=t.getProperty("SCALE_NON_UNIFORM",Ze.FLOAT,3,nt,L);St&&T.scale(St),C.scale=T;let Ct=t.getProperty("BATCH_ID",Ze.UNSIGNED_SHORT,1,nt,at);Ct===void 0&&(Ct=nt);const Ht=new He().fromQuaternion(C.rotation);R.identity(),R.translate(C.translation),R.multiplyRight(Ht),R.scale(C.scale);const Qt=R.clone();a[nt]={modelMatrix:Qt,batchId:Ct}}e.instances=a}async function t8(e,t,r,n,a,d){r=bp(e,t,r);const f=new DataView(t);for(e.tilesLength=f.getUint32(r,!0),r+=4,e.tiles=[];e.tiles.length<e.tilesLength&&(e.byteLength||0)-r>12;){const c={shape:"tile3d"};e.tiles.push(c),r=await d(t,r,n,a,c)}return r}async function e8(e,t,r,n){if(e.rotateYtoZ=!0,e.gltfUpAxis=r?.["3d-tiles"]?.assetGltfUpAxis?r["3d-tiles"].assetGltfUpAxis:"Y",r?.["3d-tiles"]?.loadGLTF){if(!n)return t.byteLength;const a=await Zu(t,Oh,r,n);e.gltf=my(a),e.gpuMemoryUsageInBytes=lT(e.gltf)}else e.gltfArrayBuffer=t;return t.byteLength}async function fA(e,t=0,r,n,a={shape:"tile3d"}){switch(a.byteOffset=t,a.type=m5(e,t),a.type){case Nh.COMPOSITE:return await t8(a,e,t,r,n,fA);case Nh.BATCHED_3D_MODEL:return await Z5(a,e,t,r,n);case Nh.GLTF:return await e8(a,e,r,n);case Nh.INSTANCED_3D_MODEL:return await K5(a,e,t,r,n);case Nh.POINT_CLOUD:return await U5(a,e,t,r,n);default:throw new Error(`3DTileLoader: unknown type ${a.type}`)}}const r8=1952609651,i8=1;async function s8(e,t,r){if(new Uint32Array(e.slice(0,4))[0]!==r8)throw new Error("Wrong subtree file magic number");if(new Uint32Array(e.slice(4,8))[0]!==i8)throw new Error("Wrong subtree file verson, must be 1");const d=pA(e.slice(8,16)),f=new Uint8Array(e,24,d),T=new TextDecoder("utf8").decode(f),C=JSON.parse(T),R=pA(e.slice(16,24));let L=new ArrayBuffer(0);if(R&&(L=e.slice(24+d)),await vp(C,C.tileAvailability,L,r),Array.isArray(C.contentAvailability))for(const V of C.contentAvailability)await vp(C,V,L,r);else await vp(C,C.contentAvailability,L,r);return await vp(C,C.childSubtreeAvailability,L,r),C}async function vp(e,t,r,n){const a=Number.isFinite(t.bitstream)?t.bitstream:t.bufferView;if(typeof a!="number")return;const d=e.bufferViews[a],f=e.buffers[d.buffer];if(!n?.baseUrl)throw new Error("Url is not provided");if(!n.fetch)throw new Error("fetch is not provided");if(f.uri){const T=`${n?.baseUrl||""}/${f.uri}`,R=await(await n.fetch(T)).arrayBuffer();t.explicitBitstream=new Uint8Array(R,d.byteOffset,d.byteLength);return}const c=e.buffers.slice(0,d.buffer).reduce((T,C)=>T+C.byteLength,0);t.explicitBitstream=new Uint8Array(r.slice(c,c+f.byteLength),d.byteOffset,d.byteLength)}function pA(e){const t=new DataView(e),r=t.getUint32(0,!0),n=t.getUint32(4,!0);return r+2**32*n}const _A={dataType:null,batchType:null,id:"3d-tiles-subtree",name:"3D Tiles Subtree",module:"3d-tiles",version:rA,extensions:["subtree"],mimeTypes:["application/octet-stream"],tests:["subtree"],parse:s8,options:{}};var cn=null;try{cn=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function cr(e,t,r){this.low=e|0,this.high=t|0,this.unsigned=!!r}cr.prototype.__isLong__,Object.defineProperty(cr.prototype,"__isLong__",{value:!0});function Qi(e){return(e&&e.__isLong__)===!0}function gA(e){var t=Math.clz32(e&-e);return e?31-t:t}cr.isLong=Qi;var mA={},yA={};function ll(e,t){var r,n,a;return t?(e>>>=0,(a=0<=e&&e<256)&&(n=yA[e],n)?n:(r=Ke(e,0,!0),a&&(yA[e]=r),r)):(e|=0,(a=-128<=e&&e<128)&&(n=mA[e],n)?n:(r=Ke(e,e<0?-1:0,!1),a&&(mA[e]=r),r))}cr.fromInt=ll;function un(e,t){if(isNaN(e))return t?Ro:Bn;if(t){if(e<0)return Ro;if(e>=vA)return EA}else{if(e<=-xA)return bs;if(e+1>=xA)return AA}return e<0?un(-e,t).neg():Ke(e%Lc|0,e/Lc|0,t)}cr.fromNumber=un;function Ke(e,t,r){return new cr(e,t,r)}cr.fromBits=Ke;var xp=Math.pow;function Uy(e,t,r){if(e.length===0)throw Error("empty string");if(typeof t=="number"?(r=t,t=!1):t=!!t,e==="NaN"||e==="Infinity"||e==="+Infinity"||e==="-Infinity")return t?Ro:Bn;if(r=r||10,r<2||36<r)throw RangeError("radix");var n;if((n=e.indexOf("-"))>0)throw Error("interior hyphen");if(n===0)return Uy(e.substring(1),t,r).neg();for(var a=un(xp(r,8)),d=Bn,f=0;f<e.length;f+=8){var c=Math.min(8,e.length-f),T=parseInt(e.substring(f,f+c),r);if(c<8){var C=un(xp(r,c));d=d.mul(C).add(un(T))}else d=d.mul(a),d=d.add(un(T))}return d.unsigned=t,d}cr.fromString=Uy;function Pn(e,t){return typeof e=="number"?un(e,t):typeof e=="string"?Uy(e,t):Ke(e.low,e.high,typeof t=="boolean"?t:e.unsigned)}cr.fromValue=Pn;var bA=65536,n8=1<<24,Lc=bA*bA,vA=Lc*Lc,xA=vA/2,wA=ll(n8),Bn=ll(0);cr.ZERO=Bn;var Ro=ll(0,!0);cr.UZERO=Ro;var Uc=ll(1);cr.ONE=Uc;var TA=ll(1,!0);cr.UONE=TA;var zy=ll(-1);cr.NEG_ONE=zy;var AA=Ke(-1,2147483647,!1);cr.MAX_VALUE=AA;var EA=Ke(-1,-1,!0);cr.MAX_UNSIGNED_VALUE=EA;var bs=Ke(0,-2147483648,!1);cr.MIN_VALUE=bs;var re=cr.prototype;re.toInt=function(){return this.unsigned?this.low>>>0:this.low},re.toNumber=function(){return this.unsigned?(this.high>>>0)*Lc+(this.low>>>0):this.high*Lc+(this.low>>>0)},re.toString=function(t){if(t=t||10,t<2||36<t)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(bs)){var r=un(t),n=this.div(r),a=n.mul(r).sub(this);return n.toString(t)+a.toInt().toString(t)}else return"-"+this.neg().toString(t);for(var d=un(xp(t,6),this.unsigned),f=this,c="";;){var T=f.div(d),C=f.sub(T.mul(d)).toInt()>>>0,R=C.toString(t);if(f=T,f.isZero())return R+c;for(;R.length<6;)R="0"+R;c=""+R+c}},re.getHighBits=function(){return this.high},re.getHighBitsUnsigned=function(){return this.high>>>0},re.getLowBits=function(){return this.low},re.getLowBitsUnsigned=function(){return this.low>>>0},re.getNumBitsAbs=function(){if(this.isNegative())return this.eq(bs)?64:this.neg().getNumBitsAbs();for(var t=this.high!=0?this.high:this.low,r=31;r>0&&(t&1<<r)==0;r--);return this.high!=0?r+33:r+1},re.isZero=function(){return this.high===0&&this.low===0},re.eqz=re.isZero,re.isNegative=function(){return!this.unsigned&&this.high<0},re.isPositive=function(){return this.unsigned||this.high>=0},re.isOdd=function(){return(this.low&1)===1},re.isEven=function(){return(this.low&1)===0},re.equals=function(t){return Qi(t)||(t=Pn(t)),this.unsigned!==t.unsigned&&this.high>>>31===1&&t.high>>>31===1?!1:this.high===t.high&&this.low===t.low},re.eq=re.equals,re.notEquals=function(t){return!this.eq(t)},re.neq=re.notEquals,re.ne=re.notEquals,re.lessThan=function(t){return this.comp(t)<0},re.lt=re.lessThan,re.lessThanOrEqual=function(t){return this.comp(t)<=0},re.lte=re.lessThanOrEqual,re.le=re.lessThanOrEqual,re.greaterThan=function(t){return this.comp(t)>0},re.gt=re.greaterThan,re.greaterThanOrEqual=function(t){return this.comp(t)>=0},re.gte=re.greaterThanOrEqual,re.ge=re.greaterThanOrEqual,re.compare=function(t){if(Qi(t)||(t=Pn(t)),this.eq(t))return 0;var r=this.isNegative(),n=t.isNegative();return r&&!n?-1:!r&&n?1:this.unsigned?t.high>>>0>this.high>>>0||t.high===this.high&&t.low>>>0>this.low>>>0?-1:1:this.sub(t).isNegative()?-1:1},re.comp=re.compare,re.negate=function(){return!this.unsigned&&this.eq(bs)?bs:this.not().add(Uc)},re.neg=re.negate,re.add=function(t){Qi(t)||(t=Pn(t));var r=this.high>>>16,n=this.high&65535,a=this.low>>>16,d=this.low&65535,f=t.high>>>16,c=t.high&65535,T=t.low>>>16,C=t.low&65535,R=0,L=0,V=0,X=0;return X+=d+C,V+=X>>>16,X&=65535,V+=a+T,L+=V>>>16,V&=65535,L+=n+c,R+=L>>>16,L&=65535,R+=r+f,R&=65535,Ke(V<<16|X,R<<16|L,this.unsigned)},re.subtract=function(t){return Qi(t)||(t=Pn(t)),this.add(t.neg())},re.sub=re.subtract,re.multiply=function(t){if(this.isZero())return this;if(Qi(t)||(t=Pn(t)),cn){var r=cn.mul(this.low,this.high,t.low,t.high);return Ke(r,cn.get_high(),this.unsigned)}if(t.isZero())return this.unsigned?Ro:Bn;if(this.eq(bs))return t.isOdd()?bs:Bn;if(t.eq(bs))return this.isOdd()?bs:Bn;if(this.isNegative())return t.isNegative()?this.neg().mul(t.neg()):this.neg().mul(t).neg();if(t.isNegative())return this.mul(t.neg()).neg();if(this.lt(wA)&&t.lt(wA))return un(this.toNumber()*t.toNumber(),this.unsigned);var n=this.high>>>16,a=this.high&65535,d=this.low>>>16,f=this.low&65535,c=t.high>>>16,T=t.high&65535,C=t.low>>>16,R=t.low&65535,L=0,V=0,X=0,at=0;return at+=f*R,X+=at>>>16,at&=65535,X+=d*R,V+=X>>>16,X&=65535,X+=f*C,V+=X>>>16,X&=65535,V+=a*R,L+=V>>>16,V&=65535,V+=d*C,L+=V>>>16,V&=65535,V+=f*T,L+=V>>>16,V&=65535,L+=n*R+a*C+d*T+f*c,L&=65535,Ke(X<<16|at,L<<16|V,this.unsigned)},re.mul=re.multiply,re.divide=function(t){if(Qi(t)||(t=Pn(t)),t.isZero())throw Error("division by zero");if(cn){if(!this.unsigned&&this.high===-2147483648&&t.low===-1&&t.high===-1)return this;var r=(this.unsigned?cn.div_u:cn.div_s)(this.low,this.high,t.low,t.high);return Ke(r,cn.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?Ro:Bn;var n,a,d;if(this.unsigned){if(t.unsigned||(t=t.toUnsigned()),t.gt(this))return Ro;if(t.gt(this.shru(1)))return TA;d=Ro}else{if(this.eq(bs)){if(t.eq(Uc)||t.eq(zy))return bs;if(t.eq(bs))return Uc;var f=this.shr(1);return n=f.div(t).shl(1),n.eq(Bn)?t.isNegative()?Uc:zy:(a=this.sub(t.mul(n)),d=n.add(a.div(t)),d)}else if(t.eq(bs))return this.unsigned?Ro:Bn;if(this.isNegative())return t.isNegative()?this.neg().div(t.neg()):this.neg().div(t).neg();if(t.isNegative())return this.div(t.neg()).neg();d=Bn}for(a=this;a.gte(t);){n=Math.max(1,Math.floor(a.toNumber()/t.toNumber()));for(var c=Math.ceil(Math.log(n)/Math.LN2),T=c<=48?1:xp(2,c-48),C=un(n),R=C.mul(t);R.isNegative()||R.gt(a);)n-=T,C=un(n,this.unsigned),R=C.mul(t);C.isZero()&&(C=Uc),d=d.add(C),a=a.sub(R)}return d},re.div=re.divide,re.modulo=function(t){if(Qi(t)||(t=Pn(t)),cn){var r=(this.unsigned?cn.rem_u:cn.rem_s)(this.low,this.high,t.low,t.high);return Ke(r,cn.get_high(),this.unsigned)}return this.sub(this.div(t).mul(t))},re.mod=re.modulo,re.rem=re.modulo,re.not=function(){return Ke(~this.low,~this.high,this.unsigned)},re.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32},re.clz=re.countLeadingZeros,re.countTrailingZeros=function(){return this.low?gA(this.low):gA(this.high)+32},re.ctz=re.countTrailingZeros,re.and=function(t){return Qi(t)||(t=Pn(t)),Ke(this.low&t.low,this.high&t.high,this.unsigned)},re.or=function(t){return Qi(t)||(t=Pn(t)),Ke(this.low|t.low,this.high|t.high,this.unsigned)},re.xor=function(t){return Qi(t)||(t=Pn(t)),Ke(this.low^t.low,this.high^t.high,this.unsigned)},re.shiftLeft=function(t){return Qi(t)&&(t=t.toInt()),(t&=63)===0?this:t<32?Ke(this.low<<t,this.high<<t|this.low>>>32-t,this.unsigned):Ke(0,this.low<<t-32,this.unsigned)},re.shl=re.shiftLeft,re.shiftRight=function(t){return Qi(t)&&(t=t.toInt()),(t&=63)===0?this:t<32?Ke(this.low>>>t|this.high<<32-t,this.high>>t,this.unsigned):Ke(this.high>>t-32,this.high>=0?0:-1,this.unsigned)},re.shr=re.shiftRight,re.shiftRightUnsigned=function(t){return Qi(t)&&(t=t.toInt()),(t&=63)===0?this:t<32?Ke(this.low>>>t|this.high<<32-t,this.high>>>t,this.unsigned):t===32?Ke(this.high,0,this.unsigned):Ke(this.high>>>t-32,0,this.unsigned)},re.shru=re.shiftRightUnsigned,re.shr_u=re.shiftRightUnsigned,re.rotateLeft=function(t){var r;return Qi(t)&&(t=t.toInt()),(t&=63)===0?this:t===32?Ke(this.high,this.low,this.unsigned):t<32?(r=32-t,Ke(this.low<<t|this.high>>>r,this.high<<t|this.low>>>r,this.unsigned)):(t-=32,r=32-t,Ke(this.high<<t|this.low>>>r,this.low<<t|this.high>>>r,this.unsigned))},re.rotl=re.rotateLeft,re.rotateRight=function(t){var r;return Qi(t)&&(t=t.toInt()),(t&=63)===0?this:t===32?Ke(this.high,this.low,this.unsigned):t<32?(r=32-t,Ke(this.high<<r|this.low>>>t,this.low<<r|this.high>>>t,this.unsigned)):(t-=32,r=32-t,Ke(this.low<<r|this.high>>>t,this.high<<r|this.low>>>t,this.unsigned))},re.rotr=re.rotateRight,re.toSigned=function(){return this.unsigned?Ke(this.low,this.high,!1):this},re.toUnsigned=function(){return this.unsigned?this:Ke(this.low,this.high,!0)},re.toBytes=function(t){return t?this.toBytesLE():this.toBytesBE()},re.toBytesLE=function(){var t=this.high,r=this.low;return[r&255,r>>>8&255,r>>>16&255,r>>>24,t&255,t>>>8&255,t>>>16&255,t>>>24]},re.toBytesBE=function(){var t=this.high,r=this.low;return[t>>>24,t>>>16&255,t>>>8&255,t&255,r>>>24,r>>>16&255,r>>>8&255,r&255]},cr.fromBytes=function(t,r,n){return n?cr.fromBytesLE(t,r):cr.fromBytesBE(t,r)},cr.fromBytesLE=function(t,r){return new cr(t[0]|t[1]<<8|t[2]<<16|t[3]<<24,t[4]|t[5]<<8|t[6]<<16|t[7]<<24,r)},cr.fromBytesBE=function(t,r){return new cr(t[4]<<24|t[5]<<16|t[6]<<8|t[7],t[0]<<24|t[1]<<16|t[2]<<8|t[3],r)};const o8=16;function SA(e){e==="X"&&(e="");const t=e.padEnd(o8,"0");return cr.fromString(t,!0,16)}function a8(e){if(e.isZero())return"X";let t=e.countTrailingZeros();const r=t%4;t=(t-r)/4;const n=t;t*=4;const d=e.shiftRightUnsigned(t).toString(16).replace(/0+$/,"");return Array(17-n-d.length).join("0")+d}function l8(e,t){const r=c8(e).shiftRightUnsigned(2);return e.add(cr.fromNumber(2*t+1-4).multiply(r))}function c8(e){return e.and(e.not().add(1))}const u8=3,h8=2*30+1,CA=180/Math.PI;function d8(e){if(e.length===0)throw new Error(`Invalid Hilbert quad key ${e}`);const t=e.split("/"),r=parseInt(t[0],10),n=t[1],a=n.length;let d=0;const f=[0,0];for(let c=a-1;c>=0;c--){d=a-c;const T=n[c];let C=0,R=0;T==="1"?R=1:T==="2"?(C=1,R=1):T==="3"&&(C=1);const L=Math.pow(2,d-1);p8(L,f,C,R),f[0]+=L*C,f[1]+=L*R}if(r%2===1){const c=f[0];f[0]=f[1],f[1]=c}return{face:r,ij:f,level:d}}function f8(e){if(e.isZero())return"";let t=e.toString(2);for(;t.length<u8+h8;)t="0"+t;const r=t.lastIndexOf("1"),n=t.substring(0,3),a=t.substring(3,r),d=a.length/2,f=cr.fromString(n,!0,2).toString(10);let c="";if(d!==0)for(c=cr.fromString(a,!0,2).toString(4);c.length<d;)c="0"+c;return`${f}/${c}`}function IA(e,t,r){const n=1<<t;return[(e[0]+r[0])/n,(e[1]+r[1])/n]}function MA(e){return e>=.5?1/3*(4*e*e-1):1/3*(1-4*(1-e)*(1-e))}function RA(e){return[MA(e[0]),MA(e[1])]}function PA(e,[t,r]){switch(e){case 0:return[1,t,r];case 1:return[-t,1,r];case 2:return[-t,-r,1];case 3:return[-1,-r,-t];case 4:return[r,-1,-t];case 5:return[r,t,-1];default:throw new Error("Invalid face")}}function BA([e,t,r]){const n=Math.atan2(r,Math.sqrt(e*e+t*t));return[Math.atan2(t,e)*CA,n*CA]}function p8(e,t,r,n){if(n===0){r===1&&(t[0]=e-1-t[0],t[1]=e-1-t[1]);const a=t[0];t[0]=t[1],t[1]=a}}function _8(e){const t=IA(e.ij,e.level,[.5,.5]),r=RA(t),n=PA(e.face,r);return BA(n)}const g8=100;function DA(e){const{face:t,ij:r,level:n}=e,a=[[0,0],[0,1],[1,1],[1,0],[0,0]],d=Math.max(1,Math.ceil(g8*Math.pow(2,-n))),f=new Float64Array(4*d*2+2);let c=0,T=0;for(let C=0;C<4;C++){const R=a[C].slice(0),L=a[C+1],V=(L[0]-R[0])/d,X=(L[1]-R[1])/d;for(let at=0;at<d;at++){R[0]+=V,R[1]+=X;const nt=IA(r,n,R),K=RA(nt),It=PA(t,K),St=BA(It);Math.abs(St[1])>89.999&&(St[0]=T);const Ct=St[0]-T;St[0]+=Ct>180?-360:Ct<-180?360:0,f[c++]=St[0],f[c++]=St[1],T=St[0]}}return f[c++]=f[0],f[c++]=f[1],f}function Vy(e){const t=m8(e);return d8(t)}function m8(e){if(e.indexOf("/")>0)return e;const t=SA(e);return f8(t)}function y8(e){const t=Vy(e);return _8(t)}function b8(e){let t;if(e.face===2||e.face===5){let r=null,n=0;for(let a=0;a<4;a++){const d=`${e.face}/${a}`,f=Vy(d),c=DA(f);(typeof r>"u"||r===null)&&(r=new Float64Array(4*c.length)),r.set(c,n),n+=c.length}t=FA(r)}else{const r=DA(e);t=FA(r)}return t}function FA(e){if(e.length%2!==0)throw new Error("Invalid corners");const t=[],r=[];for(let n=0;n<e.length;n+=2)t.push(e[n]),r.push(e[n+1]);return t.sort((n,a)=>n-a),r.sort((n,a)=>n-a),{west:t[0],east:t[t.length-1],north:r[r.length-1],south:r[0]}}function v8(e,t){const r=t?.minimumHeight||0,n=t?.maximumHeight||0,a=Vy(e),d=b8(a),f=d.west,c=d.south,T=d.east,C=d.north,R=[];return R.push(new Bt(f,C,r)),R.push(new Bt(T,C,r)),R.push(new Bt(T,c,r)),R.push(new Bt(f,c,r)),R.push(new Bt(f,C,n)),R.push(new Bt(T,C,n)),R.push(new Bt(T,c,n)),R.push(new Bt(f,c,n)),R}function OA(e){const t=e.token,r={minimumHeight:e.minimumHeight,maximumHeight:e.maximumHeight},n=v8(t,r),a=y8(t),d=a[0],f=a[1],c=Er.WGS84.cartographicToCartesian([d,f,r.maximumHeight]),T=new Bt(c[0],c[1],c[2]);n.push(T);const C=mL(n);return[...C.center,...C.halfAxes]}const x8={QUADTREE:4,OCTREE:8};function w8(e,t,r){if(e?.box){const n=SA(e.s2VolumeInfo.token),a=l8(n,t),d=a8(a),f={...e.s2VolumeInfo};switch(f.token=d,r){case"OCTREE":const C=e.s2VolumeInfo,R=C.maximumHeight-C.minimumHeight,L=R/2,V=C.minimumHeight+R/2;C.minimumHeight=V-L,C.maximumHeight=V+L;break}return{box:OA(f),s2VolumeInfo:f}}}async function kA(e){const{subtree:t,subtreeData:r={level:0,x:0,y:0,z:0},parentData:n={mortonIndex:0,localLevel:-1,localX:0,localY:0,localZ:0},childIndex:a=0,implicitOptions:d,loaderOptions:f,s2VolumeBox:c}=e,{subdivisionScheme:T,subtreeLevels:C,maximumLevel:R,contentUrlTemplate:L,subtreesUriTemplate:V,basePath:X}=d,at={children:[],lodMetricValue:0,contentUrl:""};if(!R)return Mb.once(`Missing 'maximumLevel' or 'availableLevels' property. The subtree ${L} won't be loaded...`),at;const nt=n.localLevel+1,K=r.level+nt;if(K>R)return at;const It=x8[T],St=Math.log2(It),Ct=a&1,Ht=a>>1&1,Qt=a>>2&1,ee=cl(n.localX,Ct,1),ae=cl(n.localY,Ht,1),be=cl(n.localZ,Qt,1),ie=cl(r.x,ee,nt),le=cl(r.y,ae,nt),Ae=cl(r.z,be,nt),Fe=cl(n.mortonIndex,a,St),ze=nt===C&&jy(t.childSubtreeAvailability,Fe);let Ce,zr,ns,Hr;if(ze){const vi=`${X}/${V}`,xi=Hy(vi,K,ie,le,Ae);Ce=await Ko(xi,_A,f),Hr=0,zr={level:K,x:ie,y:le,z:Ae},ns={mortonIndex:0,localLevel:0,localX:0,localY:0,localZ:0}}else Ce=t,Hr=(It**nt-1)/(It-1)+Fe,zr=r,ns={mortonIndex:Fe,localLevel:nt,localX:ee,localY:ae,localZ:be};if(!jy(Ce.tileAvailability,Hr))return at;jy(Ce.contentAvailability,Hr)&&(at.contentUrl=Hy(L,K,ie,le,Ae));for(let vi=0;vi<It;vi++){const xi=w8(c,vi,T),li=await kA({subtree:Ce,subtreeData:zr,parentData:ns,childIndex:vi,implicitOptions:d,loaderOptions:f,s2VolumeBox:xi});(li.contentUrl||li.children.length)&&at.children.push(li)}return at.contentUrl||at.children.length?T8(at,{level:K,x:ie,y:le,z:Ae},d,c):at}function jy(e,t){let r;return Array.isArray(e)?(r=e[0],e.length>1&&Mb.once('Not supported extension "3DTILES_multiple_contents" has been detected')):r=e,"constant"in r?!!r.constant:r.explicitBitstream?S8(t,r.explicitBitstream):!1}function T8(e,t,r,n){const{basePath:a,refine:d,getRefine:f,lodMetricType:c,getTileType:T,rootLodMetricValue:C,rootBoundingVolume:R}=r,L=e.contentUrl&&e.contentUrl.replace(`${a}/`,""),V=C/2**t.level,X=n?.box?{box:n.box}:R,at=A8(X,t,r.subdivisionScheme);return{children:e.children,contentUrl:e.contentUrl,content:{uri:L},id:e.contentUrl,refine:f(d),type:T(e),lodMetricType:c,lodMetricValue:V,geometricError:V,transform:e.transform,boundingVolume:at}}function A8(e,t,r){if(e.region){const{level:n,x:a,y:d,z:f}=t,[c,T,C,R,L,V]=e.region,X=2**n,at=(C-c)/X,[nt,K]=[c+at*a,c+at*(a+1)],It=(R-T)/X,[St,Ct]=[T+It*d,T+It*(d+1)];let Ht,Qt;if(r==="OCTREE"){const ee=(V-L)/X;[Ht,Qt]=[L+ee*f,L+ee*(f+1)]}else[Ht,Qt]=[L,V];return{region:[nt,St,K,Ct,Ht,Qt]}}if(e.box)return e;throw new Error(`Unsupported bounding volume type ${JSON.stringify(e)}`)}function cl(e,t,r){return(e<<r)+t}function Hy(e,t,r,n,a){const d=E8({level:t,x:r,y:n,z:a});return e.replace(/{level}|{x}|{y}|{z}/gi,f=>d[f])}function E8(e){const t={};for(const r in e)t[`{${r}}`]=e[r];return t}function S8(e,t){const r=Math.floor(e/8),n=e%8;return(t[r]>>n&1)===1}function Gy(e,t=""){if(!t)return Mo.EMPTY;const n=t.split("?")[0].split(".").pop();switch(n){case"pnts":return Mo.POINTCLOUD;case"i3dm":case"b3dm":case"glb":case"gltf":return Mo.SCENEGRAPH;default:return n||Mo.EMPTY}}function $y(e){switch(e){case"REPLACE":case"replace":return Rn.REPLACE;case"ADD":case"add":return Rn.ADD;default:return e}}function Wy(e,t){if(/^[a-z][0-9a-z+.-]*:/i.test(t)){const n=new URL(e,`${t}/`);return decodeURI(n.toString())}else if(e.startsWith("/"))return e;return e2(t,e)}function NA(e,t){if(!e)return null;let r;if(e.content){const a=e.content.uri||e.content?.url;typeof a<"u"&&(r=Wy(a,t))}return{...e,id:r,contentUrl:r,lodMetricType:kc.GEOMETRIC_ERROR,lodMetricValue:e.geometricError,transformMatrix:e.transform,type:Gy(e,r),refine:$y(e.refine)}}async function C8(e,t,r){let n=null;const a=UA(e.root);a&&e.root?n=await LA(e.root,e,t,a,r):n=NA(e.root,t);const d=[];for(d.push(n);d.length>0;){const f=d.pop()||{},c=f.children||[],T=[];for(const C of c){const R=UA(C);let L;R?L=await LA(C,e,t,R,r):L=NA(C,t),L&&(T.push(L),d.push(L))}f.children=T}return n}async function LA(e,t,r,n,a){const{subdivisionScheme:d,maximumLevel:f,availableLevels:c,subtreeLevels:T,subtrees:{uri:C}}=n,R=Hy(C,0,0,0,0),L=Wy(R,r),V=await Ko(L,_A,a),X=e.content?.uri,at=X?Wy(X,r):"",nt=t?.root?.refine,K=e.geometricError,It=e.boundingVolume.extensions?.["3DTILES_bounding_volume_S2"];if(It){const Qt={box:OA(It),s2VolumeInfo:It};e.boundingVolume=Qt}const St=e.boundingVolume,Ct={contentUrlTemplate:at,subtreesUriTemplate:C,subdivisionScheme:d,subtreeLevels:T,maximumLevel:Number.isFinite(c)?c-1:f,refine:nt,basePath:r,lodMetricType:kc.GEOMETRIC_ERROR,rootLodMetricValue:K,rootBoundingVolume:St,getTileType:Gy,getRefine:$y};return await I8(e,r,V,Ct,a)}async function I8(e,t,r,n,a){if(!e)return null;const{children:d,contentUrl:f}=await kA({subtree:r,implicitOptions:n,loaderOptions:a});let c,T=null;return f&&(c=f,T={uri:f.replace(`${t}/`,"")}),{...e,id:c,contentUrl:c,lodMetricType:kc.GEOMETRIC_ERROR,lodMetricValue:e.geometricError,transformMatrix:e.transform,type:Gy(e,c),refine:$y(e.refine),content:T||e.content,children:d}}function UA(e){return e?.extensions?.["3DTILES_implicit_tiling"]||e?.implicitTiling}const zA={dataType:null,batchType:null,id:"3d-tiles",name:"3D Tiles",module:"3d-tiles",version:rA,extensions:["cmpt","pnts","b3dm","i3dm"],mimeTypes:["application/octet-stream"],tests:["cmpt","pnts","b3dm","i3dm"],parse:M8,options:{"3d-tiles":{loadGLTF:!0,decodeQuantizedPositions:!1,isTileset:"auto",assetGltfUpAxis:null}}};async function M8(e,t={},r){const n=t["3d-tiles"]||{};let a;return n.isTileset==="auto"?a=r?.url&&r.url.indexOf(".json")!==-1:a=n.isTileset,a?R8(e,t,r):P8(e,t,r)}async function R8(e,t,r){const n=JSON.parse(new TextDecoder().decode(e)),a=r?.url||"",d=B8(a),f=await C8(n,d,t||{});return{...n,shape:"tileset3d",loader:zA,url:a,queryString:r?.queryString||"",basePath:d,root:f||n.root,type:ms.TILES3D,lodMetricType:kc.GEOMETRIC_ERROR,lodMetricValue:n.root?.geometricError||0}}async function P8(e,t,r){const n={content:{shape:"tile3d",featureIds:null}};return await fA(e,0,t,r,n.content),n.content}function B8(e){return ig(e)}const VA=[0],D8={getPointColor:{type:"accessor",value:[0,0,0,255]},pointSize:1,data:"",loader:zA,onTilesetLoad:{type:"function",value:e=>{}},onTileLoad:{type:"function",value:e=>{}},onTileUnload:{type:"function",value:e=>{}},onTileError:{type:"function",value:(e,t,r)=>{}},_getMeshColor:{type:"function",value:e=>[255,255,255]}};class Xy extends Dw{initializeState(){"onTileLoadFail"in this.props&&Ye.removed("onTileLoadFail","onTileError")(),this.state={layerMap:{},tileset3d:null,activeViewports:{},lastUpdatedViewports:null}}get isLoaded(){return!!(this.state?.tileset3d?.isLoaded()&&super.isLoaded)}shouldUpdateState({changeFlags:t}){return t.somethingChanged}updateState({props:t,oldProps:r,changeFlags:n}){if(t.data&&t.data!==r.data&&this._loadTileset(t.data),n.viewportChanged){const{activeViewports:a}=this.state;Object.keys(a).length&&(this._updateTileset(a),this.state.lastUpdatedViewports=a,this.state.activeViewports={})}if(n.propsChanged){const{layerMap:a}=this.state;for(const d in a)a[d].needsUpdate=!0}}activateViewport(t){const{activeViewports:r,lastUpdatedViewports:n}=this.state;this.internalState.viewport=t,r[t.id]=t;const a=n?.[t.id];(!a||!t.equals(a))&&(this.setChangeFlags({viewportChanged:!0}),this.setNeedsUpdate())}getPickingInfo({info:t,sourceLayer:r}){const n=r&&r.props.tile;return t.picked&&(t.object=n),t.sourceTile=n,t}filterSubLayer({layer:t,viewport:r}){const{tile:n}=t.props,{id:a}=r;return n.selected&&n.viewportIds.includes(a)}_updateAutoHighlight(t){const r=t.sourceTile,n=this.state.layerMap[r?.id];n&&n.layer&&n.layer.updateAutoHighlight(t)}async _loadTileset(t){const{loadOptions:r={}}=this.props,n=this.props.loader||this.props.loaders,a=Array.isArray(n)?n[0]:n,d={loadOptions:{...r}};let f=t;if(a.preload){const C=await a.preload(t,r);C.url&&(f=C.url),C.headers&&(d.loadOptions.fetch={...d.loadOptions.fetch,headers:C.headers}),Object.assign(d,C)}const c=await Ko(f,a,d.loadOptions),T=new g5(c,{onTileLoad:this._onTileLoad.bind(this),onTileUnload:this._onTileUnload.bind(this),onTileError:this.props.onTileError,...d});this.setState({tileset3d:T,layerMap:{}}),this._updateTileset(this.state.activeViewports),this.props.onTilesetLoad(T)}_onTileLoad(t){const{lastUpdatedViewports:r}=this.state;this.props.onTileLoad(t),this._updateTileset(r),this.setNeedsUpdate()}_onTileUnload(t){delete this.state.layerMap[t.id],this.props.onTileUnload(t)}_updateTileset(t){if(!t)return;const{tileset3d:r}=this.state,{timeline:n}=this.context,a=Object.keys(t).length;!n||!a||!r||r.selectTiles(Object.values(t)).then(d=>{this.state.frameNumber!==d&&this.setState({frameNumber:d})})}_getSubLayer(t,r){if(!t.content)return null;switch(t.type){case Mo.POINTCLOUD:return this._makePointCloudLayer(t,r);case Mo.SCENEGRAPH:return this._make3DModelLayer(t);case Mo.MESH:return this._makeSimpleMeshLayer(t,r);default:throw new Error(`Tile3DLayer: Failed to render layer of type ${t.content.type}`)}}_makePointCloudLayer(t,r){const{attributes:n,pointCount:a,constantRGBA:d,cartographicOrigin:f,modelMatrix:c}=t.content,{positions:T,normals:C,colors:R}=n;if(!T)return null;const L=r&&r.props.data||{header:{vertexCount:a},attributes:{POSITION:T,NORMAL:C,COLOR_0:R}},{pointSize:V,getPointColor:X}=this.props,at=this.getSubLayerClass("pointcloud",Zm);return new at({pointSize:V},this.getSubLayerProps({id:"pointcloud"}),{id:`${this.id}-pointcloud-${t.id}`,tile:t,data:L,coordinateSystem:$e.METER_OFFSETS,coordinateOrigin:f,modelMatrix:c,getColor:d||X,_offset:0})}_make3DModelLayer(t){const{gltf:r,instances:n,cartographicOrigin:a,modelMatrix:d}=t.content,f=this.getSubLayerClass("scenegraph",yy);return new f({_lighting:"pbr"},this.getSubLayerProps({id:"scenegraph"}),{id:`${this.id}-scenegraph-${t.id}`,tile:t,data:n||VA,scenegraph:r,coordinateSystem:$e.METER_OFFSETS,coordinateOrigin:a,modelMatrix:d,getTransformMatrix:c=>c.modelMatrix,getPosition:[0,0,0],_offset:0})}_makeSimpleMeshLayer(t,r){const n=t.content,{attributes:a,indices:d,modelMatrix:f,cartographicOrigin:c,coordinateSystem:T=$e.METER_OFFSETS,material:C,featureIds:R}=n,{_getMeshColor:L}=this.props,V=r&&r.props.mesh||new gc({topology:"triangle-list",attributes:F8(a),indices:d}),X=this.getSubLayerClass("mesh",by);return new X(this.getSubLayerProps({id:"mesh"}),{id:`${this.id}-mesh-${t.id}`,tile:t,mesh:V,data:VA,getColor:L(t),pbrMaterial:C,modelMatrix:f,coordinateOrigin:c,coordinateSystem:T,featureIds:R,_offset:0})}renderLayers(){const{tileset3d:t,layerMap:r}=this.state;return t?t.tiles.map(n=>{const a=r[n.id]=r[n.id]||{tile:n};let{layer:d}=a;return n.selected&&(d?a.needsUpdate&&(d=this._getSubLayer(n,d),a.needsUpdate=!1):d=this._getSubLayer(n)),a.layer=d,d}).filter(Boolean):null}}Xy.defaultProps=D8,Xy.layerName="Tile3DLayer";function F8(e){const t={};return t.positions={...e.positions,value:new Float32Array(e.positions.value)},e.normals&&(t.normals=e.normals),e.texCoords&&(t.texCoords=e.texCoords),e.colors&&(t.colors=e.colors),e.uvRegions&&(t.uvRegions=e.uvRegions),t}const qy=512,O8=Math.PI/180;function jA({map:e,gl:t,deck:r}){if(e.__deck)return e.__deck;const n=r?.props._customRender,a=r?.props.onLoad,d=$A({...r?.props,_customRender:()=>{e.triggerRepaint(),n?.("")}});let f;return(!r||r.props.gl===t)&&(Object.assign(d,{gl:t,width:null,height:null,touchAction:"unset",viewState:Uh(e)}),r?.isInitialized?HA(r,e):d.onLoad=()=>{a?.(),HA(f,e)}),r?(f=r,r.setProps(d),r.userData.isExternal=!0):(f=new Ch(d),e.on("remove",()=>{GA(e)})),f.userData.mapboxLayers=new Set,e.__deck=f,e.on("render",()=>{f.isInitialized&&V8(f,e)}),f}function HA(e,t){const r=()=>{e.isInitialized?j8(e,t):t.off("move",r)};t.on("move",r)}function GA(e){e.__deck?.finalize(),e.__deck=null}function $A(e){return{...e,parameters:{depthMask:!0,depthTest:!0,blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthFunc:515,blendEquation:32774,...e.parameters},views:e.views||[new bm({id:"mapbox"})]}}function k8(e,t){e.userData.mapboxLayers.add(t),Zy(e)}function N8(e,t){e.userData.mapboxLayers.delete(t),Zy(e)}function L8(e,t){Zy(e)}function U8(e,t,r){let{currentViewport:n}=e.userData,a=!1;n||(n=WA(e,t,!0),e.userData.currentViewport=n,a=!0),e.isInitialized&&e._drawLayers("mapbox-repaint",{viewports:[n],layerFilter:({layer:d})=>r.id===d.id||d.props.operation.includes("terrain"),clearStack:a,clearCanvas:!1})}function Uh(e){const{lng:t,lat:r}=e.getCenter(),n={longitude:(t+540)%360-180,latitude:r,zoom:e.getZoom(),bearing:e.getBearing(),pitch:e.getPitch(),padding:e.getPadding(),repeat:e.getRenderWorldCopies()};return e.getTerrain?.()&&z8(e,n),n}function z8(e,t){if(e.getFreeCameraOptions){const{position:r}=e.getFreeCameraOptions();if(!r||r.z===void 0)return;const n=e.transform.height,{longitude:a,latitude:d,pitch:f}=t,c=r.x*qy,T=(1-r.y)*qy,C=r.z*qy,R=hh([a,d]),L=c-R[0],V=T-R[1],X=Math.sqrt(L*L+V*V),at=f*O8,nt=1.5*n,K=at<.001?nt*Math.cos(at)/C:nt*Math.sin(at)/X;t.zoom=Math.log2(K);const It=nt*Math.cos(at)/K,St=C-It;t.position=[0,0,St/Df(d)]}else typeof e.transform.elevation=="number"&&(t.position=[0,0,e.transform.elevation])}function WA(e,t,r=!0){return new tl({id:"mapbox",x:0,y:0,width:e.width,height:e.height,...Uh(t),nearZMultiplier:r?.02:.1,nearZ:t.transform._nearZ/t.transform.height,farZ:t.transform._farZ/t.transform.height})}function V8(e,t){const{mapboxLayers:r,isExternal:n}=e.userData;if(n){const a=Array.from(r,R=>R.id),f=vc(e.props.layers,Boolean).some(R=>R&&!a.includes(R.id));let c=e.getViewports();const T=c.findIndex(R=>R.id==="mapbox"),C=c.length>1||T<0;(f||C)&&(T>=0&&(c=c.slice(),c[T]=WA(e,t,!1)),e._drawLayers("mapbox-repaint",{viewports:c,layerFilter:R=>(!e.props.layerFilter||e.props.layerFilter(R))&&(R.viewport.id!=="mapbox"||!a.includes(R.layer.id)),clearCanvas:!1}))}e.userData.currentViewport=null}function j8(e,t){e.setProps({viewState:Uh(t)}),e.needsRedraw({clearRedrawFlags:!0})}function Zy(e){if(e.userData.isExternal)return;const t=[];e.userData.mapboxLayers.forEach(r=>{const n=r.props.type,a=new n(r.props);t.push(a)}),e.setProps({layers:t})}class H8{constructor(t){if(!t.id)throw new Error("Layer must have an unique id");this.id=t.id,this.type="custom",this.renderingMode=t.renderingMode||"3d",this.map=null,this.deck=null,this.props=t}onAdd(t,r){this.map=t,this.deck=jA({map:t,gl:r,deck:this.props.deck}),k8(this.deck,this)}onRemove(){this.deck&&N8(this.deck,this)}setProps(t){Object.assign(this.props,t,{id:this.id}),this.deck&&L8(this.deck)}render(){U8(this.deck,this.map,this)}}const Yy="__UNDEFINED__";function wp(e,t,r,n){if(!e||!t||!e.style||!e.style._loaded)return;const a=vc(n,Boolean);if(r!==n){const c=vc(r,Boolean),T=new Set(c.map(C=>C.id));for(const C of a)T.delete(C.id);for(const C of T)e.getLayer(C)&&e.removeLayer(C)}for(const c of a){const T=e.getLayer(c.id);T?(T.implementation||T).setProps(c.props):e.addLayer(new H8({id:c.id,deck:t}),c.props.beforeId)}const d=e.style._order,f={};for(const c of a){let{beforeId:T}=c.props;(!T||!d.includes(T))&&(T=Yy),f[T]=f[T]||[],f[T].push(c.id)}for(const c in f){const T=f[c];let C=c===Yy?d.length:d.indexOf(c),R=c===Yy?void 0:c;for(let L=T.length-1;L>=0;L--){const V=T[L],X=d.indexOf(V);X!==C-1&&(e.moveLayer(V,R),X>C&&C++),C--,R=V}}}class G8{constructor(t){this._handleStyleChange=()=>{wp(this._map,this._deck,this._props.layers,this._props.layers)},this._updateContainerSize=()=>{if(this._map&&this._container){const{clientWidth:a,clientHeight:d}=this._map.getContainer();Object.assign(this._container.style,{width:`${a}px`,height:`${d}px`})}},this._updateViewState=()=>{const a=this._deck;a&&(a.setProps({viewState:Uh(this._map)}),a.isInitialized&&a.redraw())},this._handleMouseEvent=a=>{const d=this._deck;if(!d||!d.isInitialized)return;const f={type:a.type,offsetCenter:a.point,srcEvent:a},c=this._lastMouseDownPoint;switch(!a.point&&c&&(f.deltaX=a.originalEvent.clientX-c.clientX,f.deltaY=a.originalEvent.clientY-c.clientY,f.offsetCenter={x:c.x+f.deltaX,y:c.y+f.deltaY}),f.type){case"mousedown":d._onPointerDown(f),this._lastMouseDownPoint={...a.point,clientX:a.originalEvent.clientX,clientY:a.originalEvent.clientY};break;case"dragstart":f.type="panstart",d._onEvent(f);break;case"drag":f.type="panmove",d._onEvent(f);break;case"dragend":f.type="panend",d._onEvent(f);break;case"click":f.tapCount=1,d._onEvent(f);break;case"dblclick":f.type="click",f.tapCount=2,d._onEvent(f);break;case"mousemove":f.type="pointermove",d._onPointerMove(f);break;case"mouseout":f.type="pointerleave",d._onPointerMove(f);break;default:return}};const{interleaved:r=!1,...n}=t;this._interleaved=r,this._props=n}setProps(t){this._interleaved&&t.layers&&wp(this._map,this._deck,this._props.layers,t.layers),Object.assign(this._props,t),this._deck&&this._deck.setProps(this._interleaved?$A(this._props):this._props)}onAdd(t){return this._map=t,this._interleaved?this._onAddInterleaved(t):this._onAddOverlaid(t)}_onAddOverlaid(t){const r=document.createElement("div");return Object.assign(r.style,{position:"absolute",left:0,top:0,textAlign:"initial",pointerEvents:"none"}),this._container=r,this._deck=new Ch({...this._props,parent:r,viewState:Uh(t)}),t.on("resize",this._updateContainerSize),t.on("render",this._updateViewState),t.on("mousedown",this._handleMouseEvent),t.on("dragstart",this._handleMouseEvent),t.on("drag",this._handleMouseEvent),t.on("dragend",this._handleMouseEvent),t.on("mousemove",this._handleMouseEvent),t.on("mouseout",this._handleMouseEvent),t.on("click",this._handleMouseEvent),t.on("dblclick",this._handleMouseEvent),this._updateContainerSize(),r}_onAddInterleaved(t){const r=t.painter.context.gl;return r instanceof WebGLRenderingContext&&Ye.warn("Incompatible basemap library. See: https://deck.gl/docs/api-reference/mapbox/overview#compatibility")(),this._deck=jA({map:t,gl:r,deck:new Ch({...this._props,gl:r})}),t.on("styledata",this._handleStyleChange),wp(t,this._deck,[],this._props.layers),document.createElement("div")}onRemove(){const t=this._map;t&&(this._interleaved?this._onRemoveInterleaved(t):this._onRemoveOverlaid(t)),this._deck=void 0,this._map=void 0,this._container=void 0}_onRemoveOverlaid(t){t.off("resize",this._updateContainerSize),t.off("render",this._updateViewState),t.off("mousedown",this._handleMouseEvent),t.off("dragstart",this._handleMouseEvent),t.off("drag",this._handleMouseEvent),t.off("dragend",this._handleMouseEvent),t.off("mousemove",this._handleMouseEvent),t.off("mouseout",this._handleMouseEvent),t.off("click",this._handleMouseEvent),t.off("dblclick",this._handleMouseEvent),this._deck?.finalize()}_onRemoveInterleaved(t){t.off("styledata",this._handleStyleChange),wp(t,this._deck,this._props.layers,[]),GA(t)}getDefaultPosition(){return"top-left"}pickObject(t){return bi(this._deck),this._deck.pickObject(t)}pickMultipleObjects(t){return bi(this._deck),this._deck.pickMultipleObjects(t)}pickObjects(t){return bi(this._deck),this._deck.pickObjects(t)}finalize(){this._map&&this._map.removeControl(this)}getCanvas(){return this._map?this._interleaved?this._map.getCanvas():this._deck.getCanvas():null}}class XA{olaMaps;apiKey;accessToken;mode;threedTileset;static Marker=Se.Marker;static Popup=Se.Popup;static NavigationControl=Se.NavigationControl;static GeolocateControl=Se.GeolocateControl;static ScaleControl=Se.ScaleControl;static FullscreenControl=Se.FullscreenControl;static AttributionControl=Se.AttributionControl;static TerrainControl=Se.TerrainControl;static LogoControl=Se.LogoControl;static GlobeControl=Se.GlobeControl;static LngLat=Se.LngLat;static LngLatBounds=Se.LngLatBounds;static Point=Se.Point;static MercatorCoordinate=Se.MercatorCoordinate;static GeoJSONSource=Se.GeoJSONSource;static VectorTileSource=Se.VectorTileSource;static RasterTileSource=Se.RasterTileSource;static RasterDEMTileSource=Se.RasterDEMTileSource;static ImageSource=Se.ImageSource;static VideoSource=Se.VideoSource;static CanvasSource=Se.CanvasSource;static MapMouseEvent=Se.MapMouseEvent;static MapTouchEvent=Se.MapTouchEvent;static MapWheelEvent=Se.MapWheelEvent;static AJAXError=Se.AJAXError;static BoxZoomHandler=Se.BoxZoomHandler;static CooperativeGesturesHandler=Se.CooperativeGesturesHandler;static DoubleClickZoomHandler=Se.DoubleClickZoomHandler;static DragPanHandler=Se.DragPanHandler;static DragRotateHandler=Se.DragRotateHandler;static KeyboardHandler=Se.KeyboardHandler;static ScrollZoomHandler=Se.ScrollZoomHandler;static TwoFingersTouchPitchHandler=Se.TwoFingersTouchPitchHandler;static TwoFingersTouchRotateHandler=Se.TwoFingersTouchRotateHandler;static TwoFingersTouchZoomHandler=Se.TwoFingersTouchZoomHandler;static TwoFingersTouchZoomRotateHandler=Se.TwoFingersTouchZoomRotateHandler;static EdgeInsets=Se.EdgeInsets;static Event=Se.Event;static Evented=Se.Evented;static Hash=Se.Hash;static Style=Se.Style;constructor({apiKey:t,accessToken:r="",mode:n="2d",threedTileset:a=_b}){this.apiKey=t,this.mode=n,this.threedTileset=a,this.accessToken=r}addOlaLogo(t){if(typeof window>"u")return;const r=document.getElementsByClassName("maplibregl-ctrl-bottom-left");let n="#000";t.style?.includes("dark")&&(n="#FFF");for(let a=0;a<r.length;a++){const d=document.createElement("div");d.style.position="absolute",d.style.bottom="4px",d.style.left="10px",d.style.zIndex="1000",d.innerHTML=gb(n),r[a].appendChild(d)}}addAttribution(t){const r=document.querySelectorAll(".maplibregl-ctrl-bottom-right .maplibregl-ctrl-attrib-inner"),n=t?.style||"";r?.forEach(a=>{const d=a.querySelector("a");d&&(d.style.display="none");const f="ola-maps-link";if(!a.querySelector(`#${f}`)){const C=document.createElement("a");C.id=f,C.href="https://maps.olakrutrim.com/",C.target="_blank",C.textContent="Ola Maps ",a.appendChild(C)}const c="osm-link";if(!a.querySelector(`#${c}`)){const C=document.createElement("a");C.id=c,C.href="https://www.openstreetmap.org/copyright",C.target="_blank",C.textContent="|  OpenStreetMap contributors",a.appendChild(C)}const T="copernicus-attrib";if(n.includes("default-dark-standard-satellite")&&!a.querySelector(`#${T}`)){const C=document.createElement("span");C.id=T,C.textContent=" | Contains modified Copernicus Sentinel-2 data 2024",a.appendChild(C)}})}fetchStaticMap(t){try{return fetch(t).then(r=>r.blob())}catch(r){console.log(r)}}async add3dLayer(){if(!this.threedTileset)throw new Error("3d Tileset is not initialized");const t=new Xy({id:"tile-3d-layer",data:`${this.threedTileset}?api_key=${this.apiKey}`,beforeId:"poi_railway"}),r=new G8({interleaved:!0,layers:[t]});r&&this.olaMaps.on("style.load",()=>{this.olaMaps.setFilter("building-3d",["all",["!has","hide_3d"],["!=","render_as_3d",!0]]),this.olaMaps.addControl(r)})}init(t){this.olaMaps=new Se.Map({container:t?.container||"map",center:t?.center||[0,0],zoom:t?.zoom||9,hash:t?.hash||!1,style:t?.style||pb,transformRequest:(a,d)=>{if(this.accessToken)return{url:a,headers:{Authorization:`Bearer ${this.accessToken}`}};{const f=new URL(a);return d!=="Image"&&f.searchParams.append("api_key",this.apiKey),{url:f.toString()}}},...t}),this.mode==="3d"&&this.add3dLayer(),this.addOlaLogo(t),this.addAttribution({style:t?.style});const r={};return Object.getOwnPropertyNames(Se.Map.prototype).forEach(a=>{typeof this.olaMaps[a]=="function"&&(r[a]=this.olaMaps[a].bind(this.olaMaps))}),Object.keys(qu).forEach(a=>{typeof qu[a]=="function"?r[a]=(...d)=>new qu[a](...d):r[a]=qu[a]}),Object.getOwnPropertyNames(this.olaMaps).forEach(a=>{a in r||(r[a]=this.olaMaps[a])}),Object.assign(this.olaMaps,r)}addNavigationControls(t){return new Se.NavigationControl(t)}addGeolocateControls(t){return new Se.GeolocateControl(t)}getMercatorCoordinate(){return Se.MercatorCoordinate}addMarker(t){return new Se.Marker(t)}addPopup(t){return new Se.Popup(t)}getStaticMap(t,r){this.fetchStaticMap(t)?.then(a=>{const d=URL.createObjectURL(a),f=document.createElement("img");f.src=d;const c=document.getElementById(r);c&&!c.querySelector("img")?c?.appendChild(f):console.log("An image already exists in the element.")}).catch(a=>console.error(a))}}typeof window<"u"&&(window.OlaMaps=XA);const $8=Object.freeze(Object.defineProperty({__proto__:null,OlaMaps:XA},Symbol.toStringTag,{value:"Module"}));vn.OlaMaps=ps,vn.default3dTIleset=_b,vn.defaultStyleJson=pb,vn.getCookie=YS,vn.getOlaMapIcon=gb,vn.setCookie=KS,Object.defineProperty(vn,Symbol.toStringTag,{value:"Module"})}));
