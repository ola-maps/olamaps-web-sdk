(function(){"use strict";try{if(typeof document<"u"){var l=document.createElement("style");l.appendChild(document.createTextNode(`.maplibregl-map{font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif;overflow:hidden;position:relative;-webkit-tap-highlight-color:rgb(0,0,0,0)}.maplibregl-canvas{left:0;position:absolute;top:0}.maplibregl-map:fullscreen{height:100%;width:100%}.maplibregl-ctrl-group button.maplibregl-ctrl-compass{touch-action:none}.maplibregl-canvas-container.maplibregl-interactive,.maplibregl-ctrl-group button.maplibregl-ctrl-compass{cursor:grab;-webkit-user-select:none;-moz-user-select:none;user-select:none}.maplibregl-canvas-container.maplibregl-interactive.maplibregl-track-pointer{cursor:pointer}.maplibregl-canvas-container.maplibregl-interactive:active,.maplibregl-ctrl-group button.maplibregl-ctrl-compass:active{cursor:grabbing}.maplibregl-canvas-container.maplibregl-touch-zoom-rotate,.maplibregl-canvas-container.maplibregl-touch-zoom-rotate .maplibregl-canvas{touch-action:pan-x pan-y}.maplibregl-canvas-container.maplibregl-touch-drag-pan,.maplibregl-canvas-container.maplibregl-touch-drag-pan .maplibregl-canvas{touch-action:pinch-zoom}.maplibregl-canvas-container.maplibregl-touch-zoom-rotate.maplibregl-touch-drag-pan,.maplibregl-canvas-container.maplibregl-touch-zoom-rotate.maplibregl-touch-drag-pan .maplibregl-canvas{touch-action:none}.maplibregl-canvas-container.maplibregl-touch-drag-pan.maplibregl-cooperative-gestures,.maplibregl-canvas-container.maplibregl-touch-drag-pan.maplibregl-cooperative-gestures .maplibregl-canvas{touch-action:pan-x pan-y}.maplibregl-ctrl-bottom-left,.maplibregl-ctrl-bottom-right,.maplibregl-ctrl-top-left,.maplibregl-ctrl-top-right{pointer-events:none;position:absolute;z-index:2}.maplibregl-ctrl-top-left{left:0;top:0}.maplibregl-ctrl-top-right{right:0;top:0}.maplibregl-ctrl-bottom-left{bottom:0;left:0}.maplibregl-ctrl-bottom-right{bottom:0;right:0}.maplibregl-ctrl{clear:both;pointer-events:auto;transform:translate(0)}.maplibregl-ctrl-top-left .maplibregl-ctrl{float:left;margin:10px 0 0 10px}.maplibregl-ctrl-top-right .maplibregl-ctrl{float:right;margin:10px 10px 0 0}.maplibregl-ctrl-bottom-left .maplibregl-ctrl{float:left;margin:0 0 10px 10px}.maplibregl-ctrl-bottom-right .maplibregl-ctrl{float:right;margin:0 10px 10px 0}.maplibregl-ctrl-group{background:#fff;border-radius:4px}.maplibregl-ctrl-group:not(:empty){box-shadow:0 0 0 2px #0000001a}@media (forced-colors:active){.maplibregl-ctrl-group:not(:empty){box-shadow:0 0 0 2px ButtonText}}.maplibregl-ctrl-group button{background-color:transparent;border:0;box-sizing:border-box;cursor:pointer;display:block;height:29px;outline:none;padding:0;width:29px}.maplibregl-ctrl-group button+button{border-top:1px solid #ddd}.maplibregl-ctrl button .maplibregl-ctrl-icon{background-position:50%;background-repeat:no-repeat;display:block;height:100%;width:100%}@media (forced-colors:active){.maplibregl-ctrl-icon{background-color:transparent}.maplibregl-ctrl-group button+button{border-top:1px solid ButtonText}}.maplibregl-ctrl button::-moz-focus-inner{border:0;padding:0}.maplibregl-ctrl-attrib-button:focus,.maplibregl-ctrl-group button:focus{box-shadow:0 0 2px 2px #0096ff}.maplibregl-ctrl button:disabled{cursor:not-allowed}.maplibregl-ctrl button:disabled .maplibregl-ctrl-icon{opacity:.25}@media (hover:hover){.maplibregl-ctrl button:not(:disabled):hover{background-color:#0000000d}}.maplibregl-ctrl button:not(:disabled):active{background-color:#0000000d}.maplibregl-ctrl-group button:focus:focus-visible{box-shadow:0 0 2px 2px #0096ff}.maplibregl-ctrl-group button:focus:not(:focus-visible){box-shadow:none}.maplibregl-ctrl-group button:focus:first-child{border-radius:4px 4px 0 0}.maplibregl-ctrl-group button:focus:last-child{border-radius:0 0 4px 4px}.maplibregl-ctrl-group button:focus:only-child{border-radius:inherit}.maplibregl-ctrl button.maplibregl-ctrl-zoom-out .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23333' viewBox='0 0 29 29'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-zoom-in .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23333' viewBox='0 0 29 29'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5'/%3E%3C/svg%3E")}@media (forced-colors:active){.maplibregl-ctrl button.maplibregl-ctrl-zoom-out .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23fff' viewBox='0 0 29 29'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-zoom-in .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23fff' viewBox='0 0 29 29'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5'/%3E%3C/svg%3E")}}@media (forced-colors:active) and (prefers-color-scheme:light){.maplibregl-ctrl button.maplibregl-ctrl-zoom-out .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' viewBox='0 0 29 29'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-zoom-in .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' viewBox='0 0 29 29'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5'/%3E%3C/svg%3E")}}.maplibregl-ctrl button.maplibregl-ctrl-fullscreen .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23333' viewBox='0 0 29 29'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-shrink .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' viewBox='0 0 29 29'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1z'/%3E%3C/svg%3E")}@media (forced-colors:active){.maplibregl-ctrl button.maplibregl-ctrl-fullscreen .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23fff' viewBox='0 0 29 29'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-shrink .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23fff' viewBox='0 0 29 29'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1z'/%3E%3C/svg%3E")}}@media (forced-colors:active) and (prefers-color-scheme:light){.maplibregl-ctrl button.maplibregl-ctrl-fullscreen .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' viewBox='0 0 29 29'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-shrink .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' viewBox='0 0 29 29'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1z'/%3E%3C/svg%3E")}}.maplibregl-ctrl button.maplibregl-ctrl-compass .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23333' viewBox='0 0 29 29'%3E%3Cpath d='m10.5 14 4-8 4 8z'/%3E%3Cpath fill='%23ccc' d='m10.5 16 4 8 4-8z'/%3E%3C/svg%3E")}@media (forced-colors:active){.maplibregl-ctrl button.maplibregl-ctrl-compass .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23fff' viewBox='0 0 29 29'%3E%3Cpath d='m10.5 14 4-8 4 8z'/%3E%3Cpath fill='%23ccc' d='m10.5 16 4 8 4-8z'/%3E%3C/svg%3E")}}@media (forced-colors:active) and (prefers-color-scheme:light){.maplibregl-ctrl button.maplibregl-ctrl-compass .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' viewBox='0 0 29 29'%3E%3Cpath d='m10.5 14 4-8 4 8z'/%3E%3Cpath fill='%23ccc' d='m10.5 16 4 8 4-8z'/%3E%3C/svg%3E")}}.maplibregl-ctrl button.maplibregl-ctrl-globe .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='22' height='22' fill='none' stroke='%23333' viewBox='0 0 22 22'%3E%3Ccircle cx='11' cy='11' r='8.5'/%3E%3Cpath d='M17.5 11c0 4.819-3.02 8.5-6.5 8.5S4.5 15.819 4.5 11 7.52 2.5 11 2.5s6.5 3.681 6.5 8.5Z'/%3E%3Cpath d='M13.5 11c0 2.447-.331 4.64-.853 6.206-.262.785-.562 1.384-.872 1.777-.314.399-.58.517-.775.517s-.461-.118-.775-.517c-.31-.393-.61-.992-.872-1.777C8.831 15.64 8.5 13.446 8.5 11s.331-4.64.853-6.206c.262-.785.562-1.384.872-1.777.314-.399.58-.517.775-.517s.461.118.775.517c.31.393.61.992.872 1.777.522 1.565.853 3.76.853 6.206Z'/%3E%3Cpath d='M11 7.5c-1.909 0-3.622-.166-4.845-.428-.616-.132-1.08-.283-1.379-.434a1.3 1.3 0 0 1-.224-.138q.07-.058.224-.138c.299-.151.763-.302 1.379-.434C7.378 5.666 9.091 5.5 11 5.5s3.622.166 4.845.428c.616.132 1.08.283 1.379.434.105.053.177.1.224.138q-.07.058-.224.138c-.299.151-.763.302-1.379.434-1.223.262-2.936.428-4.845.428ZM4.486 6.436ZM11 16.5c-1.909 0-3.622-.166-4.845-.428-.616-.132-1.08-.283-1.379-.434a1.3 1.3 0 0 1-.224-.138 1.3 1.3 0 0 1 .224-.138c.299-.151.763-.302 1.379-.434C7.378 14.666 9.091 14.5 11 14.5s3.622.166 4.845.428c.616.132 1.08.283 1.379.434.105.053.177.1.224.138a1.3 1.3 0 0 1-.224.138c-.299.151-.763.302-1.379.434-1.223.262-2.936.428-4.845.428Zm-6.514-1.064ZM11 12.5c-2.46 0-4.672-.222-6.255-.574-.796-.177-1.406-.38-1.805-.59a1.5 1.5 0 0 1-.39-.272.3.3 0 0 1-.047-.064.3.3 0 0 1 .048-.064c.066-.073.189-.167.389-.272.399-.21 1.009-.413 1.805-.59C6.328 9.722 8.54 9.5 11 9.5s4.672.222 6.256.574c.795.177 1.405.38 1.804.59.2.105.323.2.39.272a.3.3 0 0 1 .047.064.3.3 0 0 1-.048.064 1.4 1.4 0 0 1-.389.272c-.399.21-1.009.413-1.804.59-1.584.352-3.796.574-6.256.574Zm-8.501-1.51v.002zm0 .018v.002zm17.002.002v-.002zm0-.018v-.002z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-globe-enabled .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='22' height='22' fill='none' stroke='%2333b5e5' viewBox='0 0 22 22'%3E%3Ccircle cx='11' cy='11' r='8.5'/%3E%3Cpath d='M17.5 11c0 4.819-3.02 8.5-6.5 8.5S4.5 15.819 4.5 11 7.52 2.5 11 2.5s6.5 3.681 6.5 8.5Z'/%3E%3Cpath d='M13.5 11c0 2.447-.331 4.64-.853 6.206-.262.785-.562 1.384-.872 1.777-.314.399-.58.517-.775.517s-.461-.118-.775-.517c-.31-.393-.61-.992-.872-1.777C8.831 15.64 8.5 13.446 8.5 11s.331-4.64.853-6.206c.262-.785.562-1.384.872-1.777.314-.399.58-.517.775-.517s.461.118.775.517c.31.393.61.992.872 1.777.522 1.565.853 3.76.853 6.206Z'/%3E%3Cpath d='M11 7.5c-1.909 0-3.622-.166-4.845-.428-.616-.132-1.08-.283-1.379-.434a1.3 1.3 0 0 1-.224-.138q.07-.058.224-.138c.299-.151.763-.302 1.379-.434C7.378 5.666 9.091 5.5 11 5.5s3.622.166 4.845.428c.616.132 1.08.283 1.379.434.105.053.177.1.224.138q-.07.058-.224.138c-.299.151-.763.302-1.379.434-1.223.262-2.936.428-4.845.428ZM4.486 6.436ZM11 16.5c-1.909 0-3.622-.166-4.845-.428-.616-.132-1.08-.283-1.379-.434a1.3 1.3 0 0 1-.224-.138 1.3 1.3 0 0 1 .224-.138c.299-.151.763-.302 1.379-.434C7.378 14.666 9.091 14.5 11 14.5s3.622.166 4.845.428c.616.132 1.08.283 1.379.434.105.053.177.1.224.138a1.3 1.3 0 0 1-.224.138c-.299.151-.763.302-1.379.434-1.223.262-2.936.428-4.845.428Zm-6.514-1.064ZM11 12.5c-2.46 0-4.672-.222-6.255-.574-.796-.177-1.406-.38-1.805-.59a1.5 1.5 0 0 1-.39-.272.3.3 0 0 1-.047-.064.3.3 0 0 1 .048-.064c.066-.073.189-.167.389-.272.399-.21 1.009-.413 1.805-.59C6.328 9.722 8.54 9.5 11 9.5s4.672.222 6.256.574c.795.177 1.405.38 1.804.59.2.105.323.2.39.272a.3.3 0 0 1 .047.064.3.3 0 0 1-.048.064 1.4 1.4 0 0 1-.389.272c-.399.21-1.009.413-1.804.59-1.584.352-3.796.574-6.256.574Zm-8.501-1.51v.002zm0 .018v.002zm17.002.002v-.002zm0-.018v-.002z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-terrain .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='22' height='22' fill='%23333' viewBox='0 0 22 22'%3E%3Cpath d='m1.754 13.406 4.453-4.851 3.09 3.09 3.281 3.277.969-.969-3.309-3.312 3.844-4.121 6.148 6.886h1.082v-.855l-7.207-8.07-4.84 5.187L6.169 6.57l-5.48 5.965v.871ZM.688 16.844h20.625v1.375H.688Zm0 0'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-terrain-enabled .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='22' height='22' fill='%2333b5e5' viewBox='0 0 22 22'%3E%3Cpath d='m1.754 13.406 4.453-4.851 3.09 3.09 3.281 3.277.969-.969-3.309-3.312 3.844-4.121 6.148 6.886h1.082v-.855l-7.207-8.07-4.84 5.187L6.169 6.57l-5.48 5.965v.871ZM.688 16.844h20.625v1.375H.688Zm0 0'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23333' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate:disabled .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23aaa' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath fill='red' d='m14 5 1 1-9 9-1-1z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-active .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%2333b5e5' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-active-error .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23e58978' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-background .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%2333b5e5' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-background-error .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23e54e33' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-waiting .maplibregl-ctrl-icon{animation:maplibregl-spin 2s linear infinite}@media (forced-colors:active){.maplibregl-ctrl button.maplibregl-ctrl-geolocate .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23fff' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate:disabled .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23999' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath fill='red' d='m14 5 1 1-9 9-1-1z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-active .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%2333b5e5' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-active-error .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23e58978' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-background .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%2333b5e5' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-background-error .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23e54e33' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3C/svg%3E")}}@media (forced-colors:active) and (prefers-color-scheme:light){.maplibregl-ctrl button.maplibregl-ctrl-geolocate .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate:disabled .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23666' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath fill='red' d='m14 5 1 1-9 9-1-1z'/%3E%3C/svg%3E")}}@keyframes maplibregl-spin{0%{transform:rotate(0)}to{transform:rotate(1turn)}}a.maplibregl-ctrl-logo{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='88' height='23' fill='none'%3E%3Cpath fill='%23000' fill-opacity='.4' fill-rule='evenodd' d='M17.408 16.796h-1.827l2.501-12.095h.198l3.324 6.533.988 2.19.988-2.19 3.258-6.533h.181l2.6 12.095h-1.81l-1.218-5.644-.362-1.71-.658 1.71-2.929 5.644h-.098l-2.914-5.644-.757-1.71-.345 1.71zm1.958-3.42-.726 3.663a1.255 1.255 0 0 1-1.232 1.011h-1.827a1.255 1.255 0 0 1-1.229-1.509l2.501-12.095a1.255 1.255 0 0 1 1.23-1.001h.197a1.25 1.25 0 0 1 1.12.685l3.19 6.273 3.125-6.263a1.25 1.25 0 0 1 1.123-.695h.181a1.255 1.255 0 0 1 1.227.991l1.443 6.71a5 5 0 0 1 .314-.787l.009-.016a4.6 4.6 0 0 1 1.777-1.887c.782-.46 1.668-.667 2.611-.667a4.6 4.6 0 0 1 1.7.32l.306.134c.21-.16.474-.256.759-.256h1.694a1.255 1.255 0 0 1 1.212.925 1.255 1.255 0 0 1 1.212-.925h1.711c.284 0 .545.094.755.252.613-.3 1.312-.45 2.075-.45 1.356 0 2.557.445 3.482 1.4q.47.48.763 1.064V4.701a1.255 1.255 0 0 1 1.255-1.255h1.86A1.255 1.255 0 0 1 54.44 4.7v9.194h2.217c.19 0 .37.043.532.118v-4.77c0-.356.147-.678.385-.906a2.42 2.42 0 0 1-.682-1.71c0-.665.267-1.253.735-1.7a2.45 2.45 0 0 1 1.722-.674 2.43 2.43 0 0 1 1.705.675q.318.302.504.683V4.7a1.255 1.255 0 0 1 1.255-1.255h1.744A1.255 1.255 0 0 1 65.812 4.7v3.335a4.8 4.8 0 0 1 1.526-.246c.938 0 1.817.214 2.59.69a4.47 4.47 0 0 1 1.67 1.743v-.98a1.255 1.255 0 0 1 1.256-1.256h1.777c.233 0 .451.064.639.174a3.4 3.4 0 0 1 1.567-.372c.346 0 .861.02 1.285.232a1.25 1.25 0 0 1 .689 1.004 4.7 4.7 0 0 1 .853-.588c.795-.44 1.675-.647 2.61-.647 1.385 0 2.65.39 3.525 1.396.836.938 1.168 2.173 1.168 3.528q-.001.515-.056 1.051a1.255 1.255 0 0 1-.947 1.09l.408.952a1.255 1.255 0 0 1-.477 1.552c-.418.268-.92.463-1.458.612-.613.171-1.304.244-2.049.244-1.06 0-2.043-.207-2.886-.698l-.015-.008c-.798-.48-1.419-1.135-1.818-1.963l-.004-.008a5.8 5.8 0 0 1-.548-2.512q0-.429.053-.843a1.3 1.3 0 0 1-.333-.086l-.166-.004c-.223 0-.426.062-.643.228-.03.024-.142.139-.142.59v3.883a1.255 1.255 0 0 1-1.256 1.256h-1.777a1.255 1.255 0 0 1-1.256-1.256V15.69l-.032.057a4.8 4.8 0 0 1-1.86 1.833 5.04 5.04 0 0 1-2.484.634 4.5 4.5 0 0 1-1.935-.424 1.25 1.25 0 0 1-.764.258h-1.71a1.255 1.255 0 0 1-1.256-1.255V7.687a2.4 2.4 0 0 1-.428.625c.253.23.412.561.412.93v7.553a1.255 1.255 0 0 1-1.256 1.255h-1.843a1.25 1.25 0 0 1-.894-.373c-.228.23-.544.373-.894.373H51.32a1.255 1.255 0 0 1-1.256-1.255v-1.251l-.061.117a4.7 4.7 0 0 1-1.782 1.884 4.77 4.77 0 0 1-2.485.67 5.6 5.6 0 0 1-1.485-.188l.009 2.764a1.255 1.255 0 0 1-1.255 1.259h-1.729a1.255 1.255 0 0 1-1.255-1.255v-3.537a1.255 1.255 0 0 1-1.167.793h-1.679a1.25 1.25 0 0 1-.77-.263 4.5 4.5 0 0 1-1.945.429c-.885 0-1.724-.21-2.495-.632l-.017-.01a5 5 0 0 1-1.081-.836 1.255 1.255 0 0 1-1.254 1.312h-1.81a1.255 1.255 0 0 1-1.228-.99l-.782-3.625-2.044 3.939a1.25 1.25 0 0 1-1.115.676h-.098a1.25 1.25 0 0 1-1.116-.68l-2.061-3.994zM35.92 16.63l.207-.114.223-.15q.493-.356.735-.785l.061-.118.033 1.332h1.678V9.242h-1.694l-.033 1.267q-.133-.329-.526-.658l-.032-.028a3.2 3.2 0 0 0-.668-.428l-.27-.12a3.3 3.3 0 0 0-1.235-.23q-1.136-.001-1.974.493a3.36 3.36 0 0 0-1.3 1.382q-.445.89-.444 2.074 0 1.2.51 2.107a3.8 3.8 0 0 0 1.382 1.381 3.9 3.9 0 0 0 1.893.477q.795 0 1.455-.33zm-2.789-5.38q-.576.675-.575 1.762 0 1.102.559 1.794.576.675 1.645.675a2.25 2.25 0 0 0 .934-.19 2.2 2.2 0 0 0 .468-.29l.178-.161a2.2 2.2 0 0 0 .397-.561q.244-.5.244-1.15v-.115q0-.708-.296-1.267l-.043-.077a2.2 2.2 0 0 0-.633-.709l-.13-.086-.047-.028a2.1 2.1 0 0 0-1.073-.285q-1.052 0-1.629.692zm2.316 2.706c.163-.17.28-.407.28-.83v-.114c0-.292-.06-.508-.15-.68a.96.96 0 0 0-.353-.389.85.85 0 0 0-.464-.127c-.4 0-.56.114-.664.239l-.01.012c-.148.174-.275.45-.275.945 0 .506.122.801.27.99.097.11.266.224.68.224.303 0 .504-.09.687-.269zm7.545 1.705a2.6 2.6 0 0 0 .331.423q.319.33.755.548l.173.074q.65.255 1.49.255 1.02 0 1.844-.493a3.45 3.45 0 0 0 1.316-1.4q.493-.904.493-2.089 0-1.909-.988-2.913-.988-1.02-2.584-1.02-.898 0-1.575.347a3 3 0 0 0-.415.262l-.199.166a3.4 3.4 0 0 0-.64.82V9.242h-1.712v11.553h1.729l-.017-5.134zm.53-1.138q.206.29.48.5l.155.11.053.034q.51.296 1.119.297 1.07 0 1.645-.675.577-.69.576-1.762 0-1.119-.576-1.777-.558-.675-1.645-.675-.435 0-.835.16a2 2 0 0 0-.284.136 2 2 0 0 0-.363.254 2.2 2.2 0 0 0-.46.569l-.082.162a2.6 2.6 0 0 0-.213 1.072v.115q0 .707.296 1.267l.135.211zm.964-.818a1.1 1.1 0 0 0 .367.385.94.94 0 0 0 .476.118c.423 0 .59-.117.687-.23.159-.194.28-.478.28-.95 0-.53-.133-.8-.266-.952l-.021-.025c-.078-.094-.231-.221-.68-.221a1 1 0 0 0-.503.135l-.012.007a.86.86 0 0 0-.335.343c-.073.133-.132.324-.132.614v.115a1.4 1.4 0 0 0 .14.66zm15.7-6.222q.347-.346.346-.856a1.05 1.05 0 0 0-.345-.79 1.18 1.18 0 0 0-.84-.329q-.51 0-.855.33a1.05 1.05 0 0 0-.346.79q0 .51.346.855.345.346.856.346.51 0 .839-.346zm4.337 9.314.033-1.332q.191.403.59.747l.098.081a4 4 0 0 0 .316.224l.223.122a3.2 3.2 0 0 0 1.44.322 3.8 3.8 0 0 0 1.875-.477 3.5 3.5 0 0 0 1.382-1.366q.527-.89.526-2.09 0-1.184-.444-2.073a3.24 3.24 0 0 0-1.283-1.399q-.823-.51-1.942-.51a3.5 3.5 0 0 0-1.527.344l-.086.043-.165.09a3 3 0 0 0-.33.214q-.432.315-.656.707a2 2 0 0 0-.099.198l.082-1.283V4.701h-1.744v12.095zm.473-2.509a2.5 2.5 0 0 0 .566.7q.117.098.245.18l.144.08a2.1 2.1 0 0 0 .975.232q1.07 0 1.645-.675.576-.69.576-1.778 0-1.102-.576-1.777-.56-.691-1.645-.692a2.2 2.2 0 0 0-1.015.235q-.22.113-.415.282l-.15.142a2.1 2.1 0 0 0-.42.594q-.223.479-.223 1.1v.115q0 .705.293 1.26zm2.616-.293c.157-.191.28-.479.28-.967 0-.51-.13-.79-.276-.961l-.021-.026c-.082-.1-.232-.225-.67-.225a.87.87 0 0 0-.681.279l-.012.011c-.154.155-.274.38-.274.807v.115c0 .285.057.499.144.669a1.1 1.1 0 0 0 .367.405c.137.082.28.123.455.123.423 0 .59-.118.686-.23zm8.266-3.013q.345-.13.724-.14l.069-.002q.493 0 .642.099l.247-1.794q-.196-.099-.717-.099a2.3 2.3 0 0 0-.545.063 2 2 0 0 0-.411.148 2.2 2.2 0 0 0-.4.249 2.5 2.5 0 0 0-.485.499 2.7 2.7 0 0 0-.32.581l-.05.137v-1.48h-1.778v7.553h1.777v-3.884q0-.546.159-.943a1.5 1.5 0 0 1 .466-.636 2.5 2.5 0 0 1 .399-.253 2 2 0 0 1 .224-.099zm9.784 2.656.05-.922q0-1.743-.856-2.698-.838-.97-2.584-.97-1.119-.001-2.007.493a3.46 3.46 0 0 0-1.4 1.382q-.493.906-.493 2.106 0 1.07.428 1.975.428.89 1.332 1.432.906.526 2.255.526.973 0 1.668-.185l.044-.012.135-.04q.613-.184.984-.421l-.542-1.267q-.3.162-.642.274l-.297.087q-.51.131-1.3.131-.954 0-1.497-.444a1.6 1.6 0 0 1-.192-.193q-.366-.44-.512-1.234l-.004-.021zm-5.427-1.256-.003.022h3.752v-.138q-.011-.727-.288-1.118a1 1 0 0 0-.156-.176q-.46-.428-1.316-.428-.986 0-1.494.604-.379.45-.494 1.234zm-27.053 2.77V4.7h-1.86v12.095h5.333V15.15zm7.103-5.908v7.553h-1.843V9.242h1.843z'/%3E%3Cpath fill='%23fff' d='m19.63 11.151-.757-1.71-.345 1.71-1.12 5.644h-1.827L18.083 4.7h.197l3.325 6.533.988 2.19.988-2.19L26.839 4.7h.181l2.6 12.095h-1.81l-1.218-5.644-.362-1.71-.658 1.71-2.93 5.644h-.098l-2.913-5.644zm14.836 5.81q-1.02 0-1.893-.478a3.8 3.8 0 0 1-1.381-1.382q-.51-.906-.51-2.106 0-1.185.444-2.074a3.36 3.36 0 0 1 1.3-1.382q.839-.494 1.974-.494a3.3 3.3 0 0 1 1.234.231 3.3 3.3 0 0 1 .97.575q.396.33.527.659l.033-1.267h1.694v7.553H37.18l-.033-1.332q-.279.593-1.02 1.053a3.17 3.17 0 0 1-1.662.444zm.296-1.482q.938 0 1.58-.642.642-.66.642-1.711v-.115q0-.708-.296-1.267a2.2 2.2 0 0 0-.807-.872 2.1 2.1 0 0 0-1.119-.313q-1.053 0-1.629.692-.575.675-.575 1.76 0 1.103.559 1.795.577.675 1.645.675zm6.521-6.237h1.711v1.4q.906-1.597 2.83-1.597 1.596 0 2.584 1.02.988 1.005.988 2.914 0 1.185-.493 2.09a3.46 3.46 0 0 1-1.316 1.399 3.5 3.5 0 0 1-1.844.493q-.954 0-1.662-.329a2.67 2.67 0 0 1-1.086-.97l.017 5.134h-1.728zm4.048 6.22q1.07 0 1.645-.674.577-.69.576-1.762 0-1.119-.576-1.777-.558-.675-1.645-.675-.592 0-1.12.296-.51.28-.822.823-.296.527-.296 1.234v.115q0 .708.296 1.267.313.543.823.855.51.296 1.119.297z'/%3E%3Cpath fill='%23e1e3e9' d='M51.325 4.7h1.86v10.45h3.473v1.646h-5.333zm7.12 4.542h1.843v7.553h-1.843zm.905-1.415a1.16 1.16 0 0 1-.856-.346 1.17 1.17 0 0 1-.346-.856 1.05 1.05 0 0 1 .346-.79q.346-.329.856-.329.494 0 .839.33a1.05 1.05 0 0 1 .345.79 1.16 1.16 0 0 1-.345.855q-.33.346-.84.346zm7.875 9.133a3.17 3.17 0 0 1-1.662-.444q-.723-.46-1.004-1.053l-.033 1.332h-1.71V4.701h1.743v4.657l-.082 1.283q.279-.658 1.086-1.119a3.5 3.5 0 0 1 1.778-.477q1.119 0 1.942.51a3.24 3.24 0 0 1 1.283 1.4q.445.888.444 2.072 0 1.201-.526 2.09a3.5 3.5 0 0 1-1.382 1.366 3.8 3.8 0 0 1-1.876.477zm-.296-1.481q1.069 0 1.645-.675.577-.69.577-1.778 0-1.102-.577-1.776-.56-.691-1.645-.692a2.12 2.12 0 0 0-1.58.659q-.642.641-.642 1.694v.115q0 .71.296 1.267a2.4 2.4 0 0 0 .807.872 2.1 2.1 0 0 0 1.119.313zm5.927-6.237h1.777v1.481q.263-.757.856-1.217a2.14 2.14 0 0 1 1.349-.46q.527 0 .724.098l-.247 1.794q-.149-.099-.642-.099-.774 0-1.416.494-.626.493-.626 1.58v3.883h-1.777V9.242zm9.534 7.718q-1.35 0-2.255-.526-.904-.543-1.332-1.432a4.6 4.6 0 0 1-.428-1.975q0-1.2.493-2.106a3.46 3.46 0 0 1 1.4-1.382q.889-.495 2.007-.494 1.744 0 2.584.97.855.956.856 2.7 0 .444-.05.92h-5.43q.18 1.005.708 1.45.542.443 1.497.443.79 0 1.3-.131a4 4 0 0 0 .938-.362l.542 1.267q-.411.263-1.119.46-.708.198-1.711.197zm1.596-4.558q.016-1.02-.444-1.432-.46-.428-1.316-.428-1.728 0-1.991 1.86z'/%3E%3Cpath d='M5.074 15.948a.484.657 0 0 0-.486.659v1.84a.484.657 0 0 0 .486.659h4.101a.484.657 0 0 0 .486-.659v-1.84a.484.657 0 0 0-.486-.659zm3.56 1.16H5.617v.838h3.017z' style='fill:%23fff;fill-rule:evenodd;stroke-width:1.03600001'/%3E%3Cg style='stroke-width:1.12603545'%3E%3Cpath d='M-9.408-1.416c-3.833-.025-7.056 2.912-7.08 6.615-.02 3.08 1.653 4.832 3.107 6.268.903.892 1.721 1.74 2.32 2.902l-.525-.004c-.543-.003-.992.304-1.24.639a1.87 1.87 0 0 0-.362 1.121l-.011 1.877c-.003.402.104.787.347 1.125.244.338.688.653 1.23.656l4.142.028c.542.003.99-.306 1.238-.641a1.87 1.87 0 0 0 .363-1.121l.012-1.875a1.87 1.87 0 0 0-.348-1.127c-.243-.338-.688-.653-1.23-.656l-.518-.004c.597-1.145 1.425-1.983 2.348-2.87 1.473-1.414 3.18-3.149 3.2-6.226-.016-3.59-2.923-6.684-6.993-6.707m-.006 1.1v.002c3.274.02 5.92 2.532 5.9 5.6-.017 2.706-1.39 4.026-2.863 5.44-1.034.994-2.118 2.033-2.814 3.633-.018.041-.052.055-.075.065q-.013.004-.02.01a.34.34 0 0 1-.226.084.34.34 0 0 1-.224-.086l-.092-.077c-.699-1.615-1.768-2.669-2.781-3.67-1.454-1.435-2.797-2.762-2.78-5.478.02-3.067 2.7-5.545 5.975-5.523m-.02 2.826c-1.62-.01-2.944 1.315-2.955 2.96-.01 1.646 1.295 2.988 2.916 2.999h.002c1.621.01 2.943-1.316 2.953-2.961.011-1.646-1.294-2.988-2.916-2.998m-.005 1.1c1.017.006 1.829.83 1.822 1.89s-.83 1.874-1.848 1.867c-1.018-.006-1.829-.83-1.822-1.89s.83-1.874 1.848-1.868m-2.155 11.857 4.14.025c.271.002.49.305.487.676l-.013 1.875c-.003.37-.224.67-.495.668l-4.14-.025c-.27-.002-.487-.306-.485-.676l.012-1.875c.003-.37.224-.67.494-.668' style='color:%23000;font-style:normal;font-variant:normal;font-weight:400;font-stretch:normal;font-size:medium;line-height:normal;font-family:sans-serif;font-variant-ligatures:normal;font-variant-position:normal;font-variant-caps:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-feature-settings:normal;text-indent:0;text-align:start;text-decoration:none;text-decoration-line:none;text-decoration-style:solid;text-decoration-color:%23000;letter-spacing:normal;word-spacing:normal;text-transform:none;writing-mode:lr-tb;direction:ltr;text-orientation:mixed;dominant-baseline:auto;baseline-shift:baseline;text-anchor:start;white-space:normal;shape-padding:0;clip-rule:evenodd;display:inline;overflow:visible;visibility:visible;opacity:1;isolation:auto;mix-blend-mode:normal;color-interpolation:sRGB;color-interpolation-filters:linearRGB;solid-color:%23000;solid-opacity:1;vector-effect:none;fill:%23000;fill-opacity:.4;fill-rule:evenodd;stroke:none;stroke-width:2.47727823;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1;color-rendering:auto;image-rendering:auto;shape-rendering:auto;text-rendering:auto' transform='translate(15.553 2.85)scale(.88807)'/%3E%3Cpath d='M-9.415-.316C-12.69-.338-15.37 2.14-15.39 5.207c-.017 2.716 1.326 4.041 2.78 5.477 1.013 1 2.081 2.055 2.78 3.67l.092.076a.34.34 0 0 0 .225.086.34.34 0 0 0 .227-.083l.019-.01c.022-.009.057-.024.074-.064.697-1.6 1.78-2.64 2.814-3.634 1.473-1.414 2.847-2.733 2.864-5.44.02-3.067-2.627-5.58-5.901-5.601m-.057 8.784c1.621.011 2.944-1.315 2.955-2.96.01-1.646-1.295-2.988-2.916-2.999-1.622-.01-2.945 1.315-2.955 2.96s1.295 2.989 2.916 3' style='clip-rule:evenodd;fill:%23e1e3e9;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:2.47727823;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:.4' transform='translate(15.553 2.85)scale(.88807)'/%3E%3Cpath d='M-11.594 15.465c-.27-.002-.492.297-.494.668l-.012 1.876c-.003.371.214.673.485.675l4.14.027c.271.002.492-.298.495-.668l.012-1.877c.003-.37-.215-.672-.485-.674z' style='clip-rule:evenodd;fill:%23fff;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:2.47727823;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:.4' transform='translate(15.553 2.85)scale(.88807)'/%3E%3C/g%3E%3C/svg%3E");background-repeat:no-repeat;cursor:pointer;display:block;height:23px;margin:0 0 -4px -4px;overflow:hidden;width:88px}a.maplibregl-ctrl-logo.maplibregl-compact{width:14px}@media (forced-colors:active){a.maplibregl-ctrl-logo{background-color:transparent;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='88' height='23' fill='none'%3E%3Cpath fill='%23000' fill-opacity='.4' fill-rule='evenodd' d='M17.408 16.796h-1.827l2.501-12.095h.198l3.324 6.533.988 2.19.988-2.19 3.258-6.533h.181l2.6 12.095h-1.81l-1.218-5.644-.362-1.71-.658 1.71-2.929 5.644h-.098l-2.914-5.644-.757-1.71-.345 1.71zm1.958-3.42-.726 3.663a1.255 1.255 0 0 1-1.232 1.011h-1.827a1.255 1.255 0 0 1-1.229-1.509l2.501-12.095a1.255 1.255 0 0 1 1.23-1.001h.197a1.25 1.25 0 0 1 1.12.685l3.19 6.273 3.125-6.263a1.25 1.25 0 0 1 1.123-.695h.181a1.255 1.255 0 0 1 1.227.991l1.443 6.71a5 5 0 0 1 .314-.787l.009-.016a4.6 4.6 0 0 1 1.777-1.887c.782-.46 1.668-.667 2.611-.667a4.6 4.6 0 0 1 1.7.32l.306.134c.21-.16.474-.256.759-.256h1.694a1.255 1.255 0 0 1 1.212.925 1.255 1.255 0 0 1 1.212-.925h1.711c.284 0 .545.094.755.252.613-.3 1.312-.45 2.075-.45 1.356 0 2.557.445 3.482 1.4q.47.48.763 1.064V4.701a1.255 1.255 0 0 1 1.255-1.255h1.86A1.255 1.255 0 0 1 54.44 4.7v9.194h2.217c.19 0 .37.043.532.118v-4.77c0-.356.147-.678.385-.906a2.42 2.42 0 0 1-.682-1.71c0-.665.267-1.253.735-1.7a2.45 2.45 0 0 1 1.722-.674 2.43 2.43 0 0 1 1.705.675q.318.302.504.683V4.7a1.255 1.255 0 0 1 1.255-1.255h1.744A1.255 1.255 0 0 1 65.812 4.7v3.335a4.8 4.8 0 0 1 1.526-.246c.938 0 1.817.214 2.59.69a4.47 4.47 0 0 1 1.67 1.743v-.98a1.255 1.255 0 0 1 1.256-1.256h1.777c.233 0 .451.064.639.174a3.4 3.4 0 0 1 1.567-.372c.346 0 .861.02 1.285.232a1.25 1.25 0 0 1 .689 1.004 4.7 4.7 0 0 1 .853-.588c.795-.44 1.675-.647 2.61-.647 1.385 0 2.65.39 3.525 1.396.836.938 1.168 2.173 1.168 3.528q-.001.515-.056 1.051a1.255 1.255 0 0 1-.947 1.09l.408.952a1.255 1.255 0 0 1-.477 1.552c-.418.268-.92.463-1.458.612-.613.171-1.304.244-2.049.244-1.06 0-2.043-.207-2.886-.698l-.015-.008c-.798-.48-1.419-1.135-1.818-1.963l-.004-.008a5.8 5.8 0 0 1-.548-2.512q0-.429.053-.843a1.3 1.3 0 0 1-.333-.086l-.166-.004c-.223 0-.426.062-.643.228-.03.024-.142.139-.142.59v3.883a1.255 1.255 0 0 1-1.256 1.256h-1.777a1.255 1.255 0 0 1-1.256-1.256V15.69l-.032.057a4.8 4.8 0 0 1-1.86 1.833 5.04 5.04 0 0 1-2.484.634 4.5 4.5 0 0 1-1.935-.424 1.25 1.25 0 0 1-.764.258h-1.71a1.255 1.255 0 0 1-1.256-1.255V7.687a2.4 2.4 0 0 1-.428.625c.253.23.412.561.412.93v7.553a1.255 1.255 0 0 1-1.256 1.255h-1.843a1.25 1.25 0 0 1-.894-.373c-.228.23-.544.373-.894.373H51.32a1.255 1.255 0 0 1-1.256-1.255v-1.251l-.061.117a4.7 4.7 0 0 1-1.782 1.884 4.77 4.77 0 0 1-2.485.67 5.6 5.6 0 0 1-1.485-.188l.009 2.764a1.255 1.255 0 0 1-1.255 1.259h-1.729a1.255 1.255 0 0 1-1.255-1.255v-3.537a1.255 1.255 0 0 1-1.167.793h-1.679a1.25 1.25 0 0 1-.77-.263 4.5 4.5 0 0 1-1.945.429c-.885 0-1.724-.21-2.495-.632l-.017-.01a5 5 0 0 1-1.081-.836 1.255 1.255 0 0 1-1.254 1.312h-1.81a1.255 1.255 0 0 1-1.228-.99l-.782-3.625-2.044 3.939a1.25 1.25 0 0 1-1.115.676h-.098a1.25 1.25 0 0 1-1.116-.68l-2.061-3.994zM35.92 16.63l.207-.114.223-.15q.493-.356.735-.785l.061-.118.033 1.332h1.678V9.242h-1.694l-.033 1.267q-.133-.329-.526-.658l-.032-.028a3.2 3.2 0 0 0-.668-.428l-.27-.12a3.3 3.3 0 0 0-1.235-.23q-1.136-.001-1.974.493a3.36 3.36 0 0 0-1.3 1.382q-.445.89-.444 2.074 0 1.2.51 2.107a3.8 3.8 0 0 0 1.382 1.381 3.9 3.9 0 0 0 1.893.477q.795 0 1.455-.33zm-2.789-5.38q-.576.675-.575 1.762 0 1.102.559 1.794.576.675 1.645.675a2.25 2.25 0 0 0 .934-.19 2.2 2.2 0 0 0 .468-.29l.178-.161a2.2 2.2 0 0 0 .397-.561q.244-.5.244-1.15v-.115q0-.708-.296-1.267l-.043-.077a2.2 2.2 0 0 0-.633-.709l-.13-.086-.047-.028a2.1 2.1 0 0 0-1.073-.285q-1.052 0-1.629.692zm2.316 2.706c.163-.17.28-.407.28-.83v-.114c0-.292-.06-.508-.15-.68a.96.96 0 0 0-.353-.389.85.85 0 0 0-.464-.127c-.4 0-.56.114-.664.239l-.01.012c-.148.174-.275.45-.275.945 0 .506.122.801.27.99.097.11.266.224.68.224.303 0 .504-.09.687-.269zm7.545 1.705a2.6 2.6 0 0 0 .331.423q.319.33.755.548l.173.074q.65.255 1.49.255 1.02 0 1.844-.493a3.45 3.45 0 0 0 1.316-1.4q.493-.904.493-2.089 0-1.909-.988-2.913-.988-1.02-2.584-1.02-.898 0-1.575.347a3 3 0 0 0-.415.262l-.199.166a3.4 3.4 0 0 0-.64.82V9.242h-1.712v11.553h1.729l-.017-5.134zm.53-1.138q.206.29.48.5l.155.11.053.034q.51.296 1.119.297 1.07 0 1.645-.675.577-.69.576-1.762 0-1.119-.576-1.777-.558-.675-1.645-.675-.435 0-.835.16a2 2 0 0 0-.284.136 2 2 0 0 0-.363.254 2.2 2.2 0 0 0-.46.569l-.082.162a2.6 2.6 0 0 0-.213 1.072v.115q0 .707.296 1.267l.135.211zm.964-.818a1.1 1.1 0 0 0 .367.385.94.94 0 0 0 .476.118c.423 0 .59-.117.687-.23.159-.194.28-.478.28-.95 0-.53-.133-.8-.266-.952l-.021-.025c-.078-.094-.231-.221-.68-.221a1 1 0 0 0-.503.135l-.012.007a.86.86 0 0 0-.335.343c-.073.133-.132.324-.132.614v.115a1.4 1.4 0 0 0 .14.66zm15.7-6.222q.347-.346.346-.856a1.05 1.05 0 0 0-.345-.79 1.18 1.18 0 0 0-.84-.329q-.51 0-.855.33a1.05 1.05 0 0 0-.346.79q0 .51.346.855.345.346.856.346.51 0 .839-.346zm4.337 9.314.033-1.332q.191.403.59.747l.098.081a4 4 0 0 0 .316.224l.223.122a3.2 3.2 0 0 0 1.44.322 3.8 3.8 0 0 0 1.875-.477 3.5 3.5 0 0 0 1.382-1.366q.527-.89.526-2.09 0-1.184-.444-2.073a3.24 3.24 0 0 0-1.283-1.399q-.823-.51-1.942-.51a3.5 3.5 0 0 0-1.527.344l-.086.043-.165.09a3 3 0 0 0-.33.214q-.432.315-.656.707a2 2 0 0 0-.099.198l.082-1.283V4.701h-1.744v12.095zm.473-2.509a2.5 2.5 0 0 0 .566.7q.117.098.245.18l.144.08a2.1 2.1 0 0 0 .975.232q1.07 0 1.645-.675.576-.69.576-1.778 0-1.102-.576-1.777-.56-.691-1.645-.692a2.2 2.2 0 0 0-1.015.235q-.22.113-.415.282l-.15.142a2.1 2.1 0 0 0-.42.594q-.223.479-.223 1.1v.115q0 .705.293 1.26zm2.616-.293c.157-.191.28-.479.28-.967 0-.51-.13-.79-.276-.961l-.021-.026c-.082-.1-.232-.225-.67-.225a.87.87 0 0 0-.681.279l-.012.011c-.154.155-.274.38-.274.807v.115c0 .285.057.499.144.669a1.1 1.1 0 0 0 .367.405c.137.082.28.123.455.123.423 0 .59-.118.686-.23zm8.266-3.013q.345-.13.724-.14l.069-.002q.493 0 .642.099l.247-1.794q-.196-.099-.717-.099a2.3 2.3 0 0 0-.545.063 2 2 0 0 0-.411.148 2.2 2.2 0 0 0-.4.249 2.5 2.5 0 0 0-.485.499 2.7 2.7 0 0 0-.32.581l-.05.137v-1.48h-1.778v7.553h1.777v-3.884q0-.546.159-.943a1.5 1.5 0 0 1 .466-.636 2.5 2.5 0 0 1 .399-.253 2 2 0 0 1 .224-.099zm9.784 2.656.05-.922q0-1.743-.856-2.698-.838-.97-2.584-.97-1.119-.001-2.007.493a3.46 3.46 0 0 0-1.4 1.382q-.493.906-.493 2.106 0 1.07.428 1.975.428.89 1.332 1.432.906.526 2.255.526.973 0 1.668-.185l.044-.012.135-.04q.613-.184.984-.421l-.542-1.267q-.3.162-.642.274l-.297.087q-.51.131-1.3.131-.954 0-1.497-.444a1.6 1.6 0 0 1-.192-.193q-.366-.44-.512-1.234l-.004-.021zm-5.427-1.256-.003.022h3.752v-.138q-.011-.727-.288-1.118a1 1 0 0 0-.156-.176q-.46-.428-1.316-.428-.986 0-1.494.604-.379.45-.494 1.234zm-27.053 2.77V4.7h-1.86v12.095h5.333V15.15zm7.103-5.908v7.553h-1.843V9.242h1.843z'/%3E%3Cpath fill='%23fff' d='m19.63 11.151-.757-1.71-.345 1.71-1.12 5.644h-1.827L18.083 4.7h.197l3.325 6.533.988 2.19.988-2.19L26.839 4.7h.181l2.6 12.095h-1.81l-1.218-5.644-.362-1.71-.658 1.71-2.93 5.644h-.098l-2.913-5.644zm14.836 5.81q-1.02 0-1.893-.478a3.8 3.8 0 0 1-1.381-1.382q-.51-.906-.51-2.106 0-1.185.444-2.074a3.36 3.36 0 0 1 1.3-1.382q.839-.494 1.974-.494a3.3 3.3 0 0 1 1.234.231 3.3 3.3 0 0 1 .97.575q.396.33.527.659l.033-1.267h1.694v7.553H37.18l-.033-1.332q-.279.593-1.02 1.053a3.17 3.17 0 0 1-1.662.444zm.296-1.482q.938 0 1.58-.642.642-.66.642-1.711v-.115q0-.708-.296-1.267a2.2 2.2 0 0 0-.807-.872 2.1 2.1 0 0 0-1.119-.313q-1.053 0-1.629.692-.575.675-.575 1.76 0 1.103.559 1.795.577.675 1.645.675zm6.521-6.237h1.711v1.4q.906-1.597 2.83-1.597 1.596 0 2.584 1.02.988 1.005.988 2.914 0 1.185-.493 2.09a3.46 3.46 0 0 1-1.316 1.399 3.5 3.5 0 0 1-1.844.493q-.954 0-1.662-.329a2.67 2.67 0 0 1-1.086-.97l.017 5.134h-1.728zm4.048 6.22q1.07 0 1.645-.674.577-.69.576-1.762 0-1.119-.576-1.777-.558-.675-1.645-.675-.592 0-1.12.296-.51.28-.822.823-.296.527-.296 1.234v.115q0 .708.296 1.267.313.543.823.855.51.296 1.119.297z'/%3E%3Cpath fill='%23e1e3e9' d='M51.325 4.7h1.86v10.45h3.473v1.646h-5.333zm7.12 4.542h1.843v7.553h-1.843zm.905-1.415a1.16 1.16 0 0 1-.856-.346 1.17 1.17 0 0 1-.346-.856 1.05 1.05 0 0 1 .346-.79q.346-.329.856-.329.494 0 .839.33a1.05 1.05 0 0 1 .345.79 1.16 1.16 0 0 1-.345.855q-.33.346-.84.346zm7.875 9.133a3.17 3.17 0 0 1-1.662-.444q-.723-.46-1.004-1.053l-.033 1.332h-1.71V4.701h1.743v4.657l-.082 1.283q.279-.658 1.086-1.119a3.5 3.5 0 0 1 1.778-.477q1.119 0 1.942.51a3.24 3.24 0 0 1 1.283 1.4q.445.888.444 2.072 0 1.201-.526 2.09a3.5 3.5 0 0 1-1.382 1.366 3.8 3.8 0 0 1-1.876.477zm-.296-1.481q1.069 0 1.645-.675.577-.69.577-1.778 0-1.102-.577-1.776-.56-.691-1.645-.692a2.12 2.12 0 0 0-1.58.659q-.642.641-.642 1.694v.115q0 .71.296 1.267a2.4 2.4 0 0 0 .807.872 2.1 2.1 0 0 0 1.119.313zm5.927-6.237h1.777v1.481q.263-.757.856-1.217a2.14 2.14 0 0 1 1.349-.46q.527 0 .724.098l-.247 1.794q-.149-.099-.642-.099-.774 0-1.416.494-.626.493-.626 1.58v3.883h-1.777V9.242zm9.534 7.718q-1.35 0-2.255-.526-.904-.543-1.332-1.432a4.6 4.6 0 0 1-.428-1.975q0-1.2.493-2.106a3.46 3.46 0 0 1 1.4-1.382q.889-.495 2.007-.494 1.744 0 2.584.97.855.956.856 2.7 0 .444-.05.92h-5.43q.18 1.005.708 1.45.542.443 1.497.443.79 0 1.3-.131a4 4 0 0 0 .938-.362l.542 1.267q-.411.263-1.119.46-.708.198-1.711.197zm1.596-4.558q.016-1.02-.444-1.432-.46-.428-1.316-.428-1.728 0-1.991 1.86z'/%3E%3Cpath d='M5.074 15.948a.484.657 0 0 0-.486.659v1.84a.484.657 0 0 0 .486.659h4.101a.484.657 0 0 0 .486-.659v-1.84a.484.657 0 0 0-.486-.659zm3.56 1.16H5.617v.838h3.017z' style='fill:%23fff;fill-rule:evenodd;stroke-width:1.03600001'/%3E%3Cg style='stroke-width:1.12603545'%3E%3Cpath d='M-9.408-1.416c-3.833-.025-7.056 2.912-7.08 6.615-.02 3.08 1.653 4.832 3.107 6.268.903.892 1.721 1.74 2.32 2.902l-.525-.004c-.543-.003-.992.304-1.24.639a1.87 1.87 0 0 0-.362 1.121l-.011 1.877c-.003.402.104.787.347 1.125.244.338.688.653 1.23.656l4.142.028c.542.003.99-.306 1.238-.641a1.87 1.87 0 0 0 .363-1.121l.012-1.875a1.87 1.87 0 0 0-.348-1.127c-.243-.338-.688-.653-1.23-.656l-.518-.004c.597-1.145 1.425-1.983 2.348-2.87 1.473-1.414 3.18-3.149 3.2-6.226-.016-3.59-2.923-6.684-6.993-6.707m-.006 1.1v.002c3.274.02 5.92 2.532 5.9 5.6-.017 2.706-1.39 4.026-2.863 5.44-1.034.994-2.118 2.033-2.814 3.633-.018.041-.052.055-.075.065q-.013.004-.02.01a.34.34 0 0 1-.226.084.34.34 0 0 1-.224-.086l-.092-.077c-.699-1.615-1.768-2.669-2.781-3.67-1.454-1.435-2.797-2.762-2.78-5.478.02-3.067 2.7-5.545 5.975-5.523m-.02 2.826c-1.62-.01-2.944 1.315-2.955 2.96-.01 1.646 1.295 2.988 2.916 2.999h.002c1.621.01 2.943-1.316 2.953-2.961.011-1.646-1.294-2.988-2.916-2.998m-.005 1.1c1.017.006 1.829.83 1.822 1.89s-.83 1.874-1.848 1.867c-1.018-.006-1.829-.83-1.822-1.89s.83-1.874 1.848-1.868m-2.155 11.857 4.14.025c.271.002.49.305.487.676l-.013 1.875c-.003.37-.224.67-.495.668l-4.14-.025c-.27-.002-.487-.306-.485-.676l.012-1.875c.003-.37.224-.67.494-.668' style='color:%23000;font-style:normal;font-variant:normal;font-weight:400;font-stretch:normal;font-size:medium;line-height:normal;font-family:sans-serif;font-variant-ligatures:normal;font-variant-position:normal;font-variant-caps:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-feature-settings:normal;text-indent:0;text-align:start;text-decoration:none;text-decoration-line:none;text-decoration-style:solid;text-decoration-color:%23000;letter-spacing:normal;word-spacing:normal;text-transform:none;writing-mode:lr-tb;direction:ltr;text-orientation:mixed;dominant-baseline:auto;baseline-shift:baseline;text-anchor:start;white-space:normal;shape-padding:0;clip-rule:evenodd;display:inline;overflow:visible;visibility:visible;opacity:1;isolation:auto;mix-blend-mode:normal;color-interpolation:sRGB;color-interpolation-filters:linearRGB;solid-color:%23000;solid-opacity:1;vector-effect:none;fill:%23000;fill-opacity:.4;fill-rule:evenodd;stroke:none;stroke-width:2.47727823;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1;color-rendering:auto;image-rendering:auto;shape-rendering:auto;text-rendering:auto' transform='translate(15.553 2.85)scale(.88807)'/%3E%3Cpath d='M-9.415-.316C-12.69-.338-15.37 2.14-15.39 5.207c-.017 2.716 1.326 4.041 2.78 5.477 1.013 1 2.081 2.055 2.78 3.67l.092.076a.34.34 0 0 0 .225.086.34.34 0 0 0 .227-.083l.019-.01c.022-.009.057-.024.074-.064.697-1.6 1.78-2.64 2.814-3.634 1.473-1.414 2.847-2.733 2.864-5.44.02-3.067-2.627-5.58-5.901-5.601m-.057 8.784c1.621.011 2.944-1.315 2.955-2.96.01-1.646-1.295-2.988-2.916-2.999-1.622-.01-2.945 1.315-2.955 2.96s1.295 2.989 2.916 3' style='clip-rule:evenodd;fill:%23e1e3e9;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:2.47727823;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:.4' transform='translate(15.553 2.85)scale(.88807)'/%3E%3Cpath d='M-11.594 15.465c-.27-.002-.492.297-.494.668l-.012 1.876c-.003.371.214.673.485.675l4.14.027c.271.002.492-.298.495-.668l.012-1.877c.003-.37-.215-.672-.485-.674z' style='clip-rule:evenodd;fill:%23fff;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:2.47727823;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:.4' transform='translate(15.553 2.85)scale(.88807)'/%3E%3C/g%3E%3C/svg%3E")}}@media (forced-colors:active) and (prefers-color-scheme:light){a.maplibregl-ctrl-logo{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='88' height='23' fill='none'%3E%3Cpath fill='%23000' fill-opacity='.4' fill-rule='evenodd' d='M17.408 16.796h-1.827l2.501-12.095h.198l3.324 6.533.988 2.19.988-2.19 3.258-6.533h.181l2.6 12.095h-1.81l-1.218-5.644-.362-1.71-.658 1.71-2.929 5.644h-.098l-2.914-5.644-.757-1.71-.345 1.71zm1.958-3.42-.726 3.663a1.255 1.255 0 0 1-1.232 1.011h-1.827a1.255 1.255 0 0 1-1.229-1.509l2.501-12.095a1.255 1.255 0 0 1 1.23-1.001h.197a1.25 1.25 0 0 1 1.12.685l3.19 6.273 3.125-6.263a1.25 1.25 0 0 1 1.123-.695h.181a1.255 1.255 0 0 1 1.227.991l1.443 6.71a5 5 0 0 1 .314-.787l.009-.016a4.6 4.6 0 0 1 1.777-1.887c.782-.46 1.668-.667 2.611-.667a4.6 4.6 0 0 1 1.7.32l.306.134c.21-.16.474-.256.759-.256h1.694a1.255 1.255 0 0 1 1.212.925 1.255 1.255 0 0 1 1.212-.925h1.711c.284 0 .545.094.755.252.613-.3 1.312-.45 2.075-.45 1.356 0 2.557.445 3.482 1.4q.47.48.763 1.064V4.701a1.255 1.255 0 0 1 1.255-1.255h1.86A1.255 1.255 0 0 1 54.44 4.7v9.194h2.217c.19 0 .37.043.532.118v-4.77c0-.356.147-.678.385-.906a2.42 2.42 0 0 1-.682-1.71c0-.665.267-1.253.735-1.7a2.45 2.45 0 0 1 1.722-.674 2.43 2.43 0 0 1 1.705.675q.318.302.504.683V4.7a1.255 1.255 0 0 1 1.255-1.255h1.744A1.255 1.255 0 0 1 65.812 4.7v3.335a4.8 4.8 0 0 1 1.526-.246c.938 0 1.817.214 2.59.69a4.47 4.47 0 0 1 1.67 1.743v-.98a1.255 1.255 0 0 1 1.256-1.256h1.777c.233 0 .451.064.639.174a3.4 3.4 0 0 1 1.567-.372c.346 0 .861.02 1.285.232a1.25 1.25 0 0 1 .689 1.004 4.7 4.7 0 0 1 .853-.588c.795-.44 1.675-.647 2.61-.647 1.385 0 2.65.39 3.525 1.396.836.938 1.168 2.173 1.168 3.528q-.001.515-.056 1.051a1.255 1.255 0 0 1-.947 1.09l.408.952a1.255 1.255 0 0 1-.477 1.552c-.418.268-.92.463-1.458.612-.613.171-1.304.244-2.049.244-1.06 0-2.043-.207-2.886-.698l-.015-.008c-.798-.48-1.419-1.135-1.818-1.963l-.004-.008a5.8 5.8 0 0 1-.548-2.512q0-.429.053-.843a1.3 1.3 0 0 1-.333-.086l-.166-.004c-.223 0-.426.062-.643.228-.03.024-.142.139-.142.59v3.883a1.255 1.255 0 0 1-1.256 1.256h-1.777a1.255 1.255 0 0 1-1.256-1.256V15.69l-.032.057a4.8 4.8 0 0 1-1.86 1.833 5.04 5.04 0 0 1-2.484.634 4.5 4.5 0 0 1-1.935-.424 1.25 1.25 0 0 1-.764.258h-1.71a1.255 1.255 0 0 1-1.256-1.255V7.687a2.4 2.4 0 0 1-.428.625c.253.23.412.561.412.93v7.553a1.255 1.255 0 0 1-1.256 1.255h-1.843a1.25 1.25 0 0 1-.894-.373c-.228.23-.544.373-.894.373H51.32a1.255 1.255 0 0 1-1.256-1.255v-1.251l-.061.117a4.7 4.7 0 0 1-1.782 1.884 4.77 4.77 0 0 1-2.485.67 5.6 5.6 0 0 1-1.485-.188l.009 2.764a1.255 1.255 0 0 1-1.255 1.259h-1.729a1.255 1.255 0 0 1-1.255-1.255v-3.537a1.255 1.255 0 0 1-1.167.793h-1.679a1.25 1.25 0 0 1-.77-.263 4.5 4.5 0 0 1-1.945.429c-.885 0-1.724-.21-2.495-.632l-.017-.01a5 5 0 0 1-1.081-.836 1.255 1.255 0 0 1-1.254 1.312h-1.81a1.255 1.255 0 0 1-1.228-.99l-.782-3.625-2.044 3.939a1.25 1.25 0 0 1-1.115.676h-.098a1.25 1.25 0 0 1-1.116-.68l-2.061-3.994zM35.92 16.63l.207-.114.223-.15q.493-.356.735-.785l.061-.118.033 1.332h1.678V9.242h-1.694l-.033 1.267q-.133-.329-.526-.658l-.032-.028a3.2 3.2 0 0 0-.668-.428l-.27-.12a3.3 3.3 0 0 0-1.235-.23q-1.136-.001-1.974.493a3.36 3.36 0 0 0-1.3 1.382q-.445.89-.444 2.074 0 1.2.51 2.107a3.8 3.8 0 0 0 1.382 1.381 3.9 3.9 0 0 0 1.893.477q.795 0 1.455-.33zm-2.789-5.38q-.576.675-.575 1.762 0 1.102.559 1.794.576.675 1.645.675a2.25 2.25 0 0 0 .934-.19 2.2 2.2 0 0 0 .468-.29l.178-.161a2.2 2.2 0 0 0 .397-.561q.244-.5.244-1.15v-.115q0-.708-.296-1.267l-.043-.077a2.2 2.2 0 0 0-.633-.709l-.13-.086-.047-.028a2.1 2.1 0 0 0-1.073-.285q-1.052 0-1.629.692zm2.316 2.706c.163-.17.28-.407.28-.83v-.114c0-.292-.06-.508-.15-.68a.96.96 0 0 0-.353-.389.85.85 0 0 0-.464-.127c-.4 0-.56.114-.664.239l-.01.012c-.148.174-.275.45-.275.945 0 .506.122.801.27.99.097.11.266.224.68.224.303 0 .504-.09.687-.269zm7.545 1.705a2.6 2.6 0 0 0 .331.423q.319.33.755.548l.173.074q.65.255 1.49.255 1.02 0 1.844-.493a3.45 3.45 0 0 0 1.316-1.4q.493-.904.493-2.089 0-1.909-.988-2.913-.988-1.02-2.584-1.02-.898 0-1.575.347a3 3 0 0 0-.415.262l-.199.166a3.4 3.4 0 0 0-.64.82V9.242h-1.712v11.553h1.729l-.017-5.134zm.53-1.138q.206.29.48.5l.155.11.053.034q.51.296 1.119.297 1.07 0 1.645-.675.577-.69.576-1.762 0-1.119-.576-1.777-.558-.675-1.645-.675-.435 0-.835.16a2 2 0 0 0-.284.136 2 2 0 0 0-.363.254 2.2 2.2 0 0 0-.46.569l-.082.162a2.6 2.6 0 0 0-.213 1.072v.115q0 .707.296 1.267l.135.211zm.964-.818a1.1 1.1 0 0 0 .367.385.94.94 0 0 0 .476.118c.423 0 .59-.117.687-.23.159-.194.28-.478.28-.95 0-.53-.133-.8-.266-.952l-.021-.025c-.078-.094-.231-.221-.68-.221a1 1 0 0 0-.503.135l-.012.007a.86.86 0 0 0-.335.343c-.073.133-.132.324-.132.614v.115a1.4 1.4 0 0 0 .14.66zm15.7-6.222q.347-.346.346-.856a1.05 1.05 0 0 0-.345-.79 1.18 1.18 0 0 0-.84-.329q-.51 0-.855.33a1.05 1.05 0 0 0-.346.79q0 .51.346.855.345.346.856.346.51 0 .839-.346zm4.337 9.314.033-1.332q.191.403.59.747l.098.081a4 4 0 0 0 .316.224l.223.122a3.2 3.2 0 0 0 1.44.322 3.8 3.8 0 0 0 1.875-.477 3.5 3.5 0 0 0 1.382-1.366q.527-.89.526-2.09 0-1.184-.444-2.073a3.24 3.24 0 0 0-1.283-1.399q-.823-.51-1.942-.51a3.5 3.5 0 0 0-1.527.344l-.086.043-.165.09a3 3 0 0 0-.33.214q-.432.315-.656.707a2 2 0 0 0-.099.198l.082-1.283V4.701h-1.744v12.095zm.473-2.509a2.5 2.5 0 0 0 .566.7q.117.098.245.18l.144.08a2.1 2.1 0 0 0 .975.232q1.07 0 1.645-.675.576-.69.576-1.778 0-1.102-.576-1.777-.56-.691-1.645-.692a2.2 2.2 0 0 0-1.015.235q-.22.113-.415.282l-.15.142a2.1 2.1 0 0 0-.42.594q-.223.479-.223 1.1v.115q0 .705.293 1.26zm2.616-.293c.157-.191.28-.479.28-.967 0-.51-.13-.79-.276-.961l-.021-.026c-.082-.1-.232-.225-.67-.225a.87.87 0 0 0-.681.279l-.012.011c-.154.155-.274.38-.274.807v.115c0 .285.057.499.144.669a1.1 1.1 0 0 0 .367.405c.137.082.28.123.455.123.423 0 .59-.118.686-.23zm8.266-3.013q.345-.13.724-.14l.069-.002q.493 0 .642.099l.247-1.794q-.196-.099-.717-.099a2.3 2.3 0 0 0-.545.063 2 2 0 0 0-.411.148 2.2 2.2 0 0 0-.4.249 2.5 2.5 0 0 0-.485.499 2.7 2.7 0 0 0-.32.581l-.05.137v-1.48h-1.778v7.553h1.777v-3.884q0-.546.159-.943a1.5 1.5 0 0 1 .466-.636 2.5 2.5 0 0 1 .399-.253 2 2 0 0 1 .224-.099zm9.784 2.656.05-.922q0-1.743-.856-2.698-.838-.97-2.584-.97-1.119-.001-2.007.493a3.46 3.46 0 0 0-1.4 1.382q-.493.906-.493 2.106 0 1.07.428 1.975.428.89 1.332 1.432.906.526 2.255.526.973 0 1.668-.185l.044-.012.135-.04q.613-.184.984-.421l-.542-1.267q-.3.162-.642.274l-.297.087q-.51.131-1.3.131-.954 0-1.497-.444a1.6 1.6 0 0 1-.192-.193q-.366-.44-.512-1.234l-.004-.021zm-5.427-1.256-.003.022h3.752v-.138q-.011-.727-.288-1.118a1 1 0 0 0-.156-.176q-.46-.428-1.316-.428-.986 0-1.494.604-.379.45-.494 1.234zm-27.053 2.77V4.7h-1.86v12.095h5.333V15.15zm7.103-5.908v7.553h-1.843V9.242h1.843z'/%3E%3Cpath fill='%23fff' d='m19.63 11.151-.757-1.71-.345 1.71-1.12 5.644h-1.827L18.083 4.7h.197l3.325 6.533.988 2.19.988-2.19L26.839 4.7h.181l2.6 12.095h-1.81l-1.218-5.644-.362-1.71-.658 1.71-2.93 5.644h-.098l-2.913-5.644zm14.836 5.81q-1.02 0-1.893-.478a3.8 3.8 0 0 1-1.381-1.382q-.51-.906-.51-2.106 0-1.185.444-2.074a3.36 3.36 0 0 1 1.3-1.382q.839-.494 1.974-.494a3.3 3.3 0 0 1 1.234.231 3.3 3.3 0 0 1 .97.575q.396.33.527.659l.033-1.267h1.694v7.553H37.18l-.033-1.332q-.279.593-1.02 1.053a3.17 3.17 0 0 1-1.662.444zm.296-1.482q.938 0 1.58-.642.642-.66.642-1.711v-.115q0-.708-.296-1.267a2.2 2.2 0 0 0-.807-.872 2.1 2.1 0 0 0-1.119-.313q-1.053 0-1.629.692-.575.675-.575 1.76 0 1.103.559 1.795.577.675 1.645.675zm6.521-6.237h1.711v1.4q.906-1.597 2.83-1.597 1.596 0 2.584 1.02.988 1.005.988 2.914 0 1.185-.493 2.09a3.46 3.46 0 0 1-1.316 1.399 3.5 3.5 0 0 1-1.844.493q-.954 0-1.662-.329a2.67 2.67 0 0 1-1.086-.97l.017 5.134h-1.728zm4.048 6.22q1.07 0 1.645-.674.577-.69.576-1.762 0-1.119-.576-1.777-.558-.675-1.645-.675-.592 0-1.12.296-.51.28-.822.823-.296.527-.296 1.234v.115q0 .708.296 1.267.313.543.823.855.51.296 1.119.297z'/%3E%3Cpath fill='%23e1e3e9' d='M51.325 4.7h1.86v10.45h3.473v1.646h-5.333zm7.12 4.542h1.843v7.553h-1.843zm.905-1.415a1.16 1.16 0 0 1-.856-.346 1.17 1.17 0 0 1-.346-.856 1.05 1.05 0 0 1 .346-.79q.346-.329.856-.329.494 0 .839.33a1.05 1.05 0 0 1 .345.79 1.16 1.16 0 0 1-.345.855q-.33.346-.84.346zm7.875 9.133a3.17 3.17 0 0 1-1.662-.444q-.723-.46-1.004-1.053l-.033 1.332h-1.71V4.701h1.743v4.657l-.082 1.283q.279-.658 1.086-1.119a3.5 3.5 0 0 1 1.778-.477q1.119 0 1.942.51a3.24 3.24 0 0 1 1.283 1.4q.445.888.444 2.072 0 1.201-.526 2.09a3.5 3.5 0 0 1-1.382 1.366 3.8 3.8 0 0 1-1.876.477zm-.296-1.481q1.069 0 1.645-.675.577-.69.577-1.778 0-1.102-.577-1.776-.56-.691-1.645-.692a2.12 2.12 0 0 0-1.58.659q-.642.641-.642 1.694v.115q0 .71.296 1.267a2.4 2.4 0 0 0 .807.872 2.1 2.1 0 0 0 1.119.313zm5.927-6.237h1.777v1.481q.263-.757.856-1.217a2.14 2.14 0 0 1 1.349-.46q.527 0 .724.098l-.247 1.794q-.149-.099-.642-.099-.774 0-1.416.494-.626.493-.626 1.58v3.883h-1.777V9.242zm9.534 7.718q-1.35 0-2.255-.526-.904-.543-1.332-1.432a4.6 4.6 0 0 1-.428-1.975q0-1.2.493-2.106a3.46 3.46 0 0 1 1.4-1.382q.889-.495 2.007-.494 1.744 0 2.584.97.855.956.856 2.7 0 .444-.05.92h-5.43q.18 1.005.708 1.45.542.443 1.497.443.79 0 1.3-.131a4 4 0 0 0 .938-.362l.542 1.267q-.411.263-1.119.46-.708.198-1.711.197zm1.596-4.558q.016-1.02-.444-1.432-.46-.428-1.316-.428-1.728 0-1.991 1.86z'/%3E%3Cpath d='M5.074 15.948a.484.657 0 0 0-.486.659v1.84a.484.657 0 0 0 .486.659h4.101a.484.657 0 0 0 .486-.659v-1.84a.484.657 0 0 0-.486-.659zm3.56 1.16H5.617v.838h3.017z' style='fill:%23fff;fill-rule:evenodd;stroke-width:1.03600001'/%3E%3Cg style='stroke-width:1.12603545'%3E%3Cpath d='M-9.408-1.416c-3.833-.025-7.056 2.912-7.08 6.615-.02 3.08 1.653 4.832 3.107 6.268.903.892 1.721 1.74 2.32 2.902l-.525-.004c-.543-.003-.992.304-1.24.639a1.87 1.87 0 0 0-.362 1.121l-.011 1.877c-.003.402.104.787.347 1.125.244.338.688.653 1.23.656l4.142.028c.542.003.99-.306 1.238-.641a1.87 1.87 0 0 0 .363-1.121l.012-1.875a1.87 1.87 0 0 0-.348-1.127c-.243-.338-.688-.653-1.23-.656l-.518-.004c.597-1.145 1.425-1.983 2.348-2.87 1.473-1.414 3.18-3.149 3.2-6.226-.016-3.59-2.923-6.684-6.993-6.707m-.006 1.1v.002c3.274.02 5.92 2.532 5.9 5.6-.017 2.706-1.39 4.026-2.863 5.44-1.034.994-2.118 2.033-2.814 3.633-.018.041-.052.055-.075.065q-.013.004-.02.01a.34.34 0 0 1-.226.084.34.34 0 0 1-.224-.086l-.092-.077c-.699-1.615-1.768-2.669-2.781-3.67-1.454-1.435-2.797-2.762-2.78-5.478.02-3.067 2.7-5.545 5.975-5.523m-.02 2.826c-1.62-.01-2.944 1.315-2.955 2.96-.01 1.646 1.295 2.988 2.916 2.999h.002c1.621.01 2.943-1.316 2.953-2.961.011-1.646-1.294-2.988-2.916-2.998m-.005 1.1c1.017.006 1.829.83 1.822 1.89s-.83 1.874-1.848 1.867c-1.018-.006-1.829-.83-1.822-1.89s.83-1.874 1.848-1.868m-2.155 11.857 4.14.025c.271.002.49.305.487.676l-.013 1.875c-.003.37-.224.67-.495.668l-4.14-.025c-.27-.002-.487-.306-.485-.676l.012-1.875c.003-.37.224-.67.494-.668' style='color:%23000;font-style:normal;font-variant:normal;font-weight:400;font-stretch:normal;font-size:medium;line-height:normal;font-family:sans-serif;font-variant-ligatures:normal;font-variant-position:normal;font-variant-caps:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-feature-settings:normal;text-indent:0;text-align:start;text-decoration:none;text-decoration-line:none;text-decoration-style:solid;text-decoration-color:%23000;letter-spacing:normal;word-spacing:normal;text-transform:none;writing-mode:lr-tb;direction:ltr;text-orientation:mixed;dominant-baseline:auto;baseline-shift:baseline;text-anchor:start;white-space:normal;shape-padding:0;clip-rule:evenodd;display:inline;overflow:visible;visibility:visible;opacity:1;isolation:auto;mix-blend-mode:normal;color-interpolation:sRGB;color-interpolation-filters:linearRGB;solid-color:%23000;solid-opacity:1;vector-effect:none;fill:%23000;fill-opacity:.4;fill-rule:evenodd;stroke:none;stroke-width:2.47727823;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1;color-rendering:auto;image-rendering:auto;shape-rendering:auto;text-rendering:auto' transform='translate(15.553 2.85)scale(.88807)'/%3E%3Cpath d='M-9.415-.316C-12.69-.338-15.37 2.14-15.39 5.207c-.017 2.716 1.326 4.041 2.78 5.477 1.013 1 2.081 2.055 2.78 3.67l.092.076a.34.34 0 0 0 .225.086.34.34 0 0 0 .227-.083l.019-.01c.022-.009.057-.024.074-.064.697-1.6 1.78-2.64 2.814-3.634 1.473-1.414 2.847-2.733 2.864-5.44.02-3.067-2.627-5.58-5.901-5.601m-.057 8.784c1.621.011 2.944-1.315 2.955-2.96.01-1.646-1.295-2.988-2.916-2.999-1.622-.01-2.945 1.315-2.955 2.96s1.295 2.989 2.916 3' style='clip-rule:evenodd;fill:%23e1e3e9;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:2.47727823;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:.4' transform='translate(15.553 2.85)scale(.88807)'/%3E%3Cpath d='M-11.594 15.465c-.27-.002-.492.297-.494.668l-.012 1.876c-.003.371.214.673.485.675l4.14.027c.271.002.492-.298.495-.668l.012-1.877c.003-.37-.215-.672-.485-.674z' style='clip-rule:evenodd;fill:%23fff;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:2.47727823;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:.4' transform='translate(15.553 2.85)scale(.88807)'/%3E%3C/g%3E%3C/svg%3E")}}.maplibregl-ctrl.maplibregl-ctrl-attrib{background-color:#ffffff80;margin:0;padding:0 5px}@media screen{.maplibregl-ctrl-attrib.maplibregl-compact{background-color:#fff;border-radius:12px;box-sizing:content-box;color:#000;margin:10px;min-height:20px;padding:2px 24px 2px 0;position:relative}.maplibregl-ctrl-attrib.maplibregl-compact-show{padding:2px 28px 2px 8px;visibility:visible}.maplibregl-ctrl-bottom-left>.maplibregl-ctrl-attrib.maplibregl-compact-show,.maplibregl-ctrl-top-left>.maplibregl-ctrl-attrib.maplibregl-compact-show{border-radius:12px;padding:2px 8px 2px 28px}.maplibregl-ctrl-attrib.maplibregl-compact .maplibregl-ctrl-attrib-inner{display:none}.maplibregl-ctrl-attrib-button{background-color:#ffffff80;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' fill-rule='evenodd' viewBox='0 0 20 20'%3E%3Cpath d='M4 10a6 6 0 1 0 12 0 6 6 0 1 0-12 0m5-3a1 1 0 1 0 2 0 1 1 0 1 0-2 0m0 3a1 1 0 1 1 2 0v3a1 1 0 1 1-2 0'/%3E%3C/svg%3E");border:0;border-radius:12px;box-sizing:border-box;cursor:pointer;display:none;height:24px;outline:none;position:absolute;right:0;top:0;width:24px}.maplibregl-ctrl-attrib summary.maplibregl-ctrl-attrib-button{-webkit-appearance:none;-moz-appearance:none;appearance:none;list-style:none}.maplibregl-ctrl-attrib summary.maplibregl-ctrl-attrib-button::-webkit-details-marker{display:none}.maplibregl-ctrl-bottom-left .maplibregl-ctrl-attrib-button,.maplibregl-ctrl-top-left .maplibregl-ctrl-attrib-button{left:0}.maplibregl-ctrl-attrib.maplibregl-compact .maplibregl-ctrl-attrib-button,.maplibregl-ctrl-attrib.maplibregl-compact-show .maplibregl-ctrl-attrib-inner{display:block}.maplibregl-ctrl-attrib.maplibregl-compact-show .maplibregl-ctrl-attrib-button{background-color:#0000000d}.maplibregl-ctrl-bottom-right>.maplibregl-ctrl-attrib.maplibregl-compact:after{bottom:0;right:0}.maplibregl-ctrl-top-right>.maplibregl-ctrl-attrib.maplibregl-compact:after{right:0;top:0}.maplibregl-ctrl-top-left>.maplibregl-ctrl-attrib.maplibregl-compact:after{left:0;top:0}.maplibregl-ctrl-bottom-left>.maplibregl-ctrl-attrib.maplibregl-compact:after{bottom:0;left:0}}@media screen and (forced-colors:active){.maplibregl-ctrl-attrib.maplibregl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' fill='%23fff' fill-rule='evenodd' viewBox='0 0 20 20'%3E%3Cpath d='M4 10a6 6 0 1 0 12 0 6 6 0 1 0-12 0m5-3a1 1 0 1 0 2 0 1 1 0 1 0-2 0m0 3a1 1 0 1 1 2 0v3a1 1 0 1 1-2 0'/%3E%3C/svg%3E")}}@media screen and (forced-colors:active) and (prefers-color-scheme:light){.maplibregl-ctrl-attrib.maplibregl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' fill-rule='evenodd' viewBox='0 0 20 20'%3E%3Cpath d='M4 10a6 6 0 1 0 12 0 6 6 0 1 0-12 0m5-3a1 1 0 1 0 2 0 1 1 0 1 0-2 0m0 3a1 1 0 1 1 2 0v3a1 1 0 1 1-2 0'/%3E%3C/svg%3E")}}.maplibregl-ctrl-attrib a{color:#000000bf;text-decoration:none}.maplibregl-ctrl-attrib a:hover{color:inherit;text-decoration:underline}.maplibregl-attrib-empty{display:none}.maplibregl-ctrl-scale{background-color:#ffffffbf;border:2px solid #333;border-top:#333;box-sizing:border-box;color:#333;font-size:10px;padding:0 5px}.maplibregl-popup{display:flex;left:0;pointer-events:none;position:absolute;top:0;will-change:transform}.maplibregl-popup-anchor-top,.maplibregl-popup-anchor-top-left,.maplibregl-popup-anchor-top-right{flex-direction:column}.maplibregl-popup-anchor-bottom,.maplibregl-popup-anchor-bottom-left,.maplibregl-popup-anchor-bottom-right{flex-direction:column-reverse}.maplibregl-popup-anchor-left{flex-direction:row}.maplibregl-popup-anchor-right{flex-direction:row-reverse}.maplibregl-popup-tip{border:10px solid transparent;height:0;width:0;z-index:1}.maplibregl-popup-anchor-top .maplibregl-popup-tip{align-self:center;border-bottom-color:#fff;border-top:none}.maplibregl-popup-anchor-top-left .maplibregl-popup-tip{align-self:flex-start;border-bottom-color:#fff;border-left:none;border-top:none}.maplibregl-popup-anchor-top-right .maplibregl-popup-tip{align-self:flex-end;border-bottom-color:#fff;border-right:none;border-top:none}.maplibregl-popup-anchor-bottom .maplibregl-popup-tip{align-self:center;border-bottom:none;border-top-color:#fff}.maplibregl-popup-anchor-bottom-left .maplibregl-popup-tip{align-self:flex-start;border-bottom:none;border-left:none;border-top-color:#fff}.maplibregl-popup-anchor-bottom-right .maplibregl-popup-tip{align-self:flex-end;border-bottom:none;border-right:none;border-top-color:#fff}.maplibregl-popup-anchor-left .maplibregl-popup-tip{align-self:center;border-left:none;border-right-color:#fff}.maplibregl-popup-anchor-right .maplibregl-popup-tip{align-self:center;border-left-color:#fff;border-right:none}.maplibregl-popup-close-button{background-color:transparent;border:0;border-radius:0 3px 0 0;cursor:pointer;position:absolute;right:0;top:0}.maplibregl-popup-close-button:hover{background-color:#0000000d}.maplibregl-popup-content{background:#fff;border-radius:3px;box-shadow:0 1px 2px #0000001a;padding:15px 10px;pointer-events:auto;position:relative}.maplibregl-popup-anchor-top-left .maplibregl-popup-content{border-top-left-radius:0}.maplibregl-popup-anchor-top-right .maplibregl-popup-content{border-top-right-radius:0}.maplibregl-popup-anchor-bottom-left .maplibregl-popup-content{border-bottom-left-radius:0}.maplibregl-popup-anchor-bottom-right .maplibregl-popup-content{border-bottom-right-radius:0}.maplibregl-popup-track-pointer{display:none}.maplibregl-popup-track-pointer *{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.maplibregl-map:hover .maplibregl-popup-track-pointer{display:flex}.maplibregl-map:active .maplibregl-popup-track-pointer{display:none}.maplibregl-marker{left:0;position:absolute;top:0;transition:opacity .2s;will-change:transform}.maplibregl-user-location-dot,.maplibregl-user-location-dot:before{background-color:#1da1f2;border-radius:50%;height:15px;width:15px}.maplibregl-user-location-dot:before{animation:maplibregl-user-location-dot-pulse 2s infinite;content:"";position:absolute}.maplibregl-user-location-dot:after{border:2px solid #fff;border-radius:50%;box-shadow:0 0 3px #00000059;box-sizing:border-box;content:"";height:19px;left:-2px;position:absolute;top:-2px;width:19px}@keyframes maplibregl-user-location-dot-pulse{0%{opacity:1;transform:scale(1)}70%{opacity:0;transform:scale(3)}to{opacity:0;transform:scale(1)}}.maplibregl-user-location-dot-stale{background-color:#aaa}.maplibregl-user-location-dot-stale:after{display:none}.maplibregl-user-location-accuracy-circle{background-color:#1da1f233;border-radius:100%;height:1px;width:1px}.maplibregl-crosshair,.maplibregl-crosshair .maplibregl-interactive,.maplibregl-crosshair .maplibregl-interactive:active{cursor:crosshair}.maplibregl-boxzoom{background:#fff;border:2px dotted #202020;height:0;left:0;opacity:.5;position:absolute;top:0;width:0}.maplibregl-cooperative-gesture-screen{align-items:center;background:#0006;color:#fff;display:flex;font-size:1.4em;top:0;right:0;bottom:0;left:0;justify-content:center;line-height:1.2;opacity:0;padding:1rem;pointer-events:none;position:absolute;transition:opacity 1s ease 1s;z-index:99999}.maplibregl-cooperative-gesture-screen.maplibregl-show{opacity:1;transition:opacity .05s}.maplibregl-cooperative-gesture-screen .maplibregl-mobile-message{display:none}@media (hover:none),(pointer:coarse){.maplibregl-cooperative-gesture-screen .maplibregl-desktop-message{display:none}.maplibregl-cooperative-gesture-screen .maplibregl-mobile-message{display:block}}.maplibregl-pseudo-fullscreen{height:100%!important;left:0!important;position:fixed!important;top:0!important;width:100%!important;z-index:99999}.psv-navbar{display:none!important}`)),document.head.appendChild(l)}}catch(a){console.error("vite-plugin-css-injected-by-js",a)}})();
(function(Js,us){typeof exports=="object"&&typeof module<"u"?us(exports):typeof define=="function"&&define.amd?define(["exports"],us):(Js=typeof globalThis<"u"?globalThis:Js||self,us(Js.OlaMapsSDK={}))})(this,function(Js){"use strict";var MV=Object.defineProperty;var RV=(Js,us,zl)=>us in Js?MV(Js,us,{enumerable:!0,configurable:!0,writable:!0,value:zl}):Js[us]=zl;var L=(Js,us,zl)=>RV(Js,typeof us!="symbol"?us+"":us,zl);var oA,xy;function us(t,e){for(var i=0;i<e.length;i++){const r=e[i];if(typeof r!="string"&&!Array.isArray(r)){for(const o in r)if(o!=="default"&&!(o in t)){const u=Object.getOwnPropertyDescriptor(r,o);u&&Object.defineProperty(t,o,u.get?u:{enumerable:!0,get:()=>r[o]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}var zl=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function B0(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var D0={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v5.6.2/LICENSE.txt
 */(function(t,e){(function(i,r){t.exports=r()})(zl,function(){var i={},r={};function o(d,a,x){if(r[d]=x,d==="index"){var A="var sharedModule = {}; ("+r.shared+")(sharedModule); ("+r.worker+")(sharedModule);",M={};return r.shared(M),r.index(i,M),typeof window<"u"&&i.setWorkerUrl(window.URL.createObjectURL(new Blob([A],{type:"text/javascript"}))),i}}o("shared",["exports"],function(d){function a(c,n,l,f){return new(l||(l=Promise))(function(_,b){function v(I){try{E(f.next(I))}catch(P){b(P)}}function T(I){try{E(f.throw(I))}catch(P){b(P)}}function E(I){var P;I.done?_(I.value):(P=I.value,P instanceof l?P:new l(function(O){O(P)})).then(v,T)}E((f=f.apply(c,n||[])).next())})}function x(c,n){this.x=c,this.y=n}function A(c){return c&&c.__esModule&&Object.prototype.hasOwnProperty.call(c,"default")?c.default:c}var M,D;typeof SuppressedError=="function"&&SuppressedError,x.prototype={clone(){return new x(this.x,this.y)},add(c){return this.clone()._add(c)},sub(c){return this.clone()._sub(c)},multByPoint(c){return this.clone()._multByPoint(c)},divByPoint(c){return this.clone()._divByPoint(c)},mult(c){return this.clone()._mult(c)},div(c){return this.clone()._div(c)},rotate(c){return this.clone()._rotate(c)},rotateAround(c,n){return this.clone()._rotateAround(c,n)},matMult(c){return this.clone()._matMult(c)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(c){return this.x===c.x&&this.y===c.y},dist(c){return Math.sqrt(this.distSqr(c))},distSqr(c){const n=c.x-this.x,l=c.y-this.y;return n*n+l*l},angle(){return Math.atan2(this.y,this.x)},angleTo(c){return Math.atan2(this.y-c.y,this.x-c.x)},angleWith(c){return this.angleWithSep(c.x,c.y)},angleWithSep(c,n){return Math.atan2(this.x*n-this.y*c,this.x*c+this.y*n)},_matMult(c){const n=c[2]*this.x+c[3]*this.y;return this.x=c[0]*this.x+c[1]*this.y,this.y=n,this},_add(c){return this.x+=c.x,this.y+=c.y,this},_sub(c){return this.x-=c.x,this.y-=c.y,this},_mult(c){return this.x*=c,this.y*=c,this},_div(c){return this.x/=c,this.y/=c,this},_multByPoint(c){return this.x*=c.x,this.y*=c.y,this},_divByPoint(c){return this.x/=c.x,this.y/=c.y,this},_unit(){return this._div(this.mag()),this},_perp(){const c=this.y;return this.y=this.x,this.x=-c,this},_rotate(c){const n=Math.cos(c),l=Math.sin(c),f=l*this.x+n*this.y;return this.x=n*this.x-l*this.y,this.y=f,this},_rotateAround(c,n){const l=Math.cos(c),f=Math.sin(c),_=n.y+f*(this.x-n.x)+l*(this.y-n.y);return this.x=n.x+l*(this.x-n.x)-f*(this.y-n.y),this.y=_,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:x},x.convert=function(c){if(c instanceof x)return c;if(Array.isArray(c))return new x(+c[0],+c[1]);if(c.x!==void 0&&c.y!==void 0)return new x(+c.x,+c.y);throw new Error("Expected [x, y] or {x, y} point format")};var N=function(){if(D)return M;function c(n,l,f,_){this.cx=3*n,this.bx=3*(f-n)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*l,this.by=3*(_-l)-this.cy,this.ay=1-this.cy-this.by,this.p1x=n,this.p1y=l,this.p2x=f,this.p2y=_}return D=1,M=c,c.prototype={sampleCurveX:function(n){return((this.ax*n+this.bx)*n+this.cx)*n},sampleCurveY:function(n){return((this.ay*n+this.by)*n+this.cy)*n},sampleCurveDerivativeX:function(n){return(3*this.ax*n+2*this.bx)*n+this.cx},solveCurveX:function(n,l){if(l===void 0&&(l=1e-6),n<0)return 0;if(n>1)return 1;for(var f=n,_=0;_<8;_++){var b=this.sampleCurveX(f)-n;if(Math.abs(b)<l)return f;var v=this.sampleCurveDerivativeX(f);if(Math.abs(v)<1e-6)break;f-=b/v}var T=0,E=1;for(f=n,_=0;_<20&&(b=this.sampleCurveX(f),!(Math.abs(b-n)<l));_++)n>b?T=f:E=f,f=.5*(E-T)+T;return f},solve:function(n,l){return this.sampleCurveY(this.solveCurveX(n,l))}},M}(),U=A(N);let re,ne;function xe(){return re==null&&(re=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),re}function Ae(){if(ne==null&&(ne=!1,xe())){const n=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(n){for(let f=0;f<5*5;f++){const _=4*f;n.fillStyle=`rgb(${_},${_+1},${_+2})`,n.fillRect(f%5,Math.floor(f/5),1,1)}const l=n.getImageData(0,0,5,5).data;for(let f=0;f<5*5*4;f++)if(f%4!=3&&l[f]!==f){ne=!0;break}}}return ne||!1}var Te=1e-6,Ie=typeof Float32Array<"u"?Float32Array:Array;function Ue(){var c=new Ie(9);return Ie!=Float32Array&&(c[1]=0,c[2]=0,c[3]=0,c[5]=0,c[6]=0,c[7]=0),c[0]=1,c[4]=1,c[8]=1,c}function Xe(c){return c[0]=1,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=1,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=1,c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c}function qe(){var c=new Ie(3);return Ie!=Float32Array&&(c[0]=0,c[1]=0,c[2]=0),c}function ht(c){return Math.hypot(c[0],c[1],c[2])}function gt(c,n,l){var f=new Ie(3);return f[0]=c,f[1]=n,f[2]=l,f}function nt(c,n,l){return c[0]=n[0]+l[0],c[1]=n[1]+l[1],c[2]=n[2]+l[2],c}function at(c,n,l){return c[0]=n[0]*l,c[1]=n[1]*l,c[2]=n[2]*l,c}function bt(c,n,l){var f=n[0],_=n[1],b=n[2],v=l[0],T=l[1],E=l[2];return c[0]=_*E-b*T,c[1]=b*v-f*E,c[2]=f*T-_*v,c}Math.hypot||(Math.hypot=function(){for(var c=0,n=arguments.length;n--;)c+=arguments[n]*arguments[n];return Math.sqrt(c)});var kt,Ht=ht;function St(c,n,l){var f=n[0],_=n[1],b=n[2],v=n[3];return c[0]=l[0]*f+l[4]*_+l[8]*b+l[12]*v,c[1]=l[1]*f+l[5]*_+l[9]*b+l[13]*v,c[2]=l[2]*f+l[6]*_+l[10]*b+l[14]*v,c[3]=l[3]*f+l[7]*_+l[11]*b+l[15]*v,c}function xi(){var c=new Ie(4);return Ie!=Float32Array&&(c[0]=0,c[1]=0,c[2]=0),c[3]=1,c}function Fr(c,n,l,f){var _=.5*Math.PI/180;n*=_,l*=_,f*=_;var b=Math.sin(n),v=Math.cos(n),T=Math.sin(l),E=Math.cos(l),I=Math.sin(f),P=Math.cos(f);return c[0]=b*E*P-v*T*I,c[1]=v*T*P+b*E*I,c[2]=v*E*I-b*T*P,c[3]=v*E*P+b*T*I,c}function br(){var c=new Ie(2);return Ie!=Float32Array&&(c[0]=0,c[1]=0),c}function Qn(c,n){var l=new Ie(2);return l[0]=c,l[1]=n,l}qe(),kt=new Ie(4),Ie!=Float32Array&&(kt[0]=0,kt[1]=0,kt[2]=0,kt[3]=0),qe(),gt(1,0,0),gt(0,1,0),xi(),xi(),Ue(),br();const Gt=8192;function or(c,n,l){return n*(Gt/(c.tileSize*Math.pow(2,l-c.tileID.overscaledZ)))}function Ai(c,n){return(c%n+n)%n}function ar(c,n,l){return c*(1-l)+n*l}function gs(c){if(c<=0)return 0;if(c>=1)return 1;const n=c*c,l=n*c;return 4*(c<.5?l:3*(c-n)+l-.75)}function ms(c,n,l,f){const _=new U(c,n,l,f);return b=>_.solve(b)}const In=ms(.25,.1,.25,1);function Ir(c,n,l){return Math.min(l,Math.max(n,c))}function Pi(c,n,l){const f=l-n,_=((c-n)%f+f)%f+n;return _===n?l:_}function $i(c,...n){for(const l of n)for(const f in l)c[f]=l[f];return c}let Zt=1;function ki(c,n,l){const f={};for(const _ in c)f[_]=n.call(this,c[_],_,c);return f}function Rs(c,n,l){const f={};for(const _ in c)n.call(this,c[_],_,c)&&(f[_]=c[_]);return f}function Qi(c){return Array.isArray(c)?c.map(Qi):typeof c=="object"&&c?ki(c,Qi):c}const oi={};function ci(c){oi[c]||(typeof console<"u"&&console.warn(c),oi[c]=!0)}function vr(c,n,l){return(l.y-c.y)*(n.x-c.x)>(n.y-c.y)*(l.x-c.x)}function Ni(c){return typeof WorkerGlobalScope<"u"&&c!==void 0&&c instanceof WorkerGlobalScope}let kr=null;function is(c){return typeof ImageBitmap<"u"&&c instanceof ImageBitmap}const rs="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Ps(c,n,l,f,_){return a(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const b=new VideoFrame(c,{timestamp:0});try{const v=b==null?void 0:b.format;if(!v||!v.startsWith("BGR")&&!v.startsWith("RGB"))throw new Error(`Unrecognized format ${v}`);const T=v.startsWith("BGR"),E=new Uint8ClampedArray(f*_*4);if(yield b.copyTo(E,function(I,P,O,z,j){const H=4*Math.max(-P,0),W=(Math.max(0,O)-O)*z*4+H,K=4*z,ie=Math.max(0,P),me=Math.max(0,O);return{rect:{x:ie,y:me,width:Math.min(I.width,P+z)-ie,height:Math.min(I.height,O+j)-me},layout:[{offset:W,stride:K}]}}(c,n,l,f,_)),T)for(let I=0;I<E.length;I+=4){const P=E[I];E[I]=E[I+2],E[I+2]=P}return E}finally{b.close()}})}let Li,on;function an(c,n,l,f){return c.addEventListener(n,l,f),{unsubscribe:()=>{c.removeEventListener(n,l,f)}}}function Mn(c){return c*Math.PI/180}function ln(c){return c/Math.PI*180}const cn={touchstart:!0,touchmove:!0,touchmoveWindow:!0,touchend:!0,touchcancel:!0},Bs={dblclick:!0,click:!0,mouseover:!0,mouseout:!0,mousedown:!0,mousemove:!0,mousemoveWindow:!0,mouseup:!0,mouseupWindow:!0,contextmenu:!0,wheel:!0},Rn="AbortError";function ge(){return new Error(Rn)}const $={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function X(c){return $.REGISTERED_PROTOCOLS[c.substring(0,c.indexOf("://"))]}const Z="global-dispatcher";class oe extends Error{constructor(n,l,f,_){super(`AJAXError: ${l} (${n}): ${f}`),this.status=n,this.statusText=l,this.url=f,this.body=_}}const pe=()=>Ni(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,ye=function(c,n){if(/:\/\//.test(c.url)&&!/^https?:|^file:/.test(c.url)){const f=X(c.url);if(f)return f(c,n);if(Ni(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:c,targetMapId:Z},n)}if(!(/^file:/.test(l=c.url)||/^file:/.test(pe())&&!/^\w+:/.test(l))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(f,_){return a(this,void 0,void 0,function*(){const b=new Request(f.url,{method:f.method||"GET",body:f.body,credentials:f.credentials,headers:f.headers,cache:f.cache,referrer:pe(),signal:_.signal});let v,T;f.type!=="json"||b.headers.has("Accept")||b.headers.set("Accept","application/json");try{v=yield fetch(b)}catch(I){throw new oe(0,I.message,f.url,new Blob)}if(!v.ok){const I=yield v.blob();throw new oe(v.status,v.statusText,f.url,I)}T=f.type==="arrayBuffer"||f.type==="image"?v.arrayBuffer():f.type==="json"?v.json():v.text();const E=yield T;if(_.signal.aborted)throw ge();return{data:E,cacheControl:v.headers.get("Cache-Control"),expires:v.headers.get("Expires")}})}(c,n);if(Ni(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:c,mustQueue:!0,targetMapId:Z},n)}var l;return function(f,_){return new Promise((b,v)=>{var T;const E=new XMLHttpRequest;E.open(f.method||"GET",f.url,!0),f.type!=="arrayBuffer"&&f.type!=="image"||(E.responseType="arraybuffer");for(const I in f.headers)E.setRequestHeader(I,f.headers[I]);f.type==="json"&&(E.responseType="text",!((T=f.headers)===null||T===void 0)&&T.Accept||E.setRequestHeader("Accept","application/json")),E.withCredentials=f.credentials==="include",E.onerror=()=>{v(new Error(E.statusText))},E.onload=()=>{if(!_.signal.aborted)if((E.status>=200&&E.status<300||E.status===0)&&E.response!==null){let I=E.response;if(f.type==="json")try{I=JSON.parse(E.response)}catch(P){return void v(P)}b({data:I,cacheControl:E.getResponseHeader("Cache-Control"),expires:E.getResponseHeader("Expires")})}else{const I=new Blob([E.response],{type:E.getResponseHeader("Content-Type")});v(new oe(E.status,E.statusText,f.url,I))}},_.signal.addEventListener("abort",()=>{E.abort(),v(ge())}),E.send(f.body)})}(c,n)};function Re(c){if(!c||c.indexOf("://")<=0||c.indexOf("data:image/")===0||c.indexOf("blob:")===0)return!0;const n=new URL(c),l=window.location;return n.protocol===l.protocol&&n.host===l.host}function be(c,n,l){l[c]&&l[c].indexOf(n)!==-1||(l[c]=l[c]||[],l[c].push(n))}function Le(c,n,l){if(l&&l[c]){const f=l[c].indexOf(n);f!==-1&&l[c].splice(f,1)}}class Ge{constructor(n,l={}){$i(this,l),this.type=n}}class Ve extends Ge{constructor(n,l={}){super("error",$i({error:n},l))}}class ct{on(n,l){return this._listeners=this._listeners||{},be(n,l,this._listeners),{unsubscribe:()=>{this.off(n,l)}}}off(n,l){return Le(n,l,this._listeners),Le(n,l,this._oneTimeListeners),this}once(n,l){return l?(this._oneTimeListeners=this._oneTimeListeners||{},be(n,l,this._oneTimeListeners),this):new Promise(f=>this.once(n,f))}fire(n,l){typeof n=="string"&&(n=new Ge(n,l||{}));const f=n.type;if(this.listens(f)){n.target=this;const _=this._listeners&&this._listeners[f]?this._listeners[f].slice():[];for(const T of _)T.call(this,n);const b=this._oneTimeListeners&&this._oneTimeListeners[f]?this._oneTimeListeners[f].slice():[];for(const T of b)Le(f,T,this._oneTimeListeners),T.call(this,n);const v=this._eventedParent;v&&($i(n,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),v.fire(n))}else n instanceof Ve&&console.error(n.error);return this}listens(n){return this._listeners&&this._listeners[n]&&this._listeners[n].length>0||this._oneTimeListeners&&this._oneTimeListeners[n]&&this._oneTimeListeners[n].length>0||this._eventedParent&&this._eventedParent.listens(n)}setEventedParent(n,l){return this._eventedParent=n,this._eventedParentData=l,this}}var we={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const Tt=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Ft(c,n){const l={};for(const f in c)f!=="ref"&&(l[f]=c[f]);return Tt.forEach(f=>{f in n&&(l[f]=n[f])}),l}function pt(c,n){if(Array.isArray(c)){if(!Array.isArray(n)||c.length!==n.length)return!1;for(let l=0;l<c.length;l++)if(!pt(c[l],n[l]))return!1;return!0}if(typeof c=="object"&&c!==null&&n!==null){if(typeof n!="object"||Object.keys(c).length!==Object.keys(n).length)return!1;for(const l in c)if(!pt(c[l],n[l]))return!1;return!0}return c===n}function Ct(c,n){c.push(n)}function Qt(c,n,l){Ct(l,{command:"addSource",args:[c,n[c]]})}function Ui(c,n,l){Ct(n,{command:"removeSource",args:[c]}),l[c]=!0}function zi(c,n,l,f){Ui(c,l,f),Qt(c,n,l)}function Ei(c,n,l){let f;for(f in c[l])if(Object.prototype.hasOwnProperty.call(c[l],f)&&f!=="data"&&!pt(c[l][f],n[l][f]))return!1;for(f in n[l])if(Object.prototype.hasOwnProperty.call(n[l],f)&&f!=="data"&&!pt(c[l][f],n[l][f]))return!1;return!0}function Bt(c,n,l,f,_,b){c=c||{},n=n||{};for(const v in c)Object.prototype.hasOwnProperty.call(c,v)&&(pt(c[v],n[v])||l.push({command:b,args:[f,v,n[v],_]}));for(const v in n)Object.prototype.hasOwnProperty.call(n,v)&&!Object.prototype.hasOwnProperty.call(c,v)&&(pt(c[v],n[v])||l.push({command:b,args:[f,v,n[v],_]}))}function Lt(c){return c.id}function Bi(c,n){return c[n.id]=n,c}class We{constructor(n,l,f,_){this.message=(n?`${n}: `:"")+f,_&&(this.identifier=_),l!=null&&l.__line__&&(this.line=l.__line__)}}function Wi(c,...n){for(const l of n)for(const f in l)c[f]=l[f];return c}class bi extends Error{constructor(n,l){super(l),this.message=l,this.key=n}}class Ds{constructor(n,l=[]){this.parent=n,this.bindings={};for(const[f,_]of l)this.bindings[f]=_}concat(n){return new Ds(this,n)}get(n){if(this.bindings[n])return this.bindings[n];if(this.parent)return this.parent.get(n);throw new Error(`${n} not found in scope.`)}has(n){return!!this.bindings[n]||!!this.parent&&this.parent.has(n)}}const eo={kind:"null"},rt={kind:"number"},Ot={kind:"string"},It={kind:"boolean"},Xi={kind:"color"},Os={kind:"projectionDefinition"},Mr={kind:"object"},At={kind:"value"},hn={kind:"collator"},ss={kind:"formatted"},to={kind:"padding"},ys={kind:"colorArray"},io={kind:"numberArray"},hi={kind:"resolvedImage"},xr={kind:"variableAnchorOffsetCollection"};function Vi(c,n){return{kind:"array",itemType:c,N:n}}function Vt(c){if(c.kind==="array"){const n=Vt(c.itemType);return typeof c.N=="number"?`array<${n}, ${c.N}>`:c.itemType.kind==="value"?"array":`array<${n}>`}return c.kind}const bs=[eo,rt,Ot,It,Xi,Os,ss,Mr,Vi(At),to,io,ys,hi,xr];function Fs(c,n){if(n.kind==="error")return null;if(c.kind==="array"){if(n.kind==="array"&&(n.N===0&&n.itemType.kind==="value"||!Fs(c.itemType,n.itemType))&&(typeof c.N!="number"||c.N===n.N))return null}else{if(c.kind===n.kind)return null;if(c.kind==="value"){for(const l of bs)if(!Fs(l,n))return null}}return`Expected ${Vt(c)} but found ${Vt(n)} instead.`}function Kr(c,n){return n.some(l=>l.kind===c.kind)}function lr(c,n){return n.some(l=>l==="null"?c===null:l==="array"?Array.isArray(c):l==="object"?c&&!Array.isArray(c)&&typeof c=="object":l===typeof c)}function ks(c,n){return c.kind==="array"&&n.kind==="array"?c.itemType.kind===n.itemType.kind&&typeof c.N=="number":c.kind===n.kind}const la=.96422,Eo=.82521,Yr=4/29,Ns=6/29,ca=3*Ns*Ns,rl=Ns*Ns*Ns,sl=Math.PI/180,nl=180/Math.PI;function ro(c){return(c%=360)<0&&(c+=360),c}function Nr([c,n,l,f]){let _,b;const v=ha((.2225045*(c=ol(c))+.7168786*(n=ol(n))+.0606169*(l=ol(l)))/1);c===n&&n===l?_=b=v:(_=ha((.4360747*c+.3850649*n+.1430804*l)/la),b=ha((.0139322*c+.0971045*n+.7141733*l)/Eo));const T=116*v-16;return[T<0?0:T,500*(_-v),200*(v-b),f]}function ol(c){return c<=.04045?c/12.92:Math.pow((c+.055)/1.055,2.4)}function ha(c){return c>rl?Math.pow(c,1/3):c/ca+Yr}function un([c,n,l,f]){let _=(c+16)/116,b=isNaN(n)?_:_+n/500,v=isNaN(l)?_:_-l/200;return _=1*al(_),b=la*al(b),v=Eo*al(v),[ua(3.1338561*b-1.6168667*_-.4906146*v),ua(-.9787684*b+1.9161415*_+.033454*v),ua(.0719453*b-.2289914*_+1.4052427*v),f]}function ua(c){return(c=c<=.00304?12.92*c:1.055*Math.pow(c,1/2.4)-.055)<0?0:c>1?1:c}function al(c){return c>Ns?c*c*c:ca*(c-Yr)}const vu=Object.hasOwn||function(c,n){return Object.prototype.hasOwnProperty.call(c,n)};function q(c,n){return vu(c,n)?c[n]:void 0}function ee(c){return parseInt(c.padEnd(2,c),16)/255}function de(c,n){return Ee(n?c/100:c,0,1)}function Ee(c,n,l){return Math.min(Math.max(n,c),l)}function $e(c){return!c.some(Number.isNaN)}const lt={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function Mt(c,n,l){return c+l*(n-c)}function pi(c,n,l){return c.map((f,_)=>Mt(f,n[_],l))}class yt{constructor(n,l,f,_=1,b=!0){this.r=n,this.g=l,this.b=f,this.a=_,b||(this.r*=_,this.g*=_,this.b*=_,_||this.overwriteGetter("rgb",[n,l,f,_]))}static parse(n){if(n instanceof yt)return n;if(typeof n!="string")return;const l=function(f){if((f=f.toLowerCase().trim())==="transparent")return[0,0,0,0];const _=q(lt,f);if(_){const[v,T,E]=_;return[v/255,T/255,E/255,1]}if(f.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(f)){const v=f.length<6?1:2;let T=1;return[ee(f.slice(T,T+=v)),ee(f.slice(T,T+=v)),ee(f.slice(T,T+=v)),ee(f.slice(T,T+v)||"ff")]}if(f.startsWith("rgb")){const v=f.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(v){const[T,E,I,P,O,z,j,H,W,K,ie,me]=v,he=[P||" ",j||" ",K].join("");if(he==="  "||he==="  /"||he===",,"||he===",,,"){const fe=[I,z,W].join(""),Be=fe==="%%%"?100:fe===""?255:0;if(Be){const Ne=[Ee(+E/Be,0,1),Ee(+O/Be,0,1),Ee(+H/Be,0,1),ie?de(+ie,me):1];if($e(Ne))return Ne}}return}}const b=f.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(b){const[v,T,E,I,P,O,z,j,H]=b,W=[E||" ",P||" ",z].join("");if(W==="  "||W==="  /"||W===",,"||W===",,,"){const K=[+T,Ee(+I,0,100),Ee(+O,0,100),j?de(+j,H):1];if($e(K))return function([ie,me,he,fe]){function Be(Ne){const He=(Ne+ie/30)%12,st=me*Math.min(he,1-he);return he-st*Math.max(-1,Math.min(He-3,9-He,1))}return ie=ro(ie),me/=100,he/=100,[Be(0),Be(8),Be(4),fe]}(K)}}}(n);return l?new yt(...l,!1):void 0}get rgb(){const{r:n,g:l,b:f,a:_}=this,b=_||1/0;return this.overwriteGetter("rgb",[n/b,l/b,f/b,_])}get hcl(){return this.overwriteGetter("hcl",function(n){const[l,f,_,b]=Nr(n),v=Math.sqrt(f*f+_*_);return[Math.round(1e4*v)?ro(Math.atan2(_,f)*nl):NaN,v,l,b]}(this.rgb))}get lab(){return this.overwriteGetter("lab",Nr(this.rgb))}overwriteGetter(n,l){return Object.defineProperty(this,n,{value:l}),l}toString(){const[n,l,f,_]=this.rgb;return`rgba(${[n,l,f].map(b=>Math.round(255*b)).join(",")},${_})`}static interpolate(n,l,f,_="rgb"){switch(_){case"rgb":{const[b,v,T,E]=pi(n.rgb,l.rgb,f);return new yt(b,v,T,E,!1)}case"hcl":{const[b,v,T,E]=n.hcl,[I,P,O,z]=l.hcl;let j,H;if(isNaN(b)||isNaN(I))isNaN(b)?isNaN(I)?j=NaN:(j=I,T!==1&&T!==0||(H=P)):(j=b,O!==1&&O!==0||(H=v));else{let he=I-b;I>b&&he>180?he-=360:I<b&&b-I>180&&(he+=360),j=b+f*he}const[W,K,ie,me]=function([he,fe,Be,Ne]){return he=isNaN(he)?0:he*sl,un([Be,Math.cos(he)*fe,Math.sin(he)*fe,Ne])}([j,H??Mt(v,P,f),Mt(T,O,f),Mt(E,z,f)]);return new yt(W,K,ie,me,!1)}case"lab":{const[b,v,T,E]=un(pi(n.lab,l.lab,f));return new yt(b,v,T,E,!1)}}}}yt.black=new yt(0,0,0,1),yt.white=new yt(1,1,1,1),yt.transparent=new yt(0,0,0,0),yt.red=new yt(1,0,0,1);class Si{constructor(n,l,f){this.sensitivity=n?l?"variant":"case":l?"accent":"base",this.locale=f,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(n,l){return this.collator.compare(n,l)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const Lr=["bottom","center","top"];class Mc{constructor(n,l,f,_,b,v){this.text=n,this.image=l,this.scale=f,this.fontStack=_,this.textColor=b,this.verticalAlign=v}}class Ur{constructor(n){this.sections=n}static fromString(n){return new Ur([new Mc(n,null,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(n=>n.text.length!==0||n.image&&n.image.name.length!==0)}static factory(n){return n instanceof Ur?n:Ur.fromString(n)}toString(){return this.sections.length===0?"":this.sections.map(n=>n.text).join("")}}class cr{constructor(n){this.values=n.slice()}static parse(n){if(n instanceof cr)return n;if(typeof n=="number")return new cr([n,n,n,n]);if(Array.isArray(n)&&!(n.length<1||n.length>4)){for(const l of n)if(typeof l!="number")return;switch(n.length){case 1:n=[n[0],n[0],n[0],n[0]];break;case 2:n=[n[0],n[1],n[0],n[1]];break;case 3:n=[n[0],n[1],n[2],n[1]]}return new cr(n)}}toString(){return JSON.stringify(this.values)}static interpolate(n,l,f){return new cr(pi(n.values,l.values,f))}}class zr{constructor(n){this.values=n.slice()}static parse(n){if(n instanceof zr)return n;if(typeof n=="number")return new zr([n]);if(Array.isArray(n)){for(const l of n)if(typeof l!="number")return;return new zr(n)}}toString(){return JSON.stringify(this.values)}static interpolate(n,l,f){return new zr(pi(n.values,l.values,f))}}class qi{constructor(n){this.values=n.slice()}static parse(n){if(n instanceof qi)return n;if(typeof n=="string"){const f=yt.parse(n);return f?new qi([f]):void 0}if(!Array.isArray(n))return;const l=[];for(const f of n){if(typeof f!="string")return;const _=yt.parse(f);if(!_)return;l.push(_)}return new qi(l)}toString(){return JSON.stringify(this.values)}static interpolate(n,l,f,_="rgb"){const b=[];if(n.values.length!=l.values.length)throw new Error(`colorArray: Arrays have mismatched length (${n.values.length} vs. ${l.values.length}), cannot interpolate.`);for(let v=0;v<n.values.length;v++)b.push(yt.interpolate(n.values[v],l.values[v],f,_));return new qi(b)}}class ai extends Error{constructor(n){super(n),this.name="RuntimeError"}toJSON(){return this.message}}const dp=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Vr{constructor(n){this.values=n.slice()}static parse(n){if(n instanceof Vr)return n;if(Array.isArray(n)&&!(n.length<1)&&n.length%2==0){for(let l=0;l<n.length;l+=2){const f=n[l],_=n[l+1];if(typeof f!="string"||!dp.has(f)||!Array.isArray(_)||_.length!==2||typeof _[0]!="number"||typeof _[1]!="number")return}return new Vr(n)}}toString(){return JSON.stringify(this.values)}static interpolate(n,l,f){const _=n.values,b=l.values;if(_.length!==b.length)throw new ai(`Cannot interpolate values of different length. from: ${n.toString()}, to: ${l.toString()}`);const v=[];for(let T=0;T<_.length;T+=2){if(_[T]!==b[T])throw new ai(`Cannot interpolate values containing mismatched anchors. from[${T}]: ${_[T]}, to[${T}]: ${b[T]}`);v.push(_[T]);const[E,I]=_[T+1],[P,O]=b[T+1];v.push([Mt(E,P,f),Mt(I,O,f)])}return new Vr(v)}}class ns{constructor(n){this.name=n.name,this.available=n.available}toString(){return this.name}static fromString(n){return n?new ns({name:n,available:!1}):null}}class Rr{constructor(n,l,f){this.from=n,this.to=l,this.transition=f}static interpolate(n,l,f){return new Rr(n,l,f)}static parse(n){return n instanceof Rr?n:Array.isArray(n)&&n.length===3&&typeof n[0]=="string"&&typeof n[1]=="string"&&typeof n[2]=="number"?new Rr(n[0],n[1],n[2]):typeof n=="object"&&typeof n.from=="string"&&typeof n.to=="string"&&typeof n.transition=="number"?new Rr(n.from,n.to,n.transition):typeof n=="string"?new Rr(n,n,1):void 0}}function _i(c,n,l,f){return typeof c=="number"&&c>=0&&c<=255&&typeof n=="number"&&n>=0&&n<=255&&typeof l=="number"&&l>=0&&l<=255?f===void 0||typeof f=="number"&&f>=0&&f<=1?null:`Invalid rgba value [${[c,n,l,f].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof f=="number"?[c,n,l,f]:[c,n,l]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function So(c){if(c===null||typeof c=="string"||typeof c=="boolean"||typeof c=="number"||c instanceof Rr||c instanceof yt||c instanceof Si||c instanceof Ur||c instanceof cr||c instanceof zr||c instanceof qi||c instanceof Vr||c instanceof ns)return!0;if(Array.isArray(c)){for(const n of c)if(!So(n))return!1;return!0}if(typeof c=="object"){for(const n in c)if(!So(c[n]))return!1;return!0}return!1}function xt(c){if(c===null)return eo;if(typeof c=="string")return Ot;if(typeof c=="boolean")return It;if(typeof c=="number")return rt;if(c instanceof yt)return Xi;if(c instanceof Rr)return Os;if(c instanceof Si)return hn;if(c instanceof Ur)return ss;if(c instanceof cr)return to;if(c instanceof zr)return io;if(c instanceof qi)return ys;if(c instanceof Vr)return xr;if(c instanceof ns)return hi;if(Array.isArray(c)){const n=c.length;let l;for(const f of c){const _=xt(f);if(l){if(l===_)continue;l=At;break}l=_}return Vi(l||At,n)}return Mr}function Rt(c){const n=typeof c;return c===null?"":n==="string"||n==="number"||n==="boolean"?String(c):c instanceof yt||c instanceof Rr||c instanceof Ur||c instanceof cr||c instanceof zr||c instanceof qi||c instanceof Vr||c instanceof ns?c.toString():JSON.stringify(c)}class Pn{constructor(n,l){this.type=n,this.value=l}static parse(n,l){if(n.length!==2)return l.error(`'literal' expression requires exactly one argument, but found ${n.length-1} instead.`);if(!So(n[1]))return l.error("invalid value");const f=n[1];let _=xt(f);const b=l.expectedType;return _.kind!=="array"||_.N!==0||!b||b.kind!=="array"||typeof b.N=="number"&&b.N!==0||(_=b),new Pn(_,f)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const jt={string:Ot,number:rt,boolean:It,object:Mr};class os{constructor(n,l){this.type=n,this.args=l}static parse(n,l){if(n.length<2)return l.error("Expected at least one argument.");let f,_=1;const b=n[0];if(b==="array"){let T,E;if(n.length>2){const I=n[1];if(typeof I!="string"||!(I in jt)||I==="object")return l.error('The item type argument of "array" must be one of string, number, boolean',1);T=jt[I],_++}else T=At;if(n.length>3){if(n[2]!==null&&(typeof n[2]!="number"||n[2]<0||n[2]!==Math.floor(n[2])))return l.error('The length argument to "array" must be a positive integer literal',2);E=n[2],_++}f=Vi(T,E)}else{if(!jt[b])throw new Error(`Types doesn't contain name = ${b}`);f=jt[b]}const v=[];for(;_<n.length;_++){const T=l.parse(n[_],_,At);if(!T)return null;v.push(T)}return new os(f,v)}evaluate(n){for(let l=0;l<this.args.length;l++){const f=this.args[l].evaluate(n);if(!Fs(this.type,xt(f)))return f;if(l===this.args.length-1)throw new ai(`Expected value to be of type ${Vt(this.type)}, but found ${Vt(xt(f))} instead.`)}throw new Error}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every(n=>n.outputDefined())}}const dn={"to-boolean":It,"to-color":Xi,"to-number":rt,"to-string":Ot};class fn{constructor(n,l){this.type=n,this.args=l}static parse(n,l){if(n.length<2)return l.error("Expected at least one argument.");const f=n[0];if(!dn[f])throw new Error(`Can't parse ${f} as it is not part of the known types`);if((f==="to-boolean"||f==="to-string")&&n.length!==2)return l.error("Expected one argument.");const _=dn[f],b=[];for(let v=1;v<n.length;v++){const T=l.parse(n[v],v,At);if(!T)return null;b.push(T)}return new fn(_,b)}evaluate(n){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(n);case"color":{let l,f;for(const _ of this.args){if(l=_.evaluate(n),f=null,l instanceof yt)return l;if(typeof l=="string"){const b=n.parseColor(l);if(b)return b}else if(Array.isArray(l)&&(f=l.length<3||l.length>4?`Invalid rgba value ${JSON.stringify(l)}: expected an array containing either three or four numeric values.`:_i(l[0],l[1],l[2],l[3]),!f))return new yt(l[0]/255,l[1]/255,l[2]/255,l[3])}throw new ai(f||`Could not parse color from value '${typeof l=="string"?l:JSON.stringify(l)}'`)}case"padding":{let l;for(const f of this.args){l=f.evaluate(n);const _=cr.parse(l);if(_)return _}throw new ai(`Could not parse padding from value '${typeof l=="string"?l:JSON.stringify(l)}'`)}case"numberArray":{let l;for(const f of this.args){l=f.evaluate(n);const _=zr.parse(l);if(_)return _}throw new ai(`Could not parse numberArray from value '${typeof l=="string"?l:JSON.stringify(l)}'`)}case"colorArray":{let l;for(const f of this.args){l=f.evaluate(n);const _=qi.parse(l);if(_)return _}throw new ai(`Could not parse colorArray from value '${typeof l=="string"?l:JSON.stringify(l)}'`)}case"variableAnchorOffsetCollection":{let l;for(const f of this.args){l=f.evaluate(n);const _=Vr.parse(l);if(_)return _}throw new ai(`Could not parse variableAnchorOffsetCollection from value '${typeof l=="string"?l:JSON.stringify(l)}'`)}case"number":{let l=null;for(const f of this.args){if(l=f.evaluate(n),l===null)return 0;const _=Number(l);if(!isNaN(_))return _}throw new ai(`Could not convert ${JSON.stringify(l)} to number.`)}case"formatted":return Ur.fromString(Rt(this.args[0].evaluate(n)));case"resolvedImage":return ns.fromString(Rt(this.args[0].evaluate(n)));case"projectionDefinition":return this.args[0].evaluate(n);default:return Rt(this.args[0].evaluate(n))}}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every(n=>n.outputDefined())}}const Rc=["Unknown","Point","LineString","Polygon"];class xu{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Rc[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(n){let l=this._parseColorCache.get(n);return l||(l=yt.parse(n),this._parseColorCache.set(n,l)),l}}class da{constructor(n,l,f=[],_,b=new Ds,v=[]){this.registry=n,this.path=f,this.key=f.map(T=>`[${T}]`).join(""),this.scope=b,this.errors=v,this.expectedType=_,this._isConstant=l}parse(n,l,f,_,b={}){return l?this.concat(l,f,_)._parse(n,b):this._parse(n,b)}_parse(n,l){function f(_,b,v){return v==="assert"?new os(b,[_]):v==="coerce"?new fn(b,[_]):_}if(n!==null&&typeof n!="string"&&typeof n!="boolean"&&typeof n!="number"||(n=["literal",n]),Array.isArray(n)){if(n.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const _=n[0];if(typeof _!="string")return this.error(`Expression name must be a string, but found ${typeof _} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const b=this.registry[_];if(b){let v=b.parse(n,this);if(!v)return null;if(this.expectedType){const T=this.expectedType,E=v.type;if(T.kind!=="string"&&T.kind!=="number"&&T.kind!=="boolean"&&T.kind!=="object"&&T.kind!=="array"||E.kind!=="value"){if(T.kind==="projectionDefinition"&&["string","array"].includes(E.kind)||["color","formatted","resolvedImage"].includes(T.kind)&&["value","string"].includes(E.kind)||["padding","numberArray"].includes(T.kind)&&["value","number","array"].includes(E.kind)||T.kind==="colorArray"&&["value","string","array"].includes(E.kind)||T.kind==="variableAnchorOffsetCollection"&&["value","array"].includes(E.kind))v=f(v,T,l.typeAnnotation||"coerce");else if(this.checkSubtype(T,E))return null}else v=f(v,T,l.typeAnnotation||"assert")}if(!(v instanceof Pn)&&v.type.kind!=="resolvedImage"&&this._isConstant(v)){const T=new xu;try{v=new Pn(v.type,v.evaluate(T))}catch(E){return this.error(E.message),null}}return v}return this.error(`Unknown expression "${_}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(n===void 0?"'undefined' value invalid. Use null instead.":typeof n=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof n} instead.`)}concat(n,l,f){const _=typeof n=="number"?this.path.concat(n):this.path,b=f?this.scope.concat(f):this.scope;return new da(this.registry,this._isConstant,_,l||null,b,this.errors)}error(n,...l){const f=`${this.key}${l.map(_=>`[${_}]`).join("")}`;this.errors.push(new bi(f,n))}checkSubtype(n,l){const f=Fs(n,l);return f&&this.error(f),f}}class ll{constructor(n,l){this.type=l.type,this.bindings=[].concat(n),this.result=l}evaluate(n){return this.result.evaluate(n)}eachChild(n){for(const l of this.bindings)n(l[1]);n(this.result)}static parse(n,l){if(n.length<4)return l.error(`Expected at least 3 arguments, but found ${n.length-1} instead.`);const f=[];for(let b=1;b<n.length-1;b+=2){const v=n[b];if(typeof v!="string")return l.error(`Expected string, but found ${typeof v} instead.`,b);if(/[^a-zA-Z0-9_]/.test(v))return l.error("Variable names must contain only alphanumeric characters or '_'.",b);const T=l.parse(n[b+1],b+1);if(!T)return null;f.push([v,T])}const _=l.parse(n[n.length-1],n.length-1,l.expectedType,f);return _?new ll(f,_):null}outputDefined(){return this.result.outputDefined()}}class Pc{constructor(n,l){this.type=l.type,this.name=n,this.boundExpression=l}static parse(n,l){if(n.length!==2||typeof n[1]!="string")return l.error("'var' expression requires exactly one string literal argument.");const f=n[1];return l.scope.has(f)?new Pc(f,l.scope.get(f)):l.error(`Unknown variable "${f}". Make sure "${f}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(n){return this.boundExpression.evaluate(n)}eachChild(){}outputDefined(){return!1}}class Bc{constructor(n,l,f){this.type=n,this.index=l,this.input=f}static parse(n,l){if(n.length!==3)return l.error(`Expected 2 arguments, but found ${n.length-1} instead.`);const f=l.parse(n[1],1,rt),_=l.parse(n[2],2,Vi(l.expectedType||At));return f&&_?new Bc(_.type.itemType,f,_):null}evaluate(n){const l=this.index.evaluate(n),f=this.input.evaluate(n);if(l<0)throw new ai(`Array index out of bounds: ${l} < 0.`);if(l>=f.length)throw new ai(`Array index out of bounds: ${l} > ${f.length-1}.`);if(l!==Math.floor(l))throw new ai(`Array index must be an integer, but found ${l} instead.`);return f[l]}eachChild(n){n(this.index),n(this.input)}outputDefined(){return!1}}class Dc{constructor(n,l){this.type=It,this.needle=n,this.haystack=l}static parse(n,l){if(n.length!==3)return l.error(`Expected 2 arguments, but found ${n.length-1} instead.`);const f=l.parse(n[1],1,At),_=l.parse(n[2],2,At);return f&&_?Kr(f.type,[It,Ot,rt,eo,At])?new Dc(f,_):l.error(`Expected first argument to be of type boolean, string, number or null, but found ${Vt(f.type)} instead`):null}evaluate(n){const l=this.needle.evaluate(n),f=this.haystack.evaluate(n);if(!f)return!1;if(!lr(l,["boolean","string","number","null"]))throw new ai(`Expected first argument to be of type boolean, string, number or null, but found ${Vt(xt(l))} instead.`);if(!lr(f,["string","array"]))throw new ai(`Expected second argument to be of type array or string, but found ${Vt(xt(f))} instead.`);return f.indexOf(l)>=0}eachChild(n){n(this.needle),n(this.haystack)}outputDefined(){return!0}}class Ls{constructor(n,l,f){this.type=rt,this.needle=n,this.haystack=l,this.fromIndex=f}static parse(n,l){if(n.length<=2||n.length>=5)return l.error(`Expected 3 or 4 arguments, but found ${n.length-1} instead.`);const f=l.parse(n[1],1,At),_=l.parse(n[2],2,At);if(!f||!_)return null;if(!Kr(f.type,[It,Ot,rt,eo,At]))return l.error(`Expected first argument to be of type boolean, string, number or null, but found ${Vt(f.type)} instead`);if(n.length===4){const b=l.parse(n[3],3,rt);return b?new Ls(f,_,b):null}return new Ls(f,_)}evaluate(n){const l=this.needle.evaluate(n),f=this.haystack.evaluate(n);if(!lr(l,["boolean","string","number","null"]))throw new ai(`Expected first argument to be of type boolean, string, number or null, but found ${Vt(xt(l))} instead.`);let _;if(this.fromIndex&&(_=this.fromIndex.evaluate(n)),lr(f,["string"])){const b=f.indexOf(l,_);return b===-1?-1:[...f.slice(0,b)].length}if(lr(f,["array"]))return f.indexOf(l,_);throw new ai(`Expected second argument to be of type array or string, but found ${Vt(xt(f))} instead.`)}eachChild(n){n(this.needle),n(this.haystack),this.fromIndex&&n(this.fromIndex)}outputDefined(){return!1}}class hr{constructor(n,l,f,_,b,v){this.inputType=n,this.type=l,this.input=f,this.cases=_,this.outputs=b,this.otherwise=v}static parse(n,l){if(n.length<5)return l.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if(n.length%2!=1)return l.error("Expected an even number of arguments.");let f,_;l.expectedType&&l.expectedType.kind!=="value"&&(_=l.expectedType);const b={},v=[];for(let I=2;I<n.length-1;I+=2){let P=n[I];const O=n[I+1];Array.isArray(P)||(P=[P]);const z=l.concat(I);if(P.length===0)return z.error("Expected at least one branch label.");for(const H of P){if(typeof H!="number"&&typeof H!="string")return z.error("Branch labels must be numbers or strings.");if(typeof H=="number"&&Math.abs(H)>Number.MAX_SAFE_INTEGER)return z.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof H=="number"&&Math.floor(H)!==H)return z.error("Numeric branch labels must be integer values.");if(f){if(z.checkSubtype(f,xt(H)))return null}else f=xt(H);if(b[String(H)]!==void 0)return z.error("Branch labels must be unique.");b[String(H)]=v.length}const j=l.parse(O,I,_);if(!j)return null;_=_||j.type,v.push(j)}const T=l.parse(n[1],1,At);if(!T)return null;const E=l.parse(n[n.length-1],n.length-1,_);return E?T.type.kind!=="value"&&l.concat(1).checkSubtype(f,T.type)?null:new hr(f,_,T,b,v,E):null}evaluate(n){const l=this.input.evaluate(n);return(xt(l)===this.inputType&&this.outputs[this.cases[l]]||this.otherwise).evaluate(n)}eachChild(n){n(this.input),this.outputs.forEach(n),n(this.otherwise)}outputDefined(){return this.outputs.every(n=>n.outputDefined())&&this.otherwise.outputDefined()}}class fa{constructor(n,l,f){this.type=n,this.branches=l,this.otherwise=f}static parse(n,l){if(n.length<4)return l.error(`Expected at least 3 arguments, but found only ${n.length-1}.`);if(n.length%2!=0)return l.error("Expected an odd number of arguments.");let f;l.expectedType&&l.expectedType.kind!=="value"&&(f=l.expectedType);const _=[];for(let v=1;v<n.length-1;v+=2){const T=l.parse(n[v],v,It);if(!T)return null;const E=l.parse(n[v+1],v+1,f);if(!E)return null;_.push([T,E]),f=f||E.type}const b=l.parse(n[n.length-1],n.length-1,f);if(!b)return null;if(!f)throw new Error("Can't infer output type");return new fa(f,_,b)}evaluate(n){for(const[l,f]of this.branches)if(l.evaluate(n))return f.evaluate(n);return this.otherwise.evaluate(n)}eachChild(n){for(const[l,f]of this.branches)n(l),n(f);n(this.otherwise)}outputDefined(){return this.branches.every(([n,l])=>l.outputDefined())&&this.otherwise.outputDefined()}}class cl{constructor(n,l,f,_){this.type=n,this.input=l,this.beginIndex=f,this.endIndex=_}static parse(n,l){if(n.length<=2||n.length>=5)return l.error(`Expected 3 or 4 arguments, but found ${n.length-1} instead.`);const f=l.parse(n[1],1,At),_=l.parse(n[2],2,rt);if(!f||!_)return null;if(!Kr(f.type,[Vi(At),Ot,At]))return l.error(`Expected first argument to be of type array or string, but found ${Vt(f.type)} instead`);if(n.length===4){const b=l.parse(n[3],3,rt);return b?new cl(f.type,f,_,b):null}return new cl(f.type,f,_)}evaluate(n){const l=this.input.evaluate(n),f=this.beginIndex.evaluate(n);let _;if(this.endIndex&&(_=this.endIndex.evaluate(n)),lr(l,["string"]))return[...l].slice(f,_).join("");if(lr(l,["array"]))return l.slice(f,_);throw new ai(`Expected first argument to be of type array or string, but found ${Vt(xt(l))} instead.`)}eachChild(n){n(this.input),n(this.beginIndex),this.endIndex&&n(this.endIndex)}outputDefined(){return!1}}function Co(c,n){const l=c.length-1;let f,_,b=0,v=l,T=0;for(;b<=v;)if(T=Math.floor((b+v)/2),f=c[T],_=c[T+1],f<=n){if(T===l||n<_)return T;b=T+1}else{if(!(f>n))throw new ai("Input is not a number.");v=T-1}return 0}class Di{constructor(n,l,f){this.type=n,this.input=l,this.labels=[],this.outputs=[];for(const[_,b]of f)this.labels.push(_),this.outputs.push(b)}static parse(n,l){if(n.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if((n.length-1)%2!=0)return l.error("Expected an even number of arguments.");const f=l.parse(n[1],1,rt);if(!f)return null;const _=[];let b=null;l.expectedType&&l.expectedType.kind!=="value"&&(b=l.expectedType);for(let v=1;v<n.length;v+=2){const T=v===1?-1/0:n[v],E=n[v+1],I=v,P=v+1;if(typeof T!="number")return l.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',I);if(_.length&&_[_.length-1][0]>=T)return l.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',I);const O=l.parse(E,P,b);if(!O)return null;b=b||O.type,_.push([T,O])}return new Di(b,f,_)}evaluate(n){const l=this.labels,f=this.outputs;if(l.length===1)return f[0].evaluate(n);const _=this.input.evaluate(n);if(_<=l[0])return f[0].evaluate(n);const b=l.length;return _>=l[b-1]?f[b-1].evaluate(n):f[Co(l,_)].evaluate(n)}eachChild(n){n(this.input);for(const l of this.outputs)n(l)}outputDefined(){return this.outputs.every(n=>n.outputDefined())}}function fp(c){return c&&c.__esModule&&Object.prototype.hasOwnProperty.call(c,"default")?c.default:c}var hl,wu,wy=function(){if(wu)return hl;function c(n,l,f,_){this.cx=3*n,this.bx=3*(f-n)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*l,this.by=3*(_-l)-this.cy,this.ay=1-this.cy-this.by,this.p1x=n,this.p1y=l,this.p2x=f,this.p2y=_}return wu=1,hl=c,c.prototype={sampleCurveX:function(n){return((this.ax*n+this.bx)*n+this.cx)*n},sampleCurveY:function(n){return((this.ay*n+this.by)*n+this.cy)*n},sampleCurveDerivativeX:function(n){return(3*this.ax*n+2*this.bx)*n+this.cx},solveCurveX:function(n,l){if(l===void 0&&(l=1e-6),n<0)return 0;if(n>1)return 1;for(var f=n,_=0;_<8;_++){var b=this.sampleCurveX(f)-n;if(Math.abs(b)<l)return f;var v=this.sampleCurveDerivativeX(f);if(Math.abs(v)<1e-6)break;f-=b/v}var T=0,E=1;for(f=n,_=0;_<20&&(b=this.sampleCurveX(f),!(Math.abs(b-n)<l));_++)n>b?T=f:E=f,f=.5*(E-T)+T;return f},solve:function(n,l){return this.sampleCurveY(this.solveCurveX(n,l))}},hl}(),pa=fp(wy);class wr{constructor(n,l,f,_,b){this.type=n,this.operator=l,this.interpolation=f,this.input=_,this.labels=[],this.outputs=[];for(const[v,T]of b)this.labels.push(v),this.outputs.push(T)}static interpolationFactor(n,l,f,_){let b=0;if(n.name==="exponential")b=ul(l,n.base,f,_);else if(n.name==="linear")b=ul(l,1,f,_);else if(n.name==="cubic-bezier"){const v=n.controlPoints;b=new pa(v[0],v[1],v[2],v[3]).solve(ul(l,1,f,_))}return b}static parse(n,l){let[f,_,b,...v]=n;if(!Array.isArray(_)||_.length===0)return l.error("Expected an interpolation type expression.",1);if(_[0]==="linear")_={name:"linear"};else if(_[0]==="exponential"){const I=_[1];if(typeof I!="number")return l.error("Exponential interpolation requires a numeric base.",1,1);_={name:"exponential",base:I}}else{if(_[0]!=="cubic-bezier")return l.error(`Unknown interpolation type ${String(_[0])}`,1,0);{const I=_.slice(1);if(I.length!==4||I.some(P=>typeof P!="number"||P<0||P>1))return l.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);_={name:"cubic-bezier",controlPoints:I}}}if(n.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if((n.length-1)%2!=0)return l.error("Expected an even number of arguments.");if(b=l.parse(b,2,rt),!b)return null;const T=[];let E=null;f!=="interpolate-hcl"&&f!=="interpolate-lab"||l.expectedType==ys?l.expectedType&&l.expectedType.kind!=="value"&&(E=l.expectedType):E=Xi;for(let I=0;I<v.length;I+=2){const P=v[I],O=v[I+1],z=I+3,j=I+4;if(typeof P!="number")return l.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',z);if(T.length&&T[T.length-1][0]>=P)return l.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',z);const H=l.parse(O,j,E);if(!H)return null;E=E||H.type,T.push([P,H])}return ks(E,rt)||ks(E,Os)||ks(E,Xi)||ks(E,to)||ks(E,io)||ks(E,ys)||ks(E,xr)||ks(E,Vi(rt))?new wr(E,f,_,b,T):l.error(`Type ${Vt(E)} is not interpolatable.`)}evaluate(n){const l=this.labels,f=this.outputs;if(l.length===1)return f[0].evaluate(n);const _=this.input.evaluate(n);if(_<=l[0])return f[0].evaluate(n);const b=l.length;if(_>=l[b-1])return f[b-1].evaluate(n);const v=Co(l,_),T=wr.interpolationFactor(this.interpolation,_,l[v],l[v+1]),E=f[v].evaluate(n),I=f[v+1].evaluate(n);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return Mt(E,I,T);case"color":return yt.interpolate(E,I,T);case"padding":return cr.interpolate(E,I,T);case"colorArray":return qi.interpolate(E,I,T);case"numberArray":return zr.interpolate(E,I,T);case"variableAnchorOffsetCollection":return Vr.interpolate(E,I,T);case"array":return pi(E,I,T);case"projectionDefinition":return Rr.interpolate(E,I,T)}case"interpolate-hcl":switch(this.type.kind){case"color":return yt.interpolate(E,I,T,"hcl");case"colorArray":return qi.interpolate(E,I,T,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return yt.interpolate(E,I,T,"lab");case"colorArray":return qi.interpolate(E,I,T,"lab")}}}eachChild(n){n(this.input);for(const l of this.outputs)n(l)}outputDefined(){return this.outputs.every(n=>n.outputDefined())}}function ul(c,n,l,f){const _=f-l,b=c-l;return _===0?0:n===1?b/_:(Math.pow(n,b)-1)/(Math.pow(n,_)-1)}const pn={color:yt.interpolate,number:Mt,padding:cr.interpolate,numberArray:zr.interpolate,colorArray:qi.interpolate,variableAnchorOffsetCollection:Vr.interpolate,array:pi};class dl{constructor(n,l){this.type=n,this.args=l}static parse(n,l){if(n.length<2)return l.error("Expected at least one argument.");let f=null;const _=l.expectedType;_&&_.kind!=="value"&&(f=_);const b=[];for(const T of n.slice(1)){const E=l.parse(T,1+b.length,f,void 0,{typeAnnotation:"omit"});if(!E)return null;f=f||E.type,b.push(E)}if(!f)throw new Error("No output type");const v=_&&b.some(T=>Fs(_,T.type));return new dl(v?At:f,b)}evaluate(n){let l,f=null,_=0;for(const b of this.args)if(_++,f=b.evaluate(n),f&&f instanceof ns&&!f.available&&(l||(l=f.name),f=null,_===this.args.length&&(f=l)),f!==null)break;return f}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every(n=>n.outputDefined())}}function fl(c,n){return c==="=="||c==="!="?n.kind==="boolean"||n.kind==="string"||n.kind==="number"||n.kind==="null"||n.kind==="value":n.kind==="string"||n.kind==="number"||n.kind==="value"}function pl(c,n,l,f){return f.compare(n,l)===0}function Pr(c,n,l){const f=c!=="=="&&c!=="!=";return class VE{constructor(b,v,T){this.type=It,this.lhs=b,this.rhs=v,this.collator=T,this.hasUntypedArgument=b.type.kind==="value"||v.type.kind==="value"}static parse(b,v){if(b.length!==3&&b.length!==4)return v.error("Expected two or three arguments.");const T=b[0];let E=v.parse(b[1],1,At);if(!E)return null;if(!fl(T,E.type))return v.concat(1).error(`"${T}" comparisons are not supported for type '${Vt(E.type)}'.`);let I=v.parse(b[2],2,At);if(!I)return null;if(!fl(T,I.type))return v.concat(2).error(`"${T}" comparisons are not supported for type '${Vt(I.type)}'.`);if(E.type.kind!==I.type.kind&&E.type.kind!=="value"&&I.type.kind!=="value")return v.error(`Cannot compare types '${Vt(E.type)}' and '${Vt(I.type)}'.`);f&&(E.type.kind==="value"&&I.type.kind!=="value"?E=new os(I.type,[E]):E.type.kind!=="value"&&I.type.kind==="value"&&(I=new os(E.type,[I])));let P=null;if(b.length===4){if(E.type.kind!=="string"&&I.type.kind!=="string"&&E.type.kind!=="value"&&I.type.kind!=="value")return v.error("Cannot use collator to compare non-string types.");if(P=v.parse(b[3],3,hn),!P)return null}return new VE(E,I,P)}evaluate(b){const v=this.lhs.evaluate(b),T=this.rhs.evaluate(b);if(f&&this.hasUntypedArgument){const E=xt(v),I=xt(T);if(E.kind!==I.kind||E.kind!=="string"&&E.kind!=="number")throw new ai(`Expected arguments for "${c}" to be (string, string) or (number, number), but found (${E.kind}, ${I.kind}) instead.`)}if(this.collator&&!f&&this.hasUntypedArgument){const E=xt(v),I=xt(T);if(E.kind!=="string"||I.kind!=="string")return n(b,v,T)}return this.collator?l(b,v,T,this.collator.evaluate(b)):n(b,v,T)}eachChild(b){b(this.lhs),b(this.rhs),this.collator&&b(this.collator)}outputDefined(){return!0}}}const pp=Pr("==",function(c,n,l){return n===l},pl),Oc=Pr("!=",function(c,n,l){return n!==l},function(c,n,l,f){return!pl(0,n,l,f)}),Ty=Pr("<",function(c,n,l){return n<l},function(c,n,l,f){return f.compare(n,l)<0}),Tu=Pr(">",function(c,n,l){return n>l},function(c,n,l,f){return f.compare(n,l)>0}),Ay=Pr("<=",function(c,n,l){return n<=l},function(c,n,l,f){return f.compare(n,l)<=0}),Ey=Pr(">=",function(c,n,l){return n>=l},function(c,n,l,f){return f.compare(n,l)>=0});class Fc{constructor(n,l,f){this.type=hn,this.locale=f,this.caseSensitive=n,this.diacriticSensitive=l}static parse(n,l){if(n.length!==2)return l.error("Expected one argument.");const f=n[1];if(typeof f!="object"||Array.isArray(f))return l.error("Collator options argument must be an object.");const _=l.parse(f["case-sensitive"]!==void 0&&f["case-sensitive"],1,It);if(!_)return null;const b=l.parse(f["diacritic-sensitive"]!==void 0&&f["diacritic-sensitive"],1,It);if(!b)return null;let v=null;return f.locale&&(v=l.parse(f.locale,1,Ot),!v)?null:new Fc(_,b,v)}evaluate(n){return new Si(this.caseSensitive.evaluate(n),this.diacriticSensitive.evaluate(n),this.locale?this.locale.evaluate(n):null)}eachChild(n){n(this.caseSensitive),n(this.diacriticSensitive),this.locale&&n(this.locale)}outputDefined(){return!1}}class Au{constructor(n,l,f,_,b){this.type=Ot,this.number=n,this.locale=l,this.currency=f,this.minFractionDigits=_,this.maxFractionDigits=b}static parse(n,l){if(n.length!==3)return l.error("Expected two arguments.");const f=l.parse(n[1],1,rt);if(!f)return null;const _=n[2];if(typeof _!="object"||Array.isArray(_))return l.error("NumberFormat options argument must be an object.");let b=null;if(_.locale&&(b=l.parse(_.locale,1,Ot),!b))return null;let v=null;if(_.currency&&(v=l.parse(_.currency,1,Ot),!v))return null;let T=null;if(_["min-fraction-digits"]&&(T=l.parse(_["min-fraction-digits"],1,rt),!T))return null;let E=null;return _["max-fraction-digits"]&&(E=l.parse(_["max-fraction-digits"],1,rt),!E)?null:new Au(f,b,v,T,E)}evaluate(n){return new Intl.NumberFormat(this.locale?this.locale.evaluate(n):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(n):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(n):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(n):void 0}).format(this.number.evaluate(n))}eachChild(n){n(this.number),this.locale&&n(this.locale),this.currency&&n(this.currency),this.minFractionDigits&&n(this.minFractionDigits),this.maxFractionDigits&&n(this.maxFractionDigits)}outputDefined(){return!1}}class Io{constructor(n){this.type=ss,this.sections=n}static parse(n,l){if(n.length<2)return l.error("Expected at least one argument.");const f=n[1];if(!Array.isArray(f)&&typeof f=="object")return l.error("First argument must be an image or text section.");const _=[];let b=!1;for(let v=1;v<=n.length-1;++v){const T=n[v];if(b&&typeof T=="object"&&!Array.isArray(T)){b=!1;let E=null;if(T["font-scale"]&&(E=l.parse(T["font-scale"],1,rt),!E))return null;let I=null;if(T["text-font"]&&(I=l.parse(T["text-font"],1,Vi(Ot)),!I))return null;let P=null;if(T["text-color"]&&(P=l.parse(T["text-color"],1,Xi),!P))return null;let O=null;if(T["vertical-align"]){if(typeof T["vertical-align"]=="string"&&!Lr.includes(T["vertical-align"]))return l.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${T["vertical-align"]}' instead.`);if(O=l.parse(T["vertical-align"],1,Ot),!O)return null}const z=_[_.length-1];z.scale=E,z.font=I,z.textColor=P,z.verticalAlign=O}else{const E=l.parse(n[v],1,At);if(!E)return null;const I=E.type.kind;if(I!=="string"&&I!=="value"&&I!=="null"&&I!=="resolvedImage")return l.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");b=!0,_.push({content:E,scale:null,font:null,textColor:null,verticalAlign:null})}}return new Io(_)}evaluate(n){return new Ur(this.sections.map(l=>{const f=l.content.evaluate(n);return xt(f)===hi?new Mc("",f,null,null,null,l.verticalAlign?l.verticalAlign.evaluate(n):null):new Mc(Rt(f),null,l.scale?l.scale.evaluate(n):null,l.font?l.font.evaluate(n).join(","):null,l.textColor?l.textColor.evaluate(n):null,l.verticalAlign?l.verticalAlign.evaluate(n):null)}))}eachChild(n){for(const l of this.sections)n(l.content),l.scale&&n(l.scale),l.font&&n(l.font),l.textColor&&n(l.textColor),l.verticalAlign&&n(l.verticalAlign)}outputDefined(){return!1}}class Eu{constructor(n){this.type=hi,this.input=n}static parse(n,l){if(n.length!==2)return l.error("Expected two arguments.");const f=l.parse(n[1],1,Ot);return f?new Eu(f):l.error("No image name provided.")}evaluate(n){const l=this.input.evaluate(n),f=ns.fromString(l);return f&&n.availableImages&&(f.available=n.availableImages.indexOf(l)>-1),f}eachChild(n){n(this.input)}outputDefined(){return!1}}class kc{constructor(n){this.type=rt,this.input=n}static parse(n,l){if(n.length!==2)return l.error(`Expected 1 argument, but found ${n.length-1} instead.`);const f=l.parse(n[1],1);return f?f.type.kind!=="array"&&f.type.kind!=="string"&&f.type.kind!=="value"?l.error(`Expected argument of type string or array, but found ${Vt(f.type)} instead.`):new kc(f):null}evaluate(n){const l=this.input.evaluate(n);if(typeof l=="string")return[...l].length;if(Array.isArray(l))return l.length;throw new ai(`Expected value to be of type string or array, but found ${Vt(xt(l))} instead.`)}eachChild(n){n(this.input)}outputDefined(){return!1}}const Us=8192;function Sy(c,n){const l=(180+c[0])/360,f=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+c[1]*Math.PI/360)))/360,_=Math.pow(2,n.z);return[Math.round(l*_*Us),Math.round(f*_*Us)]}function Nc(c,n){const l=Math.pow(2,n.z);return[(_=(c[0]/Us+n.x)/l,360*_-180),(f=(c[1]/Us+n.y)/l,360/Math.PI*Math.atan(Math.exp((180-360*f)*Math.PI/180))-90)];var f,_}function _l(c,n){c[0]=Math.min(c[0],n[0]),c[1]=Math.min(c[1],n[1]),c[2]=Math.max(c[2],n[0]),c[3]=Math.max(c[3],n[1])}function gl(c,n){return!(c[0]<=n[0]||c[2]>=n[2]||c[1]<=n[1]||c[3]>=n[3])}function Cy(c,n,l){const f=c[0]-n[0],_=c[1]-n[1],b=c[0]-l[0],v=c[1]-l[1];return f*v-b*_==0&&f*b<=0&&_*v<=0}function Lc(c,n,l,f){return(_=[f[0]-l[0],f[1]-l[1]])[0]*(b=[n[0]-c[0],n[1]-c[1]])[1]-_[1]*b[0]!=0&&!(!gp(c,n,l,f)||!gp(l,f,c,n));var _,b}function Iy(c,n,l){for(const f of l)for(let _=0;_<f.length-1;++_)if(Lc(c,n,f[_],f[_+1]))return!0;return!1}function Mo(c,n,l=!1){let f=!1;for(const T of n)for(let E=0;E<T.length-1;E++){if(Cy(c,T[E],T[E+1]))return l;(b=T[E])[1]>(_=c)[1]!=(v=T[E+1])[1]>_[1]&&_[0]<(v[0]-b[0])*(_[1]-b[1])/(v[1]-b[1])+b[0]&&(f=!f)}var _,b,v;return f}function _p(c,n){for(const l of n)if(Mo(c,l))return!0;return!1}function Su(c,n){for(const l of c)if(!Mo(l,n))return!1;for(let l=0;l<c.length-1;++l)if(Iy(c[l],c[l+1],n))return!1;return!0}function My(c,n){for(const l of n)if(Su(c,l))return!0;return!1}function gp(c,n,l,f){const _=f[0]-l[0],b=f[1]-l[1],v=(c[0]-l[0])*b-_*(c[1]-l[1]),T=(n[0]-l[0])*b-_*(n[1]-l[1]);return v>0&&T<0||v<0&&T>0}function Cu(c,n,l){const f=[];for(let _=0;_<c.length;_++){const b=[];for(let v=0;v<c[_].length;v++){const T=Sy(c[_][v],l);_l(n,T),b.push(T)}f.push(b)}return f}function mp(c,n,l){const f=[];for(let _=0;_<c.length;_++){const b=Cu(c[_],n,l);f.push(b)}return f}function Uc(c,n,l,f){if(c[0]<l[0]||c[0]>l[2]){const _=.5*f;let b=c[0]-l[0]>_?-f:l[0]-c[0]>_?f:0;b===0&&(b=c[0]-l[2]>_?-f:l[2]-c[0]>_?f:0),c[0]+=b}_l(n,c)}function yp(c,n,l,f){const _=Math.pow(2,f.z)*Us,b=[f.x*Us,f.y*Us],v=[];for(const T of c)for(const E of T){const I=[E.x+b[0],E.y+b[1]];Uc(I,n,l,_),v.push(I)}return v}function bp(c,n,l,f){const _=Math.pow(2,f.z)*Us,b=[f.x*Us,f.y*Us],v=[];for(const E of c){const I=[];for(const P of E){const O=[P.x+b[0],P.y+b[1]];_l(n,O),I.push(O)}v.push(I)}if(n[2]-n[0]<=_/2){(T=n)[0]=T[1]=1/0,T[2]=T[3]=-1/0;for(const E of v)for(const I of E)Uc(I,n,l,_)}var T;return v}class Ro{constructor(n,l){this.type=It,this.geojson=n,this.geometries=l}static parse(n,l){if(n.length!==2)return l.error(`'within' expression requires exactly one argument, but found ${n.length-1} instead.`);if(So(n[1])){const f=n[1];if(f.type==="FeatureCollection"){const _=[];for(const b of f.features){const{type:v,coordinates:T}=b.geometry;v==="Polygon"&&_.push(T),v==="MultiPolygon"&&_.push(...T)}if(_.length)return new Ro(f,{type:"MultiPolygon",coordinates:_})}else if(f.type==="Feature"){const _=f.geometry.type;if(_==="Polygon"||_==="MultiPolygon")return new Ro(f,f.geometry)}else if(f.type==="Polygon"||f.type==="MultiPolygon")return new Ro(f,f)}return l.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(n){if(n.geometry()!=null&&n.canonicalID()!=null){if(n.geometryType()==="Point")return function(l,f){const _=[1/0,1/0,-1/0,-1/0],b=[1/0,1/0,-1/0,-1/0],v=l.canonicalID();if(f.type==="Polygon"){const T=Cu(f.coordinates,b,v),E=yp(l.geometry(),_,b,v);if(!gl(_,b))return!1;for(const I of E)if(!Mo(I,T))return!1}if(f.type==="MultiPolygon"){const T=mp(f.coordinates,b,v),E=yp(l.geometry(),_,b,v);if(!gl(_,b))return!1;for(const I of E)if(!_p(I,T))return!1}return!0}(n,this.geometries);if(n.geometryType()==="LineString")return function(l,f){const _=[1/0,1/0,-1/0,-1/0],b=[1/0,1/0,-1/0,-1/0],v=l.canonicalID();if(f.type==="Polygon"){const T=Cu(f.coordinates,b,v),E=bp(l.geometry(),_,b,v);if(!gl(_,b))return!1;for(const I of E)if(!Su(I,T))return!1}if(f.type==="MultiPolygon"){const T=mp(f.coordinates,b,v),E=bp(l.geometry(),_,b,v);if(!gl(_,b))return!1;for(const I of E)if(!My(I,T))return!1}return!0}(n,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let Iu=class{constructor(c=[],n=(l,f)=>l<f?-1:l>f?1:0){if(this.data=c,this.length=this.data.length,this.compare=n,this.length>0)for(let l=(this.length>>1)-1;l>=0;l--)this._down(l)}push(c){this.data.push(c),this._up(this.length++)}pop(){if(this.length===0)return;const c=this.data[0],n=this.data.pop();return--this.length>0&&(this.data[0]=n,this._down(0)),c}peek(){return this.data[0]}_up(c){const{data:n,compare:l}=this,f=n[c];for(;c>0;){const _=c-1>>1,b=n[_];if(l(f,b)>=0)break;n[c]=b,c=_}n[c]=f}_down(c){const{data:n,compare:l}=this,f=this.length>>1,_=n[c];for(;c<f;){let b=1+(c<<1);const v=b+1;if(v<this.length&&l(n[v],n[b])<0&&(b=v),l(n[b],_)>=0)break;n[c]=n[b],c=b}n[c]=_}};function Mu(c,n,l=0,f=c.length-1,_=Ry){for(;f>l;){if(f-l>600){const E=f-l+1,I=n-l+1,P=Math.log(E),O=.5*Math.exp(2*P/3),z=.5*Math.sqrt(P*O*(E-O)/E)*(I-E/2<0?-1:1);Mu(c,n,Math.max(l,Math.floor(n-I*O/E+z)),Math.min(f,Math.floor(n+(E-I)*O/E+z)),_)}const b=c[n];let v=l,T=f;for(ml(c,l,n),_(c[f],b)>0&&ml(c,l,f);v<T;){for(ml(c,v,T),v++,T--;_(c[v],b)<0;)v++;for(;_(c[T],b)>0;)T--}_(c[l],b)===0?ml(c,l,T):(T++,ml(c,T,f)),T<=n&&(l=T+1),n<=T&&(f=T-1)}}function ml(c,n,l){const f=c[n];c[n]=c[l],c[l]=f}function Ry(c,n){return c<n?-1:c>n?1:0}function yl(c,n){if(c.length<=1)return[c];const l=[];let f,_;for(const b of c){const v=Py(b);v!==0&&(b.area=Math.abs(v),_===void 0&&(_=v<0),_===v<0?(f&&l.push(f),f=[b]):f.push(b))}if(f&&l.push(f),n>1)for(let b=0;b<l.length;b++)l[b].length<=n||(Mu(l[b],n,1,l[b].length-1,vp),l[b]=l[b].slice(0,n));return l}function vp(c,n){return n.area-c.area}function Py(c){let n=0;for(let l,f,_=0,b=c.length,v=b-1;_<b;v=_++)l=c[_],f=c[v],n+=(f.x-l.x)*(l.y+f.y);return n}const xp=1/298.257223563,wp=xp*(2-xp),Ru=Math.PI/180;class Pu{constructor(n){const l=6378.137*Ru*1e3,f=Math.cos(n*Ru),_=1/(1-wp*(1-f*f)),b=Math.sqrt(_);this.kx=l*b*f,this.ky=l*b*_*(1-wp)}distance(n,l){const f=this.wrap(n[0]-l[0])*this.kx,_=(n[1]-l[1])*this.ky;return Math.sqrt(f*f+_*_)}pointOnLine(n,l){let f,_,b,v,T=1/0;for(let E=0;E<n.length-1;E++){let I=n[E][0],P=n[E][1],O=this.wrap(n[E+1][0]-I)*this.kx,z=(n[E+1][1]-P)*this.ky,j=0;O===0&&z===0||(j=(this.wrap(l[0]-I)*this.kx*O+(l[1]-P)*this.ky*z)/(O*O+z*z),j>1?(I=n[E+1][0],P=n[E+1][1]):j>0&&(I+=O/this.kx*j,P+=z/this.ky*j)),O=this.wrap(l[0]-I)*this.kx,z=(l[1]-P)*this.ky;const H=O*O+z*z;H<T&&(T=H,f=I,_=P,b=E,v=j)}return{point:[f,_],index:b,t:Math.max(0,Math.min(1,v))}}wrap(n){for(;n<-180;)n+=360;for(;n>180;)n-=360;return n}}function Tp(c,n){return n[0]-c[0]}function zc(c){return c[1]-c[0]+1}function Bn(c,n){return c[1]>=c[0]&&c[1]<n}function Wt(c,n){if(c[0]>c[1])return[null,null];const l=zc(c);if(n){if(l===2)return[c,null];const _=Math.floor(l/2);return[[c[0],c[0]+_],[c[0]+_,c[1]]]}if(l===1)return[c,null];const f=Math.floor(l/2)-1;return[[c[0],c[0]+f],[c[0]+f+1,c[1]]]}function Bu(c,n){if(!Bn(n,c.length))return[1/0,1/0,-1/0,-1/0];const l=[1/0,1/0,-1/0,-1/0];for(let f=n[0];f<=n[1];++f)_l(l,c[f]);return l}function Du(c){const n=[1/0,1/0,-1/0,-1/0];for(const l of c)for(const f of l)_l(n,f);return n}function Ap(c){return c[0]!==-1/0&&c[1]!==-1/0&&c[2]!==1/0&&c[3]!==1/0}function Ou(c,n,l){if(!Ap(c)||!Ap(n))return NaN;let f=0,_=0;return c[2]<n[0]&&(f=n[0]-c[2]),c[0]>n[2]&&(f=c[0]-n[2]),c[1]>n[3]&&(_=c[1]-n[3]),c[3]<n[1]&&(_=n[1]-c[3]),l.distance([0,0],[f,_])}function Po(c,n,l){const f=l.pointOnLine(n,c);return l.distance(c,f.point)}function Fu(c,n,l,f,_){const b=Math.min(Po(c,[l,f],_),Po(n,[l,f],_)),v=Math.min(Po(l,[c,n],_),Po(f,[c,n],_));return Math.min(b,v)}function By(c,n,l,f,_){if(!Bn(n,c.length)||!Bn(f,l.length))return 1/0;let b=1/0;for(let v=n[0];v<n[1];++v){const T=c[v],E=c[v+1];for(let I=f[0];I<f[1];++I){const P=l[I],O=l[I+1];if(Lc(T,E,P,O))return 0;b=Math.min(b,Fu(T,E,P,O,_))}}return b}function Dy(c,n,l,f,_){if(!Bn(n,c.length)||!Bn(f,l.length))return NaN;let b=1/0;for(let v=n[0];v<=n[1];++v)for(let T=f[0];T<=f[1];++T)if(b=Math.min(b,_.distance(c[v],l[T])),b===0)return b;return b}function Oy(c,n,l){if(Mo(c,n,!0))return 0;let f=1/0;for(const _ of n){const b=_[0],v=_[_.length-1];if(b!==v&&(f=Math.min(f,Po(c,[v,b],l)),f===0))return f;const T=l.pointOnLine(_,c);if(f=Math.min(f,l.distance(c,T.point)),f===0)return f}return f}function Fy(c,n,l,f){if(!Bn(n,c.length))return NaN;for(let b=n[0];b<=n[1];++b)if(Mo(c[b],l,!0))return 0;let _=1/0;for(let b=n[0];b<n[1];++b){const v=c[b],T=c[b+1];for(const E of l)for(let I=0,P=E.length,O=P-1;I<P;O=I++){const z=E[O],j=E[I];if(Lc(v,T,z,j))return 0;_=Math.min(_,Fu(v,T,z,j,f))}}return _}function Ep(c,n){for(const l of c)for(const f of l)if(Mo(f,n,!0))return!0;return!1}function ky(c,n,l,f=1/0){const _=Du(c),b=Du(n);if(f!==1/0&&Ou(_,b,l)>=f)return f;if(gl(_,b)){if(Ep(c,n))return 0}else if(Ep(n,c))return 0;let v=1/0;for(const T of c)for(let E=0,I=T.length,P=I-1;E<I;P=E++){const O=T[P],z=T[E];for(const j of n)for(let H=0,W=j.length,K=W-1;H<W;K=H++){const ie=j[K],me=j[H];if(Lc(O,z,ie,me))return 0;v=Math.min(v,Fu(O,z,ie,me,l))}}return v}function Sp(c,n,l,f,_,b){if(!b)return;const v=Ou(Bu(f,b),_,l);v<n&&c.push([v,b,[0,0]])}function Vc(c,n,l,f,_,b,v){if(!b||!v)return;const T=Ou(Bu(f,b),Bu(_,v),l);T<n&&c.push([T,b,v])}function jc(c,n,l,f,_=1/0){let b=Math.min(f.distance(c[0],l[0][0]),_);if(b===0)return b;const v=new Iu([[0,[0,c.length-1],[0,0]]],Tp),T=Du(l);for(;v.length>0;){const E=v.pop();if(E[0]>=b)continue;const I=E[1],P=n?50:100;if(zc(I)<=P){if(!Bn(I,c.length))return NaN;if(n){const O=Fy(c,I,l,f);if(isNaN(O)||O===0)return O;b=Math.min(b,O)}else for(let O=I[0];O<=I[1];++O){const z=Oy(c[O],l,f);if(b=Math.min(b,z),b===0)return 0}}else{const O=Wt(I,n);Sp(v,b,f,c,T,O[0]),Sp(v,b,f,c,T,O[1])}}return b}function Hc(c,n,l,f,_,b=1/0){let v=Math.min(b,_.distance(c[0],l[0]));if(v===0)return v;const T=new Iu([[0,[0,c.length-1],[0,l.length-1]]],Tp);for(;T.length>0;){const E=T.pop();if(E[0]>=v)continue;const I=E[1],P=E[2],O=n?50:100,z=f?50:100;if(zc(I)<=O&&zc(P)<=z){if(!Bn(I,c.length)&&Bn(P,l.length))return NaN;let j;if(n&&f)j=By(c,I,l,P,_),v=Math.min(v,j);else if(n&&!f){const H=c.slice(I[0],I[1]+1);for(let W=P[0];W<=P[1];++W)if(j=Po(l[W],H,_),v=Math.min(v,j),v===0)return v}else if(!n&&f){const H=l.slice(P[0],P[1]+1);for(let W=I[0];W<=I[1];++W)if(j=Po(c[W],H,_),v=Math.min(v,j),v===0)return v}else j=Dy(c,I,l,P,_),v=Math.min(v,j)}else{const j=Wt(I,n),H=Wt(P,f);Vc(T,v,_,c,l,j[0],H[0]),Vc(T,v,_,c,l,j[0],H[1]),Vc(T,v,_,c,l,j[1],H[0]),Vc(T,v,_,c,l,j[1],H[1])}}return v}function ku(c){return c.type==="MultiPolygon"?c.coordinates.map(n=>({type:"Polygon",coordinates:n})):c.type==="MultiLineString"?c.coordinates.map(n=>({type:"LineString",coordinates:n})):c.type==="MultiPoint"?c.coordinates.map(n=>({type:"Point",coordinates:n})):[c]}class Bo{constructor(n,l){this.type=rt,this.geojson=n,this.geometries=l}static parse(n,l){if(n.length!==2)return l.error(`'distance' expression requires exactly one argument, but found ${n.length-1} instead.`);if(So(n[1])){const f=n[1];if(f.type==="FeatureCollection")return new Bo(f,f.features.map(_=>ku(_.geometry)).flat());if(f.type==="Feature")return new Bo(f,ku(f.geometry));if("type"in f&&"coordinates"in f)return new Bo(f,ku(f))}return l.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(n){if(n.geometry()!=null&&n.canonicalID()!=null){if(n.geometryType()==="Point")return function(l,f){const _=l.geometry(),b=_.flat().map(E=>Nc([E.x,E.y],l.canonical));if(_.length===0)return NaN;const v=new Pu(b[0][1]);let T=1/0;for(const E of f){switch(E.type){case"Point":T=Math.min(T,Hc(b,!1,[E.coordinates],!1,v,T));break;case"LineString":T=Math.min(T,Hc(b,!1,E.coordinates,!0,v,T));break;case"Polygon":T=Math.min(T,jc(b,!1,E.coordinates,v,T))}if(T===0)return T}return T}(n,this.geometries);if(n.geometryType()==="LineString")return function(l,f){const _=l.geometry(),b=_.flat().map(E=>Nc([E.x,E.y],l.canonical));if(_.length===0)return NaN;const v=new Pu(b[0][1]);let T=1/0;for(const E of f){switch(E.type){case"Point":T=Math.min(T,Hc(b,!0,[E.coordinates],!1,v,T));break;case"LineString":T=Math.min(T,Hc(b,!0,E.coordinates,!0,v,T));break;case"Polygon":T=Math.min(T,jc(b,!0,E.coordinates,v,T))}if(T===0)return T}return T}(n,this.geometries);if(n.geometryType()==="Polygon")return function(l,f){const _=l.geometry();if(_.length===0||_[0].length===0)return NaN;const b=yl(_,0).map(E=>E.map(I=>I.map(P=>Nc([P.x,P.y],l.canonical)))),v=new Pu(b[0][0][0][1]);let T=1/0;for(const E of f)for(const I of b){switch(E.type){case"Point":T=Math.min(T,jc([E.coordinates],!1,I,v,T));break;case"LineString":T=Math.min(T,jc(E.coordinates,!0,I,v,T));break;case"Polygon":T=Math.min(T,ky(I,E.coordinates,v,T))}if(T===0)return T}return T}(n,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}class bl{constructor(n){this.type=At,this.key=n}static parse(n,l){if(n.length!==2)return l.error(`Expected 1 argument, but found ${n.length-1} instead.`);const f=n[1];return f==null?l.error("Global state property must be defined."):typeof f!="string"?l.error(`Global state property must be string, but found ${typeof n[1]} instead.`):new bl(f)}evaluate(n){var l;const f=(l=n.globals)===null||l===void 0?void 0:l.globalState;return f&&Object.keys(f).length!==0?q(f,this.key):null}eachChild(){}outputDefined(){return!1}}const _a={"==":pp,"!=":Oc,">":Tu,"<":Ty,">=":Ey,"<=":Ay,array:os,at:Bc,boolean:os,case:fa,coalesce:dl,collator:Fc,format:Io,image:Eu,in:Dc,"index-of":Ls,interpolate:wr,"interpolate-hcl":wr,"interpolate-lab":wr,length:kc,let:ll,literal:Pn,match:hr,number:os,"number-format":Au,object:os,slice:cl,step:Di,string:os,"to-boolean":fn,"to-color":fn,"to-number":fn,"to-string":fn,var:Pc,within:Ro,distance:Bo,"global-state":bl};class vs{constructor(n,l,f,_){this.name=n,this.type=l,this._evaluate=f,this.args=_}evaluate(n){return this._evaluate(n,this.args)}eachChild(n){this.args.forEach(n)}outputDefined(){return!1}static parse(n,l){const f=n[0],_=vs.definitions[f];if(!_)return l.error(`Unknown expression "${f}". If you wanted a literal array, use ["literal", [...]].`,0);const b=Array.isArray(_)?_[0]:_.type,v=Array.isArray(_)?[[_[1],_[2]]]:_.overloads,T=v.filter(([I])=>!Array.isArray(I)||I.length===n.length-1);let E=null;for(const[I,P]of T){E=new da(l.registry,Gc,l.path,null,l.scope);const O=[];let z=!1;for(let j=1;j<n.length;j++){const H=n[j],W=Array.isArray(I)?I[j-1]:I.type,K=E.parse(H,1+O.length,W);if(!K){z=!0;break}O.push(K)}if(!z)if(Array.isArray(I)&&I.length!==O.length)E.error(`Expected ${I.length} arguments, but found ${O.length} instead.`);else{for(let j=0;j<O.length;j++){const H=Array.isArray(I)?I[j]:I.type,W=O[j];E.concat(j+1).checkSubtype(H,W.type)}if(E.errors.length===0)return new vs(f,b,P,O)}}if(T.length===1)l.errors.push(...E.errors);else{const I=(T.length?T:v).map(([O])=>{return z=O,Array.isArray(z)?`(${z.map(Vt).join(", ")})`:`(${Vt(z.type)}...)`;var z}).join(" | "),P=[];for(let O=1;O<n.length;O++){const z=l.parse(n[O],1+P.length);if(!z)return null;P.push(Vt(z.type))}l.error(`Expected arguments of type ${I}, but found (${P.join(", ")}) instead.`)}return null}static register(n,l){vs.definitions=l;for(const f in l)n[f]=vs}}function Cp(c,[n,l,f,_]){n=n.evaluate(c),l=l.evaluate(c),f=f.evaluate(c);const b=_?_.evaluate(c):1,v=_i(n,l,f,b);if(v)throw new ai(v);return new yt(n/255,l/255,f/255,b,!1)}function Ip(c,n){return c in n}function Nu(c,n){const l=n[c];return l===void 0?null:l}function Do(c){return{type:c}}function Gc(c){if(c instanceof Pc)return Gc(c.boundExpression);if(c instanceof vs&&c.name==="error"||c instanceof Fc||c instanceof Ro||c instanceof Bo||c instanceof bl)return!1;const n=c instanceof fn||c instanceof os;let l=!0;return c.eachChild(f=>{l=n?l&&Gc(f):l&&f instanceof Pn}),!!l&&$c(c)&&Wc(c,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"])}function $c(c){if(c instanceof vs&&(c.name==="get"&&c.args.length===1||c.name==="feature-state"||c.name==="has"&&c.args.length===1||c.name==="properties"||c.name==="geometry-type"||c.name==="id"||/^filter-/.test(c.name))||c instanceof Ro||c instanceof Bo)return!1;let n=!0;return c.eachChild(l=>{n&&!$c(l)&&(n=!1)}),n}function vl(c){if(c instanceof vs&&c.name==="feature-state")return!1;let n=!0;return c.eachChild(l=>{n&&!vl(l)&&(n=!1)}),n}function Wc(c,n){if(c instanceof vs&&n.indexOf(c.name)>=0)return!1;let l=!0;return c.eachChild(f=>{l&&!Wc(f,n)&&(l=!1)}),l}function Mp(c){return{result:"success",value:c}}function ga(c){return{result:"error",value:c}}function so(c){return c["property-type"]==="data-driven"||c["property-type"]==="cross-faded-data-driven"}function Rp(c){return!!c.expression&&c.expression.parameters.indexOf("zoom")>-1}function Lu(c){return!!c.expression&&c.expression.interpolated}function Nt(c){return c instanceof Number?"number":c instanceof String?"string":c instanceof Boolean?"boolean":Array.isArray(c)?"array":c===null?"null":typeof c}function xl(c){return typeof c=="object"&&c!==null&&!Array.isArray(c)&&xt(c)===Mr}function Ny(c){return c}function Pp(c,n){const l=c.stops&&typeof c.stops[0][0]=="object",f=l||!(l||c.property!==void 0),_=c.type||(Lu(n)?"exponential":"interval"),b=function(P){switch(P.type){case"color":return yt.parse;case"padding":return cr.parse;case"numberArray":return zr.parse;case"colorArray":return qi.parse;default:return null}}(n);if(b&&((c=Wi({},c)).stops&&(c.stops=c.stops.map(P=>[P[0],b(P[1])])),c.default=b(c.default?c.default:n.default)),c.colorSpace&&(v=c.colorSpace)!=="rgb"&&v!=="hcl"&&v!=="lab")throw new Error(`Unknown color space: "${c.colorSpace}"`);var v;const T=function(P){switch(P){case"exponential":return Dp;case"interval":return Ly;case"categorical":return Bp;case"identity":return Uy;default:throw new Error(`Unknown function type "${P}"`)}}(_);let E,I;if(_==="categorical"){E=Object.create(null);for(const P of c.stops)E[P[0]]=P[1];I=typeof c.stops[0][0]}if(l){const P={},O=[];for(let H=0;H<c.stops.length;H++){const W=c.stops[H],K=W[0].zoom;P[K]===void 0&&(P[K]={zoom:K,type:c.type,property:c.property,default:c.default,stops:[]},O.push(K)),P[K].stops.push([W[0].value,W[1]])}const z=[];for(const H of O)z.push([P[H].zoom,Pp(P[H],n)]);const j={name:"linear"};return{kind:"composite",interpolationType:j,interpolationFactor:wr.interpolationFactor.bind(void 0,j),zoomStops:z.map(H=>H[0]),evaluate:({zoom:H},W)=>Dp({stops:z,base:c.base},n,H).evaluate(H,W)}}if(f){const P=_==="exponential"?{name:"exponential",base:c.base!==void 0?c.base:1}:null;return{kind:"camera",interpolationType:P,interpolationFactor:wr.interpolationFactor.bind(void 0,P),zoomStops:c.stops.map(O=>O[0]),evaluate:({zoom:O})=>T(c,n,O,E,I)}}return{kind:"source",evaluate(P,O){const z=O&&O.properties?O.properties[c.property]:void 0;return z===void 0?no(c.default,n.default):T(c,n,z,E,I)}}}function no(c,n,l){return c!==void 0?c:n!==void 0?n:l!==void 0?l:void 0}function Bp(c,n,l,f,_){return no(typeof l===_?f[l]:void 0,c.default,n.default)}function Ly(c,n,l){if(Nt(l)!=="number")return no(c.default,n.default);const f=c.stops.length;if(f===1||l<=c.stops[0][0])return c.stops[0][1];if(l>=c.stops[f-1][0])return c.stops[f-1][1];const _=Co(c.stops.map(b=>b[0]),l);return c.stops[_][1]}function Dp(c,n,l){const f=c.base!==void 0?c.base:1;if(Nt(l)!=="number")return no(c.default,n.default);const _=c.stops.length;if(_===1||l<=c.stops[0][0])return c.stops[0][1];if(l>=c.stops[_-1][0])return c.stops[_-1][1];const b=Co(c.stops.map(P=>P[0]),l),v=function(P,O,z,j){const H=j-z,W=P-z;return H===0?0:O===1?W/H:(Math.pow(O,W)-1)/(Math.pow(O,H)-1)}(l,f,c.stops[b][0],c.stops[b+1][0]),T=c.stops[b][1],E=c.stops[b+1][1],I=pn[n.type]||Ny;return typeof T.evaluate=="function"?{evaluate(...P){const O=T.evaluate.apply(void 0,P),z=E.evaluate.apply(void 0,P);if(O!==void 0&&z!==void 0)return I(O,z,v,c.colorSpace)}}:I(T,E,v,c.colorSpace)}function Uy(c,n,l){switch(n.type){case"color":l=yt.parse(l);break;case"formatted":l=Ur.fromString(l.toString());break;case"resolvedImage":l=ns.fromString(l.toString());break;case"padding":l=cr.parse(l);break;case"colorArray":l=qi.parse(l);break;case"numberArray":l=zr.parse(l);break;default:Nt(l)===n.type||n.type==="enum"&&n.values[l]||(l=void 0)}return no(l,c.default,n.default)}vs.register(_a,{error:[{kind:"error"},[Ot],(c,[n])=>{throw new ai(n.evaluate(c))}],typeof:[Ot,[At],(c,[n])=>Vt(xt(n.evaluate(c)))],"to-rgba":[Vi(rt,4),[Xi],(c,[n])=>{const[l,f,_,b]=n.evaluate(c).rgb;return[255*l,255*f,255*_,b]}],rgb:[Xi,[rt,rt,rt],Cp],rgba:[Xi,[rt,rt,rt,rt],Cp],has:{type:It,overloads:[[[Ot],(c,[n])=>Ip(n.evaluate(c),c.properties())],[[Ot,Mr],(c,[n,l])=>Ip(n.evaluate(c),l.evaluate(c))]]},get:{type:At,overloads:[[[Ot],(c,[n])=>Nu(n.evaluate(c),c.properties())],[[Ot,Mr],(c,[n,l])=>Nu(n.evaluate(c),l.evaluate(c))]]},"feature-state":[At,[Ot],(c,[n])=>Nu(n.evaluate(c),c.featureState||{})],properties:[Mr,[],c=>c.properties()],"geometry-type":[Ot,[],c=>c.geometryType()],id:[At,[],c=>c.id()],zoom:[rt,[],c=>c.globals.zoom],"heatmap-density":[rt,[],c=>c.globals.heatmapDensity||0],elevation:[rt,[],c=>c.globals.elevation||0],"line-progress":[rt,[],c=>c.globals.lineProgress||0],accumulated:[At,[],c=>c.globals.accumulated===void 0?null:c.globals.accumulated],"+":[rt,Do(rt),(c,n)=>{let l=0;for(const f of n)l+=f.evaluate(c);return l}],"*":[rt,Do(rt),(c,n)=>{let l=1;for(const f of n)l*=f.evaluate(c);return l}],"-":{type:rt,overloads:[[[rt,rt],(c,[n,l])=>n.evaluate(c)-l.evaluate(c)],[[rt],(c,[n])=>-n.evaluate(c)]]},"/":[rt,[rt,rt],(c,[n,l])=>n.evaluate(c)/l.evaluate(c)],"%":[rt,[rt,rt],(c,[n,l])=>n.evaluate(c)%l.evaluate(c)],ln2:[rt,[],()=>Math.LN2],pi:[rt,[],()=>Math.PI],e:[rt,[],()=>Math.E],"^":[rt,[rt,rt],(c,[n,l])=>Math.pow(n.evaluate(c),l.evaluate(c))],sqrt:[rt,[rt],(c,[n])=>Math.sqrt(n.evaluate(c))],log10:[rt,[rt],(c,[n])=>Math.log(n.evaluate(c))/Math.LN10],ln:[rt,[rt],(c,[n])=>Math.log(n.evaluate(c))],log2:[rt,[rt],(c,[n])=>Math.log(n.evaluate(c))/Math.LN2],sin:[rt,[rt],(c,[n])=>Math.sin(n.evaluate(c))],cos:[rt,[rt],(c,[n])=>Math.cos(n.evaluate(c))],tan:[rt,[rt],(c,[n])=>Math.tan(n.evaluate(c))],asin:[rt,[rt],(c,[n])=>Math.asin(n.evaluate(c))],acos:[rt,[rt],(c,[n])=>Math.acos(n.evaluate(c))],atan:[rt,[rt],(c,[n])=>Math.atan(n.evaluate(c))],min:[rt,Do(rt),(c,n)=>Math.min(...n.map(l=>l.evaluate(c)))],max:[rt,Do(rt),(c,n)=>Math.max(...n.map(l=>l.evaluate(c)))],abs:[rt,[rt],(c,[n])=>Math.abs(n.evaluate(c))],round:[rt,[rt],(c,[n])=>{const l=n.evaluate(c);return l<0?-Math.round(-l):Math.round(l)}],floor:[rt,[rt],(c,[n])=>Math.floor(n.evaluate(c))],ceil:[rt,[rt],(c,[n])=>Math.ceil(n.evaluate(c))],"filter-==":[It,[Ot,At],(c,[n,l])=>c.properties()[n.value]===l.value],"filter-id-==":[It,[At],(c,[n])=>c.id()===n.value],"filter-type-==":[It,[Ot],(c,[n])=>c.geometryType()===n.value],"filter-<":[It,[Ot,At],(c,[n,l])=>{const f=c.properties()[n.value],_=l.value;return typeof f==typeof _&&f<_}],"filter-id-<":[It,[At],(c,[n])=>{const l=c.id(),f=n.value;return typeof l==typeof f&&l<f}],"filter->":[It,[Ot,At],(c,[n,l])=>{const f=c.properties()[n.value],_=l.value;return typeof f==typeof _&&f>_}],"filter-id->":[It,[At],(c,[n])=>{const l=c.id(),f=n.value;return typeof l==typeof f&&l>f}],"filter-<=":[It,[Ot,At],(c,[n,l])=>{const f=c.properties()[n.value],_=l.value;return typeof f==typeof _&&f<=_}],"filter-id-<=":[It,[At],(c,[n])=>{const l=c.id(),f=n.value;return typeof l==typeof f&&l<=f}],"filter->=":[It,[Ot,At],(c,[n,l])=>{const f=c.properties()[n.value],_=l.value;return typeof f==typeof _&&f>=_}],"filter-id->=":[It,[At],(c,[n])=>{const l=c.id(),f=n.value;return typeof l==typeof f&&l>=f}],"filter-has":[It,[At],(c,[n])=>n.value in c.properties()],"filter-has-id":[It,[],c=>c.id()!==null&&c.id()!==void 0],"filter-type-in":[It,[Vi(Ot)],(c,[n])=>n.value.indexOf(c.geometryType())>=0],"filter-id-in":[It,[Vi(At)],(c,[n])=>n.value.indexOf(c.id())>=0],"filter-in-small":[It,[Ot,Vi(At)],(c,[n,l])=>l.value.indexOf(c.properties()[n.value])>=0],"filter-in-large":[It,[Ot,Vi(At)],(c,[n,l])=>function(f,_,b,v){for(;b<=v;){const T=b+v>>1;if(_[T]===f)return!0;_[T]>f?v=T-1:b=T+1}return!1}(c.properties()[n.value],l.value,0,l.value.length-1)],all:{type:It,overloads:[[[It,It],(c,[n,l])=>n.evaluate(c)&&l.evaluate(c)],[Do(It),(c,n)=>{for(const l of n)if(!l.evaluate(c))return!1;return!0}]]},any:{type:It,overloads:[[[It,It],(c,[n,l])=>n.evaluate(c)||l.evaluate(c)],[Do(It),(c,n)=>{for(const l of n)if(l.evaluate(c))return!0;return!1}]]},"!":[It,[It],(c,[n])=>!n.evaluate(c)],"is-supported-script":[It,[Ot],(c,[n])=>{const l=c.globals&&c.globals.isSupportedScript;return!l||l(n.evaluate(c))}],upcase:[Ot,[Ot],(c,[n])=>n.evaluate(c).toUpperCase()],downcase:[Ot,[Ot],(c,[n])=>n.evaluate(c).toLowerCase()],concat:[Ot,Do(At),(c,n)=>n.map(l=>Rt(l.evaluate(c))).join("")],"resolved-locale":[Ot,[hn],(c,[n])=>n.evaluate(c).resolvedLocale()]});class Uu{constructor(n,l){this.expression=n,this._warningHistory={},this._evaluator=new xu,this._defaultValue=l?function(f){if(f.type==="color"&&xl(f.default))return new yt(0,0,0,0);switch(f.type){case"color":return yt.parse(f.default)||null;case"padding":return cr.parse(f.default)||null;case"numberArray":return zr.parse(f.default)||null;case"colorArray":return qi.parse(f.default)||null;case"variableAnchorOffsetCollection":return Vr.parse(f.default)||null;case"projectionDefinition":return Rr.parse(f.default)||null;default:return f.default===void 0?null:f.default}}(l):null,this._enumValues=l&&l.type==="enum"?l.values:null}evaluateWithoutErrorHandling(n,l,f,_,b,v){return this._evaluator.globals=n,this._evaluator.feature=l,this._evaluator.featureState=f,this._evaluator.canonical=_,this._evaluator.availableImages=b||null,this._evaluator.formattedSection=v,this.expression.evaluate(this._evaluator)}evaluate(n,l,f,_,b,v){this._evaluator.globals=n,this._evaluator.feature=l||null,this._evaluator.featureState=f||null,this._evaluator.canonical=_,this._evaluator.availableImages=b||null,this._evaluator.formattedSection=v||null;try{const T=this.expression.evaluate(this._evaluator);if(T==null||typeof T=="number"&&T!=T)return this._defaultValue;if(this._enumValues&&!(T in this._enumValues))throw new ai(`Expected value to be one of ${Object.keys(this._enumValues).map(E=>JSON.stringify(E)).join(", ")}, but found ${JSON.stringify(T)} instead.`);return T}catch(T){return this._warningHistory[T.message]||(this._warningHistory[T.message]=!0,typeof console<"u"&&console.warn(T.message)),this._defaultValue}}}function Xc(c){return Array.isArray(c)&&c.length>0&&typeof c[0]=="string"&&c[0]in _a}function wl(c,n){const l=new da(_a,Gc,[],n?function(_){const b={color:Xi,string:Ot,number:rt,enum:Ot,boolean:It,formatted:ss,padding:to,numberArray:io,colorArray:ys,projectionDefinition:Os,resolvedImage:hi,variableAnchorOffsetCollection:xr};return _.type==="array"?Vi(b[_.value]||At,_.length):b[_.type]}(n):void 0),f=l.parse(c,void 0,void 0,void 0,n&&n.type==="string"?{typeAnnotation:"coerce"}:void 0);return f?Mp(new Uu(f,n)):ga(l.errors)}class Tl{constructor(n,l){this.kind=n,this._styleExpression=l,this.isStateDependent=n!=="constant"&&!vl(l.expression),this.globalStateRefs=Sl(l.expression)}evaluateWithoutErrorHandling(n,l,f,_,b,v){return this._styleExpression.evaluateWithoutErrorHandling(n,l,f,_,b,v)}evaluate(n,l,f,_,b,v){return this._styleExpression.evaluate(n,l,f,_,b,v)}}class zu{constructor(n,l,f,_){this.kind=n,this.zoomStops=f,this._styleExpression=l,this.isStateDependent=n!=="camera"&&!vl(l.expression),this.globalStateRefs=Sl(l.expression),this.interpolationType=_}evaluateWithoutErrorHandling(n,l,f,_,b,v){return this._styleExpression.evaluateWithoutErrorHandling(n,l,f,_,b,v)}evaluate(n,l,f,_,b,v){return this._styleExpression.evaluate(n,l,f,_,b,v)}interpolationFactor(n,l,f){return this.interpolationType?wr.interpolationFactor(this.interpolationType,n,l,f):0}}function Op(c,n){const l=wl(c,n);if(l.result==="error")return l;const f=l.value.expression,_=$c(f);if(!_&&!so(n))return ga([new bi("","data expressions not supported")]);const b=Wc(f,["zoom"]);if(!b&&!Rp(n))return ga([new bi("","zoom expressions not supported")]);const v=El(f);return v||b?v instanceof bi?ga([v]):v instanceof wr&&!Lu(n)?ga([new bi("",'"interpolate" expressions cannot be used with this property')]):Mp(v?new zu(_?"camera":"composite",l.value,v.labels,v instanceof wr?v.interpolation:void 0):new Tl(_?"constant":"source",l.value)):ga([new bi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Al{constructor(n,l){this._parameters=n,this._specification=l,Wi(this,Pp(this._parameters,this._specification))}static deserialize(n){return new Al(n._parameters,n._specification)}static serialize(n){return{_parameters:n._parameters,_specification:n._specification}}}function El(c){let n=null;if(c instanceof ll)n=El(c.result);else if(c instanceof dl){for(const l of c.args)if(n=El(l),n)break}else(c instanceof Di||c instanceof wr)&&c.input instanceof vs&&c.input.name==="zoom"&&(n=c);return n instanceof bi||c.eachChild(l=>{const f=El(l);f instanceof bi?n=f:!n&&f?n=new bi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):n&&f&&n!==f&&(n=new bi("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),n}function Sl(c,n=new Set){return c instanceof bl&&n.add(c.key),c.eachChild(l=>{Sl(l,n)}),n}function qc(c){if(c===!0||c===!1)return!0;if(!Array.isArray(c)||c.length===0)return!1;switch(c[0]){case"has":return c.length>=2&&c[1]!=="$id"&&c[1]!=="$type";case"in":return c.length>=3&&(typeof c[1]!="string"||Array.isArray(c[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return c.length!==3||Array.isArray(c[1])||Array.isArray(c[2]);case"any":case"all":for(const n of c.slice(1))if(!qc(n)&&typeof n!="boolean")return!1;return!0;default:return!0}}const Vu={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Oo(c){if(c==null)return{filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set};qc(c)||(c=Fo(c));const n=wl(c,Vu);if(n.result==="error")throw new Error(n.value.map(l=>`${l.key}: ${l.message}`).join(", "));return{filter:(l,f,_)=>n.value.evaluate(l,f,{},_),needGeometry:Zc(c),getGlobalStateRefs:()=>Sl(n.value.expression)}}function ju(c,n){return c<n?-1:c>n?1:0}function Zc(c){if(!Array.isArray(c))return!1;if(c[0]==="within"||c[0]==="distance")return!0;for(let n=1;n<c.length;n++)if(Zc(c[n]))return!0;return!1}function Fo(c){if(!c)return!0;const n=c[0];return c.length<=1?n!=="any":n==="=="?Hu(c[1],c[2],"=="):n==="!="?Kc(Hu(c[1],c[2],"==")):n==="<"||n===">"||n==="<="||n===">="?Hu(c[1],c[2],n):n==="any"?(l=c.slice(1),["any"].concat(l.map(Fo))):n==="all"?["all"].concat(c.slice(1).map(Fo)):n==="none"?["all"].concat(c.slice(1).map(Fo).map(Kc)):n==="in"?Fp(c[1],c.slice(2)):n==="!in"?Kc(Fp(c[1],c.slice(2))):n==="has"?kp(c[1]):n!=="!has"||Kc(kp(c[1]));var l}function Hu(c,n,l){switch(c){case"$type":return[`filter-type-${l}`,n];case"$id":return[`filter-id-${l}`,n];default:return[`filter-${l}`,c,n]}}function Fp(c,n){if(n.length===0)return!1;switch(c){case"$type":return["filter-type-in",["literal",n]];case"$id":return["filter-id-in",["literal",n]];default:return n.length>200&&!n.some(l=>typeof l!=typeof n[0])?["filter-in-large",c,["literal",n.sort(ju)]]:["filter-in-small",c,["literal",n]]}}function kp(c){switch(c){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",c]}}function Kc(c){return["!",c]}function Gu(c){const n=typeof c;if(n==="number"||n==="boolean"||n==="string"||c==null)return JSON.stringify(c);if(Array.isArray(c)){let _="[";for(const b of c)_+=`${Gu(b)},`;return`${_}]`}const l=Object.keys(c).sort();let f="{";for(let _=0;_<l.length;_++)f+=`${JSON.stringify(l[_])}:${Gu(c[l[_]])},`;return`${f}}`}function zy(c){let n="";for(const l of Tt)n+=`/${Gu(c[l])}`;return n}function $u(c){const n=c.value;return n?[new We(c.key,n,"constants have been deprecated as of v8")]:[]}function Ci(c){return c instanceof Number||c instanceof String||c instanceof Boolean?c.valueOf():c}function _n(c){if(Array.isArray(c))return c.map(_n);if(c instanceof Object&&!(c instanceof Number||c instanceof String||c instanceof Boolean)){const n={};for(const l in c)n[l]=_n(c[l]);return n}return Ci(c)}function xs(c){const n=c.key,l=c.value,f=c.valueSpec||{},_=c.objectElementValidators||{},b=c.style,v=c.styleSpec,T=c.validateSpec;let E=[];const I=Nt(l);if(I!=="object")return[new We(n,l,`object expected, ${I} found`)];for(const P in l){const O=P.split(".")[0],z=q(f,O)||f["*"];let j;if(q(_,O))j=_[O];else if(q(f,O))j=T;else if(_["*"])j=_["*"];else{if(!f["*"]){E.push(new We(n,l[P],`unknown property "${P}"`));continue}j=T}E=E.concat(j({key:(n&&`${n}.`)+P,value:l[P],valueSpec:z,style:b,styleSpec:v,object:l,objectKey:P,validateSpec:T},l))}for(const P in f)_[P]||f[P].required&&f[P].default===void 0&&l[P]===void 0&&E.push(new We(n,l,`missing required property "${P}"`));return E}function Yc(c){const n=c.value,l=c.valueSpec,f=c.style,_=c.styleSpec,b=c.key,v=c.arrayElementValidator||c.validateSpec;if(Nt(n)!=="array")return[new We(b,n,`array expected, ${Nt(n)} found`)];if(l.length&&n.length!==l.length)return[new We(b,n,`array length ${l.length} expected, length ${n.length} found`)];if(l["min-length"]&&n.length<l["min-length"])return[new We(b,n,`array length at least ${l["min-length"]} expected, length ${n.length} found`)];let T={type:l.value,values:l.values};_.$version<7&&(T.function=l.function),Nt(l.value)==="object"&&(T=l.value);let E=[];for(let I=0;I<n.length;I++)E=E.concat(v({array:n,arrayIndex:I,value:n[I],valueSpec:T,validateSpec:c.validateSpec,style:f,styleSpec:_,key:`${b}[${I}]`}));return E}function Cl(c){const n=c.key,l=c.value,f=c.valueSpec;let _=Nt(l);return _==="number"&&l!=l&&(_="NaN"),_!=="number"?[new We(n,l,`number expected, ${_} found`)]:"minimum"in f&&l<f.minimum?[new We(n,l,`${l} is less than the minimum value ${f.minimum}`)]:"maximum"in f&&l>f.maximum?[new We(n,l,`${l} is greater than the maximum value ${f.maximum}`)]:[]}function Np(c){const n=c.valueSpec,l=Ci(c.value.type);let f,_,b,v={};const T=l!=="categorical"&&c.value.property===void 0,E=!T,I=Nt(c.value.stops)==="array"&&Nt(c.value.stops[0])==="array"&&Nt(c.value.stops[0][0])==="object",P=xs({key:c.key,value:c.value,valueSpec:c.styleSpec.function,validateSpec:c.validateSpec,style:c.style,styleSpec:c.styleSpec,objectElementValidators:{stops:function(j){if(l==="identity")return[new We(j.key,j.value,'identity function may not have a "stops" property')];let H=[];const W=j.value;return H=H.concat(Yc({key:j.key,value:W,valueSpec:j.valueSpec,validateSpec:j.validateSpec,style:j.style,styleSpec:j.styleSpec,arrayElementValidator:O})),Nt(W)==="array"&&W.length===0&&H.push(new We(j.key,W,"array must have at least one stop")),H},default:function(j){return j.validateSpec({key:j.key,value:j.value,valueSpec:n,validateSpec:j.validateSpec,style:j.style,styleSpec:j.styleSpec})}}});return l==="identity"&&T&&P.push(new We(c.key,c.value,'missing required property "property"')),l==="identity"||c.value.stops||P.push(new We(c.key,c.value,'missing required property "stops"')),l==="exponential"&&c.valueSpec.expression&&!Lu(c.valueSpec)&&P.push(new We(c.key,c.value,"exponential functions not supported")),c.styleSpec.$version>=8&&(E&&!so(c.valueSpec)?P.push(new We(c.key,c.value,"property functions not supported")):T&&!Rp(c.valueSpec)&&P.push(new We(c.key,c.value,"zoom functions not supported"))),l!=="categorical"&&!I||c.value.property!==void 0||P.push(new We(c.key,c.value,'"property" property is required')),P;function O(j){let H=[];const W=j.value,K=j.key;if(Nt(W)!=="array")return[new We(K,W,`array expected, ${Nt(W)} found`)];if(W.length!==2)return[new We(K,W,`array length 2 expected, length ${W.length} found`)];if(I){if(Nt(W[0])!=="object")return[new We(K,W,`object expected, ${Nt(W[0])} found`)];if(W[0].zoom===void 0)return[new We(K,W,"object stop key must have zoom")];if(W[0].value===void 0)return[new We(K,W,"object stop key must have value")];if(b&&b>Ci(W[0].zoom))return[new We(K,W[0].zoom,"stop zoom values must appear in ascending order")];Ci(W[0].zoom)!==b&&(b=Ci(W[0].zoom),_=void 0,v={}),H=H.concat(xs({key:`${K}[0]`,value:W[0],valueSpec:{zoom:{}},validateSpec:j.validateSpec,style:j.style,styleSpec:j.styleSpec,objectElementValidators:{zoom:Cl,value:z}}))}else H=H.concat(z({key:`${K}[0]`,value:W[0],validateSpec:j.validateSpec,style:j.style,styleSpec:j.styleSpec},W));return Xc(_n(W[1]))?H.concat([new We(`${K}[1]`,W[1],"expressions are not allowed in function stops.")]):H.concat(j.validateSpec({key:`${K}[1]`,value:W[1],valueSpec:n,validateSpec:j.validateSpec,style:j.style,styleSpec:j.styleSpec}))}function z(j,H){const W=Nt(j.value),K=Ci(j.value),ie=j.value!==null?j.value:H;if(f){if(W!==f)return[new We(j.key,ie,`${W} stop domain type must match previous stop domain type ${f}`)]}else f=W;if(W!=="number"&&W!=="string"&&W!=="boolean")return[new We(j.key,ie,"stop domain value must be a number, string, or boolean")];if(W!=="number"&&l!=="categorical"){let me=`number expected, ${W} found`;return so(n)&&l===void 0&&(me+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new We(j.key,ie,me)]}return l!=="categorical"||W!=="number"||isFinite(K)&&Math.floor(K)===K?l!=="categorical"&&W==="number"&&_!==void 0&&K<_?[new We(j.key,ie,"stop domain values must appear in ascending order")]:(_=K,l==="categorical"&&K in v?[new We(j.key,ie,"stop domain values must be unique")]:(v[K]=!0,[])):[new We(j.key,ie,`integer expected, found ${K}`)]}}function ko(c){const n=(c.expressionContext==="property"?Op:wl)(_n(c.value),c.valueSpec);if(n.result==="error")return n.value.map(f=>new We(`${c.key}${f.key}`,c.value,f.message));const l=n.value.expression||n.value._styleExpression.expression;if(c.expressionContext==="property"&&c.propertyKey==="text-font"&&!l.outputDefined())return[new We(c.key,c.value,`Invalid data expression for "${c.propertyKey}". Output values must be contained as literals within the expression.`)];if(c.expressionContext==="property"&&c.propertyType==="layout"&&!vl(l))return[new We(c.key,c.value,'"feature-state" data expressions are not supported with layout properties.')];if(c.expressionContext==="filter"&&!vl(l))return[new We(c.key,c.value,'"feature-state" data expressions are not supported with filters.')];if(c.expressionContext&&c.expressionContext.indexOf("cluster")===0){if(!Wc(l,["zoom","feature-state"]))return[new We(c.key,c.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(c.expressionContext==="cluster-initial"&&!$c(l))return[new We(c.key,c.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Jc(c){const n=c.key,l=c.value,f=Nt(l);return f!=="string"?[new We(n,l,`color expected, ${f} found`)]:yt.parse(String(l))?[]:[new We(n,l,`color expected, "${l}" found`)]}function Dn(c){const n=c.key,l=c.value,f=c.valueSpec,_=[];return Array.isArray(f.values)?f.values.indexOf(Ci(l))===-1&&_.push(new We(n,l,`expected one of [${f.values.join(", ")}], ${JSON.stringify(l)} found`)):Object.keys(f.values).indexOf(Ci(l))===-1&&_.push(new We(n,l,`expected one of [${Object.keys(f.values).join(", ")}], ${JSON.stringify(l)} found`)),_}function Wu(c){return qc(_n(c.value))?ko(Wi({},c,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Lp(c)}function Lp(c){const n=c.value,l=c.key;if(Nt(n)!=="array")return[new We(l,n,`array expected, ${Nt(n)} found`)];const f=c.styleSpec;let _,b=[];if(n.length<1)return[new We(l,n,"filter array must have at least 1 element")];switch(b=b.concat(Dn({key:`${l}[0]`,value:n[0],valueSpec:f.filter_operator,style:c.style,styleSpec:c.styleSpec})),Ci(n[0])){case"<":case"<=":case">":case">=":n.length>=2&&Ci(n[1])==="$type"&&b.push(new We(l,n,`"$type" cannot be use with operator "${n[0]}"`));case"==":case"!=":n.length!==3&&b.push(new We(l,n,`filter array for operator "${n[0]}" must have 3 elements`));case"in":case"!in":n.length>=2&&(_=Nt(n[1]),_!=="string"&&b.push(new We(`${l}[1]`,n[1],`string expected, ${_} found`)));for(let v=2;v<n.length;v++)_=Nt(n[v]),Ci(n[1])==="$type"?b=b.concat(Dn({key:`${l}[${v}]`,value:n[v],valueSpec:f.geometry_type,style:c.style,styleSpec:c.styleSpec})):_!=="string"&&_!=="number"&&_!=="boolean"&&b.push(new We(`${l}[${v}]`,n[v],`string, number, or boolean expected, ${_} found`));break;case"any":case"all":case"none":for(let v=1;v<n.length;v++)b=b.concat(Lp({key:`${l}[${v}]`,value:n[v],style:c.style,styleSpec:c.styleSpec}));break;case"has":case"!has":_=Nt(n[1]),n.length!==2?b.push(new We(l,n,`filter array for "${n[0]}" operator must have 2 elements`)):_!=="string"&&b.push(new We(`${l}[1]`,n[1],`string expected, ${_} found`))}return b}function Up(c,n){const l=c.key,f=c.validateSpec,_=c.style,b=c.styleSpec,v=c.value,T=c.objectKey,E=b[`${n}_${c.layerType}`];if(!E)return[];const I=T.match(/^(.*)-transition$/);if(n==="paint"&&I&&E[I[1]]&&E[I[1]].transition)return f({key:l,value:v,valueSpec:b.transition,style:_,styleSpec:b});const P=c.valueSpec||E[T];if(!P)return[new We(l,v,`unknown property "${T}"`)];let O;if(Nt(v)==="string"&&so(P)&&!P.tokens&&(O=/^{([^}]+)}$/.exec(v)))return[new We(l,v,`"${T}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(O[1])} }\`.`)];const z=[];return c.layerType==="symbol"&&(T==="text-field"&&_&&!_.glyphs&&z.push(new We(l,v,'use of "text-field" requires a style "glyphs" property')),T==="text-font"&&xl(_n(v))&&Ci(v.type)==="identity"&&z.push(new We(l,v,'"text-font" does not support identity functions'))),z.concat(f({key:c.key,value:v,valueSpec:P,style:_,styleSpec:b,expressionContext:"property",propertyType:n,propertyKey:T}))}function zp(c){return Up(c,"paint")}function Vp(c){return Up(c,"layout")}function jp(c){let n=[];const l=c.value,f=c.key,_=c.style,b=c.styleSpec;if(Nt(l)!=="object")return[new We(f,l,`object expected, ${Nt(l)} found`)];l.type||l.ref||n.push(new We(f,l,'either "type" or "ref" is required'));let v=Ci(l.type);const T=Ci(l.ref);if(l.id){const E=Ci(l.id);for(let I=0;I<c.arrayIndex;I++){const P=_.layers[I];Ci(P.id)===E&&n.push(new We(f,l.id,`duplicate layer id "${l.id}", previously used at line ${P.id.__line__}`))}}if("ref"in l){let E;["type","source","source-layer","filter","layout"].forEach(I=>{I in l&&n.push(new We(f,l[I],`"${I}" is prohibited for ref layers`))}),_.layers.forEach(I=>{Ci(I.id)===T&&(E=I)}),E?E.ref?n.push(new We(f,l.ref,"ref cannot reference another ref layer")):v=Ci(E.type):n.push(new We(f,l.ref,`ref layer "${T}" not found`))}else if(v!=="background")if(l.source){const E=_.sources&&_.sources[l.source],I=E&&Ci(E.type);E?I==="vector"&&v==="raster"?n.push(new We(f,l.source,`layer "${l.id}" requires a raster source`)):I!=="raster-dem"&&v==="hillshade"||I!=="raster-dem"&&v==="color-relief"?n.push(new We(f,l.source,`layer "${l.id}" requires a raster-dem source`)):I==="raster"&&v!=="raster"?n.push(new We(f,l.source,`layer "${l.id}" requires a vector source`)):I!=="vector"||l["source-layer"]?I==="raster-dem"&&v!=="hillshade"&&v!=="color-relief"?n.push(new We(f,l.source,"raster-dem source can only be used with layer type 'hillshade' or 'color-relief'.")):v!=="line"||!l.paint||!l.paint["line-gradient"]||I==="geojson"&&E.lineMetrics||n.push(new We(f,l,`layer "${l.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):n.push(new We(f,l,`layer "${l.id}" must specify a "source-layer"`)):n.push(new We(f,l.source,`source "${l.source}" not found`))}else n.push(new We(f,l,'missing required property "source"'));return n=n.concat(xs({key:f,value:l,valueSpec:b.layer,style:c.style,styleSpec:c.styleSpec,validateSpec:c.validateSpec,objectElementValidators:{"*":()=>[],type:()=>c.validateSpec({key:`${f}.type`,value:l.type,valueSpec:b.layer.type,style:c.style,styleSpec:c.styleSpec,validateSpec:c.validateSpec,object:l,objectKey:"type"}),filter:Wu,layout:E=>xs({layer:l,key:E.key,value:E.value,style:E.style,styleSpec:E.styleSpec,validateSpec:E.validateSpec,objectElementValidators:{"*":I=>Vp(Wi({layerType:v},I))}}),paint:E=>xs({layer:l,key:E.key,value:E.value,style:E.style,styleSpec:E.styleSpec,validateSpec:E.validateSpec,objectElementValidators:{"*":I=>zp(Wi({layerType:v},I))}})}})),n}function zs(c){const n=c.value,l=c.key,f=Nt(n);return f!=="string"?[new We(l,n,`string expected, ${f} found`)]:[]}const ma={promoteId:function({key:c,value:n}){if(Nt(n)==="string")return zs({key:c,value:n});{const l=[];for(const f in n)l.push(...zs({key:`${c}.${f}`,value:n[f]}));return l}}};function Jr(c){const n=c.value,l=c.key,f=c.styleSpec,_=c.style,b=c.validateSpec;if(!n.type)return[new We(l,n,'"type" is required')];const v=Ci(n.type);let T;switch(v){case"vector":case"raster":return T=xs({key:l,value:n,valueSpec:f[`source_${v.replace("-","_")}`],style:c.style,styleSpec:f,objectElementValidators:ma,validateSpec:b}),T;case"raster-dem":return T=function(E){var I;const P=(I=E.sourceName)!==null&&I!==void 0?I:"",O=E.value,z=E.styleSpec,j=z.source_raster_dem,H=E.style;let W=[];const K=Nt(O);if(O===void 0)return W;if(K!=="object")return W.push(new We("source_raster_dem",O,`object expected, ${K} found`)),W;const ie=Ci(O.encoding)==="custom",me=["redFactor","greenFactor","blueFactor","baseShift"],he=E.value.encoding?`"${E.value.encoding}"`:"Default";for(const fe in O)!ie&&me.includes(fe)?W.push(new We(fe,O[fe],`In "${P}": "${fe}" is only valid when "encoding" is set to "custom". ${he} encoding found`)):j[fe]?W=W.concat(E.validateSpec({key:fe,value:O[fe],valueSpec:j[fe],validateSpec:E.validateSpec,style:H,styleSpec:z})):W.push(new We(fe,O[fe],`unknown property "${fe}"`));return W}({sourceName:l,value:n,style:c.style,styleSpec:f,validateSpec:b}),T;case"geojson":if(T=xs({key:l,value:n,valueSpec:f.source_geojson,style:_,styleSpec:f,validateSpec:b,objectElementValidators:ma}),n.cluster)for(const E in n.clusterProperties){const[I,P]=n.clusterProperties[E],O=typeof I=="string"?[I,["accumulated"],["get",E]]:I;T.push(...ko({key:`${l}.${E}.map`,value:P,expressionContext:"cluster-map"})),T.push(...ko({key:`${l}.${E}.reduce`,value:O,expressionContext:"cluster-reduce"}))}return T;case"video":return xs({key:l,value:n,valueSpec:f.source_video,style:_,validateSpec:b,styleSpec:f});case"image":return xs({key:l,value:n,valueSpec:f.source_image,style:_,validateSpec:b,styleSpec:f});case"canvas":return[new We(l,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Dn({key:`${l}.type`,value:n.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function ya(c){const n=c.value,l=c.styleSpec,f=l.light,_=c.style;let b=[];const v=Nt(n);if(n===void 0)return b;if(v!=="object")return b=b.concat([new We("light",n,`object expected, ${v} found`)]),b;for(const T in n){const E=T.match(/^(.*)-transition$/);b=b.concat(E&&f[E[1]]&&f[E[1]].transition?c.validateSpec({key:T,value:n[T],valueSpec:l.transition,validateSpec:c.validateSpec,style:_,styleSpec:l}):f[T]?c.validateSpec({key:T,value:n[T],valueSpec:f[T],validateSpec:c.validateSpec,style:_,styleSpec:l}):[new We(T,n[T],`unknown property "${T}"`)])}return b}function Xu(c){const n=c.value,l=c.styleSpec,f=l.sky,_=c.style,b=Nt(n);if(n===void 0)return[];if(b!=="object")return[new We("sky",n,`object expected, ${b} found`)];let v=[];for(const T in n)v=v.concat(f[T]?c.validateSpec({key:T,value:n[T],valueSpec:f[T],style:_,styleSpec:l}):[new We(T,n[T],`unknown property "${T}"`)]);return v}function Hp(c){const n=c.value,l=c.styleSpec,f=l.terrain,_=c.style;let b=[];const v=Nt(n);if(n===void 0)return b;if(v!=="object")return b=b.concat([new We("terrain",n,`object expected, ${v} found`)]),b;for(const T in n)b=b.concat(f[T]?c.validateSpec({key:T,value:n[T],valueSpec:f[T],validateSpec:c.validateSpec,style:_,styleSpec:l}):[new We(T,n[T],`unknown property "${T}"`)]);return b}function Gp(c){let n=[];const l=c.value,f=c.key;if(Array.isArray(l)){const _=[],b=[];for(const v in l)l[v].id&&_.includes(l[v].id)&&n.push(new We(f,l,`all the sprites' ids must be unique, but ${l[v].id} is duplicated`)),_.push(l[v].id),l[v].url&&b.includes(l[v].url)&&n.push(new We(f,l,`all the sprites' URLs must be unique, but ${l[v].url} is duplicated`)),b.push(l[v].url),n=n.concat(xs({key:`${f}[${v}]`,value:l[v],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:c.validateSpec}));return n}return zs({key:f,value:l})}function ba(c){return n=c.value,n&&n.constructor===Object?[]:[new We(c.key,c.value,`object expected, ${Nt(c.value)} found`)];var n}const qu={"*":()=>[],array:Yc,boolean:function(c){const n=c.value,l=c.key,f=Nt(n);return f!=="boolean"?[new We(l,n,`boolean expected, ${f} found`)]:[]},number:Cl,color:Jc,constants:$u,enum:Dn,filter:Wu,function:Np,layer:jp,object:xs,source:Jr,light:ya,sky:Xu,terrain:Hp,projection:function(c){const n=c.value,l=c.styleSpec,f=l.projection,_=c.style,b=Nt(n);if(n===void 0)return[];if(b!=="object")return[new We("projection",n,`object expected, ${b} found`)];let v=[];for(const T in n)v=v.concat(f[T]?c.validateSpec({key:T,value:n[T],valueSpec:f[T],style:_,styleSpec:l}):[new We(T,n[T],`unknown property "${T}"`)]);return v},projectionDefinition:function(c){const n=c.key;let l=c.value;l=l instanceof String?l.valueOf():l;const f=Nt(l);return f!=="array"||function(_){return Array.isArray(_)&&_.length===3&&typeof _[0]=="string"&&typeof _[1]=="string"&&typeof _[2]=="number"}(l)||function(_){return!!["interpolate","step","literal"].includes(_[0])}(l)?["array","string"].includes(f)?[]:[new We(n,l,`projection expected, invalid type "${f}" found`)]:[new We(n,l,`projection expected, invalid array ${JSON.stringify(l)} found`)]},string:zs,formatted:function(c){return zs(c).length===0?[]:ko(c)},resolvedImage:function(c){return zs(c).length===0?[]:ko(c)},padding:function(c){const n=c.key,l=c.value;if(Nt(l)==="array"){if(l.length<1||l.length>4)return[new We(n,l,`padding requires 1 to 4 values; ${l.length} values found`)];const f={type:"number"};let _=[];for(let b=0;b<l.length;b++)_=_.concat(c.validateSpec({key:`${n}[${b}]`,value:l[b],validateSpec:c.validateSpec,valueSpec:f}));return _}return Cl({key:n,value:l,valueSpec:{}})},numberArray:function(c){const n=c.key,l=c.value;if(Nt(l)==="array"){const f={type:"number"};if(l.length<1)return[new We(n,l,"array length at least 1 expected, length 0 found")];let _=[];for(let b=0;b<l.length;b++)_=_.concat(c.validateSpec({key:`${n}[${b}]`,value:l[b],validateSpec:c.validateSpec,valueSpec:f}));return _}return Cl({key:n,value:l,valueSpec:{}})},colorArray:function(c){const n=c.key,l=c.value;if(Nt(l)==="array"){if(l.length<1)return[new We(n,l,"array length at least 1 expected, length 0 found")];let f=[];for(let _=0;_<l.length;_++)f=f.concat(Jc({key:`${n}[${_}]`,value:l[_]}));return f}return Jc({key:n,value:l})},variableAnchorOffsetCollection:function(c){const n=c.key,l=c.value,f=Nt(l),_=c.styleSpec;if(f!=="array"||l.length<1||l.length%2!=0)return[new We(n,l,"variableAnchorOffsetCollection requires a non-empty array of even length")];let b=[];for(let v=0;v<l.length;v+=2)b=b.concat(Dn({key:`${n}[${v}]`,value:l[v],valueSpec:_.layout_symbol["text-anchor"]})),b=b.concat(Yc({key:`${n}[${v+1}]`,value:l[v+1],valueSpec:{length:2,value:"number"},validateSpec:c.validateSpec,style:c.style,styleSpec:_}));return b},sprite:Gp,state:ba};function va(c){const n=c.value,l=c.valueSpec,f=c.styleSpec;return c.validateSpec=va,l.expression&&xl(Ci(n))?Np(c):l.expression&&Xc(_n(n))?ko(c):l.type&&qu[l.type]?qu[l.type](c):xs(Wi({},c,{valueSpec:l.type?f[l.type]:l}))}function $p(c){const n=c.value,l=c.key,f=zs(c);return f.length||(n.indexOf("{fontstack}")===-1&&f.push(new We(l,n,'"glyphs" url must include a "{fontstack}" token')),n.indexOf("{range}")===-1&&f.push(new We(l,n,'"glyphs" url must include a "{range}" token'))),f}function Qr(c,n=we){let l=[];return l=l.concat(va({key:"",value:c,valueSpec:n.$root,styleSpec:n,style:c,validateSpec:va,objectElementValidators:{glyphs:$p,"*":()=>[]}})),c.constants&&(l=l.concat($u({key:"constants",value:c.constants}))),xa(l)}function Vs(c){return function(n){return c({...n,validateSpec:va})}}function xa(c){return[].concat(c).sort((n,l)=>n.line-l.line)}function js(c){return function(...n){return xa(c.apply(this,n))}}Qr.source=js(Vs(Jr)),Qr.sprite=js(Vs(Gp)),Qr.glyphs=js(Vs($p)),Qr.light=js(Vs(ya)),Qr.sky=js(Vs(Xu)),Qr.terrain=js(Vs(Hp)),Qr.state=js(Vs(ba)),Qr.layer=js(Vs(jp)),Qr.filter=js(Vs(Wu)),Qr.paintProperty=js(Vs(zp)),Qr.layoutProperty=js(Vs(Vp));const wa=Qr,Vy=wa.light,Il=wa.sky,jy=wa.paintProperty,Hy=wa.layoutProperty;function Ml(c,n){let l=!1;if(n&&n.length)for(const f of n)c.fire(new Ve(new Error(f.message))),l=!0;return l}class Rl{constructor(n,l,f){const _=this.cells=[];if(n instanceof ArrayBuffer){this.arrayBuffer=n;const v=new Int32Array(this.arrayBuffer);n=v[0],this.d=(l=v[1])+2*(f=v[2]);for(let E=0;E<this.d*this.d;E++){const I=v[3+E],P=v[3+E+1];_.push(I===P?null:v.subarray(I,P))}const T=v[3+_.length+1];this.keys=v.subarray(v[3+_.length],T),this.bboxes=v.subarray(T),this.insert=this._insertReadonly}else{this.d=l+2*f;for(let v=0;v<this.d*this.d;v++)_.push([]);this.keys=[],this.bboxes=[]}this.n=l,this.extent=n,this.padding=f,this.scale=l/n,this.uid=0;const b=f/l*n;this.min=-b,this.max=n+b}insert(n,l,f,_,b){this._forEachCell(l,f,_,b,this._insertCell,this.uid++,void 0,void 0),this.keys.push(n),this.bboxes.push(l),this.bboxes.push(f),this.bboxes.push(_),this.bboxes.push(b)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(n,l,f,_,b,v){this.cells[b].push(v)}query(n,l,f,_,b){const v=this.min,T=this.max;if(n<=v&&l<=v&&T<=f&&T<=_&&!b)return Array.prototype.slice.call(this.keys);{const E=[];return this._forEachCell(n,l,f,_,this._queryCell,E,{},b),E}}_queryCell(n,l,f,_,b,v,T,E){const I=this.cells[b];if(I!==null){const P=this.keys,O=this.bboxes;for(let z=0;z<I.length;z++){const j=I[z];if(T[j]===void 0){const H=4*j;(E?E(O[H+0],O[H+1],O[H+2],O[H+3]):n<=O[H+2]&&l<=O[H+3]&&f>=O[H+0]&&_>=O[H+1])?(T[j]=!0,v.push(P[j])):T[j]=!1}}}}_forEachCell(n,l,f,_,b,v,T,E){const I=this._convertToCellCoord(n),P=this._convertToCellCoord(l),O=this._convertToCellCoord(f),z=this._convertToCellCoord(_);for(let j=I;j<=O;j++)for(let H=P;H<=z;H++){const W=this.d*H+j;if((!E||E(this._convertFromCellCoord(j),this._convertFromCellCoord(H),this._convertFromCellCoord(j+1),this._convertFromCellCoord(H+1)))&&b.call(this,n,l,f,_,W,v,T,E))return}}_convertFromCellCoord(n){return(n-this.padding)/this.scale}_convertToCellCoord(n){return Math.max(0,Math.min(this.d-1,Math.floor(n*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const n=this.cells,l=3+this.cells.length+1+1;let f=0;for(let v=0;v<this.cells.length;v++)f+=this.cells[v].length;const _=new Int32Array(l+f+this.keys.length+this.bboxes.length);_[0]=this.extent,_[1]=this.n,_[2]=this.padding;let b=l;for(let v=0;v<n.length;v++){const T=n[v];_[3+v]=b,_.set(T,b),b+=T.length}return _[3+n.length]=b,_.set(this.keys,b),b+=this.keys.length,_[3+n.length+1]=b,_.set(this.bboxes,b),b+=this.bboxes.length,_.buffer}static serialize(n,l){const f=n.toArrayBuffer();return l&&l.push(f),{buffer:f}}static deserialize(n){return new Rl(n.buffer)}}const Hs={};function ot(c,n,l={}){if(Hs[c])throw new Error(`${c} is already registered.`);Object.defineProperty(n,"_classRegistryKey",{value:c,writeable:!1}),Hs[c]={klass:n,omit:l.omit||[],shallow:l.shallow||[]}}ot("Object",Object),ot("Set",Set),ot("TransferableGridIndex",Rl),ot("Color",yt),ot("Error",Error),ot("AJAXError",oe),ot("ResolvedImage",ns),ot("StylePropertyFunction",Al),ot("StyleExpression",Uu,{omit:["_evaluator"]}),ot("ZoomDependentExpression",zu),ot("ZoomConstantExpression",Tl),ot("CompoundExpression",vs,{omit:["_evaluate"]});for(const c in _a)_a[c]._classRegistryKey||ot(`Expression_${c}`,_a[c]);function Zu(c){return c&&typeof ArrayBuffer<"u"&&(c instanceof ArrayBuffer||c.constructor&&c.constructor.name==="ArrayBuffer")}function Qc(c){return c.$name||c.constructor._classRegistryKey}function Ku(c){return!function(n){if(n===null||typeof n!="object")return!1;const l=Qc(n);return!(!l||l==="Object")}(c)&&(c==null||typeof c=="boolean"||typeof c=="number"||typeof c=="string"||c instanceof Boolean||c instanceof Number||c instanceof String||c instanceof Date||c instanceof RegExp||c instanceof Blob||c instanceof Error||Zu(c)||is(c)||ArrayBuffer.isView(c)||c instanceof ImageData)}function Ta(c,n){if(Ku(c))return(Zu(c)||is(c))&&n&&n.push(c),ArrayBuffer.isView(c)&&n&&n.push(c.buffer),c instanceof ImageData&&n&&n.push(c.data.buffer),c;if(Array.isArray(c)){const b=[];for(const v of c)b.push(Ta(v,n));return b}if(typeof c!="object")throw new Error("can't serialize object of type "+typeof c);const l=Qc(c);if(!l)throw new Error(`can't serialize object of unregistered class ${c.constructor.name}`);if(!Hs[l])throw new Error(`${l} is not registered.`);const{klass:f}=Hs[l],_=f.serialize?f.serialize(c,n):{};if(f.serialize){if(n&&_===n[n.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const b in c){if(!c.hasOwnProperty(b)||Hs[l].omit.indexOf(b)>=0)continue;const v=c[b];_[b]=Hs[l].shallow.indexOf(b)>=0?v:Ta(v,n)}c instanceof Error&&(_.message=c.message)}if(_.$name)throw new Error("$name property is reserved for worker serialization logic.");return l!=="Object"&&(_.$name=l),_}function No(c){if(Ku(c))return c;if(Array.isArray(c))return c.map(No);if(typeof c!="object")throw new Error("can't deserialize object of type "+typeof c);const n=Qc(c)||"Object";if(!Hs[n])throw new Error(`can't deserialize unregistered class ${n}`);const{klass:l}=Hs[n];if(!l)throw new Error(`can't deserialize unregistered class ${n}`);if(l.deserialize)return l.deserialize(c);const f=Object.create(l.prototype);for(const _ of Object.keys(c)){if(_==="$name")continue;const b=c[_];f[_]=Hs[n].shallow.indexOf(_)>=0?b:No(b)}return f}class eh{constructor(){this.first=!0}update(n,l){const f=Math.floor(n);return this.first?(this.first=!1,this.lastIntegerZoom=f,this.lastIntegerZoomTime=0,this.lastZoom=n,this.lastFloorZoom=f,!0):(this.lastFloorZoom>f?(this.lastIntegerZoom=f+1,this.lastIntegerZoomTime=l):this.lastFloorZoom<f&&(this.lastIntegerZoom=f,this.lastIntegerZoomTime=l),n!==this.lastZoom&&(this.lastZoom=n,this.lastFloorZoom=f,!0))}}const Ut={"Latin-1 Supplement":c=>c>=128&&c<=255,"Hangul Jamo":c=>c>=4352&&c<=4607,Khmer:c=>c>=6016&&c<=6143,"General Punctuation":c=>c>=8192&&c<=8303,"Letterlike Symbols":c=>c>=8448&&c<=8527,"Number Forms":c=>c>=8528&&c<=8591,"Miscellaneous Technical":c=>c>=8960&&c<=9215,"Control Pictures":c=>c>=9216&&c<=9279,"Optical Character Recognition":c=>c>=9280&&c<=9311,"Enclosed Alphanumerics":c=>c>=9312&&c<=9471,"Geometric Shapes":c=>c>=9632&&c<=9727,"Miscellaneous Symbols":c=>c>=9728&&c<=9983,"Miscellaneous Symbols and Arrows":c=>c>=11008&&c<=11263,"Ideographic Description Characters":c=>c>=12272&&c<=12287,"CJK Symbols and Punctuation":c=>c>=12288&&c<=12351,Hiragana:c=>c>=12352&&c<=12447,Katakana:c=>c>=12448&&c<=12543,Kanbun:c=>c>=12688&&c<=12703,"CJK Strokes":c=>c>=12736&&c<=12783,"Enclosed CJK Letters and Months":c=>c>=12800&&c<=13055,"CJK Compatibility":c=>c>=13056&&c<=13311,"Yijing Hexagram Symbols":c=>c>=19904&&c<=19967,"CJK Unified Ideographs":c=>c>=19968&&c<=40959,"Hangul Syllables":c=>c>=44032&&c<=55215,"Private Use Area":c=>c>=57344&&c<=63743,"Vertical Forms":c=>c>=65040&&c<=65055,"CJK Compatibility Forms":c=>c>=65072&&c<=65103,"Small Form Variants":c=>c>=65104&&c<=65135,"Halfwidth and Fullwidth Forms":c=>c>=65280&&c<=65519};function th(c){for(const n of c)if(Ju(n.charCodeAt(0)))return!0;return!1}function Gy(c){for(const n of c)if(!Wp(n.charCodeAt(0)))return!1;return!0}function ih(c){const n=c.map(l=>{try{return new RegExp(`\\p{sc=${l}}`,"u").source}catch{return null}}).filter(l=>l);return new RegExp(n.join("|"),"u")}const $y=ih(["Arab","Dupl","Mong","Ougr","Syrc"]);function Wp(c){return!$y.test(String.fromCodePoint(c))}const Yu=ih(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function Ju(c){return!(c!==746&&c!==747&&(c<4352||!(Ut["CJK Compatibility Forms"](c)&&!(c>=65097&&c<=65103)||Ut["CJK Compatibility"](c)||Ut["CJK Strokes"](c)||!(!Ut["CJK Symbols and Punctuation"](c)||c>=12296&&c<=12305||c>=12308&&c<=12319||c===12336)||Ut["Enclosed CJK Letters and Months"](c)||Ut["Ideographic Description Characters"](c)||Ut.Kanbun(c)||Ut.Katakana(c)&&c!==12540||!(!Ut["Halfwidth and Fullwidth Forms"](c)||c===65288||c===65289||c===65293||c>=65306&&c<=65310||c===65339||c===65341||c===65343||c>=65371&&c<=65503||c===65507||c>=65512&&c<=65519)||!(!Ut["Small Form Variants"](c)||c>=65112&&c<=65118||c>=65123&&c<=65126)||Ut["Vertical Forms"](c)||Ut["Yijing Hexagram Symbols"](c)||new RegExp("\\p{sc=Cans}","u").test(String.fromCodePoint(c))||new RegExp("\\p{sc=Hang}","u").test(String.fromCodePoint(c))||Yu.test(String.fromCodePoint(c)))))}function Xp(c){return!(Ju(c)||function(n){return!!(Ut["Latin-1 Supplement"](n)&&(n===167||n===169||n===174||n===177||n===188||n===189||n===190||n===215||n===247)||Ut["General Punctuation"](n)&&(n===8214||n===8224||n===8225||n===8240||n===8241||n===8251||n===8252||n===8258||n===8263||n===8264||n===8265||n===8273)||Ut["Letterlike Symbols"](n)||Ut["Number Forms"](n)||Ut["Miscellaneous Technical"](n)&&(n>=8960&&n<=8967||n>=8972&&n<=8991||n>=8996&&n<=9e3||n===9003||n>=9085&&n<=9114||n>=9150&&n<=9165||n===9167||n>=9169&&n<=9179||n>=9186&&n<=9215)||Ut["Control Pictures"](n)&&n!==9251||Ut["Optical Character Recognition"](n)||Ut["Enclosed Alphanumerics"](n)||Ut["Geometric Shapes"](n)||Ut["Miscellaneous Symbols"](n)&&!(n>=9754&&n<=9759)||Ut["Miscellaneous Symbols and Arrows"](n)&&(n>=11026&&n<=11055||n>=11088&&n<=11097||n>=11192&&n<=11243)||Ut["CJK Symbols and Punctuation"](n)||Ut.Katakana(n)||Ut["Private Use Area"](n)||Ut["CJK Compatibility Forms"](n)||Ut["Small Form Variants"](n)||Ut["Halfwidth and Fullwidth Forms"](n)||n===8734||n===8756||n===8757||n>=9984&&n<=10087||n>=10102&&n<=10131||n===65532||n===65533)}(c))}const qp=ih(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function Qu(c){return qp.test(String.fromCodePoint(c))}function Zp(c,n){return!(!n&&Qu(c)||c>=2304&&c<=3583||c>=3840&&c<=4255||Ut.Khmer(c))}function Kp(c){for(const n of c)if(Qu(n.charCodeAt(0)))return!0;return!1}const Gs=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(c){this.pluginStatus=c.pluginStatus,this.pluginURL=c.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(c){if(Gs.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=c.applyArabicShaping,this.processBidirectionalText=c.processBidirectionalText,this.processStyledBidirectionalText=c.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getRTLTextPluginStatus(){return this.pluginStatus}syncState(c,n){return a(this,void 0,void 0,function*(){if(this.isParsed())return this.getState();if(c.pluginStatus!=="loading")return this.setState(c),c;const l=c.pluginURL,f=new Promise(b=>{this.loadScriptResolve=b});n(l);const _=new Promise(b=>setTimeout(()=>b(),this.TIMEOUT));if(yield Promise.race([f,_]),this.isParsed()){const b={pluginStatus:"loaded",pluginURL:l};return this.setState(b),b}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${l}`)})}};class vi{constructor(n,l){this.zoom=n,l?(this.now=l.now||0,this.fadeDuration=l.fadeDuration||0,this.zoomHistory=l.zoomHistory||new eh,this.transition=l.transition||{},this.globalState=l.globalState||{}):(this.now=0,this.fadeDuration=0,this.zoomHistory=new eh,this.transition={},this.globalState={})}isSupportedScript(n){return function(l,f){for(const _ of l)if(!Zp(_.charCodeAt(0),f))return!1;return!0}(n,Gs.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const n=this.zoom,l=n-Math.floor(n),f=this.crossFadingFactor();return n>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:l+(1-l)*f}:{fromScale:.5,toScale:1,t:1-(1-f)*l}}}class Aa{constructor(n,l){this.property=n,this.value=l,this.expression=function(f,_){if(xl(f))return new Al(f,_);if(Xc(f)){const b=Op(f,_);if(b.result==="error")throw new Error(b.value.map(v=>`${v.key}: ${v.message}`).join(", "));return b.value}{let b=f;return _.type==="color"&&typeof f=="string"?b=yt.parse(f):_.type!=="padding"||typeof f!="number"&&!Array.isArray(f)?_.type!=="numberArray"||typeof f!="number"&&!Array.isArray(f)?_.type!=="colorArray"||typeof f!="string"&&!Array.isArray(f)?_.type==="variableAnchorOffsetCollection"&&Array.isArray(f)?b=Vr.parse(f):_.type==="projectionDefinition"&&typeof f=="string"&&(b=Rr.parse(f)):b=qi.parse(f):b=zr.parse(f):b=cr.parse(f),{globalStateRefs:new Set,kind:"constant",evaluate:()=>b}}}(l===void 0?n.specification.default:l,n.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}getGlobalStateRefs(){return this.expression.globalStateRefs||new Set}possiblyEvaluate(n,l,f){return this.property.possiblyEvaluate(this,n,l,f)}}class ed{constructor(n){this.property=n,this.value=new Aa(n,void 0)}transitioned(n,l){return new td(this.property,this.value,l,$i({},n.transition,this.transition),n.now)}untransitioned(){return new td(this.property,this.value,null,{},0)}}class Yp{constructor(n){this._properties=n,this._values=Object.create(n.defaultTransitionablePropertyValues)}getValue(n){return Qi(this._values[n].value.value)}setValue(n,l){Object.prototype.hasOwnProperty.call(this._values,n)||(this._values[n]=new ed(this._values[n].property)),this._values[n].value=new Aa(this._values[n].property,l===null?void 0:Qi(l))}getTransition(n){return Qi(this._values[n].transition)}setTransition(n,l){Object.prototype.hasOwnProperty.call(this._values,n)||(this._values[n]=new ed(this._values[n].property)),this._values[n].transition=Qi(l)||void 0}serialize(){const n={};for(const l of Object.keys(this._values)){const f=this.getValue(l);f!==void 0&&(n[l]=f);const _=this.getTransition(l);_!==void 0&&(n[`${l}-transition`]=_)}return n}transitioned(n,l){const f=new id(this._properties);for(const _ of Object.keys(this._values))f._values[_]=this._values[_].transitioned(n,l._values[_]);return f}untransitioned(){const n=new id(this._properties);for(const l of Object.keys(this._values))n._values[l]=this._values[l].untransitioned();return n}}class td{constructor(n,l,f,_,b){this.property=n,this.value=l,this.begin=b+_.delay||0,this.end=this.begin+_.duration||0,n.specification.transition&&(_.delay||_.duration)&&(this.prior=f)}possiblyEvaluate(n,l,f){const _=n.now||0,b=this.value.possiblyEvaluate(n,l,f),v=this.prior;if(v){if(_>this.end)return this.prior=null,b;if(this.value.isDataDriven())return this.prior=null,b;if(_<this.begin)return v.possiblyEvaluate(n,l,f);{const T=(_-this.begin)/(this.end-this.begin);return this.property.interpolate(v.possiblyEvaluate(n,l,f),b,gs(T))}}return b}}class id{constructor(n){this._properties=n,this._values=Object.create(n.defaultTransitioningPropertyValues)}possiblyEvaluate(n,l,f){const _=new rh(this._properties);for(const b of Object.keys(this._values))_._values[b]=this._values[b].possiblyEvaluate(n,l,f);return _}hasTransition(){for(const n of Object.keys(this._values))if(this._values[n].prior)return!0;return!1}}class Jp{constructor(n){this._properties=n,this._values=Object.create(n.defaultPropertyValues)}hasValue(n){return this._values[n].value!==void 0}getValue(n){return Qi(this._values[n].value)}setValue(n,l){this._values[n]=new Aa(this._values[n].property,l===null?void 0:Qi(l))}serialize(){const n={};for(const l of Object.keys(this._values)){const f=this.getValue(l);f!==void 0&&(n[l]=f)}return n}possiblyEvaluate(n,l,f){const _=new rh(this._properties);for(const b of Object.keys(this._values))_._values[b]=this._values[b].possiblyEvaluate(n,l,f);return _}}class gn{constructor(n,l,f){this.property=n,this.value=l,this.parameters=f}isConstant(){return this.value.kind==="constant"}constantOr(n){return this.value.kind==="constant"?this.value.value:n}evaluate(n,l,f,_){return this.property.evaluate(this.value,this.parameters,n,l,f,_)}}class rh{constructor(n){this._properties=n,this._values=Object.create(n.defaultPossiblyEvaluatedValues)}get(n){return this._values[n]}}class ft{constructor(n){this.specification=n}possiblyEvaluate(n,l){if(n.isDataDriven())throw new Error("Value should not be data driven");return n.expression.evaluate(l)}interpolate(n,l,f){const _=pn[this.specification.type];return _?_(n,l,f):n}}class vt{constructor(n,l){this.specification=n,this.overrides=l}possiblyEvaluate(n,l,f,_){return new gn(this,n.expression.kind==="constant"||n.expression.kind==="camera"?{kind:"constant",value:n.expression.evaluate(l,null,{},f,_)}:n.expression,l)}interpolate(n,l,f){if(n.value.kind!=="constant"||l.value.kind!=="constant")return n;if(n.value.value===void 0||l.value.value===void 0)return new gn(this,{kind:"constant",value:void 0},n.parameters);const _=pn[this.specification.type];if(_){const b=_(n.value.value,l.value.value,f);return new gn(this,{kind:"constant",value:b},n.parameters)}return n}evaluate(n,l,f,_,b,v){return n.kind==="constant"?n.value:n.evaluate(l,f,_,b,v)}}class sh extends vt{possiblyEvaluate(n,l,f,_){if(n.value===void 0)return new gn(this,{kind:"constant",value:void 0},l);if(n.expression.kind==="constant"){const b=n.expression.evaluate(l,null,{},f,_),v=n.property.specification.type==="resolvedImage"&&typeof b!="string"?b.name:b,T=this._calculate(v,v,v,l);return new gn(this,{kind:"constant",value:T},l)}if(n.expression.kind==="camera"){const b=this._calculate(n.expression.evaluate({zoom:l.zoom-1}),n.expression.evaluate({zoom:l.zoom}),n.expression.evaluate({zoom:l.zoom+1}),l);return new gn(this,{kind:"constant",value:b},l)}return new gn(this,n.expression,l)}evaluate(n,l,f,_,b,v){if(n.kind==="source"){const T=n.evaluate(l,f,_,b,v);return this._calculate(T,T,T,l)}return n.kind==="composite"?this._calculate(n.evaluate({zoom:Math.floor(l.zoom)-1},f,_),n.evaluate({zoom:Math.floor(l.zoom)},f,_),n.evaluate({zoom:Math.floor(l.zoom)+1},f,_),l):n.value}_calculate(n,l,f,_){return _.zoom>_.zoomHistory.lastIntegerZoom?{from:n,to:l}:{from:f,to:l}}interpolate(n){return n}}class oo{constructor(n){this.specification=n}possiblyEvaluate(n,l,f,_){if(n.value!==void 0){if(n.expression.kind==="constant"){const b=n.expression.evaluate(l,null,{},f,_);return this._calculate(b,b,b,l)}return this._calculate(n.expression.evaluate(new vi(Math.floor(l.zoom-1),l)),n.expression.evaluate(new vi(Math.floor(l.zoom),l)),n.expression.evaluate(new vi(Math.floor(l.zoom+1),l)),l)}}_calculate(n,l,f,_){return _.zoom>_.zoomHistory.lastIntegerZoom?{from:n,to:l}:{from:f,to:l}}interpolate(n){return n}}class nh{constructor(n){this.specification=n}possiblyEvaluate(n,l,f,_){return!!n.expression.evaluate(l,null,{},f,_)}interpolate(){return!1}}class jr{constructor(n){this.properties=n,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const l in n){const f=n[l];f.specification.overridable&&this.overridableProperties.push(l);const _=this.defaultPropertyValues[l]=new Aa(f,void 0),b=this.defaultTransitionablePropertyValues[l]=new ed(f);this.defaultTransitioningPropertyValues[l]=b.untransitioned(),this.defaultPossiblyEvaluatedValues[l]=_.possiblyEvaluate({})}}}ot("DataDrivenProperty",vt),ot("DataConstantProperty",ft),ot("CrossFadedDataDrivenProperty",sh),ot("CrossFadedProperty",oo),ot("ColorRampProperty",nh);const Qp="-transition";class ws extends ct{constructor(n,l){if(super(),this.id=n.id,this.type=n.type,this._featureFilter={filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set},n.type!=="custom"&&(this.metadata=n.metadata,this.minzoom=n.minzoom,this.maxzoom=n.maxzoom,n.type!=="background"&&(this.source=n.source,this.sourceLayer=n["source-layer"],this.filter=n.filter,this._featureFilter=Oo(n.filter)),l.layout&&(this._unevaluatedLayout=new Jp(l.layout)),l.paint)){this._transitionablePaint=new Yp(l.paint);for(const f in n.paint)this.setPaintProperty(f,n.paint[f],{validate:!1});for(const f in n.layout)this.setLayoutProperty(f,n.layout[f],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new rh(l.paint)}}setFilter(n){this.filter=n,this._featureFilter=Oo(n)}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(n){return n==="visibility"?this.visibility:this._unevaluatedLayout.getValue(n)}getLayoutAffectingGlobalStateRefs(){const n=new Set;if(this._unevaluatedLayout)for(const l in this._unevaluatedLayout._values){const f=this._unevaluatedLayout._values[l];for(const _ of f.getGlobalStateRefs())n.add(_)}for(const l of this._featureFilter.getGlobalStateRefs())n.add(l);return n}setLayoutProperty(n,l,f={}){l!=null&&this._validate(Hy,`layers.${this.id}.layout.${n}`,n,l,f)||(n!=="visibility"?this._unevaluatedLayout.setValue(n,l):this.visibility=l)}getPaintProperty(n){return n.endsWith(Qp)?this._transitionablePaint.getTransition(n.slice(0,-11)):this._transitionablePaint.getValue(n)}setPaintProperty(n,l,f={}){if(l!=null&&this._validate(jy,`layers.${this.id}.paint.${n}`,n,l,f))return!1;if(n.endsWith(Qp))return this._transitionablePaint.setTransition(n.slice(0,-11),l||void 0),!1;{const _=this._transitionablePaint._values[n],b=_.property.specification["property-type"]==="cross-faded-data-driven",v=_.value.isDataDriven(),T=_.value;this._transitionablePaint.setValue(n,l),this._handleSpecialPaintPropertyUpdate(n);const E=this._transitionablePaint._values[n].value;return E.isDataDriven()||v||b||this._handleOverridablePaintPropertyUpdate(n,T,E)}}_handleSpecialPaintPropertyUpdate(n){}_handleOverridablePaintPropertyUpdate(n,l,f){return!1}isHidden(n){return!!(this.minzoom&&n<this.minzoom)||!!(this.maxzoom&&n>=this.maxzoom)||this.visibility==="none"}updateTransitions(n){this._transitioningPaint=this._transitionablePaint.transitioned(n,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(n,l){n.getCrossfadeParameters&&(this._crossfadeParameters=n.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(n,void 0,l)),this.paint=this._transitioningPaint.possiblyEvaluate(n,void 0,l)}serialize(){const n={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(n.layout=n.layout||{},n.layout.visibility=this.visibility),Rs(n,(l,f)=>!(l===void 0||f==="layout"&&!Object.keys(l).length||f==="paint"&&!Object.keys(l).length))}_validate(n,l,f,_,b={}){return(!b||b.validate!==!1)&&Ml(this,n.call(wa,{key:l,layerType:this.type,objectKey:f,value:_,styleSpec:we,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const n in this.paint._values){const l=this.paint.get(n);if(l instanceof gn&&so(l.property.specification)&&(l.value.kind==="source"||l.value.kind==="composite")&&l.value.isStateDependent)return!0}return!1}}const Wy={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Pl{constructor(n,l){this._structArray=n,this._pos1=l*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class ri{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(n,l){return n._trim(),l&&(n.isTransferred=!0,l.push(n.arrayBuffer)),{length:n.length,arrayBuffer:n.arrayBuffer}}static deserialize(n){const l=Object.create(this.prototype);return l.arrayBuffer=n.arrayBuffer,l.length=n.length,l.capacity=n.arrayBuffer.byteLength/l.bytesPerElement,l._refreshViews(),l}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(n){this.reserve(n),this.length=n}reserve(n){if(n>this.capacity){this.capacity=Math.max(n,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const l=this.uint8;this._refreshViews(),l&&this.uint8.set(l)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Oi(c,n=1){let l=0,f=0;return{members:c.map(_=>{const b=Wy[_.type].BYTES_PER_ELEMENT,v=l=oh(l,Math.max(n,b)),T=_.components||1;return f=Math.max(f,b),l+=b*T,{name:_.name,type:_.type,components:T,offset:v}}),size:oh(l,Math.max(f,n)),alignment:n}}function oh(c,n){return Math.ceil(c/n)*n}class Ea extends ri{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,l){const f=this.length;return this.resize(f+1),this.emplace(f,n,l)}emplace(n,l,f){const _=2*n;return this.int16[_+0]=l,this.int16[_+1]=f,n}}Ea.prototype.bytesPerElement=4,ot("StructArrayLayout2i4",Ea);class Sa extends ri{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,l,f){const _=this.length;return this.resize(_+1),this.emplace(_,n,l,f)}emplace(n,l,f,_){const b=3*n;return this.int16[b+0]=l,this.int16[b+1]=f,this.int16[b+2]=_,n}}Sa.prototype.bytesPerElement=6,ot("StructArrayLayout3i6",Sa);class rd extends ri{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,l,f,_){const b=this.length;return this.resize(b+1),this.emplace(b,n,l,f,_)}emplace(n,l,f,_,b){const v=4*n;return this.int16[v+0]=l,this.int16[v+1]=f,this.int16[v+2]=_,this.int16[v+3]=b,n}}rd.prototype.bytesPerElement=8,ot("StructArrayLayout4i8",rd);class Ca extends ri{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,l,f,_,b,v){const T=this.length;return this.resize(T+1),this.emplace(T,n,l,f,_,b,v)}emplace(n,l,f,_,b,v,T){const E=6*n;return this.int16[E+0]=l,this.int16[E+1]=f,this.int16[E+2]=_,this.int16[E+3]=b,this.int16[E+4]=v,this.int16[E+5]=T,n}}Ca.prototype.bytesPerElement=12,ot("StructArrayLayout2i4i12",Ca);class Lo extends ri{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,l,f,_,b,v){const T=this.length;return this.resize(T+1),this.emplace(T,n,l,f,_,b,v)}emplace(n,l,f,_,b,v,T){const E=4*n,I=8*n;return this.int16[E+0]=l,this.int16[E+1]=f,this.uint8[I+4]=_,this.uint8[I+5]=b,this.uint8[I+6]=v,this.uint8[I+7]=T,n}}Lo.prototype.bytesPerElement=8,ot("StructArrayLayout2i4ub8",Lo);class Bl extends ri{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,l){const f=this.length;return this.resize(f+1),this.emplace(f,n,l)}emplace(n,l,f){const _=2*n;return this.float32[_+0]=l,this.float32[_+1]=f,n}}Bl.prototype.bytesPerElement=8,ot("StructArrayLayout2f8",Bl);class ah extends ri{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,l,f,_,b,v,T,E,I,P){const O=this.length;return this.resize(O+1),this.emplace(O,n,l,f,_,b,v,T,E,I,P)}emplace(n,l,f,_,b,v,T,E,I,P,O){const z=10*n;return this.uint16[z+0]=l,this.uint16[z+1]=f,this.uint16[z+2]=_,this.uint16[z+3]=b,this.uint16[z+4]=v,this.uint16[z+5]=T,this.uint16[z+6]=E,this.uint16[z+7]=I,this.uint16[z+8]=P,this.uint16[z+9]=O,n}}ah.prototype.bytesPerElement=20,ot("StructArrayLayout10ui20",ah);class Uo extends ri{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,l,f,_,b,v,T,E,I,P,O,z){const j=this.length;return this.resize(j+1),this.emplace(j,n,l,f,_,b,v,T,E,I,P,O,z)}emplace(n,l,f,_,b,v,T,E,I,P,O,z,j){const H=12*n;return this.int16[H+0]=l,this.int16[H+1]=f,this.int16[H+2]=_,this.int16[H+3]=b,this.uint16[H+4]=v,this.uint16[H+5]=T,this.uint16[H+6]=E,this.uint16[H+7]=I,this.int16[H+8]=P,this.int16[H+9]=O,this.int16[H+10]=z,this.int16[H+11]=j,n}}Uo.prototype.bytesPerElement=24,ot("StructArrayLayout4i4ui4i24",Uo);class sd extends ri{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,l,f){const _=this.length;return this.resize(_+1),this.emplace(_,n,l,f)}emplace(n,l,f,_){const b=3*n;return this.float32[b+0]=l,this.float32[b+1]=f,this.float32[b+2]=_,n}}sd.prototype.bytesPerElement=12,ot("StructArrayLayout3f12",sd);class nd extends ri{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(n){const l=this.length;return this.resize(l+1),this.emplace(l,n)}emplace(n,l){return this.uint32[1*n+0]=l,n}}nd.prototype.bytesPerElement=4,ot("StructArrayLayout1ul4",nd);class lh extends ri{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,l,f,_,b,v,T,E,I){const P=this.length;return this.resize(P+1),this.emplace(P,n,l,f,_,b,v,T,E,I)}emplace(n,l,f,_,b,v,T,E,I,P){const O=10*n,z=5*n;return this.int16[O+0]=l,this.int16[O+1]=f,this.int16[O+2]=_,this.int16[O+3]=b,this.int16[O+4]=v,this.int16[O+5]=T,this.uint32[z+3]=E,this.uint16[O+8]=I,this.uint16[O+9]=P,n}}lh.prototype.bytesPerElement=20,ot("StructArrayLayout6i1ul2ui20",lh);class od extends ri{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,l,f,_,b,v){const T=this.length;return this.resize(T+1),this.emplace(T,n,l,f,_,b,v)}emplace(n,l,f,_,b,v,T){const E=6*n;return this.int16[E+0]=l,this.int16[E+1]=f,this.int16[E+2]=_,this.int16[E+3]=b,this.int16[E+4]=v,this.int16[E+5]=T,n}}od.prototype.bytesPerElement=12,ot("StructArrayLayout2i2i2i12",od);class m extends ri{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,l,f,_,b){const v=this.length;return this.resize(v+1),this.emplace(v,n,l,f,_,b)}emplace(n,l,f,_,b,v){const T=4*n,E=8*n;return this.float32[T+0]=l,this.float32[T+1]=f,this.float32[T+2]=_,this.int16[E+6]=b,this.int16[E+7]=v,n}}m.prototype.bytesPerElement=16,ot("StructArrayLayout2f1f2i16",m);class s extends ri{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,l,f,_,b,v){const T=this.length;return this.resize(T+1),this.emplace(T,n,l,f,_,b,v)}emplace(n,l,f,_,b,v,T){const E=16*n,I=4*n,P=8*n;return this.uint8[E+0]=l,this.uint8[E+1]=f,this.float32[I+1]=_,this.float32[I+2]=b,this.int16[P+6]=v,this.int16[P+7]=T,n}}s.prototype.bytesPerElement=16,ot("StructArrayLayout2ub2f2i16",s);class h extends ri{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,l,f){const _=this.length;return this.resize(_+1),this.emplace(_,n,l,f)}emplace(n,l,f,_){const b=3*n;return this.uint16[b+0]=l,this.uint16[b+1]=f,this.uint16[b+2]=_,n}}h.prototype.bytesPerElement=6,ot("StructArrayLayout3ui6",h);class p extends ri{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,l,f,_,b,v,T,E,I,P,O,z,j,H,W,K,ie){const me=this.length;return this.resize(me+1),this.emplace(me,n,l,f,_,b,v,T,E,I,P,O,z,j,H,W,K,ie)}emplace(n,l,f,_,b,v,T,E,I,P,O,z,j,H,W,K,ie,me){const he=24*n,fe=12*n,Be=48*n;return this.int16[he+0]=l,this.int16[he+1]=f,this.uint16[he+2]=_,this.uint16[he+3]=b,this.uint32[fe+2]=v,this.uint32[fe+3]=T,this.uint32[fe+4]=E,this.uint16[he+10]=I,this.uint16[he+11]=P,this.uint16[he+12]=O,this.float32[fe+7]=z,this.float32[fe+8]=j,this.uint8[Be+36]=H,this.uint8[Be+37]=W,this.uint8[Be+38]=K,this.uint32[fe+10]=ie,this.int16[he+22]=me,n}}p.prototype.bytesPerElement=48,ot("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",p);class g extends ri{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,l,f,_,b,v,T,E,I,P,O,z,j,H,W,K,ie,me,he,fe,Be,Ne,He,st,Ke,et,_t,Qe){const tt=this.length;return this.resize(tt+1),this.emplace(tt,n,l,f,_,b,v,T,E,I,P,O,z,j,H,W,K,ie,me,he,fe,Be,Ne,He,st,Ke,et,_t,Qe)}emplace(n,l,f,_,b,v,T,E,I,P,O,z,j,H,W,K,ie,me,he,fe,Be,Ne,He,st,Ke,et,_t,Qe,tt){const ze=32*n,wt=16*n;return this.int16[ze+0]=l,this.int16[ze+1]=f,this.int16[ze+2]=_,this.int16[ze+3]=b,this.int16[ze+4]=v,this.int16[ze+5]=T,this.int16[ze+6]=E,this.int16[ze+7]=I,this.uint16[ze+8]=P,this.uint16[ze+9]=O,this.uint16[ze+10]=z,this.uint16[ze+11]=j,this.uint16[ze+12]=H,this.uint16[ze+13]=W,this.uint16[ze+14]=K,this.uint16[ze+15]=ie,this.uint16[ze+16]=me,this.uint16[ze+17]=he,this.uint16[ze+18]=fe,this.uint16[ze+19]=Be,this.uint16[ze+20]=Ne,this.uint16[ze+21]=He,this.uint16[ze+22]=st,this.uint32[wt+12]=Ke,this.float32[wt+13]=et,this.float32[wt+14]=_t,this.uint16[ze+30]=Qe,this.uint16[ze+31]=tt,n}}g.prototype.bytesPerElement=64,ot("StructArrayLayout8i15ui1ul2f2ui64",g);class y extends ri{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n){const l=this.length;return this.resize(l+1),this.emplace(l,n)}emplace(n,l){return this.float32[1*n+0]=l,n}}y.prototype.bytesPerElement=4,ot("StructArrayLayout1f4",y);class w extends ri{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,l,f){const _=this.length;return this.resize(_+1),this.emplace(_,n,l,f)}emplace(n,l,f,_){const b=3*n;return this.uint16[6*n+0]=l,this.float32[b+1]=f,this.float32[b+2]=_,n}}w.prototype.bytesPerElement=12,ot("StructArrayLayout1ui2f12",w);class S extends ri{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,l,f){const _=this.length;return this.resize(_+1),this.emplace(_,n,l,f)}emplace(n,l,f,_){const b=4*n;return this.uint32[2*n+0]=l,this.uint16[b+2]=f,this.uint16[b+3]=_,n}}S.prototype.bytesPerElement=8,ot("StructArrayLayout1ul2ui8",S);class C extends ri{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,l){const f=this.length;return this.resize(f+1),this.emplace(f,n,l)}emplace(n,l,f){const _=2*n;return this.uint16[_+0]=l,this.uint16[_+1]=f,n}}C.prototype.bytesPerElement=4,ot("StructArrayLayout2ui4",C);class R extends ri{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n){const l=this.length;return this.resize(l+1),this.emplace(l,n)}emplace(n,l){return this.uint16[1*n+0]=l,n}}R.prototype.bytesPerElement=2,ot("StructArrayLayout1ui2",R);class B extends ri{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,l,f,_){const b=this.length;return this.resize(b+1),this.emplace(b,n,l,f,_)}emplace(n,l,f,_,b){const v=4*n;return this.float32[v+0]=l,this.float32[v+1]=f,this.float32[v+2]=_,this.float32[v+3]=b,n}}B.prototype.bytesPerElement=16,ot("StructArrayLayout4f16",B);class k extends Pl{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new x(this.anchorPointX,this.anchorPointY)}}k.prototype.size=20;class F extends lh{get(n){return new k(this,n)}}ot("CollisionBoxArray",F);class V extends Pl{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(n){this._structArray.uint8[this._pos1+37]=n}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(n){this._structArray.uint8[this._pos1+38]=n}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(n){this._structArray.uint32[this._pos4+10]=n}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}V.prototype.size=48;class G extends p{get(n){return new V(this,n)}}ot("PlacedSymbolArray",G);class J extends Pl{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(n){this._structArray.uint32[this._pos4+12]=n}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}J.prototype.size=64;class Y extends g{get(n){return new J(this,n)}}ot("SymbolInstanceArray",Y);class Q extends y{getoffsetX(n){return this.float32[1*n+0]}}ot("GlyphOffsetArray",Q);class se extends Sa{getx(n){return this.int16[3*n+0]}gety(n){return this.int16[3*n+1]}gettileUnitDistanceFromAnchor(n){return this.int16[3*n+2]}}ot("SymbolLineVertexArray",se);class ce extends Pl{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}ce.prototype.size=12;class ae extends w{get(n){return new ce(this,n)}}ot("TextAnchorOffsetArray",ae);class ue extends Pl{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}ue.prototype.size=8;class _e extends S{get(n){return new ue(this,n)}}ot("FeatureIndexArray",_e);class le extends Ea{}class ve extends Ea{}class ke extends Ea{}class Me extends Ca{}class Pe extends Lo{}class Fe extends Bl{}class Ze extends ah{}class Ye extends Uo{}class je extends sd{}class ut extends nd{}class Dt extends od{}class qt extends s{}class si extends h{}class ei extends C{}const wi=Oi([{name:"a_pos",components:2,type:"Int16"}],4),{members:Ii}=wi;class Pt{constructor(n=[]){this._forceNewSegmentOnNextPrepare=!1,this.segments=n}prepareSegment(n,l,f,_){const b=this.segments[this.segments.length-1];return n>Pt.MAX_VERTEX_ARRAY_LENGTH&&ci(`Max vertices per segment is ${Pt.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${n}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${Pt.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!b||b.vertexLength+n>Pt.MAX_VERTEX_ARRAY_LENGTH||b.sortKey!==_?this.createNewSegment(l,f,_):b}createNewSegment(n,l,f){const _={vertexOffset:n.length,primitiveOffset:l.length,vertexLength:0,primitiveLength:0,vaos:{}};return f!==void 0&&(_.sortKey=f),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(_),_}getOrCreateLatestSegment(n,l,f){return this.prepareSegment(0,n,l,f)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(const n of this.segments)for(const l in n.vaos)n.vaos[l].destroy()}static simpleSegment(n,l,f,_){return new Pt([{vertexOffset:n,primitiveOffset:l,vertexLength:f,primitiveLength:_,vaos:{},sortKey:0}])}}function ni(c,n){return 256*(c=Ir(Math.floor(c),0,255))+Ir(Math.floor(n),0,255)}Pt.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,ot("SegmentVector",Pt);const Zi=Oi([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var er,ur,Hr,$s={exports:{}},ao={exports:{}},lo={exports:{}},Ia=function(){if(Hr)return $s.exports;Hr=1;var c=(er||(er=1,ao.exports=function(l,f){var _,b,v,T,E,I,P,O;for(b=l.length-(_=3&l.length),v=f,E=3432918353,I=461845907,O=0;O<b;)P=255&l.charCodeAt(O)|(255&l.charCodeAt(++O))<<8|(255&l.charCodeAt(++O))<<16|(255&l.charCodeAt(++O))<<24,++O,v=27492+(65535&(T=5*(65535&(v=(v^=P=(65535&(P=(P=(65535&P)*E+(((P>>>16)*E&65535)<<16)&4294967295)<<15|P>>>17))*I+(((P>>>16)*I&65535)<<16)&4294967295)<<13|v>>>19))+((5*(v>>>16)&65535)<<16)&4294967295))+((58964+(T>>>16)&65535)<<16);switch(P=0,_){case 3:P^=(255&l.charCodeAt(O+2))<<16;case 2:P^=(255&l.charCodeAt(O+1))<<8;case 1:v^=P=(65535&(P=(P=(65535&(P^=255&l.charCodeAt(O)))*E+(((P>>>16)*E&65535)<<16)&4294967295)<<15|P>>>17))*I+(((P>>>16)*I&65535)<<16)&4294967295}return v^=l.length,v=2246822507*(65535&(v^=v>>>16))+((2246822507*(v>>>16)&65535)<<16)&4294967295,v=3266489909*(65535&(v^=v>>>13))+((3266489909*(v>>>16)&65535)<<16)&4294967295,(v^=v>>>16)>>>0}),ao.exports),n=(ur||(ur=1,lo.exports=function(l,f){for(var _,b=l.length,v=f^b,T=0;b>=4;)_=1540483477*(65535&(_=255&l.charCodeAt(T)|(255&l.charCodeAt(++T))<<8|(255&l.charCodeAt(++T))<<16|(255&l.charCodeAt(++T))<<24))+((1540483477*(_>>>16)&65535)<<16),v=1540483477*(65535&v)+((1540483477*(v>>>16)&65535)<<16)^(_=1540483477*(65535&(_^=_>>>24))+((1540483477*(_>>>16)&65535)<<16)),b-=4,++T;switch(b){case 3:v^=(255&l.charCodeAt(T+2))<<16;case 2:v^=(255&l.charCodeAt(T+1))<<8;case 1:v=1540483477*(65535&(v^=255&l.charCodeAt(T)))+((1540483477*(v>>>16)&65535)<<16)}return v=1540483477*(65535&(v^=v>>>13))+((1540483477*(v>>>16)&65535)<<16),(v^=v>>>15)>>>0}),lo.exports);return $s.exports=c,$s.exports.murmur3=c,$s.exports.murmur2=n,$s.exports}(),Ma=A(Ia);class zo{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(n,l,f,_){this.ids.push(Vo(n)),this.positions.push(l,f,_)}getPositions(n){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const l=Vo(n);let f=0,_=this.ids.length-1;for(;f<_;){const v=f+_>>1;this.ids[v]>=l?_=v:f=v+1}const b=[];for(;this.ids[f]===l;)b.push({index:this.positions[3*f],start:this.positions[3*f+1],end:this.positions[3*f+2]}),f++;return b}static serialize(n,l){const f=new Float64Array(n.ids),_=new Uint32Array(n.positions);return es(f,_,0,f.length-1),l&&l.push(f.buffer,_.buffer),{ids:f,positions:_}}static deserialize(n){const l=new zo;return l.ids=n.ids,l.positions=n.positions,l.indexed=!0,l}}function Vo(c){const n=+c;return!isNaN(n)&&n<=Number.MAX_SAFE_INTEGER?n:Ma(String(c))}function es(c,n,l,f){for(;l<f;){const _=c[l+f>>1];let b=l-1,v=f+1;for(;;){do b++;while(c[b]<_);do v--;while(c[v]>_);if(b>=v)break;Ws(c,b,v),Ws(n,3*b,3*v),Ws(n,3*b+1,3*v+1),Ws(n,3*b+2,3*v+2)}v-l<f-v?(es(c,n,l,v),l=v+1):(es(c,n,v+1,f),f=v)}}function Ws(c,n,l){const f=c[n];c[n]=c[l],c[l]=f}ot("FeaturePositionMap",zo);class Gr{constructor(n,l){this.gl=n.gl,this.location=l}}class co extends Gr{constructor(n,l){super(n,l),this.current=0}set(n){this.current!==n&&(this.current=n,this.gl.uniform1f(this.location,n))}}class Ki extends Gr{constructor(n,l){super(n,l),this.current=[0,0,0,0]}set(n){n[0]===this.current[0]&&n[1]===this.current[1]&&n[2]===this.current[2]&&n[3]===this.current[3]||(this.current=n,this.gl.uniform4f(this.location,n[0],n[1],n[2],n[3]))}}class tr extends Gr{constructor(n,l){super(n,l),this.current=yt.transparent}set(n){n.r===this.current.r&&n.g===this.current.g&&n.b===this.current.b&&n.a===this.current.a||(this.current=n,this.gl.uniform4f(this.location,n.r,n.g,n.b,n.a))}}const Ts=new Float32Array(16);function Yi(c){return[ni(255*c.r,255*c.g),ni(255*c.b,255*c.a)]}class Dl{constructor(n,l,f){this.value=n,this.uniformNames=l.map(_=>`u_${_}`),this.type=f}setUniform(n,l,f){n.set(f.constantOr(this.value))}getBinding(n,l,f){return this.type==="color"?new tr(n,l):new co(n,l)}}class Ra{constructor(n,l){this.uniformNames=l.map(f=>`u_${f}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(n,l){this.pixelRatioFrom=l.pixelRatio,this.pixelRatioTo=n.pixelRatio,this.patternFrom=l.tlbr,this.patternTo=n.tlbr}setUniform(n,l,f,_){const b=_==="u_pattern_to"?this.patternTo:_==="u_pattern_from"?this.patternFrom:_==="u_pixel_ratio_to"?this.pixelRatioTo:_==="u_pixel_ratio_from"?this.pixelRatioFrom:null;b&&n.set(b)}getBinding(n,l,f){return f.substr(0,9)==="u_pattern"?new Ki(n,l):new co(n,l)}}class On{constructor(n,l,f,_){this.expression=n,this.type=f,this.maxValue=0,this.paintVertexAttributes=l.map(b=>({name:`a_${b}`,type:"Float32",components:f==="color"?2:1,offset:0})),this.paintVertexArray=new _}populatePaintArray(n,l,f,_,b){const v=this.paintVertexArray.length,T=this.expression.evaluate(new vi(0),l,{},_,[],b);this.paintVertexArray.resize(n),this._setPaintValue(v,n,T)}updatePaintArray(n,l,f,_){const b=this.expression.evaluate({zoom:0},f,_);this._setPaintValue(n,l,b)}_setPaintValue(n,l,f){if(this.type==="color"){const _=Yi(f);for(let b=n;b<l;b++)this.paintVertexArray.emplace(b,_[0],_[1])}else{for(let _=n;_<l;_++)this.paintVertexArray.emplace(_,f);this.maxValue=Math.max(this.maxValue,Math.abs(f))}}upload(n){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=n.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Xs{constructor(n,l,f,_,b,v){this.expression=n,this.uniformNames=l.map(T=>`u_${T}_t`),this.type=f,this.useIntegerZoom=_,this.zoom=b,this.maxValue=0,this.paintVertexAttributes=l.map(T=>({name:`a_${T}`,type:"Float32",components:f==="color"?4:2,offset:0})),this.paintVertexArray=new v}populatePaintArray(n,l,f,_,b){const v=this.expression.evaluate(new vi(this.zoom),l,{},_,[],b),T=this.expression.evaluate(new vi(this.zoom+1),l,{},_,[],b),E=this.paintVertexArray.length;this.paintVertexArray.resize(n),this._setPaintValue(E,n,v,T)}updatePaintArray(n,l,f,_){const b=this.expression.evaluate({zoom:this.zoom},f,_),v=this.expression.evaluate({zoom:this.zoom+1},f,_);this._setPaintValue(n,l,b,v)}_setPaintValue(n,l,f,_){if(this.type==="color"){const b=Yi(f),v=Yi(_);for(let T=n;T<l;T++)this.paintVertexArray.emplace(T,b[0],b[1],v[0],v[1])}else{for(let b=n;b<l;b++)this.paintVertexArray.emplace(b,f,_);this.maxValue=Math.max(this.maxValue,Math.abs(f),Math.abs(_))}}upload(n){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=n.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(n,l){const f=this.useIntegerZoom?Math.floor(l.zoom):l.zoom,_=Ir(this.expression.interpolationFactor(f,this.zoom,this.zoom+1),0,1);n.set(_)}getBinding(n,l,f){return new co(n,l)}}class ho{constructor(n,l,f,_,b,v){this.expression=n,this.type=l,this.useIntegerZoom=f,this.zoom=_,this.layerId=v,this.zoomInPaintVertexArray=new b,this.zoomOutPaintVertexArray=new b}populatePaintArray(n,l,f){const _=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(n),this.zoomOutPaintVertexArray.resize(n),this._setPaintValues(_,n,l.patterns&&l.patterns[this.layerId],f)}updatePaintArray(n,l,f,_,b){this._setPaintValues(n,l,f.patterns&&f.patterns[this.layerId],b)}_setPaintValues(n,l,f,_){if(!_||!f)return;const{min:b,mid:v,max:T}=f,E=_[b],I=_[v],P=_[T];if(E&&I&&P)for(let O=n;O<l;O++)this.zoomInPaintVertexArray.emplace(O,I.tl[0],I.tl[1],I.br[0],I.br[1],E.tl[0],E.tl[1],E.br[0],E.br[1],I.pixelRatio,E.pixelRatio),this.zoomOutPaintVertexArray.emplace(O,I.tl[0],I.tl[1],I.br[0],I.br[1],P.tl[0],P.tl[1],P.br[0],P.br[1],I.pixelRatio,P.pixelRatio)}upload(n){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=n.createVertexBuffer(this.zoomInPaintVertexArray,Zi.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=n.createVertexBuffer(this.zoomOutPaintVertexArray,Zi.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class e_{constructor(n,l,f){this.binders={},this._buffers=[];const _=[];for(const b in n.paint._values){if(!f(b))continue;const v=n.paint.get(b);if(!(v instanceof gn&&so(v.property.specification)))continue;const T=t_(b,n.type),E=v.value,I=v.property.specification.type,P=v.property.useIntegerZoom,O=v.property.specification["property-type"],z=O==="cross-faded"||O==="cross-faded-data-driven";if(E.kind==="constant")this.binders[b]=z?new Ra(E.value,T):new Dl(E.value,T,I),_.push(`/u_${b}`);else if(E.kind==="source"||z){const j=ad(b,I,"source");this.binders[b]=z?new ho(E,I,P,l,j,n.id):new On(E,T,I,j),_.push(`/a_${b}`)}else{const j=ad(b,I,"composite");this.binders[b]=new Xs(E,T,I,P,l,j),_.push(`/z_${b}`)}}this.cacheKey=_.sort().join("")}getMaxValue(n){const l=this.binders[n];return l instanceof On||l instanceof Xs?l.maxValue:0}populatePaintArrays(n,l,f,_,b){for(const v in this.binders){const T=this.binders[v];(T instanceof On||T instanceof Xs||T instanceof ho)&&T.populatePaintArray(n,l,f,_,b)}}setConstantPatternPositions(n,l){for(const f in this.binders){const _=this.binders[f];_ instanceof Ra&&_.setConstantPatternPositions(n,l)}}updatePaintArrays(n,l,f,_,b){let v=!1;for(const T in n){const E=l.getPositions(T);for(const I of E){const P=f.feature(I.index);for(const O in this.binders){const z=this.binders[O];if((z instanceof On||z instanceof Xs||z instanceof ho)&&z.expression.isStateDependent===!0){const j=_.paint.get(O);z.expression=j.value,z.updatePaintArray(I.start,I.end,P,n[T],b),v=!0}}}}return v}defines(){const n=[];for(const l in this.binders){const f=this.binders[l];(f instanceof Dl||f instanceof Ra)&&n.push(...f.uniformNames.map(_=>`#define HAS_UNIFORM_${_}`))}return n}getBinderAttributes(){const n=[];for(const l in this.binders){const f=this.binders[l];if(f instanceof On||f instanceof Xs)for(let _=0;_<f.paintVertexAttributes.length;_++)n.push(f.paintVertexAttributes[_].name);else if(f instanceof ho)for(let _=0;_<Zi.members.length;_++)n.push(Zi.members[_].name)}return n}getBinderUniforms(){const n=[];for(const l in this.binders){const f=this.binders[l];if(f instanceof Dl||f instanceof Ra||f instanceof Xs)for(const _ of f.uniformNames)n.push(_)}return n}getPaintVertexBuffers(){return this._buffers}getUniforms(n,l){const f=[];for(const _ in this.binders){const b=this.binders[_];if(b instanceof Dl||b instanceof Ra||b instanceof Xs){for(const v of b.uniformNames)if(l[v]){const T=b.getBinding(n,l[v],v);f.push({name:v,property:_,binding:T})}}}return f}setUniforms(n,l,f,_){for(const{name:b,property:v,binding:T}of l)this.binders[v].setUniform(T,_,f.get(v),b)}updatePaintBuffers(n){this._buffers=[];for(const l in this.binders){const f=this.binders[l];if(n&&f instanceof ho){const _=n.fromScale===2?f.zoomInPaintVertexBuffer:f.zoomOutPaintVertexBuffer;_&&this._buffers.push(_)}else(f instanceof On||f instanceof Xs)&&f.paintVertexBuffer&&this._buffers.push(f.paintVertexBuffer)}}upload(n){for(const l in this.binders){const f=this.binders[l];(f instanceof On||f instanceof Xs||f instanceof ho)&&f.upload(n)}this.updatePaintBuffers()}destroy(){for(const n in this.binders){const l=this.binders[n];(l instanceof On||l instanceof Xs||l instanceof ho)&&l.destroy()}}}class as{constructor(n,l,f=()=>!0){this.programConfigurations={};for(const _ of n)this.programConfigurations[_.id]=new e_(_,l,f);this.needsUpload=!1,this._featureMap=new zo,this._bufferOffset=0}populatePaintArrays(n,l,f,_,b,v){for(const T in this.programConfigurations)this.programConfigurations[T].populatePaintArrays(n,l,_,b,v);l.id!==void 0&&this._featureMap.add(l.id,f,this._bufferOffset,n),this._bufferOffset=n,this.needsUpload=!0}updatePaintArrays(n,l,f,_){for(const b of f)this.needsUpload=this.programConfigurations[b.id].updatePaintArrays(n,this._featureMap,l,b,_)||this.needsUpload}get(n){return this.programConfigurations[n]}upload(n){if(this.needsUpload){for(const l in this.programConfigurations)this.programConfigurations[l].upload(n);this.needsUpload=!1}}destroy(){for(const n in this.programConfigurations)this.programConfigurations[n].destroy()}}function t_(c,n){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[c]||[c.replace(`${n}-`,"").replace(/-/g,"_")]}function ad(c,n,l){const f={color:{source:Bl,composite:B},number:{source:y,composite:Bl}},_=function(b){return{"line-pattern":{source:Ze,composite:Ze},"fill-pattern":{source:Ze,composite:Ze},"fill-extrusion-pattern":{source:Ze,composite:Ze}}[b]}(c);return _&&_[l]||f[n][l]}ot("ConstantBinder",Dl),ot("CrossFadedConstantBinder",Ra),ot("SourceExpressionBinder",On),ot("CrossFadedCompositeBinder",ho),ot("CompositeExpressionBinder",Xs),ot("ProgramConfiguration",e_,{omit:["_buffers"]}),ot("ProgramConfigurationSet",as);const ch=Math.pow(2,14)-1,hh=-ch-1;function uo(c){const n=Gt/c.extent,l=c.loadGeometry();for(let f=0;f<l.length;f++){const _=l[f];for(let b=0;b<_.length;b++){const v=_[b],T=Math.round(v.x*n),E=Math.round(v.y*n);v.x=Ir(T,hh,ch),v.y=Ir(E,hh,ch),(T<v.x||T>v.x+1||E<v.y||E>v.y+1)&&ci("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return l}function Fn(c,n){return{type:c.type,id:c.id,properties:c.properties,geometry:n?uo(c):[]}}const aA=-32768;function F5(c,n,l,f,_){c.emplaceBack(aA+8*n+f,aA+8*l+_)}class Xy{constructor(n){this.zoom=n.zoom,this.globalState=n.globalState,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(l=>l.id),this.index=n.index,this.hasPattern=!1,this.layoutVertexArray=new ve,this.indexArray=new si,this.segments=new Pt,this.programConfigurations=new as(n.layers,n.zoom),this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(n,l,f){const _=this.layers[0],b=[];let v=null,T=!1,E=_.type==="heatmap";if(_.type==="circle"){const P=_;v=P.layout.get("circle-sort-key"),T=!v.isConstant(),E=E||P.paint.get("circle-pitch-alignment")==="map"}const I=E?l.subdivisionGranularity.circle:1;for(const{feature:P,id:O,index:z,sourceLayerIndex:j}of n){const H=this.layers[0]._featureFilter.needGeometry,W=Fn(P,H);if(!this.layers[0]._featureFilter.filter(new vi(this.zoom,{globalState:this.globalState}),W,f))continue;const K=T?v.evaluate(W,{},f):void 0,ie={id:O,properties:P.properties,type:P.type,sourceLayerIndex:j,index:z,geometry:H?W.geometry:uo(P),patterns:{},sortKey:K};b.push(ie)}T&&b.sort((P,O)=>P.sortKey-O.sortKey);for(const P of b){const{geometry:O,index:z,sourceLayerIndex:j}=P,H=n[z].feature;this.addFeature(P,O,z,f,I),l.featureIndex.insert(H,O,z,j,this.index)}}update(n,l,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,l,this.stateDependentLayers,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,Ii),this.indexBuffer=n.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(n,l,f,_,b=1){let v;switch(b){case 1:v=[0,7];break;case 3:v=[0,2,5,7];break;case 5:v=[0,1,3,4,6,7];break;case 7:v=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${b}; valid values are 1, 3, 5, 7.`)}const T=v.length;for(const E of l)for(const I of E){const P=I.x,O=I.y;if(P<0||P>=Gt||O<0||O>=Gt)continue;const z=this.segments.prepareSegment(T*T,this.layoutVertexArray,this.indexArray,n.sortKey),j=z.vertexLength;for(let H=0;H<T;H++)for(let W=0;W<T;W++)F5(this.layoutVertexArray,P,O,v[W],v[H]);for(let H=0;H<T-1;H++)for(let W=0;W<T-1;W++){const K=j+H*T+W,ie=j+(H+1)*T+W;this.indexArray.emplaceBack(K,ie+1,K+1),this.indexArray.emplaceBack(K,ie,ie+1)}z.vertexLength+=T*T,z.primitiveLength+=(T-1)*(T-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,f,{},_)}}function lA(c,n){for(let l=0;l<c.length;l++)if(uh(n,c[l]))return!0;for(let l=0;l<n.length;l++)if(uh(c,n[l]))return!0;return!!qy(c,n)}function k5(c,n,l){return!!uh(c,n)||!!Zy(n,c,l)}function cA(c,n){if(c.length===1)return uA(n,c[0]);for(let l=0;l<n.length;l++){const f=n[l];for(let _=0;_<f.length;_++)if(uh(c,f[_]))return!0}for(let l=0;l<c.length;l++)if(uA(n,c[l]))return!0;for(let l=0;l<n.length;l++)if(qy(c,n[l]))return!0;return!1}function N5(c,n,l){if(c.length>1){if(qy(c,n))return!0;for(let f=0;f<n.length;f++)if(Zy(n[f],c,l))return!0}for(let f=0;f<c.length;f++)if(Zy(c[f],n,l))return!0;return!1}function qy(c,n){if(c.length===0||n.length===0)return!1;for(let l=0;l<c.length-1;l++){const f=c[l],_=c[l+1];for(let b=0;b<n.length-1;b++)if(L5(f,_,n[b],n[b+1]))return!0}return!1}function L5(c,n,l,f){return vr(c,l,f)!==vr(n,l,f)&&vr(c,n,l)!==vr(c,n,f)}function Zy(c,n,l){const f=l*l;if(n.length===1)return c.distSqr(n[0])<f;for(let _=1;_<n.length;_++)if(hA(c,n[_-1],n[_])<f)return!0;return!1}function hA(c,n,l){const f=n.distSqr(l);if(f===0)return c.distSqr(n);const _=((c.x-n.x)*(l.x-n.x)+(c.y-n.y)*(l.y-n.y))/f;return c.distSqr(_<0?n:_>1?l:l.sub(n)._mult(_)._add(n))}function uA(c,n){let l,f,_,b=!1;for(let v=0;v<c.length;v++){l=c[v];for(let T=0,E=l.length-1;T<l.length;E=T++)f=l[T],_=l[E],f.y>n.y!=_.y>n.y&&n.x<(_.x-f.x)*(n.y-f.y)/(_.y-f.y)+f.x&&(b=!b)}return b}function uh(c,n){let l=!1;for(let f=0,_=c.length-1;f<c.length;_=f++){const b=c[f],v=c[_];b.y>n.y!=v.y>n.y&&n.x<(v.x-b.x)*(n.y-b.y)/(v.y-b.y)+b.x&&(l=!l)}return l}function U5(c,n,l){const f=l[0],_=l[2];if(c.x<f.x&&n.x<f.x||c.x>_.x&&n.x>_.x||c.y<f.y&&n.y<f.y||c.y>_.y&&n.y>_.y)return!1;const b=vr(c,n,l[0]);return b!==vr(c,n,l[1])||b!==vr(c,n,l[2])||b!==vr(c,n,l[3])}function ld(c,n,l){const f=n.paint.get(c).value;return f.kind==="constant"?f.value:l.programConfigurations.get(n.id).getMaxValue(c)}function i_(c){return Math.sqrt(c[0]*c[0]+c[1]*c[1])}function r_(c,n,l,f,_){if(!n[0]&&!n[1])return c;const b=x.convert(n)._mult(_);l==="viewport"&&b._rotate(-f);const v=[];for(let T=0;T<c.length;T++)v.push(c[T].sub(b));return v}let dA,fA;ot("CircleBucket",Xy,{omit:["layers"]});var z5={get paint(){return fA=fA||new jr({"circle-radius":new vt(we.paint_circle["circle-radius"]),"circle-color":new vt(we.paint_circle["circle-color"]),"circle-blur":new vt(we.paint_circle["circle-blur"]),"circle-opacity":new vt(we.paint_circle["circle-opacity"]),"circle-translate":new ft(we.paint_circle["circle-translate"]),"circle-translate-anchor":new ft(we.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new ft(we.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new ft(we.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new vt(we.paint_circle["circle-stroke-width"]),"circle-stroke-color":new vt(we.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new vt(we.paint_circle["circle-stroke-opacity"])})},get layout(){return dA=dA||new jr({"circle-sort-key":new vt(we.layout_circle["circle-sort-key"])})}};class V5 extends ws{constructor(n){super(n,z5)}createBucket(n){return new Xy(n)}queryRadius(n){const l=n;return ld("circle-radius",this,l)+ld("circle-stroke-width",this,l)+i_(this.paint.get("circle-translate"))}queryIntersectsFeature({queryGeometry:n,feature:l,featureState:f,geometry:_,transform:b,pixelsToTileUnits:v,unwrappedTileID:T,getElevation:E}){const I=r_(n,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-b.bearingInRadians,v),P=this.paint.get("circle-radius").evaluate(l,f)+this.paint.get("circle-stroke-width").evaluate(l,f),O=this.paint.get("circle-pitch-alignment")==="map",z=O?I:function(H,W,K,ie){return H.map(me=>pA(me,W,K,ie))}(I,b,T,E),j=O?P*v:P;for(const H of _)for(const W of H){const K=O?W:pA(W,b,T,E);let ie=j;const me=b.projectTileCoordinates(W.x,W.y,T,E).signedDistanceFromCamera;if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?ie*=me/b.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(ie*=b.cameraToCenterDistance/me),k5(z,K,ie))return!0}return!1}}function pA(c,n,l,f){const _=n.projectTileCoordinates(c.x,c.y,l,f).point;return new x((.5*_.x+.5)*n.width,(.5*-_.y+.5)*n.height)}class _A extends Xy{}let gA;ot("HeatmapBucket",_A,{omit:["layers"]});var j5={get paint(){return gA=gA||new jr({"heatmap-radius":new vt(we.paint_heatmap["heatmap-radius"]),"heatmap-weight":new vt(we.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new ft(we.paint_heatmap["heatmap-intensity"]),"heatmap-color":new nh(we.paint_heatmap["heatmap-color"]),"heatmap-opacity":new ft(we.paint_heatmap["heatmap-opacity"])})}};function Ky(c,{width:n,height:l},f,_){if(_){if(_ instanceof Uint8ClampedArray)_=new Uint8Array(_.buffer);else if(_.length!==n*l*f)throw new RangeError(`mismatched image size. expected: ${_.length} but got: ${n*l*f}`)}else _=new Uint8Array(n*l*f);return c.width=n,c.height=l,c.data=_,c}function mA(c,{width:n,height:l},f){if(n===c.width&&l===c.height)return;const _=Ky({},{width:n,height:l},f);Yy(c,_,{x:0,y:0},{x:0,y:0},{width:Math.min(c.width,n),height:Math.min(c.height,l)},f),c.width=n,c.height=l,c.data=_.data}function Yy(c,n,l,f,_,b){if(_.width===0||_.height===0)return n;if(_.width>c.width||_.height>c.height||l.x>c.width-_.width||l.y>c.height-_.height)throw new RangeError("out of range source coordinates for image copy");if(_.width>n.width||_.height>n.height||f.x>n.width-_.width||f.y>n.height-_.height)throw new RangeError("out of range destination coordinates for image copy");const v=c.data,T=n.data;if(v===T)throw new Error("srcData equals dstData, so image is already copied");for(let E=0;E<_.height;E++){const I=((l.y+E)*c.width+l.x)*b,P=((f.y+E)*n.width+f.x)*b;for(let O=0;O<_.width*b;O++)T[P+O]=v[I+O]}return n}class cd{constructor(n,l){Ky(this,n,1,l)}resize(n){mA(this,n,1)}clone(){return new cd({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(n,l,f,_,b){Yy(n,l,f,_,b,1)}}class ls{constructor(n,l){Ky(this,n,4,l)}resize(n){mA(this,n,4)}replace(n,l){l?this.data.set(n):this.data=n instanceof Uint8ClampedArray?new Uint8Array(n.buffer):n}clone(){return new ls({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(n,l,f,_,b){Yy(n,l,f,_,b,4)}setPixel(n,l,f){const _=4*(n*this.width+l);this.data[_+0]=Math.round(255*f.r/f.a),this.data[_+1]=Math.round(255*f.g/f.a),this.data[_+2]=Math.round(255*f.b/f.a),this.data[_+3]=Math.round(255*f.a)}}function yA(c){const n={},l=c.resolution||256,f=c.clips?c.clips.length:1,_=c.image||new ls({width:l,height:f});if(Math.log(l)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${l}`);const b=(v,T,E)=>{n[c.evaluationKey]=E;const I=c.expression.evaluate(n);_.setPixel(v/4/l,T/4,I)};if(c.clips)for(let v=0,T=0;v<f;++v,T+=4*l)for(let E=0,I=0;E<l;E++,I+=4){const P=E/(l-1),{start:O,end:z}=c.clips[v];b(T,I,O*(1-P)+z*P)}else for(let v=0,T=0;v<l;v++,T+=4)b(0,T,v/(l-1));return _}ot("AlphaImage",cd),ot("RGBAImage",ls);const Jy="big-fb";class H5 extends ws{createBucket(n){return new _A(n)}constructor(n){super(n,j5),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(n){n==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=yA({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(Jy)&&this.heatmapFbos.delete(Jy)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let bA;var G5={get paint(){return bA=bA||new jr({"hillshade-illumination-direction":new ft(we.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-altitude":new ft(we.paint_hillshade["hillshade-illumination-altitude"]),"hillshade-illumination-anchor":new ft(we.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new ft(we.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new ft(we.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new ft(we.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new ft(we.paint_hillshade["hillshade-accent-color"]),"hillshade-method":new ft(we.paint_hillshade["hillshade-method"])})}};class $5 extends ws{constructor(n){super(n,G5),this.recalculate({zoom:0,zoomHistory:{}},void 0)}getIlluminationProperties(){let n=this.paint.get("hillshade-illumination-direction").values,l=this.paint.get("hillshade-illumination-altitude").values,f=this.paint.get("hillshade-highlight-color").values,_=this.paint.get("hillshade-shadow-color").values;const b=Math.max(n.length,l.length,f.length,_.length);n=n.concat(Array(b-n.length).fill(n.at(-1))),l=l.concat(Array(b-l.length).fill(l.at(-1))),f=f.concat(Array(b-f.length).fill(f.at(-1))),_=_.concat(Array(b-_.length).fill(_.at(-1)));const v=l.map(Mn);return{directionRadians:n.map(Mn),altitudeRadians:v,shadowColor:_,highlightColor:f}}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}let vA;var W5={get paint(){return vA=vA||new jr({"color-relief-opacity":new ft(we["paint_color-relief"]["color-relief-opacity"]),"color-relief-color":new nh(we["paint_color-relief"]["color-relief-color"])})}};class Qy{constructor(n,l,f,_){this.context=n,this.format=f,this.texture=n.gl.createTexture(),this.update(l,_)}update(n,l,f){const{width:_,height:b}=n,v=!(this.size&&this.size[0]===_&&this.size[1]===b||f),{context:T}=this,{gl:E}=T;if(this.useMipmap=!!(l&&l.useMipmap),E.bindTexture(E.TEXTURE_2D,this.texture),T.pixelStoreUnpackFlipY.set(!1),T.pixelStoreUnpack.set(1),T.pixelStoreUnpackPremultiplyAlpha.set(this.format===E.RGBA&&(!l||l.premultiply!==!1)),v)this.size=[_,b],n instanceof HTMLImageElement||n instanceof HTMLCanvasElement||n instanceof HTMLVideoElement||n instanceof ImageData||is(n)?E.texImage2D(E.TEXTURE_2D,0,this.format,this.format,E.UNSIGNED_BYTE,n):E.texImage2D(E.TEXTURE_2D,0,this.format,_,b,0,this.format,E.UNSIGNED_BYTE,n.data);else{const{x:I,y:P}=f||{x:0,y:0};n instanceof HTMLImageElement||n instanceof HTMLCanvasElement||n instanceof HTMLVideoElement||n instanceof ImageData||is(n)?E.texSubImage2D(E.TEXTURE_2D,0,I,P,E.RGBA,E.UNSIGNED_BYTE,n):E.texSubImage2D(E.TEXTURE_2D,0,I,P,_,b,E.RGBA,E.UNSIGNED_BYTE,n.data)}this.useMipmap&&this.isSizePowerOfTwo()&&E.generateMipmap(E.TEXTURE_2D),T.pixelStoreUnpackFlipY.setDefault(),T.pixelStoreUnpack.setDefault(),T.pixelStoreUnpackPremultiplyAlpha.setDefault()}bind(n,l,f){const{context:_}=this,{gl:b}=_;b.bindTexture(b.TEXTURE_2D,this.texture),f!==b.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(f=b.LINEAR),n!==this.filter&&(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,n),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,f||n),this.filter=n),l!==this.wrap&&(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,l),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,l),this.wrap=l)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:n}=this.context;n.deleteTexture(this.texture),this.texture=null}}class xA{constructor(n,l,f,_=1,b=1,v=1,T=0){if(this.uid=n,l.height!==l.width)throw new RangeError("DEM tiles must be square");if(f&&!["mapbox","terrarium","custom"].includes(f))return void ci(`"${f}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=l.height;const E=this.dim=l.height-2;switch(this.data=new Uint32Array(l.data.buffer),f){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=_,this.greenFactor=b,this.blueFactor=v,this.baseShift=T;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let I=0;I<E;I++)this.data[this._idx(-1,I)]=this.data[this._idx(0,I)],this.data[this._idx(E,I)]=this.data[this._idx(E-1,I)],this.data[this._idx(I,-1)]=this.data[this._idx(I,0)],this.data[this._idx(I,E)]=this.data[this._idx(I,E-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(E,-1)]=this.data[this._idx(E-1,0)],this.data[this._idx(-1,E)]=this.data[this._idx(0,E-1)],this.data[this._idx(E,E)]=this.data[this._idx(E-1,E-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let I=0;I<E;I++)for(let P=0;P<E;P++){const O=this.get(I,P);O>this.max&&(this.max=O),O<this.min&&(this.min=O)}}get(n,l){const f=new Uint8Array(this.data.buffer),_=4*this._idx(n,l);return this.unpack(f[_],f[_+1],f[_+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(n,l){if(n<-1||n>=this.dim+1||l<-1||l>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(l+1)*this.stride+(n+1)}unpack(n,l,f){return n*this.redFactor+l*this.greenFactor+f*this.blueFactor-this.baseShift}pack(n){return wA(n,this.getUnpackVector())}getPixels(){return new ls({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(n,l,f){if(this.dim!==n.dim)throw new Error("dem dimension mismatch");let _=l*this.dim,b=l*this.dim+this.dim,v=f*this.dim,T=f*this.dim+this.dim;switch(l){case-1:_=b-1;break;case 1:b=_+1}switch(f){case-1:v=T-1;break;case 1:T=v+1}const E=-l*this.dim,I=-f*this.dim;for(let P=v;P<T;P++)for(let O=_;O<b;O++)this.data[this._idx(O,P)]=n.data[this._idx(O+E,P+I)]}}function wA(c,n){const l=n[0],f=n[1],_=n[2],b=n[3],v=Math.min(l,f,_),T=Math.round((c+b)/v);return{r:Math.floor(T*v/l)%256,g:Math.floor(T*v/f)%256,b:Math.floor(T*v/_)%256}}ot("DEMData",xA);class X5 extends ws{constructor(n){super(n,W5)}_createColorRamp(n){const l={elevationStops:[],colorStops:[]},f=this._transitionablePaint._values["color-relief-color"].value.expression;if(f instanceof Tl&&f._styleExpression.expression instanceof wr){this.colorRampExpression=f;const v=f._styleExpression.expression;l.elevationStops=v.labels,l.colorStops=[];for(const T of l.elevationStops)l.colorStops.push(v.evaluate({globals:{elevation:T}}))}if(l.elevationStops.length<1&&(l.elevationStops=[0],l.colorStops=[yt.transparent]),l.elevationStops.length<2&&(l.elevationStops.push(l.elevationStops[0]+1),l.colorStops.push(l.colorStops[0])),l.elevationStops.length<=n)return l;const _={elevationStops:[],colorStops:[]},b=(l.elevationStops.length-1)/(n-1);for(let v=0;v<l.elevationStops.length-.5;v+=b)_.elevationStops.push(l.elevationStops[Math.round(v)]),_.colorStops.push(l.colorStops[Math.round(v)]);return ci(`Too many colors in specification of ${this.id} color-relief layer, may not render properly.`),_}_colorRampChanged(){return this.colorRampExpression!=this._transitionablePaint._values["color-relief-color"].value.expression}getColorRampTextures(n,l,f){if(this.colorRampTextures&&!this._colorRampChanged())return this.colorRampTextures;const _=this._createColorRamp(l),b=new ls({width:_.colorStops.length,height:1}),v=new ls({width:_.colorStops.length,height:1});for(let T=0;T<_.elevationStops.length;T++){const E=wA(_.elevationStops[T],f);v.setPixel(0,T,new yt(E.r/255,E.g/255,E.b/255,1)),b.setPixel(0,T,_.colorStops[T])}return this.colorRampTextures={elevationTexture:new Qy(n,v,n.gl.RGBA),colorTexture:new Qy(n,b,n.gl.RGBA)},this.colorRampTextures}hasOffscreenPass(){return this.visibility!=="none"&&!!this.colorRampTextures}}const q5=Oi([{name:"a_pos",components:2,type:"Int16"}],4),{members:Z5}=q5;function e0(c,n,l){const f=l.patternDependencies;let _=!1;for(const b of n){const v=b.paint.get(`${c}-pattern`);v.isConstant()||(_=!0);const T=v.constantOr(null);T&&(_=!0,f[T.to]=!0,f[T.from]=!0)}return _}function t0(c,n,l,f,_){const b=_.patternDependencies;for(const v of n){const T=v.paint.get(`${c}-pattern`).value;if(T.kind!=="constant"){let E=T.evaluate({zoom:f-1},l,{},_.availableImages),I=T.evaluate({zoom:f},l,{},_.availableImages),P=T.evaluate({zoom:f+1},l,{},_.availableImages);E=E&&E.name?E.name:E,I=I&&I.name?I.name:I,P=P&&P.name?P.name:P,b[E]=!0,b[I]=!0,b[P]=!0,l.patterns[v.id]={min:E,mid:I,max:P}}}return l}function TA(c,n,l,f,_){let b;if(_===function(v,T,E,I){let P=0;for(let O=T,z=E-I;O<E;O+=I)P+=(v[z]-v[O])*(v[O+1]+v[z+1]),z=O;return P}(c,n,l,f)>0)for(let v=n;v<l;v+=f)b=CA(v/f|0,c[v],c[v+1],b);else for(let v=l-f;v>=n;v-=f)b=CA(v/f|0,c[v],c[v+1],b);return b&&dh(b,b.next)&&(fd(b),b=b.next),b}function Ol(c,n){if(!c)return c;n||(n=c);let l,f=c;do if(l=!1,f.steiner||!dh(f,f.next)&&ji(f.prev,f,f.next)!==0)f=f.next;else{if(fd(f),f=n=f.prev,f===f.next)break;l=!0}while(l||f!==n);return n}function hd(c,n,l,f,_,b,v){if(!c)return;!v&&b&&function(E,I,P,O){let z=E;do z.z===0&&(z.z=i0(z.x,z.y,I,P,O)),z.prevZ=z.prev,z.nextZ=z.next,z=z.next;while(z!==E);z.prevZ.nextZ=null,z.prevZ=null,function(j){let H,W=1;do{let K,ie=j;j=null;let me=null;for(H=0;ie;){H++;let he=ie,fe=0;for(let Ne=0;Ne<W&&(fe++,he=he.nextZ,he);Ne++);let Be=W;for(;fe>0||Be>0&&he;)fe!==0&&(Be===0||!he||ie.z<=he.z)?(K=ie,ie=ie.nextZ,fe--):(K=he,he=he.nextZ,Be--),me?me.nextZ=K:j=K,K.prevZ=me,me=K;ie=he}me.nextZ=null,W*=2}while(H>1)}(z)}(c,f,_,b);let T=c;for(;c.prev!==c.next;){const E=c.prev,I=c.next;if(b?Y5(c,f,_,b):K5(c))n.push(E.i,c.i,I.i),fd(c),c=I.next,T=I.next;else if((c=I)===T){v?v===1?hd(c=J5(Ol(c),n),n,l,f,_,b,2):v===2&&Q5(c,n,l,f,_,b):hd(Ol(c),n,l,f,_,b,1);break}}}function K5(c){const n=c.prev,l=c,f=c.next;if(ji(n,l,f)>=0)return!1;const _=n.x,b=l.x,v=f.x,T=n.y,E=l.y,I=f.y,P=Math.min(_,b,v),O=Math.min(T,E,I),z=Math.max(_,b,v),j=Math.max(T,E,I);let H=f.next;for(;H!==n;){if(H.x>=P&&H.x<=z&&H.y>=O&&H.y<=j&&ud(_,T,b,E,v,I,H.x,H.y)&&ji(H.prev,H,H.next)>=0)return!1;H=H.next}return!0}function Y5(c,n,l,f){const _=c.prev,b=c,v=c.next;if(ji(_,b,v)>=0)return!1;const T=_.x,E=b.x,I=v.x,P=_.y,O=b.y,z=v.y,j=Math.min(T,E,I),H=Math.min(P,O,z),W=Math.max(T,E,I),K=Math.max(P,O,z),ie=i0(j,H,n,l,f),me=i0(W,K,n,l,f);let he=c.prevZ,fe=c.nextZ;for(;he&&he.z>=ie&&fe&&fe.z<=me;){if(he.x>=j&&he.x<=W&&he.y>=H&&he.y<=K&&he!==_&&he!==v&&ud(T,P,E,O,I,z,he.x,he.y)&&ji(he.prev,he,he.next)>=0||(he=he.prevZ,fe.x>=j&&fe.x<=W&&fe.y>=H&&fe.y<=K&&fe!==_&&fe!==v&&ud(T,P,E,O,I,z,fe.x,fe.y)&&ji(fe.prev,fe,fe.next)>=0))return!1;fe=fe.nextZ}for(;he&&he.z>=ie;){if(he.x>=j&&he.x<=W&&he.y>=H&&he.y<=K&&he!==_&&he!==v&&ud(T,P,E,O,I,z,he.x,he.y)&&ji(he.prev,he,he.next)>=0)return!1;he=he.prevZ}for(;fe&&fe.z<=me;){if(fe.x>=j&&fe.x<=W&&fe.y>=H&&fe.y<=K&&fe!==_&&fe!==v&&ud(T,P,E,O,I,z,fe.x,fe.y)&&ji(fe.prev,fe,fe.next)>=0)return!1;fe=fe.nextZ}return!0}function J5(c,n){let l=c;do{const f=l.prev,_=l.next.next;!dh(f,_)&&EA(f,l,l.next,_)&&dd(f,_)&&dd(_,f)&&(n.push(f.i,l.i,_.i),fd(l),fd(l.next),l=c=_),l=l.next}while(l!==c);return Ol(l)}function Q5(c,n,l,f,_,b){let v=c;do{let T=v.next.next;for(;T!==v.prev;){if(v.i!==T.i&&s8(v,T)){let E=SA(v,T);return v=Ol(v,v.next),E=Ol(E,E.next),hd(v,n,l,f,_,b,0),void hd(E,n,l,f,_,b,0)}T=T.next}v=v.next}while(v!==c)}function e8(c,n){let l=c.x-n.x;return l===0&&(l=c.y-n.y,l===0)&&(l=(c.next.y-c.y)/(c.next.x-c.x)-(n.next.y-n.y)/(n.next.x-n.x)),l}function t8(c,n){const l=function(_,b){let v=b;const T=_.x,E=_.y;let I,P=-1/0;if(dh(_,v))return v;do{if(dh(_,v.next))return v.next;if(E<=v.y&&E>=v.next.y&&v.next.y!==v.y){const W=v.x+(E-v.y)*(v.next.x-v.x)/(v.next.y-v.y);if(W<=T&&W>P&&(P=W,I=v.x<v.next.x?v:v.next,W===T))return I}v=v.next}while(v!==b);if(!I)return null;const O=I,z=I.x,j=I.y;let H=1/0;v=I;do{if(T>=v.x&&v.x>=z&&T!==v.x&&AA(E<j?T:P,E,z,j,E<j?P:T,E,v.x,v.y)){const W=Math.abs(E-v.y)/(T-v.x);dd(v,_)&&(W<H||W===H&&(v.x>I.x||v.x===I.x&&i8(I,v)))&&(I=v,H=W)}v=v.next}while(v!==O);return I}(c,n);if(!l)return n;const f=SA(l,c);return Ol(f,f.next),Ol(l,l.next)}function i8(c,n){return ji(c.prev,c,n.prev)<0&&ji(n.next,c,c.next)<0}function i0(c,n,l,f,_){return(c=1431655765&((c=858993459&((c=252645135&((c=16711935&((c=(c-l)*_|0)|c<<8))|c<<4))|c<<2))|c<<1))|(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-f)*_|0)|n<<8))|n<<4))|n<<2))|n<<1))<<1}function r8(c){let n=c,l=c;do(n.x<l.x||n.x===l.x&&n.y<l.y)&&(l=n),n=n.next;while(n!==c);return l}function AA(c,n,l,f,_,b,v,T){return(_-v)*(n-T)>=(c-v)*(b-T)&&(c-v)*(f-T)>=(l-v)*(n-T)&&(l-v)*(b-T)>=(_-v)*(f-T)}function ud(c,n,l,f,_,b,v,T){return!(c===v&&n===T)&&AA(c,n,l,f,_,b,v,T)}function s8(c,n){return c.next.i!==n.i&&c.prev.i!==n.i&&!function(l,f){let _=l;do{if(_.i!==l.i&&_.next.i!==l.i&&_.i!==f.i&&_.next.i!==f.i&&EA(_,_.next,l,f))return!0;_=_.next}while(_!==l);return!1}(c,n)&&(dd(c,n)&&dd(n,c)&&function(l,f){let _=l,b=!1;const v=(l.x+f.x)/2,T=(l.y+f.y)/2;do _.y>T!=_.next.y>T&&_.next.y!==_.y&&v<(_.next.x-_.x)*(T-_.y)/(_.next.y-_.y)+_.x&&(b=!b),_=_.next;while(_!==l);return b}(c,n)&&(ji(c.prev,c,n.prev)||ji(c,n.prev,n))||dh(c,n)&&ji(c.prev,c,c.next)>0&&ji(n.prev,n,n.next)>0)}function ji(c,n,l){return(n.y-c.y)*(l.x-n.x)-(n.x-c.x)*(l.y-n.y)}function dh(c,n){return c.x===n.x&&c.y===n.y}function EA(c,n,l,f){const _=n_(ji(c,n,l)),b=n_(ji(c,n,f)),v=n_(ji(l,f,c)),T=n_(ji(l,f,n));return _!==b&&v!==T||!(_!==0||!s_(c,l,n))||!(b!==0||!s_(c,f,n))||!(v!==0||!s_(l,c,f))||!(T!==0||!s_(l,n,f))}function s_(c,n,l){return n.x<=Math.max(c.x,l.x)&&n.x>=Math.min(c.x,l.x)&&n.y<=Math.max(c.y,l.y)&&n.y>=Math.min(c.y,l.y)}function n_(c){return c>0?1:c<0?-1:0}function dd(c,n){return ji(c.prev,c,c.next)<0?ji(c,n,c.next)>=0&&ji(c,c.prev,n)>=0:ji(c,n,c.prev)<0||ji(c,c.next,n)<0}function SA(c,n){const l=r0(c.i,c.x,c.y),f=r0(n.i,n.x,n.y),_=c.next,b=n.prev;return c.next=n,n.prev=c,l.next=_,_.prev=l,f.next=l,l.prev=f,b.next=f,f.prev=b,f}function CA(c,n,l,f){const _=r0(c,n,l);return f?(_.next=f.next,_.prev=f,f.next.prev=_,f.next=_):(_.prev=_,_.next=_),_}function fd(c){c.next.prev=c.prev,c.prev.next=c.next,c.prevZ&&(c.prevZ.nextZ=c.nextZ),c.nextZ&&(c.nextZ.prevZ=c.prevZ)}function r0(c,n,l){return{i:c,x:n,y:l,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class fh{constructor(n,l){if(l>n)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=n,this._minGranularity=l}getGranularityForZoomLevel(n){return Math.max(Math.floor(this._baseZoomGranularity/(1<<n)),this._minGranularity,1)}}class o_{constructor(n){this.fill=n.fill,this.line=n.line,this.tile=n.tile,this.stencil=n.stencil,this.circle=n.circle}}o_.noSubdivision=new o_({fill:new fh(0,0),line:new fh(0,0),tile:new fh(0,0),stencil:new fh(0,0),circle:1}),ot("SubdivisionGranularityExpression",fh),ot("SubdivisionGranularitySetting",o_);const ph=-32768,pd=32767;class n8{constructor(n,l){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=n,this._granularityCellSize=Gt/n,this._canonical=l}_getKey(n,l){return(n+=32768)<<16|l+32768}_vertexToIndex(n,l){if(n<-32768||l<-32768||n>32767||l>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");const f=0|Math.round(n),_=0|Math.round(l),b=this._getKey(f,_);if(this._vertexDictionary.has(b))return this._vertexDictionary.get(b);const v=this._vertexBuffer.length/2;return this._vertexDictionary.set(b,v),this._vertexBuffer.push(f,_),v}_subdivideTrianglesScanline(n){if(this._granularity<2)return function(_,b){const v=[];for(let T=0;T<b.length;T+=3){const E=b[T],I=b[T+1],P=b[T+2],O=_[2*E],z=_[2*E+1];(_[2*I]-O)*(_[2*P+1]-z)-(_[2*I+1]-z)*(_[2*P]-O)>0?(v.push(E),v.push(P),v.push(I)):(v.push(E),v.push(I),v.push(P))}return v}(this._vertexBuffer,n);const l=[],f=n.length;for(let _=0;_<f;_+=3){const b=[n[_+0],n[_+1],n[_+2]],v=[this._vertexBuffer[2*n[_+0]+0],this._vertexBuffer[2*n[_+0]+1],this._vertexBuffer[2*n[_+1]+0],this._vertexBuffer[2*n[_+1]+1],this._vertexBuffer[2*n[_+2]+0],this._vertexBuffer[2*n[_+2]+1]];let T=1/0,E=1/0,I=-1/0,P=-1/0;for(let W=0;W<3;W++){const K=v[2*W],ie=v[2*W+1];T=Math.min(T,K),I=Math.max(I,K),E=Math.min(E,ie),P=Math.max(P,ie)}if(T===I||E===P)continue;const O=Math.floor(T/this._granularityCellSize),z=Math.ceil(I/this._granularityCellSize),j=Math.floor(E/this._granularityCellSize),H=Math.ceil(P/this._granularityCellSize);if(O!==z||j!==H)for(let W=j;W<H;W++){const K=this._scanlineGenerateVertexRingForCellRow(W,v,b);o8(this._vertexBuffer,K,l)}else l.push(...b)}return l}_scanlineGenerateVertexRingForCellRow(n,l,f){const _=n*this._granularityCellSize,b=_+this._granularityCellSize,v=[];for(let T=0;T<3;T++){const E=l[2*T],I=l[2*T+1],P=l[2*(T+1)%6],O=l[(2*(T+1)+1)%6],z=l[2*(T+2)%6],j=l[(2*(T+2)+1)%6],H=P-E,W=O-I,K=H===0,ie=W===0,me=(_-I)/W,he=(b-I)/W,fe=Math.min(me,he),Be=Math.max(me,he);if(!ie&&(fe>=1||Be<=0)||ie&&(I<_||I>b)){O>=_&&O<=b&&v.push(f[(T+1)%3]);continue}!ie&&fe>0&&v.push(this._vertexToIndex(E+H*fe,I+W*fe));const Ne=E+H*Math.max(fe,0),He=E+H*Math.min(Be,1);K||this._generateIntraEdgeVertices(v,E,I,P,O,Ne,He),!ie&&Be<1&&v.push(this._vertexToIndex(E+H*Be,I+W*Be)),(ie||O>=_&&O<=b)&&v.push(f[(T+1)%3]),!ie&&(O<=_||O>=b)&&this._generateInterEdgeVertices(v,E,I,P,O,z,j,He,_,b)}return v}_generateIntraEdgeVertices(n,l,f,_,b,v,T){const E=_-l,I=b-f,P=I===0,O=P?Math.min(l,_):Math.min(v,T),z=P?Math.max(l,_):Math.max(v,T),j=Math.floor(O/this._granularityCellSize)+1,H=Math.ceil(z/this._granularityCellSize)-1;if(P?l<_:v<T)for(let W=j;W<=H;W++){const K=W*this._granularityCellSize;n.push(this._vertexToIndex(K,f+I*(K-l)/E))}else for(let W=H;W>=j;W--){const K=W*this._granularityCellSize;n.push(this._vertexToIndex(K,f+I*(K-l)/E))}}_generateInterEdgeVertices(n,l,f,_,b,v,T,E,I,P){const O=b-f,z=v-_,j=T-b,H=(I-b)/j,W=(P-b)/j,K=Math.min(H,W),ie=Math.max(H,W),me=_+z*K;let he=Math.floor(Math.min(me,E)/this._granularityCellSize)+1,fe=Math.ceil(Math.max(me,E)/this._granularityCellSize)-1,Be=E<me;const Ne=j===0;if(Ne&&(T===I||T===P))return;if(Ne||K>=1||ie<=0){const st=f-T,Ke=v+(l-v)*Math.min((I-T)/st,(P-T)/st);he=Math.floor(Math.min(Ke,E)/this._granularityCellSize)+1,fe=Math.ceil(Math.max(Ke,E)/this._granularityCellSize)-1,Be=E<Ke}const He=O>0?P:I;if(Be)for(let st=he;st<=fe;st++)n.push(this._vertexToIndex(st*this._granularityCellSize,He));else for(let st=fe;st>=he;st--)n.push(this._vertexToIndex(st*this._granularityCellSize,He))}_generateOutline(n){const l=[];for(const f of n){const _=Fl(f,this._granularity,!0),b=this._pointArrayToIndices(_),v=[];for(let T=1;T<b.length;T++)v.push(b[T-1]),v.push(b[T]);l.push(v)}return l}_handlePoles(n){let l=!1,f=!1;this._canonical&&(this._canonical.y===0&&(l=!0),this._canonical.y===(1<<this._canonical.z)-1&&(f=!0)),(l||f)&&this._fillPoles(n,l,f)}_ensureNoPoleVertices(){const n=this._vertexBuffer;for(let l=0;l<n.length;l+=2){const f=n[l+1];f===ph&&(n[l+1]=-32767),f===pd&&(n[l+1]=32766)}}_generatePoleQuad(n,l,f,_,b,v){_>b!=(v===ph)?(n.push(l),n.push(f),n.push(this._vertexToIndex(_,v)),n.push(f),n.push(this._vertexToIndex(b,v)),n.push(this._vertexToIndex(_,v))):(n.push(f),n.push(l),n.push(this._vertexToIndex(_,v)),n.push(this._vertexToIndex(b,v)),n.push(f),n.push(this._vertexToIndex(_,v)))}_fillPoles(n,l,f){const _=this._vertexBuffer,b=Gt,v=n.length;for(let T=2;T<v;T+=3){const E=n[T-2],I=n[T-1],P=n[T],O=_[2*E],z=_[2*E+1],j=_[2*I],H=_[2*I+1],W=_[2*P],K=_[2*P+1];l&&(z===0&&H===0&&this._generatePoleQuad(n,E,I,O,j,ph),H===0&&K===0&&this._generatePoleQuad(n,I,P,j,W,ph),K===0&&z===0&&this._generatePoleQuad(n,P,E,W,O,ph)),f&&(z===b&&H===b&&this._generatePoleQuad(n,E,I,O,j,pd),H===b&&K===b&&this._generatePoleQuad(n,I,P,j,W,pd),K===b&&z===b&&this._generatePoleQuad(n,P,E,W,O,pd))}}_initializeVertices(n){for(let l=0;l<n.length;l+=2)this._vertexToIndex(n[l],n[l+1])}subdividePolygonInternal(n,l){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;const{flattened:f,holeIndices:_}=function(T){const E=[],I=[];for(const P of T)if(P.length!==0){P!==T[0]&&E.push(I.length/2);for(let O=0;O<P.length;O++)I.push(P[O].x),I.push(P[O].y)}return{flattened:I,holeIndices:E}}(n);let b;this._initializeVertices(f);try{const T=function(I,P,O=2){const z=P&&P.length,j=z?P[0]*O:I.length;let H=TA(I,0,j,O,!0);const W=[];if(!H||H.next===H.prev)return W;let K,ie,me;if(z&&(H=function(he,fe,Be,Ne){const He=[];for(let st=0,Ke=fe.length;st<Ke;st++){const et=TA(he,fe[st]*Ne,st<Ke-1?fe[st+1]*Ne:he.length,Ne,!1);et===et.next&&(et.steiner=!0),He.push(r8(et))}He.sort(e8);for(let st=0;st<He.length;st++)Be=t8(He[st],Be);return Be}(I,P,H,O)),I.length>80*O){K=I[0],ie=I[1];let he=K,fe=ie;for(let Be=O;Be<j;Be+=O){const Ne=I[Be],He=I[Be+1];Ne<K&&(K=Ne),He<ie&&(ie=He),Ne>he&&(he=Ne),He>fe&&(fe=He)}me=Math.max(he-K,fe-ie),me=me!==0?32767/me:0}return hd(H,W,O,K,ie,me,0),W}(f,_),E=this._convertIndices(f,T);b=this._subdivideTrianglesScanline(E)}catch(T){console.error(T)}let v=[];return l&&(v=this._generateOutline(n)),this._ensureNoPoleVertices(),this._handlePoles(b),{verticesFlattened:this._vertexBuffer,indicesTriangles:b,indicesLineList:v}}_convertIndices(n,l){const f=[];for(let _=0;_<l.length;_++)f.push(this._vertexToIndex(n[2*l[_]],n[2*l[_]+1]));return f}_pointArrayToIndices(n){const l=[];for(let f=0;f<n.length;f++){const _=n[f];l.push(this._vertexToIndex(_.x,_.y))}return l}}function IA(c,n,l,f=!0){return new n8(l,n).subdividePolygonInternal(c,f)}function Fl(c,n,l=!1){if(!c||c.length<1)return[];if(c.length<2)return[];const f=c[0],_=c[c.length-1],b=l&&(f.x!==_.x||f.y!==_.y);if(n<2)return b?[...c,c[0]]:[...c];const v=Math.floor(Gt/n),T=[];T.push(new x(c[0].x,c[0].y));const E=c.length,I=b?E:E-1;for(let P=0;P<I;P++){const O=c[P],z=P<E-1?c[P+1]:c[0],j=O.x,H=O.y,W=z.x,K=z.y,ie=j!==W,me=H!==K;if(!ie&&!me)continue;const he=W-j,fe=K-H,Be=Math.abs(he),Ne=Math.abs(fe);let He=j,st=H;for(;;){const et=he>0?(Math.floor(He/v)+1)*v:(Math.ceil(He/v)-1)*v,_t=fe>0?(Math.floor(st/v)+1)*v:(Math.ceil(st/v)-1)*v,Qe=Math.abs(He-et),tt=Math.abs(st-_t),ze=Math.abs(He-W),wt=Math.abs(st-K),Et=ie?Qe/Be:Number.POSITIVE_INFINITY,mt=me?tt/Ne:Number.POSITIVE_INFINITY;if((ze<=Qe||!ie)&&(wt<=tt||!me))break;if(Et<mt&&ie||!me){He=et,st+=fe*Et;const dt=new x(He,Math.round(st));T[T.length-1].x===dt.x&&T[T.length-1].y===dt.y||T.push(dt)}else{He+=he*mt,st=_t;const dt=new x(Math.round(He),st);T[T.length-1].x===dt.x&&T[T.length-1].y===dt.y||T.push(dt)}}const Ke=new x(W,K);T[T.length-1].x===Ke.x&&T[T.length-1].y===Ke.y||T.push(Ke)}return T}function o8(c,n,l){if(n.length===0)throw new Error("Subdivision vertex ring is empty.");let f=0,_=c[2*n[0]];for(let E=1;E<n.length;E++){const I=c[2*n[E]];I<_&&(_=I,f=E)}const b=n.length;let v=f,T=(v+1)%b;for(;;){const E=v-1>=0?v-1:b-1,I=(T+1)%b,P=c[2*n[E]],O=c[2*n[I]],z=c[2*n[v]],j=c[2*n[v]+1],H=c[2*n[T]+1];let W=!1;if(P<O)W=!0;else if(P>O)W=!1;else{const K=H-j,ie=-(c[2*n[T]]-z),me=j<H?1:-1;((P-z)*K+(c[2*n[E]+1]-j)*ie)*me>((O-z)*K+(c[2*n[I]+1]-j)*ie)*me&&(W=!0)}if(W){const K=n[E],ie=n[v],me=n[T];K!==ie&&K!==me&&ie!==me&&l.push(me,ie,K),v--,v<0&&(v=b-1)}else{const K=n[I],ie=n[v],me=n[T];K!==ie&&K!==me&&ie!==me&&l.push(me,ie,K),T++,T>=b&&(T=0)}if(E===I)break}}function MA(c,n,l,f,_,b,v,T,E){const I=_.length/2,P=v&&T&&E;if(I<Pt.MAX_VERTEX_ARRAY_LENGTH){const O=n.prepareSegment(I,l,f),z=O.vertexLength;for(let W=0;W<b.length;W+=3)f.emplaceBack(z+b[W],z+b[W+1],z+b[W+2]);let j,H;O.vertexLength+=I,O.primitiveLength+=b.length/3,P&&(H=v.prepareSegment(I,l,T),j=H.vertexLength,H.vertexLength+=I);for(let W=0;W<_.length;W+=2)c(_[W],_[W+1]);if(P)for(let W=0;W<E.length;W++){const K=E[W];for(let ie=1;ie<K.length;ie+=2)T.emplaceBack(j+K[ie-1],j+K[ie]);H.primitiveLength+=K.length/2}}else(function(O,z,j,H,W,K){const ie=[];for(let Ne=0;Ne<H.length/2;Ne++)ie.push(-1);const me={count:0};let he=0,fe=O.getOrCreateLatestSegment(z,j),Be=fe.vertexLength;for(let Ne=2;Ne<W.length;Ne+=3){const He=W[Ne-2],st=W[Ne-1],Ke=W[Ne];let et=ie[He]<he,_t=ie[st]<he,Qe=ie[Ke]<he;fe.vertexLength+((et?1:0)+(_t?1:0)+(Qe?1:0))>Pt.MAX_VERTEX_ARRAY_LENGTH&&(fe=O.createNewSegment(z,j),he=me.count,et=!0,_t=!0,Qe=!0,Be=0);const tt=_d(ie,H,K,me,He,et,fe),ze=_d(ie,H,K,me,st,_t,fe),wt=_d(ie,H,K,me,Ke,Qe,fe);j.emplaceBack(Be+tt-he,Be+ze-he,Be+wt-he),fe.primitiveLength++}})(n,l,f,_,b,c),P&&function(O,z,j,H,W,K){const ie=[];for(let Ne=0;Ne<H.length/2;Ne++)ie.push(-1);const me={count:0};let he=0,fe=O.getOrCreateLatestSegment(z,j),Be=fe.vertexLength;for(let Ne=0;Ne<W.length;Ne++){const He=W[Ne];for(let st=1;st<W[Ne].length;st+=2){const Ke=He[st-1],et=He[st];let _t=ie[Ke]<he,Qe=ie[et]<he;fe.vertexLength+((_t?1:0)+(Qe?1:0))>Pt.MAX_VERTEX_ARRAY_LENGTH&&(fe=O.createNewSegment(z,j),he=me.count,_t=!0,Qe=!0,Be=0);const tt=_d(ie,H,K,me,Ke,_t,fe),ze=_d(ie,H,K,me,et,Qe,fe);j.emplaceBack(Be+tt-he,Be+ze-he),fe.primitiveLength++}}}(v,l,T,_,E,c),n.forceNewSegmentOnNextPrepare(),v==null||v.forceNewSegmentOnNextPrepare()}function _d(c,n,l,f,_,b,v){if(b){const T=f.count;return l(n[2*_],n[2*_+1]),c[_]=f.count,f.count++,v.vertexLength++,T}return c[_]}class s0{constructor(n){this.zoom=n.zoom,this.globalState=n.globalState,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(l=>l.id),this.index=n.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new ke,this.indexArray=new si,this.indexArray2=new ei,this.programConfigurations=new as(n.layers,n.zoom),this.segments=new Pt,this.segments2=new Pt,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(n,l,f){this.hasPattern=e0("fill",this.layers,l);const _=this.layers[0].layout.get("fill-sort-key"),b=!_.isConstant(),v=[];for(const{feature:T,id:E,index:I,sourceLayerIndex:P}of n){const O=this.layers[0]._featureFilter.needGeometry,z=Fn(T,O);if(!this.layers[0]._featureFilter.filter(new vi(this.zoom,{globalState:this.globalState}),z,f))continue;const j=b?_.evaluate(z,{},f,l.availableImages):void 0,H={id:E,properties:T.properties,type:T.type,sourceLayerIndex:P,index:I,geometry:O?z.geometry:uo(T),patterns:{},sortKey:j};v.push(H)}b&&v.sort((T,E)=>T.sortKey-E.sortKey);for(const T of v){const{geometry:E,index:I,sourceLayerIndex:P}=T;if(this.hasPattern){const O=t0("fill",this.layers,T,this.zoom,l);this.patternFeatures.push(O)}else this.addFeature(T,E,I,f,{},l.subdivisionGranularity);l.featureIndex.insert(n[I].feature,E,I,P,this.index)}}update(n,l,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,l,this.stateDependentLayers,f)}addFeatures(n,l,f){for(const _ of this.patternFeatures)this.addFeature(_,_.geometry,_.index,l,f,n.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,Z5),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.indexBuffer2=n.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(n,l,f,_,b,v){for(const T of yl(l,500)){const E=IA(T,_,v.fill.getGranularityForZoomLevel(_.z)),I=this.layoutVertexArray;MA((P,O)=>{I.emplaceBack(P,O)},this.segments,this.layoutVertexArray,this.indexArray,E.verticesFlattened,E.indicesTriangles,this.segments2,this.indexArray2,E.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,f,b,_)}}let RA,PA;ot("FillBucket",s0,{omit:["layers","patternFeatures"]});var a8={get paint(){return PA=PA||new jr({"fill-antialias":new ft(we.paint_fill["fill-antialias"]),"fill-opacity":new vt(we.paint_fill["fill-opacity"]),"fill-color":new vt(we.paint_fill["fill-color"]),"fill-outline-color":new vt(we.paint_fill["fill-outline-color"]),"fill-translate":new ft(we.paint_fill["fill-translate"]),"fill-translate-anchor":new ft(we.paint_fill["fill-translate-anchor"]),"fill-pattern":new sh(we.paint_fill["fill-pattern"])})},get layout(){return RA=RA||new jr({"fill-sort-key":new vt(we.layout_fill["fill-sort-key"])})}};class l8 extends ws{constructor(n){super(n,a8)}recalculate(n,l){super.recalculate(n,l);const f=this.paint._values["fill-outline-color"];f.value.kind==="constant"&&f.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(n){return new s0(n)}queryRadius(){return i_(this.paint.get("fill-translate"))}queryIntersectsFeature({queryGeometry:n,geometry:l,transform:f,pixelsToTileUnits:_}){return cA(r_(n,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-f.bearingInRadians,_),l)}isTileClipped(){return!0}}const c8=Oi([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),h8=Oi([{name:"a_centroid",components:2,type:"Int16"}],4),{members:u8}=c8;class _h{constructor(n,l,f,_,b){this.properties={},this.extent=f,this.type=0,this.id=void 0,this._pbf=n,this._geometry=-1,this._keys=_,this._values=b,n.readFields(d8,this,l)}loadGeometry(){const n=this._pbf;n.pos=this._geometry;const l=n.readVarint()+n.pos,f=[];let _,b=1,v=0,T=0,E=0;for(;n.pos<l;){if(v<=0){const I=n.readVarint();b=7&I,v=I>>3}if(v--,b===1||b===2)T+=n.readSVarint(),E+=n.readSVarint(),b===1&&(_&&f.push(_),_=[]),_&&_.push(new x(T,E));else{if(b!==7)throw new Error(`unknown command ${b}`);_&&_.push(_[0].clone())}}return _&&f.push(_),f}bbox(){const n=this._pbf;n.pos=this._geometry;const l=n.readVarint()+n.pos;let f=1,_=0,b=0,v=0,T=1/0,E=-1/0,I=1/0,P=-1/0;for(;n.pos<l;){if(_<=0){const O=n.readVarint();f=7&O,_=O>>3}if(_--,f===1||f===2)b+=n.readSVarint(),v+=n.readSVarint(),b<T&&(T=b),b>E&&(E=b),v<I&&(I=v),v>P&&(P=v);else if(f!==7)throw new Error(`unknown command ${f}`)}return[T,I,E,P]}toGeoJSON(n,l,f){const _=this.extent*Math.pow(2,f),b=this.extent*n,v=this.extent*l,T=this.loadGeometry();function E(z){return[360*(z.x+b)/_-180,360/Math.PI*Math.atan(Math.exp((1-2*(z.y+v)/_)*Math.PI))-90]}function I(z){return z.map(E)}let P;if(this.type===1){const z=[];for(const H of T)z.push(H[0]);const j=I(z);P=z.length===1?{type:"Point",coordinates:j[0]}:{type:"MultiPoint",coordinates:j}}else if(this.type===2){const z=T.map(I);P=z.length===1?{type:"LineString",coordinates:z[0]}:{type:"MultiLineString",coordinates:z}}else{if(this.type!==3)throw new Error("unknown feature type");{const z=function(H){const W=H.length;if(W<=1)return[H];const K=[];let ie,me;for(let he=0;he<W;he++){const fe=f8(H[he]);fe!==0&&(me===void 0&&(me=fe<0),me===fe<0?(ie&&K.push(ie),ie=[H[he]]):ie&&ie.push(H[he]))}return ie&&K.push(ie),K}(T),j=[];for(const H of z)j.push(H.map(I));P=j.length===1?{type:"Polygon",coordinates:j[0]}:{type:"MultiPolygon",coordinates:j}}}const O={type:"Feature",geometry:P,properties:this.properties};return this.id!=null&&(O.id=this.id),O}}function d8(c,n,l){c===1?n.id=l.readVarint():c===2?function(f,_){const b=f.readVarint()+f.pos;for(;f.pos<b;){const v=_._keys[f.readVarint()],T=_._values[f.readVarint()];_.properties[v]=T}}(l,n):c===3?n.type=l.readVarint():c===4&&(n._geometry=l.pos)}function f8(c){let n=0;for(let l,f,_=0,b=c.length,v=b-1;_<b;v=_++)l=c[_],f=c[v],n+=(f.x-l.x)*(l.y+f.y);return n}_h.types=["Unknown","Point","LineString","Polygon"];class BA{constructor(n,l){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=n,this._keys=[],this._values=[],this._features=[],n.readFields(p8,this,l),this.length=this._features.length}feature(n){if(n<0||n>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[n];const l=this._pbf.readVarint()+this._pbf.pos;return new _h(this._pbf,l,this.extent,this._keys,this._values)}}function p8(c,n,l){c===15?n.version=l.readVarint():c===1?n.name=l.readString():c===5?n.extent=l.readVarint():c===2?n._features.push(l.pos):c===3?n._keys.push(l.readString()):c===4&&n._values.push(function(f){let _=null;const b=f.readVarint()+f.pos;for(;f.pos<b;){const v=f.readVarint()>>3;_=v===1?f.readString():v===2?f.readFloat():v===3?f.readDouble():v===4?f.readVarint64():v===5?f.readVarint():v===6?f.readSVarint():v===7?f.readBoolean():null}if(_==null)throw new Error("unknown feature value");return _}(l))}class DA{constructor(n,l){this.layers=n.readFields(_8,{},l)}}function _8(c,n,l){if(c===3){const f=new BA(l,l.readVarint()+l.pos);f.length&&(n[f.name]=f)}}const n0=Math.pow(2,13);function gd(c,n,l,f,_,b,v,T){c.emplaceBack(n,l,2*Math.floor(f*n0)+v,_*n0*2,b*n0*2,Math.round(T))}class o0{constructor(n){this.zoom=n.zoom,this.globalState=n.globalState,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(l=>l.id),this.index=n.index,this.hasPattern=!1,this.layoutVertexArray=new Me,this.centroidVertexArray=new le,this.indexArray=new si,this.programConfigurations=new as(n.layers,n.zoom),this.segments=new Pt,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(n,l,f){this.features=[],this.hasPattern=e0("fill-extrusion",this.layers,l);for(const{feature:_,id:b,index:v,sourceLayerIndex:T}of n){const E=this.layers[0]._featureFilter.needGeometry,I=Fn(_,E);if(!this.layers[0]._featureFilter.filter(new vi(this.zoom,{globalState:this.globalState}),I,f))continue;const P={id:b,sourceLayerIndex:T,index:v,geometry:E?I.geometry:uo(_),properties:_.properties,type:_.type,patterns:{}};this.hasPattern?this.features.push(t0("fill-extrusion",this.layers,P,this.zoom,l)):this.addFeature(P,P.geometry,v,f,{},l.subdivisionGranularity),l.featureIndex.insert(_,P.geometry,v,T,this.index,!0)}}addFeatures(n,l,f){for(const _ of this.features){const{geometry:b}=_;this.addFeature(_,b,_.index,l,f,n.subdivisionGranularity)}}update(n,l,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,l,this.stateDependentLayers,f)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,u8),this.centroidVertexBuffer=n.createVertexBuffer(this.centroidVertexArray,h8.members,!0),this.indexBuffer=n.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(n,l,f,_,b,v){for(const T of yl(l,500)){const E={x:0,y:0,sampleCount:0},I=this.layoutVertexArray.length;this.processPolygon(E,_,n,T,v);const P=this.layoutVertexArray.length-I,O=Math.floor(E.x/E.sampleCount),z=Math.floor(E.y/E.sampleCount);for(let j=0;j<P;j++)this.centroidVertexArray.emplaceBack(O,z)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,f,b,_)}processPolygon(n,l,f,_,b){if(_.length<1||OA(_[0]))return;for(const O of _)O.length!==0&&g8(n,O);const v={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},T=b.fill.getGranularityForZoomLevel(l.z),E=_h.types[f.type]==="Polygon";for(const O of _){if(O.length===0||OA(O))continue;const z=Fl(O,T,E);this._generateSideFaces(z,v)}if(!E)return;const I=IA(_,l,T,!1),P=this.layoutVertexArray;MA((O,z)=>{gd(P,O,z,0,0,1,1,0)},this.segments,this.layoutVertexArray,this.indexArray,I.verticesFlattened,I.indicesTriangles)}_generateSideFaces(n,l){let f=0;for(let _=1;_<n.length;_++){const b=n[_],v=n[_-1];if(m8(b,v))continue;l.segment.vertexLength+4>Pt.MAX_VERTEX_ARRAY_LENGTH&&(l.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const T=b.sub(v)._perp()._unit(),E=v.dist(b);f+E>32768&&(f=0),gd(this.layoutVertexArray,b.x,b.y,T.x,T.y,0,0,f),gd(this.layoutVertexArray,b.x,b.y,T.x,T.y,0,1,f),f+=E,gd(this.layoutVertexArray,v.x,v.y,T.x,T.y,0,0,f),gd(this.layoutVertexArray,v.x,v.y,T.x,T.y,0,1,f);const I=l.segment.vertexLength;this.indexArray.emplaceBack(I,I+2,I+1),this.indexArray.emplaceBack(I+1,I+2,I+3),l.segment.vertexLength+=4,l.segment.primitiveLength+=2}}}function g8(c,n){for(let l=0;l<n.length;l++){const f=n[l];l===n.length-1&&n[0].x===f.x&&n[0].y===f.y||(c.x+=f.x,c.y+=f.y,c.sampleCount++)}}function m8(c,n){return c.x===n.x&&(c.x<0||c.x>Gt)||c.y===n.y&&(c.y<0||c.y>Gt)}function OA(c){return c.every(n=>n.x<0)||c.every(n=>n.x>Gt)||c.every(n=>n.y<0)||c.every(n=>n.y>Gt)}let FA;ot("FillExtrusionBucket",o0,{omit:["layers","features"]});var y8={get paint(){return FA=FA||new jr({"fill-extrusion-opacity":new ft(we["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new vt(we["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new ft(we["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new ft(we["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new sh(we["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new vt(we["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new vt(we["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new ft(we["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class b8 extends ws{constructor(n){super(n,y8)}createBucket(n){return new o0(n)}queryRadius(){return i_(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature({queryGeometry:n,feature:l,featureState:f,geometry:_,transform:b,pixelsToTileUnits:v,pixelPosMatrix:T}){const E=r_(n,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-b.bearingInRadians,v),I=this.paint.get("fill-extrusion-height").evaluate(l,f),P=this.paint.get("fill-extrusion-base").evaluate(l,f),O=function(j,H){const W=[];for(const K of j){const ie=[K.x,K.y,0,1];St(ie,ie,H),W.push(new x(ie[0]/ie[3],ie[1]/ie[3]))}return W}(E,T),z=function(j,H,W,K){const ie=[],me=[],he=K[8]*H,fe=K[9]*H,Be=K[10]*H,Ne=K[11]*H,He=K[8]*W,st=K[9]*W,Ke=K[10]*W,et=K[11]*W;for(const _t of j){const Qe=[],tt=[];for(const ze of _t){const wt=ze.x,Et=ze.y,mt=K[0]*wt+K[4]*Et+K[12],dt=K[1]*wt+K[5]*Et+K[13],zt=K[2]*wt+K[6]*Et+K[14],Mi=K[3]*wt+K[7]*Et+K[15],ir=zt+Be,Dr=Mi+Ne,Zs=mt+He,cs=dt+st,Tr=zt+Ke,Ti=Mi+et,fr=new x((mt+he)/Dr,(dt+fe)/Dr);fr.z=ir/Dr,Qe.push(fr);const Ar=new x(Zs/Ti,cs/Ti);Ar.z=Tr/Ti,tt.push(Ar)}ie.push(Qe),me.push(tt)}return[ie,me]}(_,P,I,T);return function(j,H,W){let K=1/0;cA(W,H)&&(K=kA(W,H[0]));for(let ie=0;ie<H.length;ie++){const me=H[ie],he=j[ie];for(let fe=0;fe<me.length-1;fe++){const Be=me[fe],Ne=[Be,me[fe+1],he[fe+1],he[fe],Be];lA(W,Ne)&&(K=Math.min(K,kA(W,Ne)))}}return K!==1/0&&K}(z[0],z[1],O)}}function md(c,n){return c.x*n.x+c.y*n.y}function kA(c,n){if(c.length===1){let l=0;const f=n[l++];let _;for(;!_||f.equals(_);)if(_=n[l++],!_)return 1/0;for(;l<n.length;l++){const b=n[l],v=c[0],T=_.sub(f),E=b.sub(f),I=v.sub(f),P=md(T,T),O=md(T,E),z=md(E,E),j=md(I,T),H=md(I,E),W=P*z-O*O,K=(z*j-O*H)/W,ie=(P*H-O*j)/W,me=f.z*(1-K-ie)+_.z*K+b.z*ie;if(isFinite(me))return me}return 1/0}{let l=1/0;for(const f of n)l=Math.min(l,f.z);return l}}const v8=Oi([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:x8}=v8,w8=Oi([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:T8}=w8,A8=Math.cos(Math.PI/180*37.5),NA=Math.pow(2,14)/.5;class a0{constructor(n){this.zoom=n.zoom,this.globalState=n.globalState,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(l=>l.id),this.index=n.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(l=>{this.gradients[l.id]={}}),this.layoutVertexArray=new Pe,this.layoutVertexArray2=new Fe,this.indexArray=new si,this.programConfigurations=new as(n.layers,n.zoom),this.segments=new Pt,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(n,l,f){this.hasPattern=e0("line",this.layers,l);const _=this.layers[0].layout.get("line-sort-key"),b=!_.isConstant(),v=[];for(const{feature:T,id:E,index:I,sourceLayerIndex:P}of n){const O=this.layers[0]._featureFilter.needGeometry,z=Fn(T,O);if(!this.layers[0]._featureFilter.filter(new vi(this.zoom,{globalState:this.globalState}),z,f))continue;const j=b?_.evaluate(z,{},f):void 0,H={id:E,properties:T.properties,type:T.type,sourceLayerIndex:P,index:I,geometry:O?z.geometry:uo(T),patterns:{},sortKey:j};v.push(H)}b&&v.sort((T,E)=>T.sortKey-E.sortKey);for(const T of v){const{geometry:E,index:I,sourceLayerIndex:P}=T;if(this.hasPattern){const O=t0("line",this.layers,T,this.zoom,l);this.patternFeatures.push(O)}else this.addFeature(T,E,I,f,{},l.subdivisionGranularity);l.featureIndex.insert(n[I].feature,E,I,P,this.index)}}update(n,l,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,l,this.stateDependentLayers,f)}addFeatures(n,l,f){for(const _ of this.patternFeatures)this.addFeature(_,_.geometry,_.index,l,f,n.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=n.createVertexBuffer(this.layoutVertexArray2,T8)),this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,x8),this.indexBuffer=n.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(n){if(n.properties&&Object.prototype.hasOwnProperty.call(n.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(n.properties,"mapbox_clip_end"))return{start:+n.properties.mapbox_clip_start,end:+n.properties.mapbox_clip_end}}addFeature(n,l,f,_,b,v){const T=this.layers[0].layout,E=T.get("line-join").evaluate(n,{}),I=T.get("line-cap"),P=T.get("line-miter-limit"),O=T.get("line-round-limit");this.lineClips=this.lineFeatureClips(n);for(const z of l)this.addLine(z,n,E,I,P,O,_,v);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,f,b,_)}addLine(n,l,f,_,b,v,T,E){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,n=Fl(n,T?E.line.getGranularityForZoomLevel(T.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let he=0;he<n.length-1;he++)this.totalDistance+=n[he].dist(n[he+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const I=_h.types[l.type]==="Polygon";let P=n.length;for(;P>=2&&n[P-1].equals(n[P-2]);)P--;let O=0;for(;O<P-1&&n[O].equals(n[O+1]);)O++;if(P<(I?3:2))return;f==="bevel"&&(b=1.05);const z=this.overscaling<=16?122880/(512*this.overscaling):0,j=this.segments.prepareSegment(10*P,this.layoutVertexArray,this.indexArray);let H,W,K,ie,me;this.e1=this.e2=-1,I&&(H=n[P-2],me=n[O].sub(H)._unit()._perp());for(let he=O;he<P;he++){if(K=he===P-1?I?n[O+1]:void 0:n[he+1],K&&n[he].equals(K))continue;me&&(ie=me),H&&(W=H),H=n[he],me=K?K.sub(H)._unit()._perp():ie,ie=ie||me;let fe=ie.add(me);fe.x===0&&fe.y===0||fe._unit();const Be=ie.x*me.x+ie.y*me.y,Ne=fe.x*me.x+fe.y*me.y,He=Ne!==0?1/Ne:1/0,st=2*Math.sqrt(2-2*Ne),Ke=Ne<A8&&W&&K,et=ie.x*me.y-ie.y*me.x>0;if(Ke&&he>O){const tt=H.dist(W);if(tt>2*z){const ze=H.sub(H.sub(W)._mult(z/tt)._round());this.updateDistance(W,ze),this.addCurrentVertex(ze,ie,0,0,j),W=ze}}const _t=W&&K;let Qe=_t?f:I?"butt":_;if(_t&&Qe==="round"&&(He<v?Qe="miter":He<=2&&(Qe="fakeround")),Qe==="miter"&&He>b&&(Qe="bevel"),Qe==="bevel"&&(He>2&&(Qe="flipbevel"),He<b&&(Qe="miter")),W&&this.updateDistance(W,H),Qe==="miter")fe._mult(He),this.addCurrentVertex(H,fe,0,0,j);else if(Qe==="flipbevel"){if(He>100)fe=me.mult(-1);else{const tt=He*ie.add(me).mag()/ie.sub(me).mag();fe._perp()._mult(tt*(et?-1:1))}this.addCurrentVertex(H,fe,0,0,j),this.addCurrentVertex(H,fe.mult(-1),0,0,j)}else if(Qe==="bevel"||Qe==="fakeround"){const tt=-Math.sqrt(He*He-1),ze=et?tt:0,wt=et?0:tt;if(W&&this.addCurrentVertex(H,ie,ze,wt,j),Qe==="fakeround"){const Et=Math.round(180*st/Math.PI/20);for(let mt=1;mt<Et;mt++){let dt=mt/Et;if(dt!==.5){const Mi=dt-.5;dt+=dt*Mi*(dt-1)*((1.0904+Be*(Be*(3.55645-1.43519*Be)-3.2452))*Mi*Mi+(.848013+Be*(.215638*Be-1.06021)))}const zt=me.sub(ie)._mult(dt)._add(ie)._unit()._mult(et?-1:1);this.addHalfVertex(H,zt.x,zt.y,!1,et,0,j)}}K&&this.addCurrentVertex(H,me,-ze,-wt,j)}else if(Qe==="butt")this.addCurrentVertex(H,fe,0,0,j);else if(Qe==="square"){const tt=W?1:-1;this.addCurrentVertex(H,fe,tt,tt,j)}else Qe==="round"&&(W&&(this.addCurrentVertex(H,ie,0,0,j),this.addCurrentVertex(H,ie,1,1,j,!0)),K&&(this.addCurrentVertex(H,me,-1,-1,j,!0),this.addCurrentVertex(H,me,0,0,j)));if(Ke&&he<P-1){const tt=H.dist(K);if(tt>2*z){const ze=H.add(K.sub(H)._mult(z/tt)._round());this.updateDistance(H,ze),this.addCurrentVertex(ze,me,0,0,j),H=ze}}}}addCurrentVertex(n,l,f,_,b,v=!1){const T=l.y*_-l.x,E=-l.y-l.x*_;this.addHalfVertex(n,l.x+l.y*f,l.y-l.x*f,v,!1,f,b),this.addHalfVertex(n,T,E,v,!0,-_,b),this.distance>NA/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(n,l,f,_,b,v))}addHalfVertex({x:n,y:l},f,_,b,v,T,E){const I=.5*(this.lineClips?this.scaledDistance*(NA-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((n<<1)+(b?1:0),(l<<1)+(v?1:0),Math.round(63*f)+128,Math.round(63*_)+128,1+(T===0?0:T<0?-1:1)|(63&I)<<2,I>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const P=E.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,P,this.e2),E.primitiveLength++),v?this.e2=P:this.e1=P}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(n,l){this.distance+=n.dist(l),this.updateScaledDistance()}}let LA,UA;ot("LineBucket",a0,{omit:["layers","patternFeatures"]});var zA={get paint(){return UA=UA||new jr({"line-opacity":new vt(we.paint_line["line-opacity"]),"line-color":new vt(we.paint_line["line-color"]),"line-translate":new ft(we.paint_line["line-translate"]),"line-translate-anchor":new ft(we.paint_line["line-translate-anchor"]),"line-width":new vt(we.paint_line["line-width"]),"line-gap-width":new vt(we.paint_line["line-gap-width"]),"line-offset":new vt(we.paint_line["line-offset"]),"line-blur":new vt(we.paint_line["line-blur"]),"line-dasharray":new oo(we.paint_line["line-dasharray"]),"line-pattern":new sh(we.paint_line["line-pattern"]),"line-gradient":new nh(we.paint_line["line-gradient"])})},get layout(){return LA=LA||new jr({"line-cap":new ft(we.layout_line["line-cap"]),"line-join":new vt(we.layout_line["line-join"]),"line-miter-limit":new ft(we.layout_line["line-miter-limit"]),"line-round-limit":new ft(we.layout_line["line-round-limit"]),"line-sort-key":new vt(we.layout_line["line-sort-key"])})}};class E8 extends vt{possiblyEvaluate(n,l){return l=new vi(Math.floor(l.zoom),{now:l.now,fadeDuration:l.fadeDuration,zoomHistory:l.zoomHistory,transition:l.transition}),super.possiblyEvaluate(n,l)}evaluate(n,l,f,_){return l=$i({},l,{zoom:Math.floor(l.zoom)}),super.evaluate(n,l,f,_)}}let a_;class S8 extends ws{constructor(n){super(n,zA),this.gradientVersion=0,a_||(a_=new E8(zA.paint.properties["line-width"].specification),a_.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(n){if(n==="line-gradient"){const l=this.gradientExpression();this.stepInterpolant=!!function(f){return f._styleExpression!==void 0}(l)&&l._styleExpression.expression instanceof Di,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(n,l){super.recalculate(n,l),this.paint._values["line-floorwidth"]=a_.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,n)}createBucket(n){return new a0(n)}queryRadius(n){const l=n,f=VA(ld("line-width",this,l),ld("line-gap-width",this,l)),_=ld("line-offset",this,l);return f/2+Math.abs(_)+i_(this.paint.get("line-translate"))}queryIntersectsFeature({queryGeometry:n,feature:l,featureState:f,geometry:_,transform:b,pixelsToTileUnits:v}){const T=r_(n,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-b.bearingInRadians,v),E=v/2*VA(this.paint.get("line-width").evaluate(l,f),this.paint.get("line-gap-width").evaluate(l,f)),I=this.paint.get("line-offset").evaluate(l,f);return I&&(_=function(P,O){const z=[];for(let j=0;j<P.length;j++){const H=P[j],W=[];for(let K=0;K<H.length;K++){const ie=H[K-1],me=H[K],he=H[K+1],fe=K===0?new x(0,0):me.sub(ie)._unit()._perp(),Be=K===H.length-1?new x(0,0):he.sub(me)._unit()._perp(),Ne=fe._add(Be)._unit(),He=Ne.x*Be.x+Ne.y*Be.y;He!==0&&Ne._mult(1/He),W.push(Ne._mult(O)._add(me))}z.push(W)}return z}(_,I*v)),function(P,O,z){for(let j=0;j<O.length;j++){const H=O[j];if(P.length>=3){for(let W=0;W<H.length;W++)if(uh(P,H[W]))return!0}if(N5(P,H,z))return!0}return!1}(T,_,E)}isTileClipped(){return!0}}function VA(c,n){return n>0?n+2*c:c}const C8=Oi([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),I8=Oi([{name:"a_projected_pos",components:3,type:"Float32"}],4);Oi([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const M8=Oi([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);Oi([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const jA=Oi([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),R8=Oi([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function P8(c,n,l){return c.sections.forEach(f=>{f.text=function(_,b,v){const T=b.layout.get("text-transform").evaluate(v,{});return T==="uppercase"?_=_.toLocaleUpperCase():T==="lowercase"&&(_=_.toLocaleLowerCase()),Gs.applyArabicShaping&&(_=Gs.applyArabicShaping(_)),_}(f.text,n,l)}),c}Oi([{name:"triangle",components:3,type:"Uint16"}]),Oi([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Oi([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),Oi([{type:"Float32",name:"offsetX"}]),Oi([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),Oi([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const yd={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var dr=24;const l0=4294967296,HA=1/l0,GA=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");class c0{constructor(n=new Uint8Array(16)){this.buf=ArrayBuffer.isView(n)?n:new Uint8Array(n),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(n,l,f=this.length){for(;this.pos<f;){const _=this.readVarint(),b=_>>3,v=this.pos;this.type=7&_,n(b,l,this),this.pos===v&&this.skip(_)}return l}readMessage(n,l){return this.readFields(n,l,this.readVarint()+this.pos)}readFixed32(){const n=this.dataView.getUint32(this.pos,!0);return this.pos+=4,n}readSFixed32(){const n=this.dataView.getInt32(this.pos,!0);return this.pos+=4,n}readFixed64(){const n=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*l0;return this.pos+=8,n}readSFixed64(){const n=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*l0;return this.pos+=8,n}readFloat(){const n=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,n}readDouble(){const n=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,n}readVarint(n){const l=this.buf;let f,_;return _=l[this.pos++],f=127&_,_<128?f:(_=l[this.pos++],f|=(127&_)<<7,_<128?f:(_=l[this.pos++],f|=(127&_)<<14,_<128?f:(_=l[this.pos++],f|=(127&_)<<21,_<128?f:(_=l[this.pos],f|=(15&_)<<28,function(b,v,T){const E=T.buf;let I,P;if(P=E[T.pos++],I=(112&P)>>4,P<128||(P=E[T.pos++],I|=(127&P)<<3,P<128)||(P=E[T.pos++],I|=(127&P)<<10,P<128)||(P=E[T.pos++],I|=(127&P)<<17,P<128)||(P=E[T.pos++],I|=(127&P)<<24,P<128)||(P=E[T.pos++],I|=(1&P)<<31,P<128))return gh(b,I,v);throw new Error("Expected varint not more than 10 bytes")}(f,n,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const n=this.readVarint();return n%2==1?(n+1)/-2:n/2}readBoolean(){return!!this.readVarint()}readString(){const n=this.readVarint()+this.pos,l=this.pos;return this.pos=n,n-l>=12&&GA?GA.decode(this.buf.subarray(l,n)):function(f,_,b){let v="",T=_;for(;T<b;){const E=f[T];let I,P,O,z=null,j=E>239?4:E>223?3:E>191?2:1;if(T+j>b)break;j===1?E<128&&(z=E):j===2?(I=f[T+1],(192&I)==128&&(z=(31&E)<<6|63&I,z<=127&&(z=null))):j===3?(I=f[T+1],P=f[T+2],(192&I)==128&&(192&P)==128&&(z=(15&E)<<12|(63&I)<<6|63&P,(z<=2047||z>=55296&&z<=57343)&&(z=null))):j===4&&(I=f[T+1],P=f[T+2],O=f[T+3],(192&I)==128&&(192&P)==128&&(192&O)==128&&(z=(15&E)<<18|(63&I)<<12|(63&P)<<6|63&O,(z<=65535||z>=1114112)&&(z=null))),z===null?(z=65533,j=1):z>65535&&(z-=65536,v+=String.fromCharCode(z>>>10&1023|55296),z=56320|1023&z),v+=String.fromCharCode(z),T+=j}return v}(this.buf,l,n)}readBytes(){const n=this.readVarint()+this.pos,l=this.buf.subarray(this.pos,n);return this.pos=n,l}readPackedVarint(n=[],l){const f=this.readPackedEnd();for(;this.pos<f;)n.push(this.readVarint(l));return n}readPackedSVarint(n=[]){const l=this.readPackedEnd();for(;this.pos<l;)n.push(this.readSVarint());return n}readPackedBoolean(n=[]){const l=this.readPackedEnd();for(;this.pos<l;)n.push(this.readBoolean());return n}readPackedFloat(n=[]){const l=this.readPackedEnd();for(;this.pos<l;)n.push(this.readFloat());return n}readPackedDouble(n=[]){const l=this.readPackedEnd();for(;this.pos<l;)n.push(this.readDouble());return n}readPackedFixed32(n=[]){const l=this.readPackedEnd();for(;this.pos<l;)n.push(this.readFixed32());return n}readPackedSFixed32(n=[]){const l=this.readPackedEnd();for(;this.pos<l;)n.push(this.readSFixed32());return n}readPackedFixed64(n=[]){const l=this.readPackedEnd();for(;this.pos<l;)n.push(this.readFixed64());return n}readPackedSFixed64(n=[]){const l=this.readPackedEnd();for(;this.pos<l;)n.push(this.readSFixed64());return n}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(n){const l=7&n;if(l===0)for(;this.buf[this.pos++]>127;);else if(l===2)this.pos=this.readVarint()+this.pos;else if(l===5)this.pos+=4;else{if(l!==1)throw new Error(`Unimplemented type: ${l}`);this.pos+=8}}writeTag(n,l){this.writeVarint(n<<3|l)}realloc(n){let l=this.length||16;for(;l<this.pos+n;)l*=2;if(l!==this.length){const f=new Uint8Array(l);f.set(this.buf),this.buf=f,this.dataView=new DataView(f.buffer),this.length=l}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(n){this.realloc(4),this.dataView.setInt32(this.pos,n,!0),this.pos+=4}writeSFixed32(n){this.realloc(4),this.dataView.setInt32(this.pos,n,!0),this.pos+=4}writeFixed64(n){this.realloc(8),this.dataView.setInt32(this.pos,-1&n,!0),this.dataView.setInt32(this.pos+4,Math.floor(n*HA),!0),this.pos+=8}writeSFixed64(n){this.realloc(8),this.dataView.setInt32(this.pos,-1&n,!0),this.dataView.setInt32(this.pos+4,Math.floor(n*HA),!0),this.pos+=8}writeVarint(n){(n=+n||0)>268435455||n<0?function(l,f){let _,b;if(l>=0?(_=l%4294967296|0,b=l/4294967296|0):(_=~(-l%4294967296),b=~(-l/4294967296),4294967295^_?_=_+1|0:(_=0,b=b+1|0)),l>=18446744073709552e3||l<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");f.realloc(10),function(v,T,E){E.buf[E.pos++]=127&v|128,v>>>=7,E.buf[E.pos++]=127&v|128,v>>>=7,E.buf[E.pos++]=127&v|128,v>>>=7,E.buf[E.pos++]=127&v|128,E.buf[E.pos]=127&(v>>>=7)}(_,0,f),function(v,T){const E=(7&v)<<4;T.buf[T.pos++]|=E|((v>>>=3)?128:0),v&&(T.buf[T.pos++]=127&v|((v>>>=7)?128:0),v&&(T.buf[T.pos++]=127&v|((v>>>=7)?128:0),v&&(T.buf[T.pos++]=127&v|((v>>>=7)?128:0),v&&(T.buf[T.pos++]=127&v|((v>>>=7)?128:0),v&&(T.buf[T.pos++]=127&v)))))}(b,f)}(n,this):(this.realloc(4),this.buf[this.pos++]=127&n|(n>127?128:0),n<=127||(this.buf[this.pos++]=127&(n>>>=7)|(n>127?128:0),n<=127||(this.buf[this.pos++]=127&(n>>>=7)|(n>127?128:0),n<=127||(this.buf[this.pos++]=n>>>7&127))))}writeSVarint(n){this.writeVarint(n<0?2*-n-1:2*n)}writeBoolean(n){this.writeVarint(+n)}writeString(n){n=String(n),this.realloc(4*n.length),this.pos++;const l=this.pos;this.pos=function(_,b,v){for(let T,E,I=0;I<b.length;I++){if(T=b.charCodeAt(I),T>55295&&T<57344){if(!E){T>56319||I+1===b.length?(_[v++]=239,_[v++]=191,_[v++]=189):E=T;continue}if(T<56320){_[v++]=239,_[v++]=191,_[v++]=189,E=T;continue}T=E-55296<<10|T-56320|65536,E=null}else E&&(_[v++]=239,_[v++]=191,_[v++]=189,E=null);T<128?_[v++]=T:(T<2048?_[v++]=T>>6|192:(T<65536?_[v++]=T>>12|224:(_[v++]=T>>18|240,_[v++]=T>>12&63|128),_[v++]=T>>6&63|128),_[v++]=63&T|128)}return v}(this.buf,n,this.pos);const f=this.pos-l;f>=128&&$A(l,f,this),this.pos=l-1,this.writeVarint(f),this.pos+=f}writeFloat(n){this.realloc(4),this.dataView.setFloat32(this.pos,n,!0),this.pos+=4}writeDouble(n){this.realloc(8),this.dataView.setFloat64(this.pos,n,!0),this.pos+=8}writeBytes(n){const l=n.length;this.writeVarint(l),this.realloc(l);for(let f=0;f<l;f++)this.buf[this.pos++]=n[f]}writeRawMessage(n,l){this.pos++;const f=this.pos;n(l,this);const _=this.pos-f;_>=128&&$A(f,_,this),this.pos=f-1,this.writeVarint(_),this.pos+=_}writeMessage(n,l,f){this.writeTag(n,2),this.writeRawMessage(l,f)}writePackedVarint(n,l){l.length&&this.writeMessage(n,B8,l)}writePackedSVarint(n,l){l.length&&this.writeMessage(n,D8,l)}writePackedBoolean(n,l){l.length&&this.writeMessage(n,k8,l)}writePackedFloat(n,l){l.length&&this.writeMessage(n,O8,l)}writePackedDouble(n,l){l.length&&this.writeMessage(n,F8,l)}writePackedFixed32(n,l){l.length&&this.writeMessage(n,N8,l)}writePackedSFixed32(n,l){l.length&&this.writeMessage(n,L8,l)}writePackedFixed64(n,l){l.length&&this.writeMessage(n,U8,l)}writePackedSFixed64(n,l){l.length&&this.writeMessage(n,z8,l)}writeBytesField(n,l){this.writeTag(n,2),this.writeBytes(l)}writeFixed32Field(n,l){this.writeTag(n,5),this.writeFixed32(l)}writeSFixed32Field(n,l){this.writeTag(n,5),this.writeSFixed32(l)}writeFixed64Field(n,l){this.writeTag(n,1),this.writeFixed64(l)}writeSFixed64Field(n,l){this.writeTag(n,1),this.writeSFixed64(l)}writeVarintField(n,l){this.writeTag(n,0),this.writeVarint(l)}writeSVarintField(n,l){this.writeTag(n,0),this.writeSVarint(l)}writeStringField(n,l){this.writeTag(n,2),this.writeString(l)}writeFloatField(n,l){this.writeTag(n,5),this.writeFloat(l)}writeDoubleField(n,l){this.writeTag(n,1),this.writeDouble(l)}writeBooleanField(n,l){this.writeVarintField(n,+l)}}function gh(c,n,l){return l?4294967296*n+(c>>>0):4294967296*(n>>>0)+(c>>>0)}function $A(c,n,l){const f=n<=16383?1:n<=2097151?2:n<=268435455?3:Math.floor(Math.log(n)/(7*Math.LN2));l.realloc(f);for(let _=l.pos-1;_>=c;_--)l.buf[_+f]=l.buf[_]}function B8(c,n){for(let l=0;l<c.length;l++)n.writeVarint(c[l])}function D8(c,n){for(let l=0;l<c.length;l++)n.writeSVarint(c[l])}function O8(c,n){for(let l=0;l<c.length;l++)n.writeFloat(c[l])}function F8(c,n){for(let l=0;l<c.length;l++)n.writeDouble(c[l])}function k8(c,n){for(let l=0;l<c.length;l++)n.writeBoolean(c[l])}function N8(c,n){for(let l=0;l<c.length;l++)n.writeFixed32(c[l])}function L8(c,n){for(let l=0;l<c.length;l++)n.writeSFixed32(c[l])}function U8(c,n){for(let l=0;l<c.length;l++)n.writeFixed64(c[l])}function z8(c,n){for(let l=0;l<c.length;l++)n.writeSFixed64(c[l])}function V8(c,n,l){c===1&&l.readMessage(j8,n)}function j8(c,n,l){if(c===3){const{id:f,bitmap:_,width:b,height:v,left:T,top:E,advance:I}=l.readMessage(H8,{});n.push({id:f,bitmap:new cd({width:b+6,height:v+6},_),metrics:{width:b,height:v,left:T,top:E,advance:I}})}}function H8(c,n,l){c===1?n.id=l.readVarint():c===2?n.bitmap=l.readBytes():c===3?n.width=l.readVarint():c===4?n.height=l.readVarint():c===5?n.left=l.readSVarint():c===6?n.top=l.readSVarint():c===7&&(n.advance=l.readVarint())}function WA(c){let n=0,l=0;for(const v of c)n+=v.w*v.h,l=Math.max(l,v.w);c.sort((v,T)=>T.h-v.h);const f=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(n/.95)),l),h:1/0}];let _=0,b=0;for(const v of c)for(let T=f.length-1;T>=0;T--){const E=f[T];if(!(v.w>E.w||v.h>E.h)){if(v.x=E.x,v.y=E.y,b=Math.max(b,v.y+v.h),_=Math.max(_,v.x+v.w),v.w===E.w&&v.h===E.h){const I=f.pop();I&&T<f.length&&(f[T]=I)}else v.h===E.h?(E.x+=v.w,E.w-=v.w):v.w===E.w?(E.y+=v.h,E.h-=v.h):(f.push({x:E.x+v.w,y:E.y,w:E.w-v.w,h:v.h}),E.y+=v.h,E.h-=v.h);break}}return{w:_,h:b,fill:n/(_*b)||0}}class h0{constructor(n,{pixelRatio:l,version:f,stretchX:_,stretchY:b,content:v,textFitWidth:T,textFitHeight:E}){this.paddedRect=n,this.pixelRatio=l,this.stretchX=_,this.stretchY=b,this.content=v,this.version=f,this.textFitWidth=T,this.textFitHeight=E}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class XA{constructor(n,l){const f={},_={};this.haveRenderCallbacks=[];const b=[];this.addImages(n,f,b),this.addImages(l,_,b);const{w:v,h:T}=WA(b),E=new ls({width:v||1,height:T||1});for(const I in n){const P=n[I],O=f[I].paddedRect;ls.copy(P.data,E,{x:0,y:0},{x:O.x+1,y:O.y+1},P.data)}for(const I in l){const P=l[I],O=_[I].paddedRect,z=O.x+1,j=O.y+1,H=P.data.width,W=P.data.height;ls.copy(P.data,E,{x:0,y:0},{x:z,y:j},P.data),ls.copy(P.data,E,{x:0,y:W-1},{x:z,y:j-1},{width:H,height:1}),ls.copy(P.data,E,{x:0,y:0},{x:z,y:j+W},{width:H,height:1}),ls.copy(P.data,E,{x:H-1,y:0},{x:z-1,y:j},{width:1,height:W}),ls.copy(P.data,E,{x:0,y:0},{x:z+H,y:j},{width:1,height:W})}this.image=E,this.iconPositions=f,this.patternPositions=_}addImages(n,l,f){for(const _ in n){const b=n[_],v={x:0,y:0,w:b.data.width+2,h:b.data.height+2};f.push(v),l[_]=new h0(v,b),b.hasRenderCallback&&this.haveRenderCallbacks.push(_)}}patchUpdatedImages(n,l){n.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const f in n.updatedImages)this.patchUpdatedImage(this.iconPositions[f],n.getImage(f),l),this.patchUpdatedImage(this.patternPositions[f],n.getImage(f),l)}patchUpdatedImage(n,l,f){if(!n||!l||n.version===l.version)return;n.version=l.version;const[_,b]=n.tl;f.update(l.data,void 0,{x:_,y:b})}}var Pa;ot("ImagePosition",h0),ot("ImageAtlas",XA),d.ao=void 0,(Pa=d.ao||(d.ao={}))[Pa.none=0]="none",Pa[Pa.horizontal=1]="horizontal",Pa[Pa.vertical=2]="vertical",Pa[Pa.horizontalOnly=3]="horizontalOnly";class bd{constructor(){this.scale=1,this.fontStack="",this.imageName=null,this.verticalAlign="bottom"}static forText(n,l,f){const _=new bd;return _.scale=n||1,_.fontStack=l,_.verticalAlign=f||"bottom",_}static forImage(n,l){const f=new bd;return f.imageName=n,f.verticalAlign=l||"bottom",f}}class mh{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(n,l){const f=new mh;for(let _=0;_<n.sections.length;_++){const b=n.sections[_];b.image?f.addImageSection(b):f.addTextSection(b,l)}return f}length(){return this.text.length}getSection(n){return this.sections[this.sectionIndex[n]]}getSectionIndex(n){return this.sectionIndex[n]}getCharCode(n){return this.text.charCodeAt(n)}verticalizePunctuation(){this.text=function(n){let l="";for(let f=0;f<n.length;f++){const _=n.charCodeAt(f+1)||null,b=n.charCodeAt(f-1)||null;l+=_&&Xp(_)&&!yd[n[f+1]]||b&&Xp(b)&&!yd[n[f-1]]||!yd[n[f]]?n[f]:yd[n[f]]}return l}(this.text)}trim(){let n=0;for(let f=0;f<this.text.length&&c_[this.text.charCodeAt(f)];f++)n++;let l=this.text.length;for(let f=this.text.length-1;f>=0&&f>=n&&c_[this.text.charCodeAt(f)];f--)l--;this.text=this.text.substring(n,l),this.sectionIndex=this.sectionIndex.slice(n,l)}substring(n,l){const f=new mh;return f.text=this.text.substring(n,l),f.sectionIndex=this.sectionIndex.slice(n,l),f.sections=this.sections,f}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((n,l)=>Math.max(n,this.sections[l].scale),0)}getMaxImageSize(n){let l=0,f=0;for(let _=0;_<this.length();_++){const b=this.getSection(_);if(b.imageName){const v=n[b.imageName];if(!v)continue;const T=v.displaySize;l=Math.max(l,T[0]),f=Math.max(f,T[1])}}return{maxImageWidth:l,maxImageHeight:f}}addTextSection(n,l){this.text+=n.text,this.sections.push(bd.forText(n.scale,n.fontStack||l,n.verticalAlign));const f=this.sections.length-1;for(let _=0;_<n.text.length;++_)this.sectionIndex.push(f)}addImageSection(n){const l=n.image?n.image.name:"";if(l.length===0)return void ci("Can't add FormattedSection with an empty image.");const f=this.getNextImageSectionCharCode();f?(this.text+=String.fromCharCode(f),this.sections.push(bd.forImage(l,n.verticalAlign)),this.sectionIndex.push(this.sections.length-1)):ci("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function l_(c,n,l,f,_,b,v,T,E,I,P,O,z,j,H){const W=mh.fromFeature(c,_);let K;O===d.ao.vertical&&W.verticalizePunctuation();const{processBidirectionalText:ie,processStyledBidirectionalText:me}=Gs;if(ie&&W.sections.length===1){K=[];const Be=ie(W.toString(),u0(W,I,b,n,f,j));for(const Ne of Be){const He=new mh;He.text=Ne,He.sections=W.sections;for(let st=0;st<Ne.length;st++)He.sectionIndex.push(0);K.push(He)}}else if(me){K=[];const Be=me(W.text,W.sectionIndex,u0(W,I,b,n,f,j));for(const Ne of Be){const He=new mh;He.text=Ne[0],He.sectionIndex=Ne[1],He.sections=W.sections,K.push(He)}}else K=function(Be,Ne){const He=[],st=Be.text;let Ke=0;for(const et of Ne)He.push(Be.substring(Ke,et)),Ke=et;return Ke<st.length&&He.push(Be.substring(Ke,st.length)),He}(W,u0(W,I,b,n,f,j));const he=[],fe={positionedLines:he,text:W.toString(),top:P[1],bottom:P[1],left:P[0],right:P[0],writingMode:O,iconsInText:!1,verticalizable:!1};return function(Be,Ne,He,st,Ke,et,_t,Qe,tt,ze,wt,Et){let mt=0,dt=0,zt=0,Mi=0;const ir=Qe==="right"?1:Qe==="left"?0:.5,Dr=dr/Et;let Zs=0;for(const Ti of Ke){Ti.trim();const fr=Ti.getMaxScale(),Ar={positionedGlyphs:[],lineOffset:0};Be.positionedLines[Zs]=Ar;const Er=Ar.positionedGlyphs;let ts=0;if(!Ti.length()){dt+=et,++Zs;continue}const Ks=X8(st,Ti,Dr);for(let hs=0;hs<Ti.length();hs++){const rr=Ti.getSection(hs),_r=Ti.getSectionIndex(hs),gr=Ti.getCharCode(hs),Ji=q8(tt,wt,gr);let gi;if(rr.imageName){if(Be.iconsInText=!0,rr.scale=rr.scale*Dr,gi=K8(rr,Ji,fr,Ks,st),!gi)continue;ts=Math.max(ts,gi.imageOffset)}else if(gi=Z8(rr,gr,Ji,Ks,Ne,He),!gi)continue;const{rect:kn,metrics:xh,baselineOffset:Nn}=gi;Er.push({glyph:gr,imageName:rr.imageName,x:mt,y:dt+Nn+-17,vertical:Ji,scale:rr.scale,fontStack:rr.fontStack,sectionIndex:_r,metrics:xh,rect:kn}),Ji?(Be.verticalizable=!0,mt+=(rr.imageName?xh.advance:dr)*rr.scale+ze):mt+=xh.advance*rr.scale+ze}Er.length!==0&&(zt=Math.max(mt-ze,zt),Y8(Er,0,Er.length-1,ir)),mt=0,Ar.lineOffset=Math.max(ts,(fr-1)*dr);const pr=et*fr+ts;dt+=pr,Mi=Math.max(pr,Mi),++Zs}const{horizontalAlign:cs,verticalAlign:Tr}=d0(_t);(function(Ti,fr,Ar,Er,ts,Ks,pr,hs,rr){const _r=(fr-Ar)*ts;let gr=0;gr=Ks!==pr?-hs*Er- -17:-Er*rr*pr+.5*pr;for(const Ji of Ti)for(const gi of Ji.positionedGlyphs)gi.x+=_r,gi.y+=gr})(Be.positionedLines,ir,cs,Tr,zt,Mi,et,dt,Ke.length),Be.top+=-Tr*dt,Be.bottom=Be.top+dt,Be.left+=-cs*zt,Be.right=Be.left+zt}(fe,n,l,f,K,v,T,E,O,I,z,H),!function(Be){for(const Ne of Be)if(Ne.positionedGlyphs.length!==0)return!1;return!0}(he)&&fe}const c_={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},G8={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},$8={40:!0};function qA(c,n,l,f,_,b){if(n.imageName){const v=f[n.imageName];return v?v.displaySize[0]*n.scale*dr/b+_:0}{const v=l[n.fontStack],T=v&&v[c];return T?T.metrics.advance*n.scale+_:0}}function ZA(c,n,l,f){const _=Math.pow(c-n,2);return f?c<n?_/2:2*_:_+Math.abs(l)*l}function W8(c,n,l){let f=0;return c===10&&(f-=1e4),l&&(f+=150),c!==40&&c!==65288||(f+=50),n!==41&&n!==65289||(f+=50),f}function KA(c,n,l,f,_,b){let v=null,T=ZA(n,l,_,b);for(const E of f){const I=ZA(n-E.x,l,_,b)+E.badness;I<=T&&(v=E,T=I)}return{index:c,x:n,priorBreak:v,badness:T}}function YA(c){return c?YA(c.priorBreak).concat(c.index):[]}function u0(c,n,l,f,_,b){if(!c)return[];const v=[],T=function(O,z,j,H,W,K){let ie=0;for(let me=0;me<O.length();me++){const he=O.getSection(me);ie+=qA(O.getCharCode(me),he,H,W,z,K)}return ie/Math.max(1,Math.ceil(ie/j))}(c,n,l,f,_,b),E=c.text.indexOf("")>=0;let I=0;for(let O=0;O<c.length();O++){const z=c.getSection(O),j=c.getCharCode(O);if(c_[j]||(I+=qA(j,z,f,_,n,b)),O<c.length()-1){const H=!((P=j)<11904)&&(!!Ut["CJK Compatibility Forms"](P)||!!Ut["CJK Compatibility"](P)||!!Ut["CJK Strokes"](P)||!!Ut["CJK Symbols and Punctuation"](P)||!!Ut["Enclosed CJK Letters and Months"](P)||!!Ut["Halfwidth and Fullwidth Forms"](P)||!!Ut["Ideographic Description Characters"](P)||!!Ut["Vertical Forms"](P)||Yu.test(String.fromCodePoint(P)));(G8[j]||H||z.imageName||O!==c.length()-2&&$8[c.getCharCode(O+1)])&&v.push(KA(O+1,I,T,v,W8(j,c.getCharCode(O+1),H&&E),!1))}}var P;return YA(KA(c.length(),I,T,v,0,!0))}function d0(c){let n=.5,l=.5;switch(c){case"right":case"top-right":case"bottom-right":n=1;break;case"left":case"top-left":case"bottom-left":n=0}switch(c){case"bottom":case"bottom-right":case"bottom-left":l=1;break;case"top":case"top-right":case"top-left":l=0}return{horizontalAlign:n,verticalAlign:l}}function X8(c,n,l){const f=n.getMaxScale()*dr,{maxImageWidth:_,maxImageHeight:b}=n.getMaxImageSize(c),v=Math.max(f,b*l);return{verticalLineContentWidth:Math.max(f,_*l),horizontalLineContentHeight:v}}function JA(c){switch(c){case"top":return 0;case"center":return .5;default:return 1}}function q8(c,n,l){return!(c===d.ao.horizontal||!n&&!Ju(l)||n&&(c_[l]||(f=l,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(f)))));var f}function Z8(c,n,l,f,_,b){const v=b[c.fontStack],T=function(I,P,O,z){if(I&&I.rect)return I;const j=P[O.fontStack],H=j&&j[z];return H?{rect:null,metrics:H.metrics}:null}(v&&v[n],_,c,n);if(T===null)return null;let E;if(l)E=f.verticalLineContentWidth-c.scale*dr;else{const I=JA(c.verticalAlign);E=(f.horizontalLineContentHeight-c.scale*dr)*I}return{rect:T.rect,metrics:T.metrics,baselineOffset:E}}function K8(c,n,l,f,_){const b=_[c.imageName];if(!b)return null;const v=b.paddedRect,T=b.displaySize,E={width:T[0],height:T[1],left:1,top:-3,advance:n?T[1]:T[0]};let I;if(n)I=f.verticalLineContentWidth-T[1]*c.scale;else{const P=JA(c.verticalAlign);I=(f.horizontalLineContentHeight-T[1]*c.scale)*P}return{rect:v,metrics:E,baselineOffset:I,imageOffset:(n?T[0]:T[1])*c.scale-dr*l}}function Y8(c,n,l,f){if(f===0)return;const _=c[l],b=(c[l].x+_.metrics.advance*_.scale)*f;for(let v=n;v<=l;v++)c[v].x-=b}function J8(c,n,l){const{horizontalAlign:f,verticalAlign:_}=d0(l),b=n[0]-c.displaySize[0]*f,v=n[1]-c.displaySize[1]*_;return{image:c,top:v,bottom:v+c.displaySize[1],left:b,right:b+c.displaySize[0]}}function QA(c){var n,l;let f=c.left,_=c.top,b=c.right-f,v=c.bottom-_;const T=(n=c.image.textFitWidth)!==null&&n!==void 0?n:"stretchOrShrink",E=(l=c.image.textFitHeight)!==null&&l!==void 0?l:"stretchOrShrink",I=(c.image.content[2]-c.image.content[0])/(c.image.content[3]-c.image.content[1]);if(E==="proportional"){if(T==="stretchOnly"&&b/v<I||T==="proportional"){const P=Math.ceil(v*I);f*=P/b,b=P}}else if(T==="proportional"&&E==="stretchOnly"&&I!==0&&b/v>I){const P=Math.ceil(b/I);_*=P/v,v=P}return{x1:f,y1:_,x2:f+b,y2:_+v}}function eE(c,n,l,f,_,b){const v=c.image;let T;if(v.content){const K=v.content,ie=v.pixelRatio||1;T=[K[0]/ie,K[1]/ie,v.displaySize[0]-K[2]/ie,v.displaySize[1]-K[3]/ie]}const E=n.left*b,I=n.right*b;let P,O,z,j;l==="width"||l==="both"?(j=_[0]+E-f[3],O=_[0]+I+f[1]):(j=_[0]+(E+I-v.displaySize[0])/2,O=j+v.displaySize[0]);const H=n.top*b,W=n.bottom*b;return l==="height"||l==="both"?(P=_[1]+H-f[0],z=_[1]+W+f[2]):(P=_[1]+(H+W-v.displaySize[1])/2,z=P+v.displaySize[1]),{image:v,top:P,right:O,bottom:z,left:j,collisionPadding:T}}const jo=128,Ba=32640;function tE(c,n){const{expression:l}=n;if(l.kind==="constant")return{kind:"constant",layoutSize:l.evaluate(new vi(c+1))};if(l.kind==="source")return{kind:"source"};{const{zoomStops:f,interpolationType:_}=l;let b=0;for(;b<f.length&&f[b]<=c;)b++;b=Math.max(0,b-1);let v=b;for(;v<f.length&&f[v]<c+1;)v++;v=Math.min(f.length-1,v);const T=f[b],E=f[v];return l.kind==="composite"?{kind:"composite",minZoom:T,maxZoom:E,interpolationType:_}:{kind:"camera",minZoom:T,maxZoom:E,minSize:l.evaluate(new vi(T)),maxSize:l.evaluate(new vi(E)),interpolationType:_}}}function f0(c,n,l){let f="never";const _=c.get(n);return _?f=_:c.get(l)&&(f="always"),f}const Q8=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function h_(c,n,l,f,_,b,v,T,E,I,P,O,z){const j=T?Math.min(Ba,Math.round(T[0])):0,H=T?Math.min(Ba,Math.round(T[1])):0;c.emplaceBack(n,l,Math.round(32*f),Math.round(32*_),b,v,(j<<1)+(E?1:0),H,16*I,16*P,256*O,256*z)}function p0(c,n,l){c.emplaceBack(n.x,n.y,l),c.emplaceBack(n.x,n.y,l),c.emplaceBack(n.x,n.y,l),c.emplaceBack(n.x,n.y,l)}function eV(c){for(const n of c.sections)if(Kp(n.text))return!0;return!1}class _0{constructor(n){this.layoutVertexArray=new Ye,this.indexArray=new si,this.programConfigurations=n,this.segments=new Pt,this.dynamicLayoutVertexArray=new je,this.opacityVertexArray=new ut,this.hasVisibleVertices=!1,this.placedSymbolArray=new G}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(n,l,f,_){this.isEmpty()||(f&&(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,C8.members),this.indexBuffer=n.createIndexBuffer(this.indexArray,l),this.dynamicLayoutVertexBuffer=n.createVertexBuffer(this.dynamicLayoutVertexArray,I8.members,!0),this.opacityVertexBuffer=n.createVertexBuffer(this.opacityVertexArray,Q8,!0),this.opacityVertexBuffer.itemSize=1),(f||_)&&this.programConfigurations.upload(n))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}ot("SymbolBuffers",_0);class g0{constructor(n,l,f){this.layoutVertexArray=new n,this.layoutAttributes=l,this.indexArray=new f,this.segments=new Pt,this.collisionVertexArray=new qt}upload(n){this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=n.createVertexBuffer(this.collisionVertexArray,M8.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}ot("CollisionBuffers",g0);class yh{constructor(n){this.collisionBoxArray=n.collisionBoxArray,this.zoom=n.zoom,this.globalState=n.globalState,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(v=>v.id),this.index=n.index,this.pixelRatio=n.pixelRatio,this.sourceLayerIndex=n.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];const l=this.layers[0]._unevaluatedLayout._values;this.textSizeData=tE(this.zoom,l["text-size"]),this.iconSizeData=tE(this.zoom,l["icon-size"]);const f=this.layers[0].layout,_=f.get("symbol-sort-key"),b=f.get("symbol-z-order");this.canOverlap=f0(f,"text-overlap","text-allow-overlap")!=="never"||f0(f,"icon-overlap","icon-allow-overlap")!=="never"||f.get("text-ignore-placement")||f.get("icon-ignore-placement"),this.sortFeaturesByKey=b!=="viewport-y"&&!_.isConstant(),this.sortFeaturesByY=(b==="viewport-y"||b==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,f.get("symbol-placement")==="point"&&(this.writingModes=f.get("text-writing-mode").map(v=>d.ao[v])),this.stateDependentLayerIds=this.layers.filter(v=>v.isStateDependent()).map(v=>v.id),this.sourceID=n.sourceID}createArrays(){this.text=new _0(new as(this.layers,this.zoom,n=>/^text/.test(n))),this.icon=new _0(new as(this.layers,this.zoom,n=>/^icon/.test(n))),this.glyphOffsetArray=new Q,this.lineVertexArray=new se,this.symbolInstances=new Y,this.textAnchorOffsets=new ae}calculateGlyphDependencies(n,l,f,_,b){for(let v=0;v<n.length;v++)if(l[n.charCodeAt(v)]=!0,(f||_)&&b){const T=yd[n.charAt(v)];T&&(l[T.charCodeAt(0)]=!0)}}populate(n,l,f){const _=this.layers[0],b=_.layout,v=b.get("text-font"),T=b.get("text-field"),E=b.get("icon-image"),I=(T.value.kind!=="constant"||T.value.value instanceof Ur&&!T.value.value.isEmpty()||T.value.value.toString().length>0)&&(v.value.kind!=="constant"||v.value.value.length>0),P=E.value.kind!=="constant"||!!E.value.value||Object.keys(E.parameters).length>0,O=b.get("symbol-sort-key");if(this.features=[],!I&&!P)return;const z=l.iconDependencies,j=l.glyphDependencies,H=l.availableImages,W=new vi(this.zoom,{globalState:this.globalState});for(const{feature:K,id:ie,index:me,sourceLayerIndex:he}of n){const fe=_._featureFilter.needGeometry,Be=Fn(K,fe);if(!_._featureFilter.filter(W,Be,f))continue;let Ne,He;if(fe||(Be.geometry=uo(K)),I){const Ke=_.getValueAndResolveTokens("text-field",Be,f,H),et=Ur.factory(Ke),_t=this.hasRTLText=this.hasRTLText||eV(et);(!_t||Gs.getRTLTextPluginStatus()==="unavailable"||_t&&Gs.isParsed())&&(Ne=P8(et,_,Be))}if(P){const Ke=_.getValueAndResolveTokens("icon-image",Be,f,H);He=Ke instanceof ns?Ke:ns.fromString(Ke)}if(!Ne&&!He)continue;const st=this.sortFeaturesByKey?O.evaluate(Be,{},f):void 0;if(this.features.push({id:ie,text:Ne,icon:He,index:me,sourceLayerIndex:he,geometry:Be.geometry,properties:K.properties,type:_h.types[K.type],sortKey:st}),He&&(z[He.name]=!0),Ne){const Ke=v.evaluate(Be,{},f).join(","),et=b.get("text-rotation-alignment")!=="viewport"&&b.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(d.ao.vertical)>=0;for(const _t of Ne.sections)if(_t.image)z[_t.image.name]=!0;else{const Qe=th(Ne.toString()),tt=_t.fontStack||Ke,ze=j[tt]=j[tt]||{};this.calculateGlyphDependencies(_t.text,ze,et,this.allowVerticalPlacement,Qe)}}}b.get("symbol-placement")==="line"&&(this.features=function(K){const ie={},me={},he=[];let fe=0;function Be(Ke){he.push(K[Ke]),fe++}function Ne(Ke,et,_t){const Qe=me[Ke];return delete me[Ke],me[et]=Qe,he[Qe].geometry[0].pop(),he[Qe].geometry[0]=he[Qe].geometry[0].concat(_t[0]),Qe}function He(Ke,et,_t){const Qe=ie[et];return delete ie[et],ie[Ke]=Qe,he[Qe].geometry[0].shift(),he[Qe].geometry[0]=_t[0].concat(he[Qe].geometry[0]),Qe}function st(Ke,et,_t){const Qe=_t?et[0][et[0].length-1]:et[0][0];return`${Ke}:${Qe.x}:${Qe.y}`}for(let Ke=0;Ke<K.length;Ke++){const et=K[Ke],_t=et.geometry,Qe=et.text?et.text.toString():null;if(!Qe){Be(Ke);continue}const tt=st(Qe,_t),ze=st(Qe,_t,!0);if(tt in me&&ze in ie&&me[tt]!==ie[ze]){const wt=He(tt,ze,_t),Et=Ne(tt,ze,he[wt].geometry);delete ie[tt],delete me[ze],me[st(Qe,he[Et].geometry,!0)]=Et,he[wt].geometry=null}else tt in me?Ne(tt,ze,_t):ze in ie?He(tt,ze,_t):(Be(Ke),ie[tt]=fe-1,me[ze]=fe-1)}return he.filter(Ke=>Ke.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((K,ie)=>K.sortKey-ie.sortKey)}update(n,l,f){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(n,l,this.layers,f),this.icon.programConfigurations.updatePaintArrays(n,l,this.layers,f))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(n){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(n),this.iconCollisionBox.upload(n)),this.text.upload(n,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(n,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(n,l){const f=this.lineVertexArray.length;if(n.segment!==void 0){let _=n.dist(l[n.segment+1]),b=n.dist(l[n.segment]);const v={};for(let T=n.segment+1;T<l.length;T++)v[T]={x:l[T].x,y:l[T].y,tileUnitDistanceFromAnchor:_},T<l.length-1&&(_+=l[T+1].dist(l[T]));for(let T=n.segment||0;T>=0;T--)v[T]={x:l[T].x,y:l[T].y,tileUnitDistanceFromAnchor:b},T>0&&(b+=l[T-1].dist(l[T]));for(let T=0;T<l.length;T++){const E=v[T];this.lineVertexArray.emplaceBack(E.x,E.y,E.tileUnitDistanceFromAnchor)}}return{lineStartIndex:f,lineLength:this.lineVertexArray.length-f}}addSymbols(n,l,f,_,b,v,T,E,I,P,O,z){const j=n.indexArray,H=n.layoutVertexArray,W=n.segments.prepareSegment(4*l.length,H,j,this.canOverlap?v.sortKey:void 0),K=this.glyphOffsetArray.length,ie=W.vertexLength,me=this.allowVerticalPlacement&&T===d.ao.vertical?Math.PI/2:0,he=v.text&&v.text.sections;for(let fe=0;fe<l.length;fe++){const{tl:Be,tr:Ne,bl:He,br:st,tex:Ke,pixelOffsetTL:et,pixelOffsetBR:_t,minFontScaleX:Qe,minFontScaleY:tt,glyphOffset:ze,isSDF:wt,sectionIndex:Et}=l[fe],mt=W.vertexLength,dt=ze[1];h_(H,E.x,E.y,Be.x,dt+Be.y,Ke.x,Ke.y,f,wt,et.x,et.y,Qe,tt),h_(H,E.x,E.y,Ne.x,dt+Ne.y,Ke.x+Ke.w,Ke.y,f,wt,_t.x,et.y,Qe,tt),h_(H,E.x,E.y,He.x,dt+He.y,Ke.x,Ke.y+Ke.h,f,wt,et.x,_t.y,Qe,tt),h_(H,E.x,E.y,st.x,dt+st.y,Ke.x+Ke.w,Ke.y+Ke.h,f,wt,_t.x,_t.y,Qe,tt),p0(n.dynamicLayoutVertexArray,E,me),j.emplaceBack(mt,mt+2,mt+1),j.emplaceBack(mt+1,mt+2,mt+3),W.vertexLength+=4,W.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(ze[0]),fe!==l.length-1&&Et===l[fe+1].sectionIndex||n.programConfigurations.populatePaintArrays(H.length,v,v.index,{},z,he&&he[Et])}n.placedSymbolArray.emplaceBack(E.x,E.y,K,this.glyphOffsetArray.length-K,ie,I,P,E.segment,f?f[0]:0,f?f[1]:0,_[0],_[1],T,0,!1,0,O)}_addCollisionDebugVertex(n,l,f,_,b,v){return l.emplaceBack(0,0),n.emplaceBack(f.x,f.y,_,b,Math.round(v.x),Math.round(v.y))}addCollisionDebugVertices(n,l,f,_,b,v,T){const E=b.segments.prepareSegment(4,b.layoutVertexArray,b.indexArray),I=E.vertexLength,P=b.layoutVertexArray,O=b.collisionVertexArray,z=T.anchorX,j=T.anchorY;this._addCollisionDebugVertex(P,O,v,z,j,new x(n,l)),this._addCollisionDebugVertex(P,O,v,z,j,new x(f,l)),this._addCollisionDebugVertex(P,O,v,z,j,new x(f,_)),this._addCollisionDebugVertex(P,O,v,z,j,new x(n,_)),E.vertexLength+=4;const H=b.indexArray;H.emplaceBack(I,I+1),H.emplaceBack(I+1,I+2),H.emplaceBack(I+2,I+3),H.emplaceBack(I+3,I),E.primitiveLength+=4}addDebugCollisionBoxes(n,l,f,_){for(let b=n;b<l;b++){const v=this.collisionBoxArray.get(b);this.addCollisionDebugVertices(v.x1,v.y1,v.x2,v.y2,_?this.textCollisionBox:this.iconCollisionBox,v.anchorPoint,f)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new g0(Dt,jA.members,ei),this.iconCollisionBox=new g0(Dt,jA.members,ei);for(let n=0;n<this.symbolInstances.length;n++){const l=this.symbolInstances.get(n);this.addDebugCollisionBoxes(l.textBoxStartIndex,l.textBoxEndIndex,l,!0),this.addDebugCollisionBoxes(l.verticalTextBoxStartIndex,l.verticalTextBoxEndIndex,l,!0),this.addDebugCollisionBoxes(l.iconBoxStartIndex,l.iconBoxEndIndex,l,!1),this.addDebugCollisionBoxes(l.verticalIconBoxStartIndex,l.verticalIconBoxEndIndex,l,!1)}}_deserializeCollisionBoxesForSymbol(n,l,f,_,b,v,T,E,I){const P={};for(let O=l;O<f;O++){const z=n.get(O);P.textBox={x1:z.x1,y1:z.y1,x2:z.x2,y2:z.y2,anchorPointX:z.anchorPointX,anchorPointY:z.anchorPointY},P.textFeatureIndex=z.featureIndex;break}for(let O=_;O<b;O++){const z=n.get(O);P.verticalTextBox={x1:z.x1,y1:z.y1,x2:z.x2,y2:z.y2,anchorPointX:z.anchorPointX,anchorPointY:z.anchorPointY},P.verticalTextFeatureIndex=z.featureIndex;break}for(let O=v;O<T;O++){const z=n.get(O);P.iconBox={x1:z.x1,y1:z.y1,x2:z.x2,y2:z.y2,anchorPointX:z.anchorPointX,anchorPointY:z.anchorPointY},P.iconFeatureIndex=z.featureIndex;break}for(let O=E;O<I;O++){const z=n.get(O);P.verticalIconBox={x1:z.x1,y1:z.y1,x2:z.x2,y2:z.y2,anchorPointX:z.anchorPointX,anchorPointY:z.anchorPointY},P.verticalIconFeatureIndex=z.featureIndex;break}return P}deserializeCollisionBoxes(n){this.collisionArrays=[];for(let l=0;l<this.symbolInstances.length;l++){const f=this.symbolInstances.get(l);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(n,f.textBoxStartIndex,f.textBoxEndIndex,f.verticalTextBoxStartIndex,f.verticalTextBoxEndIndex,f.iconBoxStartIndex,f.iconBoxEndIndex,f.verticalIconBoxStartIndex,f.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(n,l){const f=n.placedSymbolArray.get(l),_=f.vertexStartIndex+4*f.numGlyphs;for(let b=f.vertexStartIndex;b<_;b+=4)n.indexArray.emplaceBack(b,b+2,b+1),n.indexArray.emplaceBack(b+1,b+2,b+3)}getSortedSymbolIndexes(n){if(this.sortedAngle===n&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const l=Math.sin(n),f=Math.cos(n),_=[],b=[],v=[];for(let T=0;T<this.symbolInstances.length;++T){v.push(T);const E=this.symbolInstances.get(T);_.push(0|Math.round(l*E.anchorX+f*E.anchorY)),b.push(E.featureIndex)}return v.sort((T,E)=>_[T]-_[E]||b[E]-b[T]),v}addToSortKeyRanges(n,l){const f=this.sortKeyRanges[this.sortKeyRanges.length-1];f&&f.sortKey===l?f.symbolInstanceEnd=n+1:this.sortKeyRanges.push({sortKey:l,symbolInstanceStart:n,symbolInstanceEnd:n+1})}sortFeatures(n){if(this.sortFeaturesByY&&this.sortedAngle!==n&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(n),this.sortedAngle=n,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const l of this.symbolInstanceIndexes){const f=this.symbolInstances.get(l);this.featureSortOrder.push(f.featureIndex),[f.rightJustifiedTextSymbolIndex,f.centerJustifiedTextSymbolIndex,f.leftJustifiedTextSymbolIndex].forEach((_,b,v)=>{_>=0&&v.indexOf(_)===b&&this.addIndicesForPlacedSymbol(this.text,_)}),f.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,f.verticalPlacedTextSymbolIndex),f.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,f.placedIconSymbolIndex),f.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,f.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let iE,rE;ot("SymbolBucket",yh,{omit:["layers","collisionBoxArray","features","compareText"]}),yh.MAX_GLYPHS=65535,yh.addDynamicAttributes=p0;var m0={get paint(){return rE=rE||new jr({"icon-opacity":new vt(we.paint_symbol["icon-opacity"]),"icon-color":new vt(we.paint_symbol["icon-color"]),"icon-halo-color":new vt(we.paint_symbol["icon-halo-color"]),"icon-halo-width":new vt(we.paint_symbol["icon-halo-width"]),"icon-halo-blur":new vt(we.paint_symbol["icon-halo-blur"]),"icon-translate":new ft(we.paint_symbol["icon-translate"]),"icon-translate-anchor":new ft(we.paint_symbol["icon-translate-anchor"]),"text-opacity":new vt(we.paint_symbol["text-opacity"]),"text-color":new vt(we.paint_symbol["text-color"],{runtimeType:Xi,getOverride:c=>c.textColor,hasOverride:c=>!!c.textColor}),"text-halo-color":new vt(we.paint_symbol["text-halo-color"]),"text-halo-width":new vt(we.paint_symbol["text-halo-width"]),"text-halo-blur":new vt(we.paint_symbol["text-halo-blur"]),"text-translate":new ft(we.paint_symbol["text-translate"]),"text-translate-anchor":new ft(we.paint_symbol["text-translate-anchor"])})},get layout(){return iE=iE||new jr({"symbol-placement":new ft(we.layout_symbol["symbol-placement"]),"symbol-spacing":new ft(we.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new ft(we.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new vt(we.layout_symbol["symbol-sort-key"]),"symbol-z-order":new ft(we.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new ft(we.layout_symbol["icon-allow-overlap"]),"icon-overlap":new ft(we.layout_symbol["icon-overlap"]),"icon-ignore-placement":new ft(we.layout_symbol["icon-ignore-placement"]),"icon-optional":new ft(we.layout_symbol["icon-optional"]),"icon-rotation-alignment":new ft(we.layout_symbol["icon-rotation-alignment"]),"icon-size":new vt(we.layout_symbol["icon-size"]),"icon-text-fit":new ft(we.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new ft(we.layout_symbol["icon-text-fit-padding"]),"icon-image":new vt(we.layout_symbol["icon-image"]),"icon-rotate":new vt(we.layout_symbol["icon-rotate"]),"icon-padding":new vt(we.layout_symbol["icon-padding"]),"icon-keep-upright":new ft(we.layout_symbol["icon-keep-upright"]),"icon-offset":new vt(we.layout_symbol["icon-offset"]),"icon-anchor":new vt(we.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new ft(we.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new ft(we.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new ft(we.layout_symbol["text-rotation-alignment"]),"text-field":new vt(we.layout_symbol["text-field"]),"text-font":new vt(we.layout_symbol["text-font"]),"text-size":new vt(we.layout_symbol["text-size"]),"text-max-width":new vt(we.layout_symbol["text-max-width"]),"text-line-height":new ft(we.layout_symbol["text-line-height"]),"text-letter-spacing":new vt(we.layout_symbol["text-letter-spacing"]),"text-justify":new vt(we.layout_symbol["text-justify"]),"text-radial-offset":new vt(we.layout_symbol["text-radial-offset"]),"text-variable-anchor":new ft(we.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new vt(we.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new vt(we.layout_symbol["text-anchor"]),"text-max-angle":new ft(we.layout_symbol["text-max-angle"]),"text-writing-mode":new ft(we.layout_symbol["text-writing-mode"]),"text-rotate":new vt(we.layout_symbol["text-rotate"]),"text-padding":new ft(we.layout_symbol["text-padding"]),"text-keep-upright":new ft(we.layout_symbol["text-keep-upright"]),"text-transform":new vt(we.layout_symbol["text-transform"]),"text-offset":new vt(we.layout_symbol["text-offset"]),"text-allow-overlap":new ft(we.layout_symbol["text-allow-overlap"]),"text-overlap":new ft(we.layout_symbol["text-overlap"]),"text-ignore-placement":new ft(we.layout_symbol["text-ignore-placement"]),"text-optional":new ft(we.layout_symbol["text-optional"])})}};class sE{constructor(n){if(n.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=n.property.overrides?n.property.overrides.runtimeType:eo,this.defaultValue=n}evaluate(n){if(n.formattedSection){const l=this.defaultValue.property.overrides;if(l&&l.hasOverride(n.formattedSection))return l.getOverride(n.formattedSection)}return n.feature&&n.featureState?this.defaultValue.evaluate(n.feature,n.featureState):this.defaultValue.property.specification.default}eachChild(n){this.defaultValue.isConstant()||n(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}ot("FormatSectionOverride",sE,{omit:["defaultValue"]});class u_ extends ws{constructor(n){super(n,m0)}recalculate(n,l){if(super.recalculate(n,l),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const f=this.layout.get("text-writing-mode");if(f){const _=[];for(const b of f)_.indexOf(b)<0&&_.push(b);this.layout._values["text-writing-mode"]=_}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(n,l,f,_){const b=this.layout.get(n).evaluate(l,{},f,_),v=this._unevaluatedLayout._values[n];return v.isDataDriven()||Xc(v.value)||!b?b:function(T,E){return E.replace(/{([^{}]+)}/g,(I,P)=>T&&P in T?String(T[P]):"")}(l.properties,b)}createBucket(n){return new yh(n)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const n of m0.paint.overridableProperties){if(!u_.hasPaintOverride(this.layout,n))continue;const l=this.paint.get(n),f=new sE(l),_=new Uu(f,l.property.specification);let b=null;b=l.value.kind==="constant"||l.value.kind==="source"?new Tl("source",_):new zu("composite",_,l.value.zoomStops),this.paint._values[n]=new gn(l.property,b,l.parameters)}}_handleOverridablePaintPropertyUpdate(n,l,f){return!(!this.layout||l.isDataDriven()||f.isDataDriven())&&u_.hasPaintOverride(this.layout,n)}static hasPaintOverride(n,l){const f=n.get("text-field"),_=m0.paint.properties[l];let b=!1;const v=T=>{for(const E of T)if(_.overrides&&_.overrides.hasOverride(E))return void(b=!0)};if(f.value.kind==="constant"&&f.value.value instanceof Ur)v(f.value.value.sections);else if(f.value.kind==="source"){const T=I=>{b||(I instanceof Pn&&xt(I.value)===ss?v(I.value.sections):I instanceof Io?v(I.sections):I.eachChild(T))},E=f.value;E._styleExpression&&T(E._styleExpression.expression)}return b}}let nE;var tV={get paint(){return nE=nE||new jr({"background-color":new ft(we.paint_background["background-color"]),"background-pattern":new oo(we.paint_background["background-pattern"]),"background-opacity":new ft(we.paint_background["background-opacity"])})}};class iV extends ws{constructor(n){super(n,tV)}}let oE;var rV={get paint(){return oE=oE||new jr({"raster-opacity":new ft(we.paint_raster["raster-opacity"]),"raster-hue-rotate":new ft(we.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new ft(we.paint_raster["raster-brightness-min"]),"raster-brightness-max":new ft(we.paint_raster["raster-brightness-max"]),"raster-saturation":new ft(we.paint_raster["raster-saturation"]),"raster-contrast":new ft(we.paint_raster["raster-contrast"]),"raster-resampling":new ft(we.paint_raster["raster-resampling"]),"raster-fade-duration":new ft(we.paint_raster["raster-fade-duration"])})}};class sV extends ws{constructor(n){super(n,rV)}}class nV extends ws{constructor(n){super(n,{}),this.onAdd=l=>{this.implementation.onAdd&&this.implementation.onAdd(l,l.painter.context.gl)},this.onRemove=l=>{this.implementation.onRemove&&this.implementation.onRemove(l,l.painter.context.gl)},this.implementation=n}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class oV{constructor(n){this._methodToThrottle=n,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const aV={once:!0},y0=63710088e-1;class Da{constructor(n,l){if(isNaN(n)||isNaN(l))throw new Error(`Invalid LngLat object: (${n}, ${l})`);if(this.lng=+n,this.lat=+l,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Da(Pi(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(n){const l=Math.PI/180,f=this.lat*l,_=n.lat*l,b=Math.sin(f)*Math.sin(_)+Math.cos(f)*Math.cos(_)*Math.cos((n.lng-this.lng)*l);return y0*Math.acos(Math.min(b,1))}static convert(n){if(n instanceof Da)return n;if(Array.isArray(n)&&(n.length===2||n.length===3))return new Da(Number(n[0]),Number(n[1]));if(!Array.isArray(n)&&typeof n=="object"&&n!==null)return new Da(Number("lng"in n?n.lng:n.lon),Number(n.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const aE=2*Math.PI*y0;function lE(c){return aE*Math.cos(c*Math.PI/180)}function cE(c){return(180+c)/360}function hE(c){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+c*Math.PI/360)))/360}function uE(c,n){return c/lE(n)}function b0(c){return 360/Math.PI*Math.atan(Math.exp((180-360*c)*Math.PI/180))-90}function dE(c,n){return c*lE(b0(n))}class vd{constructor(n,l,f=0){this.x=+n,this.y=+l,this.z=+f}static fromLngLat(n,l=0){const f=Da.convert(n);return new vd(cE(f.lng),hE(f.lat),uE(l,f.lat))}toLngLat(){return new Da(360*this.x-180,b0(this.y))}toAltitude(){return dE(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/aE*(n=b0(this.y),1/Math.cos(n*Math.PI/180));var n}}function fE(c,n,l){var f=2*Math.PI*6378137/256/Math.pow(2,l);return[c*f-2*Math.PI*6378137/2,n*f-2*Math.PI*6378137/2]}class v0{constructor(n,l,f){if(!function(_,b,v){return!(_<0||_>25||v<0||v>=Math.pow(2,_)||b<0||b>=Math.pow(2,_))}(n,l,f))throw new Error(`x=${l}, y=${f}, z=${n} outside of bounds. 0<=x<${Math.pow(2,n)}, 0<=y<${Math.pow(2,n)} 0<=z<=25 `);this.z=n,this.x=l,this.y=f,this.key=bh(0,n,n,l,f)}equals(n){return this.z===n.z&&this.x===n.x&&this.y===n.y}url(n,l,f){const _=(v=this.y,T=this.z,E=fE(256*(b=this.x),256*(v=Math.pow(2,T)-v-1),T),I=fE(256*(b+1),256*(v+1),T),E[0]+","+E[1]+","+I[0]+","+I[1]);var b,v,T,E,I;const P=function(O,z,j){let H,W="";for(let K=O;K>0;K--)H=1<<K-1,W+=(z&H?1:0)+(j&H?2:0);return W}(this.z,this.x,this.y);return n[(this.x+this.y)%n.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(f==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,l>1?"@2x":"").replace(/{quadkey}/g,P).replace(/{bbox-epsg-3857}/g,_)}isChildOf(n){const l=this.z-n.z;return l>0&&n.x===this.x>>l&&n.y===this.y>>l}getTilePoint(n){const l=Math.pow(2,this.z);return new x((n.x*l-this.x)*Gt,(n.y*l-this.y)*Gt)}toString(){return`${this.z}/${this.x}/${this.y}`}}class pE{constructor(n,l){this.wrap=n,this.canonical=l,this.key=bh(n,l.z,l.z,l.x,l.y)}}class qs{constructor(n,l,f,_,b){if(this.terrainRttPosMatrix32f=null,n<f)throw new Error(`overscaledZ should be >= z; overscaledZ = ${n}; z = ${f}`);this.overscaledZ=n,this.wrap=l,this.canonical=new v0(f,+_,+b),this.key=bh(l,n,f,_,b)}clone(){return new qs(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(n){return this.overscaledZ===n.overscaledZ&&this.wrap===n.wrap&&this.canonical.equals(n.canonical)}scaledTo(n){if(n>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${n}; overscaledZ = ${this.overscaledZ}`);const l=this.canonical.z-n;return n>this.canonical.z?new qs(n,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new qs(n,this.wrap,n,this.canonical.x>>l,this.canonical.y>>l)}calculateScaledKey(n,l){if(n>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${n}; overscaledZ = ${this.overscaledZ}`);const f=this.canonical.z-n;return n>this.canonical.z?bh(this.wrap*+l,n,this.canonical.z,this.canonical.x,this.canonical.y):bh(this.wrap*+l,n,n,this.canonical.x>>f,this.canonical.y>>f)}isChildOf(n){if(n.wrap!==this.wrap)return!1;const l=this.canonical.z-n.canonical.z;return n.overscaledZ===0||n.overscaledZ<this.overscaledZ&&n.canonical.x===this.canonical.x>>l&&n.canonical.y===this.canonical.y>>l}children(n){if(this.overscaledZ>=n)return[new qs(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const l=this.canonical.z+1,f=2*this.canonical.x,_=2*this.canonical.y;return[new qs(l,this.wrap,l,f,_),new qs(l,this.wrap,l,f+1,_),new qs(l,this.wrap,l,f,_+1),new qs(l,this.wrap,l,f+1,_+1)]}isLessThan(n){return this.wrap<n.wrap||!(this.wrap>n.wrap)&&(this.overscaledZ<n.overscaledZ||!(this.overscaledZ>n.overscaledZ)&&(this.canonical.x<n.canonical.x||!(this.canonical.x>n.canonical.x)&&this.canonical.y<n.canonical.y))}wrapped(){return new qs(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(n){return new qs(this.overscaledZ,n,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new pE(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(n){return this.canonical.getTilePoint(new vd(n.x-this.wrap,n.y))}}function bh(c,n,l,f,_){(c*=2)<0&&(c=-1*c-1);const b=1<<l;return(b*b*c+b*_+f).toString(36)+l.toString(36)+n.toString(36)}function xd(c,n){return n?c.properties[n]:c.id}ot("CanonicalTileID",v0),ot("OverscaledTileID",qs,{omit:["terrainRttPosMatrix32f"]});class kl{constructor(){this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0}extend(n){return this.minX=Math.min(this.minX,n.x),this.minY=Math.min(this.minY,n.y),this.maxX=Math.max(this.maxX,n.x),this.maxY=Math.max(this.maxY,n.y),this}expandBy(n){return this.minX-=n,this.minY-=n,this.maxX+=n,this.maxY+=n,(this.minX>this.maxX||this.minY>this.maxY)&&(this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0),this}shrinkBy(n){return this.expandBy(-n)}map(n){const l=new kl;return l.extend(n(new x(this.minX,this.minY))),l.extend(n(new x(this.maxX,this.minY))),l.extend(n(new x(this.minX,this.maxY))),l.extend(n(new x(this.maxX,this.maxY))),l}static fromPoints(n){const l=new kl;for(const f of n)l.extend(f);return l}contains(n){return n.x>=this.minX&&n.x<=this.maxX&&n.y>=this.minY&&n.y<=this.maxY}empty(){return this.minX>this.maxX}width(){return this.maxX-this.minX}height(){return this.maxY-this.minY}covers(n){return!this.empty()&&!n.empty()&&n.minX>=this.minX&&n.maxX<=this.maxX&&n.minY>=this.minY&&n.maxY<=this.maxY}intersects(n){return!this.empty()&&!n.empty()&&n.minX<=this.maxX&&n.maxX>=this.minX&&n.minY<=this.maxY&&n.maxY>=this.minY}}class _E{constructor(n){this._stringToNumber={},this._numberToString=[];for(let l=0;l<n.length;l++){const f=n[l];this._stringToNumber[f]=l,this._numberToString[l]=f}}encode(n){return this._stringToNumber[n]}decode(n){if(n>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${n} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[n]}}class gE{constructor(n,l,f,_,b){this.type="Feature",this._vectorTileFeature=n,n._z=l,n._x=f,n._y=_,this.properties=n.properties,this.id=b}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(n){this._geometry=n}toJSON(){const n={geometry:this.geometry};for(const l in this)l!=="_geometry"&&l!=="_vectorTileFeature"&&(n[l]=this[l]);return n}}class mE{constructor(n,l){this.tileID=n,this.x=n.canonical.x,this.y=n.canonical.y,this.z=n.canonical.z,this.grid=new Rl(Gt,16,0),this.grid3D=new Rl(Gt,16,0),this.featureIndexArray=new _e,this.promoteId=l}insert(n,l,f,_,b,v){const T=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(f,_,b);const E=v?this.grid3D:this.grid;for(let I=0;I<l.length;I++){const P=l[I],O=[1/0,1/0,-1/0,-1/0];for(let z=0;z<P.length;z++){const j=P[z];O[0]=Math.min(O[0],j.x),O[1]=Math.min(O[1],j.y),O[2]=Math.max(O[2],j.x),O[3]=Math.max(O[3],j.y)}O[0]<Gt&&O[1]<Gt&&O[2]>=0&&O[3]>=0&&E.insert(T,O[0],O[1],O[2],O[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new DA(new c0(this.rawTileData)).layers,this.sourceLayerCoder=new _E(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(n,l,f,_){this.loadVTLayers();const b=n.params,v=Gt/n.tileSize/n.scale,T=Oo(b.filter),E=n.queryGeometry,I=n.queryPadding*v,P=kl.fromPoints(E),O=this.grid.query(P.minX-I,P.minY-I,P.maxX+I,P.maxY+I),z=kl.fromPoints(n.cameraQueryGeometry).expandBy(I),j=this.grid3D.query(z.minX,z.minY,z.maxX,z.maxY,(K,ie,me,he)=>function(fe,Be,Ne,He,st){for(const et of fe)if(Be<=et.x&&Ne<=et.y&&He>=et.x&&st>=et.y)return!0;const Ke=[new x(Be,Ne),new x(Be,st),new x(He,st),new x(He,Ne)];if(fe.length>2){for(const et of Ke)if(uh(fe,et))return!0}for(let et=0;et<fe.length-1;et++)if(U5(fe[et],fe[et+1],Ke))return!0;return!1}(n.cameraQueryGeometry,K-I,ie-I,me+I,he+I));for(const K of j)O.push(K);O.sort(lV);const H={};let W;for(let K=0;K<O.length;K++){const ie=O[K];if(ie===W)continue;W=ie;const me=this.featureIndexArray.get(ie);let he=null;this.loadMatchingFeature(H,me.bucketIndex,me.sourceLayerIndex,me.featureIndex,T,b.layers,b.availableImages,l,f,_,(fe,Be,Ne)=>(he||(he=uo(fe)),Be.queryIntersectsFeature({queryGeometry:E,feature:fe,featureState:Ne,geometry:he,zoom:this.z,transform:n.transform,pixelsToTileUnits:v,pixelPosMatrix:n.pixelPosMatrix,unwrappedTileID:this.tileID.toUnwrapped(),getElevation:n.getElevation})))}return H}loadMatchingFeature(n,l,f,_,b,v,T,E,I,P,O){const z=this.bucketLayerIDs[l];if(v&&!z.some(K=>v.has(K)))return;const j=this.sourceLayerCoder.decode(f),H=this.vtLayers[j].feature(_);if(b.needGeometry){const K=Fn(H,!0);if(!b.filter(new vi(this.tileID.overscaledZ),K,this.tileID.canonical))return}else if(!b.filter(new vi(this.tileID.overscaledZ),H))return;const W=this.getId(H,j);for(let K=0;K<z.length;K++){const ie=z[K];if(v&&!v.has(ie))continue;const me=E[ie];if(!me)continue;let he={};W&&P&&(he=P.getState(me.sourceLayer||"_geojsonTileLayer",W));const fe=$i({},I[ie]);fe.paint=yE(fe.paint,me.paint,H,he,T),fe.layout=yE(fe.layout,me.layout,H,he,T);const Be=!O||O(H,me,he);if(!Be)continue;const Ne=new gE(H,this.z,this.x,this.y,W);Ne.layer=fe;let He=n[ie];He===void 0&&(He=n[ie]=[]),He.push({featureIndex:_,feature:Ne,intersectionZ:Be})}}lookupSymbolFeatures(n,l,f,_,b,v,T,E){const I={};this.loadVTLayers();const P=Oo(b);for(const O of n)this.loadMatchingFeature(I,f,_,O,P,v,T,E,l);return I}hasLayer(n){for(const l of this.bucketLayerIDs)for(const f of l)if(n===f)return!0;return!1}getId(n,l){var f;let _=n.id;return this.promoteId&&(_=n.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[l]],typeof _=="boolean"&&(_=Number(_)),_===void 0&&(!((f=n.properties)===null||f===void 0)&&f.cluster)&&this.promoteId&&(_=Number(n.properties.cluster_id))),_}}function yE(c,n,l,f,_){return ki(c,(b,v)=>{const T=n instanceof rh?n.get(v):null;return T&&T.evaluate?T.evaluate(l,f,_):T})}function lV(c,n){return n-c}function bE(c,n,l,f,_){const b=[];for(let v=0;v<c.length;v++){const T=c[v];let E;for(let I=0;I<T.length-1;I++){let P=T[I],O=T[I+1];P.x<n&&O.x<n||(P.x<n?P=new x(n,P.y+(n-P.x)/(O.x-P.x)*(O.y-P.y))._round():O.x<n&&(O=new x(n,P.y+(n-P.x)/(O.x-P.x)*(O.y-P.y))._round()),P.y<l&&O.y<l||(P.y<l?P=new x(P.x+(l-P.y)/(O.y-P.y)*(O.x-P.x),l)._round():O.y<l&&(O=new x(P.x+(l-P.y)/(O.y-P.y)*(O.x-P.x),l)._round()),P.x>=f&&O.x>=f||(P.x>=f?P=new x(f,P.y+(f-P.x)/(O.x-P.x)*(O.y-P.y))._round():O.x>=f&&(O=new x(f,P.y+(f-P.x)/(O.x-P.x)*(O.y-P.y))._round()),P.y>=_&&O.y>=_||(P.y>=_?P=new x(P.x+(_-P.y)/(O.y-P.y)*(O.x-P.x),_)._round():O.y>=_&&(O=new x(P.x+(_-P.y)/(O.y-P.y)*(O.x-P.x),_)._round()),E&&P.equals(E[E.length-1])||(E=[P],b.push(E)),E.push(O)))))}}return b}ot("FeatureIndex",mE,{omit:["rawTileData","sourceLayerCoder"]});class Oa extends x{constructor(n,l,f,_){super(n,l),this.angle=f,_!==void 0&&(this.segment=_)}clone(){return new Oa(this.x,this.y,this.angle,this.segment)}}function vE(c,n,l,f,_){if(n.segment===void 0||l===0)return!0;let b=n,v=n.segment+1,T=0;for(;T>-l/2;){if(v--,v<0)return!1;T-=c[v].dist(b),b=c[v]}T+=c[v].dist(c[v+1]),v++;const E=[];let I=0;for(;T<l/2;){const P=c[v],O=c[v+1];if(!O)return!1;let z=c[v-1].angleTo(P)-P.angleTo(O);for(z=Math.abs((z+3*Math.PI)%(2*Math.PI)-Math.PI),E.push({distance:T,angleDelta:z}),I+=z;T-E[0].distance>f;)I-=E.shift().angleDelta;if(I>_)return!1;v++,T+=P.dist(O)}return!0}function xE(c){let n=0;for(let l=0;l<c.length-1;l++)n+=c[l].dist(c[l+1]);return n}function wE(c,n,l){return c?.6*n*l:0}function TE(c,n){return Math.max(c?c.right-c.left:0,n?n.right-n.left:0)}function cV(c,n,l,f,_,b){const v=wE(l,_,b),T=TE(l,f)*b;let E=0;const I=xE(c)/2;for(let P=0;P<c.length-1;P++){const O=c[P],z=c[P+1],j=O.dist(z);if(E+j>I){const H=(I-E)/j,W=pn.number(O.x,z.x,H),K=pn.number(O.y,z.y,H),ie=new Oa(W,K,z.angleTo(O),P);return ie._round(),!v||vE(c,ie,T,v,n)?ie:void 0}E+=j}}function hV(c,n,l,f,_,b,v,T,E){const I=wE(f,b,v),P=TE(f,_),O=P*v,z=c[0].x===0||c[0].x===E||c[0].y===0||c[0].y===E;return n-O<n/4&&(n=O+n/4),AE(c,z?n/2*T%n:(P/2+2*b)*v*T%n,n,I,l,O,z,!1,E)}function AE(c,n,l,f,_,b,v,T,E){const I=b/2,P=xE(c);let O=0,z=n-l,j=[];for(let H=0;H<c.length-1;H++){const W=c[H],K=c[H+1],ie=W.dist(K),me=K.angleTo(W);for(;z+l<O+ie;){z+=l;const he=(z-O)/ie,fe=pn.number(W.x,K.x,he),Be=pn.number(W.y,K.y,he);if(fe>=0&&fe<E&&Be>=0&&Be<E&&z-I>=0&&z+I<=P){const Ne=new Oa(fe,Be,me,H);Ne._round(),f&&!vE(c,Ne,b,f,_)||j.push(Ne)}}O+=ie}return T||j.length||v||(j=AE(c,O/2,l,f,_,b,v,!0,E)),j}function EE(c,n,l,f){const _=[],b=c.image,v=b.pixelRatio,T=b.paddedRect.w-2,E=b.paddedRect.h-2;let I={x1:c.left,y1:c.top,x2:c.right,y2:c.bottom};const P=b.stretchX||[[0,T]],O=b.stretchY||[[0,E]],z=(ze,wt)=>ze+wt[1]-wt[0],j=P.reduce(z,0),H=O.reduce(z,0),W=T-j,K=E-H;let ie=0,me=j,he=0,fe=H,Be=0,Ne=W,He=0,st=K;if(b.content&&f){const ze=b.content,wt=ze[2]-ze[0],Et=ze[3]-ze[1];(b.textFitWidth||b.textFitHeight)&&(I=QA(c)),ie=d_(P,0,ze[0]),he=d_(O,0,ze[1]),me=d_(P,ze[0],ze[2]),fe=d_(O,ze[1],ze[3]),Be=ze[0]-ie,He=ze[1]-he,Ne=wt-me,st=Et-fe}const Ke=I.x1,et=I.y1,_t=I.x2-Ke,Qe=I.y2-et,tt=(ze,wt,Et,mt)=>{const dt=f_(ze.stretch-ie,me,_t,Ke),zt=p_(ze.fixed-Be,Ne,ze.stretch,j),Mi=f_(wt.stretch-he,fe,Qe,et),ir=p_(wt.fixed-He,st,wt.stretch,H),Dr=f_(Et.stretch-ie,me,_t,Ke),Zs=p_(Et.fixed-Be,Ne,Et.stretch,j),cs=f_(mt.stretch-he,fe,Qe,et),Tr=p_(mt.fixed-He,st,mt.stretch,H),Ti=new x(dt,Mi),fr=new x(Dr,Mi),Ar=new x(Dr,cs),Er=new x(dt,cs),ts=new x(zt/v,ir/v),Ks=new x(Zs/v,Tr/v),pr=n*Math.PI/180;if(pr){const _r=Math.sin(pr),gr=Math.cos(pr),Ji=[gr,-_r,_r,gr];Ti._matMult(Ji),fr._matMult(Ji),Er._matMult(Ji),Ar._matMult(Ji)}const hs=ze.stretch+ze.fixed,rr=wt.stretch+wt.fixed;return{tl:Ti,tr:fr,bl:Er,br:Ar,tex:{x:b.paddedRect.x+1+hs,y:b.paddedRect.y+1+rr,w:Et.stretch+Et.fixed-hs,h:mt.stretch+mt.fixed-rr},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:ts,pixelOffsetBR:Ks,minFontScaleX:Ne/v/_t,minFontScaleY:st/v/Qe,isSDF:l}};if(f&&(b.stretchX||b.stretchY)){const ze=SE(P,W,j),wt=SE(O,K,H);for(let Et=0;Et<ze.length-1;Et++){const mt=ze[Et],dt=ze[Et+1];for(let zt=0;zt<wt.length-1;zt++)_.push(tt(mt,wt[zt],dt,wt[zt+1]))}}else _.push(tt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:T+1},{fixed:0,stretch:E+1}));return _}function d_(c,n,l){let f=0;for(const _ of c)f+=Math.max(n,Math.min(l,_[1]))-Math.max(n,Math.min(l,_[0]));return f}function SE(c,n,l){const f=[{fixed:-1,stretch:0}];for(const[_,b]of c){const v=f[f.length-1];f.push({fixed:_-v.stretch,stretch:v.stretch}),f.push({fixed:_-v.stretch,stretch:v.stretch+(b-_)})}return f.push({fixed:n+1,stretch:l}),f}function f_(c,n,l,f){return c/n*l+f}function p_(c,n,l,f){return c-n*l/f}ot("Anchor",Oa);class __{constructor(n,l,f,_,b,v,T,E,I,P){var O;if(this.boxStartIndex=n.length,I){let z=v.top,j=v.bottom;const H=v.collisionPadding;H&&(z-=H[1],j+=H[3]);let W=j-z;W>0&&(W=Math.max(10,W),this.circleDiameter=W)}else{const z=!((O=v.image)===null||O===void 0)&&O.content&&(v.image.textFitWidth||v.image.textFitHeight)?QA(v):{x1:v.left,y1:v.top,x2:v.right,y2:v.bottom};z.y1=z.y1*T-E[0],z.y2=z.y2*T+E[2],z.x1=z.x1*T-E[3],z.x2=z.x2*T+E[1];const j=v.collisionPadding;if(j&&(z.x1-=j[0]*T,z.y1-=j[1]*T,z.x2+=j[2]*T,z.y2+=j[3]*T),P){const H=new x(z.x1,z.y1),W=new x(z.x2,z.y1),K=new x(z.x1,z.y2),ie=new x(z.x2,z.y2),me=P*Math.PI/180;H._rotate(me),W._rotate(me),K._rotate(me),ie._rotate(me),z.x1=Math.min(H.x,W.x,K.x,ie.x),z.x2=Math.max(H.x,W.x,K.x,ie.x),z.y1=Math.min(H.y,W.y,K.y,ie.y),z.y2=Math.max(H.y,W.y,K.y,ie.y)}n.emplaceBack(l.x,l.y,z.x1,z.y1,z.x2,z.y2,f,_,b)}this.boxEndIndex=n.length}}class uV{constructor(n=[],l=(f,_)=>f<_?-1:f>_?1:0){if(this.data=n,this.length=this.data.length,this.compare=l,this.length>0)for(let f=(this.length>>1)-1;f>=0;f--)this._down(f)}push(n){this.data.push(n),this._up(this.length++)}pop(){if(this.length===0)return;const n=this.data[0],l=this.data.pop();return--this.length>0&&(this.data[0]=l,this._down(0)),n}peek(){return this.data[0]}_up(n){const{data:l,compare:f}=this,_=l[n];for(;n>0;){const b=n-1>>1,v=l[b];if(f(_,v)>=0)break;l[n]=v,n=b}l[n]=_}_down(n){const{data:l,compare:f}=this,_=this.length>>1,b=l[n];for(;n<_;){let v=1+(n<<1);const T=v+1;if(T<this.length&&f(l[T],l[v])<0&&(v=T),f(l[v],b)>=0)break;l[n]=l[v],n=v}l[n]=b}}function dV(c,n=1,l=!1){const f=kl.fromPoints(c[0]),_=Math.min(f.width(),f.height());let b=_/2;const v=new uV([],fV),{minX:T,minY:E,maxX:I,maxY:P}=f;if(_===0)return new x(T,E);for(let j=T;j<I;j+=_)for(let H=E;H<P;H+=_)v.push(new vh(j+b,H+b,b,c));let O=function(j){let H=0,W=0,K=0;const ie=j[0];for(let me=0,he=ie.length,fe=he-1;me<he;fe=me++){const Be=ie[me],Ne=ie[fe],He=Be.x*Ne.y-Ne.x*Be.y;W+=(Be.x+Ne.x)*He,K+=(Be.y+Ne.y)*He,H+=3*He}return new vh(W/H,K/H,0,j)}(c),z=v.length;for(;v.length;){const j=v.pop();(j.d>O.d||!O.d)&&(O=j,l&&console.log("found best %d after %d probes",Math.round(1e4*j.d)/1e4,z)),j.max-O.d<=n||(b=j.h/2,v.push(new vh(j.p.x-b,j.p.y-b,b,c)),v.push(new vh(j.p.x+b,j.p.y-b,b,c)),v.push(new vh(j.p.x-b,j.p.y+b,b,c)),v.push(new vh(j.p.x+b,j.p.y+b,b,c)),z+=4)}return l&&(console.log(`num probes: ${z}`),console.log(`best distance: ${O.d}`)),O.p}function fV(c,n){return n.max-c.max}function vh(c,n,l,f){this.p=new x(c,n),this.h=l,this.d=function(_,b){let v=!1,T=1/0;for(let E=0;E<b.length;E++){const I=b[E];for(let P=0,O=I.length,z=O-1;P<O;z=P++){const j=I[P],H=I[z];j.y>_.y!=H.y>_.y&&_.x<(H.x-j.x)*(_.y-j.y)/(H.y-j.y)+j.x&&(v=!v),T=Math.min(T,hA(_,j,H))}}return(v?1:-1)*Math.sqrt(T)}(this.p,f),this.max=this.d+this.h*Math.SQRT2}var Br;d.aE=void 0,(Br=d.aE||(d.aE={}))[Br.center=1]="center",Br[Br.left=2]="left",Br[Br.right=3]="right",Br[Br.top=4]="top",Br[Br.bottom=5]="bottom",Br[Br["top-left"]=6]="top-left",Br[Br["top-right"]=7]="top-right",Br[Br["bottom-left"]=8]="bottom-left",Br[Br["bottom-right"]=9]="bottom-right";const x0=Number.POSITIVE_INFINITY;function CE(c,n){return n[1]!==x0?function(l,f,_){let b=0,v=0;switch(f=Math.abs(f),_=Math.abs(_),l){case"top-right":case"top-left":case"top":v=_-7;break;case"bottom-right":case"bottom-left":case"bottom":v=7-_}switch(l){case"top-right":case"bottom-right":case"right":b=-f;break;case"top-left":case"bottom-left":case"left":b=f}return[b,v]}(c,n[0],n[1]):function(l,f){let _=0,b=0;f<0&&(f=0);const v=f/Math.SQRT2;switch(l){case"top-right":case"top-left":b=v-7;break;case"bottom-right":case"bottom-left":b=7-v;break;case"bottom":b=7-f;break;case"top":b=f-7}switch(l){case"top-right":case"bottom-right":_=-v;break;case"top-left":case"bottom-left":_=v;break;case"left":_=f;break;case"right":_=-f}return[_,b]}(c,n[0])}function IE(c,n,l){var f;const _=c.layout,b=(f=_.get("text-variable-anchor-offset"))===null||f===void 0?void 0:f.evaluate(n,{},l);if(b){const T=b.values,E=[];for(let I=0;I<T.length;I+=2){const P=E[I]=T[I],O=T[I+1].map(z=>z*dr);P.startsWith("top")?O[1]-=7:P.startsWith("bottom")&&(O[1]+=7),E[I+1]=O}return new Vr(E)}const v=_.get("text-variable-anchor");if(v){let T;T=c._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[_.get("text-radial-offset").evaluate(n,{},l)*dr,x0]:_.get("text-offset").evaluate(n,{},l).map(I=>I*dr);const E=[];for(const I of v)E.push(I,CE(I,T));return new Vr(E)}return null}function w0(c){switch(c){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function pV(c,n,l,f,_,b,v,T,E,I,P,O){let z=b.textMaxSize.evaluate(n,{});z===void 0&&(z=v);const j=c.layers[0].layout,H=j.get("icon-offset").evaluate(n,{},P),W=RE(l.horizontal),K=v/24,ie=c.tilePixelRatio*K,me=c.tilePixelRatio*z/24,he=c.tilePixelRatio*T,fe=c.tilePixelRatio*j.get("symbol-spacing"),Be=j.get("text-padding")*c.tilePixelRatio,Ne=function(Et,mt,dt,zt=1){const Mi=Et.get("icon-padding").evaluate(mt,{},dt),ir=Mi&&Mi.values;return[ir[0]*zt,ir[1]*zt,ir[2]*zt,ir[3]*zt]}(j,n,P,c.tilePixelRatio),He=j.get("text-max-angle")/180*Math.PI,st=j.get("text-rotation-alignment")!=="viewport"&&j.get("symbol-placement")!=="point",Ke=j.get("icon-rotation-alignment")==="map"&&j.get("symbol-placement")!=="point",et=j.get("symbol-placement"),_t=fe/2,Qe=j.get("icon-text-fit");let tt;f&&Qe!=="none"&&(c.allowVerticalPlacement&&l.vertical&&(tt=eE(f,l.vertical,Qe,j.get("icon-text-fit-padding"),H,K)),W&&(f=eE(f,W,Qe,j.get("icon-text-fit-padding"),H,K)));const ze=P?O.line.getGranularityForZoomLevel(P.z):1,wt=(Et,mt)=>{mt.x<0||mt.x>=Gt||mt.y<0||mt.y>=Gt||function(dt,zt,Mi,ir,Dr,Zs,cs,Tr,Ti,fr,Ar,Er,ts,Ks,pr,hs,rr,_r,gr,Ji,gi,kn,xh,Nn,mV){const wh=dt.addToLineVertexArray(zt,Mi);let Nl,Th,Ah,Eh,OE=0,FE=0,kE=0,NE=0,R0=-1,P0=-1;const Ho={};let LE=Ma("");if(dt.allowVerticalPlacement&&ir.vertical){const $r=Tr.layout.get("text-rotate").evaluate(gi,{},Nn)+90;Ah=new __(Ti,zt,fr,Ar,Er,ir.vertical,ts,Ks,pr,$r),cs&&(Eh=new __(Ti,zt,fr,Ar,Er,cs,rr,_r,pr,$r))}if(Dr){const $r=Tr.layout.get("icon-rotate").evaluate(gi,{}),Ys=Tr.layout.get("icon-text-fit")!=="none",Ll=EE(Dr,$r,xh,Ys),Un=cs?EE(cs,$r,xh,Ys):void 0;Th=new __(Ti,zt,fr,Ar,Er,Dr,rr,_r,!1,$r),OE=4*Ll.length;const Ul=dt.iconSizeData;let fo=null;Ul.kind==="source"?(fo=[jo*Tr.layout.get("icon-size").evaluate(gi,{})],fo[0]>Ba&&ci(`${dt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):Ul.kind==="composite"&&(fo=[jo*kn.compositeIconSizes[0].evaluate(gi,{},Nn),jo*kn.compositeIconSizes[1].evaluate(gi,{},Nn)],(fo[0]>Ba||fo[1]>Ba)&&ci(`${dt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),dt.addSymbols(dt.icon,Ll,fo,Ji,gr,gi,d.ao.none,zt,wh.lineStartIndex,wh.lineLength,-1,Nn),R0=dt.icon.placedSymbolArray.length-1,Un&&(FE=4*Un.length,dt.addSymbols(dt.icon,Un,fo,Ji,gr,gi,d.ao.vertical,zt,wh.lineStartIndex,wh.lineLength,-1,Nn),P0=dt.icon.placedSymbolArray.length-1)}const UE=Object.keys(ir.horizontal);for(const $r of UE){const Ys=ir.horizontal[$r];if(!Nl){LE=Ma(Ys.text);const Un=Tr.layout.get("text-rotate").evaluate(gi,{},Nn);Nl=new __(Ti,zt,fr,Ar,Er,Ys,ts,Ks,pr,Un)}const Ll=Ys.positionedLines.length===1;if(kE+=ME(dt,zt,Ys,Zs,Tr,pr,gi,hs,wh,ir.vertical?d.ao.horizontal:d.ao.horizontalOnly,Ll?UE:[$r],Ho,R0,kn,Nn),Ll)break}ir.vertical&&(NE+=ME(dt,zt,ir.vertical,Zs,Tr,pr,gi,hs,wh,d.ao.vertical,["vertical"],Ho,P0,kn,Nn));const yV=Nl?Nl.boxStartIndex:dt.collisionBoxArray.length,bV=Nl?Nl.boxEndIndex:dt.collisionBoxArray.length,vV=Ah?Ah.boxStartIndex:dt.collisionBoxArray.length,xV=Ah?Ah.boxEndIndex:dt.collisionBoxArray.length,wV=Th?Th.boxStartIndex:dt.collisionBoxArray.length,TV=Th?Th.boxEndIndex:dt.collisionBoxArray.length,AV=Eh?Eh.boxStartIndex:dt.collisionBoxArray.length,EV=Eh?Eh.boxEndIndex:dt.collisionBoxArray.length;let Ln=-1;const m_=($r,Ys)=>$r&&$r.circleDiameter?Math.max($r.circleDiameter,Ys):Ys;Ln=m_(Nl,Ln),Ln=m_(Ah,Ln),Ln=m_(Th,Ln),Ln=m_(Eh,Ln);const zE=Ln>-1?1:0;zE&&(Ln*=mV/dr),dt.glyphOffsetArray.length>=yh.MAX_GLYPHS&&ci("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),gi.sortKey!==void 0&&dt.addToSortKeyRanges(dt.symbolInstances.length,gi.sortKey);const SV=IE(Tr,gi,Nn),[CV,IV]=function($r,Ys){const Ll=$r.length,Un=Ys==null?void 0:Ys.values;if((Un==null?void 0:Un.length)>0)for(let Ul=0;Ul<Un.length;Ul+=2){const fo=Un[Ul+1];$r.emplaceBack(d.aE[Un[Ul]],fo[0],fo[1])}return[Ll,$r.length]}(dt.textAnchorOffsets,SV);dt.symbolInstances.emplaceBack(zt.x,zt.y,Ho.right>=0?Ho.right:-1,Ho.center>=0?Ho.center:-1,Ho.left>=0?Ho.left:-1,Ho.vertical||-1,R0,P0,LE,yV,bV,vV,xV,wV,TV,AV,EV,fr,kE,NE,OE,FE,zE,0,ts,Ln,CV,IV)}(c,mt,Et,l,f,_,tt,c.layers[0],c.collisionBoxArray,n.index,n.sourceLayerIndex,c.index,ie,[Be,Be,Be,Be],st,E,he,Ne,Ke,H,n,b,I,P,v)};if(et==="line")for(const Et of bE(n.geometry,0,0,Gt,Gt)){const mt=Fl(Et,ze),dt=hV(mt,fe,He,l.vertical||W,f,24,me,c.overscaling,Gt);for(const zt of dt)W&&_V(c,W.text,_t,zt)||wt(mt,zt)}else if(et==="line-center"){for(const Et of n.geometry)if(Et.length>1){const mt=Fl(Et,ze),dt=cV(mt,He,l.vertical||W,f,24,me);dt&&wt(mt,dt)}}else if(n.type==="Polygon")for(const Et of yl(n.geometry,0)){const mt=dV(Et,16);wt(Fl(Et[0],ze,!0),new Oa(mt.x,mt.y,0))}else if(n.type==="LineString")for(const Et of n.geometry){const mt=Fl(Et,ze);wt(mt,new Oa(mt[0].x,mt[0].y,0))}else if(n.type==="Point")for(const Et of n.geometry)for(const mt of Et)wt([mt],new Oa(mt.x,mt.y,0))}function ME(c,n,l,f,_,b,v,T,E,I,P,O,z,j,H){const W=function(me,he,fe,Be,Ne,He,st,Ke){const et=Be.layout.get("text-rotate").evaluate(He,{})*Math.PI/180,_t=[];for(const Qe of he.positionedLines)for(const tt of Qe.positionedGlyphs){if(!tt.rect)continue;const ze=tt.rect||{};let wt=4,Et=!0,mt=1,dt=0;const zt=(Ne||Ke)&&tt.vertical,Mi=tt.metrics.advance*tt.scale/2;if(Ke&&he.verticalizable&&(dt=Qe.lineOffset/2-(tt.imageName?-(dr-tt.metrics.width*tt.scale)/2:(tt.scale-1)*dr)),tt.imageName){const _r=st[tt.imageName];Et=_r.sdf,mt=_r.pixelRatio,wt=1/mt}const ir=Ne?[tt.x+Mi,tt.y]:[0,0];let Dr=Ne?[0,0]:[tt.x+Mi+fe[0],tt.y+fe[1]-dt],Zs=[0,0];zt&&(Zs=Dr,Dr=[0,0]);const cs=tt.metrics.isDoubleResolution?2:1,Tr=(tt.metrics.left-wt)*tt.scale-Mi+Dr[0],Ti=(-tt.metrics.top-wt)*tt.scale+Dr[1],fr=Tr+ze.w/cs*tt.scale/mt,Ar=Ti+ze.h/cs*tt.scale/mt,Er=new x(Tr,Ti),ts=new x(fr,Ti),Ks=new x(Tr,Ar),pr=new x(fr,Ar);if(zt){const _r=new x(-Mi,Mi- -17),gr=-Math.PI/2,Ji=12-Mi,gi=new x(22-Ji,-(tt.imageName?Ji:0)),kn=new x(...Zs);Er._rotateAround(gr,_r)._add(gi)._add(kn),ts._rotateAround(gr,_r)._add(gi)._add(kn),Ks._rotateAround(gr,_r)._add(gi)._add(kn),pr._rotateAround(gr,_r)._add(gi)._add(kn)}if(et){const _r=Math.sin(et),gr=Math.cos(et),Ji=[gr,-_r,_r,gr];Er._matMult(Ji),ts._matMult(Ji),Ks._matMult(Ji),pr._matMult(Ji)}const hs=new x(0,0),rr=new x(0,0);_t.push({tl:Er,tr:ts,bl:Ks,br:pr,tex:ze,writingMode:he.writingMode,glyphOffset:ir,sectionIndex:tt.sectionIndex,isSDF:Et,pixelOffsetTL:hs,pixelOffsetBR:rr,minFontScaleX:0,minFontScaleY:0})}return _t}(0,l,T,_,b,v,f,c.allowVerticalPlacement),K=c.textSizeData;let ie=null;K.kind==="source"?(ie=[jo*_.layout.get("text-size").evaluate(v,{})],ie[0]>Ba&&ci(`${c.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):K.kind==="composite"&&(ie=[jo*j.compositeTextSizes[0].evaluate(v,{},H),jo*j.compositeTextSizes[1].evaluate(v,{},H)],(ie[0]>Ba||ie[1]>Ba)&&ci(`${c.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),c.addSymbols(c.text,W,ie,T,b,v,I,n,E.lineStartIndex,E.lineLength,z,H);for(const me of P)O[me]=c.text.placedSymbolArray.length-1;return 4*W.length}function RE(c){for(const n in c)return c[n];return null}function _V(c,n,l,f){const _=c.compareText;if(n in _){const b=_[n];for(let v=b.length-1;v>=0;v--)if(f.dist(b[v])<l)return!0}else _[n]=[];return _[n].push(f),!1}const PE=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class T0{static from(n){if(!(n instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[l,f]=new Uint8Array(n,0,2);if(l!==219)throw new Error("Data does not appear to be in a KDBush format.");const _=f>>4;if(_!==1)throw new Error(`Got v${_} data when expected v1.`);const b=PE[15&f];if(!b)throw new Error("Unrecognized array type.");const[v]=new Uint16Array(n,2,1),[T]=new Uint32Array(n,4,1);return new T0(T,v,b,n)}constructor(n,l=64,f=Float64Array,_){if(isNaN(n)||n<0)throw new Error(`Unpexpected numItems value: ${n}.`);this.numItems=+n,this.nodeSize=Math.min(Math.max(+l,2),65535),this.ArrayType=f,this.IndexArrayType=n<65536?Uint16Array:Uint32Array;const b=PE.indexOf(this.ArrayType),v=2*n*this.ArrayType.BYTES_PER_ELEMENT,T=n*this.IndexArrayType.BYTES_PER_ELEMENT,E=(8-T%8)%8;if(b<0)throw new Error(`Unexpected typed array class: ${f}.`);_&&_ instanceof ArrayBuffer?(this.data=_,this.ids=new this.IndexArrayType(this.data,8,n),this.coords=new this.ArrayType(this.data,8+T+E,2*n),this._pos=2*n,this._finished=!0):(this.data=new ArrayBuffer(8+v+T+E),this.ids=new this.IndexArrayType(this.data,8,n),this.coords=new this.ArrayType(this.data,8+T+E,2*n),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+b]),new Uint16Array(this.data,2,1)[0]=l,new Uint32Array(this.data,4,1)[0]=n)}add(n,l){const f=this._pos>>1;return this.ids[f]=f,this.coords[this._pos++]=n,this.coords[this._pos++]=l,f}finish(){const n=this._pos>>1;if(n!==this.numItems)throw new Error(`Added ${n} items when expected ${this.numItems}.`);return A0(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(n,l,f,_){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:b,coords:v,nodeSize:T}=this,E=[0,b.length-1,0],I=[];for(;E.length;){const P=E.pop()||0,O=E.pop()||0,z=E.pop()||0;if(O-z<=T){for(let K=z;K<=O;K++){const ie=v[2*K],me=v[2*K+1];ie>=n&&ie<=f&&me>=l&&me<=_&&I.push(b[K])}continue}const j=z+O>>1,H=v[2*j],W=v[2*j+1];H>=n&&H<=f&&W>=l&&W<=_&&I.push(b[j]),(P===0?n<=H:l<=W)&&(E.push(z),E.push(j-1),E.push(1-P)),(P===0?f>=H:_>=W)&&(E.push(j+1),E.push(O),E.push(1-P))}return I}within(n,l,f){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:_,coords:b,nodeSize:v}=this,T=[0,_.length-1,0],E=[],I=f*f;for(;T.length;){const P=T.pop()||0,O=T.pop()||0,z=T.pop()||0;if(O-z<=v){for(let K=z;K<=O;K++)DE(b[2*K],b[2*K+1],n,l)<=I&&E.push(_[K]);continue}const j=z+O>>1,H=b[2*j],W=b[2*j+1];DE(H,W,n,l)<=I&&E.push(_[j]),(P===0?n-f<=H:l-f<=W)&&(T.push(z),T.push(j-1),T.push(1-P)),(P===0?n+f>=H:l+f>=W)&&(T.push(j+1),T.push(O),T.push(1-P))}return E}}function A0(c,n,l,f,_,b){if(_-f<=l)return;const v=f+_>>1;BE(c,n,v,f,_,b),A0(c,n,l,f,v-1,1-b),A0(c,n,l,v+1,_,1-b)}function BE(c,n,l,f,_,b){for(;_>f;){if(_-f>600){const I=_-f+1,P=l-f+1,O=Math.log(I),z=.5*Math.exp(2*O/3),j=.5*Math.sqrt(O*z*(I-z)/I)*(P-I/2<0?-1:1);BE(c,n,l,Math.max(f,Math.floor(l-P*z/I+j)),Math.min(_,Math.floor(l+(I-P)*z/I+j)),b)}const v=n[2*l+b];let T=f,E=_;for(wd(c,n,f,l),n[2*_+b]>v&&wd(c,n,f,_);T<E;){for(wd(c,n,T,E),T++,E--;n[2*T+b]<v;)T++;for(;n[2*E+b]>v;)E--}n[2*f+b]===v?wd(c,n,f,E):(E++,wd(c,n,E,_)),E<=l&&(f=E+1),l<=E&&(_=E-1)}}function wd(c,n,l,f){E0(c,l,f),E0(n,2*l,2*f),E0(n,2*l+1,2*f+1)}function E0(c,n,l){const f=c[n];c[n]=c[l],c[l]=f}function DE(c,n,l,f){const _=c-l,b=n-f;return _*_+b*b}var S0;d.cx=void 0,(S0=d.cx||(d.cx={})).create="create",S0.load="load",S0.fullLoad="fullLoad";let g_=null,Td=[];const C0=1e3/60,I0="loadTime",M0="fullLoadTime",gV={mark(c){performance.mark(c)},frame(c){const n=c;g_!=null&&Td.push(n-g_),g_=n},clearMetrics(){g_=null,Td=[],performance.clearMeasures(I0),performance.clearMeasures(M0);for(const c in d.cx)performance.clearMarks(d.cx[c])},getPerformanceMetrics(){performance.measure(I0,d.cx.create,d.cx.load),performance.measure(M0,d.cx.create,d.cx.fullLoad);const c=performance.getEntriesByName(I0)[0].duration,n=performance.getEntriesByName(M0)[0].duration,l=Td.length,f=1/(Td.reduce((b,v)=>b+v,0)/l/1e3),_=Td.filter(b=>b>C0).reduce((b,v)=>b+(v-C0)/C0,0);return{loadTime:c,fullLoadTime:n,fps:f,percentDroppedFrames:_/(l+_)*100,totalFrames:l}}};d.$=Gt,d.A=Ie,d.B=function([c,n,l]){return n+=90,n*=Math.PI/180,l*=Math.PI/180,{x:c*Math.cos(n)*Math.sin(l),y:c*Math.sin(n)*Math.sin(l),z:c*Math.cos(l)}},d.C=pn,d.D=ft,d.E=ct,d.F=vi,d.G=Il,d.H=function(c){if(kr==null){const n=c.navigator?c.navigator.userAgent:null;kr=!!c.safari||!(!n||!(/\b(iPad|iPhone|iPod)\b/.test(n)||n.match("Safari")&&!n.match("Chrome")))}return kr},d.I=h0,d.J=class{constructor(c,n){this.target=c,this.mapId=n,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new oV(()=>this.process()),this.subscription=an(this.target,"message",l=>this.receive(l),!1),this.globalScope=Ni(self)?c:window}registerMessageHandler(c,n){this.messageHandlers[c]=n}sendAsync(c,n){return new Promise((l,f)=>{const _=Math.round(1e18*Math.random()).toString(36).substring(0,10),b=n?an(n.signal,"abort",()=>{b==null||b.unsubscribe(),delete this.resolveRejects[_];const E={id:_,type:"<cancel>",origin:location.origin,targetMapId:c.targetMapId,sourceMapId:this.mapId};this.target.postMessage(E)},aV):null;this.resolveRejects[_]={resolve:E=>{b==null||b.unsubscribe(),l(E)},reject:E=>{b==null||b.unsubscribe(),f(E)}};const v=[],T=Object.assign(Object.assign({},c),{id:_,sourceMapId:this.mapId,origin:location.origin,data:Ta(c.data,v)});this.target.postMessage(T,{transfer:v})})}receive(c){const n=c.data,l=n.id;if(!(n.origin!=="file://"&&location.origin!=="file://"&&n.origin!=="resource://android"&&location.origin!=="resource://android"&&n.origin!==location.origin||n.targetMapId&&this.mapId!==n.targetMapId)){if(n.type==="<cancel>"){delete this.tasks[l];const f=this.abortControllers[l];return delete this.abortControllers[l],void(f&&f.abort())}if(Ni(self)||n.mustQueue)return this.tasks[l]=n,this.taskQueue.push(l),void this.invoker.trigger();this.processTask(l,n)}}process(){if(this.taskQueue.length===0)return;const c=this.taskQueue.shift(),n=this.tasks[c];delete this.tasks[c],this.taskQueue.length>0&&this.invoker.trigger(),n&&this.processTask(c,n)}processTask(c,n){return a(this,void 0,void 0,function*(){if(n.type==="<response>"){const _=this.resolveRejects[c];return delete this.resolveRejects[c],_?void(n.error?_.reject(No(n.error)):_.resolve(No(n.data))):void 0}if(!this.messageHandlers[n.type])return void this.completeTask(c,new Error(`Could not find a registered handler for ${n.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const l=No(n.data),f=new AbortController;this.abortControllers[c]=f;try{const _=yield this.messageHandlers[n.type](n.sourceMapId,l,f);this.completeTask(c,null,_)}catch(_){this.completeTask(c,_)}})}completeTask(c,n,l){const f=[];delete this.abortControllers[c];const _={id:c,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:n?Ta(n):null,data:Ta(l,f)};this.target.postMessage(_,{transfer:f})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},d.K=Z,d.L=function(){var c=new Ie(16);return Ie!=Float32Array&&(c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[11]=0,c[12]=0,c[13]=0,c[14]=0),c[0]=1,c[5]=1,c[10]=1,c[15]=1,c},d.M=function(c,n,l){var f,_,b,v,T,E,I,P,O,z,j,H,W=l[0],K=l[1],ie=l[2];return n===c?(c[12]=n[0]*W+n[4]*K+n[8]*ie+n[12],c[13]=n[1]*W+n[5]*K+n[9]*ie+n[13],c[14]=n[2]*W+n[6]*K+n[10]*ie+n[14],c[15]=n[3]*W+n[7]*K+n[11]*ie+n[15]):(_=n[1],b=n[2],v=n[3],T=n[4],E=n[5],I=n[6],P=n[7],O=n[8],z=n[9],j=n[10],H=n[11],c[0]=f=n[0],c[1]=_,c[2]=b,c[3]=v,c[4]=T,c[5]=E,c[6]=I,c[7]=P,c[8]=O,c[9]=z,c[10]=j,c[11]=H,c[12]=f*W+T*K+O*ie+n[12],c[13]=_*W+E*K+z*ie+n[13],c[14]=b*W+I*K+j*ie+n[14],c[15]=v*W+P*K+H*ie+n[15]),c},d.N=function(c,n,l){var f=l[0],_=l[1],b=l[2];return c[0]=n[0]*f,c[1]=n[1]*f,c[2]=n[2]*f,c[3]=n[3]*f,c[4]=n[4]*_,c[5]=n[5]*_,c[6]=n[6]*_,c[7]=n[7]*_,c[8]=n[8]*b,c[9]=n[9]*b,c[10]=n[10]*b,c[11]=n[11]*b,c[12]=n[12],c[13]=n[13],c[14]=n[14],c[15]=n[15],c},d.O=function(c,n,l){var f=n[0],_=n[1],b=n[2],v=n[3],T=n[4],E=n[5],I=n[6],P=n[7],O=n[8],z=n[9],j=n[10],H=n[11],W=n[12],K=n[13],ie=n[14],me=n[15],he=l[0],fe=l[1],Be=l[2],Ne=l[3];return c[0]=he*f+fe*T+Be*O+Ne*W,c[1]=he*_+fe*E+Be*z+Ne*K,c[2]=he*b+fe*I+Be*j+Ne*ie,c[3]=he*v+fe*P+Be*H+Ne*me,c[4]=(he=l[4])*f+(fe=l[5])*T+(Be=l[6])*O+(Ne=l[7])*W,c[5]=he*_+fe*E+Be*z+Ne*K,c[6]=he*b+fe*I+Be*j+Ne*ie,c[7]=he*v+fe*P+Be*H+Ne*me,c[8]=(he=l[8])*f+(fe=l[9])*T+(Be=l[10])*O+(Ne=l[11])*W,c[9]=he*_+fe*E+Be*z+Ne*K,c[10]=he*b+fe*I+Be*j+Ne*ie,c[11]=he*v+fe*P+Be*H+Ne*me,c[12]=(he=l[12])*f+(fe=l[13])*T+(Be=l[14])*O+(Ne=l[15])*W,c[13]=he*_+fe*E+Be*z+Ne*K,c[14]=he*b+fe*I+Be*j+Ne*ie,c[15]=he*v+fe*P+Be*H+Ne*me,c},d.P=x,d.Q=function(c,n){const l={};for(let f=0;f<n.length;f++){const _=n[f];_ in c&&(l[_]=c[_])}return l},d.R=ls,d.S=Da,d.T=Qy,d.U=hE,d.V=cE,d.W=xe,d.X=Ae,d.Y=Ps,d.Z=qs,d._=a,d.a=$,d.a$=Ht,d.a0=function(c,n){var l,f,_,b;if(!c)return n??{};if(!n)return c;const v=Object.assign({},c);if(n.removeAll&&(v.removeAll=!0),n.remove){const T=new Set(v.remove?v.remove.concat(n.remove):n.remove);v.remove=Array.from(T.values())}if(n.add){const T=v.add?v.add.concat(n.add):n.add,E=new Map(T.map(I=>[I.id,I]));v.add=Array.from(E.values())}if(n.update){const T=new Map((l=v.update)===null||l===void 0?void 0:l.map(E=>[E.id,E]));for(const E of n.update){const I=(f=T.get(E.id))!==null&&f!==void 0?f:{id:E.id};E.newGeometry&&(I.newGeometry=E.newGeometry),E.addOrUpdateProperties&&(I.addOrUpdateProperties=((_=I.addOrUpdateProperties)!==null&&_!==void 0?_:[]).concat(E.addOrUpdateProperties)),E.removeProperties&&(I.removeProperties=((b=I.removeProperties)!==null&&b!==void 0?b:[]).concat(E.removeProperties)),E.removeAllProperties&&(I.removeAllProperties=!0),T.set(E.id,I)}v.update=Array.from(T.values())}return v},d.a1=vd,d.a2=kl,d.a3=25,d.a4=v0,d.a5=c=>{const n=window.document.createElement("video");return n.muted=!0,new Promise(l=>{n.onloadstart=()=>{l(n)};for(const f of c){const _=window.document.createElement("source");Re(f)||(n.crossOrigin="Anonymous"),_.src=f,n.appendChild(_)}})},d.a6=We,d.a7=function(){return Zt++},d.a8=F,d.a9=yh,d.aA=function(c){let n=1/0,l=1/0,f=-1/0,_=-1/0;for(const b of c)n=Math.min(n,b.x),l=Math.min(l,b.y),f=Math.max(f,b.x),_=Math.max(_,b.y);return[n,l,f,_]},d.aB=dr,d.aC=or,d.aD=function(c,n,l,f,_=!1){if(!l[0]&&!l[1])return[0,0];const b=_?f==="map"?-c.bearingInRadians:0:f==="viewport"?c.bearingInRadians:0;if(b){const v=Math.sin(b),T=Math.cos(b);l=[l[0]*T-l[1]*v,l[0]*v+l[1]*T]}return[_?l[0]:or(n,l[0],c.zoom),_?l[1]:or(n,l[1],c.zoom)]},d.aF=f0,d.aG=w0,d.aH=d0,d.aI=T0,d.aJ=Oi,d.aK=o_,d.aL=le,d.aM=Pt,d.aN=si,d.aO=Pi,d.aP=ln,d.aQ=dE,d.aR=at,d.aS=nt,d.aT=function(c){var n=new Ie(3);return n[0]=c[0],n[1]=c[1],n[2]=c[2],n},d.aU=function(c,n,l){return c[0]=n[0]-l[0],c[1]=n[1]-l[1],c[2]=n[2]-l[2],c},d.aV=function(c,n){var l=n[0],f=n[1],_=n[2],b=l*l+f*f+_*_;return b>0&&(b=1/Math.sqrt(b)),c[0]=n[0]*b,c[1]=n[1]*b,c[2]=n[2]*b,c},d.aW=bt,d.aX=function(c,n){return c[0]*n[0]+c[1]*n[1]+c[2]*n[2]},d.aY=function(c,n,l){return c[0]=n[0]*l[0],c[1]=n[1]*l[1],c[2]=n[2]*l[2],c[3]=n[3]*l[3],c},d.aZ=ht,d.a_=function(c,n,l){const f=n[0]*l[0]+n[1]*l[1]+n[2]*l[2];return f===0?null:(-(c[0]*l[0]+c[1]*l[1]+c[2]*l[2])-l[3])/f},d.aa=Oo,d.ab=Fn,d.ac=gE,d.ad=function(c){const n={};if(c.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(l,f,_,b)=>{const v=_||b;return n[f]=!v||v.toLowerCase(),""}),n["max-age"]){const l=parseInt(n["max-age"],10);isNaN(l)?delete n["max-age"]:n["max-age"]=l}return n},d.ae=Mn,d.af=function(c){return Math.pow(2,c)},d.ag=Xe,d.ah=Ir,d.ai=85.051129,d.aj=uE,d.ak=function(c){return Math.log(c)/Math.LN2},d.al=function(c){var n=c[0],l=c[1];return n*n+l*l},d.am=function(c,n){const l=[];for(const f in c)f in n||l.push(f);return l},d.an=function(c,n){let l=0,f=0;if(c.kind==="constant")f=c.layoutSize;else if(c.kind!=="source"){const{interpolationType:_,minZoom:b,maxZoom:v}=c,T=_?Ir(wr.interpolationFactor(_,n,b,v),0,1):0;c.kind==="camera"?f=pn.number(c.minSize,c.maxSize,T):l=T}return{uSizeT:l,uSize:f}},d.ap=function(c,{uSize:n,uSizeT:l},{lowerSize:f,upperSize:_}){return c.kind==="source"?f/jo:c.kind==="composite"?pn.number(f/jo,_/jo,l):n},d.aq=function(c,n){var l=n[0],f=n[1],_=n[2],b=n[3],v=n[4],T=n[5],E=n[6],I=n[7],P=n[8],O=n[9],z=n[10],j=n[11],H=n[12],W=n[13],K=n[14],ie=n[15],me=l*T-f*v,he=l*E-_*v,fe=l*I-b*v,Be=f*E-_*T,Ne=f*I-b*T,He=_*I-b*E,st=P*W-O*H,Ke=P*K-z*H,et=P*ie-j*H,_t=O*K-z*W,Qe=O*ie-j*W,tt=z*ie-j*K,ze=me*tt-he*Qe+fe*_t+Be*et-Ne*Ke+He*st;return ze?(c[0]=(T*tt-E*Qe+I*_t)*(ze=1/ze),c[1]=(_*Qe-f*tt-b*_t)*ze,c[2]=(W*He-K*Ne+ie*Be)*ze,c[3]=(z*Ne-O*He-j*Be)*ze,c[4]=(E*et-v*tt-I*Ke)*ze,c[5]=(l*tt-_*et+b*Ke)*ze,c[6]=(K*fe-H*He-ie*he)*ze,c[7]=(P*He-z*fe+j*he)*ze,c[8]=(v*Qe-T*et+I*st)*ze,c[9]=(f*et-l*Qe-b*st)*ze,c[10]=(H*Ne-W*fe+ie*me)*ze,c[11]=(O*fe-P*Ne-j*me)*ze,c[12]=(T*Ke-v*_t-E*st)*ze,c[13]=(l*_t-f*Ke+_*st)*ze,c[14]=(W*he-H*Be-K*me)*ze,c[15]=(P*Be-O*he+z*me)*ze,c):null},d.ar=br,d.as=function(c){return Math.hypot(c[0],c[1])},d.at=function(c){return c[0]=0,c[1]=0,c},d.au=function(c,n,l){return c[0]=n[0]*l,c[1]=n[1]*l,c},d.av=p0,d.aw=St,d.ax=function(c,n,l,f){const _=n.y-c.y,b=n.x-c.x,v=f.y-l.y,T=f.x-l.x,E=v*b-T*_;if(E===0)return null;const I=(T*(c.y-l.y)-v*(c.x-l.x))/E;return new x(c.x+I*b,c.y+I*_)},d.ay=bE,d.az=lA,d.b=is,d.b$=class extends m{},d.b0=function(c,n,l){return c[0]=n[0]*l,c[1]=n[1]*l,c[2]=n[2]*l,c[3]=n[3]*l,c},d.b1=function(c,n){return c[0]*n[0]+c[1]*n[1]+c[2]*n[2]+c[3]},d.b2=pE,d.b3=bh,d.b4=function(c,n,l,f,_){var b,v=1/Math.tan(n/2);return c[0]=v/l,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=v,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[11]=-1,c[12]=0,c[13]=0,c[15]=0,_!=null&&_!==1/0?(c[10]=(_+f)*(b=1/(f-_)),c[14]=2*_*f*b):(c[10]=-1,c[14]=-2*f),c},d.b5=function(c){var n=new Ie(16);return n[0]=c[0],n[1]=c[1],n[2]=c[2],n[3]=c[3],n[4]=c[4],n[5]=c[5],n[6]=c[6],n[7]=c[7],n[8]=c[8],n[9]=c[9],n[10]=c[10],n[11]=c[11],n[12]=c[12],n[13]=c[13],n[14]=c[14],n[15]=c[15],n},d.b6=function(c,n,l){var f=Math.sin(l),_=Math.cos(l),b=n[0],v=n[1],T=n[2],E=n[3],I=n[4],P=n[5],O=n[6],z=n[7];return n!==c&&(c[8]=n[8],c[9]=n[9],c[10]=n[10],c[11]=n[11],c[12]=n[12],c[13]=n[13],c[14]=n[14],c[15]=n[15]),c[0]=b*_+I*f,c[1]=v*_+P*f,c[2]=T*_+O*f,c[3]=E*_+z*f,c[4]=I*_-b*f,c[5]=P*_-v*f,c[6]=O*_-T*f,c[7]=z*_-E*f,c},d.b7=function(c,n,l){var f=Math.sin(l),_=Math.cos(l),b=n[4],v=n[5],T=n[6],E=n[7],I=n[8],P=n[9],O=n[10],z=n[11];return n!==c&&(c[0]=n[0],c[1]=n[1],c[2]=n[2],c[3]=n[3],c[12]=n[12],c[13]=n[13],c[14]=n[14],c[15]=n[15]),c[4]=b*_+I*f,c[5]=v*_+P*f,c[6]=T*_+O*f,c[7]=E*_+z*f,c[8]=I*_-b*f,c[9]=P*_-v*f,c[10]=O*_-T*f,c[11]=z*_-E*f,c},d.b8=function(){const c=new Float32Array(16);return Xe(c),c},d.b9=function(){const c=new Float64Array(16);return Xe(c),c},d.bA=function(c,n){const l=Ai(c,360),f=Ai(n,360),_=f-l,b=f>l?_-360:_+360;return Math.abs(_)<Math.abs(b)?_:b},d.bB=function(c){return c[0]=0,c[1]=0,c[2]=0,c},d.bC=function(c,n,l,f){const _=Math.sqrt(c*c+n*n),b=Math.sqrt(l*l+f*f);c/=_,n/=_,l/=b,f/=b;const v=Math.acos(c*l+n*f);return-n*l+c*f>0?v:-v},d.bD=function(c,n){const l=Ai(c,2*Math.PI),f=Ai(n,2*Math.PI);return Math.min(Math.abs(l-f),Math.abs(l-f+2*Math.PI),Math.abs(l-f-2*Math.PI))},d.bE=function(){const c={},n=we.$version;for(const l in we.$root){const f=we.$root[l];if(f.required){let _=null;_=l==="version"?n:f.type==="array"?[]:{},_!=null&&(c[l]=_)}}return c},d.bF=eh,d.bG=pe,d.bH=function c(n,l){if(Array.isArray(n)){if(!Array.isArray(l)||n.length!==l.length)return!1;for(let f=0;f<n.length;f++)if(!c(n[f],l[f]))return!1;return!0}if(typeof n=="object"&&n!==null&&l!==null){if(typeof l!="object"||Object.keys(n).length!==Object.keys(l).length)return!1;for(const f in n)if(!c(n[f],l[f]))return!1;return!0}return n===l},d.bI=function(c){c=c.slice();const n=Object.create(null);for(let l=0;l<c.length;l++)n[c[l].id]=c[l];for(let l=0;l<c.length;l++)"ref"in c[l]&&(c[l]=Ft(c[l],n[c[l].ref]));return c},d.bJ=function(c){if(c.type==="custom")return new nV(c);switch(c.type){case"background":return new iV(c);case"circle":return new V5(c);case"color-relief":return new X5(c);case"fill":return new l8(c);case"fill-extrusion":return new b8(c);case"heatmap":return new H5(c);case"hillshade":return new $5(c);case"line":return new S8(c);case"raster":return new sV(c);case"symbol":return new u_(c)}},d.bK=Qi,d.bL=function(c,n){if(!c)return[{command:"setStyle",args:[n]}];let l=[];try{if(!pt(c.version,n.version))return[{command:"setStyle",args:[n]}];pt(c.center,n.center)||l.push({command:"setCenter",args:[n.center]}),pt(c.state,n.state)||l.push({command:"setGlobalState",args:[n.state]}),pt(c.centerAltitude,n.centerAltitude)||l.push({command:"setCenterAltitude",args:[n.centerAltitude]}),pt(c.zoom,n.zoom)||l.push({command:"setZoom",args:[n.zoom]}),pt(c.bearing,n.bearing)||l.push({command:"setBearing",args:[n.bearing]}),pt(c.pitch,n.pitch)||l.push({command:"setPitch",args:[n.pitch]}),pt(c.roll,n.roll)||l.push({command:"setRoll",args:[n.roll]}),pt(c.sprite,n.sprite)||l.push({command:"setSprite",args:[n.sprite]}),pt(c.glyphs,n.glyphs)||l.push({command:"setGlyphs",args:[n.glyphs]}),pt(c.transition,n.transition)||l.push({command:"setTransition",args:[n.transition]}),pt(c.light,n.light)||l.push({command:"setLight",args:[n.light]}),pt(c.terrain,n.terrain)||l.push({command:"setTerrain",args:[n.terrain]}),pt(c.sky,n.sky)||l.push({command:"setSky",args:[n.sky]}),pt(c.projection,n.projection)||l.push({command:"setProjection",args:[n.projection]});const f={},_=[];(function(v,T,E,I){let P;for(P in T=T||{},v=v||{})Object.prototype.hasOwnProperty.call(v,P)&&(Object.prototype.hasOwnProperty.call(T,P)||Ui(P,E,I));for(P in T)Object.prototype.hasOwnProperty.call(T,P)&&(Object.prototype.hasOwnProperty.call(v,P)?pt(v[P],T[P])||(v[P].type==="geojson"&&T[P].type==="geojson"&&Ei(v,T,P)?Ct(E,{command:"setGeoJSONSourceData",args:[P,T[P].data]}):zi(P,T,E,I)):Qt(P,T,E))})(c.sources,n.sources,_,f);const b=[];c.layers&&c.layers.forEach(v=>{"source"in v&&f[v.source]?l.push({command:"removeLayer",args:[v.id]}):b.push(v)}),l=l.concat(_),function(v,T,E){T=T||[];const I=(v=v||[]).map(Lt),P=T.map(Lt),O=v.reduce(Bi,{}),z=T.reduce(Bi,{}),j=I.slice(),H=Object.create(null);let W,K,ie,me,he;for(let fe=0,Be=0;fe<I.length;fe++)W=I[fe],Object.prototype.hasOwnProperty.call(z,W)?Be++:(Ct(E,{command:"removeLayer",args:[W]}),j.splice(j.indexOf(W,Be),1));for(let fe=0,Be=0;fe<P.length;fe++)W=P[P.length-1-fe],j[j.length-1-fe]!==W&&(Object.prototype.hasOwnProperty.call(O,W)?(Ct(E,{command:"removeLayer",args:[W]}),j.splice(j.lastIndexOf(W,j.length-Be),1)):Be++,me=j[j.length-fe],Ct(E,{command:"addLayer",args:[z[W],me]}),j.splice(j.length-fe,0,W),H[W]=!0);for(let fe=0;fe<P.length;fe++)if(W=P[fe],K=O[W],ie=z[W],!H[W]&&!pt(K,ie))if(pt(K.source,ie.source)&&pt(K["source-layer"],ie["source-layer"])&&pt(K.type,ie.type)){for(he in Bt(K.layout,ie.layout,E,W,null,"setLayoutProperty"),Bt(K.paint,ie.paint,E,W,null,"setPaintProperty"),pt(K.filter,ie.filter)||Ct(E,{command:"setFilter",args:[W,ie.filter]}),pt(K.minzoom,ie.minzoom)&&pt(K.maxzoom,ie.maxzoom)||Ct(E,{command:"setLayerZoomRange",args:[W,ie.minzoom,ie.maxzoom]}),K)Object.prototype.hasOwnProperty.call(K,he)&&he!=="layout"&&he!=="paint"&&he!=="filter"&&he!=="metadata"&&he!=="minzoom"&&he!=="maxzoom"&&(he.indexOf("paint.")===0?Bt(K[he],ie[he],E,W,he.slice(6),"setPaintProperty"):pt(K[he],ie[he])||Ct(E,{command:"setLayerProperty",args:[W,he,ie[he]]}));for(he in ie)Object.prototype.hasOwnProperty.call(ie,he)&&!Object.prototype.hasOwnProperty.call(K,he)&&he!=="layout"&&he!=="paint"&&he!=="filter"&&he!=="metadata"&&he!=="minzoom"&&he!=="maxzoom"&&(he.indexOf("paint.")===0?Bt(K[he],ie[he],E,W,he.slice(6),"setPaintProperty"):pt(K[he],ie[he])||Ct(E,{command:"setLayerProperty",args:[W,he,ie[he]]}))}else Ct(E,{command:"removeLayer",args:[W]}),me=j[j.lastIndexOf(W)+1],Ct(E,{command:"addLayer",args:[ie,me]})}(b,n.layers,l)}catch(f){console.warn("Unable to compute style diff:",f),l=[{command:"setStyle",args:[n]}]}return l},d.bM=function(c){const n=[],l=c.id;return l===void 0&&n.push({message:`layers.${l}: missing required property "id"`}),c.render===void 0&&n.push({message:`layers.${l}: missing required method "render"`}),c.renderingMode&&c.renderingMode!=="2d"&&c.renderingMode!=="3d"&&n.push({message:`layers.${l}: property "renderingMode" must be either "2d" or "3d"`}),n},d.bN=ki,d.bO=Rs,d.bP=class extends Gr{constructor(c,n){super(c,n),this.current=0}set(c){this.current!==c&&(this.current=c,this.gl.uniform1i(this.location,c))}},d.bQ=tr,d.bR=class extends Gr{constructor(c,n){super(c,n),this.current=Ts}set(c){if(c[12]!==this.current[12]||c[0]!==this.current[0])return this.current=c,void this.gl.uniformMatrix4fv(this.location,!1,c);for(let n=1;n<16;n++)if(c[n]!==this.current[n]){this.current=c,this.gl.uniformMatrix4fv(this.location,!1,c);break}}},d.bS=Ki,d.bT=class extends Gr{constructor(c,n){super(c,n),this.current=[0,0,0]}set(c){c[0]===this.current[0]&&c[1]===this.current[1]&&c[2]===this.current[2]||(this.current=c,this.gl.uniform3f(this.location,c[0],c[1],c[2]))}},d.bU=class extends Gr{constructor(c,n){super(c,n),this.current=[0,0]}set(c){c[0]===this.current[0]&&c[1]===this.current[1]||(this.current=c,this.gl.uniform2f(this.location,c[0],c[1]))}},d.bV=Ue,d.bW=function(c,n){var l=Math.sin(n),f=Math.cos(n);return c[0]=f,c[1]=l,c[2]=0,c[3]=-l,c[4]=f,c[5]=0,c[6]=0,c[7]=0,c[8]=1,c},d.bX=function(c,n,l){var f=n[0],_=n[1],b=n[2];return c[0]=f*l[0]+_*l[3]+b*l[6],c[1]=f*l[1]+_*l[4]+b*l[7],c[2]=f*l[2]+_*l[5]+b*l[8],c},d.bY=function(c,n,l,f,_,b,v){var T=1/(n-l),E=1/(f-_),I=1/(b-v);return c[0]=-2*T,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=-2*E,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=2*I,c[11]=0,c[12]=(n+l)*T,c[13]=(_+f)*E,c[14]=(v+b)*I,c[15]=1,c},d.bZ=class extends Gr{constructor(c,n){super(c,n),this.current=new Array}set(c){if(c!=this.current){this.current=c;const n=new Float32Array(4*c.length);for(let l=0;l<c.length;l++)n[4*l]=c[l].r,n[4*l+1]=c[l].g,n[4*l+2]=c[l].b,n[4*l+3]=c[l].a;this.gl.uniform4fv(this.location,n)}}},d.b_=class extends Gr{constructor(c,n){super(c,n),this.current=new Array}set(c){if(c!=this.current){this.current=c;const n=new Float32Array(c);this.gl.uniform1fv(this.location,n)}}},d.ba=function(){return new Float64Array(16)},d.bb=function(c,n,l){const f=new Float64Array(4);return Fr(f,c,n-90,l),f},d.bc=function(c,n,l,f){var _,b,v,T,E,I=n[0],P=n[1],O=n[2],z=n[3],j=l[0],H=l[1],W=l[2],K=l[3];return(b=I*j+P*H+O*W+z*K)<0&&(b=-b,j=-j,H=-H,W=-W,K=-K),1-b>Te?(_=Math.acos(b),v=Math.sin(_),T=Math.sin((1-f)*_)/v,E=Math.sin(f*_)/v):(T=1-f,E=f),c[0]=T*I+E*j,c[1]=T*P+E*H,c[2]=T*O+E*W,c[3]=T*z+E*K,c},d.bd=function(c){const n=new Float64Array(9);var l,f,_,b,v,T,E,I,P,O,z,j,H,W,K,ie,me,he;O=(_=(f=c)[0])*(E=_+_),z=(b=f[1])*E,H=(v=f[2])*E,W=v*(I=b+b),ie=(T=f[3])*E,me=T*I,he=T*(P=v+v),(l=n)[0]=1-(j=b*I)-(K=v*P),l[3]=z-he,l[6]=H+me,l[1]=z+he,l[4]=1-O-K,l[7]=W-ie,l[2]=H-me,l[5]=W+ie,l[8]=1-O-j;const fe=ln(-Math.asin(Ir(n[2],-1,1)));let Be,Ne;return Math.hypot(n[5],n[8])<.001?(Be=0,Ne=-ln(Math.atan2(n[3],n[4]))):(Be=ln(n[5]===0&&n[8]===0?0:Math.atan2(n[5],n[8])),Ne=ln(n[1]===0&&n[0]===0?0:Math.atan2(n[1],n[0]))),{roll:Be,pitch:fe+90,bearing:Ne}},d.be=function(c,n){return c.roll==n.roll&&c.pitch==n.pitch&&c.bearing==n.bearing},d.bf=yt,d.bg=co,d.bh=ph,d.bi=pd,d.bj=fh,d.bk=ar,d.bl=gs,d.bm=Rr,d.bn=function(c,n,l,f,_){return ar(f,_,Ir((c-n)/(l-n),0,1))},d.bo=Ai,d.bp=function(){return new Float64Array(3)},d.bq=function(c,n,l,f){return c[0]=n[0]+l[0]*f,c[1]=n[1]+l[1]*f,c[2]=n[2]+l[2]*f,c},d.br=Fr,d.bs=function(c,n,l){var f=l[0],_=l[1],b=l[2],v=n[0],T=n[1],E=n[2],I=_*E-b*T,P=b*v-f*E,O=f*T-_*v,z=_*O-b*P,j=b*I-f*O,H=f*P-_*I,W=2*l[3];return P*=W,O*=W,j*=2,H*=2,c[0]=v+(I*=W)+(z*=2),c[1]=T+P+j,c[2]=E+O+H,c},d.bt=function(c,n,l){const f=(_=[c[0],c[1],c[2],n[0],n[1],n[2],l[0],l[1],l[2]])[0]*((P=_[8])*(v=_[4])-(T=_[5])*(I=_[7]))+_[1]*(-P*(b=_[3])+T*(E=_[6]))+_[2]*(I*b-v*E);var _,b,v,T,E,I,P;if(f===0)return null;const O=bt([],[n[0],n[1],n[2]],[l[0],l[1],l[2]]),z=bt([],[l[0],l[1],l[2]],[c[0],c[1],c[2]]),j=bt([],[c[0],c[1],c[2]],[n[0],n[1],n[2]]),H=at([],O,-c[3]);return nt(H,H,at([],z,-n[3])),nt(H,H,at([],j,-l[3])),at(H,H,1/f),H},d.bu=y0,d.bv=function(){return new Float64Array(4)},d.bw=function(c,n,l,f){var _=[],b=[];return _[0]=n[0]-l[0],_[1]=n[1]-l[1],_[2]=n[2]-l[2],b[0]=_[0]*Math.cos(f)-_[1]*Math.sin(f),b[1]=_[0]*Math.sin(f)+_[1]*Math.cos(f),b[2]=_[2],c[0]=b[0]+l[0],c[1]=b[1]+l[1],c[2]=b[2]+l[2],c},d.bx=function(c,n,l,f){var _=[],b=[];return _[0]=n[0]-l[0],_[1]=n[1]-l[1],_[2]=n[2]-l[2],b[0]=_[0],b[1]=_[1]*Math.cos(f)-_[2]*Math.sin(f),b[2]=_[1]*Math.sin(f)+_[2]*Math.cos(f),c[0]=b[0]+l[0],c[1]=b[1]+l[1],c[2]=b[2]+l[2],c},d.by=function(c,n,l,f){var _=[],b=[];return _[0]=n[0]-l[0],_[1]=n[1]-l[1],_[2]=n[2]-l[2],b[0]=_[2]*Math.sin(f)+_[0]*Math.cos(f),b[1]=_[1],b[2]=_[2]*Math.cos(f)-_[0]*Math.sin(f),c[0]=b[0]+l[0],c[1]=b[1]+l[1],c[2]=b[2]+l[2],c},d.bz=function(c,n,l){var f=Math.sin(l),_=Math.cos(l),b=n[0],v=n[1],T=n[2],E=n[3],I=n[8],P=n[9],O=n[10],z=n[11];return n!==c&&(c[4]=n[4],c[5]=n[5],c[6]=n[6],c[7]=n[7],c[12]=n[12],c[13]=n[13],c[14]=n[14],c[15]=n[15]),c[0]=b*_-I*f,c[1]=v*_-P*f,c[2]=T*_-O*f,c[3]=E*_-z*f,c[8]=b*f+I*_,c[9]=v*f+P*_,c[10]=T*f+O*_,c[11]=E*f+z*_,c},d.c=ge,d.c0=R8,d.c1=class extends h{},d.c2=Jy,d.c3=function(c){return c<=1?1:Math.pow(2,Math.ceil(Math.log(c)/Math.LN2))},d.c4=yA,d.c5=function(c,n,l){var f=n[0],_=n[1],b=n[2],v=l[3]*f+l[7]*_+l[11]*b+l[15];return c[0]=(l[0]*f+l[4]*_+l[8]*b+l[12])/(v=v||1),c[1]=(l[1]*f+l[5]*_+l[9]*b+l[13])/v,c[2]=(l[2]*f+l[6]*_+l[10]*b+l[14])/v,c},d.c6=class extends rd{},d.c7=class extends R{},d.c8=function(c,n){return c[0]===n[0]&&c[1]===n[1]&&c[2]===n[2]&&c[3]===n[3]&&c[4]===n[4]&&c[5]===n[5]&&c[6]===n[6]&&c[7]===n[7]&&c[8]===n[8]&&c[9]===n[9]&&c[10]===n[10]&&c[11]===n[11]&&c[12]===n[12]&&c[13]===n[13]&&c[14]===n[14]&&c[15]===n[15]},d.c9=function(c,n){var l=c[0],f=c[1],_=c[2],b=c[3],v=c[4],T=c[5],E=c[6],I=c[7],P=c[8],O=c[9],z=c[10],j=c[11],H=c[12],W=c[13],K=c[14],ie=c[15],me=n[0],he=n[1],fe=n[2],Be=n[3],Ne=n[4],He=n[5],st=n[6],Ke=n[7],et=n[8],_t=n[9],Qe=n[10],tt=n[11],ze=n[12],wt=n[13],Et=n[14],mt=n[15];return Math.abs(l-me)<=Te*Math.max(1,Math.abs(l),Math.abs(me))&&Math.abs(f-he)<=Te*Math.max(1,Math.abs(f),Math.abs(he))&&Math.abs(_-fe)<=Te*Math.max(1,Math.abs(_),Math.abs(fe))&&Math.abs(b-Be)<=Te*Math.max(1,Math.abs(b),Math.abs(Be))&&Math.abs(v-Ne)<=Te*Math.max(1,Math.abs(v),Math.abs(Ne))&&Math.abs(T-He)<=Te*Math.max(1,Math.abs(T),Math.abs(He))&&Math.abs(E-st)<=Te*Math.max(1,Math.abs(E),Math.abs(st))&&Math.abs(I-Ke)<=Te*Math.max(1,Math.abs(I),Math.abs(Ke))&&Math.abs(P-et)<=Te*Math.max(1,Math.abs(P),Math.abs(et))&&Math.abs(O-_t)<=Te*Math.max(1,Math.abs(O),Math.abs(_t))&&Math.abs(z-Qe)<=Te*Math.max(1,Math.abs(z),Math.abs(Qe))&&Math.abs(j-tt)<=Te*Math.max(1,Math.abs(j),Math.abs(tt))&&Math.abs(H-ze)<=Te*Math.max(1,Math.abs(H),Math.abs(ze))&&Math.abs(W-wt)<=Te*Math.max(1,Math.abs(W),Math.abs(wt))&&Math.abs(K-Et)<=Te*Math.max(1,Math.abs(K),Math.abs(Et))&&Math.abs(ie-mt)<=Te*Math.max(1,Math.abs(ie),Math.abs(mt))},d.cA=function(c,n){$.REGISTERED_PROTOCOLS[c]=n},d.cB=function(c){delete $.REGISTERED_PROTOCOLS[c]},d.cC=function(c,n){const l={};for(let _=0;_<c.length;_++){const b=n&&n[c[_].id]||zy(c[_]);n&&(n[c[_].id]=b);let v=l[b];v||(v=l[b]=[]),v.push(c[_])}const f=[];for(const _ in l)f.push(l[_]);return f},d.cD=ot,d.cE=_E,d.cF=mE,d.cG=XA,d.cH=function(c){c.bucket.createArrays(),c.bucket.tilePixelRatio=Gt/(512*c.bucket.overscaling),c.bucket.compareText={},c.bucket.iconsNeedLinear=!1;const n=c.bucket.layers[0],l=n.layout,f=n._unevaluatedLayout._values,_={layoutIconSize:f["icon-size"].possiblyEvaluate(new vi(c.bucket.zoom+1),c.canonical),layoutTextSize:f["text-size"].possiblyEvaluate(new vi(c.bucket.zoom+1),c.canonical),textMaxSize:f["text-size"].possiblyEvaluate(new vi(18))};if(c.bucket.textSizeData.kind==="composite"){const{minZoom:I,maxZoom:P}=c.bucket.textSizeData;_.compositeTextSizes=[f["text-size"].possiblyEvaluate(new vi(I),c.canonical),f["text-size"].possiblyEvaluate(new vi(P),c.canonical)]}if(c.bucket.iconSizeData.kind==="composite"){const{minZoom:I,maxZoom:P}=c.bucket.iconSizeData;_.compositeIconSizes=[f["icon-size"].possiblyEvaluate(new vi(I),c.canonical),f["icon-size"].possiblyEvaluate(new vi(P),c.canonical)]}const b=l.get("text-line-height")*dr,v=l.get("text-rotation-alignment")!=="viewport"&&l.get("symbol-placement")!=="point",T=l.get("text-keep-upright"),E=l.get("text-size");for(const I of c.bucket.features){const P=l.get("text-font").evaluate(I,{},c.canonical).join(","),O=E.evaluate(I,{},c.canonical),z=_.layoutTextSize.evaluate(I,{},c.canonical),j=_.layoutIconSize.evaluate(I,{},c.canonical),H={horizontal:{},vertical:void 0},W=I.text;let K,ie=[0,0];if(W){const fe=W.toString(),Be=l.get("text-letter-spacing").evaluate(I,{},c.canonical)*dr,Ne=Gy(fe)?Be:0,He=l.get("text-anchor").evaluate(I,{},c.canonical),st=IE(n,I,c.canonical);if(!st){const Qe=l.get("text-radial-offset").evaluate(I,{},c.canonical);ie=Qe?CE(He,[Qe*dr,x0]):l.get("text-offset").evaluate(I,{},c.canonical).map(tt=>tt*dr)}let Ke=v?"center":l.get("text-justify").evaluate(I,{},c.canonical);const et=l.get("symbol-placement")==="point"?l.get("text-max-width").evaluate(I,{},c.canonical)*dr:1/0,_t=()=>{c.bucket.allowVerticalPlacement&&th(fe)&&(H.vertical=l_(W,c.glyphMap,c.glyphPositions,c.imagePositions,P,et,b,He,"left",Ne,ie,d.ao.vertical,!0,z,O))};if(!v&&st){const Qe=new Set;if(Ke==="auto")for(let ze=0;ze<st.values.length;ze+=2)Qe.add(w0(st.values[ze]));else Qe.add(Ke);let tt=!1;for(const ze of Qe)if(!H.horizontal[ze])if(tt)H.horizontal[ze]=H.horizontal[0];else{const wt=l_(W,c.glyphMap,c.glyphPositions,c.imagePositions,P,et,b,"center",ze,Ne,ie,d.ao.horizontal,!1,z,O);wt&&(H.horizontal[ze]=wt,tt=wt.positionedLines.length===1)}_t()}else{Ke==="auto"&&(Ke=w0(He));const Qe=l_(W,c.glyphMap,c.glyphPositions,c.imagePositions,P,et,b,He,Ke,Ne,ie,d.ao.horizontal,!1,z,O);Qe&&(H.horizontal[Ke]=Qe),_t(),th(fe)&&v&&T&&(H.vertical=l_(W,c.glyphMap,c.glyphPositions,c.imagePositions,P,et,b,He,Ke,Ne,ie,d.ao.vertical,!1,z,O))}}let me=!1;if(I.icon&&I.icon.name){const fe=c.imageMap[I.icon.name];fe&&(K=J8(c.imagePositions[I.icon.name],l.get("icon-offset").evaluate(I,{},c.canonical),l.get("icon-anchor").evaluate(I,{},c.canonical)),me=!!fe.sdf,c.bucket.sdfIcons===void 0?c.bucket.sdfIcons=me:c.bucket.sdfIcons!==me&&ci("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(fe.pixelRatio!==c.bucket.pixelRatio||l.get("icon-rotate").constantOr(1)!==0)&&(c.bucket.iconsNeedLinear=!0))}const he=RE(H.horizontal)||H.vertical;c.bucket.iconsInText=!!he&&he.iconsInText,(he||K)&&pV(c.bucket,I,H,K,c.imageMap,_,z,j,ie,me,c.canonical,c.subdivisionGranularity)}c.showCollisionBoxes&&c.bucket.generateCollisionDebugBuffers()},d.cI=a0,d.cJ=s0,d.cK=o0,d.cL=DA,d.cM=c0,d.cN=class{constructor(c){this._marks={start:[c.url,"start"].join("#"),end:[c.url,"end"].join("#"),measure:c.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let c=performance.getEntriesByName(this._marks.measure);return c.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),c=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),c}},d.cO=function(c,n,l,f,_){return a(this,void 0,void 0,function*(){if(Ae())try{return yield Ps(c,n,l,f,_)}catch{}return function(b,v,T,E,I){const P=b.width,O=b.height;Li&&on||(Li=new OffscreenCanvas(P,O),on=Li.getContext("2d",{willReadFrequently:!0})),Li.width=P,Li.height=O,on.drawImage(b,0,0,P,O);const z=on.getImageData(v,T,E,I);return on.clearRect(0,0,P,O),z.data}(c,n,l,f,_)})},d.cP=xA,d.cQ=A,d.cR=BA,d.cS=_h,d.cT=wl,d.cU=function(c,n){const l=new Map;if(c!=null)if(c.type==="Feature")l.set(xd(c,n),c);else for(const f of c.features)l.set(xd(f,n),f);return l},d.cV=function(c,n){if(c==null)return!0;if(c.type==="Feature")return xd(c,n)!=null;if(c.type==="FeatureCollection"){const l=new Set;for(const f of c.features){const _=xd(f,n);if(_==null||l.has(_))return!1;l.add(_)}return!0}return!1},d.cW=function(c,n,l){var f,_,b,v;if(n.removeAll&&c.clear(),n.remove)for(const T of n.remove)c.delete(T);if(n.add)for(const T of n.add){const E=xd(T,l);E!=null&&c.set(E,T)}if(n.update)for(const T of n.update){let E=c.get(T.id);if(E==null)continue;const I=!T.removeAllProperties&&(((f=T.removeProperties)===null||f===void 0?void 0:f.length)>0||((_=T.addOrUpdateProperties)===null||_===void 0?void 0:_.length)>0);if((T.newGeometry||T.removeAllProperties||I)&&(E=Object.assign({},E),c.set(T.id,E),I&&(E.properties=Object.assign({},E.properties))),T.newGeometry&&(E.geometry=T.newGeometry),T.removeAllProperties)E.properties={};else if(((b=T.removeProperties)===null||b===void 0?void 0:b.length)>0)for(const P of T.removeProperties)Object.prototype.hasOwnProperty.call(E.properties,P)&&delete E.properties[P];if(((v=T.addOrUpdateProperties)===null||v===void 0?void 0:v.length)>0)for(const{key:P,value:O}of T.addOrUpdateProperties)E.properties[P]=O}},d.cX=Gs,d.ca=function(c,n){return c[0]=n[0],c[1]=n[1],c[2]=n[2],c[3]=n[3],c[4]=n[4],c[5]=n[5],c[6]=n[6],c[7]=n[7],c[8]=n[8],c[9]=n[9],c[10]=n[10],c[11]=n[11],c[12]=n[12],c[13]=n[13],c[14]=n[14],c[15]=n[15],c},d.cb=c=>c.type==="symbol",d.cc=c=>c.type==="circle",d.cd=c=>c.type==="heatmap",d.ce=c=>c.type==="line",d.cf=c=>c.type==="fill",d.cg=c=>c.type==="fill-extrusion",d.ch=c=>c.type==="hillshade",d.ci=c=>c.type==="color-relief",d.cj=c=>c.type==="raster",d.ck=c=>c.type==="background",d.cl=c=>c.type==="custom",d.cm=ms,d.cn=function(c,n,l){const f=Qn(n.x-l.x,n.y-l.y),_=Qn(c.x-l.x,c.y-l.y);var b,v;return ln(Math.atan2(f[0]*_[1]-f[1]*_[0],(b=f)[0]*(v=_)[0]+b[1]*v[1]))},d.co=In,d.cp=function(c,n){return Bs[n]&&(c instanceof MouseEvent||c instanceof WheelEvent)},d.cq=function(c,n){return cn[n]&&"touches"in c},d.cr=function(c){return cn[c]||Bs[c]},d.cs=function(c,n,l){var f=n[0],_=n[1];return c[0]=l[0]*f+l[4]*_+l[12],c[1]=l[1]*f+l[5]*_+l[13],c},d.ct=function(c,n){const{x:l,y:f}=vd.fromLngLat(n);return!(c<0||c>25||f<0||f>=1||l<0||l>=1)},d.cu=function(c,n){return c[0]=n[0],c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=n[1],c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=n[2],c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c},d.cv=class extends Sa{},d.cw=gV,d.cy=function(c){return c.message===Rn},d.cz=oe,d.d=Re,d.e=$i,d.f=c=>a(void 0,void 0,void 0,function*(){if(c.byteLength===0)return createImageBitmap(new ImageData(1,1));const n=new Blob([new Uint8Array(c)],{type:"image/png"});try{return createImageBitmap(n)}catch(l){throw new Error(`Could not load image because of ${l.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),d.g=X,d.h=c=>new Promise((n,l)=>{const f=new Image;f.onload=()=>{n(f),URL.revokeObjectURL(f.src),f.onload=null,window.requestAnimationFrame(()=>{f.src=rs})},f.onerror=()=>l(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const _=new Blob([new Uint8Array(c)],{type:"image/png"});f.src=c.byteLength?URL.createObjectURL(_):rs}),d.i=Ni,d.j=(c,n)=>ye($i(c,{type:"json"}),n),d.k=Ve,d.l=Ge,d.m=ye,d.n=(c,n)=>ye($i(c,{type:"arrayBuffer"}),n),d.o=function(c){return new c0(c).readFields(V8,[])},d.p=WA,d.q=cd,d.r=jr,d.s=an,d.t=Yp,d.u=Ut,d.v=we,d.w=ci,d.x=Vy,d.y=Ml,d.z=wa}),o("worker",["./shared"],function(d){class a{constructor($){this.keyCache={},$&&this.replace($)}replace($){this._layerConfigs={},this._layers={},this.update($,[])}update($,X){for(const oe of $){this._layerConfigs[oe.id]=oe;const pe=this._layers[oe.id]=d.bJ(oe);pe._featureFilter=d.aa(pe.filter),this.keyCache[oe.id]&&delete this.keyCache[oe.id]}for(const oe of X)delete this.keyCache[oe],delete this._layerConfigs[oe],delete this._layers[oe];this.familiesBySource={};const Z=d.cC(Object.values(this._layerConfigs),this.keyCache);for(const oe of Z){const pe=oe.map(Ve=>this._layers[Ve.id]),ye=pe[0];if(ye.visibility==="none")continue;const Re=ye.source||"";let be=this.familiesBySource[Re];be||(be=this.familiesBySource[Re]={});const Le=ye.sourceLayer||"_geojsonTileLayer";let Ge=be[Le];Ge||(Ge=be[Le]=[]),Ge.push(pe)}}}class x{constructor($){const X={},Z=[];for(const Re in $){const be=$[Re],Le=X[Re]={};for(const Ge in be){const Ve=be[+Ge];if(!Ve||Ve.bitmap.width===0||Ve.bitmap.height===0)continue;const ct={x:0,y:0,w:Ve.bitmap.width+2,h:Ve.bitmap.height+2};Z.push(ct),Le[Ge]={rect:ct,metrics:Ve.metrics}}}const{w:oe,h:pe}=d.p(Z),ye=new d.q({width:oe||1,height:pe||1});for(const Re in $){const be=$[Re];for(const Le in be){const Ge=be[+Le];if(!Ge||Ge.bitmap.width===0||Ge.bitmap.height===0)continue;const Ve=X[Re][Le].rect;d.q.copy(Ge.bitmap,ye,{x:0,y:0},{x:Ve.x+1,y:Ve.y+1},Ge.bitmap)}}this.image=ye,this.positions=X}}d.cD("GlyphAtlas",x);class A{constructor($){this.tileID=new d.Z($.tileID.overscaledZ,$.tileID.wrap,$.tileID.canonical.z,$.tileID.canonical.x,$.tileID.canonical.y),this.uid=$.uid,this.zoom=$.zoom,this.pixelRatio=$.pixelRatio,this.tileSize=$.tileSize,this.source=$.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=$.showCollisionBoxes,this.collectResourceTiming=!!$.collectResourceTiming,this.returnDependencies=!!$.returnDependencies,this.promoteId=$.promoteId,this.inFlightDependencies=[],this.globalState=$.globalState}parse($,X,Z,oe,pe){return d._(this,void 0,void 0,function*(){this.status="parsing",this.data=$,this.collisionBoxArray=new d.a8;const ye=new d.cE(Object.keys($.layers).sort()),Re=new d.cF(this.tileID,this.promoteId);Re.bucketLayerIDs=[];const be={},Le={featureIndex:Re,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:Z,subdivisionGranularity:pe},Ge=X.familiesBySource[this.source];for(const Bt in Ge){const Lt=$.layers[Bt];if(!Lt)continue;Lt.version===1&&d.w(`Vector tile source "${this.source}" layer "${Bt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Bi=ye.encode(Bt),We=[];for(let Wi=0;Wi<Lt.length;Wi++){const bi=Lt.feature(Wi),Ds=Re.getId(bi,Bt);We.push({feature:bi,id:Ds,index:Wi,sourceLayerIndex:Bi})}for(const Wi of Ge[Bt]){const bi=Wi[0];bi.source!==this.source&&d.w(`layer.source = ${bi.source} does not equal this.source = ${this.source}`),bi.minzoom&&this.zoom<Math.floor(bi.minzoom)||bi.maxzoom&&this.zoom>=bi.maxzoom||bi.visibility!=="none"&&(M(Wi,this.zoom,Z),(be[bi.id]=bi.createBucket({index:Re.bucketLayerIDs.length,layers:Wi,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Bi,sourceID:this.source,globalState:this.globalState})).populate(We,Le,this.tileID.canonical),Re.bucketLayerIDs.push(Wi.map(Ds=>Ds.id)))}}const Ve=d.bN(Le.glyphDependencies,Bt=>Object.keys(Bt).map(Number));this.inFlightDependencies.forEach(Bt=>Bt==null?void 0:Bt.abort()),this.inFlightDependencies=[];let ct=Promise.resolve({});if(Object.keys(Ve).length){const Bt=new AbortController;this.inFlightDependencies.push(Bt),ct=oe.sendAsync({type:"GG",data:{stacks:Ve,source:this.source,tileID:this.tileID,type:"glyphs"}},Bt)}const we=Object.keys(Le.iconDependencies);let Tt=Promise.resolve({});if(we.length){const Bt=new AbortController;this.inFlightDependencies.push(Bt),Tt=oe.sendAsync({type:"GI",data:{icons:we,source:this.source,tileID:this.tileID,type:"icons"}},Bt)}const Ft=Object.keys(Le.patternDependencies);let pt=Promise.resolve({});if(Ft.length){const Bt=new AbortController;this.inFlightDependencies.push(Bt),pt=oe.sendAsync({type:"GI",data:{icons:Ft,source:this.source,tileID:this.tileID,type:"patterns"}},Bt)}const[Ct,Qt,Ui]=yield Promise.all([ct,Tt,pt]),zi=new x(Ct),Ei=new d.cG(Qt,Ui);for(const Bt in be){const Lt=be[Bt];Lt instanceof d.a9?(M(Lt.layers,this.zoom,Z),d.cH({bucket:Lt,glyphMap:Ct,glyphPositions:zi.positions,imageMap:Qt,imagePositions:Ei.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:Le.subdivisionGranularity})):Lt.hasPattern&&(Lt instanceof d.cI||Lt instanceof d.cJ||Lt instanceof d.cK)&&(M(Lt.layers,this.zoom,Z),Lt.addFeatures(Le,this.tileID.canonical,Ei.patternPositions))}return this.status="done",{buckets:Object.values(be).filter(Bt=>!Bt.isEmpty()),featureIndex:Re,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:zi.image,imageAtlas:Ei,glyphMap:this.returnDependencies?Ct:null,iconMap:this.returnDependencies?Qt:null,glyphPositions:this.returnDependencies?zi.positions:null}})}}function M(ge,$,X){const Z=new d.F($);for(const oe of ge)oe.recalculate(Z,X)}class D{constructor($,X,Z){this.actor=$,this.layerIndex=X,this.availableImages=Z,this.fetching={},this.loading={},this.loaded={}}loadVectorTile($,X){return d._(this,void 0,void 0,function*(){const Z=yield d.n($.request,X);try{return{vectorTile:new d.cL(new d.cM(Z.data)),rawData:Z.data,cacheControl:Z.cacheControl,expires:Z.expires}}catch(oe){const pe=new Uint8Array(Z.data);let ye=`Unable to parse the tile at ${$.request.url}, `;throw ye+=pe[0]===31&&pe[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${oe.message}`,new Error(ye)}})}loadTile($){return d._(this,void 0,void 0,function*(){const X=$.uid,Z=!!($&&$.request&&$.request.collectResourceTiming)&&new d.cN($.request),oe=new A($);this.loading[X]=oe;const pe=new AbortController;oe.abort=pe;try{const ye=yield this.loadVectorTile($,pe);if(delete this.loading[X],!ye)return null;const Re=ye.rawData,be={};ye.expires&&(be.expires=ye.expires),ye.cacheControl&&(be.cacheControl=ye.cacheControl);const Le={};if(Z){const Ve=Z.finish();Ve&&(Le.resourceTiming=JSON.parse(JSON.stringify(Ve)))}oe.vectorTile=ye.vectorTile;const Ge=oe.parse(ye.vectorTile,this.layerIndex,this.availableImages,this.actor,$.subdivisionGranularity);this.loaded[X]=oe,this.fetching[X]={rawTileData:Re,cacheControl:be,resourceTiming:Le};try{const Ve=yield Ge;return d.e({rawTileData:Re.slice(0)},Ve,be,Le)}finally{delete this.fetching[X]}}catch(ye){throw delete this.loading[X],oe.status="done",this.loaded[X]=oe,ye}})}reloadTile($){return d._(this,void 0,void 0,function*(){const X=$.uid;if(!this.loaded||!this.loaded[X])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const Z=this.loaded[X];if(Z.showCollisionBoxes=$.showCollisionBoxes,Z.globalState=$.globalState,Z.status==="parsing"){const oe=yield Z.parse(Z.vectorTile,this.layerIndex,this.availableImages,this.actor,$.subdivisionGranularity);let pe;if(this.fetching[X]){const{rawTileData:ye,cacheControl:Re,resourceTiming:be}=this.fetching[X];delete this.fetching[X],pe=d.e({rawTileData:ye.slice(0)},oe,Re,be)}else pe=oe;return pe}if(Z.status==="done"&&Z.vectorTile)return Z.parse(Z.vectorTile,this.layerIndex,this.availableImages,this.actor,$.subdivisionGranularity)})}abortTile($){return d._(this,void 0,void 0,function*(){const X=this.loading,Z=$.uid;X&&X[Z]&&X[Z].abort&&(X[Z].abort.abort(),delete X[Z])})}removeTile($){return d._(this,void 0,void 0,function*(){this.loaded&&this.loaded[$.uid]&&delete this.loaded[$.uid]})}}class N{constructor(){this.loaded={}}loadTile($){return d._(this,void 0,void 0,function*(){const{uid:X,encoding:Z,rawImageData:oe,redFactor:pe,greenFactor:ye,blueFactor:Re,baseShift:be}=$,Le=oe.width+2,Ge=oe.height+2,Ve=d.b(oe)?new d.R({width:Le,height:Ge},yield d.cO(oe,-1,-1,Le,Ge)):oe,ct=new d.cP(X,Ve,Z,pe,ye,Re,be);return this.loaded=this.loaded||{},this.loaded[X]=ct,ct})}removeTile($){const X=this.loaded,Z=$.uid;X&&X[Z]&&delete X[Z]}}var U,re,ne=function(){if(re)return U;function ge(X,Z){if(X.length!==0){$(X[0],Z);for(var oe=1;oe<X.length;oe++)$(X[oe],!Z)}}function $(X,Z){for(var oe=0,pe=0,ye=0,Re=X.length,be=Re-1;ye<Re;be=ye++){var Le=(X[ye][0]-X[be][0])*(X[be][1]+X[ye][1]),Ge=oe+Le;pe+=Math.abs(oe)>=Math.abs(Le)?oe-Ge+Le:Le-Ge+oe,oe=Ge}oe+pe>=0!=!!Z&&X.reverse()}return re=1,U=function X(Z,oe){var pe,ye=Z&&Z.type;if(ye==="FeatureCollection")for(pe=0;pe<Z.features.length;pe++)X(Z.features[pe],oe);else if(ye==="GeometryCollection")for(pe=0;pe<Z.geometries.length;pe++)X(Z.geometries[pe],oe);else if(ye==="Feature")X(Z.geometry,oe);else if(ye==="Polygon")ge(Z.coordinates,oe);else if(ye==="MultiPolygon")for(pe=0;pe<Z.coordinates.length;pe++)ge(Z.coordinates[pe],oe);return Z}}(),xe=d.cQ(ne);class Ae extends d.cS{constructor($,X){super(new d.cM,0,X,[],[]),this.feature=$,this.type=$.type,this.properties=$.tags?$.tags:{},"id"in $&&(typeof $.id=="string"?this.id=parseInt($.id,10):typeof $.id!="number"||isNaN($.id)||(this.id=$.id))}loadGeometry(){const $=[],X=this.feature.type===1?[this.feature.geometry]:this.feature.geometry;for(const Z of X){const oe=[];for(const pe of Z)oe.push(new d.P(pe[0],pe[1]));$.push(oe)}return $}}class Te extends d.cR{constructor($,X){super(new d.cM),this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.version=X?X.version:1,this.extent=X?X.extent:4096,this.length=$.length,this.features=$}feature($){return new Ae(this.features[$],this.extent)}}function Ie(ge,$){$.writeVarintField(15,ge.version||1),$.writeStringField(1,ge.name||""),$.writeVarintField(5,ge.extent||4096);const X={keys:[],values:[],keycache:{},valuecache:{}};for(let pe=0;pe<ge.length;pe++)X.feature=ge.feature(pe),$.writeMessage(2,Ue,X);const Z=X.keys;for(const pe of Z)$.writeStringField(3,pe);const oe=X.values;for(const pe of oe)$.writeMessage(4,nt,pe)}function Ue(ge,$){if(!ge.feature)return;const X=ge.feature;X.id!==void 0&&$.writeVarintField(1,X.id),$.writeMessage(2,Xe,ge),$.writeVarintField(3,X.type),$.writeMessage(4,gt,X)}function Xe(ge,$){var X;for(const Z in(X=ge.feature)==null?void 0:X.properties){let oe=ge.feature.properties[Z],pe=ge.keycache[Z];if(oe===null)continue;pe===void 0&&(ge.keys.push(Z),pe=ge.keys.length-1,ge.keycache[Z]=pe),$.writeVarint(pe),typeof oe!="string"&&typeof oe!="boolean"&&typeof oe!="number"&&(oe=JSON.stringify(oe));const ye=typeof oe+":"+oe;let Re=ge.valuecache[ye];Re===void 0&&(ge.values.push(oe),Re=ge.values.length-1,ge.valuecache[ye]=Re),$.writeVarint(Re)}}function qe(ge,$){return($<<3)+(7&ge)}function ht(ge){return ge<<1^ge>>31}function gt(ge,$){const X=ge.loadGeometry(),Z=ge.type;let oe=0,pe=0;for(const ye of X){let Re=1;Z===1&&(Re=ye.length),$.writeVarint(qe(1,Re));const be=Z===3?ye.length-1:ye.length;for(let Le=0;Le<be;Le++){Le===1&&Z!==1&&$.writeVarint(qe(2,be-1));const Ge=ye[Le].x-oe,Ve=ye[Le].y-pe;$.writeVarint(ht(Ge)),$.writeVarint(ht(Ve)),oe+=Ge,pe+=Ve}ge.type===3&&$.writeVarint(qe(7,1))}}function nt(ge,$){const X=typeof ge;X==="string"?$.writeStringField(1,ge):X==="boolean"?$.writeBooleanField(7,ge):X==="number"&&(ge%1!=0?$.writeDoubleField(3,ge):ge<0?$.writeSVarintField(6,ge):$.writeVarintField(5,ge))}const at={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ge=>ge},bt=Math.fround||(kt=new Float32Array(1),ge=>(kt[0]=+ge,kt[0]));var kt;class Ht{constructor($){this.options=Object.assign(Object.create(at),$),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load($){const{log:X,minZoom:Z,maxZoom:oe}=this.options;X&&console.time("total time");const pe=`prepare ${$.length} points`;X&&console.time(pe),this.points=$;const ye=[];for(let be=0;be<$.length;be++){const Le=$[be];if(!Le.geometry)continue;const[Ge,Ve]=Le.geometry.coordinates,ct=bt(Fr(Ge)),we=bt(br(Ve));ye.push(ct,we,1/0,be,-1,1),this.options.reduce&&ye.push(0)}let Re=this.trees[oe+1]=this._createTree(ye);X&&console.timeEnd(pe);for(let be=oe;be>=Z;be--){const Le=+Date.now();Re=this.trees[be]=this._createTree(this._cluster(Re,be)),X&&console.log("z%d: %d clusters in %dms",be,Re.numItems,+Date.now()-Le)}return X&&console.timeEnd("total time"),this}getClusters($,X){let Z=(($[0]+180)%360+360)%360-180;const oe=Math.max(-90,Math.min(90,$[1]));let pe=$[2]===180?180:(($[2]+180)%360+360)%360-180;const ye=Math.max(-90,Math.min(90,$[3]));if($[2]-$[0]>=360)Z=-180,pe=180;else if(Z>pe){const Ve=this.getClusters([Z,oe,180,ye],X),ct=this.getClusters([-180,oe,pe,ye],X);return Ve.concat(ct)}const Re=this.trees[this._limitZoom(X)],be=Re.range(Fr(Z),br(ye),Fr(pe),br(oe)),Le=Re.data,Ge=[];for(const Ve of be){const ct=this.stride*Ve;Ge.push(Le[ct+5]>1?St(Le,ct,this.clusterProps):this.points[Le[ct+3]])}return Ge}getChildren($){const X=this._getOriginId($),Z=this._getOriginZoom($),oe="No cluster with the specified id.",pe=this.trees[Z];if(!pe)throw new Error(oe);const ye=pe.data;if(X*this.stride>=ye.length)throw new Error(oe);const Re=this.options.radius/(this.options.extent*Math.pow(2,Z-1)),be=pe.within(ye[X*this.stride],ye[X*this.stride+1],Re),Le=[];for(const Ge of be){const Ve=Ge*this.stride;ye[Ve+4]===$&&Le.push(ye[Ve+5]>1?St(ye,Ve,this.clusterProps):this.points[ye[Ve+3]])}if(Le.length===0)throw new Error(oe);return Le}getLeaves($,X,Z){const oe=[];return this._appendLeaves(oe,$,X=X||10,Z=Z||0,0),oe}getTile($,X,Z){const oe=this.trees[this._limitZoom($)],pe=Math.pow(2,$),{extent:ye,radius:Re}=this.options,be=Re/ye,Le=(Z-be)/pe,Ge=(Z+1+be)/pe,Ve={features:[]};return this._addTileFeatures(oe.range((X-be)/pe,Le,(X+1+be)/pe,Ge),oe.data,X,Z,pe,Ve),X===0&&this._addTileFeatures(oe.range(1-be/pe,Le,1,Ge),oe.data,pe,Z,pe,Ve),X===pe-1&&this._addTileFeatures(oe.range(0,Le,be/pe,Ge),oe.data,-1,Z,pe,Ve),Ve.features.length?Ve:null}getClusterExpansionZoom($){let X=this._getOriginZoom($)-1;for(;X<=this.options.maxZoom;){const Z=this.getChildren($);if(X++,Z.length!==1)break;$=Z[0].properties.cluster_id}return X}_appendLeaves($,X,Z,oe,pe){const ye=this.getChildren(X);for(const Re of ye){const be=Re.properties;if(be&&be.cluster?pe+be.point_count<=oe?pe+=be.point_count:pe=this._appendLeaves($,be.cluster_id,Z,oe,pe):pe<oe?pe++:$.push(Re),$.length===Z)break}return pe}_createTree($){const X=new d.aI($.length/this.stride|0,this.options.nodeSize,Float32Array);for(let Z=0;Z<$.length;Z+=this.stride)X.add($[Z],$[Z+1]);return X.finish(),X.data=$,X}_addTileFeatures($,X,Z,oe,pe,ye){for(const Re of $){const be=Re*this.stride,Le=X[be+5]>1;let Ge,Ve,ct;if(Le)Ge=xi(X,be,this.clusterProps),Ve=X[be],ct=X[be+1];else{const Ft=this.points[X[be+3]];Ge=Ft.properties;const[pt,Ct]=Ft.geometry.coordinates;Ve=Fr(pt),ct=br(Ct)}const we={type:1,geometry:[[Math.round(this.options.extent*(Ve*pe-Z)),Math.round(this.options.extent*(ct*pe-oe))]],tags:Ge};let Tt;Tt=Le||this.options.generateId?X[be+3]:this.points[X[be+3]].id,Tt!==void 0&&(we.id=Tt),ye.features.push(we)}}_limitZoom($){return Math.max(this.options.minZoom,Math.min(Math.floor(+$),this.options.maxZoom+1))}_cluster($,X){const{radius:Z,extent:oe,reduce:pe,minPoints:ye}=this.options,Re=Z/(oe*Math.pow(2,X)),be=$.data,Le=[],Ge=this.stride;for(let Ve=0;Ve<be.length;Ve+=Ge){if(be[Ve+2]<=X)continue;be[Ve+2]=X;const ct=be[Ve],we=be[Ve+1],Tt=$.within(be[Ve],be[Ve+1],Re),Ft=be[Ve+5];let pt=Ft;for(const Ct of Tt){const Qt=Ct*Ge;be[Qt+2]>X&&(pt+=be[Qt+5])}if(pt>Ft&&pt>=ye){let Ct,Qt=ct*Ft,Ui=we*Ft,zi=-1;const Ei=(Ve/Ge<<5)+(X+1)+this.points.length;for(const Bt of Tt){const Lt=Bt*Ge;if(be[Lt+2]<=X)continue;be[Lt+2]=X;const Bi=be[Lt+5];Qt+=be[Lt]*Bi,Ui+=be[Lt+1]*Bi,be[Lt+4]=Ei,pe&&(Ct||(Ct=this._map(be,Ve,!0),zi=this.clusterProps.length,this.clusterProps.push(Ct)),pe(Ct,this._map(be,Lt)))}be[Ve+4]=Ei,Le.push(Qt/pt,Ui/pt,1/0,Ei,-1,pt),pe&&Le.push(zi)}else{for(let Ct=0;Ct<Ge;Ct++)Le.push(be[Ve+Ct]);if(pt>1)for(const Ct of Tt){const Qt=Ct*Ge;if(!(be[Qt+2]<=X)){be[Qt+2]=X;for(let Ui=0;Ui<Ge;Ui++)Le.push(be[Qt+Ui])}}}}return Le}_getOriginId($){return $-this.points.length>>5}_getOriginZoom($){return($-this.points.length)%32}_map($,X,Z){if($[X+5]>1){const ye=this.clusterProps[$[X+6]];return Z?Object.assign({},ye):ye}const oe=this.points[$[X+3]].properties,pe=this.options.map(oe);return Z&&pe===oe?Object.assign({},pe):pe}}function St(ge,$,X){return{type:"Feature",id:ge[$+3],properties:xi(ge,$,X),geometry:{type:"Point",coordinates:[(Z=ge[$],360*(Z-.5)),Qn(ge[$+1])]}};var Z}function xi(ge,$,X){const Z=ge[$+5],oe=Z>=1e4?`${Math.round(Z/1e3)}k`:Z>=1e3?Math.round(Z/100)/10+"k":Z,pe=ge[$+6],ye=pe===-1?{}:Object.assign({},X[pe]);return Object.assign(ye,{cluster:!0,cluster_id:ge[$+3],point_count:Z,point_count_abbreviated:oe})}function Fr(ge){return ge/360+.5}function br(ge){const $=Math.sin(ge*Math.PI/180),X=.5-.25*Math.log((1+$)/(1-$))/Math.PI;return X<0?0:X>1?1:X}function Qn(ge){const $=(180-360*ge)*Math.PI/180;return 360*Math.atan(Math.exp($))/Math.PI-90}function Gt(ge,$,X,Z){let oe=Z;const pe=$+(X-$>>1);let ye,Re=X-$;const be=ge[$],Le=ge[$+1],Ge=ge[X],Ve=ge[X+1];for(let ct=$+3;ct<X;ct+=3){const we=or(ge[ct],ge[ct+1],be,Le,Ge,Ve);if(we>oe)ye=ct,oe=we;else if(we===oe){const Tt=Math.abs(ct-pe);Tt<Re&&(ye=ct,Re=Tt)}}oe>Z&&(ye-$>3&&Gt(ge,$,ye,Z),ge[ye+2]=oe,X-ye>3&&Gt(ge,ye,X,Z))}function or(ge,$,X,Z,oe,pe){let ye=oe-X,Re=pe-Z;if(ye!==0||Re!==0){const be=((ge-X)*ye+($-Z)*Re)/(ye*ye+Re*Re);be>1?(X=oe,Z=pe):be>0&&(X+=ye*be,Z+=Re*be)}return ye=ge-X,Re=$-Z,ye*ye+Re*Re}function Ai(ge,$,X,Z){const oe={id:ge??null,type:$,geometry:X,tags:Z,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if($==="Point"||$==="MultiPoint"||$==="LineString")ar(oe,X);else if($==="Polygon")ar(oe,X[0]);else if($==="MultiLineString")for(const pe of X)ar(oe,pe);else if($==="MultiPolygon")for(const pe of X)ar(oe,pe[0]);return oe}function ar(ge,$){for(let X=0;X<$.length;X+=3)ge.minX=Math.min(ge.minX,$[X]),ge.minY=Math.min(ge.minY,$[X+1]),ge.maxX=Math.max(ge.maxX,$[X]),ge.maxY=Math.max(ge.maxY,$[X+1])}function gs(ge,$,X,Z){if(!$.geometry)return;const oe=$.geometry.coordinates;if(oe&&oe.length===0)return;const pe=$.geometry.type,ye=Math.pow(X.tolerance/((1<<X.maxZoom)*X.extent),2);let Re=[],be=$.id;if(X.promoteId?be=$.properties[X.promoteId]:X.generateId&&(be=Z||0),pe==="Point")ms(oe,Re);else if(pe==="MultiPoint")for(const Le of oe)ms(Le,Re);else if(pe==="LineString")In(oe,Re,ye,!1);else if(pe==="MultiLineString"){if(X.lineMetrics){for(const Le of oe)Re=[],In(Le,Re,ye,!1),ge.push(Ai(be,"LineString",Re,$.properties));return}Ir(oe,Re,ye,!1)}else if(pe==="Polygon")Ir(oe,Re,ye,!0);else{if(pe!=="MultiPolygon"){if(pe==="GeometryCollection"){for(const Le of $.geometry.geometries)gs(ge,{id:be,geometry:Le,properties:$.properties},X,Z);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Le of oe){const Ge=[];Ir(Le,Ge,ye,!0),Re.push(Ge)}}ge.push(Ai(be,pe,Re,$.properties))}function ms(ge,$){$.push(Pi(ge[0]),$i(ge[1]),0)}function In(ge,$,X,Z){let oe,pe,ye=0;for(let be=0;be<ge.length;be++){const Le=Pi(ge[be][0]),Ge=$i(ge[be][1]);$.push(Le,Ge,0),be>0&&(ye+=Z?(oe*Ge-Le*pe)/2:Math.sqrt(Math.pow(Le-oe,2)+Math.pow(Ge-pe,2))),oe=Le,pe=Ge}const Re=$.length-3;$[2]=1,Gt($,0,Re,X),$[Re+2]=1,$.size=Math.abs(ye),$.start=0,$.end=$.size}function Ir(ge,$,X,Z){for(let oe=0;oe<ge.length;oe++){const pe=[];In(ge[oe],pe,X,Z),$.push(pe)}}function Pi(ge){return ge/360+.5}function $i(ge){const $=Math.sin(ge*Math.PI/180),X=.5-.25*Math.log((1+$)/(1-$))/Math.PI;return X<0?0:X>1?1:X}function Zt(ge,$,X,Z,oe,pe,ye,Re){if(Z/=$,pe>=(X/=$)&&ye<Z)return ge;if(ye<X||pe>=Z)return null;const be=[];for(const Le of ge){const Ge=Le.geometry;let Ve=Le.type;const ct=oe===0?Le.minX:Le.minY,we=oe===0?Le.maxX:Le.maxY;if(ct>=X&&we<Z){be.push(Le);continue}if(we<X||ct>=Z)continue;let Tt=[];if(Ve==="Point"||Ve==="MultiPoint")ki(Ge,Tt,X,Z,oe);else if(Ve==="LineString")Rs(Ge,Tt,X,Z,oe,!1,Re.lineMetrics);else if(Ve==="MultiLineString")oi(Ge,Tt,X,Z,oe,!1);else if(Ve==="Polygon")oi(Ge,Tt,X,Z,oe,!0);else if(Ve==="MultiPolygon")for(const Ft of Ge){const pt=[];oi(Ft,pt,X,Z,oe,!0),pt.length&&Tt.push(pt)}if(Tt.length){if(Re.lineMetrics&&Ve==="LineString"){for(const Ft of Tt)be.push(Ai(Le.id,Ve,Ft,Le.tags));continue}Ve!=="LineString"&&Ve!=="MultiLineString"||(Tt.length===1?(Ve="LineString",Tt=Tt[0]):Ve="MultiLineString"),Ve!=="Point"&&Ve!=="MultiPoint"||(Ve=Tt.length===3?"Point":"MultiPoint"),be.push(Ai(Le.id,Ve,Tt,Le.tags))}}return be.length?be:null}function ki(ge,$,X,Z,oe){for(let pe=0;pe<ge.length;pe+=3){const ye=ge[pe+oe];ye>=X&&ye<=Z&&ci($,ge[pe],ge[pe+1],ge[pe+2])}}function Rs(ge,$,X,Z,oe,pe,ye){let Re=Qi(ge);const be=oe===0?vr:Ni;let Le,Ge,Ve=ge.start;for(let pt=0;pt<ge.length-3;pt+=3){const Ct=ge[pt],Qt=ge[pt+1],Ui=ge[pt+2],zi=ge[pt+3],Ei=ge[pt+4],Bt=oe===0?Ct:Qt,Lt=oe===0?zi:Ei;let Bi=!1;ye&&(Le=Math.sqrt(Math.pow(Ct-zi,2)+Math.pow(Qt-Ei,2))),Bt<X?Lt>X&&(Ge=be(Re,Ct,Qt,zi,Ei,X),ye&&(Re.start=Ve+Le*Ge)):Bt>Z?Lt<Z&&(Ge=be(Re,Ct,Qt,zi,Ei,Z),ye&&(Re.start=Ve+Le*Ge)):ci(Re,Ct,Qt,Ui),Lt<X&&Bt>=X&&(Ge=be(Re,Ct,Qt,zi,Ei,X),Bi=!0),Lt>Z&&Bt<=Z&&(Ge=be(Re,Ct,Qt,zi,Ei,Z),Bi=!0),!pe&&Bi&&(ye&&(Re.end=Ve+Le*Ge),$.push(Re),Re=Qi(ge)),ye&&(Ve+=Le)}let ct=ge.length-3;const we=ge[ct],Tt=ge[ct+1],Ft=oe===0?we:Tt;Ft>=X&&Ft<=Z&&ci(Re,we,Tt,ge[ct+2]),ct=Re.length-3,pe&&ct>=3&&(Re[ct]!==Re[0]||Re[ct+1]!==Re[1])&&ci(Re,Re[0],Re[1],Re[2]),Re.length&&$.push(Re)}function Qi(ge){const $=[];return $.size=ge.size,$.start=ge.start,$.end=ge.end,$}function oi(ge,$,X,Z,oe,pe){for(const ye of ge)Rs(ye,$,X,Z,oe,pe,!1)}function ci(ge,$,X,Z){ge.push($,X,Z)}function vr(ge,$,X,Z,oe,pe){const ye=(pe-$)/(Z-$);return ci(ge,pe,X+(oe-X)*ye,1),ye}function Ni(ge,$,X,Z,oe,pe){const ye=(pe-X)/(oe-X);return ci(ge,$+(Z-$)*ye,pe,1),ye}function kr(ge,$){const X=[];for(let Z=0;Z<ge.length;Z++){const oe=ge[Z],pe=oe.type;let ye;if(pe==="Point"||pe==="MultiPoint"||pe==="LineString")ye=is(oe.geometry,$);else if(pe==="MultiLineString"||pe==="Polygon"){ye=[];for(const Re of oe.geometry)ye.push(is(Re,$))}else if(pe==="MultiPolygon"){ye=[];for(const Re of oe.geometry){const be=[];for(const Le of Re)be.push(is(Le,$));ye.push(be)}}X.push(Ai(oe.id,pe,ye,oe.tags))}return X}function is(ge,$){const X=[];X.size=ge.size,ge.start!==void 0&&(X.start=ge.start,X.end=ge.end);for(let Z=0;Z<ge.length;Z+=3)X.push(ge[Z]+$,ge[Z+1],ge[Z+2]);return X}function rs(ge,$){if(ge.transformed)return ge;const X=1<<ge.z,Z=ge.x,oe=ge.y;for(const pe of ge.features){const ye=pe.geometry,Re=pe.type;if(pe.geometry=[],Re===1)for(let be=0;be<ye.length;be+=2)pe.geometry.push(Ps(ye[be],ye[be+1],$,X,Z,oe));else for(let be=0;be<ye.length;be++){const Le=[];for(let Ge=0;Ge<ye[be].length;Ge+=2)Le.push(Ps(ye[be][Ge],ye[be][Ge+1],$,X,Z,oe));pe.geometry.push(Le)}}return ge.transformed=!0,ge}function Ps(ge,$,X,Z,oe,pe){return[Math.round(X*(ge*Z-oe)),Math.round(X*($*Z-pe))]}function Li(ge,$,X,Z,oe){const pe=$===oe.maxZoom?0:oe.tolerance/((1<<$)*oe.extent),ye={features:[],numPoints:0,numSimplified:0,numFeatures:ge.length,source:null,x:X,y:Z,z:$,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Re of ge)on(ye,Re,pe,oe);return ye}function on(ge,$,X,Z){const oe=$.geometry,pe=$.type,ye=[];if(ge.minX=Math.min(ge.minX,$.minX),ge.minY=Math.min(ge.minY,$.minY),ge.maxX=Math.max(ge.maxX,$.maxX),ge.maxY=Math.max(ge.maxY,$.maxY),pe==="Point"||pe==="MultiPoint")for(let Re=0;Re<oe.length;Re+=3)ye.push(oe[Re],oe[Re+1]),ge.numPoints++,ge.numSimplified++;else if(pe==="LineString")an(ye,oe,ge,X,!1,!1);else if(pe==="MultiLineString"||pe==="Polygon")for(let Re=0;Re<oe.length;Re++)an(ye,oe[Re],ge,X,pe==="Polygon",Re===0);else if(pe==="MultiPolygon")for(let Re=0;Re<oe.length;Re++){const be=oe[Re];for(let Le=0;Le<be.length;Le++)an(ye,be[Le],ge,X,!0,Le===0)}if(ye.length){let Re=$.tags||null;if(pe==="LineString"&&Z.lineMetrics){Re={};for(const Le in $.tags)Re[Le]=$.tags[Le];Re.mapbox_clip_start=oe.start/oe.size,Re.mapbox_clip_end=oe.end/oe.size}const be={geometry:ye,type:pe==="Polygon"||pe==="MultiPolygon"?3:pe==="LineString"||pe==="MultiLineString"?2:1,tags:Re};$.id!==null&&(be.id=$.id),ge.features.push(be)}}function an(ge,$,X,Z,oe,pe){const ye=Z*Z;if(Z>0&&$.size<(oe?ye:Z))return void(X.numPoints+=$.length/3);const Re=[];for(let be=0;be<$.length;be+=3)(Z===0||$[be+2]>ye)&&(X.numSimplified++,Re.push($[be],$[be+1])),X.numPoints++;oe&&function(be,Le){let Ge=0;for(let Ve=0,ct=be.length,we=ct-2;Ve<ct;we=Ve,Ve+=2)Ge+=(be[Ve]-be[we])*(be[Ve+1]+be[we+1]);if(Ge>0===Le)for(let Ve=0,ct=be.length;Ve<ct/2;Ve+=2){const we=be[Ve],Tt=be[Ve+1];be[Ve]=be[ct-2-Ve],be[Ve+1]=be[ct-1-Ve],be[ct-2-Ve]=we,be[ct-1-Ve]=Tt}}(Re,pe),ge.push(Re)}const Mn={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class ln{constructor($,X){const Z=(X=this.options=function(pe,ye){for(const Re in ye)pe[Re]=ye[Re];return pe}(Object.create(Mn),X)).debug;if(Z&&console.time("preprocess data"),X.maxZoom<0||X.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(X.promoteId&&X.generateId)throw new Error("promoteId and generateId cannot be used together.");let oe=function(pe,ye){const Re=[];if(pe.type==="FeatureCollection")for(let be=0;be<pe.features.length;be++)gs(Re,pe.features[be],ye,be);else gs(Re,pe.type==="Feature"?pe:{geometry:pe},ye);return Re}($,X);this.tiles={},this.tileCoords=[],Z&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",X.indexMaxZoom,X.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),oe=function(pe,ye){const Re=ye.buffer/ye.extent;let be=pe;const Le=Zt(pe,1,-1-Re,Re,0,-1,2,ye),Ge=Zt(pe,1,1-Re,2+Re,0,-1,2,ye);return(Le||Ge)&&(be=Zt(pe,1,-Re,1+Re,0,-1,2,ye)||[],Le&&(be=kr(Le,1).concat(be)),Ge&&(be=be.concat(kr(Ge,-1)))),be}(oe,X),oe.length&&this.splitTile(oe,0,0,0),Z&&(oe.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile($,X,Z,oe,pe,ye,Re){const be=[$,X,Z,oe],Le=this.options,Ge=Le.debug;for(;be.length;){oe=be.pop(),Z=be.pop(),X=be.pop(),$=be.pop();const Ve=1<<X,ct=cn(X,Z,oe);let we=this.tiles[ct];if(!we&&(Ge>1&&console.time("creation"),we=this.tiles[ct]=Li($,X,Z,oe,Le),this.tileCoords.push({z:X,x:Z,y:oe}),Ge)){Ge>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",X,Z,oe,we.numFeatures,we.numPoints,we.numSimplified),console.timeEnd("creation"));const Bi=`z${X}`;this.stats[Bi]=(this.stats[Bi]||0)+1,this.total++}if(we.source=$,pe==null){if(X===Le.indexMaxZoom||we.numPoints<=Le.indexMaxPoints)continue}else{if(X===Le.maxZoom||X===pe)continue;if(pe!=null){const Bi=pe-X;if(Z!==ye>>Bi||oe!==Re>>Bi)continue}}if(we.source=null,$.length===0)continue;Ge>1&&console.time("clipping");const Tt=.5*Le.buffer/Le.extent,Ft=.5-Tt,pt=.5+Tt,Ct=1+Tt;let Qt=null,Ui=null,zi=null,Ei=null,Bt=Zt($,Ve,Z-Tt,Z+pt,0,we.minX,we.maxX,Le),Lt=Zt($,Ve,Z+Ft,Z+Ct,0,we.minX,we.maxX,Le);$=null,Bt&&(Qt=Zt(Bt,Ve,oe-Tt,oe+pt,1,we.minY,we.maxY,Le),Ui=Zt(Bt,Ve,oe+Ft,oe+Ct,1,we.minY,we.maxY,Le),Bt=null),Lt&&(zi=Zt(Lt,Ve,oe-Tt,oe+pt,1,we.minY,we.maxY,Le),Ei=Zt(Lt,Ve,oe+Ft,oe+Ct,1,we.minY,we.maxY,Le),Lt=null),Ge>1&&console.timeEnd("clipping"),be.push(Qt||[],X+1,2*Z,2*oe),be.push(Ui||[],X+1,2*Z,2*oe+1),be.push(zi||[],X+1,2*Z+1,2*oe),be.push(Ei||[],X+1,2*Z+1,2*oe+1)}}getTile($,X,Z){$=+$,X=+X,Z=+Z;const oe=this.options,{extent:pe,debug:ye}=oe;if($<0||$>24)return null;const Re=1<<$,be=cn($,X=X+Re&Re-1,Z);if(this.tiles[be])return rs(this.tiles[be],pe);ye>1&&console.log("drilling down to z%d-%d-%d",$,X,Z);let Le,Ge=$,Ve=X,ct=Z;for(;!Le&&Ge>0;)Ge--,Ve>>=1,ct>>=1,Le=this.tiles[cn(Ge,Ve,ct)];return Le&&Le.source?(ye>1&&(console.log("found parent tile z%d-%d-%d",Ge,Ve,ct),console.time("drilling down")),this.splitTile(Le.source,Ge,Ve,ct,$,X,Z),ye>1&&console.timeEnd("drilling down"),this.tiles[be]?rs(this.tiles[be],pe):null):null}}function cn(ge,$,X){return 32*((1<<ge)*X+$)+ge}class Bs extends D{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile($,X){return d._(this,void 0,void 0,function*(){const Z=$.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const oe=this._geoJSONIndex.getTile(Z.z,Z.x,Z.y);if(!oe)return null;const pe=new Te(oe.features,{version:2,extent:d.$});let ye=function(Re){const be=new d.cM;return function(Le,Ge){for(const Ve in Le.layers)Ge.writeMessage(3,Ie,Le.layers[Ve])}(Re,be),be.finish()}(pe);return ye.byteOffset===0&&ye.byteLength===ye.buffer.byteLength||(ye=new Uint8Array(ye)),{vectorTile:pe,rawData:ye.buffer}})}loadData($){return d._(this,void 0,void 0,function*(){var X;(X=this._pendingRequest)===null||X===void 0||X.abort();const Z=!!($&&$.request&&$.request.collectResourceTiming)&&new d.cN($.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON($,this._pendingRequest);const oe=yield this._pendingData;this._geoJSONIndex=$.cluster?new Ht(function({superclusterOptions:ye,clusterProperties:Re}){if(!Re||!ye)return ye;const be={},Le={},Ge={accumulated:null,zoom:0},Ve={properties:null},ct=Object.keys(Re);for(const we of ct){const[Tt,Ft]=Re[we],pt=d.cT(Ft),Ct=d.cT(typeof Tt=="string"?[Tt,["accumulated"],["get",we]]:Tt);be[we]=pt.value,Le[we]=Ct.value}return ye.map=we=>{Ve.properties=we;const Tt={};for(const Ft of ct)Tt[Ft]=be[Ft].evaluate(Ge,Ve);return Tt},ye.reduce=(we,Tt)=>{Ve.properties=Tt;for(const Ft of ct)Ge.accumulated=we[Ft],we[Ft]=Le[Ft].evaluate(Ge,Ve)},ye}($)).load(oe.features):function(ye,Re){return new ln(ye,Re)}(oe,$.geojsonVtOptions),this.loaded={};const pe={data:oe};if(Z){const ye=Z.finish();ye&&(pe.resourceTiming={},pe.resourceTiming[$.source]=JSON.parse(JSON.stringify(ye)))}return pe}catch(oe){if(delete this._pendingRequest,d.cy(oe))return{abandoned:!0};throw oe}})}getData(){return d._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile($){const X=this.loaded;return X&&X[$.uid]?super.reloadTile($):this.loadTile($)}loadAndProcessGeoJSON($,X){return d._(this,void 0,void 0,function*(){let Z=yield this.loadGeoJSON($,X);if(delete this._pendingRequest,typeof Z!="object")throw new Error(`Input data given to '${$.source}' is not a valid GeoJSON object.`);if(xe(Z,!0),$.filter){const oe=d.cT($.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(oe.result==="error")throw new Error(oe.value.map(ye=>`${ye.key}: ${ye.message}`).join(", "));Z={type:"FeatureCollection",features:Z.features.filter(ye=>oe.value.evaluate({zoom:0},ye))}}return Z})}loadGeoJSON($,X){return d._(this,void 0,void 0,function*(){const{promoteId:Z}=$;if($.request){const oe=yield d.j($.request,X);return this._dataUpdateable=d.cV(oe.data,Z)?d.cU(oe.data,Z):void 0,oe.data}if(typeof $.data=="string")try{const oe=JSON.parse($.data);return this._dataUpdateable=d.cV(oe,Z)?d.cU(oe,Z):void 0,oe}catch{throw new Error(`Input data given to '${$.source}' is not a valid GeoJSON object.`)}if(!$.dataDiff)throw new Error(`Input data given to '${$.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${$.source}`);return d.cW(this._dataUpdateable,$.dataDiff,Z),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource($){return d._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom($){return this._geoJSONIndex.getClusterExpansionZoom($.clusterId)}getClusterChildren($){return this._geoJSONIndex.getChildren($.clusterId)}getClusterLeaves($){return this._geoJSONIndex.getLeaves($.clusterId,$.limit,$.offset)}}class Rn{constructor($){this.self=$,this.actor=new d.J($),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(X,Z)=>{if(this.externalWorkerSourceTypes[X])throw new Error(`Worker source with name "${X}" already registered.`);this.externalWorkerSourceTypes[X]=Z},this.self.addProtocol=d.cA,this.self.removeProtocol=d.cB,this.self.registerRTLTextPlugin=X=>{d.cX.setMethods(X)},this.actor.registerMessageHandler("LDT",(X,Z)=>this._getDEMWorkerSource(X,Z.source).loadTile(Z)),this.actor.registerMessageHandler("RDT",(X,Z)=>d._(this,void 0,void 0,function*(){this._getDEMWorkerSource(X,Z.source).removeTile(Z)})),this.actor.registerMessageHandler("GCEZ",(X,Z)=>d._(this,void 0,void 0,function*(){return this._getWorkerSource(X,Z.type,Z.source).getClusterExpansionZoom(Z)})),this.actor.registerMessageHandler("GCC",(X,Z)=>d._(this,void 0,void 0,function*(){return this._getWorkerSource(X,Z.type,Z.source).getClusterChildren(Z)})),this.actor.registerMessageHandler("GCL",(X,Z)=>d._(this,void 0,void 0,function*(){return this._getWorkerSource(X,Z.type,Z.source).getClusterLeaves(Z)})),this.actor.registerMessageHandler("LD",(X,Z)=>this._getWorkerSource(X,Z.type,Z.source).loadData(Z)),this.actor.registerMessageHandler("GD",(X,Z)=>this._getWorkerSource(X,Z.type,Z.source).getData()),this.actor.registerMessageHandler("LT",(X,Z)=>this._getWorkerSource(X,Z.type,Z.source).loadTile(Z)),this.actor.registerMessageHandler("RT",(X,Z)=>this._getWorkerSource(X,Z.type,Z.source).reloadTile(Z)),this.actor.registerMessageHandler("AT",(X,Z)=>this._getWorkerSource(X,Z.type,Z.source).abortTile(Z)),this.actor.registerMessageHandler("RMT",(X,Z)=>this._getWorkerSource(X,Z.type,Z.source).removeTile(Z)),this.actor.registerMessageHandler("RS",(X,Z)=>d._(this,void 0,void 0,function*(){if(!this.workerSources[X]||!this.workerSources[X][Z.type]||!this.workerSources[X][Z.type][Z.source])return;const oe=this.workerSources[X][Z.type][Z.source];delete this.workerSources[X][Z.type][Z.source],oe.removeSource!==void 0&&oe.removeSource(Z)})),this.actor.registerMessageHandler("RM",X=>d._(this,void 0,void 0,function*(){delete this.layerIndexes[X],delete this.availableImages[X],delete this.workerSources[X],delete this.demWorkerSources[X]})),this.actor.registerMessageHandler("SR",(X,Z)=>d._(this,void 0,void 0,function*(){this.referrer=Z})),this.actor.registerMessageHandler("SRPS",(X,Z)=>this._syncRTLPluginState(X,Z)),this.actor.registerMessageHandler("IS",(X,Z)=>d._(this,void 0,void 0,function*(){this.self.importScripts(Z)})),this.actor.registerMessageHandler("SI",(X,Z)=>this._setImages(X,Z)),this.actor.registerMessageHandler("UL",(X,Z)=>d._(this,void 0,void 0,function*(){this._getLayerIndex(X).update(Z.layers,Z.removedIds)})),this.actor.registerMessageHandler("SL",(X,Z)=>d._(this,void 0,void 0,function*(){this._getLayerIndex(X).replace(Z)}))}_setImages($,X){return d._(this,void 0,void 0,function*(){this.availableImages[$]=X;for(const Z in this.workerSources[$]){const oe=this.workerSources[$][Z];for(const pe in oe)oe[pe].availableImages=X}})}_syncRTLPluginState($,X){return d._(this,void 0,void 0,function*(){return yield d.cX.syncState(X,this.self.importScripts)})}_getAvailableImages($){let X=this.availableImages[$];return X||(X=[]),X}_getLayerIndex($){let X=this.layerIndexes[$];return X||(X=this.layerIndexes[$]=new a),X}_getWorkerSource($,X,Z){if(this.workerSources[$]||(this.workerSources[$]={}),this.workerSources[$][X]||(this.workerSources[$][X]={}),!this.workerSources[$][X][Z]){const oe={sendAsync:(pe,ye)=>(pe.targetMapId=$,this.actor.sendAsync(pe,ye))};switch(X){case"vector":this.workerSources[$][X][Z]=new D(oe,this._getLayerIndex($),this._getAvailableImages($));break;case"geojson":this.workerSources[$][X][Z]=new Bs(oe,this._getLayerIndex($),this._getAvailableImages($));break;default:this.workerSources[$][X][Z]=new this.externalWorkerSourceTypes[X](oe,this._getLayerIndex($),this._getAvailableImages($))}}return this.workerSources[$][X][Z]}_getDEMWorkerSource($,X){return this.demWorkerSources[$]||(this.demWorkerSources[$]={}),this.demWorkerSources[$][X]||(this.demWorkerSources[$][X]=new N),this.demWorkerSources[$][X]}}return d.i(self)&&(self.worker=new Rn(self)),Rn}),o("index",["exports","./shared"],function(d,a){var x="5.6.2";function A(){var m=new a.A(4);return a.A!=Float32Array&&(m[1]=0,m[2]=0),m[0]=1,m[3]=1,m}let M,D;const N={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(m,s,h){const p=requestAnimationFrame(y=>{g(),s(y)}),{unsubscribe:g}=a.s(m.signal,"abort",()=>{g(),cancelAnimationFrame(p),h(a.c())},!1)},frameAsync(m){return new Promise((s,h)=>{this.frame(m,s,h)})},getImageData(m,s=0){return this.getImageCanvasContext(m).getImageData(-s,-s,m.width+2*s,m.height+2*s)},getImageCanvasContext(m){const s=window.document.createElement("canvas"),h=s.getContext("2d",{willReadFrequently:!0});if(!h)throw new Error("failed to create canvas 2d context");return s.width=m.width,s.height=m.height,h.drawImage(m,0,0,m.width,m.height),h},resolveURL:m=>(M||(M=document.createElement("a")),M.href=m,M.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(D==null&&(D=matchMedia("(prefers-reduced-motion: reduce)")),D.matches)}};class U{static testProp(s){if(!U.docStyle)return s[0];for(let h=0;h<s.length;h++)if(s[h]in U.docStyle)return s[h];return s[0]}static create(s,h,p){const g=window.document.createElement(s);return h!==void 0&&(g.className=h),p&&p.appendChild(g),g}static createNS(s,h){return window.document.createElementNS(s,h)}static disableDrag(){U.docStyle&&U.selectProp&&(U.userSelect=U.docStyle[U.selectProp],U.docStyle[U.selectProp]="none")}static enableDrag(){U.docStyle&&U.selectProp&&(U.docStyle[U.selectProp]=U.userSelect)}static setTransform(s,h){s.style[U.transformProp]=h}static addEventListener(s,h,p,g={}){s.addEventListener(h,p,"passive"in g?g:g.capture)}static removeEventListener(s,h,p,g={}){s.removeEventListener(h,p,"passive"in g?g:g.capture)}static suppressClickInternal(s){s.preventDefault(),s.stopPropagation(),window.removeEventListener("click",U.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",U.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",U.suppressClickInternal,!0)},0)}static getScale(s){const h=s.getBoundingClientRect();return{x:h.width/s.offsetWidth||1,y:h.height/s.offsetHeight||1,boundingClientRect:h}}static getPoint(s,h,p){const g=h.boundingClientRect;return new a.P((p.clientX-g.left)/h.x-s.clientLeft,(p.clientY-g.top)/h.y-s.clientTop)}static mousePos(s,h){const p=U.getScale(s);return U.getPoint(s,p,h)}static touchPos(s,h){const p=[],g=U.getScale(s);for(let y=0;y<h.length;y++)p.push(U.getPoint(s,g,h[y]));return p}static mouseButton(s){return s.button}static remove(s){s.parentNode&&s.parentNode.removeChild(s)}static sanitize(s){const h=new DOMParser().parseFromString(s,"text/html").body||document.createElement("body"),p=h.querySelectorAll("script");for(const g of p)g.remove();return U.clean(h),h.innerHTML}static isPossiblyDangerous(s,h){const p=h.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(s)||!p.includes("javascript:")&&!p.includes("data:"))||!!s.startsWith("on")||void 0}static clean(s){const h=s.children;for(const p of h)U.removeAttributes(p),U.clean(p)}static removeAttributes(s){for(const{name:h,value:p}of s.attributes)U.isPossiblyDangerous(h,p)&&s.removeAttribute(h)}}U.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,U.selectProp=U.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),U.transformProp=U.testProp(["transform","WebkitTransform"]);const re={supported:!1,testSupport:function(m){!Ae&&xe&&(Te?Ie(m):ne=m)}};let ne,xe,Ae=!1,Te=!1;function Ie(m){const s=m.createTexture();m.bindTexture(m.TEXTURE_2D,s);try{if(m.texImage2D(m.TEXTURE_2D,0,m.RGBA,m.RGBA,m.UNSIGNED_BYTE,xe),m.isContextLost())return;re.supported=!0}catch{}m.deleteTexture(s),Ae=!0}var Ue;typeof document<"u"&&(xe=document.createElement("img"),xe.onload=()=>{ne&&Ie(ne),ne=null,Te=!0},xe.onerror=()=>{Ae=!0,ne=null},xe.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(m){let s,h,p,g;m.resetRequestQueue=()=>{s=[],h=0,p=0,g={}},m.addThrottleControl=C=>{const R=p++;return g[R]=C,R},m.removeThrottleControl=C=>{delete g[C],w()},m.getImage=(C,R,B=!0)=>new Promise((k,F)=>{re.supported&&(C.headers||(C.headers={}),C.headers.accept="image/webp,*/*"),a.e(C,{type:"image"}),s.push({abortController:R,requestParameters:C,supportImageRefresh:B,state:"queued",onError:V=>{F(V)},onSuccess:V=>{k(V)}}),w()});const y=C=>a._(this,void 0,void 0,function*(){C.state="running";const{requestParameters:R,supportImageRefresh:B,onError:k,onSuccess:F,abortController:V}=C,G=B===!1&&!a.i(self)&&!a.g(R.url)&&(!R.headers||Object.keys(R.headers).reduce((Q,se)=>Q&&se==="accept",!0));h++;const J=G?S(R,V):a.m(R,V);try{const Q=yield J;delete C.abortController,C.state="completed",Q.data instanceof HTMLImageElement||a.b(Q.data)?F(Q):Q.data&&F({data:yield(Y=Q.data,typeof createImageBitmap=="function"?a.f(Y):a.h(Y)),cacheControl:Q.cacheControl,expires:Q.expires})}catch(Q){delete C.abortController,k(Q)}finally{h--,w()}var Y}),w=()=>{const C=(()=>{for(const R of Object.keys(g))if(g[R]())return!0;return!1})()?a.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:a.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let R=h;R<C&&s.length>0;R++){const B=s.shift();B.abortController.signal.aborted?R--:y(B)}},S=(C,R)=>new Promise((B,k)=>{const F=new Image,V=C.url,G=C.credentials;G&&G==="include"?F.crossOrigin="use-credentials":(G&&G==="same-origin"||!a.d(V))&&(F.crossOrigin="anonymous"),R.signal.addEventListener("abort",()=>{F.src="",k(a.c())}),F.fetchPriority="high",F.onload=()=>{F.onerror=F.onload=null,B({data:F})},F.onerror=()=>{F.onerror=F.onload=null,R.signal.aborted||k(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},F.src=V})}(Ue||(Ue={})),Ue.resetRequestQueue();class Xe{constructor(s){this._transformRequestFn=s??null}transformRequest(s,h){return this._transformRequestFn&&this._transformRequestFn(s,h)||{url:s}}setTransformRequest(s){this._transformRequestFn=s}}function qe(m){const s=[];if(typeof m=="string")s.push({id:"default",url:m});else if(m&&m.length>0){const h=[];for(const{id:p,url:g}of m){const y=`${p}${g}`;h.indexOf(y)===-1&&(h.push(y),s.push({id:p,url:g}))}}return s}function ht(m,s,h){try{const p=new URL(m);return p.pathname+=`${s}${h}`,p.toString()}catch{throw new Error(`Invalid sprite URL "${m}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}function gt(m){const{userImage:s}=m;return!!(s&&s.render&&s.render())&&(m.data.replace(new Uint8Array(s.data.buffer)),!0)}class nt extends a.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new a.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(s){if(this.loaded!==s&&(this.loaded=s,s)){for(const{ids:h,promiseResolve:p}of this.requestors)p(this._getImagesForIds(h));this.requestors=[]}}getImage(s){const h=this.images[s];if(h&&!h.data&&h.spriteData){const p=h.spriteData;h.data=new a.R({width:p.width,height:p.height},p.context.getImageData(p.x,p.y,p.width,p.height).data),h.spriteData=null}return h}addImage(s,h){if(this.images[s])throw new Error(`Image id ${s} already exist, use updateImage instead`);this._validate(s,h)&&(this.images[s]=h)}_validate(s,h){let p=!0;const g=h.data||h.spriteData;return this._validateStretch(h.stretchX,g&&g.width)||(this.fire(new a.k(new Error(`Image "${s}" has invalid "stretchX" value`))),p=!1),this._validateStretch(h.stretchY,g&&g.height)||(this.fire(new a.k(new Error(`Image "${s}" has invalid "stretchY" value`))),p=!1),this._validateContent(h.content,h)||(this.fire(new a.k(new Error(`Image "${s}" has invalid "content" value`))),p=!1),p}_validateStretch(s,h){if(!s)return!0;let p=0;for(const g of s){if(g[0]<p||g[1]<g[0]||h<g[1])return!1;p=g[1]}return!0}_validateContent(s,h){if(!s)return!0;if(s.length!==4)return!1;const p=h.spriteData,g=p&&p.width||h.data.width,y=p&&p.height||h.data.height;return!(s[0]<0||g<s[0]||s[1]<0||y<s[1]||s[2]<0||g<s[2]||s[3]<0||y<s[3]||s[2]<s[0]||s[3]<s[1])}updateImage(s,h,p=!0){const g=this.getImage(s);if(p&&(g.data.width!==h.data.width||g.data.height!==h.data.height))throw new Error(`size mismatch between old image (${g.data.width}x${g.data.height}) and new image (${h.data.width}x${h.data.height}).`);h.version=g.version+1,this.images[s]=h,this.updatedImages[s]=!0}removeImage(s){const h=this.images[s];delete this.images[s],delete this.patterns[s],h.userImage&&h.userImage.onRemove&&h.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(s){return new Promise((h,p)=>{let g=!0;if(!this.isLoaded())for(const y of s)this.images[y]||(g=!1);this.isLoaded()||g?h(this._getImagesForIds(s)):this.requestors.push({ids:s,promiseResolve:h})})}_getImagesForIds(s){const h={};for(const p of s){let g=this.getImage(p);g||(this.fire(new a.l("styleimagemissing",{id:p})),g=this.getImage(p)),g?h[p]={data:g.data.clone(),pixelRatio:g.pixelRatio,sdf:g.sdf,version:g.version,stretchX:g.stretchX,stretchY:g.stretchY,content:g.content,textFitWidth:g.textFitWidth,textFitHeight:g.textFitHeight,hasRenderCallback:!!(g.userImage&&g.userImage.render)}:a.w(`Image "${p}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return h}getPixelSize(){const{width:s,height:h}=this.atlasImage;return{width:s,height:h}}getPattern(s){const h=this.patterns[s],p=this.getImage(s);if(!p)return null;if(h&&h.position.version===p.version)return h.position;if(h)h.position.version=p.version;else{const g={w:p.data.width+2,h:p.data.height+2,x:0,y:0},y=new a.I(g,p);this.patterns[s]={bin:g,position:y}}return this._updatePatternAtlas(),this.patterns[s].position}bind(s){const h=s.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new a.T(s,this.atlasImage,h.RGBA),this.atlasTexture.bind(h.LINEAR,h.CLAMP_TO_EDGE)}_updatePatternAtlas(){const s=[];for(const y in this.patterns)s.push(this.patterns[y].bin);const{w:h,h:p}=a.p(s),g=this.atlasImage;g.resize({width:h||1,height:p||1});for(const y in this.patterns){const{bin:w}=this.patterns[y],S=w.x+1,C=w.y+1,R=this.getImage(y).data,B=R.width,k=R.height;a.R.copy(R,g,{x:0,y:0},{x:S,y:C},{width:B,height:k}),a.R.copy(R,g,{x:0,y:k-1},{x:S,y:C-1},{width:B,height:1}),a.R.copy(R,g,{x:0,y:0},{x:S,y:C+k},{width:B,height:1}),a.R.copy(R,g,{x:B-1,y:0},{x:S-1,y:C},{width:1,height:k}),a.R.copy(R,g,{x:0,y:0},{x:S+B,y:C},{width:1,height:k})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(s){for(const h of s){if(this.callbackDispatchedThisFrame[h])continue;this.callbackDispatchedThisFrame[h]=!0;const p=this.getImage(h);p||a.w(`Image with ID: "${h}" was not found`),gt(p)&&this.updateImage(h,p)}}}const at=1e20;function bt(m,s,h,p,g,y,w,S,C){for(let R=s;R<s+p;R++)kt(m,h*y+R,y,g,w,S,C);for(let R=h;R<h+g;R++)kt(m,R*y+s,1,p,w,S,C)}function kt(m,s,h,p,g,y,w){y[0]=0,w[0]=-at,w[1]=at,g[0]=m[s];for(let S=1,C=0,R=0;S<p;S++){g[S]=m[s+S*h];const B=S*S;do{const k=y[C];R=(g[S]-g[k]+B-k*k)/(S-k)/2}while(R<=w[C]&&--C>-1);C++,y[C]=S,w[C]=R,w[C+1]=at}for(let S=0,C=0;S<p;S++){for(;w[C+1]<S;)C++;const R=y[C],B=S-R;m[s+S*h]=g[R]+B*B}}class Ht{constructor(s,h){this.requestManager=s,this.localIdeographFontFamily=h,this.entries={}}setURL(s){this.url=s}getGlyphs(s){return a._(this,void 0,void 0,function*(){const h=[];for(const y in s)for(const w of s[y])h.push(this._getAndCacheGlyphsPromise(y,w));const p=yield Promise.all(h),g={};for(const{stack:y,id:w,glyph:S}of p)g[y]||(g[y]={}),g[y][w]=S&&{id:S.id,bitmap:S.bitmap.clone(),metrics:S.metrics};return g})}_getAndCacheGlyphsPromise(s,h){return a._(this,void 0,void 0,function*(){let p=this.entries[s];p||(p=this.entries[s]={glyphs:{},requests:{},ranges:{}});let g=p.glyphs[h];if(g!==void 0)return{stack:s,id:h,glyph:g};if(g=this._tinySDF(p,s,h),g)return p.glyphs[h]=g,{stack:s,id:h,glyph:g};const y=Math.floor(h/256);if(256*y>65535)throw new Error("glyphs > 65535 not supported");if(p.ranges[y])return{stack:s,id:h,glyph:g};if(!this.url)throw new Error("glyphsUrl is not set");if(!p.requests[y]){const S=Ht.loadGlyphRange(s,y,this.url,this.requestManager);p.requests[y]=S}const w=yield p.requests[y];for(const S in w)this._doesCharSupportLocalGlyph(+S)||(p.glyphs[+S]=w[+S]);return p.ranges[y]=!0,{stack:s,id:h,glyph:w[h]||null}})}_doesCharSupportLocalGlyph(s){return!!this.localIdeographFontFamily&&(new RegExp("\\p{Ideo}|\\p{sc=Hang}|\\p{sc=Hira}|\\p{sc=Kana}","u").test(String.fromCodePoint(s))||a.u["CJK Unified Ideographs"](s)||a.u["Hangul Syllables"](s)||a.u.Hiragana(s)||a.u.Katakana(s)||a.u["CJK Symbols and Punctuation"](s)||a.u["Halfwidth and Fullwidth Forms"](s))}_tinySDF(s,h,p){const g=this.localIdeographFontFamily;if(!g||!this._doesCharSupportLocalGlyph(p))return;let y=s.tinySDF;if(!y){let S="400";/bold/i.test(h)?S="900":/medium/i.test(h)?S="500":/light/i.test(h)&&(S="200"),y=s.tinySDF=new Ht.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:g,fontWeight:S})}const w=y.draw(String.fromCharCode(p));return{id:p,bitmap:new a.q({width:w.width||60,height:w.height||60},w.data),metrics:{width:w.glyphWidth/2||24,height:w.glyphHeight/2||24,left:w.glyphLeft/2+.5||0,top:w.glyphTop/2-27.5||-8,advance:w.glyphAdvance/2||24,isDoubleResolution:!0}}}}Ht.loadGlyphRange=function(m,s,h,p){return a._(this,void 0,void 0,function*(){const g=256*s,y=g+255,w=p.transformRequest(h.replace("{fontstack}",m).replace("{range}",`${g}-${y}`),"Glyphs"),S=yield a.n(w,new AbortController);if(!S||!S.data)throw new Error(`Could not load glyph range. range: ${s}, ${g}-${y}`);const C={};for(const R of a.o(S.data))C[R.id]=R;return C})},Ht.TinySDF=class{constructor({fontSize:m=24,buffer:s=3,radius:h=8,cutoff:p=.25,fontFamily:g="sans-serif",fontWeight:y="normal",fontStyle:w="normal",lang:S=null}={}){this.buffer=s,this.cutoff=p,this.radius=h,this.lang=S;const C=this.size=m+4*s,R=this._createCanvas(C),B=this.ctx=R.getContext("2d",{willReadFrequently:!0});B.font=`${w} ${y} ${m}px ${g}`,B.textBaseline="alphabetic",B.textAlign="left",B.fillStyle="black",this.gridOuter=new Float64Array(C*C),this.gridInner=new Float64Array(C*C),this.f=new Float64Array(C),this.z=new Float64Array(C+1),this.v=new Uint16Array(C)}_createCanvas(m){const s=document.createElement("canvas");return s.width=s.height=m,s}draw(m){const{width:s,actualBoundingBoxAscent:h,actualBoundingBoxDescent:p,actualBoundingBoxLeft:g,actualBoundingBoxRight:y}=this.ctx.measureText(m),w=Math.ceil(h),S=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(y-g))),C=Math.min(this.size-this.buffer,w+Math.ceil(p)),R=S+2*this.buffer,B=C+2*this.buffer,k=Math.max(R*B,0),F=new Uint8ClampedArray(k),V={data:F,width:R,height:B,glyphWidth:S,glyphHeight:C,glyphTop:w,glyphLeft:0,glyphAdvance:s};if(S===0||C===0)return V;const{ctx:G,buffer:J,gridInner:Y,gridOuter:Q}=this;this.lang&&(G.lang=this.lang),G.clearRect(J,J,S,C),G.fillText(m,J,J+w);const se=G.getImageData(J,J,S,C);Q.fill(at,0,k),Y.fill(0,0,k);for(let ce=0;ce<C;ce++)for(let ae=0;ae<S;ae++){const ue=se.data[4*(ce*S+ae)+3]/255;if(ue===0)continue;const _e=(ce+J)*R+ae+J;if(ue===1)Q[_e]=0,Y[_e]=at;else{const le=.5-ue;Q[_e]=le>0?le*le:0,Y[_e]=le<0?le*le:0}}bt(Q,0,0,R,B,R,this.f,this.v,this.z),bt(Y,J,J,S,C,R,this.f,this.v,this.z);for(let ce=0;ce<k;ce++){const ae=Math.sqrt(Q[ce])-Math.sqrt(Y[ce]);F[ce]=Math.round(255-255*(ae/this.radius+this.cutoff))}return V}};class St{constructor(){this.specification=a.v.light.position}possiblyEvaluate(s,h){return a.B(s.expression.evaluate(h))}interpolate(s,h,p){return{x:a.C.number(s.x,h.x,p),y:a.C.number(s.y,h.y,p),z:a.C.number(s.z,h.z,p)}}}let xi;class Fr extends a.E{constructor(s){super(),xi=xi||new a.r({anchor:new a.D(a.v.light.anchor),position:new St,color:new a.D(a.v.light.color),intensity:new a.D(a.v.light.intensity)}),this._transitionable=new a.t(xi),this.setLight(s),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(s,h={}){if(!this._validate(a.x,s,h))for(const p in s){const g=s[p];p.endsWith("-transition")?this._transitionable.setTransition(p.slice(0,-11),g):this._transitionable.setValue(p,g)}}updateTransitions(s){this._transitioning=this._transitionable.transitioned(s,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(s){this.properties=this._transitioning.possiblyEvaluate(s)}_validate(s,h,p){return(!p||p.validate!==!1)&&a.y(this,s.call(a.z,{value:h,style:{glyphs:!0,sprite:!0},styleSpec:a.v}))}}const br=new a.r({"sky-color":new a.D(a.v.sky["sky-color"]),"horizon-color":new a.D(a.v.sky["horizon-color"]),"fog-color":new a.D(a.v.sky["fog-color"]),"fog-ground-blend":new a.D(a.v.sky["fog-ground-blend"]),"horizon-fog-blend":new a.D(a.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new a.D(a.v.sky["sky-horizon-blend"]),"atmosphere-blend":new a.D(a.v.sky["atmosphere-blend"])});class Qn extends a.E{constructor(s){super(),this._transitionable=new a.t(br),this.setSky(s),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new a.F(0))}setSky(s,h={}){if(!this._validate(a.G,s,h)){s||(s={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const p in s){const g=s[p];p.endsWith("-transition")?this._transitionable.setTransition(p.slice(0,-11),g):this._transitionable.setValue(p,g)}}}getSky(){return this._transitionable.serialize()}updateTransitions(s){this._transitioning=this._transitionable.transitioned(s,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(s){this.properties=this._transitioning.possiblyEvaluate(s)}_validate(s,h,p={}){return(p==null?void 0:p.validate)!==!1&&a.y(this,s.call(a.z,a.e({value:h,style:{glyphs:!0,sprite:!0},styleSpec:a.v})))}calculateFogBlendOpacity(s){return s<60?0:s<70?(s-60)/10:1}}class Gt{constructor(s,h){this.width=s,this.height=h,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(s,h){const p=s.join(",")+String(h);return this.dashEntry[p]||(this.dashEntry[p]=this.addDash(s,h)),this.dashEntry[p]}getDashRanges(s,h,p){const g=[];let y=s.length%2==1?-s[s.length-1]*p:0,w=s[0]*p,S=!0;g.push({left:y,right:w,isDash:S,zeroLength:s[0]===0});let C=s[0];for(let R=1;R<s.length;R++){S=!S;const B=s[R];y=C*p,C+=B,w=C*p,g.push({left:y,right:w,isDash:S,zeroLength:B===0})}return g}addRoundDash(s,h,p){const g=h/2;for(let y=-p;y<=p;y++){const w=this.width*(this.nextRow+p+y);let S=0,C=s[S];for(let R=0;R<this.width;R++){R/C.right>1&&(C=s[++S]);const B=Math.abs(R-C.left),k=Math.abs(R-C.right),F=Math.min(B,k);let V;const G=y/p*(g+1);if(C.isDash){const J=g-Math.abs(G);V=Math.sqrt(F*F+J*J)}else V=g-Math.sqrt(F*F+G*G);this.data[w+R]=Math.max(0,Math.min(255,V+128))}}}addRegularDash(s){for(let S=s.length-1;S>=0;--S){const C=s[S],R=s[S+1];C.zeroLength?s.splice(S,1):R&&R.isDash===C.isDash&&(R.left=C.left,s.splice(S,1))}const h=s[0],p=s[s.length-1];h.isDash===p.isDash&&(h.left=p.left-this.width,p.right=h.right+this.width);const g=this.width*this.nextRow;let y=0,w=s[y];for(let S=0;S<this.width;S++){S/w.right>1&&(w=s[++y]);const C=Math.abs(S-w.left),R=Math.abs(S-w.right),B=Math.min(C,R);this.data[g+S]=Math.max(0,Math.min(255,(w.isDash?B:-B)+128))}}addDash(s,h){const p=h?7:0,g=2*p+1;if(this.nextRow+g>this.height)return a.w("LineAtlas out of space"),null;let y=0;for(let S=0;S<s.length;S++)y+=s[S];if(y!==0){const S=this.width/y,C=this.getDashRanges(s,this.width,S);h?this.addRoundDash(C,S,p):this.addRegularDash(C)}const w={y:(this.nextRow+p+.5)/this.height,height:2*p/this.height,width:y};return this.nextRow+=g,this.dirty=!0,w}bind(s){const h=s.gl;this.texture?(h.bindTexture(h.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,h.texSubImage2D(h.TEXTURE_2D,0,0,0,this.width,this.height,h.ALPHA,h.UNSIGNED_BYTE,this.data))):(this.texture=h.createTexture(),h.bindTexture(h.TEXTURE_2D,this.texture),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.REPEAT),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.REPEAT),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.LINEAR),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.LINEAR),h.texImage2D(h.TEXTURE_2D,0,h.ALPHA,this.width,this.height,0,h.ALPHA,h.UNSIGNED_BYTE,this.data))}}const or="maplibre_preloaded_worker_pool";class Ai{constructor(){this.active={}}acquire(s){if(!this.workers)for(this.workers=[];this.workers.length<Ai.workerCount;)this.workers.push(new Worker(a.a.WORKER_URL));return this.active[s]=!0,this.workers.slice()}release(s){delete this.active[s],this.numActive()===0&&(this.workers.forEach(h=>{h.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[or]}numActive(){return Object.keys(this.active).length}}const ar=Math.floor(N.hardwareConcurrency/2);let gs,ms;function In(){return gs||(gs=new Ai),gs}Ai.workerCount=a.H(globalThis)?Math.max(Math.min(ar,3),1):1;class Ir{constructor(s,h){this.workerPool=s,this.actors=[],this.currentActor=0,this.id=h;const p=this.workerPool.acquire(h);for(let g=0;g<p.length;g++){const y=new a.J(p[g],h);y.name=`Worker ${g}`,this.actors.push(y)}if(!this.actors.length)throw new Error("No actors found")}broadcast(s,h){const p=[];for(const g of this.actors)p.push(g.sendAsync({type:s,data:h}));return Promise.all(p)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(s=!0){this.actors.forEach(h=>{h.remove()}),this.actors=[],s&&this.workerPool.release(this.id)}registerMessageHandler(s,h){for(const p of this.actors)p.registerMessageHandler(s,h)}}function Pi(){return ms||(ms=new Ir(In(),a.K),ms.registerMessageHandler("GR",(m,s,h)=>a.m(s,h))),ms}function $i(m,s){const h=a.L();return a.M(h,h,[1,1,0]),a.N(h,h,[.5*m.width,.5*m.height,1]),m.calculatePosMatrix?a.O(h,h,m.calculatePosMatrix(s.toUnwrapped())):h}function Zt(m,s,h,p,g,y,w){var S;const C=function(F,V,G){if(F)for(const J of F){const Y=V[J];if(Y&&Y.source===G&&Y.type==="fill-extrusion")return!0}else for(const J in V){const Y=V[J];if(Y.source===G&&Y.type==="fill-extrusion")return!0}return!1}((S=g==null?void 0:g.layers)!==null&&S!==void 0?S:null,s,m.id),R=y.maxPitchScaleFactor(),B=m.tilesIn(p,R,C);B.sort(ki);const k=[];for(const F of B)k.push({wrappedTileID:F.tileID.wrapped().key,queryResults:F.tile.queryRenderedFeatures(s,h,m._state,F.queryGeometry,F.cameraQueryGeometry,F.scale,g,y,R,$i(m.transform,F.tileID),w?(V,G)=>w(F.tileID,V,G):void 0)});return function(F,V){for(const G in F)for(const J of F[G])Rs(J,V);return F}(function(F){const V={},G={};for(const J of F){const Y=J.queryResults,Q=J.wrappedTileID,se=G[Q]=G[Q]||{};for(const ce in Y){const ae=Y[ce],ue=se[ce]=se[ce]||{},_e=V[ce]=V[ce]||[];for(const le of ae)ue[le.featureIndex]||(ue[le.featureIndex]=!0,_e.push(le))}}return V}(k),m)}function ki(m,s){const h=m.tileID,p=s.tileID;return h.overscaledZ-p.overscaledZ||h.canonical.y-p.canonical.y||h.wrap-p.wrap||h.canonical.x-p.canonical.x}function Rs(m,s){const h=m.feature,p=s.getFeatureState(h.layer["source-layer"],h.id);h.source=h.layer.source,h.layer["source-layer"]&&(h.sourceLayer=h.layer["source-layer"]),h.state=p}function Qi(m,s,h){return a._(this,void 0,void 0,function*(){let p=m;if(m.url?p=(yield a.j(s.transformRequest(m.url,"Source"),h)).data:yield N.frameAsync(h),!p)return null;const g=a.Q(a.e(p,m),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in p&&p.vector_layers&&(g.vectorLayerIds=p.vector_layers.map(y=>y.id)),g})}class oi{constructor(s,h){s&&(h?this.setSouthWest(s).setNorthEast(h):Array.isArray(s)&&(s.length===4?this.setSouthWest([s[0],s[1]]).setNorthEast([s[2],s[3]]):this.setSouthWest(s[0]).setNorthEast(s[1])))}setNorthEast(s){return this._ne=s instanceof a.S?new a.S(s.lng,s.lat):a.S.convert(s),this}setSouthWest(s){return this._sw=s instanceof a.S?new a.S(s.lng,s.lat):a.S.convert(s),this}extend(s){const h=this._sw,p=this._ne;let g,y;if(s instanceof a.S)g=s,y=s;else{if(!(s instanceof oi))return Array.isArray(s)?s.length===4||s.every(Array.isArray)?this.extend(oi.convert(s)):this.extend(a.S.convert(s)):s&&("lng"in s||"lon"in s)&&"lat"in s?this.extend(a.S.convert(s)):this;if(g=s._sw,y=s._ne,!g||!y)return this}return h||p?(h.lng=Math.min(g.lng,h.lng),h.lat=Math.min(g.lat,h.lat),p.lng=Math.max(y.lng,p.lng),p.lat=Math.max(y.lat,p.lat)):(this._sw=new a.S(g.lng,g.lat),this._ne=new a.S(y.lng,y.lat)),this}getCenter(){return new a.S((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new a.S(this.getWest(),this.getNorth())}getSouthEast(){return new a.S(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(s){const{lng:h,lat:p}=a.S.convert(s);let g=this._sw.lng<=h&&h<=this._ne.lng;return this._sw.lng>this._ne.lng&&(g=this._sw.lng>=h&&h>=this._ne.lng),this._sw.lat<=p&&p<=this._ne.lat&&g}static convert(s){return s instanceof oi?s:s&&new oi(s)}static fromLngLat(s,h=0){const p=360*h/40075017,g=p/Math.cos(Math.PI/180*s.lat);return new oi(new a.S(s.lng-g,s.lat-p),new a.S(s.lng+g,s.lat+p))}adjustAntiMeridian(){const s=new a.S(this._sw.lng,this._sw.lat),h=new a.S(this._ne.lng,this._ne.lat);return new oi(s,s.lng>h.lng?new a.S(h.lng+360,h.lat):h)}}class ci{constructor(s,h,p){this.bounds=oi.convert(this.validateBounds(s)),this.minzoom=h||0,this.maxzoom=p||24}validateBounds(s){return Array.isArray(s)&&s.length===4?[Math.max(-180,s[0]),Math.max(-90,s[1]),Math.min(180,s[2]),Math.min(90,s[3])]:[-180,-90,180,90]}contains(s){const h=Math.pow(2,s.z),p=Math.floor(a.V(this.bounds.getWest())*h),g=Math.floor(a.U(this.bounds.getNorth())*h),y=Math.ceil(a.V(this.bounds.getEast())*h),w=Math.ceil(a.U(this.bounds.getSouth())*h);return s.x>=p&&s.x<y&&s.y>=g&&s.y<w}}class vr extends a.E{constructor(s,h,p,g){if(super(),this.id=s,this.dispatcher=p,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,a.e(this,a.Q(h,["url","scheme","tileSize","promoteId"])),this._options=a.e({type:"vector"},h),this._collectResourceTiming=h.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(g)}load(){return a._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new a.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const s=yield Qi(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),s&&(a.e(this,s),s.bounds&&(this.tileBounds=new ci(s.bounds,this.minzoom,this.maxzoom)),this.fire(new a.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.l("data",{dataType:"source",sourceDataType:"content"})))}catch(s){this._tileJSONRequest=null,this.fire(new a.k(s))}})}loaded(){return this._loaded}hasTile(s){return!this.tileBounds||this.tileBounds.contains(s.canonical)}onAdd(s){this.map=s,this.load()}setSourceProperty(s){this._tileJSONRequest&&this._tileJSONRequest.abort(),s(),this.load()}setTiles(s){return this.setSourceProperty(()=>{this._options.tiles=s}),this}setUrl(s){return this.setSourceProperty(()=>{this.url=s,this._options.url=s}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return a.e({},this._options)}loadTile(s){return a._(this,void 0,void 0,function*(){const h=s.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),p={request:this.map._requestManager.transformRequest(h,"Tile"),uid:s.uid,tileID:s.tileID,zoom:s.tileID.overscaledZ,tileSize:this.tileSize*s.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity,globalState:this.map.getGlobalState()};p.request.collectResourceTiming=this._collectResourceTiming;let g="RT";if(s.actor&&s.state!=="expired"){if(s.state==="loading")return new Promise((y,w)=>{s.reloadPromise={resolve:y,reject:w}})}else s.actor=this.dispatcher.getActor(),g="LT";s.abortController=new AbortController;try{const y=yield s.actor.sendAsync({type:g,data:p},s.abortController);if(delete s.abortController,s.aborted)return;this._afterTileLoadWorkerResponse(s,y)}catch(y){if(delete s.abortController,s.aborted)return;if(y&&y.status!==404)throw y;this._afterTileLoadWorkerResponse(s,null)}})}_afterTileLoadWorkerResponse(s,h){if(h&&h.resourceTiming&&(s.resourceTiming=h.resourceTiming),h&&this.map._refreshExpiredTiles&&s.setExpiryData(h),s.loadVectorData(h,this.map.painter),s.reloadPromise){const p=s.reloadPromise;s.reloadPromise=null,this.loadTile(s).then(p.resolve).catch(p.reject)}}abortTile(s){return a._(this,void 0,void 0,function*(){s.abortController&&(s.abortController.abort(),delete s.abortController),s.actor&&(yield s.actor.sendAsync({type:"AT",data:{uid:s.uid,type:this.type,source:this.id}}))})}unloadTile(s){return a._(this,void 0,void 0,function*(){s.unloadVectorData(),s.actor&&(yield s.actor.sendAsync({type:"RMT",data:{uid:s.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class Ni extends a.E{constructor(s,h,p,g){super(),this.id=s,this.dispatcher=p,this.setEventedParent(g),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=a.e({type:"raster"},h),a.e(this,a.Q(h,["url","scheme","tileSize"]))}load(){return a._(this,arguments,void 0,function*(s=!1){this._loaded=!1,this.fire(new a.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const h=yield Qi(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,h&&(a.e(this,h),h.bounds&&(this.tileBounds=new ci(h.bounds,this.minzoom,this.maxzoom)),this.fire(new a.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.l("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:s})))}catch(h){this._tileJSONRequest=null,this.fire(new a.k(h))}})}loaded(){return this._loaded}onAdd(s){this.map=s,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(s){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),s(),this.load(!0)}setTiles(s){return this.setSourceProperty(()=>{this._options.tiles=s}),this}setUrl(s){return this.setSourceProperty(()=>{this.url=s,this._options.url=s}),this}serialize(){return a.e({},this._options)}hasTile(s){return!this.tileBounds||this.tileBounds.contains(s.canonical)}loadTile(s){return a._(this,void 0,void 0,function*(){const h=s.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);s.abortController=new AbortController;try{const p=yield Ue.getImage(this.map._requestManager.transformRequest(h,"Tile"),s.abortController,this.map._refreshExpiredTiles);if(delete s.abortController,s.aborted)return void(s.state="unloaded");if(p&&p.data){this.map._refreshExpiredTiles&&(p.cacheControl||p.expires)&&s.setExpiryData({cacheControl:p.cacheControl,expires:p.expires});const g=this.map.painter.context,y=g.gl,w=p.data;s.texture=this.map.painter.getTileTexture(w.width),s.texture?s.texture.update(w,{useMipmap:!0}):(s.texture=new a.T(g,w,y.RGBA,{useMipmap:!0}),s.texture.bind(y.LINEAR,y.CLAMP_TO_EDGE,y.LINEAR_MIPMAP_NEAREST)),s.state="loaded"}}catch(p){if(delete s.abortController,s.aborted)s.state="unloaded";else if(p)throw s.state="errored",p}})}abortTile(s){return a._(this,void 0,void 0,function*(){s.abortController&&(s.abortController.abort(),delete s.abortController)})}unloadTile(s){return a._(this,void 0,void 0,function*(){s.texture&&this.map.painter.saveTileTexture(s.texture)})}hasTransition(){return!1}}class kr extends Ni{constructor(s,h,p,g){super(s,h,p,g),this.type="raster-dem",this.maxzoom=22,this._options=a.e({type:"raster-dem"},h),this.encoding=h.encoding||"mapbox",this.redFactor=h.redFactor,this.greenFactor=h.greenFactor,this.blueFactor=h.blueFactor,this.baseShift=h.baseShift}loadTile(s){return a._(this,void 0,void 0,function*(){const h=s.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),p=this.map._requestManager.transformRequest(h,"Tile");s.neighboringTiles=this._getNeighboringTiles(s.tileID),s.abortController=new AbortController;try{const g=yield Ue.getImage(p,s.abortController,this.map._refreshExpiredTiles);if(delete s.abortController,s.aborted)return void(s.state="unloaded");if(g&&g.data){const y=g.data;this.map._refreshExpiredTiles&&(g.cacheControl||g.expires)&&s.setExpiryData({cacheControl:g.cacheControl,expires:g.expires});const w=a.b(y)&&a.W()?y:yield this.readImageNow(y),S={type:this.type,uid:s.uid,source:this.id,rawImageData:w,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!s.actor||s.state==="expired"){s.actor=this.dispatcher.getActor();const C=yield s.actor.sendAsync({type:"LDT",data:S});s.dem=C,s.needsHillshadePrepare=!0,s.needsTerrainPrepare=!0,s.state="loaded"}}}catch(g){if(delete s.abortController,s.aborted)s.state="unloaded";else if(g)throw s.state="errored",g}})}readImageNow(s){return a._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&a.X()){const h=s.width+2,p=s.height+2;try{return new a.R({width:h,height:p},yield a.Y(s,-1,-1,h,p))}catch{}}return N.getImageData(s,1)})}_getNeighboringTiles(s){const h=s.canonical,p=Math.pow(2,h.z),g=(h.x-1+p)%p,y=h.x===0?s.wrap-1:s.wrap,w=(h.x+1+p)%p,S=h.x+1===p?s.wrap+1:s.wrap,C={};return C[new a.Z(s.overscaledZ,y,h.z,g,h.y).key]={backfilled:!1},C[new a.Z(s.overscaledZ,S,h.z,w,h.y).key]={backfilled:!1},h.y>0&&(C[new a.Z(s.overscaledZ,y,h.z,g,h.y-1).key]={backfilled:!1},C[new a.Z(s.overscaledZ,s.wrap,h.z,h.x,h.y-1).key]={backfilled:!1},C[new a.Z(s.overscaledZ,S,h.z,w,h.y-1).key]={backfilled:!1}),h.y+1<p&&(C[new a.Z(s.overscaledZ,y,h.z,g,h.y+1).key]={backfilled:!1},C[new a.Z(s.overscaledZ,s.wrap,h.z,h.x,h.y+1).key]={backfilled:!1},C[new a.Z(s.overscaledZ,S,h.z,w,h.y+1).key]={backfilled:!1}),C}unloadTile(s){return a._(this,void 0,void 0,function*(){s.demTexture&&this.map.painter.saveTileTexture(s.demTexture),s.fbo&&(s.fbo.destroy(),delete s.fbo),s.dem&&delete s.dem,delete s.neighboringTiles,s.state="unloaded",s.actor&&(yield s.actor.sendAsync({type:"RDT",data:{type:this.type,uid:s.uid,source:this.id}}))})}}class is extends a.E{constructor(s,h,p,g){super(),this.id=s,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._isUpdatingWorker=!1,this._pendingWorkerUpdate={data:h.data},this.actor=p.getActor(),this.setEventedParent(g),this._data=h.data,this._options=a.e({},h),this._collectResourceTiming=h.collectResourceTiming,h.maxzoom!==void 0&&(this.maxzoom=h.maxzoom),h.type&&(this.type=h.type),h.attribution&&(this.attribution=h.attribution),this.promoteId=h.promoteId,h.clusterMaxZoom!==void 0&&this.maxzoom<=h.clusterMaxZoom&&a.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${h.clusterMaxZoom}".`),this.workerOptions=a.e({source:this.id,cluster:h.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(h.buffer!==void 0?h.buffer:128),tolerance:this._pixelsToTileUnits(h.tolerance!==void 0?h.tolerance:.375),extent:a.$,maxZoom:this.maxzoom,lineMetrics:h.lineMetrics||!1,generateId:h.generateId||!1},superclusterOptions:{maxZoom:this._getClusterMaxZoom(h.clusterMaxZoom),minPoints:Math.max(2,h.clusterMinPoints||2),extent:a.$,radius:this._pixelsToTileUnits(h.clusterRadius||50),log:!1,generateId:h.generateId||!1},clusterProperties:h.clusterProperties,filter:h.filter},h.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}_pixelsToTileUnits(s){return s*(a.$/this.tileSize)}_getClusterMaxZoom(s){const h=s?Math.round(s):this.maxzoom-1;return Number.isInteger(s)||s===void 0||a.w(`Integer expected for option 'clusterMaxZoom': provided value "${s}" rounded to "${h}"`),h}load(){return a._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(s){this.map=s,this.load()}setData(s){return this._data=s,this._pendingWorkerUpdate={data:s},this._updateWorkerData(),this}updateData(s){return this._pendingWorkerUpdate.diff=a.a0(this._pendingWorkerUpdate.diff,s),this._updateWorkerData(),this}getData(){return a._(this,void 0,void 0,function*(){const s=a.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:s})})}getCoordinatesFromGeometry(s){return s.type==="GeometryCollection"?s.geometries.map(h=>h.coordinates).flat(1/0):s.coordinates.flat(1/0)}getBounds(){return a._(this,void 0,void 0,function*(){const s=new oi,h=yield this.getData();let p;switch(h.type){case"FeatureCollection":p=h.features.map(g=>this.getCoordinatesFromGeometry(g.geometry)).flat(1/0);break;case"Feature":p=this.getCoordinatesFromGeometry(h.geometry);break;default:p=this.getCoordinatesFromGeometry(h)}if(p.length==0)return s;for(let g=0;g<p.length-1;g+=2)s.extend([p[g],p[g+1]]);return s})}setClusterOptions(s){return this.workerOptions.cluster=s.cluster,s&&(s.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(s.clusterRadius)),s.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=this._getClusterMaxZoom(s.clusterMaxZoom))),this._updateWorkerData(),this}getClusterExpansionZoom(s){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:s,source:this.id}})}getClusterChildren(s){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:s,source:this.id}})}getClusterLeaves(s,h,p){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:s,limit:h,offset:p}})}_updateWorkerData(){return a._(this,void 0,void 0,function*(){if(this._isUpdatingWorker)return;const{data:s,diff:h}=this._pendingWorkerUpdate;if(!s&&!h)return void a.w(`No data or diff provided to GeoJSONSource ${this.id}.`);const p=a.e({type:this.type},this.workerOptions);s?(typeof s=="string"?(p.request=this.map._requestManager.transformRequest(N.resolveURL(s),"Source"),p.request.collectResourceTiming=this._collectResourceTiming):p.data=JSON.stringify(s),this._pendingWorkerUpdate.data=void 0):h&&(p.dataDiff=h,this._pendingWorkerUpdate.diff=void 0),this._isUpdatingWorker=!0,this.fire(new a.l("dataloading",{dataType:"source"}));try{const g=yield this.actor.sendAsync({type:"LD",data:p});if(this._isUpdatingWorker=!1,this._removed||g.abandoned)return void this.fire(new a.l("dataabort",{dataType:"source"}));this._data=g.data;let y=null;g.resourceTiming&&g.resourceTiming[this.id]&&(y=g.resourceTiming[this.id].slice(0));const w={dataType:"source"};this._collectResourceTiming&&y&&y.length>0&&a.e(w,{resourceTiming:y}),this.fire(new a.l("data",Object.assign(Object.assign({},w),{sourceDataType:"metadata"}))),this.fire(new a.l("data",Object.assign(Object.assign({},w),{sourceDataType:"content"})))}catch(g){if(this._isUpdatingWorker=!1,this._removed)return void this.fire(new a.l("dataabort",{dataType:"source"}));this.fire(new a.k(g))}finally{(this._pendingWorkerUpdate.data||this._pendingWorkerUpdate.diff)&&this._updateWorkerData()}})}loaded(){return!this._isUpdatingWorker&&this._pendingWorkerUpdate.data===void 0&&this._pendingWorkerUpdate.diff===void 0}loadTile(s){return a._(this,void 0,void 0,function*(){const h=s.actor?"RT":"LT";s.actor=this.actor;const p={type:this.type,uid:s.uid,tileID:s.tileID,zoom:s.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity,globalState:this.map.getGlobalState()};s.abortController=new AbortController;const g=yield this.actor.sendAsync({type:h,data:p},s.abortController);delete s.abortController,s.unloadVectorData(),s.aborted||s.loadVectorData(g,this.map.painter,h==="RT")})}abortTile(s){return a._(this,void 0,void 0,function*(){s.abortController&&(s.abortController.abort(),delete s.abortController),s.aborted=!0})}unloadTile(s){return a._(this,void 0,void 0,function*(){s.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:s.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return a.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}class rs extends a.E{constructor(s,h,p,g){super(),this.flippedWindingOrder=!1,this.id=s,this.dispatcher=p,this.coordinates=h.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(g),this.options=h}load(s){return a._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new a.l("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const h=yield Ue.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,h&&h.data&&(this.image=h.data,s&&(this.coordinates=s),this._finishLoading())}catch(h){this._request=null,this._loaded=!0,this.fire(new a.k(h))}})}loaded(){return this._loaded}updateImage(s){return s.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=s.url,this.load(s.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new a.l("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(s){this.map=s,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(s){this.coordinates=s;const h=s.map(a.a1.fromLngLat);var p;return this.tileID=function(g){const y=a.a2.fromPoints(g),w=y.width(),S=y.height(),C=Math.max(w,S),R=Math.max(0,Math.floor(-Math.log(C)/Math.LN2)),B=Math.pow(2,R);return new a.a4(R,Math.floor((y.minX+y.maxX)/2*B),Math.floor((y.minY+y.maxY)/2*B))}(h),this.terrainTileRanges=this._getOverlappingTileRanges(h),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=h.map(g=>this.tileID.getTilePoint(g)._round()),this.flippedWindingOrder=((p=this.tileCoords)[1].x-p[0].x)*(p[2].y-p[0].y)-(p[1].y-p[0].y)*(p[2].x-p[0].x)<0,this.fire(new a.l("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const s=this.map.painter.context,h=s.gl;this.texture||(this.texture=new a.T(s,this.image,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE));let p=!1;for(const g in this.tiles){const y=this.tiles[g];y.state!=="loaded"&&(y.state="loaded",y.texture=this.texture,p=!0)}p&&this.fire(new a.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(s){return a._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(s.tileID.canonical)?(this.tiles[String(s.tileID.wrap)]=s,s.buckets={}):s.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}_getOverlappingTileRanges(s){const{minX:h,minY:p,maxX:g,maxY:y}=a.a2.fromPoints(s),w={};for(let S=0;S<=a.a3;S++){const C=Math.pow(2,S),R=Math.floor(h*C),B=Math.floor(p*C),k=Math.floor(g*C),F=Math.floor(y*C);w[S]={minTileX:R,minTileY:B,maxTileX:k,maxTileY:F}}return w}}class Ps extends rs{constructor(s,h,p,g){super(s,h,p,g),this.roundZoom=!0,this.type="video",this.options=h}load(){return a._(this,void 0,void 0,function*(){this._loaded=!1;const s=this.options;this.urls=[];for(const h of s.urls)this.urls.push(this.map._requestManager.transformRequest(h,"Source").url);try{const h=yield a.a5(this.urls);if(this._loaded=!0,!h)return;this.video=h,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(h){this.fire(new a.k(h))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(s){if(this.video){const h=this.video.seekable;s<h.start(0)||s>h.end(0)?this.fire(new a.k(new a.a6(`sources.${this.id}`,null,`Playback for this video can be set only between the ${h.start(0)} and ${h.end(0)}-second mark.`))):this.video.currentTime=s}}getVideo(){return this.video}onAdd(s){this.map||(this.map=s,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const s=this.map.painter.context,h=s.gl;this.texture?this.video.paused||(this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE),h.texSubImage2D(h.TEXTURE_2D,0,0,0,h.RGBA,h.UNSIGNED_BYTE,this.video)):(this.texture=new a.T(s,this.video,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE));let p=!1;for(const g in this.tiles){const y=this.tiles[g];y.state!=="loaded"&&(y.state="loaded",y.texture=this.texture,p=!0)}p&&this.fire(new a.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class Li extends rs{constructor(s,h,p,g){super(s,h,p,g),h.coordinates?Array.isArray(h.coordinates)&&h.coordinates.length===4&&!h.coordinates.some(y=>!Array.isArray(y)||y.length!==2||y.some(w=>typeof w!="number"))||this.fire(new a.k(new a.a6(`sources.${s}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new a.k(new a.a6(`sources.${s}`,null,'missing required property "coordinates"'))),h.animate&&typeof h.animate!="boolean"&&this.fire(new a.k(new a.a6(`sources.${s}`,null,'optional "animate" property must be a boolean value'))),h.canvas?typeof h.canvas=="string"||h.canvas instanceof HTMLCanvasElement||this.fire(new a.k(new a.a6(`sources.${s}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new a.k(new a.a6(`sources.${s}`,null,'missing required property "canvas"'))),this.options=h,this.animate=h.animate===void 0||h.animate}load(){return a._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new a.k(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(s){this.map=s,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let s=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,s=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,s=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const h=this.map.painter.context,p=h.gl;this.texture?(s||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new a.T(h,this.canvas,p.RGBA,{premultiply:!0});let g=!1;for(const y in this.tiles){const w=this.tiles[y];w.state!=="loaded"&&(w.state="loaded",w.texture=this.texture,g=!0)}g&&this.fire(new a.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const s of[this.canvas.width,this.canvas.height])if(isNaN(s)||s<=0)return!0;return!1}}const on={},an=m=>{switch(m){case"geojson":return is;case"image":return rs;case"raster":return Ni;case"raster-dem":return kr;case"vector":return vr;case"video":return Ps;case"canvas":return Li}return on[m]},Mn="RTLPluginLoaded";class ln extends a.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=Pi()}_syncState(s){return this.status=s,this.dispatcher.broadcast("SRPS",{pluginStatus:s,pluginURL:this.url}).catch(h=>{throw this.status="error",h})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(s){return a._(this,arguments,void 0,function*(h,p=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=N.resolveURL(h),!this.url)throw new Error(`requested url ${h} is invalid`);if(this.status==="unavailable"){if(!p)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return a._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new a.l(Mn))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let cn=null;function Bs(){return cn||(cn=new ln),cn}class Rn{constructor(s,h){this.timeAdded=0,this.fadeEndTime=0,this.tileID=s,this.uid=a.a7(),this.uses=0,this.tileSize=h,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(s){const h=s+this.timeAdded;h<this.fadeEndTime||(this.fadeEndTime=h)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(s){this.demTexture&&s.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(s,h,p){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",s){s.featureIndex&&(this.latestFeatureIndex=s.featureIndex,s.rawTileData?(this.latestRawTileData=s.rawTileData,this.latestFeatureIndex.rawTileData=s.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=s.collisionBoxArray,this.buckets=function(g,y){const w={};if(!y)return w;for(const S of g){const C=S.layerIds.map(R=>y.getLayer(R)).filter(Boolean);if(C.length!==0){S.layers=C,S.stateDependentLayerIds&&(S.stateDependentLayers=S.stateDependentLayerIds.map(R=>C.filter(B=>B.id===R)[0]));for(const R of C)w[R.id]=S}}return w}(s.buckets,h==null?void 0:h.style),this.hasSymbolBuckets=!1;for(const g in this.buckets){const y=this.buckets[g];if(y instanceof a.a9){if(this.hasSymbolBuckets=!0,!p)break;y.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const g in this.buckets){const y=this.buckets[g];if(y instanceof a.a9&&y.hasRTLText){this.hasRTLText=!0,Bs().lazyLoad();break}}this.queryPadding=0;for(const g in this.buckets){const y=this.buckets[g];this.queryPadding=Math.max(this.queryPadding,h.style.getLayer(g).queryRadius(y))}s.imageAtlas&&(this.imageAtlas=s.imageAtlas),s.glyphAtlasImage&&(this.glyphAtlasImage=s.glyphAtlasImage)}else this.collisionBoxArray=new a.a8}unloadVectorData(){for(const s in this.buckets)this.buckets[s].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(s){return this.buckets[s.id]}upload(s){for(const p in this.buckets){const g=this.buckets[p];g.uploadPending()&&g.upload(s)}const h=s.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new a.T(s,this.imageAtlas.image,h.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new a.T(s,this.glyphAtlasImage,h.ALPHA),this.glyphAtlasImage=null)}prepare(s){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(s,this.imageAtlasTexture)}queryRenderedFeatures(s,h,p,g,y,w,S,C,R,B,k){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:g,cameraQueryGeometry:y,scale:w,tileSize:this.tileSize,pixelPosMatrix:B,transform:C,params:S,queryPadding:this.queryPadding*R,getElevation:k},s,h,p):{}}querySourceFeatures(s,h){const p=this.latestFeatureIndex;if(!p||!p.rawTileData)return;const g=p.loadVTLayers(),y=h&&h.sourceLayer?h.sourceLayer:"",w=g._geojsonTileLayer||g[y];if(!w)return;const S=a.aa(h&&h.filter),{z:C,x:R,y:B}=this.tileID.canonical,k={z:C,x:R,y:B};for(let F=0;F<w.length;F++){const V=w.feature(F);if(S.needGeometry){const Y=a.ab(V,!0);if(!S.filter(new a.F(this.tileID.overscaledZ),Y,this.tileID.canonical))continue}else if(!S.filter(new a.F(this.tileID.overscaledZ),V))continue;const G=p.getId(V,y),J=new a.ac(V,C,R,B,G);J.tile=k,s.push(J)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(s){const h=this.expirationTime;if(s.cacheControl){const p=a.ad(s.cacheControl);p["max-age"]&&(this.expirationTime=Date.now()+1e3*p["max-age"])}else s.expires&&(this.expirationTime=new Date(s.expires).getTime());if(this.expirationTime){const p=Date.now();let g=!1;if(this.expirationTime>p)g=!1;else if(h)if(this.expirationTime<h)g=!0;else{const y=this.expirationTime-h;y?this.expirationTime=p+Math.max(y,3e4):g=!0}else g=!0;g?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(s,h){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(s).length===0)return;const p=this.latestFeatureIndex.loadVTLayers();for(const g in this.buckets){if(!h.style.hasLayer(g))continue;const y=this.buckets[g],w=y.layers[0].sourceLayer||"_geojsonTileLayer",S=p[w],C=s[w];if(!S||!C||Object.keys(C).length===0)continue;y.update(C,S,this.imageAtlas&&this.imageAtlas.patternPositions||{});const R=h&&h.style&&h.style.getLayer(g);R&&(this.queryPadding=Math.max(this.queryPadding,R.queryRadius(y)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<N.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(s){this.symbolFadeHoldUntil=N.now()+s}setDependencies(s,h){const p={};for(const g of h)p[g]=!0;this.dependencies[s]=p}hasDependency(s,h){for(const p of s){const g=this.dependencies[p];if(g){for(const y of h)if(g[y])return!0}}return!1}}class ge{constructor(s,h){this.max=s,this.onRemove=h,this.reset()}reset(){for(const s in this.data)for(const h of this.data[s])h.timeout&&clearTimeout(h.timeout),this.onRemove(h.value);return this.data={},this.order=[],this}add(s,h,p){const g=s.wrapped().key;this.data[g]===void 0&&(this.data[g]=[]);const y={value:h,timeout:void 0};if(p!==void 0&&(y.timeout=setTimeout(()=>{this.remove(s,y)},p)),this.data[g].push(y),this.order.push(g),this.order.length>this.max){const w=this._getAndRemoveByKey(this.order[0]);w&&this.onRemove(w)}return this}has(s){return s.wrapped().key in this.data}getAndRemove(s){return this.has(s)?this._getAndRemoveByKey(s.wrapped().key):null}_getAndRemoveByKey(s){const h=this.data[s].shift();return h.timeout&&clearTimeout(h.timeout),this.data[s].length===0&&delete this.data[s],this.order.splice(this.order.indexOf(s),1),h.value}getByKey(s){const h=this.data[s];return h?h[0].value:null}get(s){return this.has(s)?this.data[s.wrapped().key][0].value:null}remove(s,h){if(!this.has(s))return this;const p=s.wrapped().key,g=h===void 0?0:this.data[p].indexOf(h),y=this.data[p][g];return this.data[p].splice(g,1),y.timeout&&clearTimeout(y.timeout),this.data[p].length===0&&delete this.data[p],this.onRemove(y.value),this.order.splice(this.order.indexOf(p),1),this}setMaxSize(s){for(this.max=s;this.order.length>this.max;){const h=this._getAndRemoveByKey(this.order[0]);h&&this.onRemove(h)}return this}filter(s){const h=[];for(const p in this.data)for(const g of this.data[p])s(g.value)||h.push(g);for(const p of h)this.remove(p.value.tileID,p)}}class ${constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(s,h,p){const g=String(h);if(this.stateChanges[s]=this.stateChanges[s]||{},this.stateChanges[s][g]=this.stateChanges[s][g]||{},a.e(this.stateChanges[s][g],p),this.deletedStates[s]===null){this.deletedStates[s]={};for(const y in this.state[s])y!==g&&(this.deletedStates[s][y]=null)}else if(this.deletedStates[s]&&this.deletedStates[s][g]===null){this.deletedStates[s][g]={};for(const y in this.state[s][g])p[y]||(this.deletedStates[s][g][y]=null)}else for(const y in p)this.deletedStates[s]&&this.deletedStates[s][g]&&this.deletedStates[s][g][y]===null&&delete this.deletedStates[s][g][y]}removeFeatureState(s,h,p){if(this.deletedStates[s]===null)return;const g=String(h);if(this.deletedStates[s]=this.deletedStates[s]||{},p&&h!==void 0)this.deletedStates[s][g]!==null&&(this.deletedStates[s][g]=this.deletedStates[s][g]||{},this.deletedStates[s][g][p]=null);else if(h!==void 0)if(this.stateChanges[s]&&this.stateChanges[s][g])for(p in this.deletedStates[s][g]={},this.stateChanges[s][g])this.deletedStates[s][g][p]=null;else this.deletedStates[s][g]=null;else this.deletedStates[s]=null}getState(s,h){const p=String(h),g=a.e({},(this.state[s]||{})[p],(this.stateChanges[s]||{})[p]);if(this.deletedStates[s]===null)return{};if(this.deletedStates[s]){const y=this.deletedStates[s][h];if(y===null)return{};for(const w in y)delete g[w]}return g}initializeTileState(s,h){s.setFeatureState(this.state,h)}coalesceChanges(s,h){const p={};for(const g in this.stateChanges){this.state[g]=this.state[g]||{};const y={};for(const w in this.stateChanges[g])this.state[g][w]||(this.state[g][w]={}),a.e(this.state[g][w],this.stateChanges[g][w]),y[w]=this.state[g][w];p[g]=y}for(const g in this.deletedStates){this.state[g]=this.state[g]||{};const y={};if(this.deletedStates[g]===null)for(const w in this.state[g])y[w]={},this.state[g][w]={};else for(const w in this.deletedStates[g]){if(this.deletedStates[g][w]===null)this.state[g][w]={};else for(const S of Object.keys(this.deletedStates[g][w]))delete this.state[g][w][S];y[w]=this.state[g][w]}p[g]=p[g]||{},a.e(p[g],y)}if(this.stateChanges={},this.deletedStates={},Object.keys(p).length!==0)for(const g in s)s[g].setFeatureState(p,h)}}const X=89.25;function Z(m,s){const h=a.ah(s.lat,-a.ai,a.ai);return new a.P(a.V(s.lng)*m,a.U(h)*m)}function oe(m,s){return new a.a1(s.x/m,s.y/m).toLngLat()}function pe(m){return m.cameraToCenterDistance*Math.min(.85*Math.tan(a.ae(90-m.pitch)),Math.tan(a.ae(X-m.pitch)))}function ye(m,s){const h=m.canonical,p=s/a.af(h.z),g=h.x+Math.pow(2,h.z)*m.wrap,y=a.ag(new Float64Array(16));return a.M(y,y,[g*p,h.y*p,0]),a.N(y,y,[p/a.$,p/a.$,1]),y}function Re(m,s,h,p,g){const y=a.a1.fromLngLat(m,s),w=g*a.aj(1,m.lat),S=w*Math.cos(a.ae(h)),C=Math.sqrt(w*w-S*S),R=C*Math.sin(a.ae(-p)),B=C*Math.cos(a.ae(-p));return new a.a1(y.x+R,y.y+B,y.z+S)}function be(m,s,h){const p=s.intersectsFrustum(m);if(!h||p===0)return p;const g=s.intersectsPlane(h);return g===0?0:p===2&&g===2?2:1}function Le(m,s,h){let p=0;const g=(h-s)/10;for(let y=0;y<10;y++)p+=g*Math.pow(Math.cos(s+(y+.5)/10*(h-s)),m);return p}function Ge(m,s){return function(h,p,g,y,w){const S=2*((m-1)/a.ak(Math.cos(a.ae(X-w))/Math.cos(a.ae(X)))-1),C=Math.acos(g/y),R=2*Le(S-1,0,a.ae(w/2)),B=Math.min(a.ae(X),C+a.ae(w/2)),k=Le(S-1,Math.min(B,C-a.ae(w/2)),B),F=Math.atan(p/g),V=Math.hypot(p,g);let G=h;return G+=a.ak(y/V/Math.max(.5,Math.cos(a.ae(w/2)))),G+=S*a.ak(Math.cos(F))/2,G-=a.ak(Math.max(1,k/R/s))/2,G}}const Ve=Ge(9.314,3);function ct(m,s){const h=(s.roundZoom?Math.round:Math.floor)(m.zoom+a.ak(m.tileSize/s.tileSize));return Math.max(0,h)}function we(m,s){const h=m.getCameraFrustum(),p=m.getClippingPlane(),g=m.screenPointToMercatorCoordinate(m.getCameraPoint()),y=a.a1.fromLngLat(m.center,m.elevation);g.z=y.z+Math.cos(m.pitchInRadians)*m.cameraToCenterDistance/m.worldSize;const w=m.getCoveringTilesDetailsProvider(),S=w.allowVariableZoom(m,s),C=ct(m,s),R=s.minzoom||0,B=s.maxzoom!==void 0?s.maxzoom:m.maxZoom,k=Math.min(Math.max(0,C),B),F=Math.pow(2,k),V=[F*g.x,F*g.y,0],G=[F*y.x,F*y.y,0],J=Math.hypot(y.x-g.x,y.y-g.y),Y=Math.abs(y.z-g.z),Q=Math.hypot(J,Y),se=ue=>({zoom:0,x:0,y:0,wrap:ue,fullyVisible:!1}),ce=[],ae=[];if(m.renderWorldCopies&&w.allowWorldCopies())for(let ue=1;ue<=3;ue++)ce.push(se(-ue)),ce.push(se(ue));for(ce.push(se(0));ce.length>0;){const ue=ce.pop(),_e=ue.x,le=ue.y;let ve=ue.fullyVisible;const ke={x:_e,y:le,z:ue.zoom},Me=w.getTileBoundingVolume(ke,ue.wrap,m.elevation,s);if(!ve){const Ye=be(h,Me,p);if(Ye===0)continue;ve=Ye===2}const Pe=w.distanceToTile2d(g.x,g.y,ke,Me);let Fe=C;S&&(Fe=(s.calculateTileZoom||Ve)(m.zoom+a.ak(m.tileSize/s.tileSize),Pe,Y,Q,m.fov)),Fe=(s.roundZoom?Math.round:Math.floor)(Fe),Fe=Math.max(0,Fe);const Ze=Math.min(Fe,B);if(ue.wrap=w.getWrap(y,ke,ue.wrap),ue.zoom>=Ze){if(ue.zoom<R)continue;const Ye=k-ue.zoom,je=V[0]-.5-(_e<<Ye),ut=V[1]-.5-(le<<Ye),Dt=s.reparseOverscaled?Math.max(ue.zoom,Fe):ue.zoom;ae.push({tileID:new a.Z(ue.zoom===B?Dt:ue.zoom,ue.wrap,ue.zoom,_e,le),distanceSq:a.al([G[0]-.5-_e,G[1]-.5-le]),tileDistanceToCamera:Math.sqrt(je*je+ut*ut)})}else for(let Ye=0;Ye<4;Ye++)ce.push({zoom:ue.zoom+1,x:(_e<<1)+Ye%2,y:(le<<1)+(Ye>>1),wrap:ue.wrap,fullyVisible:ve})}return ae.sort((ue,_e)=>ue.distanceSq-_e.distanceSq).map(ue=>ue.tileID)}const Tt=a.a2.fromPoints([new a.P(0,0),new a.P(a.$,a.$)]);class Ft extends a.E{constructor(s,h,p){super(),this.id=s,this.dispatcher=p,this.on("data",g=>this._dataHandler(g)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((g,y,w,S)=>{const C=new(an(y.type))(g,y,w,S);if(C.id!==g)throw new Error(`Expected Source id to be ${g} instead of ${C.id}`);return C})(s,h,p,this),this._tiles={},this._cache=new ge(0,g=>this._unloadTile(g)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new $,this._didEmitContent=!1,this._updated=!1}onAdd(s){this.map=s,this._maxTileCacheSize=s?s._maxTileCacheSize:null,this._maxTileCacheZoomLevels=s?s._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(s)}onRemove(s){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(s)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const s in this._tiles){const h=this._tiles[s];if(h.state!=="loaded"&&h.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const s=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,s&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(s,h,p){return a._(this,void 0,void 0,function*(){try{yield this._source.loadTile(s),this._tileLoaded(s,h,p)}catch(g){s.state="errored",g.status!==404?this._source.fire(new a.k(g,{tile:s})):this.update(this.transform,this.terrain)}})}_unloadTile(s){this._source.unloadTile&&this._source.unloadTile(s)}_abortTile(s){this._source.abortTile&&this._source.abortTile(s),this._source.fire(new a.l("dataabort",{tile:s,coord:s.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(s){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const h in this._tiles){const p=this._tiles[h];p.upload(s),p.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(s=>s.tileID).sort(pt).map(s=>s.key)}getRenderableIds(s){const h=[];for(const p in this._tiles)this._isIdRenderable(p,s)&&h.push(this._tiles[p]);return s?h.sort((p,g)=>{const y=p.tileID,w=g.tileID,S=new a.P(y.canonical.x,y.canonical.y)._rotate(-this.transform.bearingInRadians),C=new a.P(w.canonical.x,w.canonical.y)._rotate(-this.transform.bearingInRadians);return y.overscaledZ-w.overscaledZ||C.y-S.y||C.x-S.x}).map(p=>p.tileID.key):h.map(p=>p.tileID).sort(pt).map(p=>p.key)}hasRenderableParent(s){const h=this.findLoadedParent(s,0);return!!h&&this._isIdRenderable(h.tileID.key)}_isIdRenderable(s,h){return this._tiles[s]&&this._tiles[s].hasData()&&!this._coveredTiles[s]&&(h||!this._tiles[s].holdingForFade())}reload(s){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const h in this._tiles)s?this._reloadTile(h,"expired"):this._tiles[h].state!=="errored"&&this._reloadTile(h,"reloading")}}_reloadTile(s,h){return a._(this,void 0,void 0,function*(){const p=this._tiles[s];p&&(p.state!=="loading"&&(p.state=h),yield this._loadTile(p,s,h))})}_tileLoaded(s,h,p){s.timeAdded=N.now(),p==="expired"&&(s.refreshedUponExpiration=!0),this._setTileReloadTimer(h,s),this.getSource().type==="raster-dem"&&s.dem&&this._backfillDEM(s),this._state.initializeTileState(s,this.map?this.map.painter:null),s.aborted||this._source.fire(new a.l("data",{dataType:"source",tile:s,coord:s.tileID}))}_backfillDEM(s){const h=this.getRenderableIds();for(let g=0;g<h.length;g++){const y=h[g];if(s.neighboringTiles&&s.neighboringTiles[y]){const w=this.getTileByID(y);p(s,w),p(w,s)}}function p(g,y){g.needsHillshadePrepare=!0,g.needsTerrainPrepare=!0;let w=y.tileID.canonical.x-g.tileID.canonical.x;const S=y.tileID.canonical.y-g.tileID.canonical.y,C=Math.pow(2,g.tileID.canonical.z),R=y.tileID.key;w===0&&S===0||Math.abs(S)>1||(Math.abs(w)>1&&(Math.abs(w+C)===1?w+=C:Math.abs(w-C)===1&&(w-=C)),y.dem&&g.dem&&(g.dem.backfillBorder(y.dem,w,S),g.neighboringTiles&&g.neighboringTiles[R]&&(g.neighboringTiles[R].backfilled=!0)))}}getTile(s){return this.getTileByID(s.key)}getTileByID(s){return this._tiles[s]}_retainLoadedChildren(s,h,p,g){for(const y in this._tiles){let w=this._tiles[y];if(g[y]||!w.hasData()||w.tileID.overscaledZ<=h||w.tileID.overscaledZ>p)continue;let S=w.tileID;for(;w&&w.tileID.overscaledZ>h+1;){const R=w.tileID.scaledTo(w.tileID.overscaledZ-1);w=this._tiles[R.key],w&&w.hasData()&&(S=R)}let C=S;for(;C.overscaledZ>h;)if(C=C.scaledTo(C.overscaledZ-1),s[C.key]||s[C.canonical.key]){g[S.key]=S;break}}}findLoadedParent(s,h){if(s.key in this._loadedParentTiles){const p=this._loadedParentTiles[s.key];return p&&p.tileID.overscaledZ>=h?p:null}for(let p=s.overscaledZ-1;p>=h;p--){const g=s.scaledTo(p),y=this._getLoadedTile(g);if(y)return y}}findLoadedSibling(s){return this._getLoadedTile(s)}_getLoadedTile(s){const h=this._tiles[s.key];return h&&h.hasData()?h:this._cache.getByKey(s.wrapped().key)}updateCacheSize(s){const h=Math.ceil(s.width/this._source.tileSize)+1,p=Math.ceil(s.height/this._source.tileSize)+1,g=Math.floor(h*p*(this._maxTileCacheZoomLevels===null?a.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),y=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,g):g;this._cache.setMaxSize(y)}handleWrapJump(s){const h=Math.round((s-(this._prevLng===void 0?s:this._prevLng))/360);if(this._prevLng=s,h){const p={};for(const g in this._tiles){const y=this._tiles[g];y.tileID=y.tileID.unwrapTo(y.tileID.wrap+h),p[y.tileID.key]=y}this._tiles=p;for(const g in this._timers)clearTimeout(this._timers[g]),delete this._timers[g];for(const g in this._tiles)this._setTileReloadTimer(g,this._tiles[g])}}_updateCoveredAndRetainedTiles(s,h,p,g,y,w){const S={},C={},R=Object.keys(s),B=N.now();for(const k of R){const F=s[k],V=this._tiles[k];if(!V||V.fadeEndTime!==0&&V.fadeEndTime<=B)continue;const G=this.findLoadedParent(F,h),J=this.findLoadedSibling(F),Y=G||J||null;Y&&(this._addTile(Y.tileID),S[Y.tileID.key]=Y.tileID),C[k]=F}this._retainLoadedChildren(C,g,p,s);for(const k in S)s[k]||(this._coveredTiles[k]=!0,s[k]=S[k]);if(w){const k={},F={};for(const V of y)this._tiles[V.key].hasData()?k[V.key]=V:F[V.key]=V;for(const V in F){const G=F[V].children(this._source.maxzoom);this._tiles[G[0].key]&&this._tiles[G[1].key]&&this._tiles[G[2].key]&&this._tiles[G[3].key]&&(k[G[0].key]=s[G[0].key]=G[0],k[G[1].key]=s[G[1].key]=G[1],k[G[2].key]=s[G[2].key]=G[2],k[G[3].key]=s[G[3].key]=G[3],delete F[V])}for(const V in F){const G=F[V],J=this.findLoadedParent(G,this._source.minzoom),Y=this.findLoadedSibling(G),Q=J||Y||null;if(Q){k[Q.tileID.key]=s[Q.tileID.key]=Q.tileID;for(const se in k)k[se].isChildOf(Q.tileID)&&delete k[se]}}for(const V in this._tiles)k[V]||(this._coveredTiles[V]=!0)}}update(s,h){if(!this._sourceLoaded||this._paused)return;let p;this.transform=s,this.terrain=h,this.updateCacheSize(s),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?p=s.getVisibleUnwrappedCoordinates(this._source.tileID).map(B=>new a.Z(B.canonical.z,B.wrap,B.canonical.z,B.canonical.x,B.canonical.y)):(p=we(s,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:h,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(p=p.filter(B=>this._source.hasTile(B)))):p=[];const g=ct(s,this._source),y=Math.max(g-Ft.maxOverzooming,this._source.minzoom),w=Math.max(g+Ft.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const B={};for(const k of p)if(k.canonical.z>this._source.minzoom){const F=k.scaledTo(k.canonical.z-1);B[F.key]=F;const V=k.scaledTo(Math.max(this._source.minzoom,Math.min(k.canonical.z,5)));B[V.key]=V}p=p.concat(Object.values(B))}const S=p.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,S&&this.fire(new a.l("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const C=this._updateRetainedTiles(p,g);Ct(this._source.type)&&this._updateCoveredAndRetainedTiles(C,y,w,g,p,h);for(const B in C)this._tiles[B].clearFadeHold();const R=a.am(this._tiles,C);for(const B of R){const k=this._tiles[B];k.hasSymbolBuckets&&!k.holdingForFade()?k.setHoldDuration(this.map._fadeDuration):k.hasSymbolBuckets&&!k.symbolFadeFinished()||this._removeTile(B)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const s in this._tiles)this._tiles[s].holdingForFade()&&this._removeTile(s)}_updateRetainedTiles(s,h){var p;const g={},y={},w=Math.max(h-Ft.maxOverzooming,this._source.minzoom),S=Math.max(h+Ft.maxUnderzooming,this._source.minzoom),C={};for(const R of s){const B=this._addTile(R);g[R.key]=R,B.hasData()||h<this._source.maxzoom&&(C[R.key]=R)}this._retainLoadedChildren(C,h,S,g);for(const R of s){let B=this._tiles[R.key];if(B.hasData())continue;if(h+1>this._source.maxzoom){const F=R.children(this._source.maxzoom)[0],V=this.getTile(F);if(V&&V.hasData()){g[F.key]=F;continue}}else{const F=R.children(this._source.maxzoom);if(g[F[0].key]&&g[F[1].key]&&g[F[2].key]&&g[F[3].key])continue}let k=B.wasRequested();for(let F=R.overscaledZ-1;F>=w;--F){const V=R.scaledTo(F);if(y[V.key])break;if(y[V.key]=!0,B=this.getTile(V),!B&&k&&(B=this._addTile(V)),B){const G=B.hasData();if((G||!(!((p=this.map)===null||p===void 0)&&p.cancelPendingTileRequestsWhileZooming)||k)&&(g[V.key]=V),k=B.wasRequested(),G)break}}}return g}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const s in this._tiles){const h=[];let p,g=this._tiles[s].tileID;for(;g.overscaledZ>0;){if(g.key in this._loadedParentTiles){p=this._loadedParentTiles[g.key];break}h.push(g.key);const y=g.scaledTo(g.overscaledZ-1);if(p=this._getLoadedTile(y),p)break;g=y}for(const y of h)this._loadedParentTiles[y]=p}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const s in this._tiles){const h=this._tiles[s].tileID,p=this._getLoadedTile(h);this._loadedSiblingTiles[h.key]=p}}_addTile(s){let h=this._tiles[s.key];if(h)return h;h=this._cache.getAndRemove(s),h&&(this._setTileReloadTimer(s.key,h),h.tileID=s,this._state.initializeTileState(h,this.map?this.map.painter:null),this._cacheTimers[s.key]&&(clearTimeout(this._cacheTimers[s.key]),delete this._cacheTimers[s.key],this._setTileReloadTimer(s.key,h)));const p=h;return h||(h=new Rn(s,this._source.tileSize*s.overscaleFactor()),this._loadTile(h,s.key,h.state)),h.uses++,this._tiles[s.key]=h,p||this._source.fire(new a.l("dataloading",{tile:h,coord:h.tileID,dataType:"source"})),h}_setTileReloadTimer(s,h){s in this._timers&&(clearTimeout(this._timers[s]),delete this._timers[s]);const p=h.getExpiryTimeout();p&&(this._timers[s]=setTimeout(()=>{this._reloadTile(s,"expired"),delete this._timers[s]},p))}refreshTiles(s){for(const h in this._tiles)(this._isIdRenderable(h)||this._tiles[h].state=="errored")&&s.some(p=>p.equals(this._tiles[h].tileID.canonical))&&this._reloadTile(h,"expired")}_removeTile(s){const h=this._tiles[s];h&&(h.uses--,delete this._tiles[s],this._timers[s]&&(clearTimeout(this._timers[s]),delete this._timers[s]),h.uses>0||(h.hasData()&&h.state!=="reloading"?this._cache.add(h.tileID,h,h.getExpiryTimeout()):(h.aborted=!0,this._abortTile(h),this._unloadTile(h))))}_dataHandler(s){const h=s.sourceDataType;s.dataType==="source"&&h==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&s.dataType==="source"&&h==="content"&&(this.reload(s.sourceDataChanged),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const s in this._tiles)this._removeTile(s);this._cache.reset()}tilesIn(s,h,p){const g=[],y=this.transform;if(!y)return g;const w=y.getCoveringTilesDetailsProvider().allowWorldCopies(),S=p?y.getCameraQueryGeometry(s):s,C=V=>y.screenPointToMercatorCoordinate(V,this.terrain),R=this.transformBbox(s,C,!w),B=this.transformBbox(S,C,!w),k=this.getIds(),F=a.a2.fromPoints(B);for(let V=0;V<k.length;V++){const G=this._tiles[k[V]];if(G.holdingForFade())continue;const J=w?[G.tileID]:[G.tileID.unwrapTo(-1),G.tileID.unwrapTo(0)],Y=Math.pow(2,y.zoom-G.tileID.overscaledZ),Q=h*G.queryPadding*a.$/G.tileSize/Y;for(const se of J){const ce=F.map(ae=>se.getTilePoint(new a.a1(ae.x,ae.y)));if(ce.expandBy(Q),ce.intersects(Tt)){const ae=R.map(_e=>se.getTilePoint(_e)),ue=B.map(_e=>se.getTilePoint(_e));g.push({tile:G,tileID:w?se:se.unwrapTo(0),queryGeometry:ae,cameraQueryGeometry:ue,scale:Y})}}}return g}transformBbox(s,h,p){let g=s.map(h);if(p){const y=a.a2.fromPoints(s);y.shrinkBy(.001*Math.min(y.width(),y.height()));const w=y.map(h);a.a2.fromPoints(g).covers(w)||(g=g.map(S=>S.x>.5?new a.a1(S.x-1,S.y,S.z):S))}return g}getVisibleCoordinates(s){const h=this.getRenderableIds(s).map(p=>this._tiles[p].tileID);return this.transform&&this.transform.populateCache(h),h}hasTransition(){if(this._source.hasTransition())return!0;if(Ct(this._source.type)){const s=N.now();for(const h in this._tiles)if(this._tiles[h].fadeEndTime>=s)return!0}return!1}setFeatureState(s,h,p){this._state.updateState(s=s||"_geojsonTileLayer",h,p)}removeFeatureState(s,h,p){this._state.removeFeatureState(s=s||"_geojsonTileLayer",h,p)}getFeatureState(s,h){return this._state.getState(s=s||"_geojsonTileLayer",h)}setDependencies(s,h,p){const g=this._tiles[s];g&&g.setDependencies(h,p)}reloadTilesForDependencies(s,h){for(const p in this._tiles)this._tiles[p].hasDependency(s,h)&&this._reloadTile(p,"reloading");this._cache.filter(p=>!p.hasDependency(s,h))}}function pt(m,s){const h=Math.abs(2*m.wrap)-+(m.wrap<0),p=Math.abs(2*s.wrap)-+(s.wrap<0);return m.overscaledZ-s.overscaledZ||p-h||s.canonical.y-m.canonical.y||s.canonical.x-m.canonical.x}function Ct(m){return m==="raster"||m==="image"||m==="video"}Ft.maxOverzooming=10,Ft.maxUnderzooming=3;class Qt{constructor(s,h){this.reset(s,h)}reset(s,h){this.points=s||[],this._distances=[0];for(let p=1;p<this.points.length;p++)this._distances[p]=this._distances[p-1]+this.points[p].dist(this.points[p-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(h||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(s){if(this.points.length===1)return this.points[0];s=a.ah(s,0,1);let h=1,p=this._distances[h];const g=s*this.paddedLength+this.padding;for(;p<g&&h<this._distances.length;)p=this._distances[++h];const y=h-1,w=this._distances[y],S=p-w,C=S>0?(g-w)/S:0;return this.points[y].mult(1-C).add(this.points[h].mult(C))}}function Ui(m,s){let h=!0;return m==="always"||m!=="never"&&s!=="never"||(h=!1),h}class zi{constructor(s,h,p){const g=this.boxCells=[],y=this.circleCells=[];this.xCellCount=Math.ceil(s/p),this.yCellCount=Math.ceil(h/p);for(let w=0;w<this.xCellCount*this.yCellCount;w++)g.push([]),y.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=s,this.height=h,this.xScale=this.xCellCount/s,this.yScale=this.yCellCount/h,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(s,h,p,g,y){this._forEachCell(h,p,g,y,this._insertBoxCell,this.boxUid++),this.boxKeys.push(s),this.bboxes.push(h),this.bboxes.push(p),this.bboxes.push(g),this.bboxes.push(y)}insertCircle(s,h,p,g){this._forEachCell(h-g,p-g,h+g,p+g,this._insertCircleCell,this.circleUid++),this.circleKeys.push(s),this.circles.push(h),this.circles.push(p),this.circles.push(g)}_insertBoxCell(s,h,p,g,y,w){this.boxCells[y].push(w)}_insertCircleCell(s,h,p,g,y,w){this.circleCells[y].push(w)}_query(s,h,p,g,y,w,S){if(p<0||s>this.width||g<0||h>this.height)return[];const C=[];if(s<=0&&h<=0&&this.width<=p&&this.height<=g){if(y)return[{key:null,x1:s,y1:h,x2:p,y2:g}];for(let R=0;R<this.boxKeys.length;R++)C.push({key:this.boxKeys[R],x1:this.bboxes[4*R],y1:this.bboxes[4*R+1],x2:this.bboxes[4*R+2],y2:this.bboxes[4*R+3]});for(let R=0;R<this.circleKeys.length;R++){const B=this.circles[3*R],k=this.circles[3*R+1],F=this.circles[3*R+2];C.push({key:this.circleKeys[R],x1:B-F,y1:k-F,x2:B+F,y2:k+F})}}else this._forEachCell(s,h,p,g,this._queryCell,C,{hitTest:y,overlapMode:w,seenUids:{box:{},circle:{}}},S);return C}query(s,h,p,g){return this._query(s,h,p,g,!1,null)}hitTest(s,h,p,g,y,w){return this._query(s,h,p,g,!0,y,w).length>0}hitTestCircle(s,h,p,g,y){const w=s-p,S=s+p,C=h-p,R=h+p;if(S<0||w>this.width||R<0||C>this.height)return!1;const B=[];return this._forEachCell(w,C,S,R,this._queryCellCircle,B,{hitTest:!0,overlapMode:g,circle:{x:s,y:h,radius:p},seenUids:{box:{},circle:{}}},y),B.length>0}_queryCell(s,h,p,g,y,w,S,C){const{seenUids:R,hitTest:B,overlapMode:k}=S,F=this.boxCells[y];if(F!==null){const G=this.bboxes;for(const J of F)if(!R.box[J]){R.box[J]=!0;const Y=4*J,Q=this.boxKeys[J];if(s<=G[Y+2]&&h<=G[Y+3]&&p>=G[Y+0]&&g>=G[Y+1]&&(!C||C(Q))&&(!B||!Ui(k,Q.overlapMode))&&(w.push({key:Q,x1:G[Y],y1:G[Y+1],x2:G[Y+2],y2:G[Y+3]}),B))return!0}}const V=this.circleCells[y];if(V!==null){const G=this.circles;for(const J of V)if(!R.circle[J]){R.circle[J]=!0;const Y=3*J,Q=this.circleKeys[J];if(this._circleAndRectCollide(G[Y],G[Y+1],G[Y+2],s,h,p,g)&&(!C||C(Q))&&(!B||!Ui(k,Q.overlapMode))){const se=G[Y],ce=G[Y+1],ae=G[Y+2];if(w.push({key:Q,x1:se-ae,y1:ce-ae,x2:se+ae,y2:ce+ae}),B)return!0}}}return!1}_queryCellCircle(s,h,p,g,y,w,S,C){const{circle:R,seenUids:B,overlapMode:k}=S,F=this.boxCells[y];if(F!==null){const G=this.bboxes;for(const J of F)if(!B.box[J]){B.box[J]=!0;const Y=4*J,Q=this.boxKeys[J];if(this._circleAndRectCollide(R.x,R.y,R.radius,G[Y+0],G[Y+1],G[Y+2],G[Y+3])&&(!C||C(Q))&&!Ui(k,Q.overlapMode))return w.push(!0),!0}}const V=this.circleCells[y];if(V!==null){const G=this.circles;for(const J of V)if(!B.circle[J]){B.circle[J]=!0;const Y=3*J,Q=this.circleKeys[J];if(this._circlesCollide(G[Y],G[Y+1],G[Y+2],R.x,R.y,R.radius)&&(!C||C(Q))&&!Ui(k,Q.overlapMode))return w.push(!0),!0}}}_forEachCell(s,h,p,g,y,w,S,C){const R=this._convertToXCellCoord(s),B=this._convertToYCellCoord(h),k=this._convertToXCellCoord(p),F=this._convertToYCellCoord(g);for(let V=R;V<=k;V++)for(let G=B;G<=F;G++)if(y.call(this,s,h,p,g,this.xCellCount*G+V,w,S,C))return}_convertToXCellCoord(s){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(s*this.xScale)))}_convertToYCellCoord(s){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(s*this.yScale)))}_circlesCollide(s,h,p,g,y,w){const S=g-s,C=y-h,R=p+w;return R*R>S*S+C*C}_circleAndRectCollide(s,h,p,g,y,w,S){const C=(w-g)/2,R=Math.abs(s-(g+C));if(R>C+p)return!1;const B=(S-y)/2,k=Math.abs(h-(y+B));if(k>B+p)return!1;if(R<=C||k<=B)return!0;const F=R-C,V=k-B;return F*F+V*V<=p*p}}function Ei(m,s,h){const p=a.L();if(!m){const{vecSouth:k,vecEast:F}=Lt(s),V=A();V[0]=F[0],V[1]=F[1],V[2]=k[0],V[3]=k[1],g=V,(B=(w=(y=V)[0])*(R=y[3])-(C=y[2])*(S=y[1]))&&(g[0]=R*(B=1/B),g[1]=-S*B,g[2]=-C*B,g[3]=w*B),p[0]=V[0],p[1]=V[1],p[4]=V[2],p[5]=V[3]}var g,y,w,S,C,R,B;return a.N(p,p,[1/h,1/h,1]),p}function Bt(m,s,h,p){if(m){const g=a.L();if(!s){const{vecSouth:y,vecEast:w}=Lt(h);g[0]=w[0],g[1]=w[1],g[4]=y[0],g[5]=y[1]}return a.N(g,g,[p,p,1]),g}return h.pixelsToClipSpaceMatrix}function Lt(m){const s=Math.cos(m.rollInRadians),h=Math.sin(m.rollInRadians),p=Math.cos(m.pitchInRadians),g=Math.cos(m.bearingInRadians),y=Math.sin(m.bearingInRadians),w=a.ar();w[0]=-g*p*h-y*s,w[1]=-y*p*h+g*s;const S=a.as(w);S<1e-9?a.at(w):a.au(w,w,1/S);const C=a.ar();C[0]=g*p*s-y*h,C[1]=y*p*s+g*h;const R=a.as(C);return R<1e-9?a.at(C):a.au(C,C,1/R),{vecEast:C,vecSouth:w}}function Bi(m,s,h,p){let g;p?(g=[m,s,p(m,s),1],a.aw(g,g,h)):(g=[m,s,0,1],io(g,g,h));const y=g[3];return{point:new a.P(g[0]/y,g[1]/y),signedDistanceFromCamera:y,isOccluded:!1}}function We(m,s){return .5+m/s*.5}function Wi(m,s){return m.x>=-s[0]&&m.x<=s[0]&&m.y>=-s[1]&&m.y<=s[1]}function bi(m,s,h,p,g,y,w,S,C,R,B,k,F){const V=h?m.textSizeData:m.iconSizeData,G=a.an(V,s.transform.zoom),J=[256/s.width*2+1,256/s.height*2+1],Y=h?m.text.dynamicLayoutVertexArray:m.icon.dynamicLayoutVertexArray;Y.clear();const Q=m.lineVertexArray,se=h?m.text.placedSymbolArray:m.icon.placedSymbolArray,ce=s.transform.width/s.transform.height;let ae=!1;for(let ue=0;ue<se.length;ue++){const _e=se.get(ue);if(_e.hidden||_e.writingMode===a.ao.vertical&&!ae){ys(_e.numGlyphs,Y);continue}ae=!1;const le=new a.P(_e.anchorX,_e.anchorY),ve={getElevation:F,pitchedLabelPlaneMatrix:p,lineVertexArray:Q,pitchWithMap:y,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:s.transform,tileAnchorPoint:le,unwrappedTileID:C,width:R,height:B,translation:k},ke=Mr(_e.anchorX,_e.anchorY,ve);if(!Wi(ke.point,J)){ys(_e.numGlyphs,Y);continue}const Me=We(s.transform.cameraToCenterDistance,ke.signedDistanceFromCamera),Pe=a.ap(V,G,_e),Fe=y?Pe*s.transform.getPitchedTextCorrection(_e.anchorX,_e.anchorY,C)/Me:Pe*Me,Ze=rt({projectionContext:ve,pitchedLabelPlaneMatrixInverse:g,symbol:_e,fontSize:Fe,flip:!1,keepUpright:w,glyphOffsetArray:m.glyphOffsetArray,dynamicLayoutVertexArray:Y,aspectRatio:ce,rotateToLine:S});ae=Ze.useVertical,(Ze.notEnoughRoom||ae||Ze.needsFlipping&&rt({projectionContext:ve,pitchedLabelPlaneMatrixInverse:g,symbol:_e,fontSize:Fe,flip:!0,keepUpright:w,glyphOffsetArray:m.glyphOffsetArray,dynamicLayoutVertexArray:Y,aspectRatio:ce,rotateToLine:S}).notEnoughRoom)&&ys(_e.numGlyphs,Y)}h?m.text.dynamicLayoutVertexBuffer.updateData(Y):m.icon.dynamicLayoutVertexBuffer.updateData(Y)}function Ds(m,s,h,p,g,y,w,S){const C=y.glyphStartIndex+y.numGlyphs,R=y.lineStartIndex,B=y.lineStartIndex+y.lineLength,k=s.getoffsetX(y.glyphStartIndex),F=s.getoffsetX(C-1),V=ss(m*k,h,p,g,y.segment,R,B,S,w);if(!V)return null;const G=ss(m*F,h,p,g,y.segment,R,B,S,w);return G?S.projectionCache.anyProjectionOccluded?null:{first:V,last:G}:null}function eo(m,s,h,p){return m===a.ao.horizontal&&Math.abs(h.y-s.y)>Math.abs(h.x-s.x)*p?{useVertical:!0}:(m===a.ao.vertical?s.y<h.y:s.x>h.x)?{needsFlipping:!0}:null}function rt(m){const{projectionContext:s,pitchedLabelPlaneMatrixInverse:h,symbol:p,fontSize:g,flip:y,keepUpright:w,glyphOffsetArray:S,dynamicLayoutVertexArray:C,aspectRatio:R,rotateToLine:B}=m,k=g/24,F=p.lineOffsetX*k,V=p.lineOffsetY*k;let G;if(p.numGlyphs>1){const J=p.glyphStartIndex+p.numGlyphs,Y=p.lineStartIndex,Q=p.lineStartIndex+p.lineLength,se=Ds(k,S,F,V,y,p,B,s);if(!se)return{notEnoughRoom:!0};const ce=Os(se.first.point.x,se.first.point.y,s,h),ae=Os(se.last.point.x,se.last.point.y,s,h);if(w&&!y){const ue=eo(p.writingMode,ce,ae,R);if(ue)return ue}G=[se.first];for(let ue=p.glyphStartIndex+1;ue<J-1;ue++){const _e=ss(k*S.getoffsetX(ue),F,V,y,p.segment,Y,Q,s,B);if(!_e)return{notEnoughRoom:!0};G.push(_e)}G.push(se.last)}else{if(w&&!y){const Y=Xi(s.tileAnchorPoint.x,s.tileAnchorPoint.y,s).point,Q=p.lineStartIndex+p.segment+1,se=new a.P(s.lineVertexArray.getx(Q),s.lineVertexArray.gety(Q)),ce=Xi(se.x,se.y,s),ae=ce.signedDistanceFromCamera>0?ce.point:Ot(s.tileAnchorPoint,se,Y,1,s),ue=Os(Y.x,Y.y,s,h),_e=Os(ae.x,ae.y,s,h),le=eo(p.writingMode,ue,_e,R);if(le)return le}const J=ss(k*S.getoffsetX(p.glyphStartIndex),F,V,y,p.segment,p.lineStartIndex,p.lineStartIndex+p.lineLength,s,B);if(!J||s.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};G=[J]}for(const J of G)a.av(C,J.point,J.angle);return{}}function Ot(m,s,h,p,g){const y=m.add(m.sub(s)._unit()),w=Xi(y.x,y.y,g).point,S=h.sub(w);return h.add(S._mult(p/S.mag()))}function It(m,s,h){const p=s.projectionCache;if(p.projections[m])return p.projections[m];const g=new a.P(s.lineVertexArray.getx(m),s.lineVertexArray.gety(m)),y=Xi(g.x,g.y,s);if(y.signedDistanceFromCamera>0)return p.projections[m]=y.point,p.anyProjectionOccluded=p.anyProjectionOccluded||y.isOccluded,y.point;const w=m-h.direction;return Ot(h.distanceFromAnchor===0?s.tileAnchorPoint:new a.P(s.lineVertexArray.getx(w),s.lineVertexArray.gety(w)),g,h.previousVertex,h.absOffsetX-h.distanceFromAnchor+1,s)}function Xi(m,s,h){const p=m+h.translation[0],g=s+h.translation[1];let y;return h.pitchWithMap?(y=Bi(p,g,h.pitchedLabelPlaneMatrix,h.getElevation),y.isOccluded=!1):(y=h.transform.projectTileCoordinates(p,g,h.unwrappedTileID,h.getElevation),y.point.x=(.5*y.point.x+.5)*h.width,y.point.y=(.5*-y.point.y+.5)*h.height),y}function Os(m,s,h,p){if(h.pitchWithMap){const g=[m,s,0,1];return a.aw(g,g,p),h.transform.projectTileCoordinates(g[0]/g[3],g[1]/g[3],h.unwrappedTileID,h.getElevation).point}return{x:m/h.width*2-1,y:1-s/h.height*2}}function Mr(m,s,h){return h.transform.projectTileCoordinates(m,s,h.unwrappedTileID,h.getElevation)}function At(m,s,h){return m._unit()._perp()._mult(s*h)}function hn(m,s,h,p,g,y,w,S,C){if(S.projectionCache.offsets[m])return S.projectionCache.offsets[m];const R=h.add(s);if(m+C.direction<p||m+C.direction>=g)return S.projectionCache.offsets[m]=R,R;const B=It(m+C.direction,S,C),k=At(B.sub(h),w,C.direction),F=h.add(k),V=B.add(k);return S.projectionCache.offsets[m]=a.ax(y,R,F,V)||R,S.projectionCache.offsets[m]}function ss(m,s,h,p,g,y,w,S,C){const R=p?m-s:m+s;let B=R>0?1:-1,k=0;p&&(B*=-1,k=Math.PI),B<0&&(k+=Math.PI);let F,V=B>0?y+g:y+g+1;S.projectionCache.cachedAnchorPoint?F=S.projectionCache.cachedAnchorPoint:(F=Xi(S.tileAnchorPoint.x,S.tileAnchorPoint.y,S).point,S.projectionCache.cachedAnchorPoint=F);let G,J,Y=F,Q=F,se=0,ce=0;const ae=Math.abs(R),ue=[];let _e;for(;se+ce<=ae;){if(V+=B,V<y||V>=w)return null;se+=ce,Q=Y,J=G;const ke={absOffsetX:ae,direction:B,distanceFromAnchor:se,previousVertex:Q};if(Y=It(V,S,ke),h===0)ue.push(Q),_e=Y.sub(Q);else{let Me;const Pe=Y.sub(Q);Me=Pe.mag()===0?At(It(V+B,S,ke).sub(Y),h,B):At(Pe,h,B),J||(J=Q.add(Me)),G=hn(V,Me,Y,y,w,J,h,S,ke),ue.push(J),_e=G.sub(J)}ce=_e.mag()}const le=_e._mult((ae-se)/ce)._add(J||Q),ve=k+Math.atan2(Y.y-Q.y,Y.x-Q.x);return ue.push(le),{point:le,angle:C?ve:0,path:ue}}const to=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function ys(m,s){for(let h=0;h<m;h++){const p=s.length;s.resize(p+4),s.float32.set(to,3*p)}}function io(m,s,h){const p=s[0],g=s[1];return m[0]=h[0]*p+h[4]*g+h[12],m[1]=h[1]*p+h[5]*g+h[13],m[3]=h[3]*p+h[7]*g+h[15],m}const hi=100;class xr{constructor(s,h=new zi(s.width+200,s.height+200,25),p=new zi(s.width+200,s.height+200,25)){this.transform=s,this.grid=h,this.ignoredGrid=p,this.pitchFactor=Math.cos(s.pitch*Math.PI/180)*s.cameraToCenterDistance,this.screenRightBoundary=s.width+hi,this.screenBottomBoundary=s.height+hi,this.gridRightBoundary=s.width+200,this.gridBottomBoundary=s.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(s,h,p,g,y,w,S,C,R,B,k,F){const V=this.projectAndGetPerspectiveRatio(s.anchorPointX+C[0],s.anchorPointY+C[1],y,B,F),G=p*V.perspectiveRatio;let J;if(w||S)J=this._projectCollisionBox(s,G,g,y,w,S,C,V,B,k,F);else{const _e=V.x+(k?k.x*G:0),le=V.y+(k?k.y*G:0);J={allPointsOccluded:!1,box:[_e+s.x1*G,le+s.y1*G,_e+s.x2*G,le+s.y2*G]}}const[Y,Q,se,ce]=J.box,ae=w?J.allPointsOccluded:V.isOccluded;let ue=ae;return ue||(ue=V.perspectiveRatio<this.perspectiveRatioCutoff),ue||(ue=!this.isInsideGrid(Y,Q,se,ce)),ue||h!=="always"&&this.grid.hitTest(Y,Q,se,ce,h,R)?{box:[Y,Q,se,ce],placeable:!1,offscreen:!1,occluded:ae}:{box:[Y,Q,se,ce],placeable:!0,offscreen:this.isOffscreen(Y,Q,se,ce),occluded:ae}}placeCollisionCircles(s,h,p,g,y,w,S,C,R,B,k,F,V,G){const J=[],Y=new a.P(h.anchorX,h.anchorY),Q=this.getPerspectiveRatio(Y.x,Y.y,w,G),se=(R?y*this.transform.getPitchedTextCorrection(h.anchorX,h.anchorY,w)/Q:y*Q)/a.aB,ce={getElevation:G,pitchedLabelPlaneMatrix:S,lineVertexArray:p,pitchWithMap:R,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:Y,unwrappedTileID:w,width:this.transform.width,height:this.transform.height,translation:V},ae=Ds(se,g,h.lineOffsetX*se,h.lineOffsetY*se,!1,h,!1,ce);let ue=!1,_e=!1,le=!0;if(ae){const ve=.5*k*Q+F,ke=new a.P(-100,-100),Me=new a.P(this.screenRightBoundary,this.screenBottomBoundary),Pe=new Qt,Fe=ae.first,Ze=ae.last;let Ye=[];for(let Dt=Fe.path.length-1;Dt>=1;Dt--)Ye.push(Fe.path[Dt]);for(let Dt=1;Dt<Ze.path.length;Dt++)Ye.push(Ze.path[Dt]);const je=2.5*ve;if(R){const Dt=this.projectPathToScreenSpace(Ye,ce);Ye=Dt.some(qt=>qt.signedDistanceFromCamera<=0)?[]:Dt.map(qt=>qt.point)}let ut=[];if(Ye.length>0){const Dt=Ye[0].clone(),qt=Ye[0].clone();for(let si=1;si<Ye.length;si++)Dt.x=Math.min(Dt.x,Ye[si].x),Dt.y=Math.min(Dt.y,Ye[si].y),qt.x=Math.max(qt.x,Ye[si].x),qt.y=Math.max(qt.y,Ye[si].y);ut=Dt.x>=ke.x&&qt.x<=Me.x&&Dt.y>=ke.y&&qt.y<=Me.y?[Ye]:qt.x<ke.x||Dt.x>Me.x||qt.y<ke.y||Dt.y>Me.y?[]:a.ay([Ye],ke.x,ke.y,Me.x,Me.y)}for(const Dt of ut){Pe.reset(Dt,.25*ve);let qt=0;qt=Pe.length<=.5*ve?1:Math.ceil(Pe.paddedLength/je)+1;for(let si=0;si<qt;si++){const ei=si/Math.max(qt-1,1),wi=Pe.lerp(ei),Ii=wi.x+hi,Pt=wi.y+hi;J.push(Ii,Pt,ve,0);const ni=Ii-ve,Zi=Pt-ve,er=Ii+ve,ur=Pt+ve;if(le=le&&this.isOffscreen(ni,Zi,er,ur),_e=_e||this.isInsideGrid(ni,Zi,er,ur),s!=="always"&&this.grid.hitTestCircle(Ii,Pt,ve,s,B)&&(ue=!0,!C))return{circles:[],offscreen:!1,collisionDetected:ue}}}}return{circles:!C&&ue||!_e||Q<this.perspectiveRatioCutoff?[]:J,offscreen:le,collisionDetected:ue}}projectPathToScreenSpace(s,h){const p=function(g,y){const w=a.L();return a.aq(w,y.pitchedLabelPlaneMatrix),g.map(S=>{const C=Bi(S.x,S.y,w,y.getElevation),R=y.transform.projectTileCoordinates(C.point.x,C.point.y,y.unwrappedTileID,y.getElevation);return R.point.x=(.5*R.point.x+.5)*y.width,R.point.y=(.5*-R.point.y+.5)*y.height,R})}(s,h);return function(g){let y=0,w=0,S=0,C=0;for(let R=0;R<g.length;R++)g[R].isOccluded?(S=R+1,C=0):(C++,C>w&&(w=C,y=S));return g.slice(y,y+w)}(p)}queryRenderedSymbols(s){if(s.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const h=[],p=new a.a2;for(const k of s){const F=new a.P(k.x+hi,k.y+hi);p.extend(F),h.push(F)}const{minX:g,minY:y,maxX:w,maxY:S}=p,C=this.grid.query(g,y,w,S).concat(this.ignoredGrid.query(g,y,w,S)),R={},B={};for(const k of C){const F=k.key;if(R[F.bucketInstanceId]===void 0&&(R[F.bucketInstanceId]={}),R[F.bucketInstanceId][F.featureIndex])continue;const V=[new a.P(k.x1,k.y1),new a.P(k.x2,k.y1),new a.P(k.x2,k.y2),new a.P(k.x1,k.y2)];a.az(h,V)&&(R[F.bucketInstanceId][F.featureIndex]=!0,B[F.bucketInstanceId]===void 0&&(B[F.bucketInstanceId]=[]),B[F.bucketInstanceId].push(F.featureIndex))}return B}insertCollisionBox(s,h,p,g,y,w){(p?this.ignoredGrid:this.grid).insert({bucketInstanceId:g,featureIndex:y,collisionGroupID:w,overlapMode:h},s[0],s[1],s[2],s[3])}insertCollisionCircles(s,h,p,g,y,w){const S=p?this.ignoredGrid:this.grid,C={bucketInstanceId:g,featureIndex:y,collisionGroupID:w,overlapMode:h};for(let R=0;R<s.length;R+=4)S.insertCircle(C,s[R],s[R+1],s[R+2])}projectAndGetPerspectiveRatio(s,h,p,g,y){if(y){let w;g?(w=[s,h,g(s,h),1],a.aw(w,w,y)):(w=[s,h,0,1],io(w,w,y));const S=w[3];return{x:(w[0]/S+1)/2*this.transform.width+hi,y:(-w[1]/S+1)/2*this.transform.height+hi,perspectiveRatio:.5+this.transform.cameraToCenterDistance/S*.5,isOccluded:!1,signedDistanceFromCamera:S}}{const w=this.transform.projectTileCoordinates(s,h,p,g);return{x:(w.point.x+1)/2*this.transform.width+hi,y:(1-w.point.y)/2*this.transform.height+hi,perspectiveRatio:.5+this.transform.cameraToCenterDistance/w.signedDistanceFromCamera*.5,isOccluded:w.isOccluded,signedDistanceFromCamera:w.signedDistanceFromCamera}}}getPerspectiveRatio(s,h,p,g){const y=this.transform.projectTileCoordinates(s,h,p,g);return .5+this.transform.cameraToCenterDistance/y.signedDistanceFromCamera*.5}isOffscreen(s,h,p,g){return p<hi||s>=this.screenRightBoundary||g<hi||h>this.screenBottomBoundary}isInsideGrid(s,h,p,g){return p>=0&&s<this.gridRightBoundary&&g>=0&&h<this.gridBottomBoundary}getViewportMatrix(){const s=a.ag([]);return a.M(s,s,[-100,-100,0]),s}_projectCollisionBox(s,h,p,g,y,w,S,C,R,B,k){let F=1,V=0,G=0,J=1;const Y=s.anchorPointX+S[0],Q=s.anchorPointY+S[1];if(w&&!y){const Ye=this.projectAndGetPerspectiveRatio(Y+1,Q,g,R,k),je=Ye.x-C.x,ut=Math.atan((Ye.y-C.y)/je)+(je<0?Math.PI:0),Dt=Math.sin(ut),qt=Math.cos(ut);F=qt,V=Dt,G=-Dt,J=qt}else if(!w&&y){const Ye=Lt(this.transform);F=Ye.vecEast[0],V=Ye.vecEast[1],G=Ye.vecSouth[0],J=Ye.vecSouth[1]}let se=C.x,ce=C.y,ae=h;y&&(se=Y,ce=Q,ae=Math.pow(2,-(this.transform.zoom-p.overscaledZ)),ae*=this.transform.getPitchedTextCorrection(Y,Q,g),B||(ae*=a.ah(.5+C.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),B&&(se+=F*B.x*ae+G*B.y*ae,ce+=V*B.x*ae+J*B.y*ae);const ue=s.x1*ae,_e=s.x2*ae,le=(ue+_e)/2,ve=s.y1*ae,ke=s.y2*ae,Me=(ve+ke)/2,Pe=[{offsetX:ue,offsetY:ve},{offsetX:le,offsetY:ve},{offsetX:_e,offsetY:ve},{offsetX:_e,offsetY:Me},{offsetX:_e,offsetY:ke},{offsetX:le,offsetY:ke},{offsetX:ue,offsetY:ke},{offsetX:ue,offsetY:Me}];let Fe=[];for(const{offsetX:Ye,offsetY:je}of Pe)Fe.push(new a.P(se+F*Ye+G*je,ce+V*Ye+J*je));let Ze=!1;if(y){const Ye=Fe.map(je=>this.projectAndGetPerspectiveRatio(je.x,je.y,g,R,k));Ze=Ye.some(je=>!je.isOccluded),Fe=Ye.map(je=>new a.P(je.x,je.y))}else Ze=!0;return{box:a.aA(Fe),allPointsOccluded:!Ze}}}class Vi{constructor(s,h,p,g){this.opacity=s?Math.max(0,Math.min(1,s.opacity+(s.placed?h:-h))):g&&p?1:0,this.placed=p}isHidden(){return this.opacity===0&&!this.placed}}class Vt{constructor(s,h,p,g,y){this.text=new Vi(s?s.text:null,h,p,y),this.icon=new Vi(s?s.icon:null,h,g,y)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class bs{constructor(s,h,p){this.text=s,this.icon=h,this.skipFade=p}}class Fs{constructor(s,h,p,g,y){this.bucketInstanceId=s,this.featureIndex=h,this.sourceLayerIndex=p,this.bucketIndex=g,this.tileID=y}}class Kr{constructor(s){this.crossSourceCollisions=s,this.maxGroupID=0,this.collisionGroups={}}get(s){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[s]){const h=++this.maxGroupID;this.collisionGroups[s]={ID:h,predicate:p=>p.collisionGroupID===h}}return this.collisionGroups[s]}}function lr(m,s,h,p,g){const{horizontalAlign:y,verticalAlign:w}=a.aH(m);return new a.P(-(y-.5)*s+p[0]*g,-(w-.5)*h+p[1]*g)}class ks{constructor(s,h,p,g,y){this.transform=s.clone(),this.terrain=h,this.collisionIndex=new xr(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=p,this.retainedQueryData={},this.collisionGroups=new Kr(g),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=y,y&&(y.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(s){const h=this.terrain;return h?(p,g)=>h.getElevation(s,p,g):null}getBucketParts(s,h,p,g){const y=p.getBucket(h),w=p.latestFeatureIndex;if(!y||!w||h.id!==y.layerIds[0])return;const S=p.collisionBoxArray,C=y.layers[0].layout,R=y.layers[0].paint,B=Math.pow(2,this.transform.zoom-p.tileID.overscaledZ),k=p.tileSize/a.$,F=p.tileID.toUnwrapped(),V=C.get("text-rotation-alignment")==="map",G=a.aC(p,1,this.transform.zoom),J=a.aD(this.collisionIndex.transform,p,R.get("text-translate"),R.get("text-translate-anchor")),Y=a.aD(this.collisionIndex.transform,p,R.get("icon-translate"),R.get("icon-translate-anchor")),Q=Ei(V,this.transform,G);this.retainedQueryData[y.bucketInstanceId]=new Fs(y.bucketInstanceId,w,y.sourceLayerIndex,y.index,p.tileID);const se={bucket:y,layout:C,translationText:J,translationIcon:Y,unwrappedTileID:F,pitchedLabelPlaneMatrix:Q,scale:B,textPixelRatio:k,holdingForFade:p.holdingForFade(),collisionBoxArray:S,partiallyEvaluatedTextSize:a.an(y.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(y.sourceID)};if(g)for(const ce of y.sortKeyRanges){const{sortKey:ae,symbolInstanceStart:ue,symbolInstanceEnd:_e}=ce;s.push({sortKey:ae,symbolInstanceStart:ue,symbolInstanceEnd:_e,parameters:se})}else s.push({symbolInstanceStart:0,symbolInstanceEnd:y.symbolInstances.length,parameters:se})}attemptAnchorPlacement(s,h,p,g,y,w,S,C,R,B,k,F,V,G,J,Y,Q,se,ce,ae){const ue=a.aE[s.textAnchor],_e=[s.textOffset0,s.textOffset1],le=lr(ue,p,g,_e,y),ve=this.collisionIndex.placeCollisionBox(h,F,C,R,B,S,w,Y,k.predicate,ce,le,ae);if((!se||this.collisionIndex.placeCollisionBox(se,F,C,R,B,S,w,Q,k.predicate,ce,le,ae).placeable)&&ve.placeable){let ke;if(this.prevPlacement&&this.prevPlacement.variableOffsets[V.crossTileID]&&this.prevPlacement.placements[V.crossTileID]&&this.prevPlacement.placements[V.crossTileID].text&&(ke=this.prevPlacement.variableOffsets[V.crossTileID].anchor),V.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[V.crossTileID]={textOffset:_e,width:p,height:g,anchor:ue,textBoxScale:y,prevAnchor:ke},this.markUsedJustification(G,ue,V,J),G.allowVerticalPlacement&&(this.markUsedOrientation(G,J,V),this.placedOrientations[V.crossTileID]=J),{shift:le,placedGlyphBoxes:ve}}}placeLayerBucketPart(s,h,p){const{bucket:g,layout:y,translationText:w,translationIcon:S,unwrappedTileID:C,pitchedLabelPlaneMatrix:R,textPixelRatio:B,holdingForFade:k,collisionBoxArray:F,partiallyEvaluatedTextSize:V,collisionGroup:G}=s.parameters,J=y.get("text-optional"),Y=y.get("icon-optional"),Q=a.aF(y,"text-overlap","text-allow-overlap"),se=Q==="always",ce=a.aF(y,"icon-overlap","icon-allow-overlap"),ae=ce==="always",ue=y.get("text-rotation-alignment")==="map",_e=y.get("text-pitch-alignment")==="map",le=y.get("icon-text-fit")!=="none",ve=y.get("symbol-z-order")==="viewport-y",ke=se&&(ae||!g.hasIconData()||Y),Me=ae&&(se||!g.hasTextData()||J);!g.collisionArrays&&F&&g.deserializeCollisionBoxes(F);const Pe=this.retainedQueryData[g.bucketInstanceId].tileID,Fe=this._getTerrainElevationFunc(Pe),Ze=this.transform.getFastPathSimpleProjectionMatrix(Pe),Ye=(je,ut,Dt)=>{var qt,si;if(h[je.crossTileID])return;if(k)return void(this.placements[je.crossTileID]=new bs(!1,!1,!1));let ei=!1,wi=!1,Ii=!0,Pt=null,ni={box:null,placeable:!1,offscreen:null,occluded:!1},Zi={placeable:!1},er=null,ur=null,Hr=null,$s=0,ao=0,lo=0;ut.textFeatureIndex?$s=ut.textFeatureIndex:je.useRuntimeCollisionCircles&&($s=je.featureIndex),ut.verticalTextFeatureIndex&&(ao=ut.verticalTextFeatureIndex);const Ia=ut.textBox;if(Ia){const es=Ki=>{let tr=a.ao.horizontal;if(g.allowVerticalPlacement&&!Ki&&this.prevPlacement){const Ts=this.prevPlacement.placedOrientations[je.crossTileID];Ts&&(this.placedOrientations[je.crossTileID]=Ts,tr=Ts,this.markUsedOrientation(g,tr,je))}return tr},Ws=(Ki,tr)=>{if(g.allowVerticalPlacement&&je.numVerticalGlyphVertices>0&&ut.verticalTextBox){for(const Ts of g.writingModes)if(Ts===a.ao.vertical?(ni=tr(),Zi=ni):ni=Ki(),ni&&ni.placeable)break}else ni=Ki()},Gr=je.textAnchorOffsetStartIndex,co=je.textAnchorOffsetEndIndex;if(co===Gr){const Ki=(tr,Ts)=>{const Yi=this.collisionIndex.placeCollisionBox(tr,Q,B,Pe,C,_e,ue,w,G.predicate,Fe,void 0,Ze);return Yi&&Yi.placeable&&(this.markUsedOrientation(g,Ts,je),this.placedOrientations[je.crossTileID]=Ts),Yi};Ws(()=>Ki(Ia,a.ao.horizontal),()=>{const tr=ut.verticalTextBox;return g.allowVerticalPlacement&&je.numVerticalGlyphVertices>0&&tr?Ki(tr,a.ao.vertical):{box:null,offscreen:null}}),es(ni&&ni.placeable)}else{let Ki=a.aE[(si=(qt=this.prevPlacement)===null||qt===void 0?void 0:qt.variableOffsets[je.crossTileID])===null||si===void 0?void 0:si.anchor];const tr=(Yi,Dl,Ra)=>{const On=Yi.x2-Yi.x1,Xs=Yi.y2-Yi.y1,ho=je.textBoxScale,e_=le&&ce==="never"?Dl:null;let as=null,t_=Q==="never"?1:2,ad="never";Ki&&t_++;for(let ch=0;ch<t_;ch++){for(let hh=Gr;hh<co;hh++){const uo=g.textAnchorOffsets.get(hh);if(Ki&&uo.textAnchor!==Ki)continue;const Fn=this.attemptAnchorPlacement(uo,Yi,On,Xs,ho,ue,_e,B,Pe,C,G,ad,je,g,Ra,w,S,e_,Fe);if(Fn&&(as=Fn.placedGlyphBoxes,as&&as.placeable))return ei=!0,Pt=Fn.shift,as}Ki?Ki=null:ad=Q}return p&&!as&&(as={box:this.collisionIndex.placeCollisionBox(Ia,"always",B,Pe,C,_e,ue,w,G.predicate,Fe,void 0,Ze).box,offscreen:!1,placeable:!1,occluded:!1}),as};Ws(()=>tr(Ia,ut.iconBox,a.ao.horizontal),()=>{const Yi=ut.verticalTextBox;return g.allowVerticalPlacement&&(!ni||!ni.placeable)&&je.numVerticalGlyphVertices>0&&Yi?tr(Yi,ut.verticalIconBox,a.ao.vertical):{box:null,occluded:!0,offscreen:null}}),ni&&(ei=ni.placeable,Ii=ni.offscreen);const Ts=es(ni&&ni.placeable);if(!ei&&this.prevPlacement){const Yi=this.prevPlacement.variableOffsets[je.crossTileID];Yi&&(this.variableOffsets[je.crossTileID]=Yi,this.markUsedJustification(g,Yi.anchor,je,Ts))}}}if(er=ni,ei=er&&er.placeable,Ii=er&&er.offscreen,je.useRuntimeCollisionCircles){const es=g.text.placedSymbolArray.get(je.centerJustifiedTextSymbolIndex),Ws=a.ap(g.textSizeData,V,es),Gr=y.get("text-padding");ur=this.collisionIndex.placeCollisionCircles(Q,es,g.lineVertexArray,g.glyphOffsetArray,Ws,C,R,p,_e,G.predicate,je.collisionCircleDiameter,Gr,w,Fe),ur.circles.length&&ur.collisionDetected&&!p&&a.w("Collisions detected, but collision boxes are not shown"),ei=se||ur.circles.length>0&&!ur.collisionDetected,Ii=Ii&&ur.offscreen}if(ut.iconFeatureIndex&&(lo=ut.iconFeatureIndex),ut.iconBox){const es=Ws=>this.collisionIndex.placeCollisionBox(Ws,ce,B,Pe,C,_e,ue,S,G.predicate,Fe,le&&Pt?Pt:void 0,Ze);Zi&&Zi.placeable&&ut.verticalIconBox?(Hr=es(ut.verticalIconBox),wi=Hr.placeable):(Hr=es(ut.iconBox),wi=Hr.placeable),Ii=Ii&&Hr.offscreen}const Ma=J||je.numHorizontalGlyphVertices===0&&je.numVerticalGlyphVertices===0,zo=Y||je.numIconVertices===0;Ma||zo?zo?Ma||(wi=wi&&ei):ei=wi&&ei:wi=ei=wi&&ei;const Vo=wi&&Hr.placeable;if(ei&&er.placeable&&this.collisionIndex.insertCollisionBox(er.box,Q,y.get("text-ignore-placement"),g.bucketInstanceId,Zi&&Zi.placeable&&ao?ao:$s,G.ID),Vo&&this.collisionIndex.insertCollisionBox(Hr.box,ce,y.get("icon-ignore-placement"),g.bucketInstanceId,lo,G.ID),ur&&ei&&this.collisionIndex.insertCollisionCircles(ur.circles,Q,y.get("text-ignore-placement"),g.bucketInstanceId,$s,G.ID),p&&this.storeCollisionData(g.bucketInstanceId,Dt,ut,er,Hr,ur),je.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(g.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[je.crossTileID]=new bs((ei||ke)&&!(er!=null&&er.occluded),(wi||Me)&&!(Hr!=null&&Hr.occluded),Ii||g.justReloaded),h[je.crossTileID]=!0};if(ve){if(s.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const je=g.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let ut=je.length-1;ut>=0;--ut){const Dt=je[ut];Ye(g.symbolInstances.get(Dt),g.collisionArrays[Dt],Dt)}}else for(let je=s.symbolInstanceStart;je<s.symbolInstanceEnd;je++)Ye(g.symbolInstances.get(je),g.collisionArrays[je],je);g.justReloaded=!1}storeCollisionData(s,h,p,g,y,w){if(p.textBox||p.iconBox){let S,C;this.collisionBoxArrays.has(s)?S=this.collisionBoxArrays.get(s):(S=new Map,this.collisionBoxArrays.set(s,S)),S.has(h)?C=S.get(h):(C={text:null,icon:null},S.set(h,C)),p.textBox&&(C.text=g.box),p.iconBox&&(C.icon=y.box)}if(w){let S=this.collisionCircleArrays[s];S===void 0&&(S=this.collisionCircleArrays[s]=[]);for(let C=0;C<w.circles.length;C+=4)S.push(w.circles[C+0]-hi),S.push(w.circles[C+1]-hi),S.push(w.circles[C+2]),S.push(w.collisionDetected?1:0)}}markUsedJustification(s,h,p,g){let y;y=g===a.ao.vertical?p.verticalPlacedTextSymbolIndex:{left:p.leftJustifiedTextSymbolIndex,center:p.centerJustifiedTextSymbolIndex,right:p.rightJustifiedTextSymbolIndex}[a.aG(h)];const w=[p.leftJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.rightJustifiedTextSymbolIndex,p.verticalPlacedTextSymbolIndex];for(const S of w)S>=0&&(s.text.placedSymbolArray.get(S).crossTileID=y>=0&&S!==y?0:p.crossTileID)}markUsedOrientation(s,h,p){const g=h===a.ao.horizontal||h===a.ao.horizontalOnly?h:0,y=h===a.ao.vertical?h:0,w=[p.leftJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.rightJustifiedTextSymbolIndex];for(const S of w)s.text.placedSymbolArray.get(S).placedOrientation=g;p.verticalPlacedTextSymbolIndex&&(s.text.placedSymbolArray.get(p.verticalPlacedTextSymbolIndex).placedOrientation=y)}commit(s){this.commitTime=s,this.zoomAtLastRecencyCheck=this.transform.zoom;const h=this.prevPlacement;let p=!1;this.prevZoomAdjustment=h?h.zoomAdjustment(this.transform.zoom):0;const g=h?h.symbolFadeChange(s):1,y=h?h.opacities:{},w=h?h.variableOffsets:{},S=h?h.placedOrientations:{};for(const C in this.placements){const R=this.placements[C],B=y[C];B?(this.opacities[C]=new Vt(B,g,R.text,R.icon),p=p||R.text!==B.text.placed||R.icon!==B.icon.placed):(this.opacities[C]=new Vt(null,g,R.text,R.icon,R.skipFade),p=p||R.text||R.icon)}for(const C in y){const R=y[C];if(!this.opacities[C]){const B=new Vt(R,g,!1,!1);B.isHidden()||(this.opacities[C]=B,p=p||R.text.placed||R.icon.placed)}}for(const C in w)this.variableOffsets[C]||!this.opacities[C]||this.opacities[C].isHidden()||(this.variableOffsets[C]=w[C]);for(const C in S)this.placedOrientations[C]||!this.opacities[C]||this.opacities[C].isHidden()||(this.placedOrientations[C]=S[C]);if(h&&h.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");p?this.lastPlacementChangeTime=s:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=h?h.lastPlacementChangeTime:s)}updateLayerOpacities(s,h){const p={};for(const g of h){const y=g.getBucket(s);y&&g.latestFeatureIndex&&s.id===y.layerIds[0]&&this.updateBucketOpacities(y,g.tileID,p,g.collisionBoxArray)}}updateBucketOpacities(s,h,p,g){s.hasTextData()&&(s.text.opacityVertexArray.clear(),s.text.hasVisibleVertices=!1),s.hasIconData()&&(s.icon.opacityVertexArray.clear(),s.icon.hasVisibleVertices=!1),s.hasIconCollisionBoxData()&&s.iconCollisionBox.collisionVertexArray.clear(),s.hasTextCollisionBoxData()&&s.textCollisionBox.collisionVertexArray.clear();const y=s.layers[0],w=y.layout,S=new Vt(null,0,!1,!1,!0),C=w.get("text-allow-overlap"),R=w.get("icon-allow-overlap"),B=y._unevaluatedLayout.hasValue("text-variable-anchor")||y._unevaluatedLayout.hasValue("text-variable-anchor-offset"),k=w.get("text-rotation-alignment")==="map",F=w.get("text-pitch-alignment")==="map",V=w.get("icon-text-fit")!=="none",G=new Vt(null,0,C&&(R||!s.hasIconData()||w.get("icon-optional")),R&&(C||!s.hasTextData()||w.get("text-optional")),!0);!s.collisionArrays&&g&&(s.hasIconCollisionBoxData()||s.hasTextCollisionBoxData())&&s.deserializeCollisionBoxes(g);const J=(Q,se,ce)=>{for(let ae=0;ae<se/4;ae++)Q.opacityVertexArray.emplaceBack(ce);Q.hasVisibleVertices=Q.hasVisibleVertices||ce!==Nr},Y=this.collisionBoxArrays.get(s.bucketInstanceId);for(let Q=0;Q<s.symbolInstances.length;Q++){const se=s.symbolInstances.get(Q),{numHorizontalGlyphVertices:ce,numVerticalGlyphVertices:ae,crossTileID:ue}=se;let _e=this.opacities[ue];p[ue]?_e=S:_e||(_e=G,this.opacities[ue]=_e),p[ue]=!0;const le=se.numIconVertices>0,ve=this.placedOrientations[se.crossTileID],ke=ve===a.ao.vertical,Me=ve===a.ao.horizontal||ve===a.ao.horizontalOnly;if(ce>0||ae>0){const Fe=ro(_e.text);J(s.text,ce,ke?Nr:Fe),J(s.text,ae,Me?Nr:Fe);const Ze=_e.text.isHidden();[se.rightJustifiedTextSymbolIndex,se.centerJustifiedTextSymbolIndex,se.leftJustifiedTextSymbolIndex].forEach(ut=>{ut>=0&&(s.text.placedSymbolArray.get(ut).hidden=Ze||ke?1:0)}),se.verticalPlacedTextSymbolIndex>=0&&(s.text.placedSymbolArray.get(se.verticalPlacedTextSymbolIndex).hidden=Ze||Me?1:0);const Ye=this.variableOffsets[se.crossTileID];Ye&&this.markUsedJustification(s,Ye.anchor,se,ve);const je=this.placedOrientations[se.crossTileID];je&&(this.markUsedJustification(s,"left",se,je),this.markUsedOrientation(s,je,se))}if(le){const Fe=ro(_e.icon),Ze=!(V&&se.verticalPlacedIconSymbolIndex&&ke);se.placedIconSymbolIndex>=0&&(J(s.icon,se.numIconVertices,Ze?Fe:Nr),s.icon.placedSymbolArray.get(se.placedIconSymbolIndex).hidden=_e.icon.isHidden()),se.verticalPlacedIconSymbolIndex>=0&&(J(s.icon,se.numVerticalIconVertices,Ze?Nr:Fe),s.icon.placedSymbolArray.get(se.verticalPlacedIconSymbolIndex).hidden=_e.icon.isHidden())}const Pe=Y&&Y.has(Q)?Y.get(Q):{text:null,icon:null};if(s.hasIconCollisionBoxData()||s.hasTextCollisionBoxData()){const Fe=s.collisionArrays[Q];if(Fe){let Ze=new a.P(0,0);if(Fe.textBox||Fe.verticalTextBox){let Ye=!0;if(B){const je=this.variableOffsets[ue];je?(Ze=lr(je.anchor,je.width,je.height,je.textOffset,je.textBoxScale),k&&Ze._rotate(F?-this.transform.bearingInRadians:this.transform.bearingInRadians)):Ye=!1}if(Fe.textBox||Fe.verticalTextBox){let je;Fe.textBox&&(je=ke),Fe.verticalTextBox&&(je=Me),la(s.textCollisionBox.collisionVertexArray,_e.text.placed,!Ye||je,Pe.text,Ze.x,Ze.y)}}if(Fe.iconBox||Fe.verticalIconBox){const Ye=!!(!Me&&Fe.verticalIconBox);let je;Fe.iconBox&&(je=Ye),Fe.verticalIconBox&&(je=!Ye),la(s.iconCollisionBox.collisionVertexArray,_e.icon.placed,je,Pe.icon,V?Ze.x:0,V?Ze.y:0)}}}}if(s.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[s.bucketInstanceId]&&(this.retainedQueryData[s.bucketInstanceId].featureSortOrder=s.featureSortOrder),s.hasTextData()&&s.text.opacityVertexBuffer&&s.text.opacityVertexBuffer.updateData(s.text.opacityVertexArray),s.hasIconData()&&s.icon.opacityVertexBuffer&&s.icon.opacityVertexBuffer.updateData(s.icon.opacityVertexArray),s.hasIconCollisionBoxData()&&s.iconCollisionBox.collisionVertexBuffer&&s.iconCollisionBox.collisionVertexBuffer.updateData(s.iconCollisionBox.collisionVertexArray),s.hasTextCollisionBoxData()&&s.textCollisionBox.collisionVertexBuffer&&s.textCollisionBox.collisionVertexBuffer.updateData(s.textCollisionBox.collisionVertexArray),s.text.opacityVertexArray.length!==s.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${s.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${s.text.layoutVertexArray.length}) / 4`);if(s.icon.opacityVertexArray.length!==s.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${s.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${s.icon.layoutVertexArray.length}) / 4`);s.bucketInstanceId in this.collisionCircleArrays&&(s.collisionCircleArray=this.collisionCircleArrays[s.bucketInstanceId],delete this.collisionCircleArrays[s.bucketInstanceId])}symbolFadeChange(s){return this.fadeDuration===0?1:(s-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(s){return Math.max(0,(this.transform.zoom-s)/1.5)}hasTransitions(s){return this.stale||s-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(s,h){const p=this.zoomAtLastRecencyCheck===h?1-this.zoomAdjustment(h):1;return this.zoomAtLastRecencyCheck=h,this.commitTime+this.fadeDuration*p>s}setStale(){this.stale=!0}}function la(m,s,h,p,g,y){p&&p.length!==0||(p=[0,0,0,0]);const w=p[0]-hi,S=p[1]-hi,C=p[2]-hi,R=p[3]-hi;m.emplaceBack(s?1:0,h?1:0,g||0,y||0,w,S),m.emplaceBack(s?1:0,h?1:0,g||0,y||0,C,S),m.emplaceBack(s?1:0,h?1:0,g||0,y||0,C,R),m.emplaceBack(s?1:0,h?1:0,g||0,y||0,w,R)}const Eo=Math.pow(2,25),Yr=Math.pow(2,24),Ns=Math.pow(2,17),ca=Math.pow(2,16),rl=Math.pow(2,9),sl=Math.pow(2,8),nl=Math.pow(2,1);function ro(m){if(m.opacity===0&&!m.placed)return 0;if(m.opacity===1&&m.placed)return 4294967295;const s=m.placed?1:0,h=Math.floor(127*m.opacity);return h*Eo+s*Yr+h*Ns+s*ca+h*rl+s*sl+h*nl+s}const Nr=0;class ol{constructor(s){this._sortAcrossTiles=s.layout.get("symbol-z-order")!=="viewport-y"&&!s.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(s,h,p,g,y){const w=this._bucketParts;for(;this._currentTileIndex<s.length;)if(h.getBucketParts(w,g,s[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,y())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,w.sort((S,C)=>S.sortKey-C.sortKey));this._currentPartIndex<w.length;)if(h.placeLayerBucketPart(w[this._currentPartIndex],this._seenCrossTileIDs,p),this._currentPartIndex++,y())return!0;return!1}}class ha{constructor(s,h,p,g,y,w,S,C){this.placement=new ks(s,h,w,S,C),this._currentPlacementIndex=p.length-1,this._forceFullPlacement=g,this._showCollisionBoxes=y,this._done=!1}isDone(){return this._done}continuePlacement(s,h,p){const g=N.now(),y=()=>!this._forceFullPlacement&&N.now()-g>2;for(;this._currentPlacementIndex>=0;){const w=h[s[this._currentPlacementIndex]],S=this.placement.collisionIndex.transform.zoom;if(w.type==="symbol"&&(!w.minzoom||w.minzoom<=S)&&(!w.maxzoom||w.maxzoom>S)){if(this._inProgressLayer||(this._inProgressLayer=new ol(w)),this._inProgressLayer.continuePlacement(p[w.source],this.placement,this._showCollisionBoxes,w,y))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(s){return this.placement.commit(s),this.placement}}const un=512/a.$/2;class ua{constructor(s,h,p){this.tileID=s,this.bucketInstanceId=p,this._symbolsByKey={};const g=new Map;for(let y=0;y<h.length;y++){const w=h.get(y),S=w.key,C=g.get(S);C?C.push(w):g.set(S,[w])}for(const[y,w]of g){const S={positions:w.map(C=>({x:Math.floor(C.anchorX*un),y:Math.floor(C.anchorY*un)})),crossTileIDs:w.map(C=>C.crossTileID)};if(S.positions.length>128){const C=new a.aI(S.positions.length,16,Uint16Array);for(const{x:R,y:B}of S.positions)C.add(R,B);C.finish(),delete S.positions,S.index=C}this._symbolsByKey[y]=S}}getScaledCoordinates(s,h){const{x:p,y:g,z:y}=this.tileID.canonical,{x:w,y:S,z:C}=h.canonical,R=un/Math.pow(2,C-y),B=(S*a.$+s.anchorY)*R,k=g*a.$*un;return{x:Math.floor((w*a.$+s.anchorX)*R-p*a.$*un),y:Math.floor(B-k)}}findMatches(s,h,p){const g=this.tileID.canonical.z<h.canonical.z?1:Math.pow(2,this.tileID.canonical.z-h.canonical.z);for(let y=0;y<s.length;y++){const w=s.get(y);if(w.crossTileID)continue;const S=this._symbolsByKey[w.key];if(!S)continue;const C=this.getScaledCoordinates(w,h);if(S.index){const R=S.index.range(C.x-g,C.y-g,C.x+g,C.y+g).sort();for(const B of R){const k=S.crossTileIDs[B];if(!p[k]){p[k]=!0,w.crossTileID=k;break}}}else if(S.positions)for(let R=0;R<S.positions.length;R++){const B=S.positions[R],k=S.crossTileIDs[R];if(Math.abs(B.x-C.x)<=g&&Math.abs(B.y-C.y)<=g&&!p[k]){p[k]=!0,w.crossTileID=k;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:s})=>s)}}class al{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class vu{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(s){const h=Math.round((s-this.lng)/360);if(h!==0)for(const p in this.indexes){const g=this.indexes[p],y={};for(const w in g){const S=g[w];S.tileID=S.tileID.unwrapTo(S.tileID.wrap+h),y[S.tileID.key]=S}this.indexes[p]=y}this.lng=s}addBucket(s,h,p){if(this.indexes[s.overscaledZ]&&this.indexes[s.overscaledZ][s.key]){if(this.indexes[s.overscaledZ][s.key].bucketInstanceId===h.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(s.overscaledZ,this.indexes[s.overscaledZ][s.key])}for(let y=0;y<h.symbolInstances.length;y++)h.symbolInstances.get(y).crossTileID=0;this.usedCrossTileIDs[s.overscaledZ]||(this.usedCrossTileIDs[s.overscaledZ]={});const g=this.usedCrossTileIDs[s.overscaledZ];for(const y in this.indexes){const w=this.indexes[y];if(Number(y)>s.overscaledZ)for(const S in w){const C=w[S];C.tileID.isChildOf(s)&&C.findMatches(h.symbolInstances,s,g)}else{const S=w[s.scaledTo(Number(y)).key];S&&S.findMatches(h.symbolInstances,s,g)}}for(let y=0;y<h.symbolInstances.length;y++){const w=h.symbolInstances.get(y);w.crossTileID||(w.crossTileID=p.generate(),g[w.crossTileID]=!0)}return this.indexes[s.overscaledZ]===void 0&&(this.indexes[s.overscaledZ]={}),this.indexes[s.overscaledZ][s.key]=new ua(s,h.symbolInstances,h.bucketInstanceId),!0}removeBucketCrossTileIDs(s,h){for(const p of h.getCrossTileIDsLists())for(const g of p)delete this.usedCrossTileIDs[s][g]}removeStaleBuckets(s){let h=!1;for(const p in this.indexes){const g=this.indexes[p];for(const y in g)s[g[y].bucketInstanceId]||(this.removeBucketCrossTileIDs(p,g[y]),delete g[y],h=!0)}return h}}class q{constructor(){this.layerIndexes={},this.crossTileIDs=new al,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(s,h,p){let g=this.layerIndexes[s.id];g===void 0&&(g=this.layerIndexes[s.id]=new vu);let y=!1;const w={};g.handleWrapJump(p);for(const S of h){const C=S.getBucket(s);C&&s.id===C.layerIds[0]&&(C.bucketInstanceId||(C.bucketInstanceId=++this.maxBucketInstanceId),g.addBucket(S.tileID,C,this.crossTileIDs)&&(y=!0),w[C.bucketInstanceId]=!0)}return g.removeStaleBuckets(w)&&(y=!0),y}pruneUnusedLayers(s){const h={};s.forEach(p=>{h[p]=!0});for(const p in this.layerIndexes)h[p]||delete this.layerIndexes[p]}}var ee="void main() {fragColor=vec4(1.0);}";const de={prelude:Ee(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
out highp vec4 fragColor;`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c
);}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
#ifdef GLOBE
if ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}
#endif
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;`),projectionMercator:Ee("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:Ee("",`#define GLOBE_RADIUS 6371008.8
uniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos
);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); 
if (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len
);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}`),background:Ee(`uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:Ee(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Ee(`in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {
#ifdef GLOBE
vec3 center_vector=projectToSphere(circle_center);
#endif
float angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {
#ifdef GLOBE
vec4 projected_center=interpolateProjection(circle_center,center_vector,ele);
#else
vec4 projected_center=projectTileWithElevation(circle_center,ele);
#endif
corner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}
#ifdef GLOBE
vec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);
#else
gl_Position=projectTileWithElevation(corner_position,ele);
#endif
} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Ee(ee,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:Ee(`uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);
#ifdef GLOBE
vec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);
#else
gl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));
#endif
}`),heatmapTexture:Ee(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Ee("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Ee("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),colorRelief:Ee(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;uniform vec4 u_unpack;uniform sampler2D u_elevation_stops;uniform sampler2D u_color_stops;uniform int u_color_ramp_size;uniform float u_opacity;in vec2 v_pos;float getElevation(vec2 coord) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}float getElevationStop(int stop) {float x=(float(stop)+0.5)/float(u_color_ramp_size);vec4 data=texture(u_elevation_stops,vec2(x,0))*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {float el=getElevation(v_pos);int r=(u_color_ramp_size-1);int l=0;float el_l=getElevationStop(l);float el_r=getElevationStop(r);while(r-l > 1){int m=(r+l)/2;float el_m=getElevationStop(m);if(el < el_m){r=m;el_r=el_m;}else
{l=m;el_l=el_m;}}float x=(float(l)+(el-el_l)/(el_r-el_l)+0.5)/float(u_color_ramp_size);fragColor=u_opacity*texture(u_color_stops,vec2(x,0));
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_dimension;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_pos/8192.0)*scale+epsilon;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),debug:Ee("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:Ee(ee,`in vec2 a_pos;void main() {
#ifdef GLOBE
gl_Position=projectTileFor3D(a_pos,0.0);
#else
gl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);
#endif
}`),fill:Ee(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
fragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_fill_translate;in vec2 a_pos;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);}`),fillOutline:Ee(`in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillOutlinePattern:Ee(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillPattern:Ee(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Ee(`in vec4 v_color;void main() {fragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
out vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);
#ifdef GLOBE
mat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);
#endif
directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Ee(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
#ifdef GLOBE
out vec3 v_sphere_pos;
#endif
out vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Ee(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {vec2 epsilon=1.0/u_dimension;float tileSize=u_dimension.x-2.0;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))*tileSize/pow(2.0,exaggeration+(28.2562-u_zoom));fragColor=clamp(vec4(deriv.x/8.0+0.5,deriv.y/8.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Ee(`uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform float u_exaggeration;uniform vec4 u_accent;uniform int u_method;uniform float u_altitudes[NUM_ILLUMINATION_SOURCES];uniform float u_azimuths[NUM_ILLUMINATION_SOURCES];uniform vec4 u_shadows[NUM_ILLUMINATION_SOURCES];uniform vec4 u_highlights[NUM_ILLUMINATION_SOURCES];
#define PI 3.141592653589793
#define STANDARD 0
#define COMBINED 1
#define IGOR 2
#define MULTIDIRECTIONAL 3
#define BASIC 4
float get_aspect(vec2 deriv){return deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);}void igor_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float aspect=get_aspect(deriv);float azimuth=u_azimuths[0]+PI;float slope_stength=atan(length(deriv))*2.0/PI;float aspect_strength=1.0-abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);float shadow_strength=slope_stength*aspect_strength;float highlight_strength=slope_stength*(1.0-aspect_strength);fragColor=u_shadows[0]*shadow_strength+u_highlights[0]*highlight_strength;}void standard_hillshade(vec2 deriv){float azimuth=u_azimuths[0]+PI;float slope=atan(0.625*length(deriv));float aspect=get_aspect(deriv);float intensity=u_exaggeration;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadows[0],u_highlights[0],shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;}void basic_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor=u_highlights[0]*(2.0*shade-1.0);}else
{fragColor=u_shadows[0]*(1.0-2.0*shade);}}void multidirectional_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;fragColor=vec4(0,0,0,0);for(int i=0; i < NUM_ILLUMINATION_SOURCES; i++){float cos_alt=cos(u_altitudes[i]);float sin_alt=sin(u_altitudes[i]);float cos_az=-cos(u_azimuths[i]);float sin_az=-sin(u_azimuths[i]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor+=u_highlights[i]*(2.0*shade-1.0)/float(NUM_ILLUMINATION_SOURCES);}else
{fragColor+=u_shadows[i]*(1.0-2.0*shade)/float(NUM_ILLUMINATION_SOURCES);}}}void combined_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=acos((sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv)));cang=clamp(cang,0.0,PI/2.0);float shade=cang*atan(length(deriv))*4.0/PI/PI;float highlight=(PI/2.0-cang)*atan(length(deriv))*4.0/PI/PI;fragColor=u_shadows[0]*shade+u_highlights[0]*highlight;}void main() {vec4 pixel=texture(u_image,v_pos);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));vec2 deriv=((pixel.rg*8.0)-4.0)/scaleFactor;if (u_method==BASIC) {basic_hillshade(deriv);} else if (u_method==COMBINED) {combined_hillshade(deriv);} else if (u_method==IGOR) {igor_hillshade(deriv);} else if (u_method==MULTIDIRECTIONAL) {multidirectional_hillshade(deriv);} else if (u_method==STANDARD) {standard_hillshade(deriv);} else {standard_hillshade(deriv);}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:Ee(`uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Ee(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Ee(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Ee(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Ee(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;
#ifdef GLOBE
if (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}
#endif
v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),symbolIcon:Ee(`uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Ee(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Ee(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Ee("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:Ee("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:Ee("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:Ee("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:Ee(`in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758
);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}`,"in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:Ee("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function Ee(m,s){const h=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,p=s.match(/in ([\w]+) ([\w]+)/g),g=m.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),y=s.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),w=y?y.concat(g):g,S={};return{fragmentSource:m=m.replace(h,(C,R,B,k,F)=>(S[F]=!0,R==="define"?`
#ifndef HAS_UNIFORM_u_${F}
in ${B} ${k} ${F};
#else
uniform ${B} ${k} u_${F};
#endif
`:`
#ifdef HAS_UNIFORM_u_${F}
    ${B} ${k} ${F} = u_${F};
#endif
`)),vertexSource:s=s.replace(h,(C,R,B,k,F)=>{const V=k==="float"?"vec2":"vec4",G=F.match(/color/)?"color":V;return S[F]?R==="define"?`
#ifndef HAS_UNIFORM_u_${F}
uniform lowp float u_${F}_t;
in ${B} ${V} a_${F};
out ${B} ${k} ${F};
#else
uniform ${B} ${k} u_${F};
#endif
`:G==="vec4"?`
#ifndef HAS_UNIFORM_u_${F}
    ${F} = a_${F};
#else
    ${B} ${k} ${F} = u_${F};
#endif
`:`
#ifndef HAS_UNIFORM_u_${F}
    ${F} = unpack_mix_${G}(a_${F}, u_${F}_t);
#else
    ${B} ${k} ${F} = u_${F};
#endif
`:R==="define"?`
#ifndef HAS_UNIFORM_u_${F}
uniform lowp float u_${F}_t;
in ${B} ${V} a_${F};
#else
uniform ${B} ${k} u_${F};
#endif
`:G==="vec4"?`
#ifndef HAS_UNIFORM_u_${F}
    ${B} ${k} ${F} = a_${F};
#else
    ${B} ${k} ${F} = u_${F};
#endif
`:`
#ifndef HAS_UNIFORM_u_${F}
    ${B} ${k} ${F} = unpack_mix_${G}(a_${F}, u_${F}_t);
#else
    ${B} ${k} ${F} = u_${F};
#endif
`}),staticAttributes:p,staticUniforms:w}}class $e{constructor(s,h,p){this.vertexBuffer=s,this.indexBuffer=h,this.segments=p}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var lt=a.aJ([{name:"a_pos",type:"Int16",components:2}]);const Mt="#define PROJECTION_MERCATOR",pi="mercator";class yt{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return pi}get shaderDefine(){return Mt}get shaderPreludeCode(){return de.projectionMercator}get vertexShaderPreludeCode(){return de.projectionMercator.vertexSource}get subdivisionGranularity(){return a.aK.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(s){}getMeshFromTileID(s,h,p,g,y){if(this._cachedMesh)return this._cachedMesh;const w=new a.aL;w.emplaceBack(0,0),w.emplaceBack(a.$,0),w.emplaceBack(0,a.$),w.emplaceBack(a.$,a.$);const S=s.createVertexBuffer(w,lt.members),C=a.aM.simpleSegment(0,0,4,2),R=new a.aN;R.emplaceBack(1,0,2),R.emplaceBack(1,2,3);const B=s.createIndexBuffer(R);return this._cachedMesh=new $e(S,B,C),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(s){}}class Si{constructor(s=0,h=0,p=0,g=0){if(isNaN(s)||s<0||isNaN(h)||h<0||isNaN(p)||p<0||isNaN(g)||g<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=s,this.bottom=h,this.left=p,this.right=g}interpolate(s,h,p){return h.top!=null&&s.top!=null&&(this.top=a.C.number(s.top,h.top,p)),h.bottom!=null&&s.bottom!=null&&(this.bottom=a.C.number(s.bottom,h.bottom,p)),h.left!=null&&s.left!=null&&(this.left=a.C.number(s.left,h.left,p)),h.right!=null&&s.right!=null&&(this.right=a.C.number(s.right,h.right,p)),this}getCenter(s,h){const p=a.ah((this.left+s-this.right)/2,0,s),g=a.ah((this.top+h-this.bottom)/2,0,h);return new a.P(p,g)}equals(s){return this.top===s.top&&this.bottom===s.bottom&&this.left===s.left&&this.right===s.right}clone(){return new Si(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Lr(m,s){if(!m.renderWorldCopies||m.lngRange)return;const h=s.lng-m.center.lng;s.lng+=h>180?-360:h<-180?360:0}function Mc(m){return Math.max(0,Math.floor(m))}class Ur{constructor(s,h,p,g,y,w){this._callbacks=s,this._tileSize=512,this._renderWorldCopies=w===void 0||!!w,this._minZoom=h||0,this._maxZoom=p||22,this._minPitch=g??0,this._maxPitch=y??60,this.setMaxBounds(),this._width=0,this._height=0,this._center=new a.S(0,0),this._elevation=0,this._zoom=0,this._tileZoom=Mc(this._zoom),this._scale=a.af(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new Si,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(s,h,p){this._latRange=s.latRange,this._lngRange=s.lngRange,this._width=s.width,this._height=s.height,this._center=s.center,this._elevation=s.elevation,this._minElevationForCurrentTile=s.minElevationForCurrentTile,this._zoom=s.zoom,this._tileZoom=Mc(this._zoom),this._scale=a.af(this._zoom),this._bearingInRadians=s.bearingInRadians,this._fovInRadians=s.fovInRadians,this._pitchInRadians=s.pitchInRadians,this._rollInRadians=s.rollInRadians,this._unmodified=s.unmodified,this._edgeInsets=new Si(s.padding.top,s.padding.bottom,s.padding.left,s.padding.right),this._minZoom=s.minZoom,this._maxZoom=s.maxZoom,this._minPitch=s.minPitch,this._maxPitch=s.maxPitch,this._renderWorldCopies=s.renderWorldCopies,this._cameraToCenterDistance=s.cameraToCenterDistance,this._nearZ=s.nearZ,this._farZ=s.farZ,this._autoCalculateNearFarZ=!p&&s.autoCalculateNearFarZ,h&&this._constrain(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(s){this._minElevationForCurrentTile=s}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(s){this._minZoom!==s&&(this._minZoom=s,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(s){this._maxZoom!==s&&(this._maxZoom=s,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(s){this._minPitch!==s&&(this._minPitch=s,this.setPitch(Math.max(this.pitch,s)))}get maxPitch(){return this._maxPitch}setMaxPitch(s){this._maxPitch!==s&&(this._maxPitch=s,this.setPitch(Math.min(this.pitch,s)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(s){s===void 0?s=!0:s===null&&(s=!1),this._renderWorldCopies=s}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new a.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(s){const h=a.aO(s,-180,180)*Math.PI/180;var p,g,y,w,S,C,R,B,k;this._bearingInRadians!==h&&(this._unmodified=!1,this._bearingInRadians=h,this._calcMatrices(),this._rotationMatrix=A(),p=this._rotationMatrix,y=-this._bearingInRadians,w=(g=this._rotationMatrix)[0],S=g[1],C=g[2],R=g[3],B=Math.sin(y),k=Math.cos(y),p[0]=w*k+C*B,p[1]=S*k+R*B,p[2]=w*-B+C*k,p[3]=S*-B+R*k)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(s){const h=a.ah(s,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==h&&(this._unmodified=!1,this._pitchInRadians=h,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(s){const h=s/180*Math.PI;this._rollInRadians!==h&&(this._unmodified=!1,this._rollInRadians=h,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return a.aP(this._fovInRadians)}setFov(s){s=a.ah(s,.1,150),this.fov!==s&&(this._unmodified=!1,this._fovInRadians=a.ae(s),this._calcMatrices())}get zoom(){return this._zoom}setZoom(s){const h=this.getConstrained(this._center,s).zoom;this._zoom!==h&&(this._unmodified=!1,this._zoom=h,this._tileZoom=Math.max(0,Math.floor(h)),this._scale=a.af(h),this._constrain(),this._calcMatrices())}get center(){return this._center}setCenter(s){s.lat===this._center.lat&&s.lng===this._center.lng||(this._unmodified=!1,this._center=s,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(s){s!==this._elevation&&(this._elevation=s,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(s){this._edgeInsets.equals(s)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,s,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(s,h){this._autoCalculateNearFarZ=!1,this._nearZ=s,this._farZ=h,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(s){return this._edgeInsets.equals(s)}interpolatePadding(s,h,p){this._unmodified=!1,this._edgeInsets.interpolate(s,h,p),this._constrain(),this._calcMatrices()}resize(s,h,p=!0){this._width=s,this._height=h,p&&this._constrain(),this._calcMatrices()}getMaxBounds(){return this._latRange&&this._latRange.length===2&&this._lngRange&&this._lngRange.length===2?new oi([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(s){s?(this._lngRange=[s.getWest(),s.getEast()],this._latRange=[s.getSouth(),s.getNorth()],this._constrain()):(this._lngRange=null,this._latRange=[-a.ai,a.ai])}getConstrained(s,h){return this._callbacks.getConstrained(s,h)}getCameraQueryGeometry(s,h){if(h.length===1)return[h[0],s];{const{minX:p,minY:g,maxX:y,maxY:w}=a.a2.fromPoints(h).extend(s);return[new a.P(p,g),new a.P(y,g),new a.P(y,w),new a.P(p,w),new a.P(p,g)]}}_constrain(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;const s=this._unmodified,{center:h,zoom:p}=this.getConstrained(this.center,this.zoom);this.setCenter(h),this.setZoom(p),this._unmodified=s,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let s=a.ag(new Float64Array(16));a.N(s,s,[this._width/2,-this._height/2,1]),a.M(s,s,[1,-1,0]),this._clipSpaceToPixelsMatrix=s,s=a.ag(new Float64Array(16)),a.N(s,s,[1,-1,1]),a.M(s,s,[-1,-1,0]),a.N(s,s,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=s,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(s,h,p,g){const y=p!==void 0?p:this.bearing,w=g=g!==void 0?g:this.pitch,S=a.a1.fromLngLat(s,h),C=-Math.cos(a.ae(w)),R=Math.sin(a.ae(w)),B=R*Math.sin(a.ae(y)),k=-R*Math.cos(a.ae(y));let F=this.elevation;const V=h-F;let G;C*V>=0||Math.abs(C)<.1?(G=1e4,F=h+G*C):G=-V/C;let J,Y,Q=a.aQ(1,S.y),se=0;do{if(se+=1,se>10)break;Y=G/Q,J=new a.a1(S.x+B*Y,S.y+k*Y),Q=1/J.meterInMercatorCoordinateUnits()}while(Math.abs(G-Y*Q)>1e-12);return{center:J.toLngLat(),elevation:F,zoom:a.ak(this.height/2/Math.tan(this.fovInRadians/2)/Y/this.tileSize)}}recalculateZoomAndCenter(s){if(this.elevation-s==0)return;const h=a.aj(1,this.center.lat)*this.worldSize,p=this.cameraToCenterDistance/h,g=a.a1.fromLngLat(this.center,this.elevation),y=Re(this.center,this.elevation,this.pitch,this.bearing,p);this._elevation=s;const w=this.calculateCenterFromCameraLngLatAlt(y.toLngLat(),a.aQ(y.z,g.y),this.bearing,this.pitch);this._elevation=w.elevation,this._center=w.center,this.setZoom(w.zoom)}getCameraPoint(){const s=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new a.P(s*Math.sin(this.rollInRadians),s*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){const s=a.aj(1,this.center.lat)*this.worldSize;return Re(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/s).toLngLat()}getMercatorTileCoordinates(s){if(!s)return[0,0,1,1];const h=s.canonical.z>=0?1<<s.canonical.z:Math.pow(2,s.canonical.z);return[s.canonical.x/h,s.canonical.y/h,1/h/a.$,1/h/a.$]}}class cr{constructor(s,h){this.min=s,this.max=h,this.center=a.aR([],a.aS([],this.min,this.max),.5)}quadrant(s){const h=[s%2==0,s<2],p=a.aT(this.min),g=a.aT(this.max);for(let y=0;y<h.length;y++)p[y]=h[y]?this.min[y]:this.center[y],g[y]=h[y]?this.center[y]:this.max[y];return g[2]=this.max[2],new cr(p,g)}distanceX(s){return Math.max(Math.min(this.max[0],s[0]),this.min[0])-s[0]}distanceY(s){return Math.max(Math.min(this.max[1],s[1]),this.min[1])-s[1]}intersectsFrustum(s){let h=!0;for(let p=0;p<s.planes.length;p++){const g=this.intersectsPlane(s.planes[p]);if(g===0)return 0;g===1&&(h=!1)}return h?2:s.aabb.min[0]>this.max[0]||s.aabb.min[1]>this.max[1]||s.aabb.min[2]>this.max[2]||s.aabb.max[0]<this.min[0]||s.aabb.max[1]<this.min[1]||s.aabb.max[2]<this.min[2]?0:1}intersectsPlane(s){let h=s[3],p=s[3];for(let g=0;g<3;g++)s[g]>0?(h+=s[g]*this.min[g],p+=s[g]*this.max[g]):(p+=s[g]*this.min[g],h+=s[g]*this.max[g]);return h>=0?2:p<0?0:1}}class zr{distanceToTile2d(s,h,p,g){const y=g.distanceX([s,h]),w=g.distanceY([s,h]);return Math.hypot(y,w)}getWrap(s,h,p){return p}getTileBoundingVolume(s,h,p,g){var y,w;let S=0,C=0;if(g!=null&&g.terrain){const B=new a.Z(s.z,h,s.z,s.x,s.y),k=g.terrain.getMinMaxElevation(B);S=(y=k.minElevation)!==null&&y!==void 0?y:Math.min(0,p),C=(w=k.maxElevation)!==null&&w!==void 0?w:Math.max(0,p)}const R=1<<s.z;return new cr([h+s.x/R,s.y/R,S],[h+(s.x+1)/R,(s.y+1)/R,C])}allowVariableZoom(s,h){const p=s.fov*(Math.abs(Math.cos(s.rollInRadians))*s.height+Math.abs(Math.sin(s.rollInRadians))*s.width)/s.height,g=a.ah(78.5-p/2,0,60);return!!h.terrain||s.pitch>g}allowWorldCopies(){return!0}prepareNextFrame(){}}class qi{constructor(s,h,p){this.points=s,this.planes=h,this.aabb=p}static fromInvProjectionMatrix(s,h=1,p=0,g,y){const w=y?[[6,5,4],[0,1,2],[0,3,7],[2,1,5],[3,2,6],[0,4,5]]:[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]],S=Math.pow(2,p),C=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(F=>function(V,G,J,Y){const Q=a.aw([],V,G),se=1/Q[3]/J*Y;return a.aY(Q,Q,[se,se,1/Q[3],se])}(F,s,h,S));g&&function(F,V,G,J){const Y=J?4:0,Q=J?0:4;let se=0;const ce=[],ae=[];for(let le=0;le<4;le++){const ve=a.aU([],F[le+Q],F[le+Y]),ke=a.aZ(ve);a.aR(ve,ve,1/ke),ce.push(ke),ae.push(ve)}for(let le=0;le<4;le++){const ve=a.a_(F[le+Y],ae[le],G);se=ve!==null&&ve>=0?Math.max(se,ve):Math.max(se,ce[le])}const ue=function(le,ve){const ke=a.aU([],le[ve[0]],le[ve[1]]),Me=a.aU([],le[ve[2]],le[ve[1]]),Pe=[0,0,0,0];return a.aV(Pe,a.aW([],ke,Me)),Pe[3]=-a.aX(Pe,le[ve[0]]),Pe}(F,V),_e=function(le,ve){const ke=a.a$(le),Me=a.b0([],le,1/ke),Pe=a.aU([],ve,a.aR([],Me,a.aX(ve,Me))),Fe=a.a$(Pe);if(Fe>0){const Ze=Math.sqrt(1-Me[3]*Me[3]),Ye=a.aR([],Me,-Me[3]),je=a.aS([],Ye,a.aR([],Pe,Ze/Fe));return a.b1(ve,je)}return null}(G,ue);if(_e!==null){const le=_e/a.aX(ae[0],ue);se=Math.min(se,le)}for(let le=0;le<4;le++){const ve=Math.min(se,ce[le]);F[le+Q]=[F[le+Y][0]+ae[le][0]*ve,F[le+Y][1]+ae[le][1]*ve,F[le+Y][2]+ae[le][2]*ve,1]}}(C,w[0],g,y);const R=w.map(F=>{const V=a.aU([],C[F[0]],C[F[1]]),G=a.aU([],C[F[2]],C[F[1]]),J=a.aV([],a.aW([],V,G)),Y=-a.aX(J,C[F[1]]);return J.concat(Y)}),B=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],k=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(const F of C)for(let V=0;V<3;V++)B[V]=Math.min(B[V],F[V]),k[V]=Math.max(k[V],F[V]);return new qi(C,R,new cr(B,k))}}class ai{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(s){this._helper.setMinZoom(s)}setMaxZoom(s){this._helper.setMaxZoom(s)}setMinPitch(s){this._helper.setMinPitch(s)}setMaxPitch(s){this._helper.setMaxPitch(s)}setRenderWorldCopies(s){this._helper.setRenderWorldCopies(s)}setBearing(s){this._helper.setBearing(s)}setPitch(s){this._helper.setPitch(s)}setRoll(s){this._helper.setRoll(s)}setFov(s){this._helper.setFov(s)}setZoom(s){this._helper.setZoom(s)}setCenter(s){this._helper.setCenter(s)}setElevation(s){this._helper.setElevation(s)}setMinElevationForCurrentTile(s){this._helper.setMinElevationForCurrentTile(s)}setPadding(s){this._helper.setPadding(s)}interpolatePadding(s,h,p){return this._helper.interpolatePadding(s,h,p)}isPaddingEqual(s){return this._helper.isPaddingEqual(s)}resize(s,h,p=!0){this._helper.resize(s,h,p)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(s){this._helper.setMaxBounds(s)}overrideNearFarZ(s,h){this._helper.overrideNearFarZ(s,h)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(s){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),s)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(s,h){}constructor(s,h,p,g,y){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this._helper=new Ur({calcMatrices:()=>{this._calcMatrices()},getConstrained:(w,S)=>this.getConstrained(w,S)},s,h,p,g,y),this._coveringTilesDetailsProvider=new zr}clone(){const s=new ai;return s.apply(this),s}apply(s,h,p){this._helper.apply(s,h,p)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(s){const h=[new a.b2(0,s)];if(this._helper._renderWorldCopies){const p=this.screenPointToMercatorCoordinate(new a.P(0,0)),g=this.screenPointToMercatorCoordinate(new a.P(this._helper._width,0)),y=this.screenPointToMercatorCoordinate(new a.P(this._helper._width,this._helper._height)),w=this.screenPointToMercatorCoordinate(new a.P(0,this._helper._height)),S=Math.floor(Math.min(p.x,g.x,y.x,w.x)),C=Math.floor(Math.max(p.x,g.x,y.x,w.x)),R=1;for(let B=S-R;B<=C+R;B++)B!==0&&h.push(new a.b2(B,s))}return h}getCameraFrustum(){return qi.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(s){const h=this.screenPointToLocation(this.centerPoint,s),p=s?s.getElevationForLngLatZoom(h,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(p)}setLocationAtPoint(s,h){const p=a.aj(this.elevation,this.center.lat),g=this.screenPointToMercatorCoordinateAtZ(h,p),y=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,p),w=a.a1.fromLngLat(s),S=new a.a1(w.x-(g.x-y.x),w.y-(g.y-y.y));this.setCenter(S==null?void 0:S.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(s,h){return h?this.coordinatePoint(a.a1.fromLngLat(s),h.getElevationForLngLatZoom(s,this._helper._tileZoom),this._pixelMatrix3D):this.coordinatePoint(a.a1.fromLngLat(s))}screenPointToLocation(s,h){var p;return(p=this.screenPointToMercatorCoordinate(s,h))===null||p===void 0?void 0:p.toLngLat()}screenPointToMercatorCoordinate(s,h){if(h){const p=h.pointCoordinate(s);if(p!=null)return p}return this.screenPointToMercatorCoordinateAtZ(s)}screenPointToMercatorCoordinateAtZ(s,h){const p=h||0,g=[s.x,s.y,0,1],y=[s.x,s.y,1,1];a.aw(g,g,this._pixelMatrixInverse),a.aw(y,y,this._pixelMatrixInverse);const w=g[3],S=y[3],C=g[1]/w,R=y[1]/S,B=g[2]/w,k=y[2]/S,F=B===k?0:(p-B)/(k-B);return new a.a1(a.C.number(g[0]/w,y[0]/S,F)/this.worldSize,a.C.number(C,R,F)/this.worldSize,p)}coordinatePoint(s,h=0,p=this._pixelMatrix){const g=[s.x*this.worldSize,s.y*this.worldSize,h,1];return a.aw(g,g,p),new a.P(g[0]/g[3],g[1]/g[3])}getBounds(){const s=Math.max(0,this._helper._height/2-pe(this));return new oi().extend(this.screenPointToLocation(new a.P(0,s))).extend(this.screenPointToLocation(new a.P(this._helper._width,s))).extend(this.screenPointToLocation(new a.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new a.P(0,this._helper._height)))}isPointOnMapSurface(s,h){return h?h.pointCoordinate(s)!=null:s.y>this.height/2-pe(this)}calculatePosMatrix(s,h=!1,p){var g;const y=(g=s.key)!==null&&g!==void 0?g:a.b3(s.wrap,s.canonical.z,s.canonical.z,s.canonical.x,s.canonical.y),w=h?this._alignedPosMatrixCache:this._posMatrixCache;if(w.has(y)){const R=w.get(y);return p?R.f32:R.f64}const S=ye(s,this.worldSize);a.O(S,h?this._alignedProjMatrix:this._viewProjMatrix,S);const C={f64:S,f32:new Float32Array(S)};return w.set(y,C),p?C.f32:C.f64}calculateFogMatrix(s){const h=s.key,p=this._fogMatrixCacheF32;if(p.has(h))return p.get(h);const g=ye(s,this.worldSize);return a.O(g,this._fogMatrix,g),p.set(h,new Float32Array(g)),p.get(h)}getConstrained(s,h){h=a.ah(+h,this.minZoom,this.maxZoom);const p={center:new a.S(s.lng,s.lat),zoom:h};let g=this._helper._lngRange;if(!this._helper._renderWorldCopies&&g===null){const ce=179.9999999999;g=[-ce,ce]}const y=this.tileSize*a.af(p.zoom);let w=0,S=y,C=0,R=y,B=0,k=0;const{x:F,y:V}=this.size;if(this._helper._latRange){const ce=this._helper._latRange;w=a.U(ce[1])*y,S=a.U(ce[0])*y,S-w<V&&(B=V/(S-w))}g&&(C=a.aO(a.V(g[0])*y,0,y),R=a.aO(a.V(g[1])*y,0,y),R<C&&(R+=y),R-C<F&&(k=F/(R-C)));const{x:G,y:J}=Z(y,s);let Y,Q;const se=Math.max(k||0,B||0);if(se){const ce=new a.P(k?(R+C)/2:G,B?(S+w)/2:J);return p.center=oe(y,ce).wrap(),p.zoom+=a.ak(se),p}if(this._helper._latRange){const ce=V/2;J-ce<w&&(Q=w+ce),J+ce>S&&(Q=S-ce)}if(g){const ce=(C+R)/2;let ae=G;this._helper._renderWorldCopies&&(ae=a.aO(G,ce-y/2,ce+y/2));const ue=F/2;ae-ue<C&&(Y=C+ue),ae+ue>R&&(Y=R-ue)}if(Y!==void 0||Q!==void 0){const ce=new a.P(Y??G,Q??J);p.center=oe(y,ce).wrap()}return p}calculateCenterFromCameraLngLatAlt(s,h,p,g){return this._helper.calculateCenterFromCameraLngLatAlt(s,h,p,g)}_calculateNearFarZIfNeeded(s,h,p){if(!this._helper.autoCalculateNearFarZ)return;const g=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),y=s-g*this._helper._pixelPerMeter/Math.cos(h),w=g<0?y:s,S=Math.PI/2+this.pitchInRadians,C=a.ae(this.fov)*(Math.abs(Math.cos(a.ae(this.roll)))*this.height+Math.abs(Math.sin(a.ae(this.roll)))*this.width)/this.height*(.5+p.y/this.height),R=Math.sin(C)*w/Math.sin(a.ah(Math.PI-S-C,.01,Math.PI-.01)),B=pe(this),k=Math.atan(B/this._helper.cameraToCenterDistance),F=a.ae(.75),V=k>F?2*k*(.5+p.y/(2*B)):F,G=Math.sin(V)*w/Math.sin(a.ah(Math.PI-S-V,.01,Math.PI-.01)),J=Math.min(R,G);this._helper._farZ=1.01*(Math.cos(Math.PI/2-h)*J+w),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;const s=this.centerOffset,h=Z(this.worldSize,this.center),p=h.x,g=h.y;this._helper._pixelPerMeter=a.aj(1,this.center.lat)*this.worldSize;const y=a.ae(Math.min(this.pitch,X)),w=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(y));let S;this._calculateNearFarZIfNeeded(w,y,s),S=new Float64Array(16),a.b4(S,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),a.aq(this._invProjMatrix,S),S[8]=2*-s.x/this._helper._width,S[9]=2*s.y/this._helper._height,this._projectionMatrix=a.b5(S),a.N(S,S,[1,-1,1]),a.M(S,S,[0,0,-this._helper.cameraToCenterDistance]),a.b6(S,S,-this.rollInRadians),a.b7(S,S,this.pitchInRadians),a.b6(S,S,-this.bearingInRadians),a.M(S,S,[-p,-g,0]),this._mercatorMatrix=a.N([],S,[this.worldSize,this.worldSize,this.worldSize]),a.N(S,S,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=a.O(new Float64Array(16),this.clipSpaceToPixelsMatrix,S),a.M(S,S,[0,0,-this.elevation]),this._viewProjMatrix=S,this._invViewProjMatrix=a.aq([],S);const C=[0,0,-1,1];a.aw(C,C,this._invViewProjMatrix),this._cameraPosition=[C[0]/C[3],C[1]/C[3],C[2]/C[3]],this._fogMatrix=new Float64Array(16),a.b4(this._fogMatrix,this.fovInRadians,this.width/this.height,w,this._helper._farZ),this._fogMatrix[8]=2*-s.x/this.width,this._fogMatrix[9]=2*s.y/this.height,a.N(this._fogMatrix,this._fogMatrix,[1,-1,1]),a.M(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),a.b6(this._fogMatrix,this._fogMatrix,-this.rollInRadians),a.b7(this._fogMatrix,this._fogMatrix,this.pitchInRadians),a.b6(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),a.M(this._fogMatrix,this._fogMatrix,[-p,-g,0]),a.N(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),a.M(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=a.O(new Float64Array(16),this.clipSpaceToPixelsMatrix,S);const R=this._helper._width%2/2,B=this._helper._height%2/2,k=Math.cos(this.bearingInRadians),F=Math.sin(-this.bearingInRadians),V=p-Math.round(p)+k*R+F*B,G=g-Math.round(g)+k*B+F*R,J=new Float64Array(S);if(a.M(J,J,[V>.5?V-1:V,G>.5?G-1:G,0]),this._alignedProjMatrix=J,S=a.aq(new Float64Array(16),this._pixelMatrix),!S)throw new Error("failed to invert matrix");this._pixelMatrixInverse=S,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;const s=this.screenPointToMercatorCoordinate(new a.P(0,0)),h=[s.x*this.worldSize,s.y*this.worldSize,0,1];return a.aw(h,h,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){const s=a.aj(1,this.center.lat)*this.worldSize;return Re(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/s).toLngLat()}lngLatToCameraDepth(s,h){const p=a.a1.fromLngLat(s),g=[p.x*this.worldSize,p.y*this.worldSize,h,1];return a.aw(g,g,this._viewProjMatrix),g[2]/g[3]}getProjectionData(s){const{overscaledTileID:h,aligned:p,applyTerrainMatrix:g}=s,y=this._helper.getMercatorTileCoordinates(h),w=h?this.calculatePosMatrix(h,p,!0):null;let S;return S=h&&h.terrainRttPosMatrix32f&&g?h.terrainRttPosMatrix32f:w||a.b8(),{mainMatrix:S,tileMercatorCoords:y,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:S}}isLocationOccluded(s){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(s,h,p){return 1}transformLightDirection(s){return a.aT(s)}getRayDirectionFromPixel(s){throw new Error("Not implemented.")}projectTileCoordinates(s,h,p,g){const y=this.calculatePosMatrix(p);let w;g?(w=[s,h,g(s,h),1],a.aw(w,w,y)):(w=[s,h,0,1],io(w,w,y));const S=w[3];return{point:new a.P(w[0]/S,w[1]/S),signedDistanceFromCamera:S,isOccluded:!1}}populateCache(s){for(const h of s)this.calculatePosMatrix(h)}getMatrixForModel(s,h){const p=a.a1.fromLngLat(s,h),g=p.meterInMercatorCoordinateUnits(),y=a.b9();return a.M(y,y,[p.x,p.y,p.z]),a.b6(y,y,Math.PI),a.b7(y,y,Math.PI/2),a.N(y,y,[-g,g,g]),y}getProjectionDataForCustomLayer(s=!0){const h=new a.Z(0,0,0,0,0),p=this.getProjectionData({overscaledTileID:h,applyGlobeMatrix:s}),g=ye(h,this.worldSize);a.O(g,this._viewProjMatrix,g),p.tileMercatorCoords=[0,0,1,1];const y=[a.$,a.$,this.worldSize/this._helper.pixelsPerMeter],w=a.ba();return a.N(w,g,y),p.fallbackMatrix=w,p.mainMatrix=w,p}getFastPathSimpleProjectionMatrix(s){return this.calculatePosMatrix(s)}}function dp(){a.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function Vr(m){if(m.useSlerp)if(m.k<1){const s=a.bb(m.startEulerAngles.roll,m.startEulerAngles.pitch,m.startEulerAngles.bearing),h=a.bb(m.endEulerAngles.roll,m.endEulerAngles.pitch,m.endEulerAngles.bearing),p=new Float64Array(4);a.bc(p,s,h,m.k);const g=a.bd(p);m.tr.setRoll(g.roll),m.tr.setPitch(g.pitch),m.tr.setBearing(g.bearing)}else m.tr.setRoll(m.endEulerAngles.roll),m.tr.setPitch(m.endEulerAngles.pitch),m.tr.setBearing(m.endEulerAngles.bearing);else m.tr.setRoll(a.C.number(m.startEulerAngles.roll,m.endEulerAngles.roll,m.k)),m.tr.setPitch(a.C.number(m.startEulerAngles.pitch,m.endEulerAngles.pitch,m.k)),m.tr.setBearing(a.C.number(m.startEulerAngles.bearing,m.endEulerAngles.bearing,m.k))}function ns(m,s,h,p,g){const y=g.padding,w=Z(g.worldSize,h.getNorthWest()),S=Z(g.worldSize,h.getNorthEast()),C=Z(g.worldSize,h.getSouthEast()),R=Z(g.worldSize,h.getSouthWest()),B=a.ae(-p),k=w.rotate(B),F=S.rotate(B),V=C.rotate(B),G=R.rotate(B),J=new a.P(Math.max(k.x,F.x,G.x,V.x),Math.max(k.y,F.y,G.y,V.y)),Y=new a.P(Math.min(k.x,F.x,G.x,V.x),Math.min(k.y,F.y,G.y,V.y)),Q=J.sub(Y),se=(g.width-(y.left+y.right+s.left+s.right))/Q.x,ce=(g.height-(y.top+y.bottom+s.top+s.bottom))/Q.y;if(ce<0||se<0)return void dp();const ae=Math.min(a.ak(g.scale*Math.min(se,ce)),m.maxZoom),ue=a.P.convert(m.offset),_e=new a.P((s.left-s.right)/2,(s.top-s.bottom)/2).rotate(a.ae(p)),le=ue.add(_e).mult(g.scale/a.af(ae));return{center:oe(g.worldSize,w.add(C).div(2).sub(le)),zoom:ae,bearing:p}}class Rr{get useGlobeControls(){return!1}handlePanInertia(s,h){return{easingOffset:s,easingCenter:h.center}}handleMapControlsRollPitchBearingZoom(s,h){s.bearingDelta&&h.setBearing(h.bearing+s.bearingDelta),s.pitchDelta&&h.setPitch(h.pitch+s.pitchDelta),s.rollDelta&&h.setRoll(h.roll+s.rollDelta),s.zoomDelta&&h.setZoom(h.zoom+s.zoomDelta)}handleMapControlsPan(s,h,p){s.around.distSqr(h.centerPoint)<.01||h.setLocationAtPoint(p,s.around)}cameraForBoxAndBearing(s,h,p,g,y){return ns(s,h,p,g,y)}handleJumpToCenterZoom(s,h){s.zoom!==(h.zoom!==void 0?+h.zoom:s.zoom)&&s.setZoom(+h.zoom),h.center!==void 0&&s.setCenter(a.S.convert(h.center))}handleEaseTo(s,h){const p=s.zoom,g=s.padding,y={roll:s.roll,pitch:s.pitch,bearing:s.bearing},w={roll:h.roll===void 0?s.roll:h.roll,pitch:h.pitch===void 0?s.pitch:h.pitch,bearing:h.bearing===void 0?s.bearing:h.bearing},S=h.zoom!==void 0,C=!s.isPaddingEqual(h.padding);let R=!1;const B=S?+h.zoom:s.zoom;let k=s.centerPoint.add(h.offsetAsPoint);const F=s.screenPointToLocation(k),{center:V,zoom:G}=s.getConstrained(a.S.convert(h.center||F),B??p);Lr(s,V);const J=Z(s.worldSize,F),Y=Z(s.worldSize,V).sub(J),Q=a.af(G-p);return R=G!==p,{easeFunc:se=>{if(R&&s.setZoom(a.C.number(p,G,se)),a.be(y,w)||Vr({startEulerAngles:y,endEulerAngles:w,tr:s,k:se,useSlerp:y.roll!=w.roll}),C&&(s.interpolatePadding(g,h.padding,se),k=s.centerPoint.add(h.offsetAsPoint)),h.around)s.setLocationAtPoint(h.around,h.aroundPoint);else{const ce=a.af(s.zoom-p),ae=G>p?Math.min(2,Q):Math.max(.5,Q),ue=Math.pow(ae,1-se),_e=oe(s.worldSize,J.add(Y.mult(se*ue)).mult(ce));s.setLocationAtPoint(s.renderWorldCopies?_e.wrap():_e,k)}},isZooming:R,elevationCenter:V}}handleFlyTo(s,h){const p=h.zoom!==void 0,g=s.zoom,y=s.getConstrained(a.S.convert(h.center||h.locationAtOffset),p?+h.zoom:g),w=y.center,S=y.zoom;Lr(s,w);const C=Z(s.worldSize,h.locationAtOffset),R=Z(s.worldSize,w).sub(C),B=R.mag(),k=a.af(S-g);let F;if(h.minZoom!==void 0){const V=Math.min(+h.minZoom,g,S),G=s.getConstrained(w,V).zoom;F=a.af(G-g)}return{easeFunc:(V,G,J,Y)=>{s.setZoom(V===1?S:g+a.ak(G));const Q=V===1?w:oe(s.worldSize,C.add(R.mult(J)).mult(G));s.setLocationAtPoint(s.renderWorldCopies?Q.wrap():Q,Y)},scaleOfZoom:k,targetCenter:w,scaleOfMinZoom:F,pixelPathLength:B}}}class _i{constructor(s,h,p){this.blendFunction=s,this.blendColor=h,this.mask=p}}_i.Replace=[1,0],_i.disabled=new _i(_i.Replace,a.bf.transparent,[!1,!1,!1,!1]),_i.unblended=new _i(_i.Replace,a.bf.transparent,[!0,!0,!0,!0]),_i.alphaBlended=new _i([1,771],a.bf.transparent,[!0,!0,!0,!0]);const So=2305;class xt{constructor(s,h,p){this.enable=s,this.mode=h,this.frontFace=p}}xt.disabled=new xt(!1,1029,So),xt.backCCW=new xt(!0,1029,So),xt.frontCCW=new xt(!0,1028,So);class Rt{constructor(s,h,p){this.func=s,this.mask=h,this.range=p}}Rt.ReadOnly=!1,Rt.ReadWrite=!0,Rt.disabled=new Rt(519,Rt.ReadOnly,[0,1]);const Pn=7680;class jt{constructor(s,h,p,g,y,w){this.test=s,this.ref=h,this.mask=p,this.fail=g,this.depthFail=y,this.pass=w}}jt.disabled=new jt({func:519,mask:0},0,0,Pn,Pn,Pn);const os=new WeakMap;function dn(m){var s;if(os.has(m))return os.get(m);{const h=(s=m.getParameter(m.VERSION))===null||s===void 0?void 0:s.startsWith("WebGL 2.0");return os.set(m,h),h}}class fn{get awaitingQuery(){return!!this._readbackQueue}constructor(s){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=s;const h=s.context,p=h.gl;this._texFormat=p.RGBA,this._texType=p.UNSIGNED_BYTE;const g=new a.aL;g.emplaceBack(-1,-1),g.emplaceBack(2,-1),g.emplaceBack(-1,2);const y=new a.aN;y.emplaceBack(0,1,2),this._fullscreenTriangle=new $e(h.createVertexBuffer(g,lt.members),h.createIndexBuffer(y),a.aM.simpleSegment(0,0,g.length,y.length)),this._resultBuffer=new Uint8Array(4),h.activeTexture.set(p.TEXTURE1);const w=p.createTexture();p.bindTexture(p.TEXTURE_2D,w),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,p.CLAMP_TO_EDGE),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,p.CLAMP_TO_EDGE),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,p.NEAREST),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,p.NEAREST),p.texImage2D(p.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=h.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(w),dn(p)&&(this._pbo=p.createBuffer(),p.bindBuffer(p.PIXEL_PACK_BUFFER,this._pbo),p.bufferData(p.PIXEL_PACK_BUFFER,4,p.STREAM_READ),p.bindBuffer(p.PIXEL_PACK_BUFFER,null))}destroy(){const s=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),s.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(s,h){const p=this._updateCount;return this._readbackQueue?p>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():p>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(s,h),this._updateCount++,this._measuredError}_bindFramebuffer(){const s=this._cachedRenderContext.context,h=s.gl;s.activeTexture.set(h.TEXTURE1),h.bindTexture(h.TEXTURE_2D,this._fbo.colorAttachment.get()),s.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(s,h){const p=this._cachedRenderContext.context,g=p.gl;if(this._bindFramebuffer(),p.viewport.set([0,0,this._texWidth,this._texHeight]),p.clear({color:a.bf.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(p,g.TRIANGLES,Rt.disabled,jt.disabled,_i.unblended,xt.disabled,((y,w)=>({u_input:y,u_output_expected:w}))(s,h),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&dn(g)){g.bindBuffer(g.PIXEL_PACK_BUFFER,this._pbo),g.readBuffer(g.COLOR_ATTACHMENT0),g.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),g.bindBuffer(g.PIXEL_PACK_BUFFER,null);const y=g.fenceSync(g.SYNC_GPU_COMMANDS_COMPLETE,0);g.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:y}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){const s=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&dn(s)){const h=s.clientWaitSync(this._readbackQueue.sync,0,0);if(h===s.WAIT_FAILED)return a.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(h===s.TIMEOUT_EXPIRED)return;s.bindBuffer(s.PIXEL_PACK_BUFFER,this._pbo),s.getBufferSubData(s.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),s.bindBuffer(s.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),s.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=fn._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(s){let h=0;return h+=s[0]/256,h+=s[1]/65536,h+=s[2]/16777216,s[3]<127&&(h=-h),h/128}}const Rc=a.$/128;function xu(m,s){const h=m.granularity!==void 0?Math.max(m.granularity,1):1,p=h+(m.generateBorders?2:0),g=h+(m.extendToNorthPole||m.generateBorders?1:0)+(m.extendToSouthPole||m.generateBorders?1:0),y=p+1,w=g+1,S=m.generateBorders?-1:0,C=m.generateBorders||m.extendToNorthPole?-1:0,R=h+(m.generateBorders?1:0),B=h+(m.generateBorders||m.extendToSouthPole?1:0),k=y*w,F=p*g*6,V=y*w>65536;if(V&&s==="16bit")throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");const G=V||s==="32bit",J=new Int16Array(2*k);let Y=0;for(let ce=C;ce<=B;ce++)for(let ae=S;ae<=R;ae++){let ue=ae/h*a.$;ae===-1&&(ue=-Rc),ae===h+1&&(ue=a.$+Rc);let _e=ce/h*a.$;ce===-1&&(_e=m.extendToNorthPole?a.bh:-Rc),ce===h+1&&(_e=m.extendToSouthPole?a.bi:a.$+Rc),J[Y++]=ue,J[Y++]=_e}const Q=G?new Uint32Array(F):new Uint16Array(F);let se=0;for(let ce=0;ce<g;ce++)for(let ae=0;ae<p;ae++){const ue=ae+1+ce*y,_e=ae+(ce+1)*y,le=ae+1+(ce+1)*y;Q[se++]=ae+ce*y,Q[se++]=_e,Q[se++]=ue,Q[se++]=ue,Q[se++]=_e,Q[se++]=le}return{vertices:J.buffer.slice(0),indices:Q.buffer.slice(0),uses32bitIndices:G}}const da=new a.aK({fill:new a.bj(128,2),line:new a.bj(512,0),tile:new a.bj(128,32),stencil:new a.bj(128,1),circle:3});class ll{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return de.projectionGlobe}get vertexShaderPreludeCode(){return de.projectionMercator.vertexSource}get subdivisionGranularity(){return da}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(s){this._errorMeasurement||(this._errorMeasurement=new fn(s));const h=a.U(this._errorQueryLatitudeDegrees),p=2*Math.atan(Math.exp(Math.PI-h*Math.PI*2))-.5*Math.PI,g=this._errorMeasurement.updateErrorLoop(h,p),y=N.now();g!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=g,this._errorMeasurementLastChangeTime=y);const w=Math.min(Math.max((y-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=a.bk(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,a.bl(w))}_getMeshKey(s){return`${s.granularity.toString(36)}_${s.generateBorders?"b":""}${s.extendToNorthPole?"n":""}${s.extendToSouthPole?"s":""}`}getMeshFromTileID(s,h,p,g,y){const w=(y==="stencil"?da.stencil:da.tile).getGranularityForZoomLevel(h.z);return this._getMesh(s,{granularity:w,generateBorders:p,extendToNorthPole:h.y===0&&g,extendToSouthPole:h.y===(1<<h.z)-1&&g})}_getMesh(s,h){const p=this._getMeshKey(h);if(p in this._tileMeshCache)return this._tileMeshCache[p];const g=function(y,w){const S=xu(w,"16bit"),C=a.aL.deserialize({arrayBuffer:S.vertices,length:S.vertices.byteLength/2/2}),R=a.aN.deserialize({arrayBuffer:S.indices,length:S.indices.byteLength/2/3});return new $e(y.createVertexBuffer(C,lt.members),y.createIndexBuffer(R),a.aM.simpleSegment(0,0,C.length,R.length))}(s,h);return this._tileMeshCache[p]=g,g}recalculate(s){}hasTransition(){const s=N.now();let h=!1;return h=h||(s-this._errorMeasurementLastChangeTime)/1e3<.7,h=h||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,h}setErrorQueryLatitudeDegrees(s){this._errorQueryLatitudeDegrees=s}}const Pc=new a.r({type:new a.D(a.v.projection.type)});class Bc extends a.E{constructor(s){super(),this._transitionable=new a.t(Pc),this.setProjection(s),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new a.F(0)),this._mercatorProjection=new yt,this._verticalPerspectiveProjection=new ll}get transitionState(){const s=this.properties.get("type");if(typeof s=="string"&&s==="mercator")return 0;if(typeof s=="string"&&s==="vertical-perspective")return 1;if(s instanceof a.bm){if(s.from==="vertical-perspective"&&s.to==="mercator")return 1-s.transition;if(s.from==="mercator"&&s.to==="vertical-perspective")return s.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(s){this._mercatorProjection.updateGPUdependent(s),this._verticalPerspectiveProjection.updateGPUdependent(s)}getMeshFromTileID(s,h,p,g,y){return this.currentProjection.getMeshFromTileID(s,h,p,g,y)}setProjection(s){this._transitionable.setValue("type",(s==null?void 0:s.type)||"mercator")}updateTransitions(s){this._transitioning=this._transitionable.transitioned(s,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(s){this.properties=this._transitioning.possiblyEvaluate(s)}setErrorQueryLatitudeDegrees(s){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(s),this._mercatorProjection.setErrorQueryLatitudeDegrees(s)}}function Dc(m){const s=fa(m.worldSize,m.center.lat);return 2*Math.PI*s}function Ls(m,s,h,p,g){const y=1/(1<<g),w=s/a.$*y+p*y,S=a.bo((m/a.$*y+h*y)*Math.PI*2+Math.PI,2*Math.PI),C=2*Math.atan(Math.exp(Math.PI-w*Math.PI*2))-.5*Math.PI,R=Math.cos(C),B=new Float64Array(3);return B[0]=Math.sin(S)*R,B[1]=Math.sin(C),B[2]=Math.cos(S)*R,B}function hr(m){return function(s,h){const p=Math.cos(h),g=new Float64Array(3);return g[0]=Math.sin(s)*p,g[1]=Math.sin(h),g[2]=Math.cos(s)*p,g}(m.lng*Math.PI/180,m.lat*Math.PI/180)}function fa(m,s){return m/(2*Math.PI)/Math.cos(s*Math.PI/180)}function cl(m){const s=Math.asin(m[1])/Math.PI*180,h=Math.sqrt(m[0]*m[0]+m[2]*m[2]);if(h>1e-6){const p=m[0]/h,g=Math.acos(m[2]/h),y=(p>0?g:-g)/Math.PI*180;return new a.S(a.aO(y,-180,180),s)}return new a.S(0,s)}function Co(m){return Math.cos(m*Math.PI/180)}function Di(m,s){const h=Co(m),p=Co(s);return a.ak(p/h)}function fp(m,s){const h=m.rotate(s.bearingInRadians),p=s.zoom+Di(s.center.lat,0),g=a.bk(1/Co(s.center.lat),1/Co(Math.min(Math.abs(s.center.lat),60)),a.bn(p,7,3,0,1)),y=360/Dc({worldSize:s.worldSize,center:{lat:s.center.lat}});return new a.S(s.center.lng-h.x*y*g,a.ah(s.center.lat+h.y*y,-a.ai,a.ai))}function hl(m){const s=.5*m,h=Math.sin(s),p=Math.cos(s);return Math.log(h+p)-Math.log(p-h)}function wu(m,s,h,p){const g=m.lat+h*p;if(Math.abs(h)>1){const y=(Math.sign(m.lat+h)!==Math.sign(m.lat)?-Math.abs(m.lat):Math.abs(m.lat))*Math.PI/180,w=Math.abs(m.lat+h)*Math.PI/180,S=hl(y+p*(w-y)),C=hl(y),R=hl(w);return new a.S(m.lng+s*((S-C)/(R-C)),g)}return new a.S(m.lng+s*p,g)}class wy{constructor(s){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._boundingVolumeFactory=s}swapBuffers(){if(!this._hadAnyChanges)return;const s=this._cachePrevious;this._cachePrevious=this._cache,this._cache=s,this._cache.clear(),this._hadAnyChanges=!1}getTileBoundingVolume(s,h,p,g){const y=`${s.z}_${s.x}_${s.y}_${g!=null&&g.terrain?"t":""}`,w=this._cache.get(y);if(w)return w;const S=this._cachePrevious.get(y);if(S)return this._cache.set(y,S),S;const C=this._boundingVolumeFactory(s,h,p,g);return this._cache.set(y,C),this._hadAnyChanges=!0,C}}class pa{constructor(s,h,p,g){this.min=p,this.max=g,this.points=s,this.planes=h}static fromAabb(s,h){const p=[];for(let g=0;g<8;g++)p.push([1&~g?s[0]:h[0],(g>>1&1)==1?h[1]:s[1],(g>>2&1)==1?h[2]:s[2]]);return new pa(p,[[-1,0,0,h[0]],[1,0,0,-s[0]],[0,-1,0,h[1]],[0,1,0,-s[1]],[0,0,-1,h[2]],[0,0,1,-s[2]]],s,h)}static fromCenterSizeAngles(s,h,p){const g=a.br([],p[0],p[1],p[2]),y=a.bs([],[h[0],0,0],g),w=a.bs([],[0,h[1],0],g),S=a.bs([],[0,0,h[2]],g),C=[...s],R=[...s];for(let k=0;k<8;k++)for(let F=0;F<3;F++){const V=s[F]+y[F]*(1&~k?-1:1)+w[F]*((k>>1&1)==1?1:-1)+S[F]*((k>>2&1)==1?1:-1);C[F]=Math.min(C[F],V),R[F]=Math.max(R[F],V)}const B=[];for(let k=0;k<8;k++){const F=[...s];a.aS(F,F,a.aR([],y,1&~k?-1:1)),a.aS(F,F,a.aR([],w,(k>>1&1)==1?1:-1)),a.aS(F,F,a.aR([],S,(k>>2&1)==1?1:-1)),B.push(F)}return new pa(B,[[...y,-a.aX(y,B[0])],[...w,-a.aX(w,B[0])],[...S,-a.aX(S,B[0])],[-y[0],-y[1],-y[2],-a.aX(y,B[7])],[-w[0],-w[1],-w[2],-a.aX(w,B[7])],[-S[0],-S[1],-S[2],-a.aX(S,B[7])]],C,R)}intersectsFrustum(s){let h=!0;const p=this.points.length,g=this.planes.length,y=s.planes.length,w=s.points.length;for(let S=0;S<y;S++){const C=s.planes[S];let R=0;for(let B=0;B<p;B++){const k=this.points[B];C[0]*k[0]+C[1]*k[1]+C[2]*k[2]+C[3]>=0&&R++}if(R===0)return 0;R<p&&(h=!1)}if(h)return 2;for(let S=0;S<g;S++){const C=this.planes[S];let R=0;for(let B=0;B<w;B++){const k=s.points[B];C[0]*k[0]+C[1]*k[1]+C[2]*k[2]+C[3]>=0&&R++}if(R===0)return 0}return 1}intersectsPlane(s){const h=this.points.length;let p=0;for(let g=0;g<h;g++){const y=this.points[g];s[0]*y[0]+s[1]*y[1]+s[2]*y[2]+s[3]>=0&&p++}return p===h?2:p===0?0:1}}function wr(m,s,h){const p=m-s;return p<0?-p:Math.max(0,p-h)}function ul(m,s,h,p,g){const y=m-h;let w;return w=y<0?Math.min(-y,1+y-g):y>1?Math.min(Math.max(y-g,0),1-y):0,Math.max(w,wr(s,p,g))}class pn{constructor(){this._boundingVolumeCache=new wy(this._computeTileBoundingVolume)}prepareNextFrame(){this._boundingVolumeCache.swapBuffers()}distanceToTile2d(s,h,p,g){const y=1<<p.z,w=1/y,S=p.x/y,C=p.y/y;let R=2;return R=Math.min(R,ul(s,h,S,C,w)),R=Math.min(R,ul(s,h,S+.5,-C-w,w)),R=Math.min(R,ul(s,h,S+.5,2-C-w,w)),R}getWrap(s,h,p){const g=1<<h.z,y=1/g,w=h.x/g,S=wr(s.x,w,y),C=wr(s.x,w-1,y),R=wr(s.x,w+1,y),B=Math.min(S,C,R);return B===R?1:B===C?-1:0}allowVariableZoom(s,h){return ct(s,h)>4}allowWorldCopies(){return!1}getTileBoundingVolume(s,h,p,g){return this._boundingVolumeCache.getTileBoundingVolume(s,h,p,g)}_computeTileBoundingVolume(s,h,p,g){var y,w;let S=0,C=0;if(g!=null&&g.terrain){const R=new a.Z(s.z,h,s.z,s.x,s.y),B=g.terrain.getMinMaxElevation(R);S=(y=B.minElevation)!==null&&y!==void 0?y:Math.min(0,p),C=(w=B.maxElevation)!==null&&w!==void 0?w:Math.max(0,p)}if(S/=a.bu,C/=a.bu,S+=1,C+=1,s.z<=0)return pa.fromAabb([-C,-C,-C],[C,C,C]);if(s.z===1)return pa.fromAabb([s.x===0?-C:0,s.y===0?0:-C,-C],[s.x===0?0:C,s.y===0?C:0,C]);{const R=[Ls(0,0,s.x,s.y,s.z),Ls(a.$,0,s.x,s.y,s.z),Ls(a.$,a.$,s.x,s.y,s.z),Ls(0,a.$,s.x,s.y,s.z)],B=[];for(const Pe of R)B.push(a.aR([],Pe,C));if(C!==S)for(const Pe of R)B.push(a.aR([],Pe,S));s.y===0&&B.push([0,1,0]),s.y===(1<<s.z)-1&&B.push([0,-1,0]);const k=[1,1,1],F=[-1,-1,-1];for(const Pe of B)for(let Fe=0;Fe<3;Fe++)k[Fe]=Math.min(k[Fe],Pe[Fe]),F[Fe]=Math.max(F[Fe],Pe[Fe]);const V=Ls(a.$/2,a.$/2,s.x,s.y,s.z),G=a.aW([],[0,1,0],V);a.aV(G,G);const J=a.aW([],V,G);a.aV(J,J);const Y=a.aW([],R[2],R[1]);a.aV(Y,Y);const Q=a.aW([],R[0],R[3]);a.aV(Q,Q),B.push(a.aR([],V,C)),s.y>=(1<<s.z)/2&&B.push(a.aR([],Ls(a.$/2,0,s.x,s.y,s.z),C)),s.y<(1<<s.z)/2&&B.push(a.aR([],Ls(a.$/2,a.$,s.x,s.y,s.z),C));const se=dl(V,B),ce=dl(J,B),ae=[-V[0],-V[1],-V[2],se.max],ue=[V[0],V[1],V[2],-se.min],_e=[-J[0],-J[1],-J[2],ce.max],le=[J[0],J[1],J[2],-ce.min],ve=[...Y,0],ke=[...Q,0],Me=[];return s.y===0?Me.push(a.bt(ke,ve,ae),a.bt(ke,ve,ue)):Me.push(a.bt(_e,ve,ae),a.bt(_e,ve,ue),a.bt(_e,ke,ae),a.bt(_e,ke,ue)),s.y===(1<<s.z)-1?Me.push(a.bt(ke,ve,ae),a.bt(ke,ve,ue)):Me.push(a.bt(le,ve,ae),a.bt(le,ve,ue),a.bt(le,ke,ae),a.bt(le,ke,ue)),new pa(Me,[ae,ue,_e,le,ve,ke],k,F)}}}function dl(m,s){let h=1/0,p=-1/0;for(const g of s){const y=a.aX(m,g);h=Math.min(h,y),p=Math.max(p,y)}return{min:h,max:p}}class fl{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(s){this._helper.setMinZoom(s)}setMaxZoom(s){this._helper.setMaxZoom(s)}setMinPitch(s){this._helper.setMinPitch(s)}setMaxPitch(s){this._helper.setMaxPitch(s)}setRenderWorldCopies(s){this._helper.setRenderWorldCopies(s)}setBearing(s){this._helper.setBearing(s)}setPitch(s){this._helper.setPitch(s)}setRoll(s){this._helper.setRoll(s)}setFov(s){this._helper.setFov(s)}setZoom(s){this._helper.setZoom(s)}setCenter(s){this._helper.setCenter(s)}setElevation(s){this._helper.setElevation(s)}setMinElevationForCurrentTile(s){this._helper.setMinElevationForCurrentTile(s)}setPadding(s){this._helper.setPadding(s)}interpolatePadding(s,h,p){return this._helper.interpolatePadding(s,h,p)}isPaddingEqual(s){return this._helper.isPaddingEqual(s)}resize(s,h){this._helper.resize(s,h)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(s){this._helper.setMaxBounds(s)}overrideNearFarZ(s,h){this._helper.overrideNearFarZ(s,h)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(s){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),s)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(s){}constructor(){this._cachedClippingPlane=a.bv(),this._projectionMatrix=a.b9(),this._globeViewProjMatrix32f=a.b8(),this._globeViewProjMatrixNoCorrection=a.b9(),this._globeViewProjMatrixNoCorrectionInverted=a.b9(),this._globeProjMatrixInverted=a.b9(),this._cameraPosition=a.bp(),this._globeLatitudeErrorCorrectionRadians=0,this._helper=new Ur({calcMatrices:()=>{this._calcMatrices()},getConstrained:(s,h)=>this.getConstrained(s,h)}),this._coveringTilesDetailsProvider=new pn}clone(){const s=new fl;return s.apply(this),s}apply(s,h){this._globeLatitudeErrorCorrectionRadians=h||0,this._helper.apply(s)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){const s=a.bp();return s[0]=this._cameraPosition[0],s[1]=this._cameraPosition[1],s[2]=this._cameraPosition[2],s}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(s){const{overscaledTileID:h,applyGlobeMatrix:p}=s,g=this._helper.getMercatorTileCoordinates(h);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:g,clippingPlane:this._cachedClippingPlane,projectionTransition:p?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(s){const h=this.pitchInRadians,p=this.cameraToCenterDistance/s,g=Math.sin(h)*p,y=Math.cos(h)*p+1,w=1/Math.sqrt(g*g+y*y)*1;let S=-g,C=y;const R=Math.sqrt(S*S+C*C);S/=R,C/=R;const B=[0,S,C];a.bw(B,B,[0,0,0],-this.bearingInRadians),a.bx(B,B,[0,0,0],-1*this.center.lat*Math.PI/180),a.by(B,B,[0,0,0],this.center.lng*Math.PI/180);const k=1/a.aZ(B);return a.aR(B,B,k),[...B,-w*k]}isLocationOccluded(s){return!this.isSurfacePointVisible(hr(s))}transformLightDirection(s){const h=this._helper._center.lng*Math.PI/180,p=this._helper._center.lat*Math.PI/180,g=Math.cos(p),y=[Math.sin(h)*g,Math.sin(p),Math.cos(h)*g],w=[y[2],0,-y[0]],S=[0,0,0];a.aW(S,w,y),a.aV(w,w),a.aV(S,S);const C=[0,0,0];return a.aV(C,[w[0]*s[0]+S[0]*s[1]+y[0]*s[2],w[1]*s[0]+S[1]*s[1]+y[1]*s[2],w[2]*s[0]+S[2]*s[1]+y[2]*s[2]]),C}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(s,h,p){const g=function(S,C,R){const B=1/(1<<R.z);return new a.a1(S/a.$*B+R.x*B,C/a.$*B+R.y*B)}(s,h,p.canonical),y=(w=g.y,[a.bo(g.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-w*Math.PI*2))-.5*Math.PI]);var w;return this.getCircleRadiusCorrection()/Math.cos(y[1])}projectTileCoordinates(s,h,p,g){const y=p.canonical,w=Ls(s,h,y.x,y.y,y.z),S=1+(g?g(s,h):0)/a.bu,C=[w[0]*S,w[1]*S,w[2]*S,1];a.aw(C,C,this._globeViewProjMatrixNoCorrection);const R=this._cachedClippingPlane,B=R[0]*w[0]+R[1]*w[1]+R[2]*w[2]+R[3]<0;return{point:new a.P(C[0]/C[3],C[1]/C[3]),signedDistanceFromCamera:C[3],isOccluded:B}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;const s=fa(this.worldSize,this.center.lat),h=a.ba(),p=a.ba();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*s),a.b4(h,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);const g=this.centerOffset;h[8]=2*-g.x/this._helper._width,h[9]=2*g.y/this._helper._height,this._projectionMatrix=a.b5(h),this._globeProjMatrixInverted=a.ba(),a.aq(this._globeProjMatrixInverted,h),a.M(h,h,[0,0,-this.cameraToCenterDistance]),a.b6(h,h,this.rollInRadians),a.b7(h,h,-this.pitchInRadians),a.b6(h,h,this.bearingInRadians),a.M(h,h,[0,0,-s]);const y=a.bp();y[0]=s,y[1]=s,y[2]=s,a.b7(p,h,this.center.lat*Math.PI/180),a.bz(p,p,-this.center.lng*Math.PI/180),a.N(p,p,y),this._globeViewProjMatrixNoCorrection=p,a.b7(h,h,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),a.bz(h,h,-this.center.lng*Math.PI/180),a.N(h,h,y),this._globeViewProjMatrix32f=new Float32Array(h),this._globeViewProjMatrixNoCorrectionInverted=a.ba(),a.aq(this._globeViewProjMatrixNoCorrectionInverted,p);const w=a.bp();this._cameraPosition=a.bp(),this._cameraPosition[2]=this.cameraToCenterDistance/s,a.bw(this._cameraPosition,this._cameraPosition,w,-this.rollInRadians),a.bx(this._cameraPosition,this._cameraPosition,w,this.pitchInRadians),a.bw(this._cameraPosition,this._cameraPosition,w,-this.bearingInRadians),a.aS(this._cameraPosition,this._cameraPosition,[0,0,1]),a.bx(this._cameraPosition,this._cameraPosition,w,-this.center.lat*Math.PI/180),a.by(this._cameraPosition,this._cameraPosition,w,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(s);const S=a.b5(this._globeViewProjMatrixNoCorrectionInverted);a.N(S,S,[1,1,-1]),this._cachedFrustum=qi.fromInvProjectionMatrix(S,1,0,this._cachedClippingPlane,!0)}calculateFogMatrix(s){a.w("calculateFogMatrix is not supported on globe projection.");const h=a.ba();return a.ag(h),h}getVisibleUnwrappedCoordinates(s){return[new a.b2(0,s)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(s){s&&a.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(s,h){if(!this._globeViewProjMatrixNoCorrection)return 1;const p=hr(s);a.aR(p,p,1+h/a.bu);const g=a.bv();return a.aw(g,[p[0],p[1],p[2],1],this._globeViewProjMatrixNoCorrection),g[2]/g[3]}populateCache(s){}getBounds(){const s=.5*this.width,h=.5*this.height,p=[new a.P(0,0),new a.P(s,0),new a.P(this.width,0),new a.P(this.width,h),new a.P(this.width,this.height),new a.P(s,this.height),new a.P(0,this.height),new a.P(0,h)],g=[];for(const k of p)g.push(this.unprojectScreenPoint(k));let y=0,w=0,S=0,C=0;const R=this.center;for(const k of g){const F=a.bA(R.lng,k.lng),V=a.bA(R.lat,k.lat);F<w&&(w=F),F>y&&(y=F),V<C&&(C=V),V>S&&(S=V)}const B=[R.lng+w,R.lat+C,R.lng+y,R.lat+S];return this.isSurfacePointOnScreen([0,1,0])&&(B[3]=90,B[0]=-180,B[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(B[1]=-90,B[0]=-180,B[2]=180),new oi(B)}getConstrained(s,h){const p=a.ah(s.lat,-a.ai,a.ai),g=a.ah(+h,this.minZoom+Di(0,p),this.maxZoom);return{center:new a.S(s.lng,p),zoom:g}}calculateCenterFromCameraLngLatAlt(s,h,p,g){return this._helper.calculateCenterFromCameraLngLatAlt(s,h,p,g)}setLocationAtPoint(s,h){const p=hr(this.unprojectScreenPoint(h)),g=hr(s),y=a.bp();a.bB(y);const w=a.bp();a.by(w,p,y,-this.center.lng*Math.PI/180),a.bx(w,w,y,this.center.lat*Math.PI/180);const S=g[0]*g[0]+g[2]*g[2],C=w[0]*w[0];if(S<C)return;const R=Math.sqrt(S-C),B=-R,k=a.bC(g[0],g[2],w[0],R),F=a.bC(g[0],g[2],w[0],B),V=a.bp();a.by(V,g,y,-k);const G=a.bC(V[1],V[2],w[1],w[2]),J=a.bp();a.by(J,g,y,-F);const Y=a.bC(J[1],J[2],w[1],w[2]),Q=.5*Math.PI,se=G>=-Q&&G<=Q,ce=Y>=-Q&&Y<=Q;let ae,ue;if(se&&ce){const ke=this.center.lng*Math.PI/180,Me=this.center.lat*Math.PI/180;a.bD(k,ke)+a.bD(G,Me)<a.bD(F,ke)+a.bD(Y,Me)?(ae=k,ue=G):(ae=F,ue=Y)}else if(se)ae=k,ue=G;else{if(!ce)return;ae=F,ue=Y}const _e=ae/Math.PI*180,le=ue/Math.PI*180,ve=this.center.lat;this.setCenter(new a.S(_e,a.ah(le,-90,90))),this.setZoom(this.zoom+Di(ve,this.center.lat))}locationToScreenPoint(s,h){const p=hr(s);if(h){const g=h.getElevationForLngLatZoom(s,this._helper._tileZoom);a.aR(p,p,1+g/a.bu)}return this._projectSurfacePointToScreen(p)}_projectSurfacePointToScreen(s){const h=a.bv();return a.aw(h,[...s,1],this._globeViewProjMatrixNoCorrection),h[0]/=h[3],h[1]/=h[3],new a.P((.5*h[0]+.5)*this.width,(.5*-h[1]+.5)*this.height)}screenPointToMercatorCoordinate(s,h){if(h){const p=h.pointCoordinate(s);if(p)return p}return a.a1.fromLngLat(this.unprojectScreenPoint(s))}screenPointToLocation(s,h){var p;return(p=this.screenPointToMercatorCoordinate(s,h))===null||p===void 0?void 0:p.toLngLat()}isPointOnMapSurface(s,h){const p=this._cameraPosition,g=this.getRayDirectionFromPixel(s);return!!this.rayPlanetIntersection(p,g)}getRayDirectionFromPixel(s){const h=a.bv();h[0]=s.x/this.width*2-1,h[1]=-1*(s.y/this.height*2-1),h[2]=1,h[3]=1,a.aw(h,h,this._globeViewProjMatrixNoCorrectionInverted),h[0]/=h[3],h[1]/=h[3],h[2]/=h[3];const p=a.bp();p[0]=h[0]-this._cameraPosition[0],p[1]=h[1]-this._cameraPosition[1],p[2]=h[2]-this._cameraPosition[2];const g=a.bp();return a.aV(g,p),g}isSurfacePointVisible(s){const h=this._cachedClippingPlane;return h[0]*s[0]+h[1]*s[1]+h[2]*s[2]+h[3]>=0}isSurfacePointOnScreen(s){if(!this.isSurfacePointVisible(s))return!1;const h=a.bv();return a.aw(h,[...s,1],this._globeViewProjMatrixNoCorrection),h[0]/=h[3],h[1]/=h[3],h[2]/=h[3],h[0]>-1&&h[0]<1&&h[1]>-1&&h[1]<1&&h[2]>-1&&h[2]<1}rayPlanetIntersection(s,h){const p=a.aX(s,h),g=a.bp(),y=a.bp();a.aR(y,h,p),a.aU(g,s,y);const w=1-a.aX(g,g);if(w<0)return null;const S=a.aX(s,s)-1,C=-p+(p<0?1:-1)*Math.sqrt(w),R=S/C,B=C;return{tMin:Math.min(R,B),tMax:Math.max(R,B)}}unprojectScreenPoint(s){const h=this._cameraPosition,p=this.getRayDirectionFromPixel(s),g=this.rayPlanetIntersection(h,p);if(g){const B=a.bp();a.aS(B,h,[p[0]*g.tMin,p[1]*g.tMin,p[2]*g.tMin]);const k=a.bp();return a.aV(k,B),cl(k)}const y=this._cachedClippingPlane,w=y[0]*p[0]+y[1]*p[1]+y[2]*p[2],S=-a.b1(y,h)/w,C=a.bp();if(S>0)a.aS(C,h,[p[0]*S,p[1]*S,p[2]*S]);else{const B=a.bp();a.aS(B,h,[2*p[0],2*p[1],2*p[2]]);const k=a.b1(this._cachedClippingPlane,B);a.aU(C,B,[this._cachedClippingPlane[0]*k,this._cachedClippingPlane[1]*k,this._cachedClippingPlane[2]*k])}const R=function(B){const k=a.bp();return k[0]=B[0]*-B[3],k[1]=B[1]*-B[3],k[2]=B[2]*-B[3],{center:k,radius:Math.sqrt(1-B[3]*B[3])}}(y);return cl(function(B,k,F){const V=a.bp();a.aU(V,F,B);const G=a.bp();return a.bq(G,B,V,k/a.a$(V)),G}(R.center,R.radius,C))}getMatrixForModel(s,h){const p=a.S.convert(s),g=1/a.bu,y=a.b9();return a.bz(y,y,p.lng/180*Math.PI),a.b7(y,y,-p.lat/180*Math.PI),a.M(y,y,[0,0,1+h/a.bu]),a.b7(y,y,.5*Math.PI),a.N(y,y,[g,g,g]),y}getProjectionDataForCustomLayer(s=!0){const h=this.getProjectionData({overscaledTileID:new a.Z(0,0,0,0,0),applyGlobeMatrix:s});return h.tileMercatorCoords=[0,0,1,1],h}getFastPathSimpleProjectionMatrix(s){}}class pl{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(s){this._helper.setMinZoom(s)}setMaxZoom(s){this._helper.setMaxZoom(s)}setMinPitch(s){this._helper.setMinPitch(s)}setMaxPitch(s){this._helper.setMaxPitch(s)}setRenderWorldCopies(s){this._helper.setRenderWorldCopies(s)}setBearing(s){this._helper.setBearing(s)}setPitch(s){this._helper.setPitch(s)}setRoll(s){this._helper.setRoll(s)}setFov(s){this._helper.setFov(s)}setZoom(s){this._helper.setZoom(s)}setCenter(s){this._helper.setCenter(s)}setElevation(s){this._helper.setElevation(s)}setMinElevationForCurrentTile(s){this._helper.setMinElevationForCurrentTile(s)}setPadding(s){this._helper.setPadding(s)}interpolatePadding(s,h,p){return this._helper.interpolatePadding(s,h,p)}isPaddingEqual(s){return this._helper.isPaddingEqual(s)}resize(s,h,p=!0){this._helper.resize(s,h,p)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(s){this._helper.setMaxBounds(s)}overrideNearFarZ(s,h){this._helper.overrideNearFarZ(s,h)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(s){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),s)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(s,h){this._globeness=s,this._globeLatitudeErrorCorrectionRadians=h,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().prepareNextFrame(),this._mercatorTransform.getCoveringTilesDetailsProvider().prepareNextFrame()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this._helper=new Ur({calcMatrices:()=>{this._calcMatrices()},getConstrained:(s,h)=>this.getConstrained(s,h)}),this._globeness=1,this._mercatorTransform=new ai,this._verticalPerspectiveTransform=new fl}clone(){const s=new pl;return s._globeness=this._globeness,s._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,s.apply(this),s}apply(s){this._helper.apply(s),this._mercatorTransform.apply(this),this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(s){const h=this._mercatorTransform.getProjectionData(s),p=this._verticalPerspectiveTransform.getProjectionData(s);return{mainMatrix:this.isGlobeRendering?p.mainMatrix:h.mainMatrix,clippingPlane:p.clippingPlane,tileMercatorCoords:p.tileMercatorCoords,projectionTransition:s.applyGlobeMatrix?this._globeness:0,fallbackMatrix:h.fallbackMatrix}}isLocationOccluded(s){return this.currentTransform.isLocationOccluded(s)}transformLightDirection(s){return this.currentTransform.transformLightDirection(s)}getPixelScale(){return a.bk(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return a.bk(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(s,h,p){const g=this._mercatorTransform.getPitchedTextCorrection(s,h,p),y=this._verticalPerspectiveTransform.getPitchedTextCorrection(s,h,p);return a.bk(g,y,this._globeness)}projectTileCoordinates(s,h,p,g){return this.currentTransform.projectTileCoordinates(s,h,p,g)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(s){return this.currentTransform.calculateFogMatrix(s)}getVisibleUnwrappedCoordinates(s){return this.currentTransform.getVisibleUnwrappedCoordinates(s)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(s){this._mercatorTransform.recalculateZoomAndCenter(s),this._verticalPerspectiveTransform.recalculateZoomAndCenter(s)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(s,h){return this.currentTransform.lngLatToCameraDepth(s,h)}populateCache(s){this._mercatorTransform.populateCache(s),this._verticalPerspectiveTransform.populateCache(s)}getBounds(){return this.currentTransform.getBounds()}getConstrained(s,h){return this.currentTransform.getConstrained(s,h)}calculateCenterFromCameraLngLatAlt(s,h,p,g){return this._helper.calculateCenterFromCameraLngLatAlt(s,h,p,g)}setLocationAtPoint(s,h){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(s,h),void this.apply(this._mercatorTransform);this._verticalPerspectiveTransform.setLocationAtPoint(s,h),this.apply(this._verticalPerspectiveTransform)}locationToScreenPoint(s,h){return this.currentTransform.locationToScreenPoint(s,h)}screenPointToMercatorCoordinate(s,h){return this.currentTransform.screenPointToMercatorCoordinate(s,h)}screenPointToLocation(s,h){return this.currentTransform.screenPointToLocation(s,h)}isPointOnMapSurface(s,h){return this.currentTransform.isPointOnMapSurface(s,h)}getRayDirectionFromPixel(s){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(s)}getMatrixForModel(s,h){return this.currentTransform.getMatrixForModel(s,h)}getProjectionDataForCustomLayer(s=!0){const h=this._mercatorTransform.getProjectionDataForCustomLayer(s);if(!this.isGlobeRendering)return h;const p=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(s);return p.fallbackMatrix=h.mainMatrix,p}getFastPathSimpleProjectionMatrix(s){return this.currentTransform.getFastPathSimpleProjectionMatrix(s)}}class Pr{get useGlobeControls(){return!0}handlePanInertia(s,h){const p=fp(s,h);return Math.abs(p.lng-h.center.lng)>180&&(p.lng=h.center.lng+179.5*Math.sign(p.lng-h.center.lng)),{easingCenter:p,easingOffset:new a.P(0,0)}}handleMapControlsRollPitchBearingZoom(s,h){const p=s.around,g=h.screenPointToLocation(p);s.bearingDelta&&h.setBearing(h.bearing+s.bearingDelta),s.pitchDelta&&h.setPitch(h.pitch+s.pitchDelta),s.rollDelta&&h.setRoll(h.roll+s.rollDelta);const y=h.zoom;s.zoomDelta&&h.setZoom(h.zoom+s.zoomDelta);const w=h.zoom-y;if(w===0)return;const S=a.bA(h.center.lng,g.lng),C=S/(Math.abs(S/180)+1),R=a.bA(h.center.lat,g.lat),B=h.getRayDirectionFromPixel(p),k=h.cameraPosition,F=-1*a.aX(k,B),V=a.bp();a.aS(V,k,[B[0]*F,B[1]*F,B[2]*F]);const G=a.aZ(V)-1,J=Math.exp(.5*-Math.max(G-.3,0)),Y=fa(h.worldSize,h.center.lat)/Math.min(h.width,h.height),Q=a.bn(Y,.9,.5,1,.25),se=(1-a.af(-w))*Math.min(J,Q),ce=h.center.lat,ae=h.zoom,ue=new a.S(h.center.lng+C*se,a.ah(h.center.lat+R*se,-a.ai,a.ai));h.setLocationAtPoint(g,p);const _e=h.center,le=a.bn(Math.abs(S),45,85,0,1),ve=a.bn(Y,.75,.35,0,1),ke=Math.pow(Math.max(le,ve),.25),Me=a.bA(_e.lng,ue.lng),Pe=a.bA(_e.lat,ue.lat);h.setCenter(new a.S(_e.lng+Me*ke,_e.lat+Pe*ke).wrap()),h.setZoom(ae+Di(ce,h.center.lat))}handleMapControlsPan(s,h,p){if(!s.panDelta)return;const g=h.center.lat,y=h.zoom;h.setCenter(fp(s.panDelta,h).wrap()),h.setZoom(y+Di(g,h.center.lat))}cameraForBoxAndBearing(s,h,p,g,y){const w=ns(s,h,p,g,y),S=h.left/y.width*2-1,C=(y.width-h.right)/y.width*2-1,R=h.top/y.height*-2+1,B=(y.height-h.bottom)/y.height*-2+1,k=a.bA(p.getWest(),p.getEast())<0,F=k?p.getEast():p.getWest(),V=k?p.getWest():p.getEast(),G=Math.max(p.getNorth(),p.getSouth()),J=Math.min(p.getNorth(),p.getSouth()),Y=F+.5*a.bA(F,V),Q=G+.5*a.bA(G,J),se=y.clone();se.setCenter(w.center),se.setBearing(w.bearing),se.setPitch(0),se.setRoll(0),se.setZoom(w.zoom);const ce=se.modelViewProjectionMatrix,ae=[hr(p.getNorthWest()),hr(p.getNorthEast()),hr(p.getSouthWest()),hr(p.getSouthEast()),hr(new a.S(V,Q)),hr(new a.S(F,Q)),hr(new a.S(Y,G)),hr(new a.S(Y,J))],ue=hr(w.center);let _e=Number.POSITIVE_INFINITY;for(const le of ae)S<0&&(_e=Pr.getLesserNonNegativeNonNull(_e,Pr.solveVectorScale(le,ue,ce,"x",S))),C>0&&(_e=Pr.getLesserNonNegativeNonNull(_e,Pr.solveVectorScale(le,ue,ce,"x",C))),R>0&&(_e=Pr.getLesserNonNegativeNonNull(_e,Pr.solveVectorScale(le,ue,ce,"y",R))),B<0&&(_e=Pr.getLesserNonNegativeNonNull(_e,Pr.solveVectorScale(le,ue,ce,"y",B)));if(Number.isFinite(_e)&&_e!==0)return w.zoom=se.zoom+a.ak(_e),w;dp()}handleJumpToCenterZoom(s,h){const p=s.center.lat,g=s.getConstrained(h.center?a.S.convert(h.center):s.center,s.zoom).center;s.setCenter(g.wrap());const y=h.zoom!==void 0?+h.zoom:s.zoom+Di(p,g.lat);s.zoom!==y&&s.setZoom(y)}handleEaseTo(s,h){const p=s.zoom,g=s.center,y=s.padding,w={roll:s.roll,pitch:s.pitch,bearing:s.bearing},S={roll:h.roll===void 0?s.roll:h.roll,pitch:h.pitch===void 0?s.pitch:h.pitch,bearing:h.bearing===void 0?s.bearing:h.bearing},C=h.zoom!==void 0,R=!s.isPaddingEqual(h.padding);let B=!1;const k=h.center?a.S.convert(h.center):g,F=s.getConstrained(k,p).center;Lr(s,F);const V=s.clone();V.setCenter(F),V.setZoom(C?+h.zoom:p+Di(g.lat,k.lat)),V.setBearing(h.bearing);const G=new a.P(a.ah(s.centerPoint.x+h.offsetAsPoint.x,0,s.width),a.ah(s.centerPoint.y+h.offsetAsPoint.y,0,s.height));V.setLocationAtPoint(F,G);const J=(h.offset&&h.offsetAsPoint.mag())>0?V.center:F,Y=C?+h.zoom:p+Di(g.lat,J.lat),Q=p+Di(g.lat,0),se=Y+Di(J.lat,0),ce=a.bA(g.lng,J.lng),ae=a.bA(g.lat,J.lat),ue=a.af(se-Q);return B=Y!==p,{easeFunc:_e=>{if(a.be(w,S)||Vr({startEulerAngles:w,endEulerAngles:S,tr:s,k:_e,useSlerp:w.roll!=S.roll}),R&&s.interpolatePadding(y,h.padding,_e),h.around)a.w("Easing around a point is not supported under globe projection."),s.setLocationAtPoint(h.around,h.aroundPoint);else{const le=se>Q?Math.min(2,ue):Math.max(.5,ue),ve=Math.pow(le,1-_e),ke=wu(g,ce,ae,_e*ve);s.setCenter(ke.wrap())}if(B){const le=a.C.number(Q,se,_e)+Di(0,s.center.lat);s.setZoom(le)}},isZooming:B,elevationCenter:J}}handleFlyTo(s,h){const p=h.zoom!==void 0,g=s.center,y=s.zoom,w=s.padding,S=!s.isPaddingEqual(h.padding),C=s.getConstrained(a.S.convert(h.center||h.locationAtOffset),y).center,R=p?+h.zoom:s.zoom+Di(s.center.lat,C.lat),B=s.clone();B.setCenter(C),B.setZoom(R),B.setBearing(h.bearing);const k=new a.P(a.ah(s.centerPoint.x+h.offsetAsPoint.x,0,s.width),a.ah(s.centerPoint.y+h.offsetAsPoint.y,0,s.height));B.setLocationAtPoint(C,k);const F=B.center;Lr(s,F);const V=function(ae,ue,_e){const le=hr(ue),ve=hr(_e),ke=a.aX(le,ve),Me=Math.acos(ke),Pe=Dc(ae);return Me/(2*Math.PI)*Pe}(s,g,F),G=y+Di(g.lat,0),J=R+Di(F.lat,0),Y=a.af(J-G);let Q;if(typeof h.minZoom=="number"){const ae=+h.minZoom+Di(F.lat,0),ue=Math.min(ae,G,J)+Di(0,F.lat),_e=s.getConstrained(F,ue).zoom+Di(F.lat,0);Q=a.af(_e-G)}const se=a.bA(g.lng,F.lng),ce=a.bA(g.lat,F.lat);return{easeFunc:(ae,ue,_e,le)=>{const ve=wu(g,se,ce,_e);S&&s.interpolatePadding(w,h.padding,ae);const ke=ae===1?F:ve;s.setCenter(ke.wrap());const Me=G+a.ak(ue);s.setZoom(ae===1?R:Me+Di(0,ke.lat))},scaleOfZoom:Y,targetCenter:F,scaleOfMinZoom:Q,pixelPathLength:V}}static solveVectorScale(s,h,p,g,y){const w=g==="x"?[p[0],p[4],p[8],p[12]]:[p[1],p[5],p[9],p[13]],S=[p[3],p[7],p[11],p[15]],C=s[0]*w[0]+s[1]*w[1]+s[2]*w[2],R=s[0]*S[0]+s[1]*S[1]+s[2]*S[2],B=h[0]*w[0]+h[1]*w[1]+h[2]*w[2],k=h[0]*S[0]+h[1]*S[1]+h[2]*S[2];return B+y*R===C+y*k||S[3]*(C-B)+w[3]*(k-R)+C*k==B*R?null:(B+w[3]-y*k-y*S[3])/(B-C-y*k+y*R)}static getLesserNonNegativeNonNull(s,h){return h!==null&&h>=0&&h<s?h:s}}class pp{constructor(s){this._globe=s,this._mercatorCameraHelper=new Rr,this._verticalPerspectiveCameraHelper=new Pr}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(s,h){return this.currentHelper.handlePanInertia(s,h)}handleMapControlsRollPitchBearingZoom(s,h){return this.currentHelper.handleMapControlsRollPitchBearingZoom(s,h)}handleMapControlsPan(s,h,p){this.currentHelper.handleMapControlsPan(s,h,p)}cameraForBoxAndBearing(s,h,p,g,y){return this.currentHelper.cameraForBoxAndBearing(s,h,p,g,y)}handleJumpToCenterZoom(s,h){this.currentHelper.handleJumpToCenterZoom(s,h)}handleEaseTo(s,h){return this.currentHelper.handleEaseTo(s,h)}handleFlyTo(s,h){return this.currentHelper.handleFlyTo(s,h)}}const Oc=(m,s)=>a.y(m,s&&s.filter(h=>h.identifier!=="source.canvas")),Ty=a.bE();class Tu extends a.E{constructor(s,h={}){super(),this._rtlPluginLoaded=()=>{for(const p in this.sourceCaches){const g=this.sourceCaches[p].getSource().type;g!=="vector"&&g!=="geojson"||this.sourceCaches[p].reload()}},this.map=s,this.dispatcher=new Ir(In(),s._getMapId()),this.dispatcher.registerMessageHandler("GG",(p,g)=>this.getGlyphs(p,g)),this.dispatcher.registerMessageHandler("GI",(p,g)=>this.getImages(p,g)),this.imageManager=new nt,this.imageManager.setEventedParent(this),this.glyphManager=new Ht(s._requestManager,h.localIdeographFontFamily),this.lineAtlas=new Gt(256,512),this.crossTileSymbolIndex=new q,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new a.bF,this._loaded=!1,this._availableImages=[],this._globalState={},this._resetUpdates(),this.dispatcher.broadcast("SR",a.bG()),Bs().on(Mn,this._rtlPluginLoaded),this.on("data",p=>{if(p.dataType!=="source"||p.sourceDataType!=="metadata")return;const g=this.sourceCaches[p.sourceId];if(!g)return;const y=g.getSource();if(y&&y.vectorLayerIds)for(const w in this._layers){const S=this._layers[w];S.source===y.id&&this._validateLayer(S)}})}setGlobalStateProperty(s,h){var p,g,y;this._checkLoaded();const w=h===null?(y=(g=(p=this.stylesheet.state)===null||p===void 0?void 0:p[s])===null||g===void 0?void 0:g.default)!==null&&y!==void 0?y:null:h;if(a.bH(w,this._globalState[s]))return this;this._globalState[s]=w;const S=this._findGlobalStateAffectedSources([s]);for(const C in this.sourceCaches)S.has(C)&&(this._reloadSource(C),this._changed=!0)}getGlobalState(){return this._globalState}setGlobalState(s){this._checkLoaded();const h=[];for(const g in s)!a.bH(this._globalState[g],s[g].default)&&(h.push(g),this._globalState[g]=s[g].default);const p=this._findGlobalStateAffectedSources(h);for(const g in this.sourceCaches)p.has(g)&&(this._reloadSource(g),this._changed=!0)}_findGlobalStateAffectedSources(s){if(s.length===0)return new Set;const h=new Set;for(const p in this._layers){const g=this._layers[p],y=g.getLayoutAffectingGlobalStateRefs();for(const w of s)y.has(w)&&h.add(g.source)}return h}loadURL(s,h={},p){this.fire(new a.l("dataloading",{dataType:"style"})),h.validate=typeof h.validate!="boolean"||h.validate;const g=this.map._requestManager.transformRequest(s,"Style");this._loadStyleRequest=new AbortController;const y=this._loadStyleRequest;a.j(g,this._loadStyleRequest).then(w=>{this._loadStyleRequest=null,this._load(w.data,h,p)}).catch(w=>{this._loadStyleRequest=null,w&&!y.signal.aborted&&this.fire(new a.k(w))})}loadJSON(s,h={},p){this.fire(new a.l("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,N.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,h.validate=h.validate!==!1,this._load(s,h,p)}).catch(()=>{})}loadEmpty(){this.fire(new a.l("dataloading",{dataType:"style"})),this._load(Ty,{validate:!1})}_load(s,h,p){var g,y,w;const S=h.transformStyle?h.transformStyle(p,s):s;if(!h.validate||!Oc(this,a.z(S))){this._loaded=!0,this.stylesheet=S;for(const C in S.sources)this.addSource(C,S.sources[C],{validate:!1});S.sprite?this._loadSprite(S.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(S.glyphs),this._createLayers(),this.light=new Fr(this.stylesheet.light),this._setProjectionInternal(((g=this.stylesheet.projection)===null||g===void 0?void 0:g.type)||"mercator"),this.sky=new Qn(this.stylesheet.sky),this.map.setTerrain((y=this.stylesheet.terrain)!==null&&y!==void 0?y:null),this.setGlobalState((w=this.stylesheet.state)!==null&&w!==void 0?w:null),this.fire(new a.l("data",{dataType:"style"})),this.fire(new a.l("style.load"))}}_createLayers(){const s=a.bI(this.stylesheet.layers);this.dispatcher.broadcast("SL",s),this._order=s.map(h=>h.id),this._layers={},this._serializedLayers=null;for(const h of s){const p=a.bJ(h);p.setEventedParent(this,{layer:{id:h.id}}),this._layers[h.id]=p}}_loadSprite(s,h=!1,p=void 0){let g;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(y,w,S,C){return a._(this,void 0,void 0,function*(){const R=qe(y),B=S>1?"@2x":"",k={},F={};for(const{id:V,url:G}of R){const J=w.transformRequest(ht(G,B,".json"),"SpriteJSON");k[V]=a.j(J,C);const Y=w.transformRequest(ht(G,B,".png"),"SpriteImage");F[V]=Ue.getImage(Y,C)}return yield Promise.all([...Object.values(k),...Object.values(F)]),function(V,G){return a._(this,void 0,void 0,function*(){const J={};for(const Y in V){J[Y]={};const Q=N.getImageCanvasContext((yield G[Y]).data),se=(yield V[Y]).data;for(const ce in se){const{width:ae,height:ue,x:_e,y:le,sdf:ve,pixelRatio:ke,stretchX:Me,stretchY:Pe,content:Fe,textFitWidth:Ze,textFitHeight:Ye}=se[ce];J[Y][ce]={data:null,pixelRatio:ke,sdf:ve,stretchX:Me,stretchY:Pe,content:Fe,textFitWidth:Ze,textFitHeight:Ye,spriteData:{width:ae,height:ue,x:_e,y:le,context:Q}}}}return J})}(k,F)})}(s,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(y=>{if(this._spriteRequest=null,y)for(const w in y){this._spritesImagesIds[w]=[];const S=this._spritesImagesIds[w]?this._spritesImagesIds[w].filter(C=>!(C in y)):[];for(const C of S)this.imageManager.removeImage(C),this._changedImages[C]=!0;for(const C in y[w]){const R=w==="default"?C:`${w}:${C}`;this._spritesImagesIds[w].push(R),R in this.imageManager.images?this.imageManager.updateImage(R,y[w][C],!1):this.imageManager.addImage(R,y[w][C]),h&&(this._changedImages[R]=!0)}}}).catch(y=>{this._spriteRequest=null,g=y,this.fire(new a.k(g))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),h&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.l("data",{dataType:"style"})),p&&p(g)})}_unloadSprite(){for(const s of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(s),this._changedImages[s]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.l("data",{dataType:"style"}))}_validateLayer(s){const h=this.sourceCaches[s.source];if(!h)return;const p=s.sourceLayer;if(!p)return;const g=h.getSource();(g.type==="geojson"||g.vectorLayerIds&&g.vectorLayerIds.indexOf(p)===-1)&&this.fire(new a.k(new Error(`Source layer "${p}" does not exist on source "${g.id}" as specified by style layer "${s.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const s in this.sourceCaches)if(!this.sourceCaches[s].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(s,h=!1){const p=this._serializedAllLayers();if(!s||s.length===0)return Object.values(h?a.bK(p):p);const g=[];for(const y of s)if(p[y]){const w=h?a.bK(p[y]):p[y];g.push(w)}return g}_serializedAllLayers(){let s=this._serializedLayers;if(s)return s;s=this._serializedLayers={};const h=Object.keys(this._layers);for(const p of h){const g=this._layers[p];g.type!=="custom"&&(s[p]=g.serialize())}return s}hasTransitions(){var s,h,p;if(!((s=this.light)===null||s===void 0)&&s.hasTransition()||!((h=this.sky)===null||h===void 0)&&h.hasTransition()||!((p=this.projection)===null||p===void 0)&&p.hasTransition())return!0;for(const g in this.sourceCaches)if(this.sourceCaches[g].hasTransition())return!0;for(const g in this._layers)if(this._layers[g].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(s){if(!this._loaded)return;const h=this._changed;if(h){const g=Object.keys(this._updatedLayers),y=Object.keys(this._removedLayers);(g.length||y.length)&&this._updateWorkerLayers(g,y);for(const w in this._updatedSources){const S=this._updatedSources[w];if(S==="reload")this._reloadSource(w);else{if(S!=="clear")throw new Error(`Invalid action ${S}`);this._clearSource(w)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const w in this._updatedPaintProps)this._layers[w].updateTransitions(s);this.light.updateTransitions(s),this.sky.updateTransitions(s),this._resetUpdates()}const p={};for(const g in this.sourceCaches){const y=this.sourceCaches[g];p[g]=y.used,y.used=!1}for(const g of this._order){const y=this._layers[g];y.recalculate(s,this._availableImages),!y.isHidden(s.zoom)&&y.source&&(this.sourceCaches[y.source].used=!0)}for(const g in p){const y=this.sourceCaches[g];!!p[g]!=!!y.used&&y.fire(new a.l("data",{sourceDataType:"visibility",dataType:"source",sourceId:g}))}this.light.recalculate(s),this.sky.recalculate(s),this.projection.recalculate(s),this.z=s.zoom,h&&this.fire(new a.l("data",{dataType:"style"}))}_updateTilesForChangedImages(){const s=Object.keys(this._changedImages);if(s.length){for(const h in this.sourceCaches)this.sourceCaches[h].reloadTilesForDependencies(["icons","patterns"],s);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const s in this.sourceCaches)this.sourceCaches[s].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(s,h){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(s,!1),removedIds:h})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(s,h={}){var p;this._checkLoaded();const g=this.serialize();if(s=h.transformStyle?h.transformStyle(g,s):s,((p=h.validate)===null||p===void 0||p)&&Oc(this,a.z(s)))return!1;(s=a.bK(s)).layers=a.bI(s.layers);const y=a.bL(g,s),w=this._getOperationsToPerform(y);if(w.unimplemented.length>0)throw new Error(`Unimplemented: ${w.unimplemented.join(", ")}.`);if(w.operations.length===0)return!1;for(const S of w.operations)S();return this.stylesheet=s,this._serializedLayers=null,!0}_getOperationsToPerform(s){const h=[],p=[];for(const g of s)switch(g.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":h.push(()=>this.addLayer.apply(this,g.args));break;case"removeLayer":h.push(()=>this.removeLayer.apply(this,g.args));break;case"setPaintProperty":h.push(()=>this.setPaintProperty.apply(this,g.args));break;case"setLayoutProperty":h.push(()=>this.setLayoutProperty.apply(this,g.args));break;case"setFilter":h.push(()=>this.setFilter.apply(this,g.args));break;case"addSource":h.push(()=>this.addSource.apply(this,g.args));break;case"removeSource":h.push(()=>this.removeSource.apply(this,g.args));break;case"setLayerZoomRange":h.push(()=>this.setLayerZoomRange.apply(this,g.args));break;case"setLight":h.push(()=>this.setLight.apply(this,g.args));break;case"setGeoJSONSourceData":h.push(()=>this.setGeoJSONSourceData.apply(this,g.args));break;case"setGlyphs":h.push(()=>this.setGlyphs.apply(this,g.args));break;case"setSprite":h.push(()=>this.setSprite.apply(this,g.args));break;case"setTerrain":h.push(()=>this.map.setTerrain.apply(this,g.args));break;case"setSky":h.push(()=>this.setSky.apply(this,g.args));break;case"setProjection":this.setProjection.apply(this,g.args);break;case"setGlobalState":h.push(()=>this.setGlobalState.apply(this,g.args));break;case"setTransition":h.push(()=>{});break;default:p.push(g.command)}return{operations:h,unimplemented:p}}addImage(s,h){if(this.getImage(s))return this.fire(new a.k(new Error(`An image named "${s}" already exists.`)));this.imageManager.addImage(s,h),this._afterImageUpdated(s)}updateImage(s,h){this.imageManager.updateImage(s,h)}getImage(s){return this.imageManager.getImage(s)}removeImage(s){if(!this.getImage(s))return this.fire(new a.k(new Error(`An image named "${s}" does not exist.`)));this.imageManager.removeImage(s),this._afterImageUpdated(s)}_afterImageUpdated(s){this._availableImages=this.imageManager.listImages(),this._changedImages[s]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.l("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(s,h,p={}){if(this._checkLoaded(),this.sourceCaches[s]!==void 0)throw new Error(`Source "${s}" already exists.`);if(!h.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(h).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(h.type)>=0&&this._validate(a.z.source,`sources.${s}`,h,null,p))return;this.map&&this.map._collectResourceTiming&&(h.collectResourceTiming=!0);const g=this.sourceCaches[s]=new Ft(s,h,this.dispatcher);g.style=this,g.setEventedParent(this,()=>({isSourceLoaded:g.loaded(),source:g.serialize(),sourceId:s})),g.onAdd(this.map),this._changed=!0}removeSource(s){if(this._checkLoaded(),this.sourceCaches[s]===void 0)throw new Error("There is no source with this ID");for(const p in this._layers)if(this._layers[p].source===s)return this.fire(new a.k(new Error(`Source "${s}" cannot be removed while layer "${p}" is using it.`)));const h=this.sourceCaches[s];delete this.sourceCaches[s],delete this._updatedSources[s],h.fire(new a.l("data",{sourceDataType:"metadata",dataType:"source",sourceId:s})),h.setEventedParent(null),h.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(s,h){if(this._checkLoaded(),this.sourceCaches[s]===void 0)throw new Error(`There is no source with this ID=${s}`);const p=this.sourceCaches[s].getSource();if(p.type!=="geojson")throw new Error(`geojsonSource.type is ${p.type}, which is !== 'geojson`);p.setData(h),this._changed=!0}getSource(s){return this.sourceCaches[s]&&this.sourceCaches[s].getSource()}addLayer(s,h,p={}){this._checkLoaded();const g=s.id;if(this.getLayer(g))return void this.fire(new a.k(new Error(`Layer "${g}" already exists on this map.`)));let y;if(s.type==="custom"){if(Oc(this,a.bM(s)))return;y=a.bJ(s)}else{if("source"in s&&typeof s.source=="object"&&(this.addSource(g,s.source),s=a.bK(s),s=a.e(s,{source:g})),this._validate(a.z.layer,`layers.${g}`,s,{arrayIndex:-1},p))return;y=a.bJ(s),this._validateLayer(y),y.setEventedParent(this,{layer:{id:g}})}const w=h?this._order.indexOf(h):this._order.length;if(h&&w===-1)this.fire(new a.k(new Error(`Cannot add layer "${g}" before non-existing layer "${h}".`)));else{if(this._order.splice(w,0,g),this._layerOrderChanged=!0,this._layers[g]=y,this._removedLayers[g]&&y.source&&y.type!=="custom"){const S=this._removedLayers[g];delete this._removedLayers[g],S.type!==y.type?this._updatedSources[y.source]="clear":(this._updatedSources[y.source]="reload",this.sourceCaches[y.source].pause())}this._updateLayer(y),y.onAdd&&y.onAdd(this.map)}}moveLayer(s,h){if(this._checkLoaded(),this._changed=!0,!this._layers[s])return void this.fire(new a.k(new Error(`The layer '${s}' does not exist in the map's style and cannot be moved.`)));if(s===h)return;const p=this._order.indexOf(s);this._order.splice(p,1);const g=h?this._order.indexOf(h):this._order.length;h&&g===-1?this.fire(new a.k(new Error(`Cannot move layer "${s}" before non-existing layer "${h}".`))):(this._order.splice(g,0,s),this._layerOrderChanged=!0)}removeLayer(s){this._checkLoaded();const h=this._layers[s];if(!h)return void this.fire(new a.k(new Error(`Cannot remove non-existing layer "${s}".`)));h.setEventedParent(null);const p=this._order.indexOf(s);this._order.splice(p,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[s]=h,delete this._layers[s],this._serializedLayers&&delete this._serializedLayers[s],delete this._updatedLayers[s],delete this._updatedPaintProps[s],h.onRemove&&h.onRemove(this.map)}getLayer(s){return this._layers[s]}getLayersOrder(){return[...this._order]}hasLayer(s){return s in this._layers}setLayerZoomRange(s,h,p){this._checkLoaded();const g=this.getLayer(s);g?g.minzoom===h&&g.maxzoom===p||(h!=null&&(g.minzoom=h),p!=null&&(g.maxzoom=p),this._updateLayer(g)):this.fire(new a.k(new Error(`Cannot set the zoom range of non-existing layer "${s}".`)))}setFilter(s,h,p={}){this._checkLoaded();const g=this.getLayer(s);if(g){if(!a.bH(g.filter,h))return h==null?(g.setFilter(void 0),void this._updateLayer(g)):void(this._validate(a.z.filter,`layers.${g.id}.filter`,h,null,p)||(g.setFilter(a.bK(h)),this._updateLayer(g)))}else this.fire(new a.k(new Error(`Cannot filter non-existing layer "${s}".`)))}getFilter(s){return a.bK(this.getLayer(s).filter)}setLayoutProperty(s,h,p,g={}){this._checkLoaded();const y=this.getLayer(s);y?a.bH(y.getLayoutProperty(h),p)||(y.setLayoutProperty(h,p,g),this._updateLayer(y)):this.fire(new a.k(new Error(`Cannot style non-existing layer "${s}".`)))}getLayoutProperty(s,h){const p=this.getLayer(s);if(p)return p.getLayoutProperty(h);this.fire(new a.k(new Error(`Cannot get style of non-existing layer "${s}".`)))}setPaintProperty(s,h,p,g={}){this._checkLoaded();const y=this.getLayer(s);y?a.bH(y.getPaintProperty(h),p)||(y.setPaintProperty(h,p,g)&&this._updateLayer(y),this._changed=!0,this._updatedPaintProps[s]=!0,this._serializedLayers=null):this.fire(new a.k(new Error(`Cannot style non-existing layer "${s}".`)))}getPaintProperty(s,h){return this.getLayer(s).getPaintProperty(h)}setFeatureState(s,h){this._checkLoaded();const p=s.source,g=s.sourceLayer,y=this.sourceCaches[p];if(y===void 0)return void this.fire(new a.k(new Error(`The source '${p}' does not exist in the map's style.`)));const w=y.getSource().type;w==="geojson"&&g?this.fire(new a.k(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):w!=="vector"||g?(s.id===void 0&&this.fire(new a.k(new Error("The feature id parameter must be provided."))),y.setFeatureState(g,s.id,h)):this.fire(new a.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(s,h){this._checkLoaded();const p=s.source,g=this.sourceCaches[p];if(g===void 0)return void this.fire(new a.k(new Error(`The source '${p}' does not exist in the map's style.`)));const y=g.getSource().type,w=y==="vector"?s.sourceLayer:void 0;y!=="vector"||w?h&&typeof s.id!="string"&&typeof s.id!="number"?this.fire(new a.k(new Error("A feature id is required to remove its specific state property."))):g.removeFeatureState(w,s.id,h):this.fire(new a.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(s){this._checkLoaded();const h=s.source,p=s.sourceLayer,g=this.sourceCaches[h];if(g!==void 0)return g.getSource().type!=="vector"||p?(s.id===void 0&&this.fire(new a.k(new Error("The feature id parameter must be provided."))),g.getFeatureState(p,s.id)):void this.fire(new a.k(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new a.k(new Error(`The source '${h}' does not exist in the map's style.`)))}getTransition(){return a.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const s=a.bN(this.sourceCaches,y=>y.serialize()),h=this._serializeByIds(this._order,!0),p=this.map.getTerrain()||void 0,g=this.stylesheet;return a.bO({version:g.version,name:g.name,metadata:g.metadata,light:g.light,sky:g.sky,center:g.center,zoom:g.zoom,bearing:g.bearing,pitch:g.pitch,sprite:g.sprite,glyphs:g.glyphs,transition:g.transition,projection:g.projection,sources:s,layers:h,terrain:p},y=>y!==void 0)}_updateLayer(s){this._updatedLayers[s.id]=!0,s.source&&!this._updatedSources[s.source]&&this.sourceCaches[s.source].getSource().type!=="raster"&&(this._updatedSources[s.source]="reload",this.sourceCaches[s.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(s){const h=w=>this._layers[w].type==="fill-extrusion",p={},g=[];for(let w=this._order.length-1;w>=0;w--){const S=this._order[w];if(h(S)){p[S]=w;for(const C of s){const R=C[S];if(R)for(const B of R)g.push(B)}}}g.sort((w,S)=>S.intersectionZ-w.intersectionZ);const y=[];for(let w=this._order.length-1;w>=0;w--){const S=this._order[w];if(h(S))for(let C=g.length-1;C>=0;C--){const R=g[C].feature;if(p[R.layer.id]<w)break;y.push(R),g.pop()}else for(const C of s){const R=C[S];if(R)for(const B of R)y.push(B.feature)}}return y}queryRenderedFeatures(s,h,p){h&&h.filter&&this._validate(a.z.filter,"queryRenderedFeatures.filter",h.filter,null,h);const g={};if(h&&h.layers){if(!(Array.isArray(h.layers)||h.layers instanceof Set))return this.fire(new a.k(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(const R of h.layers){const B=this._layers[R];if(!B)return this.fire(new a.k(new Error(`The layer '${R}' does not exist in the map's style and cannot be queried for features.`))),[];g[B.source]=!0}}const y=[];h.availableImages=this._availableImages;const w=this._serializedAllLayers(),S=h.layers instanceof Set?h.layers:Array.isArray(h.layers)?new Set(h.layers):null,C=Object.assign(Object.assign({},h),{layers:S});for(const R in this.sourceCaches)h.layers&&!g[R]||y.push(Zt(this.sourceCaches[R],this._layers,w,s,C,p,this.map.terrain?(B,k,F)=>this.map.terrain.getElevation(B,k,F):void 0));return this.placement&&y.push(function(R,B,k,F,V,G,J){const Y={},Q=G.queryRenderedSymbols(F),se=[];for(const ce of Object.keys(Q).map(Number))se.push(J[ce]);se.sort(ki);for(const ce of se){const ae=ce.featureIndex.lookupSymbolFeatures(Q[ce.bucketInstanceId],B,ce.bucketIndex,ce.sourceLayerIndex,V.filter,V.layers,V.availableImages,R);for(const ue in ae){const _e=Y[ue]=Y[ue]||[],le=ae[ue];le.sort((ve,ke)=>{const Me=ce.featureSortOrder;if(Me){const Pe=Me.indexOf(ve.featureIndex);return Me.indexOf(ke.featureIndex)-Pe}return ke.featureIndex-ve.featureIndex});for(const ve of le)_e.push(ve)}}return function(ce,ae,ue){for(const _e in ce)for(const le of ce[_e])Rs(le,ue[ae[_e].source]);return ce}(Y,R,k)}(this._layers,w,this.sourceCaches,s,C,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(y)}querySourceFeatures(s,h){h&&h.filter&&this._validate(a.z.filter,"querySourceFeatures.filter",h.filter,null,h);const p=this.sourceCaches[s];return p?function(g,y){const w=g.getRenderableIds().map(R=>g.getTileByID(R)),S=[],C={};for(let R=0;R<w.length;R++){const B=w[R],k=B.tileID.canonical.key;C[k]||(C[k]=!0,B.querySourceFeatures(S,y))}return S}(p,h):[]}getLight(){return this.light.getLight()}setLight(s,h={}){this._checkLoaded();const p=this.light.getLight();let g=!1;for(const w in s)if(!a.bH(s[w],p[w])){g=!0;break}if(!g)return;const y={now:N.now(),transition:a.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(s,h),this.light.updateTransitions(y)}getProjection(){var s;return(s=this.stylesheet)===null||s===void 0?void 0:s.projection}setProjection(s){if(this._checkLoaded(),this.projection){if(this.projection.name===s.type)return;this.projection.destroy(),delete this.projection}this.stylesheet.projection=s,this._setProjectionInternal(s.type)}getSky(){var s;return(s=this.stylesheet)===null||s===void 0?void 0:s.sky}setSky(s,h={}){this._checkLoaded();const p=this.getSky();let g=!1;if(!s&&!p)return;if(s&&!p)g=!0;else if(!s&&p)g=!0;else for(const w in s)if(!a.bH(s[w],p[w])){g=!0;break}if(!g)return;const y={now:N.now(),transition:a.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=s,this.sky.setSky(s,h),this.sky.updateTransitions(y)}_setProjectionInternal(s){const h=function(p){if(Array.isArray(p)){const g=new Bc({type:p});return{projection:g,transform:new pl,cameraHelper:new pp(g)}}switch(p){case"mercator":return{projection:new yt,transform:new ai,cameraHelper:new Rr};case"globe":{const g=new Bc({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:g,transform:new pl,cameraHelper:new pp(g)}}case"vertical-perspective":return{projection:new ll,transform:new fl,cameraHelper:new Pr};default:return a.w(`Unknown projection name: ${p}. Falling back to mercator projection.`),{projection:new yt,transform:new ai,cameraHelper:new Rr}}}(s);this.projection=h.projection,this.map.migrateProjection(h.transform,h.cameraHelper);for(const p in this.sourceCaches)this.sourceCaches[p].reload()}_validate(s,h,p,g,y={}){return(!y||y.validate!==!1)&&Oc(this,s.call(a.z,a.e({key:h,style:this.serialize(),value:p,styleSpec:a.v},g)))}_remove(s=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),Bs().off(Mn,this._rtlPluginLoaded);for(const h in this._layers)this._layers[h].setEventedParent(null);for(const h in this.sourceCaches){const p=this.sourceCaches[h];p.setEventedParent(null),p.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),s&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(s)}_clearSource(s){this.sourceCaches[s].clearTiles()}_reloadSource(s){this.sourceCaches[s].resume(),this.sourceCaches[s].reload()}_updateSources(s){for(const h in this.sourceCaches)this.sourceCaches[h].update(s,this.map.terrain)}_generateCollisionBoxes(){for(const s in this.sourceCaches)this._reloadSource(s)}_updatePlacement(s,h,p,g,y=!1){let w=!1,S=!1;const C={};for(const R of this._order){const B=this._layers[R];if(B.type!=="symbol")continue;if(!C[B.source]){const F=this.sourceCaches[B.source];C[B.source]=F.getRenderableIds(!0).map(V=>F.getTileByID(V)).sort((V,G)=>G.tileID.overscaledZ-V.tileID.overscaledZ||(V.tileID.isLessThan(G.tileID)?-1:1))}const k=this.crossTileSymbolIndex.addLayer(B,C[B.source],s.center.lng);w=w||k}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((y=y||this._layerOrderChanged||p===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(N.now(),s.zoom))&&(this.pauseablePlacement=new ha(s,this.map.terrain,this._order,y,h,p,g,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,C),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(N.now()),S=!0),w&&this.pauseablePlacement.placement.setStale()),S||w)for(const R of this._order){const B=this._layers[R];B.type==="symbol"&&this.placement.updateLayerOpacities(B,C[B.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(N.now())}_releaseSymbolFadeTiles(){for(const s in this.sourceCaches)this.sourceCaches[s].releaseSymbolFadeTiles()}getImages(s,h){return a._(this,void 0,void 0,function*(){const p=yield this.imageManager.getImages(h.icons);this._updateTilesForChangedImages();const g=this.sourceCaches[h.source];return g&&g.setDependencies(h.tileID.key,h.type,h.icons),p})}getGlyphs(s,h){return a._(this,void 0,void 0,function*(){const p=yield this.glyphManager.getGlyphs(h.stacks),g=this.sourceCaches[h.source];return g&&g.setDependencies(h.tileID.key,h.type,[""]),p})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(s,h={}){this._checkLoaded(),s&&this._validate(a.z.glyphs,"glyphs",s,null,h)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=s,this.glyphManager.entries={},this.glyphManager.setURL(s))}addSprite(s,h,p={},g){this._checkLoaded();const y=[{id:s,url:h}],w=[...qe(this.stylesheet.sprite),...y];this._validate(a.z.sprite,"sprite",w,null,p)||(this.stylesheet.sprite=w,this._loadSprite(y,!0,g))}removeSprite(s){this._checkLoaded();const h=qe(this.stylesheet.sprite);if(h.find(p=>p.id===s)){if(this._spritesImagesIds[s])for(const p of this._spritesImagesIds[s])this.imageManager.removeImage(p),this._changedImages[p]=!0;h.splice(h.findIndex(p=>p.id===s),1),this.stylesheet.sprite=h.length>0?h:void 0,delete this._spritesImagesIds[s],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.l("data",{dataType:"style"}))}else this.fire(new a.k(new Error(`Sprite "${s}" doesn't exists on this map.`)))}getSprite(){return qe(this.stylesheet.sprite)}setSprite(s,h={},p){this._checkLoaded(),s&&this._validate(a.z.sprite,"sprite",s,null,h)||(this.stylesheet.sprite=s,s?this._loadSprite(s,!0,p):(this._unloadSprite(),p&&p(null)))}}var Ay=a.aJ([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Ey{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(s,h,p,g,y,w,S,C,R){this.context=s;let B=this.boundPaintVertexBuffers.length!==g.length;for(let k=0;!B&&k<g.length;k++)this.boundPaintVertexBuffers[k]!==g[k]&&(B=!0);!this.vao||this.boundProgram!==h||this.boundLayoutVertexBuffer!==p||B||this.boundIndexBuffer!==y||this.boundVertexOffset!==w||this.boundDynamicVertexBuffer!==S||this.boundDynamicVertexBuffer2!==C||this.boundDynamicVertexBuffer3!==R?this.freshBind(h,p,g,y,w,S,C,R):(s.bindVertexArray.set(this.vao),S&&S.bind(),y&&y.dynamicDraw&&y.bind(),C&&C.bind(),R&&R.bind())}freshBind(s,h,p,g,y,w,S,C){const R=s.numAttributes,B=this.context,k=B.gl;this.vao&&this.destroy(),this.vao=B.createVertexArray(),B.bindVertexArray.set(this.vao),this.boundProgram=s,this.boundLayoutVertexBuffer=h,this.boundPaintVertexBuffers=p,this.boundIndexBuffer=g,this.boundVertexOffset=y,this.boundDynamicVertexBuffer=w,this.boundDynamicVertexBuffer2=S,this.boundDynamicVertexBuffer3=C,h.enableAttributes(k,s);for(const F of p)F.enableAttributes(k,s);w&&w.enableAttributes(k,s),S&&S.enableAttributes(k,s),C&&C.enableAttributes(k,s),h.bind(),h.setVertexAttribPointers(k,s,y);for(const F of p)F.bind(),F.setVertexAttribPointers(k,s,y);w&&(w.bind(),w.setVertexAttribPointers(k,s,y)),g&&g.bind(),S&&(S.bind(),S.setVertexAttribPointers(k,s,y)),C&&(C.bind(),C.setVertexAttribPointers(k,s,y)),B.currentNumAttributes=R}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const Fc=(m,s,h,p,g)=>({u_texture:0,u_ele_delta:m,u_fog_matrix:s,u_fog_color:h?h.properties.get("fog-color"):a.bf.white,u_fog_ground_blend:h?h.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:g?0:h?h.calculateFogBlendOpacity(p):0,u_horizon_color:h?h.properties.get("horizon-color"):a.bf.white,u_horizon_fog_blend:h?h.properties.get("horizon-fog-blend"):1,u_is_globe_mode:g?1:0}),Au={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function Io(m){const s=[];for(let h=0;h<m.length;h++){if(m[h]===null)continue;const p=m[h].split(" ");s.push(p.pop())}return s}class Eu{constructor(s,h,p,g,y,w,S,C,R=[]){const B=s.gl;this.program=B.createProgram();const k=Io(h.staticAttributes),F=p?p.getBinderAttributes():[],V=k.concat(F),G=de.prelude.staticUniforms?Io(de.prelude.staticUniforms):[],J=S.staticUniforms?Io(S.staticUniforms):[],Y=h.staticUniforms?Io(h.staticUniforms):[],Q=p?p.getBinderUniforms():[],se=G.concat(J).concat(Y).concat(Q),ce=[];for(const Me of se)ce.indexOf(Me)<0&&ce.push(Me);const ae=p?p.defines():[];dn(B)&&ae.unshift("#version 300 es"),y&&ae.push("#define OVERDRAW_INSPECTOR;"),w&&ae.push("#define TERRAIN3D;"),C&&ae.push(C),R&&ae.push(...R);let ue=ae.concat(de.prelude.fragmentSource,S.fragmentSource,h.fragmentSource).join(`
`),_e=ae.concat(de.prelude.vertexSource,S.vertexSource,h.vertexSource).join(`
`);dn(B)||(ue=function(Me){return Me.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D(")}(ue),_e=function(Me){return Me.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")}(_e));const le=B.createShader(B.FRAGMENT_SHADER);if(B.isContextLost())return void(this.failedToCreate=!0);if(B.shaderSource(le,ue),B.compileShader(le),!B.getShaderParameter(le,B.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${B.getShaderInfoLog(le)}`);B.attachShader(this.program,le);const ve=B.createShader(B.VERTEX_SHADER);if(B.isContextLost())return void(this.failedToCreate=!0);if(B.shaderSource(ve,_e),B.compileShader(ve),!B.getShaderParameter(ve,B.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${B.getShaderInfoLog(ve)}`);B.attachShader(this.program,ve),this.attributes={};const ke={};this.numAttributes=V.length;for(let Me=0;Me<this.numAttributes;Me++)V[Me]&&(B.bindAttribLocation(this.program,Me,V[Me]),this.attributes[V[Me]]=Me);if(B.linkProgram(this.program),!B.getProgramParameter(this.program,B.LINK_STATUS))throw new Error(`Program failed to link: ${B.getProgramInfoLog(this.program)}`);B.deleteShader(ve),B.deleteShader(le);for(let Me=0;Me<ce.length;Me++){const Pe=ce[Me];if(Pe&&!ke[Pe]){const Fe=B.getUniformLocation(this.program,Pe);Fe&&(ke[Pe]=Fe)}}this.fixedUniforms=g(s,ke),this.terrainUniforms=((Me,Pe)=>({u_depth:new a.bP(Me,Pe.u_depth),u_terrain:new a.bP(Me,Pe.u_terrain),u_terrain_dim:new a.bg(Me,Pe.u_terrain_dim),u_terrain_matrix:new a.bR(Me,Pe.u_terrain_matrix),u_terrain_unpack:new a.bS(Me,Pe.u_terrain_unpack),u_terrain_exaggeration:new a.bg(Me,Pe.u_terrain_exaggeration)}))(s,ke),this.projectionUniforms=((Me,Pe)=>({u_projection_matrix:new a.bR(Me,Pe.u_projection_matrix),u_projection_tile_mercator_coords:new a.bS(Me,Pe.u_projection_tile_mercator_coords),u_projection_clipping_plane:new a.bS(Me,Pe.u_projection_clipping_plane),u_projection_transition:new a.bg(Me,Pe.u_projection_transition),u_projection_fallback_matrix:new a.bR(Me,Pe.u_projection_fallback_matrix)}))(s,ke),this.binderUniforms=p?p.getUniforms(s,ke):[]}draw(s,h,p,g,y,w,S,C,R,B,k,F,V,G,J,Y,Q,se,ce){const ae=s.gl;if(this.failedToCreate)return;if(s.program.set(this.program),s.setDepthMode(p),s.setStencilMode(g),s.setColorMode(y),s.setCullFace(w),C){s.activeTexture.set(ae.TEXTURE2),ae.bindTexture(ae.TEXTURE_2D,C.depthTexture),s.activeTexture.set(ae.TEXTURE3),ae.bindTexture(ae.TEXTURE_2D,C.texture);for(const _e in this.terrainUniforms)this.terrainUniforms[_e].set(C[_e])}if(R)for(const _e in R)this.projectionUniforms[Au[_e]].set(R[_e]);if(S)for(const _e in this.fixedUniforms)this.fixedUniforms[_e].set(S[_e]);Y&&Y.setUniforms(s,this.binderUniforms,G,{zoom:J});let ue=0;switch(h){case ae.LINES:ue=2;break;case ae.TRIANGLES:ue=3;break;case ae.LINE_STRIP:ue=1}for(const _e of V.get()){const le=_e.vaos||(_e.vaos={});(le[B]||(le[B]=new Ey)).bind(s,this,k,Y?Y.getPaintVertexBuffers():[],F,_e.vertexOffset,Q,se,ce),ae.drawElements(h,_e.primitiveLength*ue,ae.UNSIGNED_SHORT,_e.primitiveOffset*ue*2)}}}function kc(m,s,h){const p=1/a.aC(h,1,s.transform.tileZoom),g=Math.pow(2,h.tileID.overscaledZ),y=h.tileSize*Math.pow(2,s.transform.tileZoom)/g,w=y*(h.tileID.canonical.x+h.tileID.wrap*g),S=y*h.tileID.canonical.y;return{u_image:0,u_texsize:h.imageAtlasTexture.size,u_scale:[p,m.fromScale,m.toScale],u_fade:m.t,u_pixel_coord_upper:[w>>16,S>>16],u_pixel_coord_lower:[65535&w,65535&S]}}const Us=(m,s,h,p)=>{const g=m.style.light,y=g.properties.get("position"),w=[y.x,y.y,y.z],S=a.bV();g.properties.get("anchor")==="viewport"&&a.bW(S,m.transform.bearingInRadians),a.bX(w,w,S);const C=m.transform.transformLightDirection(w),R=g.properties.get("color");return{u_lightpos:w,u_lightpos_globe:C,u_lightintensity:g.properties.get("intensity"),u_lightcolor:[R.r,R.g,R.b],u_vertical_gradient:+s,u_opacity:h,u_fill_translate:p}},Sy=(m,s,h,p,g,y,w)=>a.e(Us(m,s,h,p),kc(y,m,w),{u_height_factor:-Math.pow(2,g.overscaledZ)/w.tileSize/8}),Nc=(m,s,h,p)=>a.e(kc(s,m,h),{u_fill_translate:p}),_l=(m,s)=>({u_world:m,u_fill_translate:s}),gl=(m,s,h,p,g)=>a.e(Nc(m,s,h,g),{u_world:p}),Cy=(m,s,h,p,g)=>{const y=m.transform;let w,S,C=0;if(h.paint.get("circle-pitch-alignment")==="map"){const R=a.aC(s,1,y.zoom);w=!0,S=[R,R],C=R/(a.$*Math.pow(2,s.tileID.overscaledZ))*2*Math.PI*g}else w=!1,S=y.pixelsToGLUnits;return{u_camera_to_center_distance:y.cameraToCenterDistance,u_scale_with_map:+(h.paint.get("circle-pitch-scale")==="map"),u_pitch_with_map:+w,u_device_pixel_ratio:m.pixelRatio,u_extrude_scale:S,u_globe_extrude_scale:C,u_translate:p}},Lc=m=>({u_pixel_extrude_scale:[1/m.width,1/m.height]}),Iy=m=>({u_viewport_size:[m.width,m.height]}),Mo=(m,s=1)=>({u_color:m,u_overlay:0,u_overlay_scale:s}),_p=(m,s,h,p)=>{const g=a.aC(m,1,s)/(a.$*Math.pow(2,m.tileID.overscaledZ))*2*Math.PI*p;return{u_extrude_scale:a.aC(m,1,s),u_intensity:h,u_globe_extrude_scale:g}},Su=(m,s,h,p)=>{const g=a.L();a.bY(g,0,m.width,m.height,0,0,1);const y=m.context.gl;return{u_matrix:g,u_world:[y.drawingBufferWidth,y.drawingBufferHeight],u_image:h,u_color_ramp:p,u_opacity:s.paint.get("heatmap-opacity")}},My=(m,s,h)=>{const p=h.paint.get("hillshade-accent-color");let g;switch(h.paint.get("hillshade-method")){case"basic":g=4;break;case"combined":g=1;break;case"igor":g=2;break;case"multidirectional":g=3;break;default:g=0}const y=h.getIlluminationProperties();for(let w=0;w<y.directionRadians.length;w++)h.paint.get("hillshade-illumination-anchor")==="viewport"&&(y.directionRadians[w]+=m.transform.bearingInRadians);return{u_image:0,u_latrange:Cu(0,s.tileID),u_exaggeration:h.paint.get("hillshade-exaggeration"),u_altitudes:y.altitudeRadians,u_azimuths:y.directionRadians,u_accent:p,u_method:g,u_highlights:y.highlightColor,u_shadows:y.shadowColor}},gp=(m,s)=>{const h=s.stride,p=a.L();return a.bY(p,0,a.$,-a.$,0,0,1),a.M(p,p,[0,-a.$,0]),{u_matrix:p,u_image:1,u_dimension:[h,h],u_zoom:m.overscaledZ,u_unpack:s.getUnpackVector()}};function Cu(m,s){const h=Math.pow(2,s.canonical.z),p=s.canonical.y;return[new a.a1(0,p/h).toLngLat().lat,new a.a1(0,(p+1)/h).toLngLat().lat]}const mp=(m,s,h=0)=>({u_image:0,u_unpack:s.getUnpackVector(),u_dimension:[s.stride,s.stride],u_elevation_stops:1,u_color_stops:4,u_color_ramp_size:h,u_opacity:m.paint.get("color-relief-opacity")}),Uc=(m,s,h,p)=>{const g=m.transform;return{u_translation:Mu(m,s,h),u_ratio:p/a.aC(s,1,g.zoom),u_device_pixel_ratio:m.pixelRatio,u_units_to_pixels:[1/g.pixelsToGLUnits[0],1/g.pixelsToGLUnits[1]]}},yp=(m,s,h,p,g)=>a.e(Uc(m,s,h,p),{u_image:0,u_image_height:g}),bp=(m,s,h,p,g)=>{const y=m.transform,w=Iu(s,y);return{u_translation:Mu(m,s,h),u_texsize:s.imageAtlasTexture.size,u_ratio:p/a.aC(s,1,y.zoom),u_device_pixel_ratio:m.pixelRatio,u_image:0,u_scale:[w,g.fromScale,g.toScale],u_fade:g.t,u_units_to_pixels:[1/y.pixelsToGLUnits[0],1/y.pixelsToGLUnits[1]]}},Ro=(m,s,h,p,g,y)=>{const w=m.lineAtlas,S=Iu(s,m.transform),C=h.layout.get("line-cap")==="round",R=w.getDash(g.from,C),B=w.getDash(g.to,C),k=R.width*y.fromScale,F=B.width*y.toScale;return a.e(Uc(m,s,h,p),{u_patternscale_a:[S/k,-R.height/2],u_patternscale_b:[S/F,-B.height/2],u_sdfgamma:w.width/(256*Math.min(k,F)*m.pixelRatio)/2,u_image:0,u_tex_y_a:R.y,u_tex_y_b:B.y,u_mix:y.t})};function Iu(m,s){return 1/a.aC(m,1,s.tileZoom)}function Mu(m,s,h){return a.aD(m.transform,s,h.paint.get("line-translate"),h.paint.get("line-translate-anchor"))}const ml=(m,s,h,p,g)=>{return{u_tl_parent:m,u_scale_parent:s,u_buffer_scale:1,u_fade_t:h.mix,u_opacity:h.opacity*p.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:p.paint.get("raster-brightness-min"),u_brightness_high:p.paint.get("raster-brightness-max"),u_saturation_factor:(w=p.paint.get("raster-saturation"),w>0?1-1/(1.001-w):-w),u_contrast_factor:(y=p.paint.get("raster-contrast"),y>0?1/(1-y):1+y),u_spin_weights:Ry(p.paint.get("raster-hue-rotate")),u_coords_top:[g[0].x,g[0].y,g[1].x,g[1].y],u_coords_bottom:[g[3].x,g[3].y,g[2].x,g[2].y]};var y,w};function Ry(m){m*=Math.PI/180;const s=Math.sin(m),h=Math.cos(m);return[(2*h+1)/3,(-Math.sqrt(3)*s-h+1)/3,(Math.sqrt(3)*s-h+1)/3]}const yl=(m,s,h,p,g,y,w,S,C,R,B,k,F)=>{const V=w.transform;return{u_is_size_zoom_constant:+(m==="constant"||m==="source"),u_is_size_feature_constant:+(m==="constant"||m==="camera"),u_size_t:s?s.uSizeT:0,u_size:s?s.uSize:0,u_camera_to_center_distance:V.cameraToCenterDistance,u_pitch:V.pitch/360*2*Math.PI,u_rotate_symbol:+h,u_aspect_ratio:V.width/V.height,u_fade_change:w.options.fadeDuration?w.symbolFadeChange:1,u_label_plane_matrix:S,u_coord_matrix:C,u_is_text:+B,u_pitch_with_map:+p,u_is_along_line:g,u_is_variable_anchor:y,u_texsize:k,u_texture:0,u_translation:R,u_pitched_scale:F}},vp=(m,s,h,p,g,y,w,S,C,R,B,k,F,V)=>{const G=w.transform;return a.e(yl(m,s,h,p,g,y,w,S,C,R,B,k,V),{u_gamma_scale:p?Math.cos(G.pitch*Math.PI/180)*G.cameraToCenterDistance:1,u_device_pixel_ratio:w.pixelRatio,u_is_halo:1})},Py=(m,s,h,p,g,y,w,S,C,R,B,k,F)=>a.e(vp(m,s,h,p,g,y,w,S,C,R,!0,B,0,F),{u_texsize_icon:k,u_texture_icon:1}),xp=(m,s)=>({u_opacity:m,u_color:s}),wp=(m,s,h,p,g)=>a.e(function(y,w,S,C){const R=S.imageManager.getPattern(y.from.toString()),B=S.imageManager.getPattern(y.to.toString()),{width:k,height:F}=S.imageManager.getPixelSize(),V=Math.pow(2,C.tileID.overscaledZ),G=C.tileSize*Math.pow(2,S.transform.tileZoom)/V,J=G*(C.tileID.canonical.x+C.tileID.wrap*V),Y=G*C.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:R.tl,u_pattern_br_a:R.br,u_pattern_tl_b:B.tl,u_pattern_br_b:B.br,u_texsize:[k,F],u_mix:w.t,u_pattern_size_a:R.displaySize,u_pattern_size_b:B.displaySize,u_scale_a:w.fromScale,u_scale_b:w.toScale,u_tile_units_to_pixels:1/a.aC(C,1,S.transform.tileZoom),u_pixel_coord_upper:[J>>16,Y>>16],u_pixel_coord_lower:[65535&J,65535&Y]}}(h,g,s,p),{u_opacity:m}),Ru=(m,s)=>{},Pu={fillExtrusion:(m,s)=>({u_lightpos:new a.bT(m,s.u_lightpos),u_lightpos_globe:new a.bT(m,s.u_lightpos_globe),u_lightintensity:new a.bg(m,s.u_lightintensity),u_lightcolor:new a.bT(m,s.u_lightcolor),u_vertical_gradient:new a.bg(m,s.u_vertical_gradient),u_opacity:new a.bg(m,s.u_opacity),u_fill_translate:new a.bU(m,s.u_fill_translate)}),fillExtrusionPattern:(m,s)=>({u_lightpos:new a.bT(m,s.u_lightpos),u_lightpos_globe:new a.bT(m,s.u_lightpos_globe),u_lightintensity:new a.bg(m,s.u_lightintensity),u_lightcolor:new a.bT(m,s.u_lightcolor),u_vertical_gradient:new a.bg(m,s.u_vertical_gradient),u_height_factor:new a.bg(m,s.u_height_factor),u_opacity:new a.bg(m,s.u_opacity),u_fill_translate:new a.bU(m,s.u_fill_translate),u_image:new a.bP(m,s.u_image),u_texsize:new a.bU(m,s.u_texsize),u_pixel_coord_upper:new a.bU(m,s.u_pixel_coord_upper),u_pixel_coord_lower:new a.bU(m,s.u_pixel_coord_lower),u_scale:new a.bT(m,s.u_scale),u_fade:new a.bg(m,s.u_fade)}),fill:(m,s)=>({u_fill_translate:new a.bU(m,s.u_fill_translate)}),fillPattern:(m,s)=>({u_image:new a.bP(m,s.u_image),u_texsize:new a.bU(m,s.u_texsize),u_pixel_coord_upper:new a.bU(m,s.u_pixel_coord_upper),u_pixel_coord_lower:new a.bU(m,s.u_pixel_coord_lower),u_scale:new a.bT(m,s.u_scale),u_fade:new a.bg(m,s.u_fade),u_fill_translate:new a.bU(m,s.u_fill_translate)}),fillOutline:(m,s)=>({u_world:new a.bU(m,s.u_world),u_fill_translate:new a.bU(m,s.u_fill_translate)}),fillOutlinePattern:(m,s)=>({u_world:new a.bU(m,s.u_world),u_image:new a.bP(m,s.u_image),u_texsize:new a.bU(m,s.u_texsize),u_pixel_coord_upper:new a.bU(m,s.u_pixel_coord_upper),u_pixel_coord_lower:new a.bU(m,s.u_pixel_coord_lower),u_scale:new a.bT(m,s.u_scale),u_fade:new a.bg(m,s.u_fade),u_fill_translate:new a.bU(m,s.u_fill_translate)}),circle:(m,s)=>({u_camera_to_center_distance:new a.bg(m,s.u_camera_to_center_distance),u_scale_with_map:new a.bP(m,s.u_scale_with_map),u_pitch_with_map:new a.bP(m,s.u_pitch_with_map),u_extrude_scale:new a.bU(m,s.u_extrude_scale),u_device_pixel_ratio:new a.bg(m,s.u_device_pixel_ratio),u_globe_extrude_scale:new a.bg(m,s.u_globe_extrude_scale),u_translate:new a.bU(m,s.u_translate)}),collisionBox:(m,s)=>({u_pixel_extrude_scale:new a.bU(m,s.u_pixel_extrude_scale)}),collisionCircle:(m,s)=>({u_viewport_size:new a.bU(m,s.u_viewport_size)}),debug:(m,s)=>({u_color:new a.bQ(m,s.u_color),u_overlay:new a.bP(m,s.u_overlay),u_overlay_scale:new a.bg(m,s.u_overlay_scale)}),depth:Ru,clippingMask:Ru,heatmap:(m,s)=>({u_extrude_scale:new a.bg(m,s.u_extrude_scale),u_intensity:new a.bg(m,s.u_intensity),u_globe_extrude_scale:new a.bg(m,s.u_globe_extrude_scale)}),heatmapTexture:(m,s)=>({u_matrix:new a.bR(m,s.u_matrix),u_world:new a.bU(m,s.u_world),u_image:new a.bP(m,s.u_image),u_color_ramp:new a.bP(m,s.u_color_ramp),u_opacity:new a.bg(m,s.u_opacity)}),hillshade:(m,s)=>({u_image:new a.bP(m,s.u_image),u_latrange:new a.bU(m,s.u_latrange),u_exaggeration:new a.bg(m,s.u_exaggeration),u_altitudes:new a.b_(m,s.u_altitudes),u_azimuths:new a.b_(m,s.u_azimuths),u_accent:new a.bQ(m,s.u_accent),u_method:new a.bP(m,s.u_method),u_shadows:new a.bZ(m,s.u_shadows),u_highlights:new a.bZ(m,s.u_highlights)}),hillshadePrepare:(m,s)=>({u_matrix:new a.bR(m,s.u_matrix),u_image:new a.bP(m,s.u_image),u_dimension:new a.bU(m,s.u_dimension),u_zoom:new a.bg(m,s.u_zoom),u_unpack:new a.bS(m,s.u_unpack)}),colorRelief:(m,s)=>({u_image:new a.bP(m,s.u_image),u_unpack:new a.bS(m,s.u_unpack),u_dimension:new a.bU(m,s.u_dimension),u_elevation_stops:new a.bP(m,s.u_elevation_stops),u_color_stops:new a.bP(m,s.u_color_stops),u_color_ramp_size:new a.bP(m,s.u_color_ramp_size),u_opacity:new a.bg(m,s.u_opacity)}),line:(m,s)=>({u_translation:new a.bU(m,s.u_translation),u_ratio:new a.bg(m,s.u_ratio),u_device_pixel_ratio:new a.bg(m,s.u_device_pixel_ratio),u_units_to_pixels:new a.bU(m,s.u_units_to_pixels)}),lineGradient:(m,s)=>({u_translation:new a.bU(m,s.u_translation),u_ratio:new a.bg(m,s.u_ratio),u_device_pixel_ratio:new a.bg(m,s.u_device_pixel_ratio),u_units_to_pixels:new a.bU(m,s.u_units_to_pixels),u_image:new a.bP(m,s.u_image),u_image_height:new a.bg(m,s.u_image_height)}),linePattern:(m,s)=>({u_translation:new a.bU(m,s.u_translation),u_texsize:new a.bU(m,s.u_texsize),u_ratio:new a.bg(m,s.u_ratio),u_device_pixel_ratio:new a.bg(m,s.u_device_pixel_ratio),u_image:new a.bP(m,s.u_image),u_units_to_pixels:new a.bU(m,s.u_units_to_pixels),u_scale:new a.bT(m,s.u_scale),u_fade:new a.bg(m,s.u_fade)}),lineSDF:(m,s)=>({u_translation:new a.bU(m,s.u_translation),u_ratio:new a.bg(m,s.u_ratio),u_device_pixel_ratio:new a.bg(m,s.u_device_pixel_ratio),u_units_to_pixels:new a.bU(m,s.u_units_to_pixels),u_patternscale_a:new a.bU(m,s.u_patternscale_a),u_patternscale_b:new a.bU(m,s.u_patternscale_b),u_sdfgamma:new a.bg(m,s.u_sdfgamma),u_image:new a.bP(m,s.u_image),u_tex_y_a:new a.bg(m,s.u_tex_y_a),u_tex_y_b:new a.bg(m,s.u_tex_y_b),u_mix:new a.bg(m,s.u_mix)}),raster:(m,s)=>({u_tl_parent:new a.bU(m,s.u_tl_parent),u_scale_parent:new a.bg(m,s.u_scale_parent),u_buffer_scale:new a.bg(m,s.u_buffer_scale),u_fade_t:new a.bg(m,s.u_fade_t),u_opacity:new a.bg(m,s.u_opacity),u_image0:new a.bP(m,s.u_image0),u_image1:new a.bP(m,s.u_image1),u_brightness_low:new a.bg(m,s.u_brightness_low),u_brightness_high:new a.bg(m,s.u_brightness_high),u_saturation_factor:new a.bg(m,s.u_saturation_factor),u_contrast_factor:new a.bg(m,s.u_contrast_factor),u_spin_weights:new a.bT(m,s.u_spin_weights),u_coords_top:new a.bS(m,s.u_coords_top),u_coords_bottom:new a.bS(m,s.u_coords_bottom)}),symbolIcon:(m,s)=>({u_is_size_zoom_constant:new a.bP(m,s.u_is_size_zoom_constant),u_is_size_feature_constant:new a.bP(m,s.u_is_size_feature_constant),u_size_t:new a.bg(m,s.u_size_t),u_size:new a.bg(m,s.u_size),u_camera_to_center_distance:new a.bg(m,s.u_camera_to_center_distance),u_pitch:new a.bg(m,s.u_pitch),u_rotate_symbol:new a.bP(m,s.u_rotate_symbol),u_aspect_ratio:new a.bg(m,s.u_aspect_ratio),u_fade_change:new a.bg(m,s.u_fade_change),u_label_plane_matrix:new a.bR(m,s.u_label_plane_matrix),u_coord_matrix:new a.bR(m,s.u_coord_matrix),u_is_text:new a.bP(m,s.u_is_text),u_pitch_with_map:new a.bP(m,s.u_pitch_with_map),u_is_along_line:new a.bP(m,s.u_is_along_line),u_is_variable_anchor:new a.bP(m,s.u_is_variable_anchor),u_texsize:new a.bU(m,s.u_texsize),u_texture:new a.bP(m,s.u_texture),u_translation:new a.bU(m,s.u_translation),u_pitched_scale:new a.bg(m,s.u_pitched_scale)}),symbolSDF:(m,s)=>({u_is_size_zoom_constant:new a.bP(m,s.u_is_size_zoom_constant),u_is_size_feature_constant:new a.bP(m,s.u_is_size_feature_constant),u_size_t:new a.bg(m,s.u_size_t),u_size:new a.bg(m,s.u_size),u_camera_to_center_distance:new a.bg(m,s.u_camera_to_center_distance),u_pitch:new a.bg(m,s.u_pitch),u_rotate_symbol:new a.bP(m,s.u_rotate_symbol),u_aspect_ratio:new a.bg(m,s.u_aspect_ratio),u_fade_change:new a.bg(m,s.u_fade_change),u_label_plane_matrix:new a.bR(m,s.u_label_plane_matrix),u_coord_matrix:new a.bR(m,s.u_coord_matrix),u_is_text:new a.bP(m,s.u_is_text),u_pitch_with_map:new a.bP(m,s.u_pitch_with_map),u_is_along_line:new a.bP(m,s.u_is_along_line),u_is_variable_anchor:new a.bP(m,s.u_is_variable_anchor),u_texsize:new a.bU(m,s.u_texsize),u_texture:new a.bP(m,s.u_texture),u_gamma_scale:new a.bg(m,s.u_gamma_scale),u_device_pixel_ratio:new a.bg(m,s.u_device_pixel_ratio),u_is_halo:new a.bP(m,s.u_is_halo),u_translation:new a.bU(m,s.u_translation),u_pitched_scale:new a.bg(m,s.u_pitched_scale)}),symbolTextAndIcon:(m,s)=>({u_is_size_zoom_constant:new a.bP(m,s.u_is_size_zoom_constant),u_is_size_feature_constant:new a.bP(m,s.u_is_size_feature_constant),u_size_t:new a.bg(m,s.u_size_t),u_size:new a.bg(m,s.u_size),u_camera_to_center_distance:new a.bg(m,s.u_camera_to_center_distance),u_pitch:new a.bg(m,s.u_pitch),u_rotate_symbol:new a.bP(m,s.u_rotate_symbol),u_aspect_ratio:new a.bg(m,s.u_aspect_ratio),u_fade_change:new a.bg(m,s.u_fade_change),u_label_plane_matrix:new a.bR(m,s.u_label_plane_matrix),u_coord_matrix:new a.bR(m,s.u_coord_matrix),u_is_text:new a.bP(m,s.u_is_text),u_pitch_with_map:new a.bP(m,s.u_pitch_with_map),u_is_along_line:new a.bP(m,s.u_is_along_line),u_is_variable_anchor:new a.bP(m,s.u_is_variable_anchor),u_texsize:new a.bU(m,s.u_texsize),u_texsize_icon:new a.bU(m,s.u_texsize_icon),u_texture:new a.bP(m,s.u_texture),u_texture_icon:new a.bP(m,s.u_texture_icon),u_gamma_scale:new a.bg(m,s.u_gamma_scale),u_device_pixel_ratio:new a.bg(m,s.u_device_pixel_ratio),u_is_halo:new a.bP(m,s.u_is_halo),u_translation:new a.bU(m,s.u_translation),u_pitched_scale:new a.bg(m,s.u_pitched_scale)}),background:(m,s)=>({u_opacity:new a.bg(m,s.u_opacity),u_color:new a.bQ(m,s.u_color)}),backgroundPattern:(m,s)=>({u_opacity:new a.bg(m,s.u_opacity),u_image:new a.bP(m,s.u_image),u_pattern_tl_a:new a.bU(m,s.u_pattern_tl_a),u_pattern_br_a:new a.bU(m,s.u_pattern_br_a),u_pattern_tl_b:new a.bU(m,s.u_pattern_tl_b),u_pattern_br_b:new a.bU(m,s.u_pattern_br_b),u_texsize:new a.bU(m,s.u_texsize),u_mix:new a.bg(m,s.u_mix),u_pattern_size_a:new a.bU(m,s.u_pattern_size_a),u_pattern_size_b:new a.bU(m,s.u_pattern_size_b),u_scale_a:new a.bg(m,s.u_scale_a),u_scale_b:new a.bg(m,s.u_scale_b),u_pixel_coord_upper:new a.bU(m,s.u_pixel_coord_upper),u_pixel_coord_lower:new a.bU(m,s.u_pixel_coord_lower),u_tile_units_to_pixels:new a.bg(m,s.u_tile_units_to_pixels)}),terrain:(m,s)=>({u_texture:new a.bP(m,s.u_texture),u_ele_delta:new a.bg(m,s.u_ele_delta),u_fog_matrix:new a.bR(m,s.u_fog_matrix),u_fog_color:new a.bQ(m,s.u_fog_color),u_fog_ground_blend:new a.bg(m,s.u_fog_ground_blend),u_fog_ground_blend_opacity:new a.bg(m,s.u_fog_ground_blend_opacity),u_horizon_color:new a.bQ(m,s.u_horizon_color),u_horizon_fog_blend:new a.bg(m,s.u_horizon_fog_blend),u_is_globe_mode:new a.bg(m,s.u_is_globe_mode)}),terrainDepth:(m,s)=>({u_ele_delta:new a.bg(m,s.u_ele_delta)}),terrainCoords:(m,s)=>({u_texture:new a.bP(m,s.u_texture),u_terrain_coords_id:new a.bg(m,s.u_terrain_coords_id),u_ele_delta:new a.bg(m,s.u_ele_delta)}),projectionErrorMeasurement:(m,s)=>({u_input:new a.bg(m,s.u_input),u_output_expected:new a.bg(m,s.u_output_expected)}),atmosphere:(m,s)=>({u_sun_pos:new a.bT(m,s.u_sun_pos),u_atmosphere_blend:new a.bg(m,s.u_atmosphere_blend),u_globe_position:new a.bT(m,s.u_globe_position),u_globe_radius:new a.bg(m,s.u_globe_radius),u_inv_proj_matrix:new a.bR(m,s.u_inv_proj_matrix)}),sky:(m,s)=>({u_sky_color:new a.bQ(m,s.u_sky_color),u_horizon_color:new a.bQ(m,s.u_horizon_color),u_horizon:new a.bU(m,s.u_horizon),u_horizon_normal:new a.bU(m,s.u_horizon_normal),u_sky_horizon_blend:new a.bg(m,s.u_sky_horizon_blend),u_sky_blend:new a.bg(m,s.u_sky_blend)})};class Tp{constructor(s,h,p){this.context=s;const g=s.gl;this.buffer=g.createBuffer(),this.dynamicDraw=!!p,this.context.unbindVAO(),s.bindElementBuffer.set(this.buffer),g.bufferData(g.ELEMENT_ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?g.DYNAMIC_DRAW:g.STATIC_DRAW),this.dynamicDraw||delete h.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(s){const h=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),h.bufferSubData(h.ELEMENT_ARRAY_BUFFER,0,s.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const zc={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Bn{constructor(s,h,p,g){this.length=h.length,this.attributes=p,this.itemSize=h.bytesPerElement,this.dynamicDraw=g,this.context=s;const y=s.gl;this.buffer=y.createBuffer(),s.bindVertexBuffer.set(this.buffer),y.bufferData(y.ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?y.DYNAMIC_DRAW:y.STATIC_DRAW),this.dynamicDraw||delete h.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(s){if(s.length!==this.length)throw new Error(`Length of new data is ${s.length}, which doesn't match current length of ${this.length}`);const h=this.context.gl;this.bind(),h.bufferSubData(h.ARRAY_BUFFER,0,s.arrayBuffer)}enableAttributes(s,h){for(let p=0;p<this.attributes.length;p++){const g=h.attributes[this.attributes[p].name];g!==void 0&&s.enableVertexAttribArray(g)}}setVertexAttribPointers(s,h,p){for(let g=0;g<this.attributes.length;g++){const y=this.attributes[g],w=h.attributes[y.name];w!==void 0&&s.vertexAttribPointer(w,y.components,s[zc[y.type]],!1,this.itemSize,y.offset+this.itemSize*(p||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Wt{constructor(s){this.gl=s.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(s){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Bu extends Wt{getDefault(){return a.bf.transparent}set(s){const h=this.current;(s.r!==h.r||s.g!==h.g||s.b!==h.b||s.a!==h.a||this.dirty)&&(this.gl.clearColor(s.r,s.g,s.b,s.a),this.current=s,this.dirty=!1)}}class Du extends Wt{getDefault(){return 1}set(s){(s!==this.current||this.dirty)&&(this.gl.clearDepth(s),this.current=s,this.dirty=!1)}}class Ap extends Wt{getDefault(){return 0}set(s){(s!==this.current||this.dirty)&&(this.gl.clearStencil(s),this.current=s,this.dirty=!1)}}class Ou extends Wt{getDefault(){return[!0,!0,!0,!0]}set(s){const h=this.current;(s[0]!==h[0]||s[1]!==h[1]||s[2]!==h[2]||s[3]!==h[3]||this.dirty)&&(this.gl.colorMask(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class Po extends Wt{getDefault(){return!0}set(s){(s!==this.current||this.dirty)&&(this.gl.depthMask(s),this.current=s,this.dirty=!1)}}class Fu extends Wt{getDefault(){return 255}set(s){(s!==this.current||this.dirty)&&(this.gl.stencilMask(s),this.current=s,this.dirty=!1)}}class By extends Wt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(s){const h=this.current;(s.func!==h.func||s.ref!==h.ref||s.mask!==h.mask||this.dirty)&&(this.gl.stencilFunc(s.func,s.ref,s.mask),this.current=s,this.dirty=!1)}}class Dy extends Wt{getDefault(){const s=this.gl;return[s.KEEP,s.KEEP,s.KEEP]}set(s){const h=this.current;(s[0]!==h[0]||s[1]!==h[1]||s[2]!==h[2]||this.dirty)&&(this.gl.stencilOp(s[0],s[1],s[2]),this.current=s,this.dirty=!1)}}class Oy extends Wt{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;s?h.enable(h.STENCIL_TEST):h.disable(h.STENCIL_TEST),this.current=s,this.dirty=!1}}class Fy extends Wt{getDefault(){return[0,1]}set(s){const h=this.current;(s[0]!==h[0]||s[1]!==h[1]||this.dirty)&&(this.gl.depthRange(s[0],s[1]),this.current=s,this.dirty=!1)}}class Ep extends Wt{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;s?h.enable(h.DEPTH_TEST):h.disable(h.DEPTH_TEST),this.current=s,this.dirty=!1}}class ky extends Wt{getDefault(){return this.gl.LESS}set(s){(s!==this.current||this.dirty)&&(this.gl.depthFunc(s),this.current=s,this.dirty=!1)}}class Sp extends Wt{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;s?h.enable(h.BLEND):h.disable(h.BLEND),this.current=s,this.dirty=!1}}class Vc extends Wt{getDefault(){const s=this.gl;return[s.ONE,s.ZERO]}set(s){const h=this.current;(s[0]!==h[0]||s[1]!==h[1]||this.dirty)&&(this.gl.blendFunc(s[0],s[1]),this.current=s,this.dirty=!1)}}class jc extends Wt{getDefault(){return a.bf.transparent}set(s){const h=this.current;(s.r!==h.r||s.g!==h.g||s.b!==h.b||s.a!==h.a||this.dirty)&&(this.gl.blendColor(s.r,s.g,s.b,s.a),this.current=s,this.dirty=!1)}}class Hc extends Wt{getDefault(){return this.gl.FUNC_ADD}set(s){(s!==this.current||this.dirty)&&(this.gl.blendEquation(s),this.current=s,this.dirty=!1)}}class ku extends Wt{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;s?h.enable(h.CULL_FACE):h.disable(h.CULL_FACE),this.current=s,this.dirty=!1}}class Bo extends Wt{getDefault(){return this.gl.BACK}set(s){(s!==this.current||this.dirty)&&(this.gl.cullFace(s),this.current=s,this.dirty=!1)}}class bl extends Wt{getDefault(){return this.gl.CCW}set(s){(s!==this.current||this.dirty)&&(this.gl.frontFace(s),this.current=s,this.dirty=!1)}}class _a extends Wt{getDefault(){return null}set(s){(s!==this.current||this.dirty)&&(this.gl.useProgram(s),this.current=s,this.dirty=!1)}}class vs extends Wt{getDefault(){return this.gl.TEXTURE0}set(s){(s!==this.current||this.dirty)&&(this.gl.activeTexture(s),this.current=s,this.dirty=!1)}}class Cp extends Wt{getDefault(){const s=this.gl;return[0,0,s.drawingBufferWidth,s.drawingBufferHeight]}set(s){const h=this.current;(s[0]!==h[0]||s[1]!==h[1]||s[2]!==h[2]||s[3]!==h[3]||this.dirty)&&(this.gl.viewport(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class Ip extends Wt{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.bindFramebuffer(h.FRAMEBUFFER,s),this.current=s,this.dirty=!1}}class Nu extends Wt{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.bindRenderbuffer(h.RENDERBUFFER,s),this.current=s,this.dirty=!1}}class Do extends Wt{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.bindTexture(h.TEXTURE_2D,s),this.current=s,this.dirty=!1}}class Gc extends Wt{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.bindBuffer(h.ARRAY_BUFFER,s),this.current=s,this.dirty=!1}}class $c extends Wt{getDefault(){return null}set(s){const h=this.gl;h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,s),this.current=s,this.dirty=!1}}class vl extends Wt{getDefault(){return null}set(s){var h;if(s===this.current&&!this.dirty)return;const p=this.gl;dn(p)?p.bindVertexArray(s):(h=p.getExtension("OES_vertex_array_object"))===null||h===void 0||h.bindVertexArrayOES(s),this.current=s,this.dirty=!1}}class Wc extends Wt{getDefault(){return 4}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_ALIGNMENT,s),this.current=s,this.dirty=!1}}class Mp extends Wt{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s),this.current=s,this.dirty=!1}}class ga extends Wt{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,s),this.current=s,this.dirty=!1}}class so extends Wt{constructor(s,h){super(s),this.context=s,this.parent=h}getDefault(){return null}}class Rp extends so{setDirty(){this.dirty=!0}set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,s,0),this.current=s,this.dirty=!1}}class Lu extends so{set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,h.DEPTH_ATTACHMENT,h.RENDERBUFFER,s),this.current=s,this.dirty=!1}}class Nt extends so{set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,h.DEPTH_STENCIL_ATTACHMENT,h.RENDERBUFFER,s),this.current=s,this.dirty=!1}}const xl="Framebuffer is not complete";class Ny{constructor(s,h,p,g,y){this.context=s,this.width=h,this.height=p;const w=s.gl,S=this.framebuffer=w.createFramebuffer();if(this.colorAttachment=new Rp(s,S),g)this.depthAttachment=y?new Nt(s,S):new Lu(s,S);else if(y)throw new Error("Stencil cannot be set without depth");if(w.checkFramebufferStatus(w.FRAMEBUFFER)!==w.FRAMEBUFFER_COMPLETE)throw new Error(xl)}destroy(){const s=this.context.gl,h=this.colorAttachment.get();if(h&&s.deleteTexture(h),this.depthAttachment){const p=this.depthAttachment.get();p&&s.deleteRenderbuffer(p)}s.deleteFramebuffer(this.framebuffer)}}class Pp{constructor(s){var h,p;if(this.gl=s,this.clearColor=new Bu(this),this.clearDepth=new Du(this),this.clearStencil=new Ap(this),this.colorMask=new Ou(this),this.depthMask=new Po(this),this.stencilMask=new Fu(this),this.stencilFunc=new By(this),this.stencilOp=new Dy(this),this.stencilTest=new Oy(this),this.depthRange=new Fy(this),this.depthTest=new Ep(this),this.depthFunc=new ky(this),this.blend=new Sp(this),this.blendFunc=new Vc(this),this.blendColor=new jc(this),this.blendEquation=new Hc(this),this.cullFace=new ku(this),this.cullFaceSide=new Bo(this),this.frontFace=new bl(this),this.program=new _a(this),this.activeTexture=new vs(this),this.viewport=new Cp(this),this.bindFramebuffer=new Ip(this),this.bindRenderbuffer=new Nu(this),this.bindTexture=new Do(this),this.bindVertexBuffer=new Gc(this),this.bindElementBuffer=new $c(this),this.bindVertexArray=new vl(this),this.pixelStoreUnpack=new Wc(this),this.pixelStoreUnpackPremultiplyAlpha=new Mp(this),this.pixelStoreUnpackFlipY=new ga(this),this.extTextureFilterAnisotropic=s.getExtension("EXT_texture_filter_anisotropic")||s.getExtension("MOZ_EXT_texture_filter_anisotropic")||s.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=s.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=s.getParameter(s.MAX_TEXTURE_SIZE),dn(s)){this.HALF_FLOAT=s.HALF_FLOAT;const g=s.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(h=s.RGBA16F)!==null&&h!==void 0?h:g==null?void 0:g.RGBA16F_EXT,this.RGB16F=(p=s.RGB16F)!==null&&p!==void 0?p:g==null?void 0:g.RGB16F_EXT,s.getExtension("EXT_color_buffer_float")}else{s.getExtension("EXT_color_buffer_half_float"),s.getExtension("OES_texture_half_float_linear");const g=s.getExtension("OES_texture_half_float");this.HALF_FLOAT=g==null?void 0:g.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(s,h){return new Tp(this,s,h)}createVertexBuffer(s,h,p){return new Bn(this,s,h,p)}createRenderbuffer(s,h,p){const g=this.gl,y=g.createRenderbuffer();return this.bindRenderbuffer.set(y),g.renderbufferStorage(g.RENDERBUFFER,s,h,p),this.bindRenderbuffer.set(null),y}createFramebuffer(s,h,p,g){return new Ny(this,s,h,p,g)}clear({color:s,depth:h,stencil:p}){const g=this.gl;let y=0;s&&(y|=g.COLOR_BUFFER_BIT,this.clearColor.set(s),this.colorMask.set([!0,!0,!0,!0])),h!==void 0&&(y|=g.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(h),this.depthMask.set(!0)),p!==void 0&&(y|=g.STENCIL_BUFFER_BIT,this.clearStencil.set(p),this.stencilMask.set(255)),g.clear(y)}setCullFace(s){s.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(s.mode),this.frontFace.set(s.frontFace))}setDepthMode(s){s.func!==this.gl.ALWAYS||s.mask?(this.depthTest.set(!0),this.depthFunc.set(s.func),this.depthMask.set(s.mask),this.depthRange.set(s.range)):this.depthTest.set(!1)}setStencilMode(s){s.test.func!==this.gl.ALWAYS||s.mask?(this.stencilTest.set(!0),this.stencilMask.set(s.mask),this.stencilOp.set([s.fail,s.depthFail,s.pass]),this.stencilFunc.set({func:s.test.func,ref:s.ref,mask:s.test.mask})):this.stencilTest.set(!1)}setColorMode(s){a.bH(s.blendFunction,_i.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(s.blendFunction),this.blendColor.set(s.blendColor)),this.colorMask.set(s.mask)}createVertexArray(){var s;return dn(this.gl)?this.gl.createVertexArray():(s=this.gl.getExtension("OES_vertex_array_object"))===null||s===void 0?void 0:s.createVertexArrayOES()}deleteVertexArray(s){var h;return dn(this.gl)?this.gl.deleteVertexArray(s):(h=this.gl.getExtension("OES_vertex_array_object"))===null||h===void 0?void 0:h.deleteVertexArrayOES(s)}unbindVAO(){this.bindVertexArray.set(null)}}let no;function Bp(m,s,h,p,g){const y=m.context,w=m.transform,S=y.gl,C=m.useProgram("collisionBox"),R=[];let B=0,k=0;for(let Q=0;Q<p.length;Q++){const se=p[Q],ce=s.getTile(se).getBucket(h);if(!ce)continue;const ae=g?ce.textCollisionBox:ce.iconCollisionBox,ue=ce.collisionCircleArray;ue.length>0&&(R.push({circleArray:ue,circleOffset:k,coord:se}),B+=ue.length/4,k=B),ae&&C.draw(y,S.LINES,Rt.disabled,jt.disabled,m.colorModeForRenderPass(),xt.disabled,Lc(m.transform),m.style.map.terrain&&m.style.map.terrain.getTerrainData(se),w.getProjectionData({overscaledTileID:se,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),h.id,ae.layoutVertexBuffer,ae.indexBuffer,ae.segments,null,m.transform.zoom,null,null,ae.collisionVertexBuffer)}if(!g||!R.length)return;const F=m.useProgram("collisionCircle"),V=new a.b$;V.resize(4*B),V._trim();let G=0;for(const Q of R)for(let se=0;se<Q.circleArray.length/4;se++){const ce=4*se,ae=Q.circleArray[ce+0],ue=Q.circleArray[ce+1],_e=Q.circleArray[ce+2],le=Q.circleArray[ce+3];V.emplace(G++,ae,ue,_e,le,0),V.emplace(G++,ae,ue,_e,le,1),V.emplace(G++,ae,ue,_e,le,2),V.emplace(G++,ae,ue,_e,le,3)}(!no||no.length<2*B)&&(no=function(Q){const se=2*Q,ce=new a.c1;ce.resize(se),ce._trim();for(let ae=0;ae<se;ae++){const ue=6*ae;ce.uint16[ue+0]=4*ae+0,ce.uint16[ue+1]=4*ae+1,ce.uint16[ue+2]=4*ae+2,ce.uint16[ue+3]=4*ae+2,ce.uint16[ue+4]=4*ae+3,ce.uint16[ue+5]=4*ae+0}return ce}(B));const J=y.createIndexBuffer(no,!0),Y=y.createVertexBuffer(V,a.c0.members,!0);for(const Q of R){const se=Iy(m.transform);F.draw(y,S.TRIANGLES,Rt.disabled,jt.disabled,m.colorModeForRenderPass(),xt.disabled,se,m.style.map.terrain&&m.style.map.terrain.getTerrainData(Q.coord),null,h.id,Y,J,a.aM.simpleSegment(0,2*Q.circleOffset,Q.circleArray.length,Q.circleArray.length/2),null,m.transform.zoom,null,null,null)}Y.destroy(),J.destroy()}const Ly=a.ag(new Float32Array(16));function Dp(m,s,h,p,g,y){const{horizontalAlign:w,verticalAlign:S}=a.aH(m);return new a.P((-(w-.5)*s/g+p[0])*y,(-(S-.5)*h/g+p[1])*y)}function Uy(m,s,h,p,g,y){const w=s.tileAnchorPoint.add(new a.P(s.translation[0],s.translation[1]));if(s.pitchWithMap){let S=p.mult(y);h||(S=S.rotate(-g));const C=w.add(S);return Bi(C.x,C.y,s.pitchedLabelPlaneMatrix,s.getElevation).point}if(h){const S=Xi(s.tileAnchorPoint.x+1,s.tileAnchorPoint.y,s).point.sub(m),C=Math.atan(S.y/S.x)+(S.x<0?Math.PI:0);return m.add(p.rotate(C))}return m.add(p)}function Uu(m,s,h,p,g,y,w,S,C,R,B,k){const F=m.text.placedSymbolArray,V=m.text.dynamicLayoutVertexArray,G=m.icon.dynamicLayoutVertexArray,J={};V.clear();for(let Y=0;Y<F.length;Y++){const Q=F.get(Y),se=Q.hidden||!Q.crossTileID||m.allowVerticalPlacement&&!Q.placedOrientation?null:p[Q.crossTileID];if(se){const ce=new a.P(Q.anchorX,Q.anchorY),ae={getElevation:k,width:g.width,height:g.height,pitchedLabelPlaneMatrix:y,pitchWithMap:h,transform:g,tileAnchorPoint:ce,translation:R,unwrappedTileID:B},ue=h?Mr(ce.x,ce.y,ae):Xi(ce.x,ce.y,ae),_e=We(g.cameraToCenterDistance,ue.signedDistanceFromCamera);let le=a.ap(m.textSizeData,S,Q)*_e/a.aB;h&&(le*=m.tilePixelRatio/w);const{width:ve,height:ke,anchor:Me,textOffset:Pe,textBoxScale:Fe}=se,Ze=Dp(Me,ve,ke,Pe,Fe,le),Ye=g.getPitchedTextCorrection(ce.x+R[0],ce.y+R[1],B),je=Uy(ue.point,ae,s,Ze,-g.bearingInRadians,Ye),ut=m.allowVerticalPlacement&&Q.placedOrientation===a.ao.vertical?Math.PI/2:0;for(let Dt=0;Dt<Q.numGlyphs;Dt++)a.av(V,je,ut);C&&Q.associatedIconIndex>=0&&(J[Q.associatedIconIndex]={shiftedAnchor:je,angle:ut})}else ys(Q.numGlyphs,V)}if(C){G.clear();const Y=m.icon.placedSymbolArray;for(let Q=0;Q<Y.length;Q++){const se=Y.get(Q);if(se.hidden)ys(se.numGlyphs,G);else{const ce=J[Q];if(ce)for(let ae=0;ae<se.numGlyphs;ae++)a.av(G,ce.shiftedAnchor,ce.angle);else ys(se.numGlyphs,G)}}m.icon.dynamicLayoutVertexBuffer.updateData(G)}m.text.dynamicLayoutVertexBuffer.updateData(V)}function Xc(m,s,h){return h.iconsInText&&s?"symbolTextAndIcon":m?"symbolSDF":"symbolIcon"}function wl(m,s,h,p,g,y,w,S,C,R,B,k,F){const V=m.context,G=V.gl,J=m.transform,Y=S==="map",Q=C==="map",se=S!=="viewport"&&h.layout.get("symbol-placement")!=="point",ce=Y&&!Q&&!se,ae=!h.layout.get("symbol-sort-key").isConstant();let ue=!1;const _e=m.getDepthModeForSublayer(0,Rt.ReadOnly),le=h._unevaluatedLayout.hasValue("text-variable-anchor")||h._unevaluatedLayout.hasValue("text-variable-anchor-offset"),ve=[],ke=J.getCircleRadiusCorrection();for(const Me of p){const Pe=s.getTile(Me),Fe=Pe.getBucket(h);if(!Fe)continue;const Ze=g?Fe.text:Fe.icon;if(!Ze||!Ze.segments.get().length||!Ze.hasVisibleVertices)continue;const Ye=Ze.programConfigurations.get(h.id),je=g||Fe.sdfIcons,ut=g?Fe.textSizeData:Fe.iconSizeData,Dt=Q||J.pitch!==0,qt=m.useProgram(Xc(je,g,Fe),Ye),si=a.an(ut,J.zoom),ei=m.style.map.terrain&&m.style.map.terrain.getTerrainData(Me);let wi,Ii,Pt,ni,Zi=[0,0],er=null;if(g)Ii=Pe.glyphAtlasTexture,Pt=G.LINEAR,wi=Pe.glyphAtlasTexture.size,Fe.iconsInText&&(Zi=Pe.imageAtlasTexture.size,er=Pe.imageAtlasTexture,ni=Dt||m.options.rotating||m.options.zooming||ut.kind==="composite"||ut.kind==="camera"?G.LINEAR:G.NEAREST);else{const Ki=h.layout.get("icon-size").constantOr(0)!==1||Fe.iconsNeedLinear;Ii=Pe.imageAtlasTexture,Pt=je||m.options.rotating||m.options.zooming||Ki||Dt?G.LINEAR:G.NEAREST,wi=Pe.imageAtlasTexture.size}const ur=a.aC(Pe,1,m.transform.zoom),Hr=Ei(Y,m.transform,ur),$s=a.L();a.aq($s,Hr);const ao=Bt(Q,Y,m.transform,ur),lo=a.aD(J,Pe,y,w),Ia=J.getProjectionData({overscaledTileID:Me,applyGlobeMatrix:!F,applyTerrainMatrix:!0}),Ma=le&&Fe.hasTextData(),zo=h.layout.get("icon-text-fit")!=="none"&&Ma&&Fe.hasIconData();if(se){const Ki=m.style.map.terrain?(Ts,Yi)=>m.style.map.terrain.getElevation(Me,Ts,Yi):null,tr=h.layout.get("text-rotation-alignment")==="map";bi(Fe,m,g,Hr,$s,Q,R,tr,Me.toUnwrapped(),J.width,J.height,lo,Ki)}const Vo=g&&le||zo,es=se||Vo?Ly:Q?Hr:m.transform.clipSpaceToPixelsMatrix,Ws=je&&h.paint.get(g?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Gr;Gr=je?Fe.iconsInText?Py(ut.kind,si,ce,Q,se,Vo,m,es,ao,lo,wi,Zi,ke):vp(ut.kind,si,ce,Q,se,Vo,m,es,ao,lo,g,wi,0,ke):yl(ut.kind,si,ce,Q,se,Vo,m,es,ao,lo,g,wi,ke);const co={program:qt,buffers:Ze,uniformValues:Gr,projectionData:Ia,atlasTexture:Ii,atlasTextureIcon:er,atlasInterpolation:Pt,atlasInterpolationIcon:ni,isSDF:je,hasHalo:Ws};if(ae&&Fe.canOverlap){ue=!0;const Ki=Ze.segments.get();for(const tr of Ki)ve.push({segments:new a.aM([tr]),sortKey:tr.sortKey,state:co,terrainData:ei})}else ve.push({segments:Ze.segments,sortKey:0,state:co,terrainData:ei})}ue&&ve.sort((Me,Pe)=>Me.sortKey-Pe.sortKey);for(const Me of ve){const Pe=Me.state;if(V.activeTexture.set(G.TEXTURE0),Pe.atlasTexture.bind(Pe.atlasInterpolation,G.CLAMP_TO_EDGE),Pe.atlasTextureIcon&&(V.activeTexture.set(G.TEXTURE1),Pe.atlasTextureIcon&&Pe.atlasTextureIcon.bind(Pe.atlasInterpolationIcon,G.CLAMP_TO_EDGE)),Pe.isSDF){const Fe=Pe.uniformValues;Pe.hasHalo&&(Fe.u_is_halo=1,Tl(Pe.buffers,Me.segments,h,m,Pe.program,_e,B,k,Fe,Pe.projectionData,Me.terrainData)),Fe.u_is_halo=0}Tl(Pe.buffers,Me.segments,h,m,Pe.program,_e,B,k,Pe.uniformValues,Pe.projectionData,Me.terrainData)}}function Tl(m,s,h,p,g,y,w,S,C,R,B){const k=p.context;g.draw(k,k.gl.TRIANGLES,y,w,S,xt.backCCW,C,B,R,h.id,m.layoutVertexBuffer,m.indexBuffer,s,h.paint,p.transform.zoom,m.programConfigurations.get(h.id),m.dynamicLayoutVertexBuffer,m.opacityVertexBuffer)}function zu(m,s,h,p,g){const y=m.context,w=y.gl,S=jt.disabled,C=new _i([w.ONE,w.ONE],a.bf.transparent,[!0,!0,!0,!0]),R=s.getBucket(h);if(!R)return;const B=p.key;let k=h.heatmapFbos.get(B);k||(k=Al(y,s.tileSize,s.tileSize),h.heatmapFbos.set(B,k)),y.bindFramebuffer.set(k.framebuffer),y.viewport.set([0,0,s.tileSize,s.tileSize]),y.clear({color:a.bf.transparent});const F=R.programConfigurations.get(h.id),V=m.useProgram("heatmap",F,!g),G=m.transform.getProjectionData({overscaledTileID:s.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),J=m.style.map.terrain.getTerrainData(p);V.draw(y,w.TRIANGLES,Rt.disabled,S,C,xt.disabled,_p(s,m.transform.zoom,h.paint.get("heatmap-intensity"),1),J,G,h.id,R.layoutVertexBuffer,R.indexBuffer,R.segments,h.paint,m.transform.zoom,F)}function Op(m,s,h,p,g){const y=m.context,w=y.gl,S=m.transform;y.setColorMode(m.colorModeForRenderPass());const C=El(y,s),R=h.key,B=s.heatmapFbos.get(R);if(!B)return;y.activeTexture.set(w.TEXTURE0),w.bindTexture(w.TEXTURE_2D,B.colorAttachment.get()),y.activeTexture.set(w.TEXTURE1),C.bind(w.LINEAR,w.CLAMP_TO_EDGE);const k=S.getProjectionData({overscaledTileID:h,applyTerrainMatrix:g,applyGlobeMatrix:!p});m.useProgram("heatmapTexture").draw(y,w.TRIANGLES,Rt.disabled,jt.disabled,m.colorModeForRenderPass(),xt.disabled,Su(m,s,0,1),null,k,s.id,m.rasterBoundsBuffer,m.quadTriangleIndexBuffer,m.rasterBoundsSegments,s.paint,S.zoom),B.destroy(),s.heatmapFbos.delete(R)}function Al(m,s,h){var p,g;const y=m.gl,w=y.createTexture();y.bindTexture(y.TEXTURE_2D,w),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_S,y.CLAMP_TO_EDGE),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_T,y.CLAMP_TO_EDGE),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MIN_FILTER,y.LINEAR),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MAG_FILTER,y.LINEAR);const S=(p=m.HALF_FLOAT)!==null&&p!==void 0?p:y.UNSIGNED_BYTE,C=(g=m.RGBA16F)!==null&&g!==void 0?g:y.RGBA;y.texImage2D(y.TEXTURE_2D,0,C,s,h,0,y.RGBA,S,null);const R=m.createFramebuffer(s,h,!1,!1);return R.colorAttachment.set(w),R}function El(m,s){return s.colorRampTexture||(s.colorRampTexture=new a.T(m,s.colorRamp,m.gl.RGBA)),s.colorRampTexture}function Sl(m,s,h,p,g){if(!h||!p||!p.imageAtlas)return;const y=p.imageAtlas.patternPositions;let w=y[h.to.toString()],S=y[h.from.toString()];if(!w&&S&&(w=S),!S&&w&&(S=w),!w||!S){const C=g.getPaintProperty(s);w=y[C],S=y[C]}w&&S&&m.setConstantPatternPositions(w,S)}function qc(m,s,h,p,g,y,w,S){const C=m.context.gl,R="fill-pattern",B=h.paint.get(R),k=B&&B.constantOr(1),F=h.getCrossfadeParameters();let V,G,J,Y,Q;const se=m.transform,ce=h.paint.get("fill-translate"),ae=h.paint.get("fill-translate-anchor");w?(G=k&&!h.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",V=C.LINES):(G=k?"fillPattern":"fill",V=C.TRIANGLES);const ue=B.constantOr(null);for(const _e of p){const le=s.getTile(_e);if(k&&!le.patternsLoaded())continue;const ve=le.getBucket(h);if(!ve)continue;const ke=ve.programConfigurations.get(h.id),Me=m.useProgram(G,ke),Pe=m.style.map.terrain&&m.style.map.terrain.getTerrainData(_e);k&&(m.context.activeTexture.set(C.TEXTURE0),le.imageAtlasTexture.bind(C.LINEAR,C.CLAMP_TO_EDGE),ke.updatePaintBuffers(F)),Sl(ke,R,ue,le,h);const Fe=se.getProjectionData({overscaledTileID:_e,applyGlobeMatrix:!S,applyTerrainMatrix:!0}),Ze=a.aD(se,le,ce,ae);if(w){Y=ve.indexBuffer2,Q=ve.segments2;const je=[C.drawingBufferWidth,C.drawingBufferHeight];J=G==="fillOutlinePattern"&&k?gl(m,F,le,je,Ze):_l(je,Ze)}else Y=ve.indexBuffer,Q=ve.segments,J=k?Nc(m,F,le,Ze):{u_fill_translate:Ze};const Ye=m.stencilModeForClipping(_e);Me.draw(m.context,V,g,Ye,y,xt.backCCW,J,Pe,Fe,h.id,ve.layoutVertexBuffer,Y,Q,h.paint,m.transform.zoom,ke)}}function Vu(m,s,h,p,g,y,w,S){const C=m.context,R=C.gl,B="fill-extrusion-pattern",k=h.paint.get(B),F=k.constantOr(1),V=h.getCrossfadeParameters(),G=h.paint.get("fill-extrusion-opacity"),J=k.constantOr(null),Y=m.transform;for(const Q of p){const se=s.getTile(Q),ce=se.getBucket(h);if(!ce)continue;const ae=m.style.map.terrain&&m.style.map.terrain.getTerrainData(Q),ue=ce.programConfigurations.get(h.id),_e=m.useProgram(F?"fillExtrusionPattern":"fillExtrusion",ue);F&&(m.context.activeTexture.set(R.TEXTURE0),se.imageAtlasTexture.bind(R.LINEAR,R.CLAMP_TO_EDGE),ue.updatePaintBuffers(V));const le=Y.getProjectionData({overscaledTileID:Q,applyGlobeMatrix:!S,applyTerrainMatrix:!0});Sl(ue,B,J,se,h);const ve=a.aD(Y,se,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),ke=h.paint.get("fill-extrusion-vertical-gradient"),Me=F?Sy(m,ke,G,ve,Q,V,se):Us(m,ke,G,ve);_e.draw(C,C.gl.TRIANGLES,g,y,w,xt.backCCW,Me,ae,le,h.id,ce.layoutVertexBuffer,ce.indexBuffer,ce.segments,h.paint,m.transform.zoom,ue,m.style.map.terrain&&ce.centroidVertexBuffer)}}function Oo(m,s,h,p,g,y,w,S,C){var R;const B=m.style.projection,k=m.context,F=m.transform,V=k.gl,G=[`#define NUM_ILLUMINATION_SOURCES ${h.paint.get("hillshade-highlight-color").values.length}`],J=m.useProgram("hillshade",null,!1,G),Y=!m.options.moving;for(const Q of p){const se=s.getTile(Q),ce=se.fbo;if(!ce)continue;const ae=B.getMeshFromTileID(k,Q.canonical,S,!0,"raster"),ue=(R=m.style.map.terrain)===null||R===void 0?void 0:R.getTerrainData(Q);k.activeTexture.set(V.TEXTURE0),V.bindTexture(V.TEXTURE_2D,ce.colorAttachment.get());const _e=F.getProjectionData({overscaledTileID:Q,aligned:Y,applyGlobeMatrix:!C,applyTerrainMatrix:!0});J.draw(k,V.TRIANGLES,y,g[Q.overscaledZ],w,xt.backCCW,My(m,se,h),ue,_e,h.id,ae.vertexBuffer,ae.indexBuffer,ae.segments)}}function ju(m,s,h,p,g,y,w,S,C){var R;const B=m.style.projection,k=m.context,F=m.transform,V=k.gl,G=m.useProgram("colorRelief"),J=!m.options.moving;let Y=!0,Q=0;for(const se of p){const ce=s.getTile(se),ae=ce.dem;if(Y){const Me=V.getParameter(V.MAX_TEXTURE_SIZE),{elevationTexture:Pe,colorTexture:Fe}=h.getColorRampTextures(k,Me,ae.getUnpackVector());k.activeTexture.set(V.TEXTURE1),Pe.bind(V.NEAREST,V.CLAMP_TO_EDGE),k.activeTexture.set(V.TEXTURE4),Fe.bind(V.LINEAR,V.CLAMP_TO_EDGE),Y=!1,Q=Pe.size[0]}if(!ae||!ae.data)continue;const ue=ae.stride,_e=ae.getPixels();if(k.activeTexture.set(V.TEXTURE0),k.pixelStoreUnpackPremultiplyAlpha.set(!1),ce.demTexture=ce.demTexture||m.getTileTexture(ue),ce.demTexture){const Me=ce.demTexture;Me.update(_e,{premultiply:!1}),Me.bind(V.LINEAR,V.CLAMP_TO_EDGE)}else ce.demTexture=new a.T(k,_e,V.RGBA,{premultiply:!1}),ce.demTexture.bind(V.LINEAR,V.CLAMP_TO_EDGE);const le=B.getMeshFromTileID(k,se.canonical,S,!0,"raster"),ve=(R=m.style.map.terrain)===null||R===void 0?void 0:R.getTerrainData(se),ke=F.getProjectionData({overscaledTileID:se,aligned:J,applyGlobeMatrix:!C,applyTerrainMatrix:!0});G.draw(k,V.TRIANGLES,y,g[se.overscaledZ],w,xt.backCCW,mp(h,ce.dem,Q),ve,ke,h.id,le.vertexBuffer,le.indexBuffer,le.segments)}}const Zc=[new a.P(0,0),new a.P(a.$,0),new a.P(a.$,a.$),new a.P(0,a.$)];function Fo(m,s,h,p,g,y,w,S,C=!1,R=!1){const B=p[p.length-1].overscaledZ,k=m.context,F=k.gl,V=m.useProgram("raster"),G=m.transform,J=m.style.projection,Y=m.colorModeForRenderPass(),Q=!m.options.moving;for(const se of p){const ce=m.getDepthModeForSublayer(se.overscaledZ-B,h.paint.get("raster-opacity")===1?Rt.ReadWrite:Rt.ReadOnly,F.LESS),ae=s.getTile(se);ae.registerFadeDuration(h.paint.get("raster-fade-duration"));const ue=s.findLoadedParent(se,0),_e=s.findLoadedSibling(se),le=Hu(ae,ue||_e||null,s,h,m.transform,m.style.map.terrain);let ve,ke;const Me=h.paint.get("raster-resampling")==="nearest"?F.NEAREST:F.LINEAR;k.activeTexture.set(F.TEXTURE0),ae.texture.bind(Me,F.CLAMP_TO_EDGE,F.LINEAR_MIPMAP_NEAREST),k.activeTexture.set(F.TEXTURE1),ue?(ue.texture.bind(Me,F.CLAMP_TO_EDGE,F.LINEAR_MIPMAP_NEAREST),ve=Math.pow(2,ue.tileID.overscaledZ-ae.tileID.overscaledZ),ke=[ae.tileID.canonical.x*ve%1,ae.tileID.canonical.y*ve%1]):ae.texture.bind(Me,F.CLAMP_TO_EDGE,F.LINEAR_MIPMAP_NEAREST),ae.texture.useMipmap&&k.extTextureFilterAnisotropic&&m.transform.pitch>20&&F.texParameterf(F.TEXTURE_2D,k.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,k.extTextureFilterAnisotropicMax);const Pe=m.style.map.terrain&&m.style.map.terrain.getTerrainData(se),Fe=G.getProjectionData({overscaledTileID:se,aligned:Q,applyGlobeMatrix:!R,applyTerrainMatrix:!0}),Ze=ml(ke||[0,0],ve||1,le,h,S),Ye=J.getMeshFromTileID(k,se.canonical,y,w,"raster");V.draw(k,F.TRIANGLES,ce,g?g[se.overscaledZ]:jt.disabled,Y,C?xt.frontCCW:xt.backCCW,Ze,Pe,Fe,h.id,Ye.vertexBuffer,Ye.indexBuffer,Ye.segments)}}function Hu(m,s,h,p,g,y){const w=p.paint.get("raster-fade-duration");if(!y&&w>0){const S=N.now(),C=(S-m.timeAdded)/w,R=s?(S-s.timeAdded)/w:-1,B=h.getSource(),k=ct(g,{tileSize:B.tileSize,roundZoom:B.roundZoom}),F=!s||Math.abs(s.tileID.overscaledZ-k)>Math.abs(m.tileID.overscaledZ-k),V=F&&m.refreshedUponExpiration?1:a.ah(F?C:1-R,0,1);return m.refreshedUponExpiration&&C>=1&&(m.refreshedUponExpiration=!1),s?{opacity:1,mix:1-V}:{opacity:V,mix:0}}return{opacity:1,mix:0}}const Fp=new a.bf(1,0,0,1),kp=new a.bf(0,1,0,1),Kc=new a.bf(0,0,1,1),Gu=new a.bf(1,0,1,1),zy=new a.bf(0,1,1,1);function $u(m,s,h,p){_n(m,0,s+h/2,m.transform.width,h,p)}function Ci(m,s,h,p){_n(m,s-h/2,0,h,m.transform.height,p)}function _n(m,s,h,p,g,y){const w=m.context,S=w.gl;S.enable(S.SCISSOR_TEST),S.scissor(s*m.pixelRatio,h*m.pixelRatio,p*m.pixelRatio,g*m.pixelRatio),w.clear({color:y}),S.disable(S.SCISSOR_TEST)}function xs(m,s,h){const p=m.context,g=p.gl,y=m.useProgram("debug"),w=Rt.disabled,S=jt.disabled,C=m.colorModeForRenderPass(),R="$debug",B=m.style.map.terrain&&m.style.map.terrain.getTerrainData(h);p.activeTexture.set(g.TEXTURE0);const k=s.getTileByID(h.key).latestRawTileData,F=Math.floor((k&&k.byteLength||0)/1024),V=s.getTile(h).tileSize,G=512/Math.min(V,512)*(h.overscaledZ/m.transform.zoom)*.5;let J=h.canonical.toString();h.overscaledZ!==h.canonical.z&&(J+=` => ${h.overscaledZ}`),function(Q,se){Q.initDebugOverlayCanvas();const ce=Q.debugOverlayCanvas,ae=Q.context.gl,ue=Q.debugOverlayCanvas.getContext("2d");ue.clearRect(0,0,ce.width,ce.height),ue.shadowColor="white",ue.shadowBlur=2,ue.lineWidth=1.5,ue.strokeStyle="white",ue.textBaseline="top",ue.font="bold 36px Open Sans, sans-serif",ue.fillText(se,5,5),ue.strokeText(se,5,5),Q.debugOverlayTexture.update(ce),Q.debugOverlayTexture.bind(ae.LINEAR,ae.CLAMP_TO_EDGE)}(m,`${J} ${F}kB`);const Y=m.transform.getProjectionData({overscaledTileID:h,applyGlobeMatrix:!0,applyTerrainMatrix:!0});y.draw(p,g.TRIANGLES,w,S,_i.alphaBlended,xt.disabled,Mo(a.bf.transparent,G),null,Y,R,m.debugBuffer,m.quadTriangleIndexBuffer,m.debugSegments),y.draw(p,g.LINE_STRIP,w,S,C,xt.disabled,Mo(a.bf.red),B,Y,R,m.debugBuffer,m.tileBorderIndexBuffer,m.debugSegments)}function Yc(m,s,h,p){const{isRenderingGlobe:g}=p,y=m.context,w=y.gl,S=m.transform,C=m.colorModeForRenderPass(),R=m.getDepthModeFor3D(),B=m.useProgram("terrain");y.bindFramebuffer.set(null),y.viewport.set([0,0,m.width,m.height]);for(const k of h){const F=s.getTerrainMesh(k.tileID),V=m.renderToTexture.getTexture(k),G=s.getTerrainData(k.tileID);y.activeTexture.set(w.TEXTURE0),w.bindTexture(w.TEXTURE_2D,V.texture);const J=s.getMeshFrameDelta(S.zoom),Y=S.calculateFogMatrix(k.tileID.toUnwrapped()),Q=Fc(J,Y,m.style.sky,S.pitch,g),se=S.getProjectionData({overscaledTileID:k.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});B.draw(y,w.TRIANGLES,R,jt.disabled,C,xt.backCCW,Q,G,se,"terrain",F.vertexBuffer,F.indexBuffer,F.segments)}}function Cl(m,s){if(!s.mesh){const h=new a.aL;h.emplaceBack(-1,-1),h.emplaceBack(1,-1),h.emplaceBack(1,1),h.emplaceBack(-1,1);const p=new a.aN;p.emplaceBack(0,1,2),p.emplaceBack(0,2,3),s.mesh=new $e(m.createVertexBuffer(h,lt.members),m.createIndexBuffer(p),a.aM.simpleSegment(0,0,h.length,p.length))}return s.mesh}class Np{constructor(s,h){this.context=new Pp(s),this.transform=h,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:a.ag(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=Ft.maxUnderzooming+Ft.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new q}resize(s,h,p){if(this.width=Math.floor(s*p),this.height=Math.floor(h*p),this.pixelRatio=p,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const g of this.style._order)this.style._layers[g].resize()}setup(){const s=this.context,h=new a.aL;h.emplaceBack(0,0),h.emplaceBack(a.$,0),h.emplaceBack(0,a.$),h.emplaceBack(a.$,a.$),this.tileExtentBuffer=s.createVertexBuffer(h,lt.members),this.tileExtentSegments=a.aM.simpleSegment(0,0,4,2);const p=new a.aL;p.emplaceBack(0,0),p.emplaceBack(a.$,0),p.emplaceBack(0,a.$),p.emplaceBack(a.$,a.$),this.debugBuffer=s.createVertexBuffer(p,lt.members),this.debugSegments=a.aM.simpleSegment(0,0,4,5);const g=new a.c6;g.emplaceBack(0,0,0,0),g.emplaceBack(a.$,0,a.$,0),g.emplaceBack(0,a.$,0,a.$),g.emplaceBack(a.$,a.$,a.$,a.$),this.rasterBoundsBuffer=s.createVertexBuffer(g,Ay.members),this.rasterBoundsSegments=a.aM.simpleSegment(0,0,4,2);const y=new a.aL;y.emplaceBack(0,0),y.emplaceBack(a.$,0),y.emplaceBack(0,a.$),y.emplaceBack(a.$,a.$),this.rasterBoundsBufferPosOnly=s.createVertexBuffer(y,lt.members),this.rasterBoundsSegmentsPosOnly=a.aM.simpleSegment(0,0,4,5);const w=new a.aL;w.emplaceBack(0,0),w.emplaceBack(1,0),w.emplaceBack(0,1),w.emplaceBack(1,1),this.viewportBuffer=s.createVertexBuffer(w,lt.members),this.viewportSegments=a.aM.simpleSegment(0,0,4,2);const S=new a.c7;S.emplaceBack(0),S.emplaceBack(1),S.emplaceBack(3),S.emplaceBack(2),S.emplaceBack(0),this.tileBorderIndexBuffer=s.createIndexBuffer(S);const C=new a.aN;C.emplaceBack(1,0,2),C.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=s.createIndexBuffer(C);const R=this.context.gl;this.stencilClearMode=new jt({func:R.ALWAYS,mask:0},0,255,R.ZERO,R.ZERO,R.ZERO),this.tileExtentMesh=new $e(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){const s=this.context,h=s.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const p=a.L();a.bY(p,0,this.width,this.height,0,0,1),a.N(p,p,[h.drawingBufferWidth,h.drawingBufferHeight,0]);const g={mainMatrix:p,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:p};this.useProgram("clippingMask",null,!0).draw(s,h.TRIANGLES,Rt.disabled,this.stencilClearMode,_i.disabled,xt.disabled,null,null,g,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(s,h,p){if(this.currentStencilSource===s.source||!s.isTileClipped()||!h||!h.length)return;this.currentStencilSource=s.source,this.nextStencilID+h.length>256&&this.clearStencil();const g=this.context;g.setColorMode(_i.disabled),g.setDepthMode(Rt.disabled);const y={};for(const w of h)y[w.key]=this.nextStencilID++;this._renderTileMasks(y,h,p,!0),this._renderTileMasks(y,h,p,!1),this._tileClippingMaskIDs=y}_renderTileMasks(s,h,p,g){const y=this.context,w=y.gl,S=this.style.projection,C=this.transform,R=this.useProgram("clippingMask");for(const B of h){const k=s[B.key],F=this.style.map.terrain&&this.style.map.terrain.getTerrainData(B),V=S.getMeshFromTileID(this.context,B.canonical,g,!0,"stencil"),G=C.getProjectionData({overscaledTileID:B,applyGlobeMatrix:!p,applyTerrainMatrix:!0});R.draw(y,w.TRIANGLES,Rt.disabled,new jt({func:w.ALWAYS,mask:0},k,255,w.KEEP,w.KEEP,w.REPLACE),_i.disabled,p?xt.disabled:xt.backCCW,null,F,G,"$clipping",V.vertexBuffer,V.indexBuffer,V.segments)}}_renderTilesDepthBuffer(){const s=this.context,h=s.gl,p=this.style.projection,g=this.transform,y=this.useProgram("depth"),w=this.getDepthModeFor3D(),S=we(g,{tileSize:g.tileSize});for(const C of S){const R=this.style.map.terrain&&this.style.map.terrain.getTerrainData(C),B=p.getMeshFromTileID(this.context,C.canonical,!0,!0,"raster"),k=g.getProjectionData({overscaledTileID:C,applyGlobeMatrix:!0,applyTerrainMatrix:!0});y.draw(s,h.TRIANGLES,w,jt.disabled,_i.disabled,xt.backCCW,null,R,k,"$clipping",B.vertexBuffer,B.indexBuffer,B.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const s=this.nextStencilID++,h=this.context.gl;return new jt({func:h.NOTEQUAL,mask:255},s,255,h.KEEP,h.KEEP,h.REPLACE)}stencilModeForClipping(s){const h=this.context.gl;return new jt({func:h.EQUAL,mask:255},this._tileClippingMaskIDs[s.key],0,h.KEEP,h.KEEP,h.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(s){const h=this.context.gl,p=s.sort((w,S)=>S.overscaledZ-w.overscaledZ),g=p[p.length-1].overscaledZ,y=p[0].overscaledZ-g+1;if(y>1){this.currentStencilSource=void 0,this.nextStencilID+y>256&&this.clearStencil();const w={};for(let S=0;S<y;S++)w[S+g]=new jt({func:h.GEQUAL,mask:255},S+this.nextStencilID,255,h.KEEP,h.KEEP,h.REPLACE);return this.nextStencilID+=y,[w,p]}return[{[g]:jt.disabled},p]}stencilConfigForOverlapTwoPass(s){const h=this.context.gl,p=s.sort((w,S)=>S.overscaledZ-w.overscaledZ),g=p[p.length-1].overscaledZ,y=p[0].overscaledZ-g+1;if(this.clearStencil(),y>1){const w={},S={};for(let C=0;C<y;C++)w[C+g]=new jt({func:h.GREATER,mask:255},y+1+C,255,h.KEEP,h.KEEP,h.REPLACE),S[C+g]=new jt({func:h.GREATER,mask:255},1+C,255,h.KEEP,h.KEEP,h.REPLACE);return this.nextStencilID=2*y+1,[w,S,p]}return this.nextStencilID=3,[{[g]:new jt({func:h.GREATER,mask:255},2,255,h.KEEP,h.KEEP,h.REPLACE)},{[g]:new jt({func:h.GREATER,mask:255},1,255,h.KEEP,h.KEEP,h.REPLACE)},p]}colorModeForRenderPass(){const s=this.context.gl;return this._showOverdrawInspector?new _i([s.CONSTANT_COLOR,s.ONE],new a.bf(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?_i.unblended:_i.alphaBlended}getDepthModeForSublayer(s,h,p){if(!this.opaquePassEnabledForLayer())return Rt.disabled;const g=1-((1+this.currentLayer)*this.numSublayers+s)*this.depthEpsilon;return new Rt(p||this.context.gl.LEQUAL,h,[g,g])}getDepthModeFor3D(){return new Rt(this.context.gl.LEQUAL,Rt.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(s,h){var p,g;this.style=s,this.options=h,this.lineAtlas=s.lineAtlas,this.imageManager=s.imageManager,this.glyphManager=s.glyphManager,this.symbolFadeChange=s.placement.symbolFadeChange(N.now()),this.imageManager.beginFrame();const y=this.style._order,w=this.style.sourceCaches,S={},C={},R={},B={isRenderingToTexture:!1,isRenderingGlobe:((p=s.projection)===null||p===void 0?void 0:p.transitionState)>0};for(const F in w){const V=w[F];V.used&&V.prepare(this.context),S[F]=V.getVisibleCoordinates(!1),C[F]=S[F].slice().reverse(),R[F]=V.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let F=0;F<y.length;F++)if(this.style._layers[y[F]].is3D()){this.opaquePassCutoff=F;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const F of y){const V=this.style._layers[F];if(!V.hasOffscreenPass()||V.isHidden(this.transform.zoom))continue;const G=C[V.source];(V.type==="custom"||G.length)&&this.renderLayer(this,w[V.source],V,G,B)}if((g=this.style.projection)===null||g===void 0||g.updateGPUdependent({context:this.context,useProgram:F=>this.useProgram(F)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:h.showOverdrawInspector?a.bf.black:a.bf.transparent,depth:1}),this.clearStencil(),this.style.sky&&function(F,V){const G=F.context,J=G.gl,Y=((_e,le,ve)=>{const ke=Math.cos(le.rollInRadians),Me=Math.sin(le.rollInRadians),Pe=pe(le),Fe=le.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:_e.properties.get("sky-color"),u_horizon_color:_e.properties.get("horizon-color"),u_horizon:[(le.width/2-Pe*Me)*ve,(le.height/2+Pe*ke)*ve],u_horizon_normal:[-Me,ke],u_sky_horizon_blend:_e.properties.get("sky-horizon-blend")*le.height/2*ve,u_sky_blend:Fe}})(V,F.style.map.transform,F.pixelRatio),Q=new Rt(J.LEQUAL,Rt.ReadWrite,[0,1]),se=jt.disabled,ce=F.colorModeForRenderPass(),ae=F.useProgram("sky"),ue=Cl(G,V);ae.draw(G,J.TRIANGLES,Q,se,ce,xt.disabled,Y,null,void 0,"sky",ue.vertexBuffer,ue.indexBuffer,ue.segments)}(this,this.style.sky),this._showOverdrawInspector=h.showOverdrawInspector,this.depthRangeFor3D=[0,1-(s._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=y.length-1;this.currentLayer>=0;this.currentLayer--){const F=this.style._layers[y[this.currentLayer]],V=w[F.source],G=S[F.source];this._renderTileClippingMasks(F,G,!1),this.renderLayer(this,V,F,G,B)}this.renderPass="translucent";let k=!1;for(this.currentLayer=0;this.currentLayer<y.length;this.currentLayer++){const F=this.style._layers[y[this.currentLayer]],V=w[F.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(F,B))continue;this.opaquePassEnabledForLayer()||k||(k=!0,B.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());const G=(F.type==="symbol"?R:C)[F.source];this._renderTileClippingMasks(F,S[F.source],!!this.renderToTexture),this.renderLayer(this,V,F,G,B)}if(B.isRenderingGlobe&&function(F,V,G){const J=F.context,Y=J.gl,Q=F.useProgram("atmosphere"),se=new Rt(Y.LEQUAL,Rt.ReadOnly,[0,1]),ce=F.transform,ae=function(Fe,Ze){const Ye=Fe.properties.get("position"),je=[-Ye.x,-Ye.y,-Ye.z],ut=a.ag(new Float64Array(16));return Fe.properties.get("anchor")==="map"&&(a.b6(ut,ut,Ze.rollInRadians),a.b7(ut,ut,-Ze.pitchInRadians),a.b6(ut,ut,Ze.bearingInRadians),a.b7(ut,ut,Ze.center.lat*Math.PI/180),a.bz(ut,ut,-Ze.center.lng*Math.PI/180)),a.c5(je,je,ut),je}(G,F.transform),ue=ce.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),_e=V.properties.get("atmosphere-blend")*ue.projectionTransition;if(_e===0)return;const le=fa(ce.worldSize,ce.center.lat),ve=ce.inverseProjectionMatrix,ke=new Float64Array(4);ke[3]=1,a.aw(ke,ke,ce.modelViewProjectionMatrix),ke[0]/=ke[3],ke[1]/=ke[3],ke[2]/=ke[3],ke[3]=1,a.aw(ke,ke,ve),ke[0]/=ke[3],ke[1]/=ke[3],ke[2]/=ke[3],ke[3]=1;const Me=((Fe,Ze,Ye,je,ut)=>({u_sun_pos:Fe,u_atmosphere_blend:Ze,u_globe_position:Ye,u_globe_radius:je,u_inv_proj_matrix:ut}))(ae,_e,[ke[0],ke[1],ke[2]],le,ve),Pe=Cl(J,V);Q.draw(J,Y.TRIANGLES,se,jt.disabled,_i.alphaBlended,xt.disabled,Me,null,null,"atmosphere",Pe.vertexBuffer,Pe.indexBuffer,Pe.segments)}(this,this.style.sky,this.style.light),this.options.showTileBoundaries){const F=function(V,G){let J=null;const Y=Object.values(V._layers).flatMap(ae=>ae.source&&!ae.isHidden(G)?[V.sourceCaches[ae.source]]:[]),Q=Y.filter(ae=>ae.getSource().type==="vector"),se=Y.filter(ae=>ae.getSource().type!=="vector"),ce=ae=>{(!J||J.getSource().maxzoom<ae.getSource().maxzoom)&&(J=ae)};return Q.forEach(ae=>ce(ae)),J||se.forEach(ae=>ce(ae)),J}(this.style,this.transform.zoom);F&&function(V,G,J){for(let Y=0;Y<J.length;Y++)xs(V,G,J[Y])}(this,F,F.getVisibleCoordinates())}this.options.showPadding&&function(F){const V=F.transform.padding;$u(F,F.transform.height-(V.top||0),3,Fp),$u(F,V.bottom||0,3,kp),Ci(F,V.left||0,3,Kc),Ci(F,F.transform.width-(V.right||0),3,Gu);const G=F.transform.centerPoint;(function(J,Y,Q,se){_n(J,Y-1,Q-10,2,20,se),_n(J,Y-10,Q-1,20,2,se)})(F,G.x,F.transform.height-G.y,zy)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(s){if(!this.style||!this.style.map||!this.style.map.terrain)return;const h=this.terrainFacilitator.matrix,p=this.transform.modelViewProjectionMatrix;let g=this.terrainFacilitator.dirty;g||(g=s?!a.c8(h,p):!a.c9(h,p)),g||(g=this.style.map.terrain.sourceCache.anyTilesAfterTime(this.terrainFacilitator.renderTime)),g&&(a.ca(h,p),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(y,w){const S=y.context,C=S.gl,R=y.transform,B=_i.unblended,k=new Rt(C.LEQUAL,Rt.ReadWrite,[0,1]),F=w.sourceCache.getRenderableTiles(),V=y.useProgram("terrainDepth");S.bindFramebuffer.set(w.getFramebuffer("depth").framebuffer),S.viewport.set([0,0,y.width/devicePixelRatio,y.height/devicePixelRatio]),S.clear({color:a.bf.transparent,depth:1});for(const G of F){const J=w.getTerrainMesh(G.tileID),Y=w.getTerrainData(G.tileID),Q=R.getProjectionData({overscaledTileID:G.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),se={u_ele_delta:w.getMeshFrameDelta(R.zoom)};V.draw(S,C.TRIANGLES,k,jt.disabled,B,xt.backCCW,se,Y,Q,"terrain",J.vertexBuffer,J.indexBuffer,J.segments)}S.bindFramebuffer.set(null),S.viewport.set([0,0,y.width,y.height])}(this,this.style.map.terrain),function(y,w){const S=y.context,C=S.gl,R=y.transform,B=_i.unblended,k=new Rt(C.LEQUAL,Rt.ReadWrite,[0,1]),F=w.getCoordsTexture(),V=w.sourceCache.getRenderableTiles(),G=y.useProgram("terrainCoords");S.bindFramebuffer.set(w.getFramebuffer("coords").framebuffer),S.viewport.set([0,0,y.width/devicePixelRatio,y.height/devicePixelRatio]),S.clear({color:a.bf.transparent,depth:1}),w.coordsIndex=[];for(const J of V){const Y=w.getTerrainMesh(J.tileID),Q=w.getTerrainData(J.tileID);S.activeTexture.set(C.TEXTURE0),C.bindTexture(C.TEXTURE_2D,F.texture);const se={u_terrain_coords_id:(255-w.coordsIndex.length)/255,u_texture:0,u_ele_delta:w.getMeshFrameDelta(R.zoom)},ce=R.getProjectionData({overscaledTileID:J.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});G.draw(S,C.TRIANGLES,k,jt.disabled,B,xt.backCCW,se,Q,ce,"terrain",Y.vertexBuffer,Y.indexBuffer,Y.segments),w.coordsIndex.push(J.tileID.key)}S.bindFramebuffer.set(null),S.viewport.set([0,0,y.width,y.height])}(this,this.style.map.terrain))}renderLayer(s,h,p,g,y){p.isHidden(this.transform.zoom)||(p.type==="background"||p.type==="custom"||(g||[]).length)&&(this.id=p.id,a.cb(p)?function(w,S,C,R,B,k){if(w.renderPass!=="translucent")return;const{isRenderingToTexture:F}=k,V=jt.disabled,G=w.colorModeForRenderPass();(C._unevaluatedLayout.hasValue("text-variable-anchor")||C._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(J,Y,Q,se,ce,ae,ue,_e,le){const ve=Y.transform,ke=Y.style.map.terrain,Me=ce==="map",Pe=ae==="map";for(const Fe of J){const Ze=se.getTile(Fe),Ye=Ze.getBucket(Q);if(!Ye||!Ye.text||!Ye.text.segments.get().length)continue;const je=a.an(Ye.textSizeData,ve.zoom),ut=a.aC(Ze,1,Y.transform.zoom),Dt=Ei(Me,Y.transform,ut),qt=Q.layout.get("icon-text-fit")!=="none"&&Ye.hasIconData();if(je){const si=Math.pow(2,ve.zoom-Ze.tileID.overscaledZ),ei=ke?(wi,Ii)=>ke.getElevation(Fe,wi,Ii):null;Uu(Ye,Me,Pe,le,ve,Dt,si,je,qt,a.aD(ve,Ze,ue,_e),Fe.toUnwrapped(),ei)}}}(R,w,C,S,C.layout.get("text-rotation-alignment"),C.layout.get("text-pitch-alignment"),C.paint.get("text-translate"),C.paint.get("text-translate-anchor"),B),C.paint.get("icon-opacity").constantOr(1)!==0&&wl(w,S,C,R,!1,C.paint.get("icon-translate"),C.paint.get("icon-translate-anchor"),C.layout.get("icon-rotation-alignment"),C.layout.get("icon-pitch-alignment"),C.layout.get("icon-keep-upright"),V,G,F),C.paint.get("text-opacity").constantOr(1)!==0&&wl(w,S,C,R,!0,C.paint.get("text-translate"),C.paint.get("text-translate-anchor"),C.layout.get("text-rotation-alignment"),C.layout.get("text-pitch-alignment"),C.layout.get("text-keep-upright"),V,G,F),S.map.showCollisionBoxes&&(Bp(w,S,C,R,!0),Bp(w,S,C,R,!1))}(s,h,p,g,this.style.placement.variableOffsets,y):a.cc(p)?function(w,S,C,R,B){if(w.renderPass!=="translucent")return;const{isRenderingToTexture:k}=B,F=C.paint.get("circle-opacity"),V=C.paint.get("circle-stroke-width"),G=C.paint.get("circle-stroke-opacity"),J=!C.layout.get("circle-sort-key").isConstant();if(F.constantOr(1)===0&&(V.constantOr(1)===0||G.constantOr(1)===0))return;const Y=w.context,Q=Y.gl,se=w.transform,ce=w.getDepthModeForSublayer(0,Rt.ReadOnly),ae=jt.disabled,ue=w.colorModeForRenderPass(),_e=[],le=se.getCircleRadiusCorrection();for(let ve=0;ve<R.length;ve++){const ke=R[ve],Me=S.getTile(ke),Pe=Me.getBucket(C);if(!Pe)continue;const Fe=C.paint.get("circle-translate"),Ze=C.paint.get("circle-translate-anchor"),Ye=a.aD(se,Me,Fe,Ze),je=Pe.programConfigurations.get(C.id),ut=w.useProgram("circle",je),Dt=Pe.layoutVertexBuffer,qt=Pe.indexBuffer,si=w.style.map.terrain&&w.style.map.terrain.getTerrainData(ke),ei={programConfiguration:je,program:ut,layoutVertexBuffer:Dt,indexBuffer:qt,uniformValues:Cy(w,Me,C,Ye,le),terrainData:si,projectionData:se.getProjectionData({overscaledTileID:ke,applyGlobeMatrix:!k,applyTerrainMatrix:!0})};if(J){const wi=Pe.segments.get();for(const Ii of wi)_e.push({segments:new a.aM([Ii]),sortKey:Ii.sortKey,state:ei})}else _e.push({segments:Pe.segments,sortKey:0,state:ei})}J&&_e.sort((ve,ke)=>ve.sortKey-ke.sortKey);for(const ve of _e){const{programConfiguration:ke,program:Me,layoutVertexBuffer:Pe,indexBuffer:Fe,uniformValues:Ze,terrainData:Ye,projectionData:je}=ve.state;Me.draw(Y,Q.TRIANGLES,ce,ae,ue,xt.backCCW,Ze,Ye,je,C.id,Pe,Fe,ve.segments,C.paint,w.transform.zoom,ke)}}(s,h,p,g,y):a.cd(p)?function(w,S,C,R,B){if(C.paint.get("heatmap-opacity")===0)return;const k=w.context,{isRenderingToTexture:F,isRenderingGlobe:V}=B;if(w.style.map.terrain){for(const G of R){const J=S.getTile(G);S.hasRenderableParent(G)||(w.renderPass==="offscreen"?zu(w,J,C,G,V):w.renderPass==="translucent"&&Op(w,C,G,F,V))}k.viewport.set([0,0,w.width,w.height])}else w.renderPass==="offscreen"?function(G,J,Y,Q){const se=G.context,ce=se.gl,ae=G.transform,ue=jt.disabled,_e=new _i([ce.ONE,ce.ONE],a.bf.transparent,[!0,!0,!0,!0]);(function(le,ve,ke){const Me=le.gl;le.activeTexture.set(Me.TEXTURE1),le.viewport.set([0,0,ve.width/4,ve.height/4]);let Pe=ke.heatmapFbos.get(a.c2);Pe?(Me.bindTexture(Me.TEXTURE_2D,Pe.colorAttachment.get()),le.bindFramebuffer.set(Pe.framebuffer)):(Pe=Al(le,ve.width/4,ve.height/4),ke.heatmapFbos.set(a.c2,Pe))})(se,G,Y),se.clear({color:a.bf.transparent});for(let le=0;le<Q.length;le++){const ve=Q[le];if(J.hasRenderableParent(ve))continue;const ke=J.getTile(ve),Me=ke.getBucket(Y);if(!Me)continue;const Pe=Me.programConfigurations.get(Y.id),Fe=G.useProgram("heatmap",Pe),Ze=ae.getProjectionData({overscaledTileID:ve,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),Ye=ae.getCircleRadiusCorrection();Fe.draw(se,ce.TRIANGLES,Rt.disabled,ue,_e,xt.backCCW,_p(ke,ae.zoom,Y.paint.get("heatmap-intensity"),Ye),null,Ze,Y.id,Me.layoutVertexBuffer,Me.indexBuffer,Me.segments,Y.paint,ae.zoom,Pe)}se.viewport.set([0,0,G.width,G.height])}(w,S,C,R):w.renderPass==="translucent"&&function(G,J){const Y=G.context,Q=Y.gl;Y.setColorMode(G.colorModeForRenderPass());const se=J.heatmapFbos.get(a.c2);se&&(Y.activeTexture.set(Q.TEXTURE0),Q.bindTexture(Q.TEXTURE_2D,se.colorAttachment.get()),Y.activeTexture.set(Q.TEXTURE1),El(Y,J).bind(Q.LINEAR,Q.CLAMP_TO_EDGE),G.useProgram("heatmapTexture").draw(Y,Q.TRIANGLES,Rt.disabled,jt.disabled,G.colorModeForRenderPass(),xt.disabled,Su(G,J,0,1),null,null,J.id,G.viewportBuffer,G.quadTriangleIndexBuffer,G.viewportSegments,J.paint,G.transform.zoom))}(w,C)}(s,h,p,g,y):a.ce(p)?function(w,S,C,R,B){if(w.renderPass!=="translucent")return;const{isRenderingToTexture:k}=B,F=C.paint.get("line-opacity"),V=C.paint.get("line-width");if(F.constantOr(1)===0||V.constantOr(1)===0)return;const G=w.getDepthModeForSublayer(0,Rt.ReadOnly),J=w.colorModeForRenderPass(),Y=C.paint.get("line-dasharray"),Q=C.paint.get("line-pattern"),se=Q.constantOr(1),ce=C.paint.get("line-gradient"),ae=C.getCrossfadeParameters(),ue=se?"linePattern":Y?"lineSDF":ce?"lineGradient":"line",_e=w.context,le=_e.gl,ve=w.transform;let ke=!0;for(const Me of R){const Pe=S.getTile(Me);if(se&&!Pe.patternsLoaded())continue;const Fe=Pe.getBucket(C);if(!Fe)continue;const Ze=Fe.programConfigurations.get(C.id),Ye=w.context.program.get(),je=w.useProgram(ue,Ze),ut=ke||je.program!==Ye,Dt=w.style.map.terrain&&w.style.map.terrain.getTerrainData(Me),qt=Q.constantOr(null);if(qt&&Pe.imageAtlas){const Pt=Pe.imageAtlas,ni=Pt.patternPositions[qt.to.toString()],Zi=Pt.patternPositions[qt.from.toString()];ni&&Zi&&Ze.setConstantPatternPositions(ni,Zi)}const si=ve.getProjectionData({overscaledTileID:Me,applyGlobeMatrix:!k,applyTerrainMatrix:!0}),ei=ve.getPixelScale(),wi=se?bp(w,Pe,C,ei,ae):Y?Ro(w,Pe,C,ei,Y,ae):ce?yp(w,Pe,C,ei,Fe.lineClipsArray.length):Uc(w,Pe,C,ei);if(se)_e.activeTexture.set(le.TEXTURE0),Pe.imageAtlasTexture.bind(le.LINEAR,le.CLAMP_TO_EDGE),Ze.updatePaintBuffers(ae);else if(Y&&(ut||w.lineAtlas.dirty))_e.activeTexture.set(le.TEXTURE0),w.lineAtlas.bind(_e);else if(ce){const Pt=Fe.gradients[C.id];let ni=Pt.texture;if(C.gradientVersion!==Pt.version){let Zi=256;if(C.stepInterpolant){const er=S.getSource().maxzoom,ur=Me.canonical.z===er?Math.ceil(1<<w.transform.maxZoom-Me.canonical.z):1;Zi=a.ah(a.c3(Fe.maxLineLength/a.$*1024*ur),256,_e.maxTextureSize)}Pt.gradient=a.c4({expression:C.gradientExpression(),evaluationKey:"lineProgress",resolution:Zi,image:Pt.gradient||void 0,clips:Fe.lineClipsArray}),Pt.texture?Pt.texture.update(Pt.gradient):Pt.texture=new a.T(_e,Pt.gradient,le.RGBA),Pt.version=C.gradientVersion,ni=Pt.texture}_e.activeTexture.set(le.TEXTURE0),ni.bind(C.stepInterpolant?le.NEAREST:le.LINEAR,le.CLAMP_TO_EDGE)}const Ii=w.stencilModeForClipping(Me);je.draw(_e,le.TRIANGLES,G,Ii,J,xt.disabled,wi,Dt,si,C.id,Fe.layoutVertexBuffer,Fe.indexBuffer,Fe.segments,C.paint,w.transform.zoom,Ze,Fe.layoutVertexBuffer2),ke=!1}}(s,h,p,g,y):a.cf(p)?function(w,S,C,R,B){const k=C.paint.get("fill-color"),F=C.paint.get("fill-opacity");if(F.constantOr(1)===0)return;const{isRenderingToTexture:V}=B,G=w.colorModeForRenderPass(),J=C.paint.get("fill-pattern"),Y=w.opaquePassEnabledForLayer()&&!J.constantOr(1)&&k.constantOr(a.bf.transparent).a===1&&F.constantOr(0)===1?"opaque":"translucent";if(w.renderPass===Y){const Q=w.getDepthModeForSublayer(1,w.renderPass==="opaque"?Rt.ReadWrite:Rt.ReadOnly);qc(w,S,C,R,Q,G,!1,V)}if(w.renderPass==="translucent"&&C.paint.get("fill-antialias")){const Q=w.getDepthModeForSublayer(C.getPaintProperty("fill-outline-color")?2:0,Rt.ReadOnly);qc(w,S,C,R,Q,G,!0,V)}}(s,h,p,g,y):a.cg(p)?function(w,S,C,R,B){const k=C.paint.get("fill-extrusion-opacity");if(k===0)return;const{isRenderingToTexture:F}=B;if(w.renderPass==="translucent"){const V=new Rt(w.context.gl.LEQUAL,Rt.ReadWrite,w.depthRangeFor3D);if(k!==1||C.paint.get("fill-extrusion-pattern").constantOr(1))Vu(w,S,C,R,V,jt.disabled,_i.disabled,F),Vu(w,S,C,R,V,w.stencilModeFor3D(),w.colorModeForRenderPass(),F);else{const G=w.colorModeForRenderPass();Vu(w,S,C,R,V,jt.disabled,G,F)}}}(s,h,p,g,y):a.ch(p)?function(w,S,C,R,B){if(w.renderPass!=="offscreen"&&w.renderPass!=="translucent")return;const{isRenderingToTexture:k}=B,F=w.context,V=w.style.projection.useSubdivision,G=w.getDepthModeForSublayer(0,Rt.ReadOnly),J=w.colorModeForRenderPass();if(w.renderPass==="offscreen")(function(Y,Q,se,ce,ae,ue,_e){const le=Y.context,ve=le.gl;for(const ke of se){const Me=Q.getTile(ke),Pe=Me.dem;if(!Pe||!Pe.data||!Me.needsHillshadePrepare)continue;const Fe=Pe.dim,Ze=Pe.stride,Ye=Pe.getPixels();if(le.activeTexture.set(ve.TEXTURE1),le.pixelStoreUnpackPremultiplyAlpha.set(!1),Me.demTexture=Me.demTexture||Y.getTileTexture(Ze),Me.demTexture){const ut=Me.demTexture;ut.update(Ye,{premultiply:!1}),ut.bind(ve.NEAREST,ve.CLAMP_TO_EDGE)}else Me.demTexture=new a.T(le,Ye,ve.RGBA,{premultiply:!1}),Me.demTexture.bind(ve.NEAREST,ve.CLAMP_TO_EDGE);le.activeTexture.set(ve.TEXTURE0);let je=Me.fbo;if(!je){const ut=new a.T(le,{width:Fe,height:Fe,data:null},ve.RGBA);ut.bind(ve.LINEAR,ve.CLAMP_TO_EDGE),je=Me.fbo=le.createFramebuffer(Fe,Fe,!0,!1),je.colorAttachment.set(ut.texture)}le.bindFramebuffer.set(je.framebuffer),le.viewport.set([0,0,Fe,Fe]),Y.useProgram("hillshadePrepare").draw(le,ve.TRIANGLES,ae,ue,_e,xt.disabled,gp(Me.tileID,Pe),null,null,ce.id,Y.rasterBoundsBuffer,Y.quadTriangleIndexBuffer,Y.rasterBoundsSegments),Me.needsHillshadePrepare=!1}})(w,S,R,C,G,jt.disabled,J),F.viewport.set([0,0,w.width,w.height]);else if(w.renderPass==="translucent")if(V){const[Y,Q,se]=w.stencilConfigForOverlapTwoPass(R);Oo(w,S,C,se,Y,G,J,!1,k),Oo(w,S,C,se,Q,G,J,!0,k)}else{const[Y,Q]=w.getStencilConfigForOverlapAndUpdateStencilID(R);Oo(w,S,C,Q,Y,G,J,!1,k)}}(s,h,p,g,y):a.ci(p)?function(w,S,C,R,B){if(w.renderPass!=="translucent"||!R.length)return;const{isRenderingToTexture:k}=B,F=w.style.projection.useSubdivision,V=w.getDepthModeForSublayer(0,Rt.ReadOnly),G=w.colorModeForRenderPass();if(F){const[J,Y,Q]=w.stencilConfigForOverlapTwoPass(R);ju(w,S,C,Q,J,V,G,!1,k),ju(w,S,C,Q,Y,V,G,!0,k)}else{const[J,Y]=w.getStencilConfigForOverlapAndUpdateStencilID(R);ju(w,S,C,Y,J,V,G,!1,k)}}(s,h,p,g,y):a.cj(p)?function(w,S,C,R,B){if(w.renderPass!=="translucent"||C.paint.get("raster-opacity")===0||!R.length)return;const{isRenderingToTexture:k}=B,F=S.getSource(),V=w.style.projection.useSubdivision;if(F instanceof rs)Fo(w,S,C,R,null,!1,!1,F.tileCoords,F.flippedWindingOrder,k);else if(V){const[G,J,Y]=w.stencilConfigForOverlapTwoPass(R);Fo(w,S,C,Y,G,!1,!0,Zc,!1,k),Fo(w,S,C,Y,J,!0,!0,Zc,!1,k)}else{const[G,J]=w.getStencilConfigForOverlapAndUpdateStencilID(R);Fo(w,S,C,J,G,!1,!0,Zc,!1,k)}}(s,h,p,g,y):a.ck(p)?function(w,S,C,R,B){const k=C.paint.get("background-color"),F=C.paint.get("background-opacity");if(F===0)return;const{isRenderingToTexture:V}=B,G=w.context,J=G.gl,Y=w.style.projection,Q=w.transform,se=Q.tileSize,ce=C.paint.get("background-pattern");if(w.isPatternMissing(ce))return;const ae=!ce&&k.a===1&&F===1&&w.opaquePassEnabledForLayer()?"opaque":"translucent";if(w.renderPass!==ae)return;const ue=jt.disabled,_e=w.getDepthModeForSublayer(0,ae==="opaque"?Rt.ReadWrite:Rt.ReadOnly),le=w.colorModeForRenderPass(),ve=w.useProgram(ce?"backgroundPattern":"background"),ke=R||we(Q,{tileSize:se,terrain:w.style.map.terrain});ce&&(G.activeTexture.set(J.TEXTURE0),w.imageManager.bind(w.context));const Me=C.getCrossfadeParameters();for(const Pe of ke){const Fe=Q.getProjectionData({overscaledTileID:Pe,applyGlobeMatrix:!V,applyTerrainMatrix:!0}),Ze=ce?wp(F,w,ce,{tileID:Pe,tileSize:se},Me):xp(F,k),Ye=w.style.map.terrain&&w.style.map.terrain.getTerrainData(Pe),je=Y.getMeshFromTileID(G,Pe.canonical,!1,!0,"raster");ve.draw(G,J.TRIANGLES,_e,ue,le,xt.backCCW,Ze,Ye,Fe,C.id,je.vertexBuffer,je.indexBuffer,je.segments)}}(s,0,p,g,y):a.cl(p)&&function(w,S,C,R){const{isRenderingGlobe:B}=R,k=w.context,F=C.implementation,V=w.style.projection,G=w.transform,J=G.getProjectionDataForCustomLayer(B),Y={farZ:G.farZ,nearZ:G.nearZ,fov:G.fov*Math.PI/180,modelViewProjectionMatrix:G.modelViewProjectionMatrix,projectionMatrix:G.projectionMatrix,shaderData:{variantName:V.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;
uniform mat4 u_projection_matrix;
${V.shaderPreludeCode.vertexSource}`,define:V.shaderDefine},defaultProjectionData:J},Q=F.renderingMode?F.renderingMode:"2d";if(w.renderPass==="offscreen"){const se=F.prerender;se&&(w.setCustomLayerDefaults(),k.setColorMode(w.colorModeForRenderPass()),se.call(F,k.gl,Y),k.setDirty(),w.setBaseState())}else if(w.renderPass==="translucent"){w.setCustomLayerDefaults(),k.setColorMode(w.colorModeForRenderPass()),k.setStencilMode(jt.disabled);const se=Q==="3d"?w.getDepthModeFor3D():w.getDepthModeForSublayer(0,Rt.ReadOnly);k.setDepthMode(se),F.render(k.gl,Y),k.setDirty(),w.setBaseState(),k.bindFramebuffer.set(null)}}(s,0,p,y))}saveTileTexture(s){const h=this._tileTextures[s.size[0]];h?h.push(s):this._tileTextures[s.size[0]]=[s]}getTileTexture(s){const h=this._tileTextures[s];return h&&h.length>0?h.pop():null}isPatternMissing(s){if(!s)return!1;if(!s.from||!s.to)return!0;const h=this.imageManager.getPattern(s.from.toString()),p=this.imageManager.getPattern(s.to.toString());return!h||!p}useProgram(s,h,p=!1,g=[]){this.cache=this.cache||{};const y=!!this.style.map.terrain,w=this.style.projection,S=p?de.projectionMercator:w.shaderPreludeCode,C=p?Mt:w.shaderDefine,R=s+(h?h.cacheKey:"")+`/${p?pi:w.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(y?"/terrain":"")+(g?`/${g.join("/")}`:"");return this.cache[R]||(this.cache[R]=new Eu(this.context,de[s],h,Pu[s],this._showOverdrawInspector,y,S,C,g)),this.cache[R]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const s=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(s.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new a.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:s,drawingBufferHeight:h}=this.context.gl;return this.width!==s||this.height!==h}}function ko(m,s){let h,p=!1,g=null,y=null;const w=()=>{g=null,p&&(m.apply(y,h),g=setTimeout(w,s),p=!1)};return(...S)=>(p=!0,y=this,h=S,g||w(),g)}class Jc{constructor(s){this._getCurrentHash=()=>{const h=window.location.hash.replace("#","");if(this._hashName){let p;return h.split("&").map(g=>g.split("=")).forEach(g=>{g[0]===this._hashName&&(p=g)}),(p&&p[1]||"").split("/")}return h.split("/")},this._onHashChange=()=>{const h=this._getCurrentHash();if(!this._isValidHash(h))return!1;const p=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(h[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+h[2],+h[1]],zoom:+h[0],bearing:p,pitch:+(h[4]||0)}),!0},this._updateHashUnthrottled=()=>{const h=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,h)},this._removeHash=()=>{const h=this._getCurrentHash();if(h.length===0)return;const p=h.join("/");let g=p;g.split("&").length>0&&(g=g.split("&")[0]),this._hashName&&(g=`${this._hashName}=${p}`);let y=window.location.hash.replace(g,"");y.startsWith("#&")?y=y.slice(0,1)+y.slice(2):y==="#"&&(y="");let w=window.location.href.replace(/(#.+)?$/,y);w=w.replace("&&","&"),window.history.replaceState(window.history.state,null,w)},this._updateHash=ko(this._updateHashUnthrottled,300),this._hashName=s&&encodeURIComponent(s)}addTo(s){return this._map=s,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(s){const h=this._map.getCenter(),p=Math.round(100*this._map.getZoom())/100,g=Math.ceil((p*Math.LN2+Math.log(512/360/.5))/Math.LN10),y=Math.pow(10,g),w=Math.round(h.lng*y)/y,S=Math.round(h.lat*y)/y,C=this._map.getBearing(),R=this._map.getPitch();let B="";if(B+=s?`/${w}/${S}/${p}`:`${p}/${S}/${w}`,(C||R)&&(B+="/"+Math.round(10*C)/10),R&&(B+=`/${Math.round(R)}`),this._hashName){const k=this._hashName;let F=!1;const V=window.location.hash.slice(1).split("&").map(G=>{const J=G.split("=")[0];return J===k?(F=!0,`${J}=${B}`):G}).filter(G=>G);return F||V.push(`${k}=${B}`),`#${V.join("&")}`}return`#${B}`}_isValidHash(s){if(s.length<3||s.some(isNaN))return!1;try{new a.S(+s[2],+s[1])}catch{return!1}const h=+s[0],p=+(s[3]||0),g=+(s[4]||0);return h>=this._map.getMinZoom()&&h<=this._map.getMaxZoom()&&p>=-180&&p<=180&&g>=this._map.getMinPitch()&&g<=this._map.getMaxPitch()}}const Dn={linearity:.3,easing:a.cm(0,0,.3,1)},Wu=a.e({deceleration:2500,maxSpeed:1400},Dn),Lp=a.e({deceleration:20,maxSpeed:1400},Dn),Up=a.e({deceleration:1e3,maxSpeed:360},Dn),zp=a.e({deceleration:1e3,maxSpeed:90},Dn),Vp=a.e({deceleration:1e3,maxSpeed:360},Dn);class jp{constructor(s){this._map=s,this.clear()}clear(){this._inertiaBuffer=[]}record(s){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:N.now(),settings:s})}_drainInertiaBuffer(){const s=this._inertiaBuffer,h=N.now();for(;s.length>0&&h-s[0].time>160;)s.shift()}_onMoveEnd(s){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const h={zoom:0,bearing:0,pitch:0,roll:0,pan:new a.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:y}of this._inertiaBuffer)h.zoom+=y.zoomDelta||0,h.bearing+=y.bearingDelta||0,h.pitch+=y.pitchDelta||0,h.roll+=y.rollDelta||0,y.panDelta&&h.pan._add(y.panDelta),y.around&&(h.around=y.around),y.pinchAround&&(h.pinchAround=y.pinchAround);const p=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,g={};if(h.pan.mag()){const y=ma(h.pan.mag(),p,a.e({},Wu,s||{})),w=h.pan.mult(y.amount/h.pan.mag()),S=this._map.cameraHelper.handlePanInertia(w,this._map.transform);g.center=S.easingCenter,g.offset=S.easingOffset,zs(g,y)}if(h.zoom){const y=ma(h.zoom,p,Lp);g.zoom=this._map.transform.zoom+y.amount,zs(g,y)}if(h.bearing){const y=ma(h.bearing,p,Up);g.bearing=this._map.transform.bearing+a.ah(y.amount,-179,179),zs(g,y)}if(h.pitch){const y=ma(h.pitch,p,zp);g.pitch=this._map.transform.pitch+y.amount,zs(g,y)}if(h.roll){const y=ma(h.roll,p,Vp);g.roll=this._map.transform.roll+a.ah(y.amount,-179,179),zs(g,y)}if(g.zoom||g.bearing){const y=h.pinchAround===void 0?h.around:h.pinchAround;g.around=y?this._map.unproject(y):this._map.getCenter()}return this.clear(),a.e(g,{noMoveStart:!0})}}function zs(m,s){(!m.duration||m.duration<s.duration)&&(m.duration=s.duration,m.easing=s.easing)}function ma(m,s,h){const{maxSpeed:p,linearity:g,deceleration:y}=h,w=a.ah(m*g/(s/1e3),-p,p),S=Math.abs(w)/(y*g);return{easing:h.easing,duration:1e3*S,amount:w*(S/2)}}class Jr extends a.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,h,p,g={}){p=p instanceof MouseEvent?p:new MouseEvent(s,p);const y=U.mousePos(h.getCanvas(),p),w=h.unproject(y);super(s,a.e({point:y,lngLat:w,originalEvent:p},g)),this._defaultPrevented=!1,this.target=h}}class ya extends a.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,h,p){const g=s==="touchend"?p.changedTouches:p.touches,y=U.touchPos(h.getCanvasContainer(),g),w=y.map(C=>h.unproject(C)),S=y.reduce((C,R,B,k)=>C.add(R.div(k.length)),new a.P(0,0));super(s,{points:y,point:S,lngLats:w,lngLat:h.unproject(S),originalEvent:p}),this._defaultPrevented=!1}}class Xu extends a.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,h,p){super(s,{originalEvent:p}),this._defaultPrevented=!1}}class Hp{constructor(s,h){this._map=s,this._clickTolerance=h.clickTolerance}reset(){delete this._mousedownPos}wheel(s){return this._firePreventable(new Xu(s.type,this._map,s))}mousedown(s,h){return this._mousedownPos=h,this._firePreventable(new Jr(s.type,this._map,s))}mouseup(s){this._map.fire(new Jr(s.type,this._map,s))}click(s,h){this._mousedownPos&&this._mousedownPos.dist(h)>=this._clickTolerance||this._map.fire(new Jr(s.type,this._map,s))}dblclick(s){return this._firePreventable(new Jr(s.type,this._map,s))}mouseover(s){this._map.fire(new Jr(s.type,this._map,s))}mouseout(s){this._map.fire(new Jr(s.type,this._map,s))}touchstart(s){return this._firePreventable(new ya(s.type,this._map,s))}touchmove(s){this._map.fire(new ya(s.type,this._map,s))}touchend(s){this._map.fire(new ya(s.type,this._map,s))}touchcancel(s){this._map.fire(new ya(s.type,this._map,s))}_firePreventable(s){if(this._map.fire(s),s.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Gp{constructor(s){this._map=s}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(s){this._map.fire(new Jr(s.type,this._map,s))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Jr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(s){this._delayContextMenu?this._contextMenuEvent=s:this._ignoreContextMenu||this._map.fire(new Jr(s.type,this._map,s)),this._map.listens("contextmenu")&&s.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ba{constructor(s){this._map=s}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(s){return this.transform.screenPointToLocation(a.P.convert(s),this._map.terrain)}}class qu{constructor(s,h){this._map=s,this._tr=new ba(s),this._el=s.getCanvasContainer(),this._container=s.getContainer(),this._clickTolerance=h.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(s,h){this.isEnabled()&&s.shiftKey&&s.button===0&&(U.disableDrag(),this._startPos=this._lastPos=h,this._active=!0)}mousemoveWindow(s,h){if(!this._active)return;const p=h;if(this._lastPos.equals(p)||!this._box&&p.dist(this._startPos)<this._clickTolerance)return;const g=this._startPos;this._lastPos=p,this._box||(this._box=U.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",s));const y=Math.min(g.x,p.x),w=Math.max(g.x,p.x),S=Math.min(g.y,p.y),C=Math.max(g.y,p.y);U.setTransform(this._box,`translate(${y}px,${S}px)`),this._box.style.width=w-y+"px",this._box.style.height=C-S+"px"}mouseupWindow(s,h){if(!this._active||s.button!==0)return;const p=this._startPos,g=h;if(this.reset(),U.suppressClick(),p.x!==g.x||p.y!==g.y)return this._map.fire(new a.l("boxzoomend",{originalEvent:s})),{cameraAnimation:y=>y.fitScreenCoordinates(p,g,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",s)}keydown(s){this._active&&s.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",s))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(U.remove(this._box),this._box=null),U.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(s,h){return this._map.fire(new a.l(s,{originalEvent:h}))}}function va(m,s){if(m.length!==s.length)throw new Error(`The number of touches and points are not equal - touches ${m.length}, points ${s.length}`);const h={};for(let p=0;p<m.length;p++)h[m[p].identifier]=s[p];return h}class $p{constructor(s){this.reset(),this.numTouches=s.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(s,h,p){(this.centroid||p.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=s.timeStamp),p.length===this.numTouches&&(this.centroid=function(g){const y=new a.P(0,0);for(const w of g)y._add(w);return y.div(g.length)}(h),this.touches=va(p,h)))}touchmove(s,h,p){if(this.aborted||!this.centroid)return;const g=va(p,h);for(const y in this.touches){const w=g[y];(!w||w.dist(this.touches[y])>30)&&(this.aborted=!0)}}touchend(s,h,p){if((!this.centroid||s.timeStamp-this.startTime>500)&&(this.aborted=!0),p.length===0){const g=!this.aborted&&this.centroid;if(this.reset(),g)return g}}}class Qr{constructor(s){this.singleTap=new $p(s),this.numTaps=s.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(s,h,p){this.singleTap.touchstart(s,h,p)}touchmove(s,h,p){this.singleTap.touchmove(s,h,p)}touchend(s,h,p){const g=this.singleTap.touchend(s,h,p);if(g){const y=s.timeStamp-this.lastTime<500,w=!this.lastTap||this.lastTap.dist(g)<30;if(y&&w||this.reset(),this.count++,this.lastTime=s.timeStamp,this.lastTap=g,this.count===this.numTaps)return this.reset(),g}}}class Vs{constructor(s){this._tr=new ba(s),this._zoomIn=new Qr({numTouches:1,numTaps:2}),this._zoomOut=new Qr({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(s,h,p){this._zoomIn.touchstart(s,h,p),this._zoomOut.touchstart(s,h,p)}touchmove(s,h,p){this._zoomIn.touchmove(s,h,p),this._zoomOut.touchmove(s,h,p)}touchend(s,h,p){const g=this._zoomIn.touchend(s,h,p),y=this._zoomOut.touchend(s,h,p),w=this._tr;return g?(this._active=!0,s.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:w.zoom+1,around:w.unproject(g)},{originalEvent:s})}):y?(this._active=!0,s.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:w.zoom-1,around:w.unproject(y)},{originalEvent:s})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class xa{constructor(s){this._enabled=!!s.enable,this._moveStateManager=s.moveStateManager,this._clickTolerance=s.clickTolerance||1,this._moveFunction=s.move,this._activateOnStart=!!s.activateOnStart,s.assignEvents(this),this.reset()}reset(s){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(s)}_move(...s){const h=this._moveFunction(...s);if(h.bearingDelta||h.pitchDelta||h.rollDelta||h.around||h.panDelta)return this._active=!0,h}dragStart(s,h){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(s)&&(this._moveStateManager.startMove(s),this._lastPoint=Array.isArray(h)?h[0]:h,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(s,h){if(!this.isEnabled())return;const p=this._lastPoint;if(!p)return;if(s.preventDefault(),!this._moveStateManager.isValidMoveEvent(s))return void this.reset(s);const g=Array.isArray(h)?h[0]:h;return!this._moved&&g.dist(p)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=g,this._move(p,g))}dragEnd(s){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(s)&&(this._moved&&U.suppressClick(),this.reset(s))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const js=0,wa=2,Vy={[js]:1,[wa]:2};class Il{constructor(s){this._correctEvent=s.checkCorrectEvent}startMove(s){const h=U.mouseButton(s);this._eventButton=h}endMove(s){delete this._eventButton}isValidStartEvent(s){return this._correctEvent(s)}isValidMoveEvent(s){return!function(h,p){const g=Vy[p];return h.buttons===void 0||(h.buttons&g)!==g}(s,this._eventButton)}isValidEndEvent(s){return U.mouseButton(s)===this._eventButton}}class jy{constructor(){this._firstTouch=void 0}_isOneFingerTouch(s){return s.targetTouches.length===1}_isSameTouchEvent(s){return s.targetTouches[0].identifier===this._firstTouch}startMove(s){this._firstTouch=s.targetTouches[0].identifier}endMove(s){delete this._firstTouch}isValidStartEvent(s){return this._isOneFingerTouch(s)}isValidMoveEvent(s){return this._isOneFingerTouch(s)&&this._isSameTouchEvent(s)}isValidEndEvent(s){return this._isOneFingerTouch(s)&&this._isSameTouchEvent(s)}}class Hy{constructor(s=new Il({checkCorrectEvent:()=>!0}),h=new jy){this.mouseMoveStateManager=s,this.oneFingerTouchMoveStateManager=h}_executeRelevantHandler(s,h,p){return s instanceof MouseEvent?h(s):typeof TouchEvent<"u"&&s instanceof TouchEvent?p(s):void 0}startMove(s){this._executeRelevantHandler(s,h=>this.mouseMoveStateManager.startMove(h),h=>this.oneFingerTouchMoveStateManager.startMove(h))}endMove(s){this._executeRelevantHandler(s,h=>this.mouseMoveStateManager.endMove(h),h=>this.oneFingerTouchMoveStateManager.endMove(h))}isValidStartEvent(s){return this._executeRelevantHandler(s,h=>this.mouseMoveStateManager.isValidStartEvent(h),h=>this.oneFingerTouchMoveStateManager.isValidStartEvent(h))}isValidMoveEvent(s){return this._executeRelevantHandler(s,h=>this.mouseMoveStateManager.isValidMoveEvent(h),h=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(h))}isValidEndEvent(s){return this._executeRelevantHandler(s,h=>this.mouseMoveStateManager.isValidEndEvent(h),h=>this.oneFingerTouchMoveStateManager.isValidEndEvent(h))}}const Ml=m=>{m.mousedown=m.dragStart,m.mousemoveWindow=m.dragMove,m.mouseup=m.dragEnd,m.contextmenu=s=>{s.preventDefault()}};class Rl{constructor(s,h){this._clickTolerance=s.clickTolerance||1,this._map=h,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new a.P(0,0)}_shouldBePrevented(s){return s<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(s,h,p){return this._calculateTransform(s,h,p)}touchmove(s,h,p){if(this._active){if(!this._shouldBePrevented(p.length))return s.preventDefault(),this._calculateTransform(s,h,p);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",s)}}touchend(s,h,p){this._calculateTransform(s,h,p),this._active&&this._shouldBePrevented(p.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(s,h,p){p.length>0&&(this._active=!0);const g=va(p,h),y=new a.P(0,0),w=new a.P(0,0);let S=0;for(const R in g){const B=g[R],k=this._touches[R];k&&(y._add(B),w._add(B.sub(k)),S++,g[R]=B)}if(this._touches=g,this._shouldBePrevented(S)||!w.mag())return;const C=w.div(S);return this._sum._add(C),this._sum.mag()<this._clickTolerance?void 0:{around:y.div(S),panDelta:C}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Hs{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(s,h,p){this._firstTwoTouches||p.length<2||(this._firstTwoTouches=[p[0].identifier,p[1].identifier],this._start([h[0],h[1]]))}touchmove(s,h,p){if(!this._firstTwoTouches)return;s.preventDefault();const[g,y]=this._firstTwoTouches,w=ot(p,h,g),S=ot(p,h,y);if(!w||!S)return;const C=this._aroundCenter?null:w.add(S).div(2);return this._move([w,S],C,s)}touchend(s,h,p){if(!this._firstTwoTouches)return;const[g,y]=this._firstTwoTouches,w=ot(p,h,g),S=ot(p,h,y);w&&S||(this._active&&U.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(s){this._enabled=!0,this._aroundCenter=!!s&&s.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function ot(m,s,h){for(let p=0;p<m.length;p++)if(m[p].identifier===h)return s[p]}function Zu(m,s){return Math.log(m/s)/Math.LN2}class Qc extends Hs{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(s){this._startDistance=this._distance=s[0].dist(s[1])}_move(s,h){const p=this._distance;if(this._distance=s[0].dist(s[1]),this._active||!(Math.abs(Zu(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Zu(this._distance,p),pinchAround:h}}}function Ku(m,s){return 180*m.angleWith(s)/Math.PI}class Ta extends Hs{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(s){this._startVector=this._vector=s[0].sub(s[1]),this._minDiameter=s[0].dist(s[1])}_move(s,h,p){const g=this._vector;if(this._vector=s[0].sub(s[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Ku(this._vector,g),pinchAround:h}}_isBelowThreshold(s){this._minDiameter=Math.min(this._minDiameter,s.mag());const h=25/(Math.PI*this._minDiameter)*360,p=Ku(s,this._startVector);return Math.abs(p)<h}}function No(m){return Math.abs(m.y)>Math.abs(m.x)}class eh extends Hs{constructor(s){super(),this._currentTouchCount=0,this._map=s}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(s,h,p){super.touchstart(s,h,p),this._currentTouchCount=p.length}_start(s){this._lastPoints=s,No(s[0].sub(s[1]))&&(this._valid=!1)}_move(s,h,p){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const g=s[0].sub(this._lastPoints[0]),y=s[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(g,y,p.timeStamp),this._valid?(this._lastPoints=s,this._active=!0,{pitchDelta:(g.y+y.y)/2*-.5}):void 0}gestureBeginsVertically(s,h,p){if(this._valid!==void 0)return this._valid;const g=s.mag()>=2,y=h.mag()>=2;if(!g&&!y)return;if(!g||!y)return this._firstMove===void 0&&(this._firstMove=p),p-this._firstMove<100&&void 0;const w=s.y>0==h.y>0;return No(s)&&No(h)&&w}}const Ut={panStep:100,bearingStep:15,pitchStep:10};class th{constructor(s){this._tr=new ba(s);const h=Ut;this._panStep=h.panStep,this._bearingStep=h.bearingStep,this._pitchStep=h.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(s){if(s.altKey||s.ctrlKey||s.metaKey)return;let h=0,p=0,g=0,y=0,w=0;switch(s.keyCode){case 61:case 107:case 171:case 187:h=1;break;case 189:case 109:case 173:h=-1;break;case 37:s.shiftKey?p=-1:(s.preventDefault(),y=-1);break;case 39:s.shiftKey?p=1:(s.preventDefault(),y=1);break;case 38:s.shiftKey?g=1:(s.preventDefault(),w=-1);break;case 40:s.shiftKey?g=-1:(s.preventDefault(),w=1);break;default:return}return this._rotationDisabled&&(p=0,g=0),{cameraAnimation:S=>{const C=this._tr;S.easeTo({duration:300,easeId:"keyboardHandler",easing:Gy,zoom:h?Math.round(C.zoom)+h*(s.shiftKey?2:1):C.zoom,bearing:C.bearing+p*this._bearingStep,pitch:C.pitch+g*this._pitchStep,offset:[-y*this._panStep,-w*this._panStep],center:C.center},{originalEvent:s})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Gy(m){return m*(2-m)}const ih=4.000244140625,$y=1/450;class Wp{constructor(s,h){this._onTimeout=p=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(p)},this._map=s,this._tr=new ba(s),this._triggerRenderFrame=h,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=$y}setZoomRate(s){this._defaultZoomRate=s}setWheelZoomRate(s){this._wheelZoomRate=s}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(s){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!s&&s.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(s){return!!this._map.cooperativeGestures.isEnabled()&&!(s.ctrlKey||this._map.cooperativeGestures.isBypassed(s))}wheel(s){if(!this.isEnabled())return;if(this._shouldBePrevented(s))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",s);let h=s.deltaMode===WheelEvent.DOM_DELTA_LINE?40*s.deltaY:s.deltaY;const p=N.now(),g=p-(this._lastWheelEventTime||0);this._lastWheelEventTime=p,h!==0&&h%ih==0?this._type="wheel":h!==0&&Math.abs(h)<4?this._type="trackpad":g>400?(this._type=null,this._lastValue=h,this._timeout=setTimeout(this._onTimeout,40,s)):this._type||(this._type=Math.abs(g*h)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,h+=this._lastValue)),s.shiftKey&&h&&(h/=4),this._type&&(this._lastWheelEvent=s,this._delta-=h,this._active||this._start(s)),s.preventDefault()}_start(s){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const h=U.mousePos(this._map.getCanvas(),s),p=this._tr;this._aroundPoint=this._aroundCenter?p.transform.locationToScreenPoint(a.S.convert(p.center)):h,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const s=this._tr.transform;if(typeof this._lastExpectedZoom=="number"){const S=s.zoom-this._lastExpectedZoom;typeof this._startZoom=="number"&&(this._startZoom+=S),typeof this._targetZoom=="number"&&(this._targetZoom+=S)}if(this._delta!==0){const S=this._type==="wheel"&&Math.abs(this._delta)>ih?this._wheelZoomRate:this._defaultZoomRate;let C=2/(1+Math.exp(-Math.abs(this._delta*S)));this._delta<0&&C!==0&&(C=1/C);const R=typeof this._targetZoom!="number"?s.scale:a.af(this._targetZoom);this._targetZoom=s.getConstrained(s.getCameraLngLat(),a.ak(R*C)).zoom,this._type==="wheel"&&(this._startZoom=s.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const h=typeof this._targetZoom!="number"?s.zoom:this._targetZoom,p=this._startZoom,g=this._easing;let y,w=!1;if(this._type==="wheel"&&p&&g){const S=N.now()-this._lastWheelEventTime,C=Math.min((S+5)/200,1),R=g(C);y=a.C.number(p,h,R),C<1?this._frameId||(this._frameId=!0):w=!0}else y=h,w=!0;return this._active=!0,w&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout},200)),this._lastExpectedZoom=y,{noInertia:!0,needsRenderFrame:!w,zoomDelta:y-s.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(s){let h=a.co;if(this._prevEase){const p=this._prevEase,g=(N.now()-p.start)/p.duration,y=p.easing(g+.01)-p.easing(g),w=.27/Math.sqrt(y*y+1e-4)*.01,S=Math.sqrt(.0729-w*w);h=a.cm(w,S,.25,1)}return this._prevEase={start:N.now(),duration:s,easing:h},h}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Yu{constructor(s,h){this._clickZoom=s,this._tapZoom=h}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Ju{constructor(s){this._tr=new ba(s),this.reset()}reset(){this._active=!1}dblclick(s,h){return s.preventDefault(),{cameraAnimation:p=>{p.easeTo({duration:300,zoom:this._tr.zoom+(s.shiftKey?-1:1),around:this._tr.unproject(h)},{originalEvent:s})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Xp{constructor(){this._tap=new Qr({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(s,h,p){if(!this._swipePoint)if(this._tapTime){const g=h[0],y=s.timeStamp-this._tapTime<500,w=this._tapPoint.dist(g)<30;y&&w?p.length>0&&(this._swipePoint=g,this._swipeTouch=p[0].identifier):this.reset()}else this._tap.touchstart(s,h,p)}touchmove(s,h,p){if(this._tapTime){if(this._swipePoint){if(p[0].identifier!==this._swipeTouch)return;const g=h[0],y=g.y-this._swipePoint.y;return this._swipePoint=g,s.preventDefault(),this._active=!0,{zoomDelta:y/128}}}else this._tap.touchmove(s,h,p)}touchend(s,h,p){if(this._tapTime)this._swipePoint&&p.length===0&&this.reset();else{const g=this._tap.touchend(s,h,p);g&&(this._tapTime=s.timeStamp,this._tapPoint=g)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class qp{constructor(s,h,p){this._el=s,this._mousePan=h,this._touchPan=p}enable(s){this._inertiaOptions=s||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Qu{constructor(s,h,p,g){this._pitchWithRotate=s.pitchWithRotate,this._rollEnabled=s.rollEnabled,this._mouseRotate=h,this._mousePitch=p,this._mouseRoll=g}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class Zp{constructor(s,h,p,g){this._el=s,this._touchZoom=h,this._touchRotate=p,this._tapDragZoom=g,this._rotationDisabled=!1,this._enabled=!0}enable(s){this._touchZoom.enable(s),this._rotationDisabled||this._touchRotate.enable(s),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class Kp{constructor(s,h){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=s,this._options=h,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const s=this._map.getCanvasContainer();s.classList.add("maplibregl-cooperative-gestures"),this._container=U.create("div","maplibregl-cooperative-gesture-screen",s);let h=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(h=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const p=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),g=document.createElement("div");g.className="maplibregl-desktop-message",g.textContent=h,this._container.appendChild(g);const y=document.createElement("div");y.className="maplibregl-mobile-message",y.textContent=p,this._container.appendChild(y),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(U.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(s){return s[this._bypassKey]}notifyGestureBlocked(s,h){this._enabled&&(this._map.fire(new a.l("cooperativegestureprevented",{gestureType:s,originalEvent:h})),this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const Gs=m=>m.zoom||m.drag||m.roll||m.pitch||m.rotate;class vi extends a.l{}function Aa(m){return m.panDelta&&m.panDelta.mag()||m.zoomDelta||m.bearingDelta||m.pitchDelta||m.rollDelta}class ed{constructor(s,h){this.handleWindowEvent=g=>{this.handleEvent(g,`${g.type}Window`)},this.handleEvent=(g,y)=>{if(g.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const w=g.type==="renderFrame"?void 0:g,S={needsRenderFrame:!1},C={},R={};for(const{handlerName:F,handler:V,allowed:G}of this._handlers){if(!V.isEnabled())continue;let J;if(this._blockedByActive(R,G,F))V.reset();else if(V[y||g.type]){if(a.cp(g,y||g.type)){const Y=U.mousePos(this._map.getCanvas(),g);J=V[y||g.type](g,Y)}else if(a.cq(g,y||g.type)){const Y=this._getMapTouches(g.touches),Q=U.touchPos(this._map.getCanvas(),Y);J=V[y||g.type](g,Q,Y)}else a.cr(y||g.type)||(J=V[y||g.type](g));this.mergeHandlerResult(S,C,J,F,w),J&&J.needsRenderFrame&&this._triggerRenderFrame()}(J||V.isActive())&&(R[F]=V)}const B={};for(const F in this._previousActiveHandlers)R[F]||(B[F]=w);this._previousActiveHandlers=R,(Object.keys(B).length||Aa(S))&&(this._changes.push([S,C,B]),this._triggerRenderFrame()),(Object.keys(R).length||Aa(S))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:k}=S;k&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],k(this._map))},this._map=s,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new jp(s),this._bearingSnap=h.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(h);const p=this._el;this._listeners=[[p,"touchstart",{passive:!0}],[p,"touchmove",{passive:!1}],[p,"touchend",void 0],[p,"touchcancel",void 0],[p,"mousedown",void 0],[p,"mousemove",void 0],[p,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[p,"mouseover",void 0],[p,"mouseout",void 0],[p,"dblclick",void 0],[p,"click",void 0],[p,"keydown",{capture:!1}],[p,"keyup",void 0],[p,"wheel",{passive:!1}],[p,"contextmenu",void 0],[window,"blur",void 0]];for(const[g,y,w]of this._listeners)U.addEventListener(g,y,g===document?this.handleWindowEvent:this.handleEvent,w)}destroy(){for(const[s,h,p]of this._listeners)U.removeEventListener(s,h,s===document?this.handleWindowEvent:this.handleEvent,p)}_addDefaultHandlers(s){const h=this._map,p=h.getCanvasContainer();this._add("mapEvent",new Hp(h,s));const g=h.boxZoom=new qu(h,s);this._add("boxZoom",g),s.interactive&&s.boxZoom&&g.enable();const y=h.cooperativeGestures=new Kp(h,s.cooperativeGestures);this._add("cooperativeGestures",y),s.cooperativeGestures&&y.enable();const w=new Vs(h),S=new Ju(h);h.doubleClickZoom=new Yu(S,w),this._add("tapZoom",w),this._add("clickZoom",S),s.interactive&&s.doubleClickZoom&&h.doubleClickZoom.enable();const C=new Xp;this._add("tapDragZoom",C);const R=h.touchPitch=new eh(h);this._add("touchPitch",R),s.interactive&&s.touchPitch&&h.touchPitch.enable(s.touchPitch);const B=()=>h.project(h.getCenter()),k=function({enable:ae,clickTolerance:ue,aroundCenter:_e=!0,minPixelCenterThreshold:le=100,rotateDegreesPerPixelMoved:ve=.8},ke){const Me=new Il({checkCorrectEvent:Pe=>U.mouseButton(Pe)===0&&Pe.ctrlKey||U.mouseButton(Pe)===2&&!Pe.ctrlKey});return new xa({clickTolerance:ue,move:(Pe,Fe)=>{const Ze=ke();if(_e&&Math.abs(Ze.y-Pe.y)>le)return{bearingDelta:a.cn(new a.P(Pe.x,Fe.y),Fe,Ze)};let Ye=(Fe.x-Pe.x)*ve;return _e&&Fe.y<Ze.y&&(Ye=-Ye),{bearingDelta:Ye}},moveStateManager:Me,enable:ae,assignEvents:Ml})}(s,B),F=function({enable:ae,clickTolerance:ue,pitchDegreesPerPixelMoved:_e=-.5}){const le=new Il({checkCorrectEvent:ve=>U.mouseButton(ve)===0&&ve.ctrlKey||U.mouseButton(ve)===2});return new xa({clickTolerance:ue,move:(ve,ke)=>({pitchDelta:(ke.y-ve.y)*_e}),moveStateManager:le,enable:ae,assignEvents:Ml})}(s),V=function({enable:ae,clickTolerance:ue,rollDegreesPerPixelMoved:_e=.3},le){const ve=new Il({checkCorrectEvent:ke=>U.mouseButton(ke)===2&&ke.ctrlKey});return new xa({clickTolerance:ue,move:(ke,Me)=>{const Pe=le();let Fe=(Me.x-ke.x)*_e;return Me.y<Pe.y&&(Fe=-Fe),{rollDelta:Fe}},moveStateManager:ve,enable:ae,assignEvents:Ml})}(s,B);h.dragRotate=new Qu(s,k,F,V),this._add("mouseRotate",k,["mousePitch"]),this._add("mousePitch",F,["mouseRotate","mouseRoll"]),this._add("mouseRoll",V,["mousePitch"]),s.interactive&&s.dragRotate&&h.dragRotate.enable();const G=function({enable:ae,clickTolerance:ue}){const _e=new Il({checkCorrectEvent:le=>U.mouseButton(le)===0&&!le.ctrlKey});return new xa({clickTolerance:ue,move:(le,ve)=>({around:ve,panDelta:ve.sub(le)}),activateOnStart:!0,moveStateManager:_e,enable:ae,assignEvents:Ml})}(s),J=new Rl(s,h);h.dragPan=new qp(p,G,J),this._add("mousePan",G),this._add("touchPan",J,["touchZoom","touchRotate"]),s.interactive&&s.dragPan&&h.dragPan.enable(s.dragPan);const Y=new Ta,Q=new Qc;h.touchZoomRotate=new Zp(p,Q,Y,C),this._add("touchRotate",Y,["touchPan","touchZoom"]),this._add("touchZoom",Q,["touchPan","touchRotate"]),s.interactive&&s.touchZoomRotate&&h.touchZoomRotate.enable(s.touchZoomRotate);const se=h.scrollZoom=new Wp(h,()=>this._triggerRenderFrame());this._add("scrollZoom",se,["mousePan"]),s.interactive&&s.scrollZoom&&h.scrollZoom.enable(s.scrollZoom);const ce=h.keyboard=new th(h);this._add("keyboard",ce),s.interactive&&s.keyboard&&h.keyboard.enable(),this._add("blockableMapEvent",new Gp(h))}_add(s,h,p){this._handlers.push({handlerName:s,handler:h,allowed:p}),this._handlersById[s]=h}stop(s){if(!this._updatingCamera){for(const{handler:h}of this._handlers)h.reset();this._inertia.clear(),this._fireEvents({},{},s),this._changes=[]}}isActive(){for(const{handler:s}of this._handlers)if(s.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Gs(this._eventsInProgress)||this.isZooming()}_blockedByActive(s,h,p){for(const g in s)if(g!==p&&(!h||h.indexOf(g)<0))return!0;return!1}_getMapTouches(s){const h=[];for(const p of s)this._el.contains(p.target)&&h.push(p);return h}mergeHandlerResult(s,h,p,g,y){if(!p)return;a.e(s,p);const w={handlerName:g,originalEvent:p.originalEvent||y};p.zoomDelta!==void 0&&(h.zoom=w),p.panDelta!==void 0&&(h.drag=w),p.rollDelta!==void 0&&(h.roll=w),p.pitchDelta!==void 0&&(h.pitch=w),p.bearingDelta!==void 0&&(h.rotate=w)}_applyChanges(){const s={},h={},p={};for(const[g,y,w]of this._changes)g.panDelta&&(s.panDelta=(s.panDelta||new a.P(0,0))._add(g.panDelta)),g.zoomDelta&&(s.zoomDelta=(s.zoomDelta||0)+g.zoomDelta),g.bearingDelta&&(s.bearingDelta=(s.bearingDelta||0)+g.bearingDelta),g.pitchDelta&&(s.pitchDelta=(s.pitchDelta||0)+g.pitchDelta),g.rollDelta&&(s.rollDelta=(s.rollDelta||0)+g.rollDelta),g.around!==void 0&&(s.around=g.around),g.pinchAround!==void 0&&(s.pinchAround=g.pinchAround),g.noInertia&&(s.noInertia=g.noInertia),a.e(h,y),a.e(p,w);this._updateMapTransform(s,h,p),this._changes=[]}_updateMapTransform(s,h,p){const g=this._map,y=g._getTransformForUpdate(),w=g.terrain;if(!(Aa(s)||w&&this._terrainMovement))return this._fireEvents(h,p,!0);g._stop(!0);let{panDelta:S,zoomDelta:C,bearingDelta:R,pitchDelta:B,rollDelta:k,around:F,pinchAround:V}=s;V!==void 0&&(F=V),F=F||g.transform.centerPoint,w&&!y.isPointOnMapSurface(F)&&(F=y.centerPoint);const G={panDelta:S,zoomDelta:C,rollDelta:k,pitchDelta:B,bearingDelta:R,around:F};this._map.cameraHelper.useGlobeControls&&!y.isPointOnMapSurface(F)&&(F=y.centerPoint);const J=F.distSqr(y.centerPoint)<.01?y.center:y.screenPointToLocation(S?F.sub(S):F);w?(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(G,y),this._terrainMovement||!h.drag&&!h.zoom?h.drag&&this._terrainMovement?y.setCenter(y.screenPointToLocation(y.centerPoint.sub(S))):this._map.cameraHelper.handleMapControlsPan(G,y,J):(this._terrainMovement=!0,this._map._elevationFreeze=!0,this._map.cameraHelper.handleMapControlsPan(G,y,J))):(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(G,y),this._map.cameraHelper.handleMapControlsPan(G,y,J)),g._applyUpdatedTransform(y),this._map._update(),s.noInertia||this._inertia.record(s),this._fireEvents(h,p,!0)}_fireEvents(s,h,p){const g=Gs(this._eventsInProgress),y=Gs(s),w={};for(const k in s){const{originalEvent:F}=s[k];this._eventsInProgress[k]||(w[`${k}start`]=F),this._eventsInProgress[k]=s[k]}!g&&y&&this._fireEvent("movestart",y.originalEvent);for(const k in w)this._fireEvent(k,w[k]);y&&this._fireEvent("move",y.originalEvent);for(const k in s){const{originalEvent:F}=s[k];this._fireEvent(k,F)}const S={};let C;for(const k in this._eventsInProgress){const{handlerName:F,originalEvent:V}=this._eventsInProgress[k];this._handlersById[F].isActive()||(delete this._eventsInProgress[k],C=h[F]||V,S[`${k}end`]=C)}for(const k in S)this._fireEvent(k,S[k]);const R=Gs(this._eventsInProgress),B=(g||y)&&!R;if(B&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const k=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&k.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform(k)}if(p&&B){this._updatingCamera=!0;const k=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),F=V=>V!==0&&-this._bearingSnap<V&&V<this._bearingSnap;!k||!k.essential&&N.prefersReducedMotion?(this._map.fire(new a.l("moveend",{originalEvent:C})),F(this._map.getBearing())&&this._map.resetNorth()):(F(k.bearing||this._map.getBearing())&&(k.bearing=0),k.freezeElevation=!0,this._map.easeTo(k,{originalEvent:C})),this._updatingCamera=!1}}_fireEvent(s,h){this._map.fire(new a.l(s,h?{originalEvent:h}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(s=>{delete this._frameId,this.handleEvent(new vi("renderFrame",{timeStamp:s})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Yp extends a.E{constructor(s,h,p){super(),this._renderFrameCallback=()=>{const g=Math.min((N.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(g)),g<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=s,this._bearingSnap=p.bearingSnap,this.cameraHelper=h,this.on("moveend",()=>{delete this._requestedCameraState})}migrateProjection(s,h){s.apply(this.transform),this.transform=s,this.cameraHelper=h}getCenter(){return new a.S(this.transform.center.lng,this.transform.center.lat)}setCenter(s,h){return this.jumpTo({center:s},h)}getCenterElevation(){return this.transform.elevation}setCenterElevation(s,h){return this.jumpTo({elevation:s},h),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(s){this._centerClampedToGround=s}panBy(s,h,p){return s=a.P.convert(s).mult(-1),this.panTo(this.transform.center,a.e({offset:s},h),p)}panTo(s,h,p){return this.easeTo(a.e({center:s},h),p)}getZoom(){return this.transform.zoom}setZoom(s,h){return this.jumpTo({zoom:s},h),this}zoomTo(s,h,p){return this.easeTo(a.e({zoom:s},h),p)}zoomIn(s,h){return this.zoomTo(this.getZoom()+1,s,h),this}zoomOut(s,h){return this.zoomTo(this.getZoom()-1,s,h),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(s,h){return s!=this.transform.fov&&(this.transform.setFov(s),this.fire(new a.l("movestart",h)).fire(new a.l("move",h)).fire(new a.l("moveend",h))),this}getBearing(){return this.transform.bearing}setBearing(s,h){return this.jumpTo({bearing:s},h),this}getPadding(){return this.transform.padding}setPadding(s,h){return this.jumpTo({padding:s},h),this}rotateTo(s,h,p){return this.easeTo(a.e({bearing:s},h),p)}resetNorth(s,h){return this.rotateTo(0,a.e({duration:1e3},s),h),this}resetNorthPitch(s,h){return this.easeTo(a.e({bearing:0,pitch:0,roll:0,duration:1e3},s),h),this}snapToNorth(s,h){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(s,h):this}getPitch(){return this.transform.pitch}setPitch(s,h){return this.jumpTo({pitch:s},h),this}getRoll(){return this.transform.roll}setRoll(s,h){return this.jumpTo({roll:s},h),this}cameraForBounds(s,h){s=oi.convert(s).adjustAntiMeridian();const p=h&&h.bearing||0;return this._cameraForBoxAndBearing(s.getNorthWest(),s.getSouthEast(),p,h)}_cameraForBoxAndBearing(s,h,p,g){const y={top:0,bottom:0,right:0,left:0};if(typeof(g=a.e({padding:y,offset:[0,0],maxZoom:this.transform.maxZoom},g)).padding=="number"){const R=g.padding;g.padding={top:R,bottom:R,right:R,left:R}}const w=a.e(y,g.padding);g.padding=w;const S=this.transform,C=new oi(s,h);return this.cameraHelper.cameraForBoxAndBearing(g,w,C,p,S)}fitBounds(s,h,p){return this._fitInternal(this.cameraForBounds(s,h),h,p)}fitScreenCoordinates(s,h,p,g,y){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(a.P.convert(s)),this.transform.screenPointToLocation(a.P.convert(h)),p,g),g,y)}_fitInternal(s,h,p){return s?(delete(h=a.e(s,h)).padding,h.linear?this.easeTo(h,p):this.flyTo(h,p)):this}jumpTo(s,h){this.stop();const p=this._getTransformForUpdate();let g=!1,y=!1,w=!1;const S=p.zoom;this.cameraHelper.handleJumpToCenterZoom(p,s);const C=p.zoom!==S;return"elevation"in s&&p.elevation!==+s.elevation&&p.setElevation(+s.elevation),"bearing"in s&&p.bearing!==+s.bearing&&(g=!0,p.setBearing(+s.bearing)),"pitch"in s&&p.pitch!==+s.pitch&&(y=!0,p.setPitch(+s.pitch)),"roll"in s&&p.roll!==+s.roll&&(w=!0,p.setRoll(+s.roll)),s.padding==null||p.isPaddingEqual(s.padding)||p.setPadding(s.padding),this._applyUpdatedTransform(p),this.fire(new a.l("movestart",h)).fire(new a.l("move",h)),C&&this.fire(new a.l("zoomstart",h)).fire(new a.l("zoom",h)).fire(new a.l("zoomend",h)),g&&this.fire(new a.l("rotatestart",h)).fire(new a.l("rotate",h)).fire(new a.l("rotateend",h)),y&&this.fire(new a.l("pitchstart",h)).fire(new a.l("pitch",h)).fire(new a.l("pitchend",h)),w&&this.fire(new a.l("rollstart",h)).fire(new a.l("roll",h)).fire(new a.l("rollend",h)),this.fire(new a.l("moveend",h))}calculateCameraOptionsFromTo(s,h,p,g=0){const y=a.a1.fromLngLat(s,h),w=a.a1.fromLngLat(p,g),S=w.x-y.x,C=w.y-y.y,R=w.z-y.z,B=Math.hypot(S,C,R);if(B===0)throw new Error("Can't calculate camera options with same From and To");const k=Math.hypot(S,C),F=a.ak(this.transform.cameraToCenterDistance/B/this.transform.tileSize),V=180*Math.atan2(S,-C)/Math.PI;let G=180*Math.acos(k/B)/Math.PI;return G=R<0?90-G:90+G,{center:w.toLngLat(),elevation:g,zoom:F,pitch:G,bearing:V}}calculateCameraOptionsFromCameraLngLatAltRotation(s,h,p,g,y){const w=this.transform.calculateCenterFromCameraLngLatAlt(s,h,p,g);return{center:w.center,elevation:w.elevation,zoom:w.zoom,bearing:p,pitch:g,roll:y}}easeTo(s,h){this._stop(!1,s.easeId),((s=a.e({offset:[0,0],duration:500,easing:a.co},s)).animate===!1||!s.essential&&N.prefersReducedMotion)&&(s.duration=0);const p=this._getTransformForUpdate(),g=this.getBearing(),y=p.pitch,w=p.roll,S="bearing"in s?this._normalizeBearing(s.bearing,g):g,C="pitch"in s?+s.pitch:y,R="roll"in s?this._normalizeBearing(s.roll,w):w,B="padding"in s?s.padding:p.padding,k=a.P.convert(s.offset);let F,V;s.around&&(F=a.S.convert(s.around),V=p.locationToScreenPoint(F));const G={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},J=this.cameraHelper.handleEaseTo(p,{bearing:S,pitch:C,roll:R,padding:B,around:F,aroundPoint:V,offsetAsPoint:k,offset:s.offset,zoom:s.zoom,center:s.center});return this._rotating=this._rotating||g!==S,this._pitching=this._pitching||C!==y,this._rolling=this._rolling||R!==w,this._padding=!p.isPaddingEqual(B),this._zooming=this._zooming||J.isZooming,this._easeId=s.easeId,this._prepareEase(h,s.noMoveStart,G),this.terrain&&this._prepareElevation(J.elevationCenter),this._ease(Y=>{J.easeFunc(Y),this.terrain&&!s.freezeElevation&&this._updateElevation(Y),this._applyUpdatedTransform(p),this._fireMoveEvents(h)},Y=>{this.terrain&&s.freezeElevation&&this._finalizeElevation(),this._afterEase(h,Y)},s),this}_prepareEase(s,h,p={}){this._moving=!0,h||p.moving||this.fire(new a.l("movestart",s)),this._zooming&&!p.zooming&&this.fire(new a.l("zoomstart",s)),this._rotating&&!p.rotating&&this.fire(new a.l("rotatestart",s)),this._pitching&&!p.pitching&&this.fire(new a.l("pitchstart",s)),this._rolling&&!p.rolling&&this.fire(new a.l("rollstart",s))}_prepareElevation(s){this._elevationCenter=s,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(s,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(s){this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));const h=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(s<1&&h!==this._elevationTarget){const p=this._elevationTarget-this._elevationStart;this._elevationStart+=s*(p-(h-(p*s+this._elevationStart))/(1-s)),this._elevationTarget=h}this.transform.setElevation(a.C.number(this._elevationStart,this._elevationTarget,s))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(s){if(!this.terrain&&s.elevation>=0&&s.pitch<=90)return{};const h=s.getCameraLngLat(),p=s.getCameraAltitude(),g=this.terrain?this.terrain.getElevationForLngLatZoom(h,s.zoom):0;if(p<g){const y=this.calculateCameraOptionsFromTo(h,g,s.center,s.elevation);return{pitch:y.pitch,zoom:y.zoom}}return{}}_applyUpdatedTransform(s){const h=[];if(h.push(g=>this._elevateCameraIfInsideTerrain(g)),this.transformCameraUpdate&&h.push(g=>this.transformCameraUpdate(g)),!h.length)return;const p=s.clone();for(const g of h){const y=p.clone(),{center:w,zoom:S,roll:C,pitch:R,bearing:B,elevation:k}=g(y);w&&y.setCenter(w),k!==void 0&&y.setElevation(k),S!==void 0&&y.setZoom(S),C!==void 0&&y.setRoll(C),R!==void 0&&y.setPitch(R),B!==void 0&&y.setBearing(B),p.apply(y)}this.transform.apply(p)}_fireMoveEvents(s){this.fire(new a.l("move",s)),this._zooming&&this.fire(new a.l("zoom",s)),this._rotating&&this.fire(new a.l("rotate",s)),this._pitching&&this.fire(new a.l("pitch",s)),this._rolling&&this.fire(new a.l("roll",s))}_afterEase(s,h){if(this._easeId&&h&&this._easeId===h)return;delete this._easeId;const p=this._zooming,g=this._rotating,y=this._pitching,w=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,p&&this.fire(new a.l("zoomend",s)),g&&this.fire(new a.l("rotateend",s)),y&&this.fire(new a.l("pitchend",s)),w&&this.fire(new a.l("rollend",s)),this.fire(new a.l("moveend",s))}flyTo(s,h){if(!s.essential&&N.prefersReducedMotion){const Fe=a.Q(s,["center","zoom","bearing","pitch","roll","elevation"]);return this.jumpTo(Fe,h)}this.stop(),s=a.e({offset:[0,0],speed:1.2,curve:1.42,easing:a.co},s);const p=this._getTransformForUpdate(),g=p.bearing,y=p.pitch,w=p.roll,S=p.padding,C="bearing"in s?this._normalizeBearing(s.bearing,g):g,R="pitch"in s?+s.pitch:y,B="roll"in s?this._normalizeBearing(s.roll,w):w,k="padding"in s?s.padding:p.padding,F=a.P.convert(s.offset);let V=p.centerPoint.add(F);const G=p.screenPointToLocation(V),J=this.cameraHelper.handleFlyTo(p,{bearing:C,pitch:R,roll:B,padding:k,locationAtOffset:G,offsetAsPoint:F,center:s.center,minZoom:s.minZoom,zoom:s.zoom});let Y=s.curve;const Q=Math.max(p.width,p.height),se=Q/J.scaleOfZoom,ce=J.pixelPathLength;typeof J.scaleOfMinZoom=="number"&&(Y=Math.sqrt(Q/J.scaleOfMinZoom/ce*2));const ae=Y*Y;function ue(Fe){const Ze=(se*se-Q*Q+(Fe?-1:1)*ae*ae*ce*ce)/(2*(Fe?se:Q)*ae*ce);return Math.log(Math.sqrt(Ze*Ze+1)-Ze)}function _e(Fe){return(Math.exp(Fe)-Math.exp(-Fe))/2}function le(Fe){return(Math.exp(Fe)+Math.exp(-Fe))/2}const ve=ue(!1);let ke=function(Fe){return le(ve)/le(ve+Y*Fe)},Me=function(Fe){return Q*((le(ve)*(_e(Ze=ve+Y*Fe)/le(Ze))-_e(ve))/ae)/ce;var Ze},Pe=(ue(!0)-ve)/Y;if(Math.abs(ce)<2e-6||!isFinite(Pe)){if(Math.abs(Q-se)<1e-6)return this.easeTo(s,h);const Fe=se<Q?-1:1;Pe=Math.abs(Math.log(se/Q))/Y,Me=()=>0,ke=Ze=>Math.exp(Fe*Y*Ze)}return s.duration="duration"in s?+s.duration:1e3*Pe/("screenSpeed"in s?+s.screenSpeed/Y:+s.speed),s.maxDuration&&s.duration>s.maxDuration&&(s.duration=0),this._zooming=!0,this._rotating=g!==C,this._pitching=R!==y,this._rolling=B!==w,this._padding=!p.isPaddingEqual(k),this._prepareEase(h,!1),this.terrain&&this._prepareElevation(J.targetCenter),this._ease(Fe=>{const Ze=Fe*Pe,Ye=1/ke(Ze),je=Me(Ze);this._rotating&&p.setBearing(a.C.number(g,C,Fe)),this._pitching&&p.setPitch(a.C.number(y,R,Fe)),this._rolling&&p.setRoll(a.C.number(w,B,Fe)),this._padding&&(p.interpolatePadding(S,k,Fe),V=p.centerPoint.add(F)),J.easeFunc(Fe,Ye,je,V),this.terrain&&!s.freezeElevation&&this._updateElevation(Fe),this._applyUpdatedTransform(p),this._fireMoveEvents(h)},()=>{this.terrain&&s.freezeElevation&&this._finalizeElevation(),this._afterEase(h)},s),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(s,h){var p;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const g=this._onEaseEnd;delete this._onEaseEnd,g.call(this,h)}return s||(p=this.handlers)===null||p===void 0||p.stop(!1),this}_ease(s,h,p){p.animate===!1||p.duration===0?(s(1),h()):(this._easeStart=N.now(),this._easeOptions=p,this._onEaseFrame=s,this._onEaseEnd=h,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(s,h){s=a.aO(s,-180,180);const p=Math.abs(s-h);return Math.abs(s-360-h)<p&&(s-=360),Math.abs(s+360-h)<p&&(s+=360),s}queryTerrainElevation(s){return this.terrain?this.terrain.getElevationForLngLatZoom(a.S.convert(s),this.transform.tileZoom):null}}const td={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class id{constructor(s=td){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=h=>{!h||h.sourceDataType!=="metadata"&&h.sourceDataType!=="visibility"&&h.dataType!=="style"&&h.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=s}getDefaultPosition(){return"bottom-right"}onAdd(s){return this._map=s,this._compact=this.options.compact,this._container=U.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=U.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=U.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){U.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(s,h){const p=this._map._getUIString(`AttributionControl.${h}`);s.title=p,s.setAttribute("aria-label",p)}_updateAttributions(){if(!this._map.style)return;let s=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?s=s.concat(this.options.customAttribution.map(g=>typeof g!="string"?"":g)):typeof this.options.customAttribution=="string"&&s.push(this.options.customAttribution)),this._map.style.stylesheet){const g=this._map.style.stylesheet;this.styleOwner=g.owner,this.styleId=g.id}const h=this._map.style.sourceCaches;for(const g in h){const y=h[g];if(y.used||y.usedForTerrain){const w=y.getSource();w.attribution&&s.indexOf(w.attribution)<0&&s.push(w.attribution)}}s=s.filter(g=>String(g).trim()),s.sort((g,y)=>g.length-y.length),s=s.filter((g,y)=>{for(let w=y+1;w<s.length;w++)if(s[w].indexOf(g)>=0)return!1;return!0});const p=s.join(" | ");p!==this._attribHTML&&(this._attribHTML=p,s.length?(this._innerContainer.innerHTML=U.sanitize(p),this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Jp{constructor(s={}){this._updateCompact=()=>{const h=this._container.children;if(h.length){const p=h[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&p.classList.add("maplibregl-compact"):p.classList.remove("maplibregl-compact")}},this.options=s}getDefaultPosition(){return"bottom-left"}onAdd(s){this._map=s,this._compact=this.options&&this.options.compact,this._container=U.create("div","maplibregl-ctrl");const h=U.create("a","maplibregl-ctrl-logo");return h.target="_blank",h.rel="noopener nofollow",h.href="https://maplibre.org/",h.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),h.setAttribute("rel","noopener nofollow"),this._container.appendChild(h),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){U.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class gn{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(s){const h=++this._id;return this._queue.push({callback:s,id:h,cancelled:!1}),h}remove(s){const h=this._currentlyRunning,p=h?this._queue.concat(h):this._queue;for(const g of p)if(g.id===s)return void(g.cancelled=!0)}run(s=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const h=this._currentlyRunning=this._queue;this._queue=[];for(const p of h)if(!p.cancelled&&(p.callback(s),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var rh=a.aJ([{name:"a_pos3d",type:"Int16",components:3}]);class ft extends a.E{constructor(s){super(),this._lastTilesetChange=N.now(),this.sourceCache=s,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=s._source.tileSize*2**this.deltaZoom,s.usedForTerrain=!0,s.tileSize=this.tileSize}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(s,h){this.sourceCache.update(s,h),this._renderableTilesKeys=[];const p={};for(const g of we(s,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:h,calculateTileZoom:this.sourceCache._source.calculateTileZoom}))p[g.key]=!0,this._renderableTilesKeys.push(g.key),this._tiles[g.key]||(g.terrainRttPosMatrix32f=new Float64Array(16),a.bY(g.terrainRttPosMatrix32f,0,a.$,a.$,0,0,1),this._tiles[g.key]=new Rn(g,this.tileSize),this._lastTilesetChange=N.now());for(const g in this._tiles)p[g]||delete this._tiles[g]}freeRtt(s){for(const h in this._tiles){const p=this._tiles[h];(!s||p.tileID.equals(s)||p.tileID.isChildOf(s)||s.isChildOf(p.tileID))&&(p.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(s=>this.getTileByID(s))}getTileByID(s){return this._tiles[s]}getTerrainCoords(s,h){return h?this._getTerrainCoordsForTileRanges(s,h):this._getTerrainCoordsForRegularTile(s)}_getTerrainCoordsForRegularTile(s){const h={};for(const p of this._renderableTilesKeys){const g=this._tiles[p].tileID,y=s.clone(),w=a.ba();if(g.canonical.equals(s.canonical))a.bY(w,0,a.$,a.$,0,0,1);else if(g.canonical.isChildOf(s.canonical)){const S=g.canonical.z-s.canonical.z,C=g.canonical.x-(g.canonical.x>>S<<S),R=g.canonical.y-(g.canonical.y>>S<<S),B=a.$>>S;a.bY(w,0,B,B,0,0,1),a.M(w,w,[-C*B,-R*B,0])}else{if(!s.canonical.isChildOf(g.canonical))continue;{const S=s.canonical.z-g.canonical.z,C=s.canonical.x-(s.canonical.x>>S<<S),R=s.canonical.y-(s.canonical.y>>S<<S),B=a.$>>S;a.bY(w,0,a.$,a.$,0,0,1),a.M(w,w,[C*B,R*B,0]),a.N(w,w,[1/2**S,1/2**S,0])}}y.terrainRttPosMatrix32f=new Float32Array(w),h[p]=y}return h}_getTerrainCoordsForTileRanges(s,h){const p={};for(const g of this._renderableTilesKeys){const y=this._tiles[g].tileID;if(!this._isWithinTileRanges(y,h))continue;const w=s.clone(),S=a.ba();if(y.canonical.z===s.canonical.z){const C=s.canonical.x-y.canonical.x,R=s.canonical.y-y.canonical.y;a.bY(S,0,a.$,a.$,0,0,1),a.M(S,S,[C*a.$,R*a.$,0])}else if(y.canonical.z>s.canonical.z){const C=y.canonical.z-s.canonical.z,R=y.canonical.x-(y.canonical.x>>C<<C),B=y.canonical.y-(y.canonical.y>>C<<C),k=s.canonical.x-(y.canonical.x>>C),F=s.canonical.y-(y.canonical.y>>C),V=a.$>>C;a.bY(S,0,V,V,0,0,1),a.M(S,S,[-R*V+k*a.$,-B*V+F*a.$,0])}else{const C=s.canonical.z-y.canonical.z,R=s.canonical.x-(s.canonical.x>>C<<C),B=s.canonical.y-(s.canonical.y>>C<<C),k=(s.canonical.x>>C)-y.canonical.x,F=(s.canonical.y>>C)-y.canonical.y,V=a.$<<C;a.bY(S,0,V,V,0,0,1),a.M(S,S,[R*a.$+k*V,B*a.$+F*V,0])}w.terrainRttPosMatrix32f=new Float32Array(S),p[g]=w}return p}getSourceTile(s,h){const p=this.sourceCache._source;let g=s.overscaledZ-this.deltaZoom;if(g>p.maxzoom&&(g=p.maxzoom),g<p.minzoom)return null;this._sourceTileCache[s.key]||(this._sourceTileCache[s.key]=s.scaledTo(g).key);let y=this.sourceCache.getTileByID(this._sourceTileCache[s.key]);if((!y||!y.dem)&&h)for(;g>=p.minzoom&&(!y||!y.dem);)y=this.sourceCache.getTileByID(s.scaledTo(g--).key);return y}anyTilesAfterTime(s=Date.now()){return this._lastTilesetChange>=s}_isWithinTileRanges(s,h){return h[s.canonical.z]&&s.canonical.x>=h[s.canonical.z].minTileX&&s.canonical.x<=h[s.canonical.z].maxTileX&&s.canonical.y>=h[s.canonical.z].minTileY&&s.canonical.y<=h[s.canonical.z].maxTileY}}class vt{constructor(s,h,p){this._meshCache={},this.painter=s,this.sourceCache=new ft(h),this.options=p,this.exaggeration=typeof p.exaggeration=="number"?p.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(s,h,p,g=a.$){var y;if(!(h>=0&&h<g&&p>=0&&p<g))return 0;const w=this.getTerrainData(s),S=(y=w.tile)===null||y===void 0?void 0:y.dem;if(!S)return 0;const C=a.cs([],[h/g*a.$,p/g*a.$],w.u_terrain_matrix),R=[C[0]*S.dim,C[1]*S.dim],B=Math.floor(R[0]),k=Math.floor(R[1]),F=R[0]-B,V=R[1]-k;return S.get(B,k)*(1-F)*(1-V)+S.get(B+1,k)*F*(1-V)+S.get(B,k+1)*(1-F)*V+S.get(B+1,k+1)*F*V}getElevationForLngLatZoom(s,h){if(!a.ct(h,s.wrap()))return 0;const{tileID:p,mercatorX:g,mercatorY:y}=this._getOverscaledTileIDFromLngLatZoom(s,h);return this.getElevation(p,g%a.$,y%a.$,a.$)}getElevation(s,h,p,g=a.$){return this.getDEMElevation(s,h,p,g)*this.exaggeration}getTerrainData(s){if(!this._emptyDemTexture){const g=this.painter.context,y=new a.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new a.T(g,y,g.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new a.T(g,new a.R({width:1,height:1}),g.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(g.gl.NEAREST,g.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=a.ag([])}const h=this.sourceCache.getSourceTile(s,!0);if(h&&h.dem&&(!h.demTexture||h.needsTerrainPrepare)){const g=this.painter.context;h.demTexture=this.painter.getTileTexture(h.dem.stride),h.demTexture?h.demTexture.update(h.dem.getPixels(),{premultiply:!1}):h.demTexture=new a.T(g,h.dem.getPixels(),g.gl.RGBA,{premultiply:!1}),h.demTexture.bind(g.gl.NEAREST,g.gl.CLAMP_TO_EDGE),h.needsTerrainPrepare=!1}const p=h&&h+h.tileID.key+s.key;if(p&&!this._demMatrixCache[p]){const g=this.sourceCache.sourceCache._source.maxzoom;let y=s.canonical.z-h.tileID.canonical.z;s.overscaledZ>s.canonical.z&&(s.canonical.z>=g?y=s.canonical.z-g:a.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const w=s.canonical.x-(s.canonical.x>>y<<y),S=s.canonical.y-(s.canonical.y>>y<<y),C=a.cu(new Float64Array(16),[1/(a.$<<y),1/(a.$<<y),0]);a.M(C,C,[w*a.$,S*a.$,0]),this._demMatrixCache[s.key]={matrix:C,coord:s}}return{u_depth:2,u_terrain:3,u_terrain_dim:h&&h.dem&&h.dem.dim||1,u_terrain_matrix:p?this._demMatrixCache[s.key].matrix:this._emptyDemMatrix,u_terrain_unpack:h&&h.dem&&h.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(h&&h.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:h}}getFramebuffer(s){const h=this.painter,p=h.width/devicePixelRatio,g=h.height/devicePixelRatio;return!this._fbo||this._fbo.width===p&&this._fbo.height===g||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new a.T(h.context,{width:p,height:g,data:null},h.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(h.context.gl.NEAREST,h.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new a.T(h.context,{width:p,height:g,data:null},h.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(h.context.gl.NEAREST,h.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=h.context.createFramebuffer(p,g,!0,!1),this._fbo.depthAttachment.set(h.context.createRenderbuffer(h.context.gl.DEPTH_COMPONENT16,p,g))),this._fbo.colorAttachment.set(s==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const s=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const h=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let y=0,w=0;y<this._coordsTextureSize;y++)for(let S=0;S<this._coordsTextureSize;S++,w+=4)h[w+0]=255&S,h[w+1]=255&y,h[w+2]=S>>8<<4|y>>8,h[w+3]=0;const p=new a.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(h.buffer)),g=new a.T(s,p,s.gl.RGBA,{premultiply:!1});return g.bind(s.gl.NEAREST,s.gl.CLAMP_TO_EDGE),this._coordsTexture=g,g}pointCoordinate(s){this.painter.maybeDrawDepthAndCoords(!0);const h=new Uint8Array(4),p=this.painter.context,g=p.gl,y=Math.round(s.x*this.painter.pixelRatio/devicePixelRatio),w=Math.round(s.y*this.painter.pixelRatio/devicePixelRatio),S=Math.round(this.painter.height/devicePixelRatio);p.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),g.readPixels(y,S-w-1,1,1,g.RGBA,g.UNSIGNED_BYTE,h),p.bindFramebuffer.set(null);const C=h[0]+(h[2]>>4<<8),R=h[1]+((15&h[2])<<8),B=this.coordsIndex[255-h[3]],k=B&&this.sourceCache.getTileByID(B);if(!k)return null;const F=this._coordsTextureSize,V=(1<<k.tileID.canonical.z)*F;return new a.a1((k.tileID.canonical.x*F+C)/V+k.tileID.wrap,(k.tileID.canonical.y*F+R)/V,this.getElevation(k.tileID,C,R,F))}depthAtPoint(s){const h=new Uint8Array(4),p=this.painter.context,g=p.gl;return p.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),g.readPixels(s.x,this.painter.height/devicePixelRatio-s.y-1,1,1,g.RGBA,g.UNSIGNED_BYTE,h),p.bindFramebuffer.set(null),(h[0]/16777216+h[1]/65536+h[2]/256+h[3])/256}getTerrainMesh(s){var h;const p=((h=this.painter.style.projection)===null||h===void 0?void 0:h.transitionState)>0,g=p&&s.canonical.y===0,y=p&&s.canonical.y===(1<<s.canonical.z)-1,w=`m_${g?"n":""}_${y?"s":""}`;if(this._meshCache[w])return this._meshCache[w];const S=this.painter.context,C=new a.cv,R=new a.aN,B=this.meshSize,k=a.$/B,F=B*B;for(let le=0;le<=B;le++)for(let ve=0;ve<=B;ve++)C.emplaceBack(ve*k,le*k,0);for(let le=0;le<F;le+=B+1)for(let ve=0;ve<B;ve++)R.emplaceBack(ve+le,B+ve+le+1,B+ve+le+2),R.emplaceBack(ve+le,B+ve+le+2,ve+le+1);const V=C.length,G=V+(B+1),J=(B+1)*B,Y=g?a.bh:0,Q=g?0:1,se=y?a.bi:a.$,ce=y?0:1;for(let le=0;le<=B;le++)C.emplaceBack(le*k,Y,Q);for(let le=0;le<=B;le++)C.emplaceBack(le*k,se,ce);for(let le=0;le<B;le++)R.emplaceBack(J+le,G+le,G+le+1),R.emplaceBack(J+le,G+le+1,J+le+1),R.emplaceBack(0+le,V+le+1,V+le),R.emplaceBack(0+le,0+le+1,V+le+1);const ae=C.length,ue=ae+2*(B+1);for(const le of[0,1])for(let ve=0;ve<=B;ve++)for(const ke of[0,1])C.emplaceBack(le*a.$,ve*k,ke);for(let le=0;le<2*B;le+=2)R.emplaceBack(ae+le,ae+le+1,ae+le+3),R.emplaceBack(ae+le,ae+le+3,ae+le+2),R.emplaceBack(ue+le,ue+le+3,ue+le+1),R.emplaceBack(ue+le,ue+le+2,ue+le+3);const _e=new $e(S.createVertexBuffer(C,rh.members),S.createIndexBuffer(R),a.aM.simpleSegment(0,0,C.length,R.length));return this._meshCache[w]=_e,_e}getMeshFrameDelta(s){return 2*Math.PI*a.bu/Math.pow(2,Math.max(s,0))/5}getMinTileElevationForLngLatZoom(s,h){var p;const{tileID:g}=this._getOverscaledTileIDFromLngLatZoom(s,h);return(p=this.getMinMaxElevation(g).minElevation)!==null&&p!==void 0?p:0}getMinMaxElevation(s){const h=this.getTerrainData(s).tile,p={minElevation:null,maxElevation:null};return h&&h.dem&&(p.minElevation=h.dem.min*this.exaggeration,p.maxElevation=h.dem.max*this.exaggeration),p}_getOverscaledTileIDFromLngLatZoom(s,h){const p=a.a1.fromLngLat(s.wrap()),g=(1<<h)*a.$,y=p.x*g,w=p.y*g,S=Math.floor(y/a.$),C=Math.floor(w/a.$);return{tileID:new a.Z(h,0,h,S,C),mercatorX:y,mercatorY:w}}}class sh{constructor(s,h,p){this._context=s,this._size=h,this._tileSize=p,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const s of this._objects)s.texture.destroy(),s.fbo.destroy()}_createObject(s){const h=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),p=new a.T(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return p.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),h.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),h.colorAttachment.set(p.texture),{id:s,fbo:h,texture:p,stamp:-1,inUse:!1}}getObjectForId(s){return this._objects[s]}useObject(s){s.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(h=>s.id!==h),this._recentlyUsed.push(s.id)}stampObject(s){s.stamp=++this._stamp}getOrCreateFreeObject(){for(const h of this._recentlyUsed)if(!this._objects[h].inUse)return this._objects[h];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const s=this._createObject(this._objects.length);return this._objects.push(s),s}freeObject(s){s.inUse=!1}freeAllObjects(){for(const s of this._objects)this.freeObject(s)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(s=>!s.inUse)===!1}}const oo={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0,"color-relief":!0};class nh{constructor(s,h){this.painter=s,this.terrain=h,this.pool=new sh(s.context,30,h.sourceCache.tileSize*h.qualityFactor)}destruct(){this.pool.destruct()}getTexture(s){return this.pool.getObjectForId(s.rtt[this._stacks.length-1].id).texture}prepareForRender(s,h){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=s._order.filter(p=>!s._layers[p].isHidden(h)),this._coordsAscending={};for(const p in s.sourceCaches){this._coordsAscending[p]={};const g=s.sourceCaches[p].getVisibleCoordinates(),y=s.sourceCaches[p].getSource(),w=y instanceof rs?y.terrainTileRanges:null;for(const S of g){const C=this.terrain.sourceCache.getTerrainCoords(S,w);for(const R in C)this._coordsAscending[p][R]||(this._coordsAscending[p][R]=[]),this._coordsAscending[p][R].push(C[R])}}this._coordsAscendingStr={};for(const p of s._order){const g=s._layers[p],y=g.source;if(oo[g.type]&&!this._coordsAscendingStr[y]){this._coordsAscendingStr[y]={};for(const w in this._coordsAscending[y])this._coordsAscendingStr[y][w]=this._coordsAscending[y][w].map(S=>S.key).sort().join()}}for(const p of this._renderableTiles)for(const g in this._coordsAscendingStr){const y=this._coordsAscendingStr[g][p.tileID.key];y&&y!==p.rttCoords[g]&&(p.rtt=[])}}renderLayer(s,h){if(s.isHidden(this.painter.transform.zoom))return!1;const p=Object.assign(Object.assign({},h),{isRenderingToTexture:!0}),g=s.type,y=this.painter,w=this._renderableLayerIds[this._renderableLayerIds.length-1]===s.id;if(oo[g]&&(this._prevType&&oo[this._prevType]||this._stacks.push([]),this._prevType=g,this._stacks[this._stacks.length-1].push(s.id),!w))return!0;if(oo[this._prevType]||oo[g]&&w){this._prevType=g;const S=this._stacks.length-1,C=this._stacks[S]||[];for(const R of this._renderableTiles){if(this.pool.isFull()&&(Yc(this.painter,this.terrain,this._rttTiles,p),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(R),R.rtt[S]){const k=this.pool.getObjectForId(R.rtt[S].id);if(k.stamp===R.rtt[S].stamp){this.pool.useObject(k);continue}}const B=this.pool.getOrCreateFreeObject();this.pool.useObject(B),this.pool.stampObject(B),R.rtt[S]={id:B.id,stamp:B.stamp},y.context.bindFramebuffer.set(B.fbo.framebuffer),y.context.clear({color:a.bf.transparent,stencil:0}),y.currentStencilSource=void 0;for(let k=0;k<C.length;k++){const F=y.style._layers[C[k]],V=F.source?this._coordsAscending[F.source][R.tileID.key]:[R.tileID];y.context.viewport.set([0,0,B.fbo.width,B.fbo.height]),y._renderTileClippingMasks(F,V,!0),y.renderLayer(y,y.style.sourceCaches[F.source],F,V,p),F.source&&(R.rttCoords[F.source]=this._coordsAscendingStr[F.source][R.tileID.key])}}return Yc(this.painter,this.terrain,this._rttTiles,p),this._rttTiles=[],this.pool.freeAllObjects(),oo[g]}return!1}}const jr={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Qp=x,ws={hash:!1,interactive:!0,bearingSnap:7,attributionControl:td,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:a.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0},Wy={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class Pl{constructor(s,h,p=!1){this.mousedown=y=>{this.startMove(y,U.mousePos(this.element,y)),U.addEventListener(window,"mousemove",this.mousemove),U.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=y=>{this.move(y,U.mousePos(this.element,y))},this.mouseup=y=>{this._rotatePitchHandler.dragEnd(y),this.offTemp()},this.touchstart=y=>{y.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=U.touchPos(this.element,y.targetTouches)[0],this.startMove(y,this._startPos),U.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),U.addEventListener(window,"touchend",this.touchend))},this.touchmove=y=>{y.targetTouches.length!==1?this.reset():(this._lastPos=U.touchPos(this.element,y.targetTouches)[0],this.move(y,this._lastPos))},this.touchend=y=>{y.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHandler.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=h;const g=new Hy;this._rotatePitchHandler=new xa({clickTolerance:3,move:(y,w)=>{const S=h.getBoundingClientRect(),C=new a.P((S.bottom-S.top)/2,(S.right-S.left)/2);return{bearingDelta:a.cn(new a.P(y.x,w.y),w,C),pitchDelta:p?-.5*(w.y-y.y):void 0}},moveStateManager:g,enable:!0,assignEvents:()=>{}}),this.map=s,U.addEventListener(h,"mousedown",this.mousedown),U.addEventListener(h,"touchstart",this.touchstart,{passive:!1}),U.addEventListener(h,"touchcancel",this.reset)}startMove(s,h){this._rotatePitchHandler.dragStart(s,h),U.disableDrag()}move(s,h){const p=this.map,{bearingDelta:g,pitchDelta:y}=this._rotatePitchHandler.dragMove(s,h)||{};g&&p.setBearing(p.getBearing()+g),y&&p.setPitch(p.getPitch()+y)}off(){const s=this.element;U.removeEventListener(s,"mousedown",this.mousedown),U.removeEventListener(s,"touchstart",this.touchstart,{passive:!1}),U.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),U.removeEventListener(window,"touchend",this.touchend),U.removeEventListener(s,"touchcancel",this.reset),this.offTemp()}offTemp(){U.enableDrag(),U.removeEventListener(window,"mousemove",this.mousemove),U.removeEventListener(window,"mouseup",this.mouseup),U.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),U.removeEventListener(window,"touchend",this.touchend)}}let ri;function Oi(m,s,h,p=!1){if(p||!h.getCoveringTilesDetailsProvider().allowWorldCopies())return m==null?void 0:m.wrap();const g=new a.S(m.lng,m.lat);if(m=new a.S(m.lng,m.lat),s){const y=new a.S(m.lng-360,m.lat),w=new a.S(m.lng+360,m.lat),S=h.locationToScreenPoint(m).distSqr(s);h.locationToScreenPoint(y).distSqr(s)<S?m=y:h.locationToScreenPoint(w).distSqr(s)<S&&(m=w)}for(;Math.abs(m.lng-h.center.lng)>180;){const y=h.locationToScreenPoint(m);if(y.x>=0&&y.y>=0&&y.x<=h.width&&y.y<=h.height)break;m.lng>h.center.lng?m.lng-=360:m.lng+=360}return m.lng!==g.lng&&h.isPointOnMapSurface(h.locationToScreenPoint(m))?m:g}const oh={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Ea(m,s,h){const p=m.classList;for(const g in oh)p.remove(`maplibregl-${h}-anchor-${g}`);p.add(`maplibregl-${h}-anchor-${s}`)}class Sa extends a.E{constructor(s){if(super(),this._onKeyPress=h=>{const p=h.code,g=h.charCode||h.keyCode;p!=="Space"&&p!=="Enter"&&g!==32&&g!==13||this.togglePopup()},this._onMapClick=h=>{const p=h.originalEvent.target,g=this._element;this._popup&&(p===g||g.contains(p))&&this.togglePopup()},this._update=h=>{if(!this._map)return;const p=this._map.loaded()&&!this._map.isMoving();((h==null?void 0:h.type)==="terrain"||(h==null?void 0:h.type)==="render"&&!p)&&this._map.once("render",this._update),this._lngLat=Oi(this._lngLat,this._flatPos,this._map.transform),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let g="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?g=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(g=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let y="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?y="rotateX(0deg)":this._pitchAlignment==="map"&&(y=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||h&&h.type!=="moveend"||(this._pos=this._pos.round()),U.setTransform(this._element,`${oh[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${y} ${g}`),N.frameAsync(new AbortController).then(()=>{this._updateOpacity(h&&h.type==="moveend")}).catch(()=>{})},this._onMove=h=>{if(!this._isDragging){const p=this._clickTolerance||this._map._clickTolerance;this._isDragging=h.point.dist(this._pointerdownPos)>=p}this._isDragging&&(this._pos=h.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new a.l("dragstart"))),this.fire(new a.l("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new a.l("dragend")),this._state="inactive"},this._addDragHandler=h=>{this._element.contains(h.originalEvent.target)&&(h.preventDefault(),this._positionDelta=h.point.sub(this._pos).add(this._offset),this._pointerdownPos=h.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=s&&s.anchor||"center",this._color=s&&s.color||"#3FB1CE",this._scale=s&&s.scale||1,this._draggable=s&&s.draggable||!1,this._clickTolerance=s&&s.clickTolerance||0,this._subpixelPositioning=s&&s.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=s&&s.rotation||0,this._rotationAlignment=s&&s.rotationAlignment||"auto",this._pitchAlignment=s&&s.pitchAlignment&&s.pitchAlignment!=="auto"?s.pitchAlignment:this._rotationAlignment,this.setOpacity(s==null?void 0:s.opacity,s==null?void 0:s.opacityWhenCovered),s&&s.element)this._element=s.element,this._offset=a.P.convert(s&&s.offset||[0,0]);else{this._defaultMarker=!0,this._element=U.create("div");const h=U.createNS("http://www.w3.org/2000/svg","svg"),p=41,g=27;h.setAttributeNS(null,"display","block"),h.setAttributeNS(null,"height",`${p}px`),h.setAttributeNS(null,"width",`${g}px`),h.setAttributeNS(null,"viewBox",`0 0 ${g} ${p}`);const y=U.createNS("http://www.w3.org/2000/svg","g");y.setAttributeNS(null,"stroke","none"),y.setAttributeNS(null,"stroke-width","1"),y.setAttributeNS(null,"fill","none"),y.setAttributeNS(null,"fill-rule","evenodd");const w=U.createNS("http://www.w3.org/2000/svg","g");w.setAttributeNS(null,"fill-rule","nonzero");const S=U.createNS("http://www.w3.org/2000/svg","g");S.setAttributeNS(null,"transform","translate(3.0, 29.0)"),S.setAttributeNS(null,"fill","#000000");const C=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const Q of C){const se=U.createNS("http://www.w3.org/2000/svg","ellipse");se.setAttributeNS(null,"opacity","0.04"),se.setAttributeNS(null,"cx","10.5"),se.setAttributeNS(null,"cy","5.80029008"),se.setAttributeNS(null,"rx",Q.rx),se.setAttributeNS(null,"ry",Q.ry),S.appendChild(se)}const R=U.createNS("http://www.w3.org/2000/svg","g");R.setAttributeNS(null,"fill",this._color);const B=U.createNS("http://www.w3.org/2000/svg","path");B.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),R.appendChild(B);const k=U.createNS("http://www.w3.org/2000/svg","g");k.setAttributeNS(null,"opacity","0.25"),k.setAttributeNS(null,"fill","#000000");const F=U.createNS("http://www.w3.org/2000/svg","path");F.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),k.appendChild(F);const V=U.createNS("http://www.w3.org/2000/svg","g");V.setAttributeNS(null,"transform","translate(6.0, 7.0)"),V.setAttributeNS(null,"fill","#FFFFFF");const G=U.createNS("http://www.w3.org/2000/svg","g");G.setAttributeNS(null,"transform","translate(8.0, 8.0)");const J=U.createNS("http://www.w3.org/2000/svg","circle");J.setAttributeNS(null,"fill","#000000"),J.setAttributeNS(null,"opacity","0.25"),J.setAttributeNS(null,"cx","5.5"),J.setAttributeNS(null,"cy","5.5"),J.setAttributeNS(null,"r","5.4999962");const Y=U.createNS("http://www.w3.org/2000/svg","circle");Y.setAttributeNS(null,"fill","#FFFFFF"),Y.setAttributeNS(null,"cx","5.5"),Y.setAttributeNS(null,"cy","5.5"),Y.setAttributeNS(null,"r","5.4999962"),G.appendChild(J),G.appendChild(Y),w.appendChild(S),w.appendChild(R),w.appendChild(k),w.appendChild(V),w.appendChild(G),h.appendChild(w),h.setAttributeNS(null,"height",p*this._scale+"px"),h.setAttributeNS(null,"width",g*this._scale+"px"),this._element.appendChild(h),this._offset=a.P.convert(s&&s.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",h=>{h.preventDefault()}),this._element.addEventListener("mousedown",h=>{h.preventDefault()}),Ea(this._element,this._anchor,"marker"),s&&s.className)for(const h of s.className.split(" "))this._element.classList.add(h);this._popup=null}addTo(s){return this.remove(),this._map=s,this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label",s._getUIString("Marker.Title")),s.getCanvasContainer().appendChild(this._element),s.on("move",this._update),s.on("moveend",this._update),s.on("terrain",this._update),s.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),U.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(s){return this._lngLat=a.S.convert(s),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(s){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),s){if(!("offset"in s.options)){const g=Math.abs(13.5)/Math.SQRT2;s.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[g,-1*(38.1-13.5+g)],"bottom-right":[-g,-1*(38.1-13.5+g)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=s,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(s){return this._subpixelPositioning=s,this}getPopup(){return this._popup}togglePopup(){const s=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:s?(s.isOpen()?s.remove():(s.setLngLat(this._lngLat),s.addTo(this._map)),this):this}_updateOpacity(s=!1){var h,p;const g=(h=this._map)===null||h===void 0?void 0:h.terrain,y=this._map.transform.isLocationOccluded(this._lngLat);if(!g||y){const V=y?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==V&&(this._element.style.opacity=V))}if(s)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const w=this._map,S=w.terrain.depthAtPoint(this._pos),C=w.terrain.getElevationForLngLatZoom(this._lngLat,w.transform.tileZoom);if(w.transform.lngLatToCameraDepth(this._lngLat,C)-S<.006)return void(this._element.style.opacity=this._opacity);const R=-this._offset.y/w.transform.pixelsPerMeter,B=Math.sin(w.getPitch()*Math.PI/180)*R,k=w.terrain.depthAtPoint(new a.P(this._pos.x,this._pos.y-this._offset.y)),F=w.transform.lngLatToCameraDepth(this._lngLat,C+B)-k>.006;!((p=this._popup)===null||p===void 0)&&p.isOpen()&&F&&this._popup.remove(),this._element.style.opacity=F?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(s){return this._offset=a.P.convert(s),this._update(),this}addClassName(s){this._element.classList.add(s)}removeClassName(s){this._element.classList.remove(s)}toggleClassName(s){return this._element.classList.toggle(s)}setDraggable(s){return this._draggable=!!s,this._map&&(s?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(s){return this._rotation=s||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(s){return this._rotationAlignment=s||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(s){return this._pitchAlignment=s&&s!=="auto"?s:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(s,h){return(this._opacity===void 0||s===void 0&&h===void 0)&&(this._opacity="1",this._opacityWhenCovered="0.2"),s!==void 0&&(this._opacity=s),h!==void 0&&(this._opacityWhenCovered=h),this._map&&this._updateOpacity(!0),this}}const rd={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Ca=0,Lo=!1;const Bl={maxWidth:100,unit:"metric"};function ah(m,s,h){const p=h&&h.maxWidth||100,g=m._container.clientHeight/2,y=m._container.clientWidth/2,w=m.unproject([y-p/2,g]),S=m.unproject([y+p/2,g]),C=Math.round(m.project(S).x-m.project(w).x),R=Math.min(p,C,m._container.clientWidth),B=w.distanceTo(S);if(h&&h.unit==="imperial"){const k=3.2808*B;k>5280?Uo(s,R,k/5280,m._getUIString("ScaleControl.Miles")):Uo(s,R,k,m._getUIString("ScaleControl.Feet"))}else h&&h.unit==="nautical"?Uo(s,R,B/1852,m._getUIString("ScaleControl.NauticalMiles")):B>=1e3?Uo(s,R,B/1e3,m._getUIString("ScaleControl.Kilometers")):Uo(s,R,B,m._getUIString("ScaleControl.Meters"))}function Uo(m,s,h,p){const g=function(y){const w=Math.pow(10,`${Math.floor(y)}`.length-1);let S=y/w;return S=S>=10?10:S>=5?5:S>=3?3:S>=2?2:S>=1?1:function(C){const R=Math.pow(10,Math.ceil(-Math.log(C)/Math.LN10));return Math.round(C*R)/R}(S),w*S}(h);m.style.width=s*(g/h)+"px",m.innerHTML=`${g}&nbsp;${p}`}const sd={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1,locationOccludedOpacity:void 0},nd=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function lh(m){if(m){if(typeof m=="number"){const s=Math.round(Math.abs(m)/Math.SQRT2);return{center:new a.P(0,0),top:new a.P(0,m),"top-left":new a.P(s,s),"top-right":new a.P(-s,s),bottom:new a.P(0,-m),"bottom-left":new a.P(s,-s),"bottom-right":new a.P(-s,-s),left:new a.P(m,0),right:new a.P(-m,0)}}if(m instanceof a.P||Array.isArray(m)){const s=a.P.convert(m);return{center:s,top:s,"top-left":s,"top-right":s,bottom:s,"bottom-left":s,"bottom-right":s,left:s,right:s}}return{center:a.P.convert(m.center||[0,0]),top:a.P.convert(m.top||[0,0]),"top-left":a.P.convert(m["top-left"]||[0,0]),"top-right":a.P.convert(m["top-right"]||[0,0]),bottom:a.P.convert(m.bottom||[0,0]),"bottom-left":a.P.convert(m["bottom-left"]||[0,0]),"bottom-right":a.P.convert(m["bottom-right"]||[0,0]),left:a.P.convert(m.left||[0,0]),right:a.P.convert(m.right||[0,0])}}return lh(new a.P(0,0))}const od=x;d.AJAXError=a.cz,d.Event=a.l,d.Evented=a.E,d.LngLat=a.S,d.MercatorCoordinate=a.a1,d.Point=a.P,d.addProtocol=a.cA,d.config=a.a,d.removeProtocol=a.cB,d.AttributionControl=id,d.BoxZoomHandler=qu,d.CanvasSource=Li,d.CooperativeGesturesHandler=Kp,d.DoubleClickZoomHandler=Yu,d.DragPanHandler=qp,d.DragRotateHandler=Qu,d.EdgeInsets=Si,d.FullscreenControl=class extends a.E{constructor(m={}){super(),this._onFullscreenChange=()=>{var s;let h=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((s=h==null?void 0:h.shadowRoot)===null||s===void 0)&&s.fullscreenElement;)h=h.shadowRoot.fullscreenElement;h===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,m&&m.container&&(m.container instanceof HTMLElement?this._container=m.container:a.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(m){return this._map=m,this._container||(this._container=this._map.getContainer()),this._controlContainer=U.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){U.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const m=this._fullscreenButton=U.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);U.create("span","maplibregl-ctrl-icon",m).setAttribute("aria-hidden","true"),m.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const m=this._getTitle();this._fullscreenButton.setAttribute("aria-label",m),this._fullscreenButton.title=m}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new a.l("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new a.l("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},d.GeoJSONSource=is,d.GeolocateControl=class extends a.E{constructor(m){super(),this._onSuccess=s=>{if(this._map){if(this._isOutOfMapMaxBounds(s))return this._setErrorState(),this.fire(new a.l("outofmaxbounds",s)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=s,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(s),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(s),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new a.l("geolocate",s)),this._finish()}},this._updateCamera=s=>{const h=new a.S(s.coords.longitude,s.coords.latitude),p=s.coords.accuracy,g=this._map.getBearing(),y=a.e({bearing:g},this.options.fitBoundsOptions),w=oi.fromLngLat(h,p);this._map.fitBounds(w,y,{geolocateSource:!0})},this._updateMarker=s=>{if(s){const h=new a.S(s.coords.longitude,s.coords.latitude);this._accuracyCircleMarker.setLngLat(h).addTo(this._map),this._userLocationDotMarker.setLngLat(h).addTo(this._map),this._accuracy=s.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=s=>{if(this._map){if(s.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const h=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=h,this._geolocateButton.setAttribute("aria-label",h),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(s.code===3&&Lo)return;this.options.trackUserLocation&&this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new a.l("error",s)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",s=>s.preventDefault()),this._geolocateButton=U.create("button","maplibregl-ctrl-geolocate",this._container),U.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=s=>{if(this._map){if(s===!1){a.w("Geolocation support is not available so the GeolocateControl will be disabled.");const h=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=h,this._geolocateButton.setAttribute("aria-label",h)}else{const h=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=h,this._geolocateButton.setAttribute("aria-label",h)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=U.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Sa({element:this._dotElement}),this._circleElement=U.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Sa({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",h=>{const p=(h==null?void 0:h[0])instanceof ResizeObserverEntry;h.geolocateSource||this._watchState!=="ACTIVE_LOCK"||p||this._map.isZooming()||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new a.l("trackuserlocationend")),this.fire(new a.l("userlocationlostfocus")))})}},this.options=a.e({},rd,m)}onAdd(m){return this._map=m,this._container=U.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),function(){return a._(this,arguments,void 0,function*(s=!1){if(ri!==void 0&&!s)return ri;if(window.navigator.permissions===void 0)return ri=!!window.navigator.geolocation,ri;try{ri=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{ri=!!window.navigator.geolocation}return ri})}().then(s=>this._finishSetupUI(s)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),U.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Ca=0,Lo=!1}_isOutOfMapMaxBounds(m){const s=this._map.getMaxBounds(),h=m.coords;return s&&(h.longitude<s.getWest()||h.longitude>s.getEast()||h.latitude<s.getSouth()||h.latitude>s.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const m=this._map.getBounds(),s=m.getSouthEast(),h=m.getNorthEast(),p=s.distanceTo(h),g=Math.ceil(this._accuracy/(p/this._map._container.clientHeight)*2);this._circleElement.style.width=`${g}px`,this._circleElement.style.height=`${g}px`}trigger(){if(!this._setup)return a.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new a.l("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Ca--,Lo=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new a.l("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new a.l("trackuserlocationstart")),this.fire(new a.l("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let m;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Ca++,Ca>1?(m={maximumAge:6e5,timeout:0},Lo=!0):(m=this.options.positionOptions,Lo=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,m)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},d.GlobeControl=class{constructor(){this._toggleProjection=()=>{var m;const s=(m=this._map.getProjection())===null||m===void 0?void 0:m.type;this._map.setProjection(s!=="mercator"&&s?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var m;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),((m=this._map.getProjection())===null||m===void 0?void 0:m.type)==="globe"?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(m){return this._map=m,this._container=U.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=U.create("button","maplibregl-ctrl-globe",this._container),U.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._container}onRemove(){U.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},d.Hash=Jc,d.ImageSource=rs,d.KeyboardHandler=th,d.LngLatBounds=oi,d.LogoControl=Jp,d.Map=class extends Yp{constructor(m){var s,h;a.cw.mark(a.cx.create);const p=Object.assign(Object.assign(Object.assign({},ws),m),{canvasContextAttributes:Object.assign(Object.assign({},ws.canvasContextAttributes),m.canvasContextAttributes)});if(p.minZoom!=null&&p.maxZoom!=null&&p.minZoom>p.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(p.minPitch!=null&&p.maxPitch!=null&&p.minPitch>p.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(p.minPitch!=null&&p.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(p.maxPitch!=null&&p.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");const g=new ai,y=new Rr;if(p.minZoom!==void 0&&g.setMinZoom(p.minZoom),p.maxZoom!==void 0&&g.setMaxZoom(p.maxZoom),p.minPitch!==void 0&&g.setMinPitch(p.minPitch),p.maxPitch!==void 0&&g.setMaxPitch(p.maxPitch),p.renderWorldCopies!==void 0&&g.setRenderWorldCopies(p.renderWorldCopies),super(g,y,{bearingSnap:p.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new gn,this._controls=[],this._mapId=a.a7(),this._contextLost=S=>{S.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new a.l("webglcontextlost",{originalEvent:S}))},this._contextRestored=S=>{this._setupPainter(),this.resize(),this._update(),this.fire(new a.l("webglcontextrestored",{originalEvent:S}))},this._onMapScroll=S=>{if(S.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=p.interactive,this._maxTileCacheSize=p.maxTileCacheSize,this._maxTileCacheZoomLevels=p.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},p.canvasContextAttributes),this._trackResize=p.trackResize===!0,this._bearingSnap=p.bearingSnap,this._centerClampedToGround=p.centerClampedToGround,this._refreshExpiredTiles=p.refreshExpiredTiles===!0,this._fadeDuration=p.fadeDuration,this._crossSourceCollisions=p.crossSourceCollisions===!0,this._collectResourceTiming=p.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},jr),p.locale),this._clickTolerance=p.clickTolerance,this._overridePixelRatio=p.pixelRatio,this._maxCanvasSize=p.maxCanvasSize,this.transformCameraUpdate=p.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=p.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=Ue.addThrottleControl(()=>this.isMoving()),this._requestManager=new Xe(p.transformRequest),typeof p.container=="string"){if(this._container=document.getElementById(p.container),!this._container)throw new Error(`Container '${p.container}' not found.`)}else{if(!(p.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=p.container}if(p.maxBounds&&this.setMaxBounds(p.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let S=!1;const C=ko(R=>{this._trackResize&&!this._removed&&(this.resize(R),this.redraw())},50);this._resizeObserver=new ResizeObserver(R=>{S?C(R):S=!0}),this._resizeObserver.observe(this._container)}this.handlers=new ed(this,p),this._hash=p.hash&&new Jc(typeof p.hash=="string"&&p.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:p.center,elevation:p.elevation,zoom:p.zoom,bearing:p.bearing,pitch:p.pitch,roll:p.roll}),p.bounds&&(this.resize(),this.fitBounds(p.bounds,a.e({},p.fitBoundsOptions,{duration:0}))));const w=typeof p.style=="string"||((h=(s=p.style)===null||s===void 0?void 0:s.projection)===null||h===void 0?void 0:h.type)!=="globe";this.resize(null,w),this._localIdeographFontFamily=p.localIdeographFontFamily,this._validateStyle=p.validateStyle,p.style&&this.setStyle(p.style,{localIdeographFontFamily:p.localIdeographFontFamily}),p.attributionControl&&this.addControl(new id(typeof p.attributionControl=="boolean"?void 0:p.attributionControl)),p.maplibreLogo&&this.addControl(new Jp,p.logoPosition),this.on("style.load",()=>{if(w||this._resizeTransform(),this.transform.unmodified){const S=a.Q(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(S)}}),this.on("data",S=>{this._update(S.dataType==="style"),this.fire(new a.l(`${S.dataType}data`,S))}),this.on("dataloading",S=>{this.fire(new a.l(`${S.dataType}dataloading`,S))}),this.on("dataabort",S=>{this.fire(new a.l("sourcedataabort",S))})}_getMapId(){return this._mapId}setGlobalStateProperty(m,s){return this.style.setGlobalStateProperty(m,s),this._update(!0)}getGlobalState(){return this.style.getGlobalState()}addControl(m,s){if(s===void 0&&(s=m.getDefaultPosition?m.getDefaultPosition():"top-right"),!m||!m.onAdd)return this.fire(new a.k(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const h=m.onAdd(this);this._controls.push(m);const p=this._controlPositions[s];return s.indexOf("bottom")!==-1?p.insertBefore(h,p.firstChild):p.appendChild(h),this}removeControl(m){if(!m||!m.onRemove)return this.fire(new a.k(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const s=this._controls.indexOf(m);return s>-1&&this._controls.splice(s,1),m.onRemove(this),this}hasControl(m){return this._controls.indexOf(m)>-1}calculateCameraOptionsFromTo(m,s,h,p){return p==null&&this.terrain&&(p=this.terrain.getElevationForLngLatZoom(h,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(m,s,h,p)}resize(m,s=!0){const[h,p]=this._containerDimensions(),g=this._getClampedPixelRatio(h,p);if(this._resizeCanvas(h,p,g),this.painter.resize(h,p,g),this.painter.overLimit()){const w=this.painter.context.gl;this._maxCanvasSize=[w.drawingBufferWidth,w.drawingBufferHeight];const S=this._getClampedPixelRatio(h,p);this._resizeCanvas(h,p,S),this.painter.resize(h,p,S)}this._resizeTransform(s);const y=!this._moving;return y&&(this.stop(),this.fire(new a.l("movestart",m)).fire(new a.l("move",m))),this.fire(new a.l("resize",m)),y&&this.fire(new a.l("moveend",m)),this}_resizeTransform(m=!0){var s;const[h,p]=this._containerDimensions();this.transform.resize(h,p,m),(s=this._requestedCameraState)===null||s===void 0||s.resize(h,p,m)}_getClampedPixelRatio(m,s){const{0:h,1:p}=this._maxCanvasSize,g=this.getPixelRatio(),y=m*g,w=s*g;return Math.min(y>h?h/y:1,w>p?p/w:1)*g}getPixelRatio(){var m;return(m=this._overridePixelRatio)!==null&&m!==void 0?m:devicePixelRatio}setPixelRatio(m){this._overridePixelRatio=m,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(m){return this.transform.setMaxBounds(oi.convert(m)),this._update()}setMinZoom(m){if((m=m??-2)>=-2&&m<=this.transform.maxZoom)return this.transform.setMinZoom(m),this._update(),this.getZoom()<m&&this.setZoom(m),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(m){if((m=m??22)>=this.transform.minZoom)return this.transform.setMaxZoom(m),this._update(),this.getZoom()>m&&this.setZoom(m),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(m){if((m=m??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(m>=0&&m<=this.transform.maxPitch)return this.transform.setMinPitch(m),this._update(),this.getPitch()<m&&this.setPitch(m),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(m){if((m=m??60)>180)throw new Error("maxPitch must be less than or equal to 180");if(m>=this.transform.minPitch)return this.transform.setMaxPitch(m),this._update(),this.getPitch()>m&&this.setPitch(m),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(m){return this.transform.setRenderWorldCopies(m),this._update()}project(m){return this.transform.locationToScreenPoint(a.S.convert(m),this.style&&this.terrain)}unproject(m){return this.transform.screenPointToLocation(a.P.convert(m),this.terrain)}isMoving(){var m;return this._moving||((m=this.handlers)===null||m===void 0?void 0:m.isMoving())}isZooming(){var m;return this._zooming||((m=this.handlers)===null||m===void 0?void 0:m.isZooming())}isRotating(){var m;return this._rotating||((m=this.handlers)===null||m===void 0?void 0:m.isRotating())}_createDelegatedListener(m,s,h){if(m==="mouseenter"||m==="mouseover"){let p=!1;return{layers:s,listener:h,delegates:{mousemove:y=>{const w=s.filter(C=>this.getLayer(C)),S=w.length!==0?this.queryRenderedFeatures(y.point,{layers:w}):[];S.length?p||(p=!0,h.call(this,new Jr(m,this,y.originalEvent,{features:S}))):p=!1},mouseout:()=>{p=!1}}}}if(m==="mouseleave"||m==="mouseout"){let p=!1;return{layers:s,listener:h,delegates:{mousemove:w=>{const S=s.filter(C=>this.getLayer(C));(S.length!==0?this.queryRenderedFeatures(w.point,{layers:S}):[]).length?p=!0:p&&(p=!1,h.call(this,new Jr(m,this,w.originalEvent)))},mouseout:w=>{p&&(p=!1,h.call(this,new Jr(m,this,w.originalEvent)))}}}}{const p=g=>{const y=s.filter(S=>this.getLayer(S)),w=y.length!==0?this.queryRenderedFeatures(g.point,{layers:y}):[];w.length&&(g.features=w,h.call(this,g),delete g.features)};return{layers:s,listener:h,delegates:{[m]:p}}}}_saveDelegatedListener(m,s){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[m]=this._delegatedListeners[m]||[],this._delegatedListeners[m].push(s)}_removeDelegatedListener(m,s,h){if(!this._delegatedListeners||!this._delegatedListeners[m])return;const p=this._delegatedListeners[m];for(let g=0;g<p.length;g++){const y=p[g];if(y.listener===h&&y.layers.length===s.length&&y.layers.every(w=>s.includes(w))){for(const w in y.delegates)this.off(w,y.delegates[w]);return void p.splice(g,1)}}}on(m,s,h){if(h===void 0)return super.on(m,s);const p=typeof s=="string"?[s]:s,g=this._createDelegatedListener(m,p,h);this._saveDelegatedListener(m,g);for(const y in g.delegates)this.on(y,g.delegates[y]);return{unsubscribe:()=>{this._removeDelegatedListener(m,p,h)}}}once(m,s,h){if(h===void 0)return super.once(m,s);const p=typeof s=="string"?[s]:s,g=this._createDelegatedListener(m,p,h);for(const y in g.delegates){const w=g.delegates[y];g.delegates[y]=(...S)=>{this._removeDelegatedListener(m,p,h),w(...S)}}this._saveDelegatedListener(m,g);for(const y in g.delegates)this.once(y,g.delegates[y]);return this}off(m,s,h){return h===void 0?super.off(m,s):(this._removeDelegatedListener(m,typeof s=="string"?[s]:s,h),this)}queryRenderedFeatures(m,s){if(!this.style)return[];let h;const p=m instanceof a.P||Array.isArray(m),g=p?m:[[0,0],[this.transform.width,this.transform.height]];if(s=s||(p?{}:m)||{},g instanceof a.P||typeof g[0]=="number")h=[a.P.convert(g)];else{const y=a.P.convert(g[0]),w=a.P.convert(g[1]);h=[y,new a.P(w.x,y.y),w,new a.P(y.x,w.y),y]}return this.style.queryRenderedFeatures(h,s,this.transform)}querySourceFeatures(m,s){return this.style.querySourceFeatures(m,s)}setStyle(m,s){return(s=a.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},s)).diff!==!1&&s.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&m?(this._diffStyle(m,s),this):(this._localIdeographFontFamily=s.localIdeographFontFamily,this._updateStyle(m,s))}setTransformRequest(m){return this._requestManager.setTransformRequest(m),this}_getUIString(m){const s=this._locale[m];if(s==null)throw new Error(`Missing UI string '${m}'`);return s}_updateStyle(m,s){var h,p;if(s.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(m,s));const g=this.style&&s.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!m)),m?(this.style=new Tu(this,s||{}),this.style.setEventedParent(this,{style:this.style}),typeof m=="string"?this.style.loadURL(m,s,g):this.style.loadJSON(m,s,g),this):((p=(h=this.style)===null||h===void 0?void 0:h.projection)===null||p===void 0||p.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Tu(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(m,s){if(typeof m=="string"){const h=this._requestManager.transformRequest(m,"Style");a.j(h,new AbortController).then(p=>{this._updateDiff(p.data,s)}).catch(p=>{p&&this.fire(new a.k(p))})}else typeof m=="object"&&this._updateDiff(m,s)}_updateDiff(m,s){try{this.style.setState(m,s)&&this._update(!0)}catch(h){a.w(`Unable to perform style diff: ${h.message||h.error||h}.  Rebuilding the style from scratch.`),this._updateStyle(m,s)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():a.w("There is no style added to the map.")}addSource(m,s){return this._lazyInitEmptyStyle(),this.style.addSource(m,s),this._update(!0)}isSourceLoaded(m){const s=this.style&&this.style.sourceCaches[m];if(s!==void 0)return s.loaded();this.fire(new a.k(new Error(`There is no source with ID '${m}'`)))}setTerrain(m){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),m){const s=this.style.sourceCaches[m.source];if(!s)throw new Error(`cannot load terrain, because there exists no source with ID: ${m.source}`);this.terrain===null&&s.reload();for(const h in this.style._layers){const p=this.style._layers[h];p.type==="hillshade"&&p.source===m.source&&a.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality."),p.type==="color-relief"&&p.source===m.source&&a.w("You are using the same source for a color-relief layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new vt(this.painter,s,m),this.painter.renderToTexture=new nh(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=h=>{var p;h.dataType==="style"?this.terrain.sourceCache.freeRtt():h.dataType==="source"&&h.tile&&(h.sourceId!==m.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),((p=h.source)===null||p===void 0?void 0:p.type)==="image"?this.terrain.sourceCache.freeRtt():this.terrain.sourceCache.freeRtt(h.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new a.l("terrain",{terrain:m})),this}getTerrain(){var m,s;return(s=(m=this.terrain)===null||m===void 0?void 0:m.options)!==null&&s!==void 0?s:null}areTilesLoaded(){const m=this.style&&this.style.sourceCaches;for(const s in m){const h=m[s]._tiles;for(const p in h){const g=h[p];if(g.state!=="loaded"&&g.state!=="errored")return!1}}return!0}removeSource(m){return this.style.removeSource(m),this._update(!0)}getSource(m){return this.style.getSource(m)}setSourceTileLodParams(m,s,h){if(h){const p=this.getSource(h);if(!p)throw new Error(`There is no source with ID "${h}", cannot set LOD parameters`);p.calculateTileZoom=Ge(Math.max(1,m),Math.max(1,s))}else for(const p in this.style.sourceCaches)this.style.sourceCaches[p].getSource().calculateTileZoom=Ge(Math.max(1,m),Math.max(1,s));return this._update(!0),this}refreshTiles(m,s){const h=this.style.sourceCaches[m];if(!h)throw new Error(`There is no source cache with ID "${m}", cannot refresh tile`);s===void 0?h.reload(!0):h.refreshTiles(s.map(p=>new a.a4(p.z,p.x,p.y)))}addImage(m,s,h={}){const{pixelRatio:p=1,sdf:g=!1,stretchX:y,stretchY:w,content:S,textFitWidth:C,textFitHeight:R}=h;if(this._lazyInitEmptyStyle(),!(s instanceof HTMLImageElement||a.b(s))){if(s.width===void 0||s.height===void 0)return this.fire(new a.k(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:B,height:k,data:F}=s,V=s;return this.style.addImage(m,{data:new a.R({width:B,height:k},new Uint8Array(F)),pixelRatio:p,stretchX:y,stretchY:w,content:S,textFitWidth:C,textFitHeight:R,sdf:g,version:0,userImage:V}),V.onAdd&&V.onAdd(this,m),this}}{const{width:B,height:k,data:F}=N.getImageData(s);this.style.addImage(m,{data:new a.R({width:B,height:k},F),pixelRatio:p,stretchX:y,stretchY:w,content:S,textFitWidth:C,textFitHeight:R,sdf:g,version:0})}}updateImage(m,s){const h=this.style.getImage(m);if(!h)return this.fire(new a.k(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const p=s instanceof HTMLImageElement||a.b(s)?N.getImageData(s):s,{width:g,height:y,data:w}=p;if(g===void 0||y===void 0)return this.fire(new a.k(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(g!==h.data.width||y!==h.data.height)return this.fire(new a.k(new Error("The width and height of the updated image must be that same as the previous version of the image")));const S=!(s instanceof HTMLImageElement||a.b(s));return h.data.replace(w,S),this.style.updateImage(m,h),this}getImage(m){return this.style.getImage(m)}hasImage(m){return m?!!this.style.getImage(m):(this.fire(new a.k(new Error("Missing required image id"))),!1)}removeImage(m){this.style.removeImage(m)}loadImage(m){return Ue.getImage(this._requestManager.transformRequest(m,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(m,s){return this._lazyInitEmptyStyle(),this.style.addLayer(m,s),this._update(!0)}moveLayer(m,s){return this.style.moveLayer(m,s),this._update(!0)}removeLayer(m){return this.style.removeLayer(m),this._update(!0)}getLayer(m){return this.style.getLayer(m)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(m,s,h){return this.style.setLayerZoomRange(m,s,h),this._update(!0)}setFilter(m,s,h={}){return this.style.setFilter(m,s,h),this._update(!0)}getFilter(m){return this.style.getFilter(m)}setPaintProperty(m,s,h,p={}){return this.style.setPaintProperty(m,s,h,p),this._update(!0)}getPaintProperty(m,s){return this.style.getPaintProperty(m,s)}setLayoutProperty(m,s,h,p={}){return this.style.setLayoutProperty(m,s,h,p),this._update(!0)}getLayoutProperty(m,s){return this.style.getLayoutProperty(m,s)}setGlyphs(m,s={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(m,s),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(m,s,h={}){return this._lazyInitEmptyStyle(),this.style.addSprite(m,s,h,p=>{p||this._update(!0)}),this}removeSprite(m){return this._lazyInitEmptyStyle(),this.style.removeSprite(m),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(m,s={}){return this._lazyInitEmptyStyle(),this.style.setSprite(m,s,h=>{h||this._update(!0)}),this}setLight(m,s={}){return this._lazyInitEmptyStyle(),this.style.setLight(m,s),this._update(!0)}getLight(){return this.style.getLight()}setSky(m,s={}){return this._lazyInitEmptyStyle(),this.style.setSky(m,s),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(m,s){return this.style.setFeatureState(m,s),this._update()}removeFeatureState(m,s){return this.style.removeFeatureState(m,s),this._update()}getFeatureState(m){return this.style.getFeatureState(m)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let m=0,s=0;return this._container&&(m=this._container.clientWidth||400,s=this._container.clientHeight||300),[m,s]}_setupContainer(){const m=this._container;m.classList.add("maplibregl-map");const s=this._canvasContainer=U.create("div","maplibregl-canvas-container",m);this._interactive&&s.classList.add("maplibregl-interactive"),this._canvas=U.create("canvas","maplibregl-canvas",s),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const h=this._containerDimensions(),p=this._getClampedPixelRatio(h[0],h[1]);this._resizeCanvas(h[0],h[1],p);const g=this._controlContainer=U.create("div","maplibregl-control-container",m),y=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(w=>{y[w]=U.create("div",`maplibregl-ctrl-${w} `,g)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(m,s,h){this._canvas.width=Math.floor(h*m),this._canvas.height=Math.floor(h*s),this._canvas.style.width=`${m}px`,this._canvas.style.height=`${s}px`}_setupPainter(){const m=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0});let s=null;this._canvas.addEventListener("webglcontextcreationerror",p=>{s={requestedAttributes:m},p&&(s.statusMessage=p.statusMessage,s.type=p.type)},{once:!0});let h=null;if(h=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,m):this._canvas.getContext("webgl2",m)||this._canvas.getContext("webgl",m),!h){const p="Failed to initialize WebGL";throw s?(s.message=p,new Error(JSON.stringify(s))):new Error(p)}this.painter=new Np(h,this.transform),re.testSupport(h)}migrateProjection(m,s){super.migrateProjection(m,s),this.painter.transform=m,this.fire(new a.l("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(m){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||m,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(m){return this._update(),this._renderTaskQueue.add(m)}_cancelRenderFrame(m){this._renderTaskQueue.remove(m)}_render(m){var s,h,p,g,y;const w=this._idleTriggered?this._fadeDuration:0,S=((s=this.style.projection)===null||s===void 0?void 0:s.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(m),this._removed)return;let C=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const k=this.transform.zoom,F=N.now();this.style.zoomHistory.update(k,F);const V=new a.F(k,{now:F,fadeDuration:w,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition(),globalState:this.style.getGlobalState()}),G=V.crossFadingFactor();G===1&&G===this._crossFadingFactor||(C=!0,this._crossFadingFactor=G),this.style.update(V)}const R=((h=this.style.projection)===null||h===void 0?void 0:h.transitionState)>0!==S;(p=this.style.projection)===null||p===void 0||p.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState((g=this.style.projection)===null||g===void 0?void 0:g.transitionState,(y=this.style.projection)===null||y===void 0?void 0:y.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||R)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,w,this._crossSourceCollisions,R),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:w,showPadding:this.showPadding}),this.fire(new a.l("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,a.cw.mark(a.cx.load),this.fire(new a.l("load"))),this.style&&(this.style.hasTransitions()||C)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const B=this._sourcesDirty||this._styleDirty||this._placementDirty;return B||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new a.l("idle")),!this._loaded||this._fullyLoaded||B||(this._fullyLoaded=!0,a.cw.mark(a.cx.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var m;this._hash&&this._hash.remove();for(const h of this._controls)h.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),Ue.removeThrottleControl(this._imageQueueHandle),(m=this._resizeObserver)===null||m===void 0||m.disconnect();const s=this.painter.context.gl.getExtension("WEBGL_lose_context");s!=null&&s.loseContext&&s.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),U.remove(this._canvasContainer),U.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),a.cw.clearMetrics(),this._removed=!0,this.fire(new a.l("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,N.frame(this._frameRequest,m=>{a.cw.frame(m),this._frameRequest=null;try{this._render(m)}catch(s){if(!a.cy(s)&&!function(h){return h.message===xl}(s))throw s}},()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(m){this._showTileBoundaries!==m&&(this._showTileBoundaries=m,this._update())}get showPadding(){return!!this._showPadding}set showPadding(m){this._showPadding!==m&&(this._showPadding=m,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(m){this._showCollisionBoxes!==m&&(this._showCollisionBoxes=m,m?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(m){this._showOverdrawInspector!==m&&(this._showOverdrawInspector=m,this._update())}get repaint(){return!!this._repaint}set repaint(m){this._repaint!==m&&(this._repaint=m,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(m){this._vertices=m,this._update()}get version(){return Qp}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(m){return this._lazyInitEmptyStyle(),this.style.setProjection(m),this._update(!0)}},d.MapMouseEvent=Jr,d.MapTouchEvent=ya,d.MapWheelEvent=Xu,d.Marker=Sa,d.NavigationControl=class{constructor(m){this._updateZoomButtons=()=>{const s=this._map.getZoom(),h=s===this._map.getMaxZoom(),p=s===this._map.getMinZoom();this._zoomInButton.disabled=h,this._zoomOutButton.disabled=p,this._zoomInButton.setAttribute("aria-disabled",h.toString()),this._zoomOutButton.setAttribute("aria-disabled",p.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(s,h)=>{const p=this._map._getUIString(`NavigationControl.${h}`);s.title=p,s.setAttribute("aria-label",p)},this.options=a.e({},Wy,m),this._container=U.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",s=>s.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",s=>this._map.zoomIn({},{originalEvent:s})),U.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",s=>this._map.zoomOut({},{originalEvent:s})),U.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",s=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:s}):this._map.resetNorth({},{originalEvent:s})}),this._compassIcon=U.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(m){return this._map=m,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Pl(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){U.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(m,s){const h=U.create("button",m,this._container);return h.type="button",h.addEventListener("click",s),h}},d.Popup=class extends a.E{constructor(m){super(),this._updateOpacity=()=>{this.options.locationOccludedOpacity!==void 0&&(this._container.style.opacity=this._map.transform.isLocationOccluded(this.getLngLat())?`${this.options.locationOccludedOpacity}`:"")},this.remove=()=>(this._content&&U.remove(this._content),this._container&&(U.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new a.l("close"))),this),this._onMouseUp=s=>{this._update(s.point)},this._onMouseMove=s=>{this._update(s.point)},this._onDrag=s=>{this._update(s.point)},this._update=s=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=U.create("div","maplibregl-popup",this._map.getContainer()),this._tip=U.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const w of this.options.className.split(" "))this._container.classList.add(w);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=Oi(this._lngLat,this._flatPos,this._map.transform,this._trackPointer),this._trackPointer&&!s)return;const h=this._flatPos=this._pos=this._trackPointer&&s?s:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&s?s:this._map.transform.locationToScreenPoint(this._lngLat));let p=this.options.anchor;const g=lh(this.options.offset);if(!p){const w=this._container.offsetWidth,S=this._container.offsetHeight;let C;C=h.y+g.bottom.y<S?["top"]:h.y>this._map.transform.height-S?["bottom"]:[],h.x<w/2?C.push("left"):h.x>this._map.transform.width-w/2&&C.push("right"),p=C.length===0?"bottom":C.join("-")}let y=h.add(g[p]);this.options.subpixelPositioning||(y=y.round()),U.setTransform(this._container,`${oh[p]} translate(${y.x}px,${y.y}px)`),Ea(this._container,p,"popup"),this._updateOpacity()},this._onClose=()=>{this.remove()},this.options=a.e(Object.create(sd),m)}addTo(m){return this._map&&this.remove(),this._map=m,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new a.l("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(m){return this._lngLat=a.S.convert(m),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(m){return this.setDOMContent(document.createTextNode(m))}setHTML(m){const s=document.createDocumentFragment(),h=document.createElement("body");let p;for(h.innerHTML=m;p=h.firstChild,p;)s.appendChild(p);return this.setDOMContent(s)}getMaxWidth(){var m;return(m=this._container)===null||m===void 0?void 0:m.style.maxWidth}setMaxWidth(m){return this.options.maxWidth=m,this._update(),this}setDOMContent(m){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=U.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(m),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(m){return this._container&&this._container.classList.add(m),this}removeClassName(m){return this._container&&this._container.classList.remove(m),this}setOffset(m){return this.options.offset=m,this._update(),this}toggleClassName(m){if(this._container)return this._container.classList.toggle(m)}setSubpixelPositioning(m){this.options.subpixelPositioning=m}_createCloseButton(){this.options.closeButton&&(this._closeButton=U.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const m=this._container.querySelector(nd);m&&m.focus()}},d.RasterDEMTileSource=kr,d.RasterTileSource=Ni,d.ScaleControl=class{constructor(m){this._onMove=()=>{ah(this._map,this._container,this.options)},this.setUnit=s=>{this.options.unit=s,ah(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},Bl),m)}getDefaultPosition(){return"bottom-left"}onAdd(m){return this._map=m,this._container=U.create("div","maplibregl-ctrl maplibregl-ctrl-scale",m.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){U.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},d.ScrollZoomHandler=Wp,d.Style=Tu,d.TerrainControl=class{constructor(m){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=m}onAdd(m){return this._map=m,this._container=U.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=U.create("button","maplibregl-ctrl-terrain",this._container),U.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){U.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},d.TwoFingersTouchPitchHandler=eh,d.TwoFingersTouchRotateHandler=Ta,d.TwoFingersTouchZoomHandler=Qc,d.TwoFingersTouchZoomRotateHandler=Zp,d.VectorTileSource=vr,d.VideoSource=Ps,d.addSourceType=(m,s)=>a._(void 0,void 0,void 0,function*(){if(an(m))throw new Error(`A source type called "${m}" already exists.`);((h,p)=>{on[h]=p})(m,s)}),d.clearPrewarmedResources=function(){const m=gs;m&&(m.isPreloaded()&&m.numActive()===1?(m.release(or),gs=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},d.createTileMesh=xu,d.getMaxParallelImageRequests=function(){return a.a.MAX_PARALLEL_IMAGE_REQUESTS},d.getRTLTextPluginStatus=function(){return Bs().getRTLTextPluginStatus()},d.getVersion=function(){return od},d.getWorkerCount=function(){return Ai.workerCount},d.getWorkerUrl=function(){return a.a.WORKER_URL},d.importScriptInWorkers=function(m){return Pi().broadcast("IS",m)},d.prewarm=function(){In().acquire(or)},d.setMaxParallelImageRequests=function(m){a.a.MAX_PARALLEL_IMAGE_REQUESTS=m},d.setRTLTextPlugin=function(m,s){return Bs().setRTLTextPlugin(m,s)},d.setWorkerCount=function(m){Ai.workerCount=m},d.setWorkerUrl=function(m){a.a.WORKER_URL=m}});var u=i;return u})})(D0);var po=D0.exports;const Ad=us({__proto__:null,default:B0(po)},[po]),jE="https://api.olamaps.io/tiles/vector/v1/styles/default-light-standard/style.json?key=0.4.0",HE="https://api.olamaps.io/tiles/vector/v1/3dtiles/tileset.json",GE=t=>`<svg width="108" height="18" viewBox="0 0 108 18" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M31.0629 8.9393L34.6986 15.7293H38.2743L31.0629 2.2793L23.8516 15.7293H27.4273L31.0629 8.9393Z" fill="${t}"/><path d="M19.2265 12.5798L19.2365 2.25977H16.0703V15.7298H22.163L23.851 12.5798H19.2265Z" fill="${t}"/><path d="M7.22135 1.7793C5.79466 1.77733 4.39943 2.19909 3.21222 2.99123C2.025 3.78337 1.09915 4.91029 0.551806 6.22939C0.00446369 7.5485 -0.139771 9.00051 0.137352 10.4017C0.414475 11.8029 1.1005 13.0903 2.10863 14.1011C3.11676 15.1118 4.40168 15.8004 5.80082 16.0798C7.19996 16.3592 8.65043 16.2168 9.96872 15.6707C11.287 15.1245 12.4139 14.1991 13.2067 13.0116C13.9995 11.824 14.4227 10.4277 14.4227 8.9993C14.4227 7.08617 13.6643 5.25125 12.3141 3.89753C10.9639 2.5438 9.13219 1.78195 7.22135 1.7793ZM7.22135 12.8893C6.45207 12.8933 5.69892 12.6685 5.05735 12.2435C4.41579 11.8184 3.91469 11.2123 3.61755 10.5019C3.32041 9.79141 3.24061 9.00864 3.38827 8.25274C3.53592 7.49684 3.90438 6.80184 4.44695 6.25581C4.98952 5.70978 5.68178 5.3373 6.43601 5.18558C7.19023 5.03385 7.97246 5.10971 8.68358 5.40354C9.3947 5.69737 10.0027 6.19594 10.4305 6.83607C10.8583 7.4762 11.0867 8.22908 11.0867 8.9993C11.0867 9.51015 10.9862 10.016 10.791 10.4879C10.5957 10.9599 10.3095 11.3887 9.94873 11.7499C9.58794 12.1112 9.15963 12.3977 8.68823 12.5932C8.21684 12.7887 7.71161 12.8893 7.20138 12.8893H7.22135Z" fill="${t}"/><path d="M55.5634 4.82953V4.33953L50.4296 15.7295H49.4308L44.3768 4.33953V4.82953L43.9773 15.7295H42.9785L43.438 2.26953H44.5766L49.7104 13.8095C49.8003 14.0495 49.9102 14.2895 49.9801 14.5095C50.0543 14.2675 50.1513 14.0332 50.2698 13.8095L55.3437 2.26953H56.4723L56.9318 15.7295H55.933L55.5634 4.82953Z" fill="${t}"/><path d="M60.3287 15.7495H59.25L65.2428 2.26953H66.5513L72.5441 15.7495H71.4254L69.6875 11.8395H62.0666L60.3287 15.7495ZM66.4614 4.54953C66.2216 3.96953 66.0019 3.41953 65.8621 3.01953C65.7322 3.41953 65.5125 4.01953 65.2928 4.54953L62.4462 10.9095H69.288L66.4614 4.54953Z" fill="${t}"/><path d="M79.1611 2.14062C82.6669 2.14062 84.4048 3.62063 84.4048 6.62063C84.4048 9.62063 82.6669 11.0706 79.211 11.0706H75.9949V15.5906H74.9961V2.14062H79.1611ZM79.1611 10.1406C82.0077 10.1406 83.436 8.97062 83.416 6.61062C83.396 4.25062 82.0077 3.06062 79.1411 3.06062H75.9949V10.1406H79.1611Z" fill="${t}"/><path d="M95.1406 3.9293C93.7557 3.25763 92.2346 2.91539 90.6959 2.9293C88.8481 2.9293 87.6995 4.0193 87.6995 5.2293C87.6995 6.8693 88.5984 7.3593 91.6248 8.3693C94.6511 9.3793 95.9995 10.3693 95.9995 12.3693C95.9995 14.9993 93.942 15.9293 91.6947 15.9293C89.6115 15.9429 87.5948 15.1964 86.0215 13.8293L86.5009 13.0693C87.9375 14.3316 89.7833 15.0282 91.6947 15.0293C93.902 15.0293 95.0007 14.1193 95.0007 12.4893C95.0007 10.8593 94.1617 10.2093 90.9356 9.1293C88.069 8.1793 86.7007 7.5993 86.7007 5.2793C86.7007 3.3993 88.2488 2.0293 90.6959 2.0293C92.3497 2.03153 93.9817 2.40754 95.4702 3.1293L95.1406 3.9293Z" fill="${t}"/></svg>`;async function Sh(t,e,i,r){return r._parse(t,e,i,r)}function mi(t,e){if(!t)throw new Error(e||"loader assertion failed.")}const Ed=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),O0=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);O0&&parseFloat(O0[1]);const Sd=globalThis,Vl=globalThis.process||{},$E=globalThis.navigator||{};function F0(t){var r,o;if(typeof window<"u"&&((r=window.process)==null?void 0:r.type)==="renderer"||typeof process<"u"&&((o=process.versions)!=null&&o.electron))return!0;const i=typeof navigator<"u"&&navigator.userAgent;return!!(i&&i.indexOf("Electron")>=0)}function Go(){return!(typeof process=="object"&&String(process)==="[object process]"&&!(process!=null&&process.browser))||F0()}function WE(t){return Go()?F0()?"Electron":($E.userAgent||"").indexOf("Edge")>-1?"Edge":globalThis.chrome?"Chrome":globalThis.safari?"Safari":globalThis.mozInnerScreenX?"Firefox":"Unknown":"Node"}const k0="4.0.7";function XE(t){try{const e=window[t],i="__storage_test__";return e.setItem(i,i),e.removeItem(i),e}catch{return null}}class qE{constructor(e,i,r="sessionStorage"){this.storage=XE(r),this.id=e,this.config=i,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const i=JSON.stringify(this.config);this.storage.setItem(this.id,i)}}_loadConfiguration(){let e={};if(this.storage){const i=this.storage.getItem(this.id);e=i?JSON.parse(i):{}}return Object.assign(this.config,e),this}}function ZE(t){let e;return t<10?e=`${t.toFixed(2)}ms`:t<100?e=`${t.toFixed(1)}ms`:t<1e3?e=`${t.toFixed(0)}ms`:e=`${(t/1e3).toFixed(2)}s`,e}function KE(t,e=8){const i=Math.max(e-t.length,0);return`${" ".repeat(i)}${t}`}var Cd;(function(t){t[t.BLACK=30]="BLACK",t[t.RED=31]="RED",t[t.GREEN=32]="GREEN",t[t.YELLOW=33]="YELLOW",t[t.BLUE=34]="BLUE",t[t.MAGENTA=35]="MAGENTA",t[t.CYAN=36]="CYAN",t[t.WHITE=37]="WHITE",t[t.BRIGHT_BLACK=90]="BRIGHT_BLACK",t[t.BRIGHT_RED=91]="BRIGHT_RED",t[t.BRIGHT_GREEN=92]="BRIGHT_GREEN",t[t.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",t[t.BRIGHT_BLUE=94]="BRIGHT_BLUE",t[t.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",t[t.BRIGHT_CYAN=96]="BRIGHT_CYAN",t[t.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(Cd||(Cd={}));const YE=10;function N0(t){return typeof t!="string"?t:(t=t.toUpperCase(),Cd[t]||Cd.WHITE)}function JE(t,e,i){return!Go&&typeof t=="string"&&(e&&(t=`\x1B[${N0(e)}m${t}\x1B[39m`),i&&(t=`\x1B[${N0(i)+YE}m${t}\x1B[49m`)),t}function QE(t,e=["constructor"]){const i=Object.getPrototypeOf(t),r=Object.getOwnPropertyNames(i),o=t;for(const u of r){const d=o[u];typeof d=="function"&&(e.find(a=>u===a)||(o[u]=d.bind(t)))}}function y_(t,e){if(!t)throw new Error("Assertion failed")}function jl(){var e,i,r;let t;if(Go()&&Sd.performance)t=(i=(e=Sd==null?void 0:Sd.performance)==null?void 0:e.now)==null?void 0:i.call(e);else if("hrtime"in Vl){const o=(r=Vl==null?void 0:Vl.hrtime)==null?void 0:r.call(Vl);t=o[0]*1e3+o[1]/1e6}else t=Date.now();return t}const Hl={debug:Go()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},eS={enabled:!0,level:0};function Gl(){}const L0={},U0={once:!0};class $l{constructor({id:e}={id:""}){this.VERSION=k0,this._startTs=jl(),this._deltaTs=jl(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=e,this.userData={},this._storage=new qE(`__probe-${this.id}__`,eS),this.timeStamp(`${this.id} started`),QE(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((jl()-this._startTs).toPrecision(10))}getDelta(){return Number((jl()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(e=!0){return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,i){this._storage.setConfiguration({[e]:i})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,i){if(!e)throw new Error(i||"Assertion failed")}warn(e){return this._getLogFunction(0,e,Hl.warn,arguments,U0)}error(e){return this._getLogFunction(0,e,Hl.error,arguments)}deprecated(e,i){return this.warn(`\`${e}\` is deprecated and will be removed in a later version. Use \`${i}\` instead`)}removed(e,i){return this.error(`\`${e}\` has been removed. Use \`${i}\` instead`)}probe(e,i){return this._getLogFunction(e,i,Hl.log,arguments,{time:!0,once:!0})}log(e,i){return this._getLogFunction(e,i,Hl.debug,arguments)}info(e,i){return this._getLogFunction(e,i,console.info,arguments)}once(e,i){return this._getLogFunction(e,i,Hl.debug||Hl.info,arguments,U0)}table(e,i,r){return i?this._getLogFunction(e,i,console.table||Gl,r&&[r],{tag:iS(i)}):Gl}time(e,i){return this._getLogFunction(e,i,console.time?console.time:console.info)}timeEnd(e,i){return this._getLogFunction(e,i,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,i){return this._getLogFunction(e,i,console.timeStamp||Gl)}group(e,i,r={collapsed:!1}){const o=V0({logLevel:e,message:i,opts:r}),{collapsed:u}=r;return o.method=(u?console.groupCollapsed:console.group)||console.info,this._getLogFunction(o)}groupCollapsed(e,i,r={}){return this.group(e,i,Object.assign({},r,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||Gl)}withGroup(e,i,r){this.group(e,i)();try{r()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=z0(e)}_getLogFunction(e,i,r,o,u){if(this._shouldLog(e)){u=V0({logLevel:e,message:i,args:o,opts:u}),r=r||u.method,y_(r),u.total=this.getTotal(),u.delta=this.getDelta(),this._deltaTs=jl();const d=u.tag||u.message;if(u.once&&d)if(!L0[d])L0[d]=jl();else return Gl;return i=tS(this.id,u.message,u),r.bind(console,i,...u.args)}return Gl}}$l.VERSION=k0;function z0(t){if(!t)return 0;let e;switch(typeof t){case"number":e=t;break;case"object":e=t.logLevel||t.priority||0;break;default:return 0}return y_(Number.isFinite(e)&&e>=0),e}function V0(t){const{logLevel:e,message:i}=t;t.logLevel=z0(e);const r=t.args?Array.from(t.args):[];for(;r.length&&r.shift()!==i;);switch(typeof e){case"string":case"function":i!==void 0&&r.unshift(i),t.message=e;break;case"object":Object.assign(t,e);break}typeof t.message=="function"&&(t.message=t.message());const o=typeof t.message;return y_(o==="string"||o==="object"),Object.assign(t,{args:r},t.opts)}function tS(t,e,i){if(typeof e=="string"){const r=i.time?KE(ZE(i.total)):"";e=i.time?`${t}: ${r}  ${e}`:`${t}: ${e}`,e=JE(e,i.color,i.background)}return e}function iS(t){for(const e in t)for(const i in t[e])return i||"untitled";return"empty"}globalThis.probe={};const j0=new $l({id:"@probe.gl/log"}),b_="4.3.1",rS=b_[0]>="0"&&b_[0]<="9"?`v${b_}`:"";function sS(){const t=new $l({id:"loaders.gl"});return globalThis.loaders=globalThis.loaders||{},globalThis.loaders.log=t,globalThis.loaders.version=rS,globalThis.probe=globalThis.probe||{},globalThis.probe.loaders=t,t}const nS=sS();function oS(t,e){return H0(t||{},e)}function H0(t,e,i=0){if(i>3)return e;const r={...t};for(const[o,u]of Object.entries(e))u&&typeof u=="object"&&!Array.isArray(u)?r[o]=H0(r[o]||{},e[o],i+1):r[o]=e[o];return r}function aS(t){var e;globalThis.loaders||(globalThis.loaders={}),(e=globalThis.loaders).modules||(e.modules={}),Object.assign(globalThis.loaders.modules,t)}function lS(t){var i,r;return((r=(i=globalThis.loaders)==null?void 0:i.modules)==null?void 0:r[t])||null}const cS="latest";function hS(){var t;return(t=globalThis._loadersgl_)!=null&&t.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.3.1"),globalThis._loadersgl_.version}const G0=hS();function _o(t,e){if(!t)throw new Error(e||"loaders.gl assertion failed.")}const Qs=typeof process!="object"||String(process)!=="[object process]"||process.browser,v_=typeof importScripts=="function",uS=typeof window<"u"&&typeof window.orientation<"u",$0=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);$0&&parseFloat($0[1]);class dS{constructor(e,i){L(this,"name");L(this,"workerThread");L(this,"isRunning",!0);L(this,"result");L(this,"_resolve",()=>{});L(this,"_reject",()=>{});this.name=e,this.workerThread=i,this.result=new Promise((r,o)=>{this._resolve=r,this._reject=o})}postMessage(e,i){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:i})}done(e){_o(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){_o(this.isRunning),this.isRunning=!1,this._reject(e)}}class x_{terminate(){}}const w_=new Map;function fS(t){_o(t.source&&!t.url||!t.source&&t.url);let e=w_.get(t.source||t.url);return e||(t.url&&(e=pS(t.url),w_.set(t.url,e)),t.source&&(e=W0(t.source),w_.set(t.source,e))),_o(e),e}function pS(t){if(!t.startsWith("http"))return t;const e=_S(t);return W0(e)}function W0(t){const e=new Blob([t],{type:"application/javascript"});return URL.createObjectURL(e)}function _S(t){return`try {
  importScripts('${t}');
} catch (error) {
  console.error(error);
  throw error;
}`}function X0(t,e=!0,i){const r=i||new Set;if(t){if(q0(t))r.add(t);else if(q0(t.buffer))r.add(t.buffer);else if(!ArrayBuffer.isView(t)){if(e&&typeof t=="object")for(const o in t)X0(t[o],e,r)}}return i===void 0?Array.from(r):[]}function q0(t){return t?t instanceof ArrayBuffer||typeof MessagePort<"u"&&t instanceof MessagePort||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas:!1}const T_=()=>{};class A_{constructor(e){L(this,"name");L(this,"source");L(this,"url");L(this,"terminated",!1);L(this,"worker");L(this,"onMessage");L(this,"onError");L(this,"_loadableURL","");const{name:i,source:r,url:o}=e;_o(r||o),this.name=i,this.source=r,this.url=o,this.onMessage=T_,this.onError=u=>console.log(u),this.worker=Qs?this._createBrowserWorker():this._createNodeWorker()}static isSupported(){return typeof Worker<"u"&&Qs||typeof x_<"u"&&!Qs}destroy(){this.onMessage=T_,this.onError=T_,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(e,i){i=i||X0(e),this.worker.postMessage(e,i)}_getErrorFromErrorEvent(e){let i="Failed to load ";return i+=`worker ${this.name} from ${this.url}. `,e.message&&(i+=`${e.message} in `),e.lineno&&(i+=`:${e.lineno}:${e.colno}`),new Error(i)}_createBrowserWorker(){this._loadableURL=fS({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=i=>{i.data?this.onMessage(i.data):this.onError(new Error("No data received"))},e.onerror=i=>{this.onError(this._getErrorFromErrorEvent(i)),this.terminated=!0},e.onmessageerror=i=>console.error(i),e}_createNodeWorker(){let e;if(this.url){const r=this.url.includes(":/")||this.url.startsWith("/")?this.url:`./${this.url}`;e=new x_(r,{eval:!1})}else if(this.source)e=new x_(this.source,{eval:!0});else throw new Error("no worker");return e.on("message",i=>{this.onMessage(i)}),e.on("error",i=>{this.onError(i)}),e.on("exit",i=>{}),e}}class gS{constructor(e){L(this,"name","unnamed");L(this,"source");L(this,"url");L(this,"maxConcurrency",1);L(this,"maxMobileConcurrency",1);L(this,"onDebug",()=>{});L(this,"reuseWorkers",!0);L(this,"props",{});L(this,"jobQueue",[]);L(this,"idleQueue",[]);L(this,"count",0);L(this,"isDestroyed",!1);this.source=e.source,this.url=e.url,this.setProps(e)}static isSupported(){return A_.isSupported()}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},e.name!==void 0&&(this.name=e.name),e.maxConcurrency!==void 0&&(this.maxConcurrency=e.maxConcurrency),e.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=e.maxMobileConcurrency),e.reuseWorkers!==void 0&&(this.reuseWorkers=e.reuseWorkers),e.onDebug!==void 0&&(this.onDebug=e.onDebug)}async startJob(e,i=(o,u,d)=>o.done(d),r=(o,u)=>o.error(u)){const o=new Promise(u=>(this.jobQueue.push({name:e,onMessage:i,onError:r,onStart:u}),this));return this._startQueuedJob(),await o}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const i=this.jobQueue.shift();if(i){this.onDebug({message:"Starting job",name:i.name,workerThread:e,backlog:this.jobQueue.length});const r=new dS(i.name,e);e.onMessage=o=>i.onMessage(r,o.type,o.payload),e.onError=o=>i.onError(r,o),i.onStart(r);try{await r.result}catch(o){console.error(`Worker exception: ${o}`)}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){!Qs||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new A_({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return uS?this.maxMobileConcurrency:this.maxConcurrency}}const mS={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}},aa=class aa{constructor(e){L(this,"props");L(this,"workerPools",new Map);this.props={...mS},this.setProps(e),this.workerPools=new Map}static isSupported(){return A_.isSupported()}static getWorkerFarm(e={}){return aa._workerFarm=aa._workerFarm||new aa({}),aa._workerFarm.setProps(e),aa._workerFarm}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const i of this.workerPools.values())i.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:i,source:r,url:o}=e;let u=this.workerPools.get(i);return u||(u=new gS({name:i,source:r,url:o}),u.setProps(this._getWorkerPoolProps()),this.workerPools.set(i,u)),u}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}};L(aa,"_workerFarm");let Id=aa;function yS(t,e={}){const i=e[t.id]||{},r=Qs?`${t.id}-worker.js`:`${t.id}-worker-node.js`;let o=i.workerUrl;if(!o&&t.id==="compression"&&(o=e.workerUrl),e._workerType==="test"&&(Qs?o=`modules/${t.module}/dist/${r}`:o=`modules/${t.module}/src/workers/${t.id}-worker-node.ts`),!o){let u=t.version;u==="latest"&&(u=cS);const d=u?`@${u}`:"";o=`https://unpkg.com/@loaders.gl/${t.module}${d}/dist/${r}`}return _o(o),o}function bS(t,e=G0){_o(t,"no worker provided");const i=t.version;return!(!e||!i)}const E_={};async function Fa(t,e=null,i={},r=null){return e&&(t=vS(t,e,i,r)),E_[t]=E_[t]||xS(t),await E_[t]}function vS(t,e,i={},r=null){if(!i.useLocalLibraries&&t.startsWith("http"))return t;r=r||t;const o=i.modules||{};return o[r]?o[r]:Qs?i.CDN?(_o(i.CDN.startsWith("http")),`${i.CDN}/${e}@${G0}/dist/libs/${r}`):v_?`../src/libs/${r}`:`modules/${e}/src/libs/${r}`:`modules/${e}/dist/libs/${r}`}async function xS(t){if(t.endsWith("wasm"))return await TS(t);if(!Qs)try{const{requireFromFile:i}=globalThis.loaders||{};return await(i==null?void 0:i(t))}catch(i){return console.error(i),null}if(v_)return importScripts(t);const e=await AS(t);return wS(e,t)}function wS(t,e){if(!Qs){const{requireFromString:r}=globalThis.loaders||{};return r==null?void 0:r(t,e)}if(v_)return eval.call(globalThis,t),null;const i=document.createElement("script");i.id=e;try{i.appendChild(document.createTextNode(t))}catch{i.text=t}return document.body.appendChild(i),null}async function TS(t){const{readFileAsArrayBuffer:e}=globalThis.loaders||{};return Qs||!e||t.startsWith("http")?await(await fetch(t)).arrayBuffer():await e(t)}async function AS(t){const{readFileAsText:e}=globalThis.loaders||{};return Qs||!e||t.startsWith("http")?await(await fetch(t)).text():await e(t)}function ES(t,e){return!Id.isSupported()||!Qs&&!(e!=null&&e._nodeWorkers)?!1:t.worker&&(e==null?void 0:e.worker)}async function SS(t,e,i,r,o){const u=t.id,d=yS(t,i),x=Id.getWorkerFarm(i).getWorkerPool({name:u,url:d});i=JSON.parse(JSON.stringify(i)),r=JSON.parse(JSON.stringify(r||{}));const A=await x.startJob("process-on-worker",CS.bind(null,o));return A.postMessage("process",{input:e,options:i,context:r}),await(await A.result).result}async function CS(t,e,i,r){switch(i){case"done":e.done(r);break;case"error":e.error(new Error(r.error));break;case"process":const{id:o,input:u,options:d}=r;try{const a=await t(u,d);e.postMessage("done",{id:o,result:a})}catch(a){const x=a instanceof Error?a.message:"unknown error";e.postMessage("error",{id:o,error:x})}break;default:console.warn(`parse-with-worker unknown message ${i}`)}}function IS(t,e=5){return typeof t=="string"?t.slice(0,e):ArrayBuffer.isView(t)?Z0(t.buffer,t.byteOffset,e):t instanceof ArrayBuffer?Z0(t,0,e):""}function Z0(t,e,i){if(t.byteLength<=e+i)return"";const r=new DataView(t);let o="";for(let u=0;u<i;u++)o+=String.fromCharCode(r.getUint8(e+u));return o}function MS(t){try{return JSON.parse(t)}catch{throw new Error(`Failed to parse JSON from data starting with "${IS(t)}"`)}}function RS(t,e,i){if(i=i||t.byteLength,t.byteLength<i||e.byteLength<i)return!1;const r=new Uint8Array(t),o=new Uint8Array(e);for(let u=0;u<r.length;++u)if(r[u]!==o[u])return!1;return!0}function PS(...t){return BS(t)}function BS(t){const e=t.map(u=>u instanceof ArrayBuffer?new Uint8Array(u):u),i=e.reduce((u,d)=>u+d.byteLength,0),r=new Uint8Array(i);let o=0;for(const u of e)r.set(u,o),o+=u.byteLength;return r.buffer}function S_(t,e,i){const r=i!==void 0?new Uint8Array(t).subarray(e,e+i):new Uint8Array(t).subarray(e);return new Uint8Array(r).buffer}function Ch(t,e){return mi(t>=0),mi(e>0),t+(e-1)&~(e-1)}function DS(t,e,i){let r;if(t instanceof ArrayBuffer)r=new Uint8Array(t);else{const o=t.byteOffset,u=t.byteLength;r=new Uint8Array(t.buffer||t.arrayBuffer,o,u)}return e.set(r,i),i+Ch(r.byteLength,4)}async function OS(t){const e=[];for await(const i of t)e.push(i);return PS(...e)}function K0(){let t;if(typeof window<"u"&&window.performance)t=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();t=e[0]*1e3+e[1]/1e6}else t=Date.now();return t}class Y0{constructor(e,i){this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=e,this.type=i,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=K0(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(K0()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class Wl{constructor(e){this.stats={},this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e,i="count"){return this._getOrCreate({name:e,type:i})}get size(){return Object.keys(this.stats).length}reset(){for(const e of Object.values(this.stats))e.reset();return this}forEach(e){for(const i of Object.values(this.stats))e(i)}getTable(){const e={};return this.forEach(i=>{e[i.name]={time:i.time||0,count:i.count||0,average:i.getAverageTime()||0,hz:i.getHz()||0}}),e}_initializeStats(e=[]){e.forEach(i=>this._getOrCreate(i))}_getOrCreate(e){const{name:i,type:r}=e;let o=this.stats[i];return o||(e instanceof Y0?o=e:o=new Y0(i,r),this.stats[i]=o),o}}const FS="Queued Requests",kS="Active Requests",NS="Cancelled Requests",LS="Queued Requests Ever",US="Active Requests Ever",zS={id:"request-scheduler",throttleRequests:!0,maxRequests:6,debounceTime:0};class VS{constructor(e={}){L(this,"props");L(this,"stats");L(this,"activeRequestCount",0);L(this,"requestQueue",[]);L(this,"requestMap",new Map);L(this,"updateTimer",null);this.props={...zS,...e},this.stats=new Wl({id:this.props.id}),this.stats.get(FS),this.stats.get(kS),this.stats.get(NS),this.stats.get(LS),this.stats.get(US)}scheduleRequest(e,i=()=>0){if(!this.props.throttleRequests)return Promise.resolve({done:()=>{}});if(this.requestMap.has(e))return this.requestMap.get(e);const r={handle:e,priority:0,getPriority:i},o=new Promise(u=>(r.resolve=u,r));return this.requestQueue.push(r),this.requestMap.set(e,o),this._issueNewRequests(),o}_issueRequest(e){const{handle:i,resolve:r}=e;let o=!1;const u=()=>{o||(o=!0,this.requestMap.delete(i),this.activeRequestCount--,this._issueNewRequests())};return this.activeRequestCount++,r?r({done:u}):Promise.resolve({done:u})}_issueNewRequests(){this.updateTimer!==null&&clearTimeout(this.updateTimer),this.updateTimer=setTimeout(()=>this._issueNewRequestsAsync(),this.props.debounceTime)}_issueNewRequestsAsync(){this.updateTimer!==null&&clearTimeout(this.updateTimer),this.updateTimer=null;const e=Math.max(this.props.maxRequests-this.activeRequestCount,0);if(e!==0){this._updateAllRequests();for(let i=0;i<e;++i){const r=this.requestQueue.shift();r&&this._issueRequest(r)}}}_updateAllRequests(){const e=this.requestQueue;for(let i=0;i<e.length;++i){const r=e[i];this._updateRequest(r)||(e.splice(i,1),this.requestMap.delete(r.handle),i--)}e.sort((i,r)=>i.priority-r.priority)}_updateRequest(e){return e.priority=e.getPriority(e.handle),e.priority<0?(e.resolve(null),!1):!0}}let jS="";const J0={};function HS(t){for(const e in J0)if(t.startsWith(e)){const i=J0[e];t=t.replace(e,i)}return!t.startsWith("http://")&&!t.startsWith("https://")&&(t=`${jS}${t}`),t}function BV(t){return t}function GS(t){return t&&typeof t=="object"&&t.isBuffer}function Q0(t){if(GS(t))return t;if(t instanceof ArrayBuffer)return t;if(ArrayBuffer.isView(t))return t.byteOffset===0&&t.byteLength===t.buffer.byteLength?t.buffer:t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength);if(typeof t=="string"){const e=t;return new TextEncoder().encode(e).buffer}if(t&&typeof t=="object"&&t._toArrayBuffer)return t._toArrayBuffer();throw new Error("toArrayBuffer")}function $S(){var e;if(typeof process<"u"&&typeof process.cwd<"u")return process.cwd();const t=(e=window.location)==null?void 0:e.pathname;return(t==null?void 0:t.slice(0,t.lastIndexOf("/")+1))||""}function eb(t){const e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(e+1):""}function C_(t){const e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(0,e):""}function WS(...t){const e=[];for(let u=0;u<t.length;u++)e[u]=t[u];let i="",r=!1,o;for(let u=e.length-1;u>=-1&&!r;u--){let d;u>=0?d=e[u]:(o===void 0&&(o=$S()),d=o),d.length!==0&&(i=`${d}/${i}`,r=d.charCodeAt(0)===Ih)}return i=XS(i,!r),r?`/${i}`:i.length>0?i:"."}const Ih=47,I_=46;function XS(t,e){let i="",r=-1,o=0,u,d=!1;for(let a=0;a<=t.length;++a){if(a<t.length)u=t.charCodeAt(a);else{if(u===Ih)break;u=Ih}if(u===Ih){if(!(r===a-1||o===1))if(r!==a-1&&o===2){if(i.length<2||!d||i.charCodeAt(i.length-1)!==I_||i.charCodeAt(i.length-2)!==I_){if(i.length>2){const x=i.length-1;let A=x;for(;A>=0&&i.charCodeAt(A)!==Ih;--A);if(A!==x){i=A===-1?"":i.slice(0,A),r=a,o=0,d=!1;continue}}else if(i.length===2||i.length===1){i="",r=a,o=0,d=!1;continue}}e&&(i.length>0?i+="/..":i="..",d=!0)}else{const x=t.slice(r+1,a);i.length>0?i+=`/${x}`:i=x,d=!1}r=a,o=0}else u===I_&&o!==-1?++o:o=-1}return i}const qS=t=>typeof t=="boolean",Mh=t=>typeof t=="function",Rh=t=>t!==null&&typeof t=="object",tb=t=>Rh(t)&&t.constructor==={}.constructor,ZS=t=>!!t&&typeof t[Symbol.iterator]=="function",KS=t=>t&&typeof t[Symbol.asyncIterator]=="function",ka=t=>typeof Response<"u"&&t instanceof Response||t&&t.arrayBuffer&&t.text&&t.json,Na=t=>typeof Blob<"u"&&t instanceof Blob,YS=t=>t&&typeof t=="object"&&t.isBuffer,JS=t=>typeof ReadableStream<"u"&&t instanceof ReadableStream||Rh(t)&&Mh(t.tee)&&Mh(t.cancel)&&Mh(t.getReader),QS=t=>Rh(t)&&Mh(t.read)&&Mh(t.pipe)&&qS(t.readable),ib=t=>JS(t)||QS(t);class eC extends Error{constructor(i,r){super(i);L(this,"reason");L(this,"url");L(this,"response");this.reason=r.reason,this.url=r.url,this.response=r.response}}const tC=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,iC=/^([-\w.]+\/[-\w.+]+)/;function rb(t,e){return t.toLowerCase()===e.toLowerCase()}function rC(t){const e=iC.exec(t);return e?e[1]:t}function sb(t){const e=tC.exec(t);return e?e[1]:""}const nb=/\?.*/;function sC(t){const e=t.match(nb);return e&&e[0]}function M_(t){return t.replace(nb,"")}function nC(t){if(t.length<50)return t;const e=t.slice(t.length-15);return`${t.substr(0,32)}...${e}`}function Md(t){return ka(t)?t.url:Na(t)?t.name||"":typeof t=="string"?t:""}function R_(t){if(ka(t)){const e=t,i=e.headers.get("content-type")||"",r=M_(e.url);return rC(i)||sb(r)}return Na(t)?t.type||"":typeof t=="string"?sb(t):""}function oC(t){return ka(t)?t.headers["content-length"]||-1:Na(t)?t.size:typeof t=="string"?t.length:t instanceof ArrayBuffer||ArrayBuffer.isView(t)?t.byteLength:-1}async function ob(t){if(ka(t))return t;const e={},i=oC(t);i>=0&&(e["content-length"]=String(i));const r=Md(t),o=R_(t);o&&(e["content-type"]=o);const u=await cC(t);u&&(e["x-first-bytes"]=u),typeof t=="string"&&(t=new TextEncoder().encode(t));const d=new Response(t,{headers:e});return Object.defineProperty(d,"url",{value:r}),d}async function aC(t){if(!t.ok)throw await lC(t)}async function lC(t){const e=nC(t.url);let i=`Failed to fetch resource (${t.status}) ${t.statusText}: ${e}`;i=i.length>100?`${i.slice(0,100)}...`:i;const r={reason:t.statusText,url:t.url,response:t};try{const o=t.headers.get("Content-Type");r.reason=!t.bodyUsed&&(o!=null&&o.includes("application/json"))?await t.json():await t.text()}catch{}return new eC(i,r)}async function cC(t){if(typeof t=="string")return`data:,${t.slice(0,5)}`;if(t instanceof Blob){const i=t.slice(0,5);return await new Promise(r=>{const o=new FileReader;o.onload=u=>{var d;return r((d=u==null?void 0:u.target)==null?void 0:d.result)},o.readAsDataURL(i)})}if(t instanceof ArrayBuffer){const i=t.slice(0,5);return`data:base64,${hC(i)}`}return null}function hC(t){let e="";const i=new Uint8Array(t);for(let r=0;r<i.byteLength;r++)e+=String.fromCharCode(i[r]);return btoa(e)}function uC(t){return!dC(t)&&!fC(t)}function dC(t){return t.startsWith("http:")||t.startsWith("https:")}function fC(t){return t.startsWith("data:")}async function ab(t,e){var i,r;if(typeof t=="string"){const o=HS(t);return uC(o)&&(i=globalThis.loaders)!=null&&i.fetchNode?(r=globalThis.loaders)==null?void 0:r.fetchNode(o,e):await fetch(o,e)}return await ob(t)}const lb=new $l({id:"loaders.gl"});class pC{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class _C{constructor(){L(this,"console");this.console=console}log(...e){return this.console.log.bind(this.console,...e)}info(...e){return this.console.info.bind(this.console,...e)}warn(...e){return this.console.warn.bind(this.console,...e)}error(...e){return this.console.error.bind(this.console,...e)}}const cb={fetch:null,mimeType:void 0,nothrow:!1,log:new _C,useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:Ed,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},gC={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function hb(){globalThis.loaders=globalThis.loaders||{};const{loaders:t}=globalThis;return t._state||(t._state={}),t._state}function ub(){const t=hb();return t.globalOptions=t.globalOptions||{...cb},t.globalOptions}function mC(t,e,i,r){return i=i||[],i=Array.isArray(i)?i:[i],yC(t,i),vC(e,t,r)}function yC(t,e){db(t,null,cb,gC,e);for(const i of e){const r=t&&t[i.id]||{},o=i.options&&i.options[i.id]||{},u=i.deprecatedOptions&&i.deprecatedOptions[i.id]||{};db(r,i.id,o,u,e)}}function db(t,e,i,r,o){const u=e||"Top level",d=e?`${e}.`:"";for(const a in t){const x=!e&&Rh(t[a]),A=a==="baseUri"&&!e,M=a==="workerUrl"&&e;if(!(a in i)&&!A&&!M){if(a in r)lb.warn(`${u} loader option '${d}${a}' no longer supported, use '${r[a]}'`)();else if(!x){const D=bC(a,o);lb.warn(`${u} loader option '${d}${a}' not recognized. ${D}`)()}}}}function bC(t,e){const i=t.toLowerCase();let r="";for(const o of e)for(const u in o.options){if(t===u)return`Did you mean '${o.id}.${u}'?`;const d=u.toLowerCase();(i.startsWith(d)||d.startsWith(i))&&(r=r||`Did you mean '${o.id}.${u}'?`)}return r}function vC(t,e,i){const o={...t.options||{}};return xC(o,i),o.log===null&&(o.log=new pC),fb(o,ub()),fb(o,e),o}function fb(t,e){for(const i in e)if(i in e){const r=e[i];tb(r)&&tb(t[i])?t[i]={...t[i],...e[i]}:t[i]=e[i]}}function xC(t,e){e&&!("baseUri"in t)&&(t.baseUri=e)}function P_(t){return t?(Array.isArray(t)&&(t=t[0]),Array.isArray(t==null?void 0:t.extensions)):!1}function B_(t){mi(t,"null loader"),mi(P_(t),"invalid loader");let e;return Array.isArray(t)&&(e=t[1],t=t[0],t={...t,options:{...t.options,...e}}),(t!=null&&t.parseTextSync||t!=null&&t.parseText)&&(t.text=!0),t.text||(t.binary=!0),t}const pb=()=>{const t=hb();return t.loaderRegistry=t.loaderRegistry||[],t.loaderRegistry};function wC(t){const e=pb();t=Array.isArray(t)?t:[t];for(const i of t){const r=B_(i);e.find(o=>r===o)||e.unshift(r)}}function TC(){return pb()}const AC=/\.([^.]+)$/;async function EC(t,e=[],i,r){if(!gb(t))return null;let o=_b(t,e,{...i,nothrow:!0},r);if(o)return o;if(Na(t)&&(t=await t.slice(0,10).arrayBuffer(),o=_b(t,e,i,r)),!o&&!(i!=null&&i.nothrow))throw new Error(mb(t));return o}function _b(t,e=[],i,r){if(!gb(t))return null;if(e&&!Array.isArray(e))return B_(e);let o=[];e&&(o=o.concat(e)),i!=null&&i.ignoreRegisteredLoaders||o.push(...TC()),CC(o);const u=SC(t,o,i,r);if(!u&&!(i!=null&&i.nothrow))throw new Error(mb(t));return u}function SC(t,e,i,r){const o=Md(t),u=R_(t),d=M_(o)||(r==null?void 0:r.url);let a=null,x="";return i!=null&&i.mimeType&&(a=D_(e,i==null?void 0:i.mimeType),x=`match forced by supplied MIME type ${i==null?void 0:i.mimeType}`),a=a||IC(e,d),x=x||(a?`matched url ${d}`:""),a=a||D_(e,u),x=x||(a?`matched MIME type ${u}`:""),a=a||RC(e,t),x=x||(a?`matched initial data ${bb(t)}`:""),i!=null&&i.fallbackMimeType&&(a=a||D_(e,i==null?void 0:i.fallbackMimeType),x=x||(a?`matched fallback MIME type ${u}`:"")),x&&nS.log(1,`selectLoader selected ${a==null?void 0:a.name}: ${x}.`),a}function gb(t){return!(t instanceof Response&&t.status===204)}function mb(t){const e=Md(t),i=R_(t);let r="No valid loader found (";r+=e?`${eb(e)}, `:"no url provided, ",r+=`MIME type: ${i?`"${i}"`:"not provided"}, `;const o=t?bb(t):"";return r+=o?` first bytes: "${o}"`:"first bytes: not available",r+=")",r}function CC(t){for(const e of t)B_(e)}function IC(t,e){const i=e&&AC.exec(e),r=i&&i[1];return r?MC(t,r):null}function MC(t,e){e=e.toLowerCase();for(const i of t)for(const r of i.extensions)if(r.toLowerCase()===e)return i;return null}function D_(t,e){var i;for(const r of t)if((i=r.mimeTypes)!=null&&i.some(o=>rb(e,o))||rb(e,`application/x.${r.id}`))return r;return null}function RC(t,e){if(!e)return null;for(const i of t)if(typeof e=="string"){if(PC(e,i))return i}else if(ArrayBuffer.isView(e)){if(yb(e.buffer,e.byteOffset,i))return i}else if(e instanceof ArrayBuffer&&yb(e,0,i))return i;return null}function PC(t,e){return e.testText?e.testText(t):(Array.isArray(e.tests)?e.tests:[e.tests]).some(r=>t.startsWith(r))}function yb(t,e,i){return(Array.isArray(i.tests)?i.tests:[i.tests]).some(o=>BC(t,e,i,o))}function BC(t,e,i,r){if(r instanceof ArrayBuffer)return RS(r,t,r.byteLength);switch(typeof r){case"function":return r(t);case"string":const o=O_(t,e,r.length);return r===o;default:return!1}}function bb(t,e=5){return typeof t=="string"?t.slice(0,e):ArrayBuffer.isView(t)?O_(t.buffer,t.byteOffset,e):t instanceof ArrayBuffer?O_(t,0,e):""}function O_(t,e,i){if(t.byteLength<e+i)return"";const r=new DataView(t);let o="";for(let u=0;u<i;u++)o+=String.fromCharCode(r.getUint8(e+u));return o}const DC=256*1024;function*OC(t,e){const i=(e==null?void 0:e.chunkSize)||DC;let r=0;const o=new TextEncoder;for(;r<t.length;){const u=Math.min(t.length-r,i),d=t.slice(r,r+u);r+=u,yield o.encode(d)}}const FC=256*1024;function*kC(t,e={}){const{chunkSize:i=FC}=e;let r=0;for(;r<t.byteLength;){const o=Math.min(t.byteLength-r,i),u=new ArrayBuffer(o),d=new Uint8Array(t,r,o);new Uint8Array(u).set(d),r+=o,yield u}}const NC=1024*1024;async function*LC(t,e){const i=(e==null?void 0:e.chunkSize)||NC;let r=0;for(;r<t.size;){const o=r+i,u=await t.slice(r,o).arrayBuffer();r=o,yield u}}function vb(t,e){return Ed?UC(t,e):zC(t)}async function*UC(t,e){const i=t.getReader();let r;try{for(;;){const o=r||i.read();e!=null&&e._streamReadAhead&&(r=i.read());const{done:u,value:d}=await o;if(u)return;yield Q0(d)}}catch{i.releaseLock()}}async function*zC(t,e){for await(const i of t)yield Q0(i)}function VC(t,e){if(typeof t=="string")return OC(t,e);if(t instanceof ArrayBuffer)return kC(t,e);if(Na(t))return LC(t,e);if(ib(t))return vb(t,e);if(ka(t))return vb(t.body,e);throw new Error("makeIterator")}const xb="Cannot convert supplied data type";function jC(t,e,i){if(e.text&&typeof t=="string")return t;if(YS(t)&&(t=t.buffer),t instanceof ArrayBuffer){const r=t;return e.text&&!e.binary?new TextDecoder("utf8").decode(r):r}if(ArrayBuffer.isView(t)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(t);let r=t.buffer;const o=t.byteLength||t.length;return(t.byteOffset!==0||o!==r.byteLength)&&(r=r.slice(t.byteOffset,t.byteOffset+o)),r}throw new Error(xb)}async function HC(t,e,i){const r=t instanceof ArrayBuffer||ArrayBuffer.isView(t);if(typeof t=="string"||r)return jC(t,e);if(Na(t)&&(t=await ob(t)),ka(t)){const o=t;return await aC(o),e.binary?await o.arrayBuffer():await o.text()}if(ib(t)&&(t=VC(t,i)),ZS(t)||KS(t))return OS(t);throw new Error(xb)}function wb(t,e){const i=ub(),r=t||i;return typeof r.fetch=="function"?r.fetch:Rh(r.fetch)?o=>ab(o,r.fetch):e!=null&&e.fetch?e==null?void 0:e.fetch:ab}function GC(t,e,i){if(i)return i;const r={fetch:wb(e,t),...t};if(r.url){const o=M_(r.url);r.baseUrl=o,r.queryString=sC(r.url),r.filename=eb(o),r.baseUrl=C_(o)}return Array.isArray(r.loaders)||(r.loaders=null),r}function $C(t,e){if(t&&!Array.isArray(t))return t;let i;if(t&&(i=Array.isArray(t)?t:[t]),e&&e.loaders){const r=Array.isArray(e.loaders)?e.loaders:[e.loaders];i=i?[...i,...r]:r}return i&&i.length?i:void 0}async function Rd(t,e,i,r){e&&!Array.isArray(e)&&!P_(e)&&(r=void 0,i=e,e=void 0),t=await t,i=i||{};const o=Md(t),d=$C(e,r),a=await EC(t,d,i);return a?(i=mC(i,a,d,o),r=GC({url:o,_parse:Rd,loaders:d},i,r||null),await WC(a,t,i,r)):null}async function WC(t,e,i,r){if(bS(t),i=oS(t.options,i),ka(e)){const u=e,{ok:d,redirected:a,status:x,statusText:A,type:M,url:D}=u,N=Object.fromEntries(u.headers.entries());r.response={headers:N,ok:d,redirected:a,status:x,statusText:A,type:M,url:D}}e=await HC(e,t,i);const o=t;if(o.parseTextSync&&typeof e=="string")return o.parseTextSync(e,i,r);if(ES(t,i))return await SS(t,e,i,r,Rd);if(o.parseText&&typeof e=="string")return await o.parseText(e,i,r);if(o.parse)return await o.parse(e,i,r);throw _o(!o.parseSync),new Error(`${t.id} loader - no parser found and worker is disabled`)}function XC(t){switch(t.constructor){case Int8Array:return"int8";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int16Array:return"int16";case Uint16Array:return"uint16";case Int32Array:return"int32";case Uint32Array:return"uint32";case Float32Array:return"float32";case Float64Array:return"float64";default:return"null"}}function Tb(t){let e=1/0,i=1/0,r=1/0,o=-1/0,u=-1/0,d=-1/0;const a=t.POSITION?t.POSITION.value:[],x=a&&a.length;for(let A=0;A<x;A+=3){const M=a[A],D=a[A+1],N=a[A+2];e=M<e?M:e,i=D<i?D:i,r=N<r?N:r,o=M>o?M:o,u=D>u?D:u,d=N>d?N:d}return[[e,i,r],[o,u,d]]}function qC(t,e,i){const r=XC(e.value),o=i||ZC(e);return{name:t,type:{type:"fixed-size-list",listSize:e.size,children:[{name:"value",type:r}]},nullable:!1,metadata:o}}function ZC(t){const e={};return"byteOffset"in t&&(e.byteOffset=t.byteOffset.toString(10)),"byteStride"in t&&(e.byteStride=t.byteStride.toString(10)),"normalized"in t&&(e.normalized=t.normalized.toString()),e}async function $o(t,e,i,r){let o,u;!Array.isArray(e)&&!P_(e)?(o=[],u=e):(o=e,u=i);const d=wb(u);let a=t;return typeof t=="string"&&(a=await d(t)),Na(t)&&(a=await d(t)),Array.isArray(o)?await Rd(a,o,u):await Rd(a,o,u)}const KC="4.3.1",YC=(oA=globalThis.loaders)==null?void 0:oA.parseImageNode,F_=typeof Image<"u",k_=typeof ImageBitmap<"u",N_=Ed?!0:!!YC;function JC(t){switch(t){case"auto":return k_||F_||N_;case"imagebitmap":return k_;case"image":return F_;case"data":return N_;default:throw new Error(`@loaders.gl/images: image ${t} not supported in this environment`)}}function QC(){if(k_)return"imagebitmap";if(F_)return"image";if(N_)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function e2(t){const e=t2(t);if(!e)throw new Error("Not an image");return e}function Ab(t){switch(e2(t)){case"data":return t;case"image":case"imagebitmap":const e=document.createElement("canvas"),i=e.getContext("2d");if(!i)throw new Error("getImageData");return e.width=t.width,e.height=t.height,i.drawImage(t,0,0),i.getImageData(0,0,t.width,t.height);default:throw new Error("getImageData")}}function t2(t){return typeof ImageBitmap<"u"&&t instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&t instanceof Image?"image":t&&typeof t=="object"&&t.data&&t.width&&t.height?"data":null}const i2=/^data:image\/svg\+xml/,r2=/\.svg((\?|#).*)?$/;function L_(t){return t&&(i2.test(t)||r2.test(t))}function s2(t,e){if(L_(e)){let r=new TextDecoder().decode(t);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(r=unescape(encodeURIComponent(r)))}catch(u){throw new Error(u.message)}return`data:image/svg+xml;base64,${btoa(r)}`}return Eb(t,e)}function Eb(t,e){if(L_(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(t)])}async function Sb(t,e,i){const r=s2(t,i),o=self.URL||self.webkitURL,u=typeof r!="string"&&o.createObjectURL(r);try{return await n2(u||r,e)}finally{u&&o.revokeObjectURL(u)}}async function n2(t,e){const i=new Image;return i.src=t,e.image&&e.image.decode&&i.decode?(await i.decode(),i):await new Promise((r,o)=>{try{i.onload=()=>r(i),i.onerror=u=>{const d=u instanceof Error?u.message:"error";o(new Error(d))}}catch(u){o(u)}})}const o2={};let Cb=!0;async function a2(t,e,i){let r;L_(i)?r=await Sb(t,e,i):r=Eb(t,i);const o=e&&e.imagebitmap;return await l2(r,o)}async function l2(t,e=null){if((c2(e)||!Cb)&&(e=null),e)try{return await createImageBitmap(t,e)}catch(i){console.warn(i),Cb=!1}return await createImageBitmap(t)}function c2(t){for(const e in t||o2)return!1;return!0}function h2(t){return!p2(t,"ftyp",4)||!(t[8]&96)?null:u2(t)}function u2(t){switch(d2(t,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function d2(t,e,i){return String.fromCharCode(...t.slice(e,i))}function f2(t){return[...t].map(e=>e.charCodeAt(0))}function p2(t,e,i=0){const r=f2(e);for(let o=0;o<r.length;++o)if(r[o]!==t[o+i])return!1;return!0}const zn=!1,Ph=!0;function U_(t){const e=Bh(t);return g2(e)||b2(e)||m2(e)||y2(e)||_2(e)}function _2(t){const e=new Uint8Array(t instanceof DataView?t.buffer:t),i=h2(e);return i?{mimeType:i.mimeType,width:0,height:0}:null}function g2(t){const e=Bh(t);return e.byteLength>=24&&e.getUint32(0,zn)===2303741511?{mimeType:"image/png",width:e.getUint32(16,zn),height:e.getUint32(20,zn)}:null}function m2(t){const e=Bh(t);return e.byteLength>=10&&e.getUint32(0,zn)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,Ph),height:e.getUint16(8,Ph)}:null}function y2(t){const e=Bh(t);return e.byteLength>=14&&e.getUint16(0,zn)===16973&&e.getUint32(2,Ph)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,Ph),height:e.getUint32(22,Ph)}:null}function b2(t){const e=Bh(t);if(!(e.byteLength>=3&&e.getUint16(0,zn)===65496&&e.getUint8(2)===255))return null;const{tableMarkers:r,sofMarkers:o}=v2();let u=2;for(;u+9<e.byteLength;){const d=e.getUint16(u,zn);if(o.has(d))return{mimeType:"image/jpeg",height:e.getUint16(u+5,zn),width:e.getUint16(u+7,zn)};if(!r.has(d))return null;u+=2,u+=e.getUint16(u,zn)}return null}function v2(){const t=new Set([65499,65476,65484,65501,65534]);for(let i=65504;i<65520;++i)t.add(i);return{tableMarkers:t,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function Bh(t){if(t instanceof DataView)return t;if(ArrayBuffer.isView(t))return new DataView(t.buffer);if(t instanceof ArrayBuffer)return new DataView(t);throw new Error("toDataView")}async function x2(t,e){var o;const{mimeType:i}=U_(t)||{},r=(o=globalThis.loaders)==null?void 0:o.parseImageNode;return mi(r),await r(t,i)}async function w2(t,e,i){e=e||{};const o=(e.image||{}).type||"auto",{url:u}=i||{},d=T2(o);let a;switch(d){case"imagebitmap":a=await a2(t,e,u);break;case"image":a=await Sb(t,e,u);break;case"data":a=await x2(t);break;default:mi(!1)}return o==="data"&&(a=Ab(a)),a}function T2(t){switch(t){case"auto":case"data":return QC();default:return JC(t),t}}const Ib={dataType:null,batchType:null,id:"image",module:"images",name:"Images",version:KC,mimeTypes:["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],extensions:["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],parse:w2,tests:[t=>!!U_(new DataView(t))],options:{image:{type:"auto",decode:!0}}},z_={};function A2(t){if(z_[t]===void 0){const e=Ed?S2(t):E2(t);z_[t]=e}return z_[t]}function E2(t){var o,u;const e=["image/png","image/jpeg","image/gif"],i=((o=globalThis.loaders)==null?void 0:o.imageFormatsNode)||e;return!!((u=globalThis.loaders)==null?void 0:u.parseImageNode)&&i.includes(t)}function S2(t){switch(t){case"image/avif":case"image/webp":return C2(t);default:return!0}}function C2(t){try{return document.createElement("canvas").toDataURL(t).indexOf(`data:${t}`)===0}catch{return!1}}const Yt=new $l({id:"deck"});let V_={};function I2(t){V_=t}function Wr(t,e,i,r){Yt.level>0&&V_[t]&&V_[t].call(null,e,i,r)}function M2(t){const e=t[0],i=t[t.length-1];return e==="{"&&i==="}"||e==="["&&i==="]"}const R2={dataType:null,batchType:null,id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:M2,parseTextSync:JSON.parse};function P2(){const t="9.0.35",e=globalThis.deck&&globalThis.deck.VERSION;if(e&&e!==t)throw new Error(`deck.gl - multiple versions detected: ${e} vs ${t}`);return e||(Yt.log(1,`deck.gl ${t}`)(),globalThis.deck={...globalThis.deck,VERSION:t,version:t,log:Yt,_registerLoggers:I2},wC([R2,[Ib,{imagebitmap:{premultiplyAlpha:"none"}}]])),t}const B2=P2();function La(t,e){if(!t)throw new Error(e||"shadertools: assertion failed.")}const j_={number:{type:"number",validate(t,e){return Number.isFinite(t)&&typeof e=="object"&&(e.max===void 0||t<=e.max)&&(e.min===void 0||t>=e.min)}},array:{type:"array",validate(t,e){return Array.isArray(t)||ArrayBuffer.isView(t)}}};function D2(t){const e={};for(const[i,r]of Object.entries(t))e[i]=F2(r);return e}function O2(t,e,i){const r={};for(const[o,u]of Object.entries(e))t&&o in t&&!u.private?(u.validate&&La(u.validate(t[o],u),`${i}: invalid ${o}`),r[o]=t[o]):r[o]=u.value;return r}function F2(t){let e=Mb(t);if(e!=="object")return{value:t,...j_[e],type:e};if(typeof t=="object")return t?t.type!==void 0?{...t,...j_[t.type],type:t.type}:t.value===void 0?{type:"object",value:t}:(e=Mb(t.value),{...t,...j_[e],type:e}):{type:"object",value:null};throw new Error("props")}function Mb(t){return Array.isArray(t)||ArrayBuffer.isView(t)?"array":typeof t}const k2={vertex:`#ifdef MODULE_LOGDEPTH
logdepth_adjustPosition(gl_Position);
#endif
`,fragment:`#ifdef MODULE_MATERIAL
gl_FragColor = material_filterColor(gl_FragColor);
#endif
#ifdef MODULE_LIGHTING
gl_FragColor = lighting_filterColor(gl_FragColor);
#endif
#ifdef MODULE_FOG
gl_FragColor = fog_filterColor(gl_FragColor);
#endif
#ifdef MODULE_PICKING
gl_FragColor = picking_filterHighlightColor(gl_FragColor);
gl_FragColor = picking_filterPickingColor(gl_FragColor);
#endif
#ifdef MODULE_LOGDEPTH
logdepth_setFragDepth();
#endif
`},Rb=/void\s+main\s*\([^)]*\)\s*\{\n?/,Pb=/}\n?[^{}]*$/,H_=[],Pd="__LUMA_INJECT_DECLARATIONS__";function N2(t){const e={vertex:{},fragment:{}};for(const i in t){let r=t[i];const o=L2(i);typeof r=="string"&&(r={order:0,injection:r}),e[o][i]=r}return e}function L2(t){const e=t.slice(0,2);switch(e){case"vs":return"vertex";case"fs":return"fragment";default:throw new Error(e)}}function Bd(t,e,i,r=!1){const o=e==="vertex";for(const u in i){const d=i[u];d.sort((x,A)=>x.order-A.order),H_.length=d.length;for(let x=0,A=d.length;x<A;++x)H_[x]=d[x].injection;const a=`${H_.join(`
`)}
`;switch(u){case"vs:#decl":o&&(t=t.replace(Pd,a));break;case"vs:#main-start":o&&(t=t.replace(Rb,x=>x+a));break;case"vs:#main-end":o&&(t=t.replace(Pb,x=>a+x));break;case"fs:#decl":o||(t=t.replace(Pd,a));break;case"fs:#main-start":o||(t=t.replace(Rb,x=>x+a));break;case"fs:#main-end":o||(t=t.replace(Pb,x=>a+x));break;default:t=t.replace(u,x=>x+a)}}return t=t.replace(Pd,""),r&&(t=t.replace(/\}\s*$/,u=>u+k2[e])),t}let U2=1;class Ua{constructor(e){L(this,"name");L(this,"vs");L(this,"fs");L(this,"getModuleUniforms");L(this,"dependencies");L(this,"deprecations");L(this,"defines");L(this,"injections");L(this,"uniforms",{});L(this,"uniformTypes",{});const{name:i,vs:r,fs:o,dependencies:u=[],uniformTypes:d={},uniformPropTypes:a={},getUniforms:x,deprecations:A=[],defines:M={},inject:D={}}=e;La(typeof i=="string"),this.name=i,this.vs=r,this.fs=o,this.getModuleUniforms=x,this.dependencies=Ua.instantiateModules(u),this.deprecations=this._parseDeprecationDefinitions(A),this.defines=M,this.injections=N2(D),this.uniformTypes=d,a&&(this.uniforms=D2(a))}static instantiateModules(e){return e.map(i=>{if(i instanceof Ua)return i;La(typeof i!="string",`Shader module use by name is deprecated. Import shader module '${JSON.stringify(i)}' and use it directly.`),i.name||(console.warn("shader module has no name"),i.name=`shader-module-${U2++}`);const r=new Ua(i);return r.dependencies=Ua.instantiateModules(i.dependencies||[]),r})}getModuleSource(e){let i;switch(e){case"vertex":i=this.vs||"";break;case"fragment":i=this.fs||"";break;default:La(!1)}const r=this.name.toUpperCase().replace(/[^0-9a-z]/gi,"_");return`// ----- MODULE ${this.name} ---------------

#define MODULE_${r}
${i}

`}getUniforms(e,i){return this.getModuleUniforms?this.getModuleUniforms(e,i):O2(e,this.uniforms,this.name)}getDefines(){return this.defines}checkDeprecations(e,i){this.deprecations.forEach(r=>{var o;(o=r.regex)!=null&&o.test(e)&&(r.deprecated?i.deprecated(r.old,r.new)():i.removed(r.old,r.new)())})}_parseDeprecationDefinitions(e){return e.forEach(i=>{switch(i.type){case"function":i.regex=new RegExp(`\\b${i.old}\\(`);break;default:i.regex=new RegExp(`${i.type} ${i.old};`)}}),e}_defaultGetUniforms(e={}){const i={},r=this.uniforms;for(const o in r){const u=r[o];o in e&&!u.private?(u.validate&&La(u.validate(e[o],u),`${this.name}: invalid ${o}`),i[o]=e[o]):i[o]=u.value}return i}}function Bb(t){if(t.source&&t.platformInfo.type==="webgpu")return{...t,vs:void 0,fs:void 0};if(!t.vs)throw new Error("no vertex shader");const e=Db(t.platformInfo,t.vs);let i;return t.fs&&(i=Db(t.platformInfo,t.fs)),{...t,vs:e,fs:i}}function Db(t,e){if(typeof e=="string")return e;switch(t.type){case"webgpu":if(e!=null&&e.wgsl)return e.wgsl;throw new Error("WebGPU does not support GLSL shaders");default:if(e!=null&&e.glsl)return e.glsl;throw new Error("WebGL does not support WGSL shaders")}}function Dd(t){const e=Ua.instantiateModules(t);return z2(e)}function z2(t){const e={},i={};return Ob({modules:t,level:0,moduleMap:e,moduleDepth:i}),Object.keys(i).sort((r,o)=>i[o]-i[r]).map(r=>e[r])}function Ob(t){const{modules:e,level:i,moduleMap:r,moduleDepth:o}=t;if(i>=5)throw new Error("Possible loop in shader dependency graph");for(const u of e)r[u.name]=u,(o[u.name]===void 0||o[u.name]<i)&&(o[u.name]=i);for(const u of e)u.dependencies&&Ob({modules:u.dependencies,level:i+1,moduleMap:r,moduleDepth:o})}function V2(t){switch(t==null?void 0:t.gpu.toLowerCase()){case"apple":return`#define APPLE_GPU
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"nvidia":return`#define NVIDIA_GPU
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function j2(t,e){var r;if(Number(((r=t.match(/^#version[ \t]+(\d+)/m))==null?void 0:r[1])||100)!==300)throw new Error("luma.gl v9 only supports GLSL 3.00 shader sources");switch(e){case"vertex":return t=kb(t,H2),t;case"fragment":return t=kb(t,G2),t;default:throw new Error(e)}}const Fb=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],H2=[...Fb,[G_("attribute"),"in $1"],[G_("varying"),"out $1"]],G2=[...Fb,[G_("varying"),"in $1"]];function kb(t,e){for(const[i,r]of e)t=t.replace(i,r);return t}function G_(t){return new RegExp(`\\b${t}[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)`,"g")}function Nb(t,e){let i="";for(const r in t){const o=t[r];if(i+=`void ${o.signature} {
`,o.header&&(i+=`  ${o.header}`),e[r]){const u=e[r];u.sort((d,a)=>d.order-a.order);for(const d of u)i+=`  ${d.injection}
`}o.footer&&(i+=`  ${o.footer}`),i+=`}
`}return i}function Lb(t){const e={vertex:{},fragment:{}};for(const i of t){let r,o;typeof i!="string"?(r=i,o=r.hook):(r={},o=i),o=o.trim();const[u,d]=o.split(":"),a=o.replace(/\(.+/,""),x=Object.assign(r,{signature:d});switch(u){case"vs":e.vertex[a]=x;break;case"fs":e.fragment[a]=x;break;default:throw new Error(u)}}return e}function $2(t,e){return{name:W2(t,e),language:"glsl",version:X2(t)}}function W2(t,e="unnamed"){const r=/#define[^\S\r\n]*SHADER_NAME[^\S\r\n]*([A-Za-z0-9_-]+)\s*/.exec(t);return r?r[1]:e}function X2(t){let e=100;const i=t.match(/[^\s]+/g);if(i&&i.length>=2&&i[0]==="#version"){const r=parseInt(i[1],10);Number.isFinite(r)&&(e=r)}if(e!==100&&e!==300)throw new Error(`Invalid GLSL version ${e}`);return e}const Ub=`

${Pd}
`,q2=`precision highp float;
`;function Z2(t){const e=Dd(t.modules||[]);return{source:$_(t.platformInfo,{...t,source:t.source,stage:"vertex",modules:e}),getUniforms:W_(e)}}function K2(t){const e=Dd(t.modules||[]);return{vs:$_(t.platformInfo,{...t,source:t.vs,stage:"vertex",modules:e}),fs:$_(t.platformInfo,{...t,source:t.fs,stage:"fragment",modules:e}),getUniforms:W_(e)}}function Y2(t){const{vs:e,fs:i}=t,r=Dd(t.modules||[]);return{vs:zb(t.platformInfo,{...t,source:e,stage:"vertex",modules:r}),fs:zb(t.platformInfo,{...t,source:i,stage:"fragment",modules:r}),getUniforms:W_(r)}}function $_(t,e){const{source:i,stage:r,modules:o,hookFunctions:u=[],inject:d={},log:a}=e;La(typeof i=="string","shader source must be a string");const x=i;let A="";const M=Lb(u),D={},N={},U={};for(const ne in d){const xe=typeof d[ne]=="string"?{injection:d[ne],order:0}:d[ne],Ae=/^(v|f)s:(#)?([\w-]+)$/.exec(ne);if(Ae){const Te=Ae[2],Ie=Ae[3];Te?Ie==="decl"?N[ne]=[xe]:U[ne]=[xe]:D[ne]=[xe]}else U[ne]=[xe]}const re=t.type!=="webgpu"?o:[];for(const ne of re){a&&ne.checkDeprecations(x,a);const xe=ne.getModuleSource(r,"wgsl");A+=xe;const Ae=ne.injections[r];for(const Te in Ae){const Ie=/^(v|f)s:#([\w-]+)$/.exec(Te);if(Ie){const Xe=Ie[2]==="decl"?N:U;Xe[Te]=Xe[Te]||[],Xe[Te].push(Ae[Te])}else D[Te]=D[Te]||[],D[Te].push(Ae[Te])}}return A+=Ub,A=Bd(A,r,N),A+=Nb(M[r],D),A+=x,A=Bd(A,r,U),A}function zb(t,e){const{id:i,source:r,stage:o,language:u="glsl",modules:d,defines:a={},hookFunctions:x=[],inject:A={},prologue:M=!0,log:D}=e;La(typeof r=="string","shader source must be a string");const N=u==="glsl"?$2(r).version:-1,U=t.shaderLanguageVersion,re=N===100?"#version 100":"#version 300 es",xe=r.split(`
`).slice(1).join(`
`),Ae={};d.forEach(ht=>{Object.assign(Ae,ht.getDefines())}),Object.assign(Ae,a);let Te="";switch(u){case"wgsl":break;case"glsl":Te=M?`${re}

// ----- PROLOGUE -------------------------
${J2({id:i,source:r,stage:o})}
${`#define SHADER_TYPE_${o.toUpperCase()}`}
${V2(t)}
${o==="fragment"?q2:""}

// ----- APPLICATION DEFINES -------------------------

${Q2(Ae)}

`:`${re}
`;break}const Ie=Lb(x),Ue={},Xe={},qe={};for(const ht in A){const gt=typeof A[ht]=="string"?{injection:A[ht],order:0}:A[ht],nt=/^(v|f)s:(#)?([\w-]+)$/.exec(ht);if(nt){const at=nt[2],bt=nt[3];at?bt==="decl"?Xe[ht]=[gt]:qe[ht]=[gt]:Ue[ht]=[gt]}else qe[ht]=[gt]}for(const ht of d){D&&ht.checkDeprecations(xe,D);const gt=ht.getModuleSource(o);Te+=gt;const nt=ht.injections[o];for(const at in nt){const bt=/^(v|f)s:#([\w-]+)$/.exec(at);if(bt){const Ht=bt[2]==="decl"?Xe:qe;Ht[at]=Ht[at]||[],Ht[at].push(nt[at])}else Ue[at]=Ue[at]||[],Ue[at].push(nt[at])}}return Te+="// ----- MAIN SHADER SOURCE -------------------------",Te+=Ub,Te=Bd(Te,o,Xe),Te+=Nb(Ie[o],Ue),Te+=xe,Te=Bd(Te,o,qe),u==="glsl"&&N!==U&&(Te=j2(Te,o)),Te.trim()}function W_(t){return function(i){const r={};for(const o of t){const u=o.getUniforms(i,r);Object.assign(r,u)}return r}}function J2(t){const{id:e,source:i,stage:r}=t;return e&&i.indexOf("SHADER_NAME")===-1?`
#define SHADER_NAME ${e}_${r}

`:""}function Q2(t={}){let e="";for(const i in t){const r=t[i];(r||Number.isFinite(r))&&(e+=`#define ${i.toUpperCase()} ${t[i]}
`)}return e}const tl=class tl{constructor(){L(this,"_hookFunctions",[]);L(this,"_defaultModules",[])}static getDefaultShaderAssembler(){return tl.defaultShaderAssembler=tl.defaultShaderAssembler||new tl,tl.defaultShaderAssembler}addDefaultModule(e){this._defaultModules.find(i=>i.name===(typeof e=="string"?e:e.name))||this._defaultModules.push(e)}removeDefaultModule(e){const i=typeof e=="string"?e:e.name;this._defaultModules=this._defaultModules.filter(r=>r.name!==i)}addShaderHook(e,i){i&&(e=Object.assign(i,{hook:e})),this._hookFunctions.push(e)}assembleShader(e){const i=this._getModuleList(e.modules),r=this._hookFunctions,o=Bb(e);return{...Z2({platformInfo:e.platformInfo,...o,modules:i,hookFunctions:r}),modules:i}}assembleShaderPair(e){const i=Bb(e),r=this._getModuleList(e.modules),o=this._hookFunctions,{platformInfo:u}=e;return{...e.platformInfo.shaderLanguage==="wgsl"?K2({platformInfo:u,...i,modules:r,hookFunctions:o}):Y2({platformInfo:u,...i,modules:r,hookFunctions:o}),modules:r}}_getModuleList(e=[]){const i=new Array(this._defaultModules.length+e.length),r={};let o=0;for(let u=0,d=this._defaultModules.length;u<d;++u){const a=this._defaultModules[u],x=a.name;i[o++]=a,r[x]=!0}for(let u=0,d=e.length;u<d;++u){const a=e[u],x=a.name;r[x]||(i[o++]=a,r[x]=!0)}return i.length=o,Ua.instantiateModules(i)}};L(tl,"defaultShaderAssembler");let Od=tl;const eI=`#version 300 es
out vec4 transform_output;
void main() {
transform_output = vec4(0);
}`;function tI(t){const{input:e,inputChannels:i,output:r}={};if(!e)return eI;if(!i)throw new Error("inputChannels");const o=iI(i),u=rI(e,i);return`#version 300 es
in ${o} ${e};
out vec4 ${r};
void main() {
  ${r} = ${u};
}`}function iI(t){switch(t){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`invalid channels: ${t}`)}}function rI(t,e){switch(e){case 1:return`vec4(${t}, 0.0, 0.0, 1.0)`;case 2:return`vec4(${t}, 0.0, 1.0)`;case 3:return`vec4(${t}, 1.0)`;case 4:return t;default:throw new Error(`invalid channels: ${e}`)}}const Je=new $l({id:"luma.gl"});class sI{constructor(){L(this,"stats",new Map)}getStats(e){return this.get(e)}get(e){return this.stats.has(e)||this.stats.set(e,new Wl({id:e})),this.stats.get(e)}}const X_=new sI;function nI(){const t="9.0.27",e="set luma.log.level=1 (or higher) to trace rendering";if(globalThis.luma&&globalThis.luma.VERSION!==t)throw new Error(`luma.gl - multiple VERSIONs detected: ${globalThis.luma.VERSION} vs ${t}`);return globalThis.luma||(Go()&&Je.log(1,`${t} - ${e}`)(),globalThis.luma=globalThis.luma||{VERSION:t,version:t,log:Je,stats:X_}),t}const oI=nI();function aI(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)?t:null}function Dh(t){return Array.isArray(t)?t.length===0||typeof t[0]=="number"?t:null:aI(t)}const q_={};function Wo(t="id"){q_[t]=q_[t]||1;const e=q_[t]++;return`${t}-${e}`}function Fd(t){let e=!0;for(const i in t){e=!1;break}return e}let ui=(xy=class{constructor(e,i,r){L(this,"id");L(this,"props");L(this,"userData",{});L(this,"_device");L(this,"destroyed",!1);L(this,"allocatedBytes",0);L(this,"_attachedResources",new Set);if(!e)throw new Error("no device");this._device=e,this.props=lI(i,r);const o=this.props.id!=="undefined"?this.props.id:Wo(this[Symbol.toStringTag]);this.props.id=o,this.id=o,this.userData=this.props.userData||{},this.addStats()}destroy(){this.destroyResource()}delete(){return this.destroy(),this}toString(){return`${this[Symbol.toStringTag]||this.constructor.name}(${this.id})`}getProps(){return this.props}attachResource(e){this._attachedResources.add(e)}detachResource(e){this._attachedResources.delete(e)}destroyAttachedResource(e){this._attachedResources.delete(e)&&e.destroy()}destroyAttachedResources(){for(const e of Object.values(this._attachedResources))e.destroy();this._attachedResources=new Set}destroyResource(){this.destroyAttachedResources(),this.removeStats(),this.destroyed=!0}removeStats(){const e=this._device.statsManager.getStats("Resource Counts"),i=this[Symbol.toStringTag];e.get(`${i}s Active`).decrementCount()}trackAllocatedMemory(e,i=this[Symbol.toStringTag]){const r=this._device.statsManager.getStats("Resource Counts");r.get("GPU Memory").addCount(e),r.get(`${i} Memory`).addCount(e),this.allocatedBytes=e}trackDeallocatedMemory(e=this[Symbol.toStringTag]){const i=this._device.statsManager.getStats("Resource Counts");i.get("GPU Memory").subtractCount(this.allocatedBytes),i.get(`${e} Memory`).subtractCount(this.allocatedBytes),this.allocatedBytes=0}addStats(){const e=this._device.statsManager.getStats("Resource Counts"),i=this[Symbol.toStringTag];e.get("Resources Created").incrementCount(),e.get(`${i}s Created`).incrementCount(),e.get(`${i}s Active`).incrementCount()}},L(xy,"defaultProps",{id:"undefined",handle:void 0,userData:void 0}),xy);function lI(t,e){const i={...e};for(const r in t)t[r]!==void 0&&(i[r]=t[r]);return i}const Or=class Or extends ui{constructor(i,r){const o={...r};(r.usage||0)&Or.INDEX&&!r.indexType&&(r.data instanceof Uint32Array?o.indexType="uint32":r.data instanceof Uint16Array&&(o.indexType="uint16"));super(i,o,Or.defaultProps);L(this,"usage");L(this,"indexType");L(this,"updateTimestamp");L(this,"debugData",new ArrayBuffer(0));this.usage=r.usage||0,this.indexType=o.indexType,this.updateTimestamp=i.incrementTimestamp()}get[Symbol.toStringTag](){return"Buffer"}readSyncWebGL(i,r){throw new Error("not implemented")}_setDebugData(i,r,o){const u=ArrayBuffer.isView(i)?i.buffer:i,d=Math.min(i?i.byteLength:o,Or.DEBUG_DATA_MAX_LENGTH);i===null?this.debugData=new ArrayBuffer(d):r===0&&o===i.byteLength?this.debugData=u.slice(0,d):this.debugData=u.slice(r,r+d)}};L(Or,"defaultProps",{...ui.defaultProps,usage:0,byteLength:0,byteOffset:0,data:null,indexType:"uint16",mappedAtCreation:!1}),L(Or,"MAP_READ",1),L(Or,"MAP_WRITE",2),L(Or,"COPY_SRC",4),L(Or,"COPY_DST",8),L(Or,"INDEX",16),L(Or,"VERTEX",32),L(Or,"UNIFORM",64),L(Or,"STORAGE",128),L(Or,"INDIRECT",256),L(Or,"QUERY_RESOLVE",512),L(Or,"DEBUG_DATA_MAX_LENGTH",32);let Fi=Or;function Vb(t){const e=jb[t],i=cI(e),r=t.includes("norm"),o=!r&&!t.startsWith("float"),u=t.startsWith("s");return{dataType:jb[t],byteLength:i,integer:o,signed:u,normalized:r}}function cI(t){return hI[t]}const jb={uint8:"uint8",sint8:"sint8",unorm8:"uint8",snorm8:"sint8",uint16:"uint16",sint16:"sint16",unorm16:"uint16",snorm16:"sint16",float16:"float16",float32:"float32",uint32:"uint32",sint32:"sint32"},hI={uint8:1,sint8:1,uint16:2,sint16:2,float16:2,float32:4,uint32:4,sint32:4},uI=["bc1","bc2","bc3","bc4","bc5","bc6","bc7","etc1","etc2","eac","atc","astc","pvrtc"],dI=/^(rg?b?a?)([0-9]*)([a-z]*)(-srgb)?(-webgl|-unsized)?$/;function fI(t){return uI.some(e=>t.startsWith(e))}function Hb(t){const e=dI.exec(t);if(e){const[,i,r,o,u,d]=e;if(i){const a=`${o}${r}`,x=Vb(a);return{format:i,components:i.length,srgb:u==="-srgb",unsized:d==="-unsized",webgl:d==="-webgl",...x}}}return _I(t)}const pI={"rgba4unorm-webgl":{format:"rgba",bpp:2},"rgb565unorm-webgl":{format:"rgb",bpp:2},"rgb5a1unorm-webgl":{format:"rgba",bbp:2},rgb9e5ufloat:{format:"rgb",bbp:4},rg11b10ufloat:{format:"rgb",bbp:4},rgb10a2unorm:{format:"rgba",bbp:4},"rgb10a2uint-webgl":{format:"rgba",bbp:4},stencil8:{components:1,bpp:1,a:"stencil"},depth16unorm:{components:1,bpp:2,a:"depth"},depth24plus:{components:1,bpp:3,a:"depth"},depth32float:{components:1,bpp:4,a:"depth"},"depth24plus-stencil8":{components:2,bpp:4,a:"depth-stencil"},"depth24unorm-stencil8":{components:2,bpp:4,a:"depth-stencil"},"depth32float-stencil8":{components:2,bpp:4,a:"depth-stencil"}};function _I(t){var i;const e=pI[t];if(!e)throw new Error(`Unknown format ${t}`);return{format:e.format||"",components:e.components||((i=e.format)==null?void 0:i.length)||1,byteLength:e.bpp||1,srgb:!1,unsized:!1}}class gI{}class mI{constructor(e=[],i){L(this,"features");L(this,"disabledFeatures");this.features=new Set(e),this.disabledFeatures=i||{}}*[Symbol.iterator](){yield*this.features}has(e){return!this.disabledFeatures[e]&&this.features.has(e)}}const yu=class yu{constructor(e){L(this,"id");L(this,"props");L(this,"userData",{});L(this,"statsManager",X_);L(this,"_lumaData",{});L(this,"timestamp",0);this.props={...yu.defaultProps,...e},this.id=this.props.id||Wo(this[Symbol.toStringTag].toLowerCase())}get[Symbol.toStringTag](){return"Device"}isTextureFormatCompressed(e){return fI(e)}loseDevice(){return!1}getCanvasContext(){if(!this.canvasContext)throw new Error("Device has no CanvasContext");return this.canvasContext}createTexture(e){return(e instanceof Promise||typeof e=="string")&&(e={data:e}),this._createTexture(e)}createCommandEncoder(e={}){throw new Error("not implemented")}readPixelsToArrayWebGL(e,i){throw new Error("not implemented")}readPixelsToBufferWebGL(e,i){throw new Error("not implemented")}setParametersWebGL(e){throw new Error("not implemented")}getParametersWebGL(e){throw new Error("not implemented")}withParametersWebGL(e,i){throw new Error("not implemented")}clearWebGL(e){throw new Error("not implemented")}resetWebGL(){throw new Error("not implemented")}incrementTimestamp(){return this.timestamp++}onError(e){this.props.onError(e)}_getBufferProps(e){(e instanceof ArrayBuffer||ArrayBuffer.isView(e))&&(e={data:e});const i={...e};return(e.usage||0)&Fi.INDEX&&!e.indexType&&(e.data instanceof Uint32Array?i.indexType="uint32":e.data instanceof Uint16Array?i.indexType="uint16":Je.warn("indices buffer content must be of integer type")()),i}};L(yu,"defaultProps",{id:null,canvas:null,container:null,manageState:!0,width:800,height:600,requestMaxLimits:!0,debug:!!Je.get("debug"),spector:!!(Je.get("spector")||Je.get("spectorjs")),break:[],initalizeFeatures:!0,disabledFeatures:{"compilation-status-async-webgl":!0},gl:null,onError:e=>Je.error(e.message)}),L(yu,"VERSION",oI);let Xl=yu;function ti(t,e){if(!t)throw new Error(e||"luma.gl: assertion failed.")}const Oh=new Map,Ic=class Ic{static registerDevices(e){for(const i of e)ti(i.type&&i.isSupported&&i.create),Oh.set(i.type,i)}static getAvailableDevices(){return Array.from(Oh).map(e=>e.type)}static getSupportedDevices(){return Array.from(Oh).filter(e=>e.isSupported()).map(e=>e.type)}static setDefaultDeviceProps(e){Object.assign(Xl.defaultProps,e)}static async attachDevice(e){const i=Gb(e.devices)||Oh;if(e.handle instanceof WebGL2RenderingContext){const r=i.get("webgl");if(r)return await r.attach(e.handle)}if(e.handle===null){const r=i.get("unknown");if(r)return await r.attach(null)}throw new Error("Failed to attach device. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.")}static async createDevice(e={}){var u,d;e={...Ic.defaultProps,...e},e.gl&&(e.type="webgl");const i=Gb(e.devices)||Oh;let r,o;switch(e.type){case"webgpu":if(r=i.get("webgpu"),r)return await r.create(e);break;case"webgl":if(o=i.get("webgl"),o)return await o.create(e);break;case"unknown":const a=i.get("unknown");if(a)return await a.create(e);break;case"best-available":if(r=i.get("webgpu"),(u=r==null?void 0:r.isSupported)!=null&&u.call(r))return await r.create(e);if(o=i.get("webgl"),(d=o==null?void 0:o.isSupported)!=null&&d.call(o))return await o.create(e);break}throw new Error("No matching device found. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.")}static enforceWebGL2(e=!0){const i=HTMLCanvasElement.prototype;if(!e&&i.originalGetContext){i.getContext=i.originalGetContext,i.originalGetContext=void 0;return}i.originalGetContext=i.getContext,i.getContext=function(r,o){return r==="webgl"||r==="experimental-webgl"?this.originalGetContext("webgl2",o):this.originalGetContext(r,o)}}};L(Ic,"defaultProps",{...Xl.defaultProps,type:"best-available",devices:void 0}),L(Ic,"stats",X_),L(Ic,"log",Je);let ql=Ic;function Gb(t){if(!t||(t==null?void 0:t.length)===0)return null;const e=new Map;for(const i of t)e.set(i.type,i);return e}const yI=Go()&&typeof document<"u",kd=()=>yI&&document.readyState==="complete",bI={canvas:null,width:800,height:600,useDevicePixels:!0,autoResize:!0,container:null,visible:!0,colorSpace:"srgb",alphaMode:"opaque"};class Z_{constructor(e){L(this,"id");L(this,"props");L(this,"canvas");L(this,"htmlCanvas");L(this,"offscreenCanvas");L(this,"type");L(this,"width",1);L(this,"height",1);L(this,"resizeObserver");L(this,"_canvasSizeInfo",{clientWidth:0,clientHeight:0,devicePixelRatio:1});if(this.props={...bI,...e},e=this.props,!Go()){this.id="node-canvas-context",this.type="node",this.width=this.props.width,this.height=this.props.height,this.canvas=null;return}if(e.canvas)typeof e.canvas=="string"?this.canvas=wI(e.canvas):this.canvas=e.canvas;else{const i=TI(e),r=xI((e==null?void 0:e.container)||null);r.insertBefore(i,r.firstChild),this.canvas=i,e!=null&&e.visible||(this.canvas.style.visibility="hidden")}this.canvas instanceof HTMLCanvasElement?(this.id=this.canvas.id,this.type="html-canvas",this.htmlCanvas=this.canvas):(this.id="offscreen-canvas",this.type="offscreen-canvas",this.offscreenCanvas=this.canvas),this.canvas instanceof HTMLCanvasElement&&e.autoResize&&(this.resizeObserver=new ResizeObserver(i=>{for(const r of i)r.target===this.canvas&&this.update()}),this.resizeObserver.observe(this.canvas))}static get isPageLoaded(){return kd()}getDevicePixelRatio(e){return typeof OffscreenCanvas<"u"&&this.canvas instanceof OffscreenCanvas||(e=e===void 0?this.props.useDevicePixels:e,!e||e<=0)?1:e===!0?typeof window<"u"&&window.devicePixelRatio||1:e}getPixelSize(){switch(this.type){case"node":return[this.width,this.height];case"offscreen-canvas":return[this.canvas.width,this.canvas.height];case"html-canvas":const e=this.getDevicePixelRatio(),i=this.canvas;return i.parentElement?[i.clientWidth*e,i.clientHeight*e]:[this.canvas.width,this.canvas.height];default:throw new Error(this.type)}}getAspect(){const[e,i]=this.getPixelSize();return e/i}cssToDeviceRatio(){try{const[e]=this.getDrawingBufferSize(),{clientWidth:i}=this._canvasSizeInfo;return i?e/i:1}catch{return 1}}cssToDevicePixels(e,i=!0){const r=this.cssToDeviceRatio(),[o,u]=this.getDrawingBufferSize();return AI(e,r,o,u,i)}setDevicePixelRatio(e,i={}){if(!this.htmlCanvas)return;let r="width"in i?i.width:this.htmlCanvas.clientWidth,o="height"in i?i.height:this.htmlCanvas.clientHeight;(!r||!o)&&(Je.log(1,"Canvas clientWidth/clientHeight is 0")(),e=1,r=this.htmlCanvas.width||1,o=this.htmlCanvas.height||1);const u=this._canvasSizeInfo;if(u.clientWidth!==r||u.clientHeight!==o||u.devicePixelRatio!==e){let d=e;const a=Math.floor(r*d),x=Math.floor(o*d);this.htmlCanvas.width=a,this.htmlCanvas.height=x;const[A,M]=this.getDrawingBufferSize();(A!==a||M!==x)&&(d=Math.min(A/r,M/o),this.htmlCanvas.width=Math.floor(r*d),this.htmlCanvas.height=Math.floor(o*d),Je.warn("Device pixel ratio clamped")()),this._canvasSizeInfo.clientWidth=r,this._canvasSizeInfo.clientHeight=o,this._canvasSizeInfo.devicePixelRatio=e}}getDrawingBufferSize(){const e=this.device.gl;if(!e)throw new Error("canvas size");return[e.drawingBufferWidth,e.drawingBufferHeight]}_setAutoCreatedCanvasId(e){var i;((i=this.htmlCanvas)==null?void 0:i.id)==="lumagl-auto-created-canvas"&&(this.htmlCanvas.id=e)}}L(Z_,"pageLoaded",vI());function vI(){return kd()||typeof window>"u"?Promise.resolve():new Promise(t=>{window.addEventListener("load",()=>t())})}function xI(t){if(typeof t=="string"){const e=document.getElementById(t);if(!e&&!kd())throw new Error(`Accessing '${t}' before page was loaded`);if(!e)throw new Error(`${t} is not an HTML element`);return e}else if(t)return t;return document.body}function wI(t){const e=document.getElementById(t);if(!e&&!kd())throw new Error(`Accessing '${t}' before page was loaded`);if(!(e instanceof HTMLCanvasElement))throw new Error("Object is not a canvas element");return e}function TI(t){const{width:e,height:i}=t,r=document.createElement("canvas");return r.id="lumagl-auto-created-canvas",r.width=e||1,r.height=i||1,r.style.width=Number.isFinite(e)?`${e}px`:"100%",r.style.height=Number.isFinite(i)?`${i}px`:"100%",r}function AI(t,e,i,r,o){const u=t,d=$b(u[0],e,i);let a=Wb(u[1],e,r,o),x=$b(u[0]+1,e,i);const A=x===i-1?x:x-1;x=Wb(u[1]+1,e,r,o);let M;return o?(x=x===0?x:x+1,M=a,a=x):M=x===r-1?x:x-1,{x:d,y:a,width:Math.max(A-d+1,1),height:Math.max(M-a+1,1)}}function $b(t,e,i){return Math.min(Math.round(t*e),i-1)}function Wb(t,e,i,r){return r?Math.max(0,i-1-Math.round(t*e)):Math.min(Math.round(t*e),i-1)}const Ao=class Ao extends ui{constructor(i,r,o=Ao.defaultProps){super(i,r,o);L(this,"dimension");L(this,"format");L(this,"width");L(this,"height");L(this,"depth");L(this,"updateTimestamp");this.dimension=this.props.dimension,this.format=this.props.format,this.width=this.props.width,this.height=this.props.height,this.depth=this.props.depth,this.updateTimestamp=i.incrementTimestamp()}get[Symbol.toStringTag](){return"Texture"}};L(Ao,"defaultProps",{...ui.defaultProps,data:null,dimension:"2d",format:"rgba8unorm",width:void 0,height:void 0,depth:1,mipmaps:!0,compressed:!1,usage:0,mipLevels:void 0,samples:void 0,type:void 0,sampler:{},view:void 0}),L(Ao,"COPY_SRC",1),L(Ao,"COPY_DST",2),L(Ao,"TEXTURE_BINDING",4),L(Ao,"STORAGE_BINDING",8),L(Ao,"RENDER_ATTACHMENT",16);let As=Ao;const Yf=class Yf extends ui{get[Symbol.toStringTag](){return"TextureView"}constructor(e,i){super(e,i,Yf.defaultProps)}};L(Yf,"defaultProps",{...ui.defaultProps,format:void 0,dimension:void 0,aspect:"all",baseMipLevel:0,mipLevelCount:void 0,baseArrayLayer:0,arrayLayerCount:void 0});let Nd=Yf;function EI(t,e,i){let r="";const o=e.split(/\r?\n/),u=t.slice().sort((d,a)=>d.lineNum-a.lineNum);switch((i==null?void 0:i.showSourceCode)||"no"){case"all":let d=0;for(let a=1;a<=o.length;a++)for(r+=qb(o[a-1],a,i);u.length>d&&u[d].lineNum===a;){const x=u[d++];r+=Xb(x,o,x.lineNum,{...i,inlineSource:!1})}return r;case"issues":case"no":for(const a of t)r+=Xb(a,o,a.lineNum,{inlineSource:(i==null?void 0:i.showSourceCode)!=="no"});return r}}function Xb(t,e,i,r){if(r!=null&&r.inlineSource){const o=SI(e,i),u=t.linePos>0?`${" ".repeat(t.linePos+5)}^^^
`:"";return`
${o}${u}${t.type.toUpperCase()}: ${t.message}

`}return r!=null&&r.html?`<div class='luma-compiler-log-error' style="color:red;"><b> ${t.type.toUpperCase()}: ${t.message}</b></div>`:`${t.type.toUpperCase()}: ${t.message}`}function SI(t,e,i){let r="";for(let o=e-2;o<=e;o++){const u=t[o-1];u!==void 0&&(r+=qb(u,e,i))}return r}function qb(t,e,i){const r=i!=null&&i.html?II(t):t;return`${CI(String(e),4)}: ${r}${i!=null&&i.html?"<br/>":`
`}`}function CI(t,e){let i="";for(let r=t.length;r<e;++r)i+=" ";return i+t}function II(t){return t.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}function Zb(t,e){return{name:MI(t,e),language:"glsl",version:RI(t)}}function MI(t,e="unnamed"){const r=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/.exec(t);return r?r[1]:e}function RI(t){let e=100;const i=t.match(/[^\s]+/g);if(i&&i.length>=2&&i[0]==="#version"){const r=parseInt(i[1],10);Number.isFinite(r)&&(e=r)}return e}const Jf=class Jf extends ui{constructor(i,r){super(i,{id:PI(r),...r},Jf.defaultProps);L(this,"stage");L(this,"source");L(this,"compilationStatus","pending");this.stage=this.props.stage,this.source=this.props.source}get[Symbol.toStringTag](){return"Shader"}getCompilationInfoSync(){return null}getTranslatedSource(){return null}async debugShader(i=this.props.debug){switch(i){case"never":return;case"errors":if(this.compilationStatus==="success")return;break}const r=await this.getCompilationInfo();this.props.debug==="warnings"&&(r==null?void 0:r.length)===0||this._displayShaderLog(r)}_displayShaderLog(i){var A;if(typeof document>"u"||!(document!=null&&document.createElement))return;const r=Zb(this.source).name,o=`${this.stage} ${r}`;let u=EI(i,this.source,{showSourceCode:"all",html:!0});const d=this.getTranslatedSource();d&&(u+=`<br /><br /><h1>Translated Source</h1><br /><br /><code style="user-select:text;"><pre>${d}</pre></code>`);const a=document.createElement("Button");a.innerHTML=`
<h1>Shader Compilation Error in ${o}</h1><br /><br />
<code style="user-select:text;"><pre>
${u}
</pre></code>`,a.style.top="10px",a.style.left="10px",a.style.position="absolute",a.style.zIndex="9999",a.style.width="100%",a.style.textAlign="left",document.body.appendChild(a);const x=document.getElementsByClassName("luma-compiler-log-error");(A=x[0])!=null&&A.scrollIntoView&&x[0].scrollIntoView(),a.onclick=()=>{const M=`data:text/plain,${encodeURIComponent(this.source)}`;navigator.clipboard.writeText(M)}}};L(Jf,"defaultProps",{...ui.defaultProps,language:"auto",stage:void 0,source:"",sourceMap:null,entryPoint:"main",debug:"errors"});let Ld=Jf;function PI(t){return Zb(t.source).name||t.id||Wo(`unnamed ${t.stage}-shader`)}const Qf=class Qf extends ui{get[Symbol.toStringTag](){return"Sampler"}constructor(e,i){super(e,i,Qf.defaultProps)}};L(Qf,"defaultProps",{...ui.defaultProps,type:"color-sampler",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",addressModeW:"clamp-to-edge",magFilter:"nearest",minFilter:"nearest",mipmapFilter:"nearest",lodMinClamp:0,lodMaxClamp:32,compare:"less-equal",maxAnisotropy:1});let Ud=Qf;const ep=class ep extends ui{constructor(i,r={}){super(i,r,ep.defaultProps);L(this,"width");L(this,"height");L(this,"colorAttachments",[]);L(this,"depthStencilAttachment",null);this.width=this.props.width,this.height=this.props.height}get[Symbol.toStringTag](){return"Framebuffer"}resize(i){let r=!i;if(i){const[o,u]=Array.isArray(i)?i:[i.width,i.height];r=r||u!==this.height||o!==this.width,this.width=o,this.height=u}r&&(Je.log(2,`Resizing framebuffer ${this.id} to ${this.width}x${this.height}`)(),this.resizeAttachments(this.width,this.height))}autoCreateAttachmentTextures(){if(this.props.colorAttachments.length===0&&!this.props.depthStencilAttachment)throw new Error("Framebuffer has noattachments");this.colorAttachments=this.props.colorAttachments.map(r=>{if(typeof r=="string"){const o=this.createColorTexture(r);return this.attachResource(o),o.view}return r instanceof As?r.view:r});const i=this.props.depthStencilAttachment;if(i)if(typeof i=="string"){const r=this.createDepthStencilTexture(i);this.attachResource(r),this.depthStencilAttachment=r.view}else i instanceof As?this.depthStencilAttachment=i.view:this.depthStencilAttachment=i}createColorTexture(i){return this.device.createTexture({id:"color-attachment",usage:As.RENDER_ATTACHMENT,format:i,width:this.width,height:this.height})}createDepthStencilTexture(i){return this.device.createTexture({id:"depth-stencil-attachment",usage:As.RENDER_ATTACHMENT,format:i,width:this.width,height:this.height})}resizeAttachments(i,r){for(let o=0;o<this.colorAttachments.length;++o)if(this.colorAttachments[o]){const u=this.device._createTexture({...this.colorAttachments[o].props,width:i,height:r});this.destroyAttachedResource(this.colorAttachments[o]),this.colorAttachments[o]=u.view,this.attachResource(u.view)}if(this.depthStencilAttachment){const o=this.device._createTexture({...this.depthStencilAttachment.props,width:i,height:r});this.destroyAttachedResource(this.depthStencilAttachment),this.depthStencilAttachment=o.view,this.attachResource(o)}}};L(ep,"defaultProps",{...ui.defaultProps,width:1,height:1,colorAttachments:[],depthStencilAttachment:null});let zd=ep;const tp=class tp extends ui{constructor(i,r){super(i,r,tp.defaultProps);L(this,"shaderLayout");L(this,"bufferLayout");L(this,"linkStatus","pending");L(this,"hash","");this.shaderLayout=this.props.shaderLayout,this.bufferLayout=this.props.bufferLayout||[]}get[Symbol.toStringTag](){return"RenderPipeline"}setUniformsWebGL(i){throw new Error("Use uniform blocks")}};L(tp,"defaultProps",{...ui.defaultProps,vs:null,vertexEntryPoint:"vertexMain",vsConstants:{},fs:null,fragmentEntryPoint:"fragmentMain",fsConstants:{},shaderLayout:null,bufferLayout:[],topology:"triangle-list",parameters:{},bindings:{},uniforms:{}});let Zl=tp;const ip=class ip extends ui{get[Symbol.toStringTag](){return"RenderPass"}constructor(e,i){super(e,i,ip.defaultProps)}};L(ip,"defaultProps",{...ui.defaultProps,framebuffer:null,parameters:void 0,clearColor:[0,0,0,0],clearDepth:1,clearStencil:0,depthReadOnly:!1,stencilReadOnly:!1,discard:!1,occlusionQuerySet:void 0,timestampQuerySet:void 0,beginTimestampIndex:void 0,endTimestampIndex:void 0});let K_=ip;const rp=class rp extends ui{constructor(i,r){super(i,r,rp.defaultProps);L(this,"hash","")}get[Symbol.toStringTag](){return"ComputePipeline"}};L(rp,"defaultProps",{...ui.defaultProps,shader:void 0,entryPoint:void 0,constants:{},shaderLayout:void 0});let Vd=rp;const sp=class sp extends ui{get[Symbol.toStringTag](){return"CommandEncoder"}constructor(e,i){super(e,i,sp.defaultProps)}};L(sp,"defaultProps",{...ui.defaultProps,measureExecutionTime:void 0});let Y_=sp;const np=class np extends ui{get[Symbol.toStringTag](){return"CommandBuffer"}constructor(e,i){super(e,i,np.defaultProps)}};L(np,"defaultProps",{...ui.defaultProps});let J_=np;function BI(t){const[e,i]=OI[t],r=e==="i32"||e==="u32",o=e!=="u32",u=FI[e]*i,d=DI(e,i);return{dataType:e,components:i,defaultVertexFormat:d,byteLength:u,integer:r,signed:o}}function DI(t,e){let i;switch(t){case"f32":i="float32";break;case"i32":i="sint32";break;case"u32":i="uint32";break;case"f16":return e<=2?"float16x2":"float16x4"}return e===1?i:`${i}x${e}`}const OI={f32:["f32",1],"vec2<f32>":["f32",2],"vec3<f32>":["f32",3],"vec4<f32>":["f32",4],f16:["f16",1],"vec2<f16>":["f16",2],"vec3<f16>":["f16",3],"vec4<f16>":["f16",4],i32:["i32",1],"vec2<i32>":["i32",2],"vec3<i32>":["i32",3],"vec4<i32>":["i32",4],u32:["u32",1],"vec2<u32>":["u32",2],"vec3<u32>":["u32",3],"vec4<u32>":["u32",4]},FI={f32:4,f16:2,i32:4,u32:4};function Kb(t){let e;t.endsWith("-webgl")&&(t.replace("-webgl",""),e=!0);const[i,r]=t.split("x"),o=i,u=r?parseInt(r):1,d=Vb(o),a={type:o,components:u,byteLength:d.byteLength*u,integer:d.integer,signed:d.signed,normalized:d.normalized};return e&&(a.webglOnly=!0),a}function Yb(t,e){const i={};for(const r of t.attributes)i[r.name]=NI(t,e,r.name);return i}function kI(t,e,i=16){const r=Yb(t,e),o=new Array(i).fill(null);for(const u of Object.values(r))o[u.location]=u;return o}function NI(t,e,i){const r=LI(t,i),o=UI(e,i);if(!r)return null;const u=BI(r.type),d=(o==null?void 0:o.vertexFormat)||u.defaultVertexFormat,a=Kb(d);return{attributeName:(o==null?void 0:o.attributeName)||r.name,bufferName:(o==null?void 0:o.bufferName)||r.name,location:r.location,shaderType:r.type,shaderDataType:u.dataType,shaderComponents:u.components,vertexFormat:d,bufferDataType:a.type,bufferComponents:a.components,normalized:a.normalized,integer:u.integer,stepMode:(o==null?void 0:o.stepMode)||r.stepMode,byteOffset:(o==null?void 0:o.byteOffset)||0,byteStride:(o==null?void 0:o.byteStride)||0}}function LI(t,e){const i=t.attributes.find(r=>r.name===e);return i||Je.warn(`shader layout attribute "${e}" not present in shader`),i||null}function UI(t,e){zI(t);let i=VI(t,e);return i||(i=jI(t,e),i)?i:(Je.warn(`layout for attribute "${e}" not present in buffer layout`),null)}function zI(t){for(const e of t)(e.attributes&&e.format||!e.attributes&&!e.format)&&Je.warn(`BufferLayout ${name} must have either 'attributes' or 'format' field`)}function VI(t,e){for(const i of t)if(i.format&&i.name===e)return{attributeName:i.name,bufferName:e,stepMode:i.stepMode,vertexFormat:i.format,byteOffset:0,byteStride:i.byteStride||0};return null}function jI(t,e){var i;for(const r of t){let o=r.byteStride;if(typeof r.byteStride!="number")for(const d of r.attributes||[]){const a=Kb(d.format);o+=a.byteLength}const u=(i=r.attributes)==null?void 0:i.find(d=>d.attribute===e);if(u)return{attributeName:u.attribute,bufferName:r.name,stepMode:r.stepMode,vertexFormat:u.format,byteOffset:u.byteOffset,byteStride:o}}return null}function HI(t,e){const i={...t,attributes:t.attributes.map(r=>({...r}))};for(const r of(e==null?void 0:e.attributes)||[]){const o=i.attributes.find(u=>u.name===r.name);o?(o.type=r.type||o.type,o.stepMode=r.stepMode||o.stepMode):Je.warn(`shader layout attribute ${r.name} not present in shader`)}return i}const op=class op extends ui{constructor(i,r){super(i,r,op.defaultProps);L(this,"maxVertexAttributes");L(this,"attributeInfos");L(this,"indexBuffer",null);L(this,"attributes");this.maxVertexAttributes=i.limits.maxVertexAttributes,this.attributes=new Array(this.maxVertexAttributes).fill(null),this.attributeInfos=kI(r.renderPipeline.shaderLayout,r.renderPipeline.bufferLayout,this.maxVertexAttributes)}get[Symbol.toStringTag](){return"VertexArray"}setConstantWebGL(i,r){throw new Error("constant attributes not supported")}};L(op,"defaultProps",{...ui.defaultProps,renderPipeline:null});let Q_=op;const ap=class ap extends ui{get[Symbol.toStringTag](){return"TransformFeedback"}constructor(e,i){super(e,i,ap.defaultProps)}};L(ap,"defaultProps",{...ui.defaultProps,layout:void 0,buffers:{}});let eg=ap;const lp=class lp extends ui{get[Symbol.toStringTag](){return"QuerySet"}constructor(e,i){super(e,i,lp.defaultProps)}};L(lp,"defaultProps",{...ui.defaultProps,type:void 0,count:void 0});let tg=lp;const GI={f32:{type:"f32",components:1},i32:{type:"i32",components:1},u32:{type:"u32",components:1},"vec2<f32>":{type:"f32",components:2},"vec3<f32>":{type:"f32",components:3},"vec4<f32>":{type:"f32",components:4},"vec2<i32>":{type:"i32",components:2},"vec3<i32>":{type:"i32",components:3},"vec4<i32>":{type:"i32",components:4},"vec2<u32>":{type:"u32",components:2},"vec3<u32>":{type:"u32",components:3},"vec4<u32>":{type:"u32",components:4},"mat2x2<f32>":{type:"f32",components:4},"mat2x3<f32>":{type:"f32",components:6},"mat2x4<f32>":{type:"f32",components:8},"mat3x2<f32>":{type:"f32",components:6},"mat3x3<f32>":{type:"f32",components:9},"mat3x4<f32>":{type:"f32",components:12},"mat4x2<f32>":{type:"f32",components:8},"mat4x3<f32>":{type:"f32",components:12},"mat4x4<f32>":{type:"f32",components:16}};function $I(t){const e=GI[t];return ti(t),e}function WI(t,e){switch(e){case 1:return t;case 2:return t+t%2;default:return t+(4-t%4)%4}}let jd;function Jb(t){return(!jd||jd.byteLength<t)&&(jd=new ArrayBuffer(t)),jd}function XI(t,e){const i=Jb(t.BYTES_PER_ELEMENT*e);return new t(i,0,e)}function qI(t){const{target:e,source:i,start:r=0,count:o=1}=t,u=i.length,d=o*u;let a=0;for(let x=r;a<u;a++)e[x++]=i[a];for(;a<d;)a<d-a?(e.copyWithin(r+a,r,r+a),a*=2):(e.copyWithin(r+a,r,r+d-a),a=d);return t.target}const Qb=1024;class ZI{constructor(e){L(this,"layout",{});L(this,"byteLength");let i=0;for(const[o,u]of Object.entries(e)){const d=$I(u),{type:a,components:x}=d;i=WI(i,x);const A=i;i+=x,this.layout[o]={type:a,size:x,offset:A}}i+=(4-i%4)%4;const r=i*4;this.byteLength=Math.max(r,Qb)}getData(e){const i=Math.max(this.byteLength,Qb),r=Jb(i),o={i32:new Int32Array(r),u32:new Uint32Array(r),f32:new Float32Array(r),f16:new Uint16Array(r)};for(const[u,d]of Object.entries(e)){const a=this.layout[u];if(!a){Je.warn(`Supplied uniform value ${u} not present in uniform block layout`)();continue}const{type:x,size:A,offset:M}=a,D=o[x];if(A===1){if(typeof d!="number"&&typeof d!="boolean"){Je.warn(`Supplied value for single component uniform ${u} is not a number: ${d}`)();continue}D[M]=Number(d)}else{const N=Dh(d);if(!N){Je.warn(`Supplied value for multi component / array uniform ${u} is not a numeric array: ${d}`)();continue}D.set(N,M)}}return new Uint8Array(r)}has(e){return!!this.layout[e]}get(e){return this.layout[e]}}function KI(t,e,i=16){if(t!==e)return!1;const r=Dh(t);if(!r)return!1;const o=Dh(e);if(o&&r.length===o.length){for(let u=0;u<r.length;++u)if(o[u]!==r[u])return!1}return!0}function YI(t){const e=Dh(t);return e?e.slice():t}class JI{constructor(e){L(this,"name");L(this,"uniforms",{});L(this,"modifiedUniforms",{});L(this,"modified",!0);L(this,"bindingLayout",{});L(this,"needsRedraw","initialized");var i;if(this.name=e==null?void 0:e.name,e!=null&&e.name&&(e!=null&&e.shaderLayout)){const r=(i=e==null?void 0:e.shaderLayout.bindings)==null?void 0:i.find(u=>u.type==="uniform"&&u.name===(e==null?void 0:e.name));if(!r)throw new Error(e==null?void 0:e.name);const o=r;for(const u of o.uniforms||[])this.bindingLayout[u.name]=u}}setUniforms(e){for(const[i,r]of Object.entries(e))this._setUniform(i,r),this.needsRedraw||this.setNeedsRedraw(`${this.name}.${i}=${r}`)}setNeedsRedraw(e){this.needsRedraw=this.needsRedraw||e}getAllUniforms(){return this.modifiedUniforms={},this.needsRedraw=!1,this.uniforms||{}}_setUniform(e,i){KI(this.uniforms[e],i)||(this.uniforms[e]=YI(i),this.modifiedUniforms[e]=!0,this.modified=!0)}}class QI{constructor(e){L(this,"uniformBlocks",new Map);L(this,"uniformBufferLayouts",new Map);L(this,"uniformBuffers",new Map);for(const[i,r]of Object.entries(e)){const o=i,u=new ZI(r.uniformTypes||{});this.uniformBufferLayouts.set(o,u);const d=new JI({name:i});d.setUniforms(r.defaultUniforms||{}),this.uniformBlocks.set(o,d)}}destroy(){for(const e of this.uniformBuffers.values())e.destroy()}setUniforms(e){for(const[i,r]of Object.entries(e))this.uniformBlocks.get(i).setUniforms(r);this.updateUniformBuffers()}getUniformBufferByteLength(e){return this.uniformBufferLayouts.get(e).byteLength}getUniformBufferData(e){const i=this.uniformBlocks.get(e).getAllUniforms();return this.uniformBufferLayouts.get(e).getData(i)}createUniformBuffer(e,i,r){r&&this.setUniforms(r);const o=this.getUniformBufferByteLength(i),u=e.createBuffer({usage:Fi.UNIFORM|Fi.COPY_DST,byteLength:o}),d=this.getUniformBufferData(i);return u.write(d),u}getManagedUniformBuffer(e,i){if(!this.uniformBuffers.get(i)){const r=this.getUniformBufferByteLength(i),o=e.createBuffer({usage:Fi.UNIFORM|Fi.COPY_DST,byteLength:r});this.uniformBuffers.set(i,o)}return this.uniformBuffers.get(i)}updateUniformBuffers(){let e=!1;for(const i of this.uniformBlocks.keys()){const r=this.updateUniformBuffer(i);e||(e=r)}return e&&Je.log(3,`UniformStore.updateUniformBuffers(): ${e}`)(),e}updateUniformBuffer(e){const i=this.uniformBlocks.get(e),r=this.uniformBuffers.get(e);let o=!1;if(r&&i.needsRedraw){o||(o=i.needsRedraw);const u=this.getUniformBufferData(e);this.uniformBuffers.get(e).write(u);const a=this.uniformBlocks.get(e).getAllUniforms();Je.log(4,`Writing to uniform buffer ${String(e)}`,u,a)()}return o}}function ev(t){const e=ArrayBuffer.isView(t)?t.constructor:t;switch(e){case Float32Array:return"float32";case Uint16Array:return"uint16";case Uint32Array:return"uint32";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int8Array:return"sint8";case Int16Array:return"sint16";case Int32Array:return"sint32";default:throw new Error(e.constructor.name)}}function tv(t){switch(t){case"float32":return Float32Array;case"uint32":return Uint32Array;case"sint32":return Int32Array;case"uint16":case"unorm16":return Uint16Array;case"sint16":case"snorm16":return Int16Array;case"uint8":case"unorm8":return Uint8Array;case"sint8":case"snorm8":return Int8Array;default:throw new Error(t)}}function eM(t,e,i){if(!e||e>4)throw new Error(`size ${e}`);const r=e;let o=ev(t);if(o==="uint8"&&i&&r===1)return"unorm8-webgl";if(o==="uint8"&&i&&r===3)return"unorm8x3-webgl";if(o==="uint8"||o==="sint8"){if(r===1||r===3)throw new Error(`size: ${e}`);return i&&(o=o.replace("int","norm")),`${o}x${r}`}if(o==="uint16"||o==="sint16"){if(r===1||r===3)throw new Error(`size: ${e}`);return i&&(o=o.replace("int","norm")),`${o}x${r}`}return r===1?o:`${o}x${r}`}function zV(t){return t}function tM(t){return Dh(t)!==null||typeof t=="number"||typeof t=="boolean"}function ig(t){const e={bindings:{},uniforms:{}};return Object.keys(t).forEach(i=>{const r=t[i];tM(r)?e.uniforms[i]=r:e.bindings[i]=r}),e}function iM(t,e,i){const{removedProps:r={},deprecatedProps:o={},replacedProps:u={}}=i;for(const a in r)if(a in e){const A=r[a]?`${t}.${r[a]}`:"N/A";Je.removed(`${t}.${a}`,A)()}for(const a in o)if(a in e){const x=o[a];Je.deprecated(`${t}.${a}`,`${t}.${x}`)()}let d=null;for(const[a,x]of Object.entries(u))a in e&&(Je.deprecated(`${t}.${a}`,`${t}.${x}`)(),d=d||Object.assign({},e),d[x]=e[a],delete d[a]);return d||e}let rM="";async function sM(t,e){return await new Promise((i,r)=>{try{const o=new Image;o.onload=()=>i(o),o.onerror=()=>r(new Error(`Could not load image ${t}.`)),o.crossOrigin=(e==null?void 0:e.crossOrigin)||"anonymous",o.src=t.startsWith("http")?t:rM+t}catch(o){r(o)}})}async function iv(t,e){const i=document.getElementsByTagName("head")[0];if(!i)throw new Error("loadScript");const r=document.createElement("script");return r.setAttribute("type","text/javascript"),r.setAttribute("src",t),new Promise((o,u)=>{r.onload=o,r.onerror=d=>u(new Error(`Unable to load script '${t}': ${d}`)),i.appendChild(r)})}function rg(t,e,i){if(t===e)return!0;if(!i||!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(!rg(t[r],e[r],i-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const r=Object.keys(t),o=Object.keys(e);if(r.length!==o.length)return!1;for(const u of r)if(!e.hasOwnProperty(u)||!rg(t[u],e[u],i-1))return!1;return!0}return!1}function nM(t){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(t):setTimeout(t,1e3/60)}function oM(t){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(t):clearTimeout(t)}class aM{constructor(){this.constants=new Map,this.aliases=new Map,this.structs=new Map}}class go{constructor(){}get isAstNode(){return!0}get astNodeType(){return""}evaluate(e){throw new Error("Cannot evaluate node")}evaluateString(e){return this.evaluate(e).toString()}search(e){}searchBlock(e,i){if(e){i(Hd.instance);for(const r of e)r instanceof Array?this.searchBlock(r,i):r.search(i);i(Gd.instance)}}}class Hd extends go{}Hd.instance=new Hd;class Gd extends go{}Gd.instance=new Gd;class Ri extends go{constructor(){super()}}class sg extends Ri{constructor(e,i,r,o,u,d){super(),this.calls=new Set,this.name=e,this.args=i,this.returnType=r,this.body=o,this.startLine=u,this.endLine=d}get astNodeType(){return"function"}search(e){this.searchBlock(this.body,e)}}class lM extends Ri{constructor(e){super(),this.expression=e}get astNodeType(){return"staticAssert"}search(e){this.expression.search(e)}}class cM extends Ri{constructor(e,i){super(),this.condition=e,this.body=i}get astNodeType(){return"while"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class hM extends Ri{constructor(e){super(),this.body=e}get astNodeType(){return"continuing"}search(e){this.searchBlock(this.body,e)}}class uM extends Ri{constructor(e,i,r,o){super(),this.init=e,this.condition=i,this.increment=r,this.body=o}get astNodeType(){return"for"}search(e){var i,r,o;(i=this.init)===null||i===void 0||i.search(e),(r=this.condition)===null||r===void 0||r.search(e),(o=this.increment)===null||o===void 0||o.search(e),this.searchBlock(this.body,e)}}class za extends Ri{constructor(e,i,r,o,u){super(),this.name=e,this.type=i,this.storage=r,this.access=o,this.value=u}get astNodeType(){return"var"}search(e){var i;e(this),(i=this.value)===null||i===void 0||i.search(e)}}class rv extends Ri{constructor(e,i,r){super(),this.name=e,this.type=i,this.value=r}get astNodeType(){return"override"}search(e){var i;(i=this.value)===null||i===void 0||i.search(e)}}class ng extends Ri{constructor(e,i,r,o,u){super(),this.name=e,this.type=i,this.storage=r,this.access=o,this.value=u}get astNodeType(){return"let"}search(e){var i;e(this),(i=this.value)===null||i===void 0||i.search(e)}}class sv extends Ri{constructor(e,i,r,o,u){super(),this.name=e,this.type=i,this.storage=r,this.access=o,this.value=u}get astNodeType(){return"const"}evaluate(e){return this.value.evaluate(e)}search(e){var i;e(this),(i=this.value)===null||i===void 0||i.search(e)}}var Kl;(function(t){t.increment="++",t.decrement="--"})(Kl||(Kl={})),function(t){function e(i){const r=i;if(r=="parse")throw new Error("Invalid value for IncrementOperator");return t[r]}t.parse=e}(Kl||(Kl={}));class dM extends Ri{constructor(e,i){super(),this.operator=e,this.variable=i}get astNodeType(){return"increment"}search(e){this.variable.search(e)}}var Fh;(function(t){t.assign="=",t.addAssign="+=",t.subtractAssin="-=",t.multiplyAssign="*=",t.divideAssign="/=",t.moduloAssign="%=",t.andAssign="&=",t.orAssign="|=",t.xorAssign="^=",t.shiftLeftAssign="<<=",t.shiftRightAssign=">>="})(Fh||(Fh={})),function(t){function e(i){const r=i;if(r=="parse")throw new Error("Invalid value for AssignOperator");return r}t.parse=e}(Fh||(Fh={}));class fM extends Ri{constructor(e,i,r){super(),this.operator=e,this.variable=i,this.value=r}get astNodeType(){return"assign"}search(e){this.variable.search(e),this.value.search(e)}}class nv extends Ri{constructor(e,i){super(),this.name=e,this.args=i}get astNodeType(){return"call"}search(e){for(const i of this.args)i.search(e);e(this)}}class pM extends Ri{constructor(e,i){super(),this.body=e,this.continuing=i}get astNodeType(){return"loop"}}class _M extends Ri{constructor(e,i){super(),this.condition=e,this.body=i}get astNodeType(){return"body"}}class gM extends Ri{constructor(e,i,r,o){super(),this.condition=e,this.body=i,this.elseif=r,this.else=o}get astNodeType(){return"if"}search(e){this.condition.search(e),this.searchBlock(this.body,e),this.searchBlock(this.elseif,e),this.searchBlock(this.else,e)}}class mM extends Ri{constructor(e){super(),this.value=e}get astNodeType(){return"return"}search(e){var i;(i=this.value)===null||i===void 0||i.search(e)}}class yM extends Ri{constructor(e){super(),this.name=e}get astNodeType(){return"enable"}}class bM extends Ri{constructor(e){super(),this.extensions=e}get astNodeType(){return"requires"}}class vM extends Ri{constructor(e,i){super(),this.severity=e,this.rule=i}get astNodeType(){return"diagnostic"}}class ov extends Ri{constructor(e,i){super(),this.name=e,this.type=i}get astNodeType(){return"alias"}}class xM extends Ri{constructor(){super()}get astNodeType(){return"discard"}}class wM extends Ri{constructor(){super()}get astNodeType(){return"break"}}class TM extends Ri{constructor(){super()}get astNodeType(){return"continue"}}class Va extends Ri{constructor(e){super(),this.name=e}get astNodeType(){return"type"}get isStruct(){return!1}get isArray(){return!1}}class ja extends Va{constructor(e,i,r,o){super(e),this.members=i,this.startLine=r,this.endLine=o}get astNodeType(){return"struct"}get isStruct(){return!0}getMemberIndex(e){for(let i=0;i<this.members.length;i++)if(this.members[i].name==e)return i;return-1}}class av extends Va{constructor(e,i,r){super(e),this.format=i,this.access=r}get astNodeType(){return"template"}}class AM extends Va{constructor(e,i,r,o){super(e),this.storage=i,this.type=r,this.access=o}get astNodeType(){return"pointer"}}class lv extends Va{constructor(e,i,r,o){super(e),this.attributes=i,this.format=r,this.count=o}get astNodeType(){return"array"}get isArray(){return!0}}class kh extends Va{constructor(e,i,r){super(e),this.format=i,this.access=r}get astNodeType(){return"sampler"}}class Vn extends go{constructor(){super()}}class EM extends Vn{constructor(e){super(),this.value=e}get astNodeType(){return"stringExpr"}toString(){return this.value}evaluateString(){return this.value}}class Yl extends Vn{constructor(e,i){super(),this.type=e,this.args=i}get astNodeType(){return"createExpr"}search(e){if(e(this),this.args)for(const i of this.args)i.search(e)}evaluate(e){return this.args[0].evaluate(e)}}class cv extends Vn{constructor(e,i){super(),this.name=e,this.args=i}get astNodeType(){return"callExpr"}evaluate(e){switch(this.name){case"abs":return Math.abs(this.args[0].evaluate(e));case"acos":return Math.acos(this.args[0].evaluate(e));case"acosh":return Math.acosh(this.args[0].evaluate(e));case"asin":return Math.asin(this.args[0].evaluate(e));case"asinh":return Math.asinh(this.args[0].evaluate(e));case"atan":return Math.atan(this.args[0].evaluate(e));case"atan2":return Math.atan2(this.args[0].evaluate(e),this.args[1].evaluate(e));case"atanh":return Math.atanh(this.args[0].evaluate(e));case"ceil":return Math.ceil(this.args[0].evaluate(e));case"clamp":return Math.min(Math.max(this.args[0].evaluate(e),this.args[1].evaluate(e)),this.args[2].evaluate(e));case"cos":return Math.cos(this.args[0].evaluate(e));case"degrees":return this.args[0].evaluate(e)*180/Math.PI;case"distance":return Math.sqrt(Math.pow(this.args[0].evaluate(e)-this.args[1].evaluate(e),2));case"dot":case"exp":return Math.exp(this.args[0].evaluate(e));case"exp2":return Math.pow(2,this.args[0].evaluate(e));case"floor":return Math.floor(this.args[0].evaluate(e));case"fma":return this.args[0].evaluate(e)*this.args[1].evaluate(e)+this.args[2].evaluate(e);case"fract":return this.args[0].evaluate(e)-Math.floor(this.args[0].evaluate(e));case"inverseSqrt":return 1/Math.sqrt(this.args[0].evaluate(e));case"log":return Math.log(this.args[0].evaluate(e));case"log2":return Math.log2(this.args[0].evaluate(e));case"max":return Math.max(this.args[0].evaluate(e),this.args[1].evaluate(e));case"min":return Math.min(this.args[0].evaluate(e),this.args[1].evaluate(e));case"mix":return this.args[0].evaluate(e)*(1-this.args[2].evaluate(e))+this.args[1].evaluate(e)*this.args[2].evaluate(e);case"modf":return this.args[0].evaluate(e)-Math.floor(this.args[0].evaluate(e));case"pow":return Math.pow(this.args[0].evaluate(e),this.args[1].evaluate(e));case"radians":return this.args[0].evaluate(e)*Math.PI/180;case"round":return Math.round(this.args[0].evaluate(e));case"sign":return Math.sign(this.args[0].evaluate(e));case"sin":return Math.sin(this.args[0].evaluate(e));case"sinh":return Math.sinh(this.args[0].evaluate(e));case"saturate":return Math.min(Math.max(this.args[0].evaluate(e),0),1);case"smoothstep":return this.args[0].evaluate(e)*this.args[0].evaluate(e)*(3-2*this.args[0].evaluate(e));case"sqrt":return Math.sqrt(this.args[0].evaluate(e));case"step":return this.args[0].evaluate(e)<this.args[1].evaluate(e)?0:1;case"tan":return Math.tan(this.args[0].evaluate(e));case"tanh":return Math.tanh(this.args[0].evaluate(e));case"trunc":return Math.trunc(this.args[0].evaluate(e));default:throw new Error("Non const function: "+this.name)}}search(e){for(const i of this.args)i.search(e);e(this)}}class og extends Vn{constructor(e){super(),this.name=e}get astNodeType(){return"varExpr"}search(e){e(this),this.postfix&&this.postfix.search(e)}evaluate(e){const i=e.constants.get(this.name);if(!i)throw new Error("Cannot evaluate node");return i.evaluate(e)}}class hv extends Vn{constructor(e,i){super(),this.name=e,this.initializer=i}get astNodeType(){return"constExpr"}evaluate(e){var i,r;if(this.initializer instanceof Yl){const o=(i=this.postfix)===null||i===void 0?void 0:i.evaluateString(e),u=(r=this.initializer.type)===null||r===void 0?void 0:r.name,d=e.structs.get(u),a=d==null?void 0:d.getMemberIndex(o);return a!==void 0&&a!=-1?this.initializer.args[a].evaluate(e):this.initializer.evaluate(e)}return this.initializer.evaluate(e)}search(e){this.initializer.search(e)}}class uv extends Vn{constructor(e){super(),this.value=e}get astNodeType(){return"literalExpr"}evaluate(){return this.value}}class SM extends Vn{constructor(e,i){super(),this.type=e,this.value=i}get astNodeType(){return"bitcastExpr"}search(e){this.value.search(e)}}class dv extends Vn{constructor(e){super(),this.contents=e}get astNodeType(){return"groupExpr"}evaluate(e){return this.contents[0].evaluate(e)}search(e){this.searchBlock(this.contents,e)}}class CM extends Vn{constructor(e){super(),this.index=e}search(e){this.index.search(e)}}class fv extends Vn{constructor(){super()}}class IM extends fv{constructor(e,i){super(),this.operator=e,this.right=i}get astNodeType(){return"unaryOp"}evaluate(e){switch(this.operator){case"+":return this.right.evaluate(e);case"-":return-this.right.evaluate(e);case"!":return this.right.evaluate(e)?0:1;case"~":return~this.right.evaluate(e);default:throw new Error("Unknown unary operator: "+this.operator)}}search(e){this.right.search(e)}}class jn extends fv{constructor(e,i,r){super(),this.operator=e,this.left=i,this.right=r}get astNodeType(){return"binaryOp"}evaluate(e){switch(this.operator){case"+":return this.left.evaluate(e)+this.right.evaluate(e);case"-":return this.left.evaluate(e)-this.right.evaluate(e);case"*":return this.left.evaluate(e)*this.right.evaluate(e);case"/":return this.left.evaluate(e)/this.right.evaluate(e);case"%":return this.left.evaluate(e)%this.right.evaluate(e);case"==":return this.left.evaluate(e)==this.right.evaluate(e)?1:0;case"!=":return this.left.evaluate(e)!=this.right.evaluate(e)?1:0;case"<":return this.left.evaluate(e)<this.right.evaluate(e)?1:0;case">":return this.left.evaluate(e)>this.right.evaluate(e)?1:0;case"<=":return this.left.evaluate(e)<=this.right.evaluate(e)?1:0;case">=":return this.left.evaluate(e)>=this.right.evaluate(e)?1:0;case"&&":return this.left.evaluate(e)&&this.right.evaluate(e)?1:0;case"||":return this.left.evaluate(e)||this.right.evaluate(e)?1:0;default:throw new Error(`Unknown operator ${this.operator}`)}}search(e){this.left.search(e),this.right.search(e)}}class pv extends go{constructor(){super()}}class MM extends pv{constructor(e,i){super(),this.selector=e,this.body=i}get astNodeType(){return"case"}search(e){this.searchBlock(this.body,e)}}class RM extends pv{constructor(e){super(),this.body=e}get astNodeType(){return"default"}search(e){this.searchBlock(this.body,e)}}class PM extends go{constructor(e,i,r){super(),this.name=e,this.type=i,this.attributes=r}get astNodeType(){return"argument"}}class BM extends go{constructor(e,i){super(),this.condition=e,this.body=i}get astNodeType(){return"elseif"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class DM extends go{constructor(e,i,r){super(),this.name=e,this.type=i,this.attributes=r}get astNodeType(){return"member"}}let OM=class extends go{constructor(e,i){super(),this.name=e,this.value=i}get astNodeType(){return"attribute"}};var Oe,Se;(function(t){t[t.token=0]="token",t[t.keyword=1]="keyword",t[t.reserved=2]="reserved"})(Se||(Se={}));class Ce{constructor(e,i,r){this.name=e,this.type=i,this.rule=r}toString(){return this.name}}class te{}Oe=te,te.none=new Ce("",Se.reserved,""),te.eof=new Ce("EOF",Se.token,""),te.reserved={asm:new Ce("asm",Se.reserved,"asm"),bf16:new Ce("bf16",Se.reserved,"bf16"),do:new Ce("do",Se.reserved,"do"),enum:new Ce("enum",Se.reserved,"enum"),f16:new Ce("f16",Se.reserved,"f16"),f64:new Ce("f64",Se.reserved,"f64"),handle:new Ce("handle",Se.reserved,"handle"),i8:new Ce("i8",Se.reserved,"i8"),i16:new Ce("i16",Se.reserved,"i16"),i64:new Ce("i64",Se.reserved,"i64"),mat:new Ce("mat",Se.reserved,"mat"),premerge:new Ce("premerge",Se.reserved,"premerge"),regardless:new Ce("regardless",Se.reserved,"regardless"),typedef:new Ce("typedef",Se.reserved,"typedef"),u8:new Ce("u8",Se.reserved,"u8"),u16:new Ce("u16",Se.reserved,"u16"),u64:new Ce("u64",Se.reserved,"u64"),unless:new Ce("unless",Se.reserved,"unless"),using:new Ce("using",Se.reserved,"using"),vec:new Ce("vec",Se.reserved,"vec"),void:new Ce("void",Se.reserved,"void")},te.keywords={array:new Ce("array",Se.keyword,"array"),atomic:new Ce("atomic",Se.keyword,"atomic"),bool:new Ce("bool",Se.keyword,"bool"),f32:new Ce("f32",Se.keyword,"f32"),i32:new Ce("i32",Se.keyword,"i32"),mat2x2:new Ce("mat2x2",Se.keyword,"mat2x2"),mat2x3:new Ce("mat2x3",Se.keyword,"mat2x3"),mat2x4:new Ce("mat2x4",Se.keyword,"mat2x4"),mat3x2:new Ce("mat3x2",Se.keyword,"mat3x2"),mat3x3:new Ce("mat3x3",Se.keyword,"mat3x3"),mat3x4:new Ce("mat3x4",Se.keyword,"mat3x4"),mat4x2:new Ce("mat4x2",Se.keyword,"mat4x2"),mat4x3:new Ce("mat4x3",Se.keyword,"mat4x3"),mat4x4:new Ce("mat4x4",Se.keyword,"mat4x4"),ptr:new Ce("ptr",Se.keyword,"ptr"),sampler:new Ce("sampler",Se.keyword,"sampler"),sampler_comparison:new Ce("sampler_comparison",Se.keyword,"sampler_comparison"),struct:new Ce("struct",Se.keyword,"struct"),texture_1d:new Ce("texture_1d",Se.keyword,"texture_1d"),texture_2d:new Ce("texture_2d",Se.keyword,"texture_2d"),texture_2d_array:new Ce("texture_2d_array",Se.keyword,"texture_2d_array"),texture_3d:new Ce("texture_3d",Se.keyword,"texture_3d"),texture_cube:new Ce("texture_cube",Se.keyword,"texture_cube"),texture_cube_array:new Ce("texture_cube_array",Se.keyword,"texture_cube_array"),texture_multisampled_2d:new Ce("texture_multisampled_2d",Se.keyword,"texture_multisampled_2d"),texture_storage_1d:new Ce("texture_storage_1d",Se.keyword,"texture_storage_1d"),texture_storage_2d:new Ce("texture_storage_2d",Se.keyword,"texture_storage_2d"),texture_storage_2d_array:new Ce("texture_storage_2d_array",Se.keyword,"texture_storage_2d_array"),texture_storage_3d:new Ce("texture_storage_3d",Se.keyword,"texture_storage_3d"),texture_depth_2d:new Ce("texture_depth_2d",Se.keyword,"texture_depth_2d"),texture_depth_2d_array:new Ce("texture_depth_2d_array",Se.keyword,"texture_depth_2d_array"),texture_depth_cube:new Ce("texture_depth_cube",Se.keyword,"texture_depth_cube"),texture_depth_cube_array:new Ce("texture_depth_cube_array",Se.keyword,"texture_depth_cube_array"),texture_depth_multisampled_2d:new Ce("texture_depth_multisampled_2d",Se.keyword,"texture_depth_multisampled_2d"),texture_external:new Ce("texture_external",Se.keyword,"texture_external"),u32:new Ce("u32",Se.keyword,"u32"),vec2:new Ce("vec2",Se.keyword,"vec2"),vec3:new Ce("vec3",Se.keyword,"vec3"),vec4:new Ce("vec4",Se.keyword,"vec4"),bitcast:new Ce("bitcast",Se.keyword,"bitcast"),block:new Ce("block",Se.keyword,"block"),break:new Ce("break",Se.keyword,"break"),case:new Ce("case",Se.keyword,"case"),continue:new Ce("continue",Se.keyword,"continue"),continuing:new Ce("continuing",Se.keyword,"continuing"),default:new Ce("default",Se.keyword,"default"),diagnostic:new Ce("diagnostic",Se.keyword,"diagnostic"),discard:new Ce("discard",Se.keyword,"discard"),else:new Ce("else",Se.keyword,"else"),enable:new Ce("enable",Se.keyword,"enable"),fallthrough:new Ce("fallthrough",Se.keyword,"fallthrough"),false:new Ce("false",Se.keyword,"false"),fn:new Ce("fn",Se.keyword,"fn"),for:new Ce("for",Se.keyword,"for"),function:new Ce("function",Se.keyword,"function"),if:new Ce("if",Se.keyword,"if"),let:new Ce("let",Se.keyword,"let"),const:new Ce("const",Se.keyword,"const"),loop:new Ce("loop",Se.keyword,"loop"),while:new Ce("while",Se.keyword,"while"),private:new Ce("private",Se.keyword,"private"),read:new Ce("read",Se.keyword,"read"),read_write:new Ce("read_write",Se.keyword,"read_write"),return:new Ce("return",Se.keyword,"return"),requires:new Ce("requires",Se.keyword,"requires"),storage:new Ce("storage",Se.keyword,"storage"),switch:new Ce("switch",Se.keyword,"switch"),true:new Ce("true",Se.keyword,"true"),alias:new Ce("alias",Se.keyword,"alias"),type:new Ce("type",Se.keyword,"type"),uniform:new Ce("uniform",Se.keyword,"uniform"),var:new Ce("var",Se.keyword,"var"),override:new Ce("override",Se.keyword,"override"),workgroup:new Ce("workgroup",Se.keyword,"workgroup"),write:new Ce("write",Se.keyword,"write"),r8unorm:new Ce("r8unorm",Se.keyword,"r8unorm"),r8snorm:new Ce("r8snorm",Se.keyword,"r8snorm"),r8uint:new Ce("r8uint",Se.keyword,"r8uint"),r8sint:new Ce("r8sint",Se.keyword,"r8sint"),r16uint:new Ce("r16uint",Se.keyword,"r16uint"),r16sint:new Ce("r16sint",Se.keyword,"r16sint"),r16float:new Ce("r16float",Se.keyword,"r16float"),rg8unorm:new Ce("rg8unorm",Se.keyword,"rg8unorm"),rg8snorm:new Ce("rg8snorm",Se.keyword,"rg8snorm"),rg8uint:new Ce("rg8uint",Se.keyword,"rg8uint"),rg8sint:new Ce("rg8sint",Se.keyword,"rg8sint"),r32uint:new Ce("r32uint",Se.keyword,"r32uint"),r32sint:new Ce("r32sint",Se.keyword,"r32sint"),r32float:new Ce("r32float",Se.keyword,"r32float"),rg16uint:new Ce("rg16uint",Se.keyword,"rg16uint"),rg16sint:new Ce("rg16sint",Se.keyword,"rg16sint"),rg16float:new Ce("rg16float",Se.keyword,"rg16float"),rgba8unorm:new Ce("rgba8unorm",Se.keyword,"rgba8unorm"),rgba8unorm_srgb:new Ce("rgba8unorm_srgb",Se.keyword,"rgba8unorm_srgb"),rgba8snorm:new Ce("rgba8snorm",Se.keyword,"rgba8snorm"),rgba8uint:new Ce("rgba8uint",Se.keyword,"rgba8uint"),rgba8sint:new Ce("rgba8sint",Se.keyword,"rgba8sint"),bgra8unorm:new Ce("bgra8unorm",Se.keyword,"bgra8unorm"),bgra8unorm_srgb:new Ce("bgra8unorm_srgb",Se.keyword,"bgra8unorm_srgb"),rgb10a2unorm:new Ce("rgb10a2unorm",Se.keyword,"rgb10a2unorm"),rg11b10float:new Ce("rg11b10float",Se.keyword,"rg11b10float"),rg32uint:new Ce("rg32uint",Se.keyword,"rg32uint"),rg32sint:new Ce("rg32sint",Se.keyword,"rg32sint"),rg32float:new Ce("rg32float",Se.keyword,"rg32float"),rgba16uint:new Ce("rgba16uint",Se.keyword,"rgba16uint"),rgba16sint:new Ce("rgba16sint",Se.keyword,"rgba16sint"),rgba16float:new Ce("rgba16float",Se.keyword,"rgba16float"),rgba32uint:new Ce("rgba32uint",Se.keyword,"rgba32uint"),rgba32sint:new Ce("rgba32sint",Se.keyword,"rgba32sint"),rgba32float:new Ce("rgba32float",Se.keyword,"rgba32float"),static_assert:new Ce("static_assert",Se.keyword,"static_assert")},te.tokens={decimal_float_literal:new Ce("decimal_float_literal",Se.token,/((-?[0-9]*\.[0-9]+|-?[0-9]+\.[0-9]*)((e|E)(\+|-)?[0-9]+)?f?)|(-?[0-9]+(e|E)(\+|-)?[0-9]+f?)|([0-9]+f)/),hex_float_literal:new Ce("hex_float_literal",Se.token,/-?0x((([0-9a-fA-F]*\.[0-9a-fA-F]+|[0-9a-fA-F]+\.[0-9a-fA-F]*)((p|P)(\+|-)?[0-9]+f?)?)|([0-9a-fA-F]+(p|P)(\+|-)?[0-9]+f?))/),int_literal:new Ce("int_literal",Se.token,/-?0x[0-9a-fA-F]+|0i?|-?[1-9][0-9]*i?/),uint_literal:new Ce("uint_literal",Se.token,/0x[0-9a-fA-F]+u|0u|[1-9][0-9]*u/),ident:new Ce("ident",Se.token,/[_a-zA-Z][0-9a-zA-Z_]*/),and:new Ce("and",Se.token,"&"),and_and:new Ce("and_and",Se.token,"&&"),arrow:new Ce("arrow ",Se.token,"->"),attr:new Ce("attr",Se.token,"@"),forward_slash:new Ce("forward_slash",Se.token,"/"),bang:new Ce("bang",Se.token,"!"),bracket_left:new Ce("bracket_left",Se.token,"["),bracket_right:new Ce("bracket_right",Se.token,"]"),brace_left:new Ce("brace_left",Se.token,"{"),brace_right:new Ce("brace_right",Se.token,"}"),colon:new Ce("colon",Se.token,":"),comma:new Ce("comma",Se.token,","),equal:new Ce("equal",Se.token,"="),equal_equal:new Ce("equal_equal",Se.token,"=="),not_equal:new Ce("not_equal",Se.token,"!="),greater_than:new Ce("greater_than",Se.token,">"),greater_than_equal:new Ce("greater_than_equal",Se.token,">="),shift_right:new Ce("shift_right",Se.token,">>"),less_than:new Ce("less_than",Se.token,"<"),less_than_equal:new Ce("less_than_equal",Se.token,"<="),shift_left:new Ce("shift_left",Se.token,"<<"),modulo:new Ce("modulo",Se.token,"%"),minus:new Ce("minus",Se.token,"-"),minus_minus:new Ce("minus_minus",Se.token,"--"),period:new Ce("period",Se.token,"."),plus:new Ce("plus",Se.token,"+"),plus_plus:new Ce("plus_plus",Se.token,"++"),or:new Ce("or",Se.token,"|"),or_or:new Ce("or_or",Se.token,"||"),paren_left:new Ce("paren_left",Se.token,"("),paren_right:new Ce("paren_right",Se.token,")"),semicolon:new Ce("semicolon",Se.token,";"),star:new Ce("star",Se.token,"*"),tilde:new Ce("tilde",Se.token,"~"),underscore:new Ce("underscore",Se.token,"_"),xor:new Ce("xor",Se.token,"^"),plus_equal:new Ce("plus_equal",Se.token,"+="),minus_equal:new Ce("minus_equal",Se.token,"-="),times_equal:new Ce("times_equal",Se.token,"*="),division_equal:new Ce("division_equal",Se.token,"/="),modulo_equal:new Ce("modulo_equal",Se.token,"%="),and_equal:new Ce("and_equal",Se.token,"&="),or_equal:new Ce("or_equal",Se.token,"|="),xor_equal:new Ce("xor_equal",Se.token,"^="),shift_right_equal:new Ce("shift_right_equal",Se.token,">>="),shift_left_equal:new Ce("shift_left_equal",Se.token,"<<=")},te.simpleTokens={"@":Oe.tokens.attr,"{":Oe.tokens.brace_left,"}":Oe.tokens.brace_right,":":Oe.tokens.colon,",":Oe.tokens.comma,"(":Oe.tokens.paren_left,")":Oe.tokens.paren_right,";":Oe.tokens.semicolon},te.literalTokens={"&":Oe.tokens.and,"&&":Oe.tokens.and_and,"->":Oe.tokens.arrow,"/":Oe.tokens.forward_slash,"!":Oe.tokens.bang,"[":Oe.tokens.bracket_left,"]":Oe.tokens.bracket_right,"=":Oe.tokens.equal,"==":Oe.tokens.equal_equal,"!=":Oe.tokens.not_equal,">":Oe.tokens.greater_than,">=":Oe.tokens.greater_than_equal,">>":Oe.tokens.shift_right,"<":Oe.tokens.less_than,"<=":Oe.tokens.less_than_equal,"<<":Oe.tokens.shift_left,"%":Oe.tokens.modulo,"-":Oe.tokens.minus,"--":Oe.tokens.minus_minus,".":Oe.tokens.period,"+":Oe.tokens.plus,"++":Oe.tokens.plus_plus,"|":Oe.tokens.or,"||":Oe.tokens.or_or,"*":Oe.tokens.star,"~":Oe.tokens.tilde,_:Oe.tokens.underscore,"^":Oe.tokens.xor,"+=":Oe.tokens.plus_equal,"-=":Oe.tokens.minus_equal,"*=":Oe.tokens.times_equal,"/=":Oe.tokens.division_equal,"%=":Oe.tokens.modulo_equal,"&=":Oe.tokens.and_equal,"|=":Oe.tokens.or_equal,"^=":Oe.tokens.xor_equal,">>=":Oe.tokens.shift_right_equal,"<<=":Oe.tokens.shift_left_equal},te.regexTokens={decimal_float_literal:Oe.tokens.decimal_float_literal,hex_float_literal:Oe.tokens.hex_float_literal,int_literal:Oe.tokens.int_literal,uint_literal:Oe.tokens.uint_literal,ident:Oe.tokens.ident},te.storage_class=[Oe.keywords.function,Oe.keywords.private,Oe.keywords.workgroup,Oe.keywords.uniform,Oe.keywords.storage],te.access_mode=[Oe.keywords.read,Oe.keywords.write,Oe.keywords.read_write],te.sampler_type=[Oe.keywords.sampler,Oe.keywords.sampler_comparison],te.sampled_texture_type=[Oe.keywords.texture_1d,Oe.keywords.texture_2d,Oe.keywords.texture_2d_array,Oe.keywords.texture_3d,Oe.keywords.texture_cube,Oe.keywords.texture_cube_array],te.multisampled_texture_type=[Oe.keywords.texture_multisampled_2d],te.storage_texture_type=[Oe.keywords.texture_storage_1d,Oe.keywords.texture_storage_2d,Oe.keywords.texture_storage_2d_array,Oe.keywords.texture_storage_3d],te.depth_texture_type=[Oe.keywords.texture_depth_2d,Oe.keywords.texture_depth_2d_array,Oe.keywords.texture_depth_cube,Oe.keywords.texture_depth_cube_array,Oe.keywords.texture_depth_multisampled_2d],te.texture_external_type=[Oe.keywords.texture_external],te.any_texture_type=[...Oe.sampled_texture_type,...Oe.multisampled_texture_type,...Oe.storage_texture_type,...Oe.depth_texture_type,...Oe.texture_external_type],te.texel_format=[Oe.keywords.r8unorm,Oe.keywords.r8snorm,Oe.keywords.r8uint,Oe.keywords.r8sint,Oe.keywords.r16uint,Oe.keywords.r16sint,Oe.keywords.r16float,Oe.keywords.rg8unorm,Oe.keywords.rg8snorm,Oe.keywords.rg8uint,Oe.keywords.rg8sint,Oe.keywords.r32uint,Oe.keywords.r32sint,Oe.keywords.r32float,Oe.keywords.rg16uint,Oe.keywords.rg16sint,Oe.keywords.rg16float,Oe.keywords.rgba8unorm,Oe.keywords.rgba8unorm_srgb,Oe.keywords.rgba8snorm,Oe.keywords.rgba8uint,Oe.keywords.rgba8sint,Oe.keywords.bgra8unorm,Oe.keywords.bgra8unorm_srgb,Oe.keywords.rgb10a2unorm,Oe.keywords.rg11b10float,Oe.keywords.rg32uint,Oe.keywords.rg32sint,Oe.keywords.rg32float,Oe.keywords.rgba16uint,Oe.keywords.rgba16sint,Oe.keywords.rgba16float,Oe.keywords.rgba32uint,Oe.keywords.rgba32sint,Oe.keywords.rgba32float],te.const_literal=[Oe.tokens.int_literal,Oe.tokens.uint_literal,Oe.tokens.decimal_float_literal,Oe.tokens.hex_float_literal,Oe.keywords.true,Oe.keywords.false],te.literal_or_ident=[Oe.tokens.ident,Oe.tokens.int_literal,Oe.tokens.uint_literal,Oe.tokens.decimal_float_literal,Oe.tokens.hex_float_literal],te.element_count_expression=[Oe.tokens.int_literal,Oe.tokens.uint_literal,Oe.tokens.ident],te.template_types=[Oe.keywords.vec2,Oe.keywords.vec3,Oe.keywords.vec4,Oe.keywords.mat2x2,Oe.keywords.mat2x3,Oe.keywords.mat2x4,Oe.keywords.mat3x2,Oe.keywords.mat3x3,Oe.keywords.mat3x4,Oe.keywords.mat4x2,Oe.keywords.mat4x3,Oe.keywords.mat4x4,Oe.keywords.atomic,Oe.keywords.bitcast,...Oe.any_texture_type],te.attribute_name=[Oe.tokens.ident,Oe.keywords.block,Oe.keywords.diagnostic],te.assignment_operators=[Oe.tokens.equal,Oe.tokens.plus_equal,Oe.tokens.minus_equal,Oe.tokens.times_equal,Oe.tokens.division_equal,Oe.tokens.modulo_equal,Oe.tokens.and_equal,Oe.tokens.or_equal,Oe.tokens.xor_equal,Oe.tokens.shift_right_equal,Oe.tokens.shift_left_equal],te.increment_operators=[Oe.tokens.plus_plus,Oe.tokens.minus_minus];class _v{constructor(e,i,r){this.type=e,this.lexeme=i,this.line=r}toString(){return this.lexeme}isTemplateType(){return te.template_types.indexOf(this.type)!=-1}isArrayType(){return this.type==te.keywords.array}isArrayOrTemplateType(){return this.isArrayType()||this.isTemplateType()}}class FM{constructor(e){this._tokens=[],this._start=0,this._current=0,this._line=1,this._source=e??""}scanTokens(){for(;!this._isAtEnd();)if(this._start=this._current,!this.scanToken())throw`Invalid syntax at line ${this._line}`;return this._tokens.push(new _v(te.eof,"",this._line)),this._tokens}scanToken(){let e=this._advance();if(e==`
`)return this._line++,!0;if(this._isWhitespace(e))return!0;if(e=="/"){if(this._peekAhead()=="/"){for(;e!=`
`;){if(this._isAtEnd())return!0;e=this._advance()}return this._line++,!0}else if(this._peekAhead()=="*"){this._advance();let d=1;for(;d>0;){if(this._isAtEnd())return!0;if(e=this._advance(),e==`
`)this._line++;else if(e=="*"){if(this._peekAhead()=="/"&&(this._advance(),d--,d==0))return!0}else e=="/"&&this._peekAhead()=="*"&&(this._advance(),d++)}return!0}}const i=te.simpleTokens[e];if(i)return this._addToken(i),!0;let r=te.none;const o=this._isAlpha(e),u=e==="_";if(this._isAlphaNumeric(e)){let d=this._peekAhead();for(;this._isAlphaNumeric(d);)e+=this._advance(),d=this._peekAhead()}if(o){const d=te.keywords[e];if(d)return this._addToken(d),!0}if(o||u)return this._addToken(te.tokens.ident),!0;for(;;){let d=this._findType(e);const a=this._peekAhead();if(e=="-"&&this._tokens.length>0){if(a=="=")return this._current++,e+=a,this._addToken(te.tokens.minus_equal),!0;if(a=="-")return this._current++,e+=a,this._addToken(te.tokens.minus_minus),!0;const x=this._tokens.length-1;if((te.literal_or_ident.indexOf(this._tokens[x].type)!=-1||this._tokens[x].type==te.tokens.paren_right)&&a!=">")return this._addToken(d),!0}if(e==">"&&(a==">"||a=="=")){let x=!1,A=this._tokens.length-1;for(let M=0;M<5&&A>=0&&te.assignment_operators.indexOf(this._tokens[A].type)===-1;++M,--A)if(this._tokens[A].type===te.tokens.less_than){A>0&&this._tokens[A-1].isArrayOrTemplateType()&&(x=!0);break}if(x)return this._addToken(d),!0}if(d===te.none){let x=e,A=0;const M=2;for(let D=0;D<M;++D)if(x+=this._peekAhead(D),d=this._findType(x),d!==te.none){A=D;break}if(d===te.none)return r===te.none?!1:(this._current--,this._addToken(r),!0);e=x,this._current+=A+1}if(r=d,this._isAtEnd())break;e+=this._advance()}return r===te.none?!1:(this._addToken(r),!0)}_findType(e){for(const r in te.regexTokens){const o=te.regexTokens[r];if(this._match(e,o.rule))return o}const i=te.literalTokens[e];return i||te.none}_match(e,i){const r=i.exec(e);return r&&r.index==0&&r[0]==e}_isAtEnd(){return this._current>=this._source.length}_isAlpha(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"}_isAlphaNumeric(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"||e=="_"||e>="0"&&e<="9"}_isWhitespace(e){return e==" "||e=="	"||e=="\r"}_advance(e=0){let i=this._source[this._current];return e=e||0,e++,this._current+=e,i}_peekAhead(e=0){return e=e||0,this._current+e>=this._source.length?"\0":this._source[this._current+e]}_addToken(e){const i=this._source.substring(this._start,this._current);this._tokens.push(new _v(e,i,this._line))}}class kM{constructor(){this._tokens=[],this._current=0,this._currentLine=0,this._context=new aM,this._deferArrayCountEval=[]}parse(e){this._initialize(e),this._deferArrayCountEval.length=0;const i=[];for(;!this._isAtEnd();){const r=this._global_decl_or_directive();if(!r)break;i.push(r)}if(this._deferArrayCountEval.length>0){for(const r of this._deferArrayCountEval){const o=r.arrayType,u=r.countNode;if(u instanceof og){const a=u.name,x=this._context.constants.get(a);if(x)try{const A=x.evaluate(this._context);o.count=A}catch{}}}this._deferArrayCountEval.length=0}return i}_initialize(e){if(e)if(typeof e=="string"){const i=new FM(e);this._tokens=i.scanTokens()}else this._tokens=e;else this._tokens=[];this._current=0}_error(e,i){return{token:e,message:i,toString:function(){return`${i}`}}}_isAtEnd(){return this._current>=this._tokens.length||this._peek().type==te.eof}_match(e){if(e instanceof Ce)return this._check(e)?(this._advance(),!0):!1;for(let i=0,r=e.length;i<r;++i){const o=e[i];if(this._check(o))return this._advance(),!0}return!1}_consume(e,i){if(this._check(e))return this._advance();throw this._error(this._peek(),i)}_check(e){if(this._isAtEnd())return!1;const i=this._peek();if(e instanceof Array){const r=i.type;return e.indexOf(r)!=-1}return i.type==e}_advance(){var e,i;return this._currentLine=(i=(e=this._peek())===null||e===void 0?void 0:e.line)!==null&&i!==void 0?i:-1,this._isAtEnd()||this._current++,this._previous()}_peek(){return this._tokens[this._current]}_previous(){return this._tokens[this._current-1]}_global_decl_or_directive(){for(;this._match(te.tokens.semicolon)&&!this._isAtEnd(););if(this._match(te.keywords.alias)){const i=this._type_alias();return this._consume(te.tokens.semicolon,"Expected ';'"),i}if(this._match(te.keywords.diagnostic)){const i=this._diagnostic();return this._consume(te.tokens.semicolon,"Expected ';'"),i}if(this._match(te.keywords.requires)){const i=this._requires_directive();return this._consume(te.tokens.semicolon,"Expected ';'"),i}if(this._match(te.keywords.enable)){const i=this._enable_directive();return this._consume(te.tokens.semicolon,"Expected ';'"),i}const e=this._attribute();if(this._check(te.keywords.var)){const i=this._global_variable_decl();return i!=null&&(i.attributes=e),this._consume(te.tokens.semicolon,"Expected ';'."),i}if(this._check(te.keywords.override)){const i=this._override_variable_decl();return i!=null&&(i.attributes=e),this._consume(te.tokens.semicolon,"Expected ';'."),i}if(this._check(te.keywords.let)){const i=this._global_let_decl();return i!=null&&(i.attributes=e),this._consume(te.tokens.semicolon,"Expected ';'."),i}if(this._check(te.keywords.const)){const i=this._global_const_decl();return i!=null&&(i.attributes=e),this._consume(te.tokens.semicolon,"Expected ';'."),i}if(this._check(te.keywords.struct)){const i=this._struct_decl();return i!=null&&(i.attributes=e),i}if(this._check(te.keywords.fn)){const i=this._function_decl();return i!=null&&(i.attributes=e),i}return null}_function_decl(){if(!this._match(te.keywords.fn))return null;const e=this._currentLine,i=this._consume(te.tokens.ident,"Expected function name.").toString();this._consume(te.tokens.paren_left,"Expected '(' for function arguments.");const r=[];if(!this._check(te.tokens.paren_right))do{if(this._check(te.tokens.paren_right))break;const a=this._attribute(),x=this._consume(te.tokens.ident,"Expected argument name.").toString();this._consume(te.tokens.colon,"Expected ':' for argument type.");const A=this._attribute(),M=this._type_decl();M!=null&&(M.attributes=A,r.push(new PM(x,M,a)))}while(this._match(te.tokens.comma));this._consume(te.tokens.paren_right,"Expected ')' after function arguments.");let o=null;if(this._match(te.tokens.arrow)){const a=this._attribute();o=this._type_decl(),o!=null&&(o.attributes=a)}const u=this._compound_statement(),d=this._currentLine;return new sg(i,r,o,u,e,d)}_compound_statement(){const e=[];for(this._consume(te.tokens.brace_left,"Expected '{' for block.");!this._check(te.tokens.brace_right);){const i=this._statement();i!==null&&e.push(i)}return this._consume(te.tokens.brace_right,"Expected '}' for block."),e}_statement(){for(;this._match(te.tokens.semicolon)&&!this._isAtEnd(););if(this._check(te.tokens.attr)&&this._attribute(),this._check(te.keywords.if))return this._if_statement();if(this._check(te.keywords.switch))return this._switch_statement();if(this._check(te.keywords.loop))return this._loop_statement();if(this._check(te.keywords.for))return this._for_statement();if(this._check(te.keywords.while))return this._while_statement();if(this._check(te.keywords.continuing))return this._continuing_statement();if(this._check(te.keywords.static_assert))return this._static_assert_statement();if(this._check(te.tokens.brace_left))return this._compound_statement();let e=null;return this._check(te.keywords.return)?e=this._return_statement():this._check([te.keywords.var,te.keywords.let,te.keywords.const])?e=this._variable_statement():this._match(te.keywords.discard)?e=new xM:this._match(te.keywords.break)?e=new wM:this._match(te.keywords.continue)?e=new TM:e=this._increment_decrement_statement()||this._func_call_statement()||this._assignment_statement(),e!=null&&this._consume(te.tokens.semicolon,"Expected ';' after statement."),e}_static_assert_statement(){if(!this._match(te.keywords.static_assert))return null;const e=this._optional_paren_expression();return new lM(e)}_while_statement(){if(!this._match(te.keywords.while))return null;const e=this._optional_paren_expression();this._check(te.tokens.attr)&&this._attribute();const i=this._compound_statement();return new cM(e,i)}_continuing_statement(){if(!this._match(te.keywords.continuing))return null;const e=this._compound_statement();return new hM(e)}_for_statement(){if(!this._match(te.keywords.for))return null;this._consume(te.tokens.paren_left,"Expected '('.");const e=this._check(te.tokens.semicolon)?null:this._for_init();this._consume(te.tokens.semicolon,"Expected ';'.");const i=this._check(te.tokens.semicolon)?null:this._short_circuit_or_expression();this._consume(te.tokens.semicolon,"Expected ';'.");const r=this._check(te.tokens.paren_right)?null:this._for_increment();this._consume(te.tokens.paren_right,"Expected ')'."),this._check(te.tokens.attr)&&this._attribute();const o=this._compound_statement();return new uM(e,i,r,o)}_for_init(){return this._variable_statement()||this._func_call_statement()||this._assignment_statement()}_for_increment(){return this._func_call_statement()||this._increment_decrement_statement()||this._assignment_statement()}_variable_statement(){if(this._check(te.keywords.var)){const e=this._variable_decl();if(e===null)throw this._error(this._peek(),"Variable declaration expected.");let i=null;return this._match(te.tokens.equal)&&(i=this._short_circuit_or_expression()),new za(e.name,e.type,e.storage,e.access,i)}if(this._match(te.keywords.let)){const e=this._consume(te.tokens.ident,"Expected name for let.").toString();let i=null;if(this._match(te.tokens.colon)){const o=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=o)}this._consume(te.tokens.equal,"Expected '=' for let.");const r=this._short_circuit_or_expression();return new ng(e,i,null,null,r)}if(this._match(te.keywords.const)){const e=this._consume(te.tokens.ident,"Expected name for const.").toString();let i=null;if(this._match(te.tokens.colon)){const o=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=o)}this._consume(te.tokens.equal,"Expected '=' for const.");const r=this._short_circuit_or_expression();return new sv(e,i,null,null,r)}return null}_increment_decrement_statement(){const e=this._current,i=this._unary_expression();if(i==null)return null;if(!this._check(te.increment_operators))return this._current=e,null;const r=this._consume(te.increment_operators,"Expected increment operator");return new dM(r.type===te.tokens.plus_plus?Kl.increment:Kl.decrement,i)}_assignment_statement(){let e=null;if(this._check(te.tokens.brace_right))return null;let i=this._match(te.tokens.underscore);if(i||(e=this._unary_expression()),!i&&e==null)return null;const r=this._consume(te.assignment_operators,"Expected assignment operator."),o=this._short_circuit_or_expression();return new fM(Fh.parse(r.lexeme),e,o)}_func_call_statement(){if(!this._check(te.tokens.ident))return null;const e=this._current,i=this._consume(te.tokens.ident,"Expected function name."),r=this._argument_expression_list();return r===null?(this._current=e,null):new nv(i.lexeme,r)}_loop_statement(){if(!this._match(te.keywords.loop))return null;this._check(te.tokens.attr)&&this._attribute(),this._consume(te.tokens.brace_left,"Expected '{' for loop.");const e=[];let i=this._statement();for(;i!==null;){if(Array.isArray(i))for(let o of i)e.push(o);else e.push(i);i=this._statement()}let r=null;return this._match(te.keywords.continuing)&&(r=this._compound_statement()),this._consume(te.tokens.brace_right,"Expected '}' for loop."),new pM(e,r)}_switch_statement(){if(!this._match(te.keywords.switch))return null;const e=this._optional_paren_expression();this._check(te.tokens.attr)&&this._attribute(),this._consume(te.tokens.brace_left,"Expected '{' for switch.");const i=this._switch_body();if(i==null||i.length==0)throw this._error(this._previous(),"Expected 'case' or 'default'.");return this._consume(te.tokens.brace_right,"Expected '}' for switch."),new _M(e,i)}_switch_body(){const e=[];if(this._match(te.keywords.case)){const i=this._case_selectors();this._match(te.tokens.colon),this._check(te.tokens.attr)&&this._attribute(),this._consume(te.tokens.brace_left,"Exected '{' for switch case.");const r=this._case_body();this._consume(te.tokens.brace_right,"Exected '}' for switch case."),e.push(new MM(i,r))}if(this._match(te.keywords.default)){this._match(te.tokens.colon),this._check(te.tokens.attr)&&this._attribute(),this._consume(te.tokens.brace_left,"Exected '{' for switch default.");const i=this._case_body();this._consume(te.tokens.brace_right,"Exected '}' for switch default."),e.push(new RM(i))}if(this._check([te.keywords.default,te.keywords.case])){const i=this._switch_body();e.push(i[0])}return e}_case_selectors(){const e=[this._shift_expression()];for(;this._match(te.tokens.comma);)e.push(this._shift_expression());return e}_case_body(){if(this._match(te.keywords.fallthrough))return this._consume(te.tokens.semicolon,"Expected ';'"),[];let e=this._statement();if(e==null)return[];e instanceof Array||(e=[e]);const i=this._case_body();return i.length==0?e:[...e,i[0]]}_if_statement(){if(!this._match(te.keywords.if))return null;const e=this._optional_paren_expression();this._check(te.tokens.attr)&&this._attribute();const i=this._compound_statement();let r=[];this._match_elseif()&&(this._check(te.tokens.attr)&&this._attribute(),r=this._elseif_statement(r));let o=null;return this._match(te.keywords.else)&&(this._check(te.tokens.attr)&&this._attribute(),o=this._compound_statement()),new gM(e,i,r,o)}_match_elseif(){return this._tokens[this._current].type===te.keywords.else&&this._tokens[this._current+1].type===te.keywords.if?(this._advance(),this._advance(),!0):!1}_elseif_statement(e=[]){const i=this._optional_paren_expression(),r=this._compound_statement();return e.push(new BM(i,r)),this._match_elseif()&&(this._check(te.tokens.attr)&&this._attribute(),this._elseif_statement(e)),e}_return_statement(){if(!this._match(te.keywords.return))return null;const e=this._short_circuit_or_expression();return new mM(e)}_short_circuit_or_expression(){let e=this._short_circuit_and_expr();for(;this._match(te.tokens.or_or);)e=new jn(this._previous().toString(),e,this._short_circuit_and_expr());return e}_short_circuit_and_expr(){let e=this._inclusive_or_expression();for(;this._match(te.tokens.and_and);)e=new jn(this._previous().toString(),e,this._inclusive_or_expression());return e}_inclusive_or_expression(){let e=this._exclusive_or_expression();for(;this._match(te.tokens.or);)e=new jn(this._previous().toString(),e,this._exclusive_or_expression());return e}_exclusive_or_expression(){let e=this._and_expression();for(;this._match(te.tokens.xor);)e=new jn(this._previous().toString(),e,this._and_expression());return e}_and_expression(){let e=this._equality_expression();for(;this._match(te.tokens.and);)e=new jn(this._previous().toString(),e,this._equality_expression());return e}_equality_expression(){const e=this._relational_expression();return this._match([te.tokens.equal_equal,te.tokens.not_equal])?new jn(this._previous().toString(),e,this._relational_expression()):e}_relational_expression(){let e=this._shift_expression();for(;this._match([te.tokens.less_than,te.tokens.greater_than,te.tokens.less_than_equal,te.tokens.greater_than_equal]);)e=new jn(this._previous().toString(),e,this._shift_expression());return e}_shift_expression(){let e=this._additive_expression();for(;this._match([te.tokens.shift_left,te.tokens.shift_right]);)e=new jn(this._previous().toString(),e,this._additive_expression());return e}_additive_expression(){let e=this._multiplicative_expression();for(;this._match([te.tokens.plus,te.tokens.minus]);)e=new jn(this._previous().toString(),e,this._multiplicative_expression());return e}_multiplicative_expression(){let e=this._unary_expression();for(;this._match([te.tokens.star,te.tokens.forward_slash,te.tokens.modulo]);)e=new jn(this._previous().toString(),e,this._unary_expression());return e}_unary_expression(){return this._match([te.tokens.minus,te.tokens.bang,te.tokens.tilde,te.tokens.star,te.tokens.and])?new IM(this._previous().toString(),this._unary_expression()):this._singular_expression()}_singular_expression(){const e=this._primary_expression(),i=this._postfix_expression();return i&&(e.postfix=i),e}_postfix_expression(){if(this._match(te.tokens.bracket_left)){const e=this._short_circuit_or_expression();this._consume(te.tokens.bracket_right,"Expected ']'.");const i=new CM(e),r=this._postfix_expression();return r&&(i.postfix=r),i}if(this._match(te.tokens.period)){const e=this._consume(te.tokens.ident,"Expected member name."),i=this._postfix_expression(),r=new EM(e.lexeme);return i&&(r.postfix=i),r}return null}_getStruct(e){return this._context.aliases.has(e)?this._context.aliases.get(e).type:this._context.structs.has(e)?this._context.structs.get(e):null}_primary_expression(){if(this._match(te.tokens.ident)){const r=this._previous().toString();if(this._check(te.tokens.paren_left)){const o=this._argument_expression_list(),u=this._getStruct(r);return u!=null?new Yl(u,o):new cv(r,o)}if(this._context.constants.has(r)){const o=this._context.constants.get(r);return new hv(r,o.value)}return new og(r)}if(this._match(te.const_literal))return new uv(parseFloat(this._previous().toString()));if(this._check(te.tokens.paren_left))return this._paren_expression();if(this._match(te.keywords.bitcast)){this._consume(te.tokens.less_than,"Expected '<'.");const r=this._type_decl();this._consume(te.tokens.greater_than,"Expected '>'.");const o=this._paren_expression();return new SM(r,o)}const e=this._type_decl(),i=this._argument_expression_list();return new Yl(e,i)}_argument_expression_list(){if(!this._match(te.tokens.paren_left))return null;const e=[];do{if(this._check(te.tokens.paren_right))break;const i=this._short_circuit_or_expression();e.push(i)}while(this._match(te.tokens.comma));return this._consume(te.tokens.paren_right,"Expected ')' for agument list"),e}_optional_paren_expression(){this._match(te.tokens.paren_left);const e=this._short_circuit_or_expression();return this._match(te.tokens.paren_right),new dv([e])}_paren_expression(){this._consume(te.tokens.paren_left,"Expected '('.");const e=this._short_circuit_or_expression();return this._consume(te.tokens.paren_right,"Expected ')'."),new dv([e])}_struct_decl(){if(!this._match(te.keywords.struct))return null;const e=this._currentLine,i=this._consume(te.tokens.ident,"Expected name for struct.").toString();this._consume(te.tokens.brace_left,"Expected '{' for struct body.");const r=[];for(;!this._check(te.tokens.brace_right);){const d=this._attribute(),a=this._consume(te.tokens.ident,"Expected variable name.").toString();this._consume(te.tokens.colon,"Expected ':' for struct member type.");const x=this._attribute(),A=this._type_decl();A!=null&&(A.attributes=x),this._check(te.tokens.brace_right)?this._match(te.tokens.comma):this._consume(te.tokens.comma,"Expected ',' for struct member."),r.push(new DM(a,A,d))}this._consume(te.tokens.brace_right,"Expected '}' after struct body.");const o=this._currentLine,u=new ja(i,r,e,o);return this._context.structs.set(i,u),u}_global_variable_decl(){const e=this._variable_decl();return e&&this._match(te.tokens.equal)&&(e.value=this._const_expression()),e}_override_variable_decl(){const e=this._override_decl();return e&&this._match(te.tokens.equal)&&(e.value=this._const_expression()),e}_global_const_decl(){if(!this._match(te.keywords.const))return null;const e=this._consume(te.tokens.ident,"Expected variable name");let i=null;if(this._match(te.tokens.colon)){const u=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=u)}let r=null;if(this._match(te.tokens.equal)){const u=this._short_circuit_or_expression();if(u instanceof Yl)r=u;else if(u instanceof hv&&u.initializer instanceof Yl)r=u.initializer;else try{const d=u.evaluate(this._context);r=new uv(d)}catch{r=u}}const o=new sv(e.toString(),i,"","",r);return this._context.constants.set(o.name,o),o}_global_let_decl(){if(!this._match(te.keywords.let))return null;const e=this._consume(te.tokens.ident,"Expected variable name");let i=null;if(this._match(te.tokens.colon)){const o=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=o)}let r=null;return this._match(te.tokens.equal)&&(r=this._const_expression()),new ng(e.toString(),i,"","",r)}_const_expression(){return this._short_circuit_or_expression()}_variable_decl(){if(!this._match(te.keywords.var))return null;let e="",i="";this._match(te.tokens.less_than)&&(e=this._consume(te.storage_class,"Expected storage_class.").toString(),this._match(te.tokens.comma)&&(i=this._consume(te.access_mode,"Expected access_mode.").toString()),this._consume(te.tokens.greater_than,"Expected '>'."));const r=this._consume(te.tokens.ident,"Expected variable name");let o=null;if(this._match(te.tokens.colon)){const u=this._attribute();o=this._type_decl(),o!=null&&(o.attributes=u)}return new za(r.toString(),o,e,i,null)}_override_decl(){if(!this._match(te.keywords.override))return null;const e=this._consume(te.tokens.ident,"Expected variable name");let i=null;if(this._match(te.tokens.colon)){const r=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=r)}return new rv(e.toString(),i,null)}_diagnostic(){this._consume(te.tokens.paren_left,"Expected '('");const e=this._consume(te.tokens.ident,"Expected severity control name.");this._consume(te.tokens.comma,"Expected ','");const i=this._consume(te.tokens.ident,"Expected diagnostic rule name.");return this._consume(te.tokens.paren_right,"Expected ')'"),new vM(e.toString(),i.toString())}_enable_directive(){const e=this._consume(te.tokens.ident,"identity expected.");return new yM(e.toString())}_requires_directive(){const e=[this._consume(te.tokens.ident,"identity expected.").toString()];for(;this._match(te.tokens.comma);){const i=this._consume(te.tokens.ident,"identity expected.");e.push(i.toString())}return new bM(e)}_type_alias(){const e=this._consume(te.tokens.ident,"identity expected.");this._consume(te.tokens.equal,"Expected '=' for type alias.");let i=this._type_decl();if(i===null)throw this._error(this._peek(),"Expected Type for Alias.");this._context.aliases.has(i.name)&&(i=this._context.aliases.get(i.name).type);const r=new ov(e.toString(),i);return this._context.aliases.set(r.name,r),r}_type_decl(){if(this._check([te.tokens.ident,...te.texel_format,te.keywords.bool,te.keywords.f32,te.keywords.i32,te.keywords.u32])){const r=this._advance(),o=r.toString();return this._context.structs.has(o)?this._context.structs.get(o):this._context.aliases.has(o)?this._context.aliases.get(o).type:new Va(r.toString())}let e=this._texture_sampler_types();if(e)return e;if(this._check(te.template_types)){let r=this._advance().toString(),o=null,u=null;return this._match(te.tokens.less_than)&&(o=this._type_decl(),u=null,this._match(te.tokens.comma)&&(u=this._consume(te.access_mode,"Expected access_mode for pointer").toString()),this._consume(te.tokens.greater_than,"Expected '>' for type.")),new av(r,o,u)}if(this._match(te.keywords.ptr)){let r=this._previous().toString();this._consume(te.tokens.less_than,"Expected '<' for pointer.");const o=this._consume(te.storage_class,"Expected storage_class for pointer");this._consume(te.tokens.comma,"Expected ',' for pointer.");const u=this._type_decl();let d=null;return this._match(te.tokens.comma)&&(d=this._consume(te.access_mode,"Expected access_mode for pointer").toString()),this._consume(te.tokens.greater_than,"Expected '>' for pointer."),new AM(r,o.toString(),u,d)}const i=this._attribute();if(this._match(te.keywords.array)){let r=null,o=-1;const u=this._previous();let d=null;if(this._match(te.tokens.less_than)){r=this._type_decl(),this._context.aliases.has(r.name)&&(r=this._context.aliases.get(r.name).type);let x="";if(this._match(te.tokens.comma)){d=this._shift_expression();try{x=d.evaluate(this._context).toString(),d=null}catch{x="1"}}this._consume(te.tokens.greater_than,"Expected '>' for array."),o=x?parseInt(x):0}const a=new lv(u.toString(),i,r,o);return d&&this._deferArrayCountEval.push({arrayType:a,countNode:d}),a}return null}_texture_sampler_types(){if(this._match(te.sampler_type))return new kh(this._previous().toString(),null,null);if(this._match(te.depth_texture_type))return new kh(this._previous().toString(),null,null);if(this._match(te.sampled_texture_type)||this._match(te.multisampled_texture_type)){const e=this._previous();this._consume(te.tokens.less_than,"Expected '<' for sampler type.");const i=this._type_decl();return this._consume(te.tokens.greater_than,"Expected '>' for sampler type."),new kh(e.toString(),i,null)}if(this._match(te.storage_texture_type)){const e=this._previous();this._consume(te.tokens.less_than,"Expected '<' for sampler type.");const i=this._consume(te.texel_format,"Invalid texel format.").toString();this._consume(te.tokens.comma,"Expected ',' after texel format.");const r=this._consume(te.access_mode,"Expected access mode for storage texture type.").toString();return this._consume(te.tokens.greater_than,"Expected '>' for sampler type."),new kh(e.toString(),i,r)}return null}_attribute(){let e=[];for(;this._match(te.tokens.attr);){const i=this._consume(te.attribute_name,"Expected attribute name"),r=new OM(i.toString(),null);if(this._match(te.tokens.paren_left)){if(r.value=this._consume(te.literal_or_ident,"Expected attribute value").toString(),this._check(te.tokens.comma)){this._advance();do{const o=this._consume(te.literal_or_ident,"Expected attribute value").toString();r.value instanceof Array||(r.value=[r.value]),r.value.push(o)}while(this._match(te.tokens.comma))}this._consume(te.tokens.paren_right,"Expected ')'")}e.push(r)}return e.length==0?null:e}}class Jl{constructor(e,i){this.name=e,this.attributes=i,this.size=0}get isArray(){return!1}get isStruct(){return!1}get isTemplate(){return!1}}class gv{constructor(e,i,r){this.name=e,this.type=i,this.attributes=r,this.offset=0,this.size=0}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray?this.type.format:this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class $d extends Jl{constructor(e,i){super(e,i),this.members=[],this.align=0,this.startLine=-1,this.endLine=-1,this.inUse=!1}get isStruct(){return!0}}class ag extends Jl{constructor(e,i){super(e,i),this.count=0,this.stride=0}get isArray(){return!0}}class mv extends Jl{constructor(e,i,r,o){super(e,r),this.format=i,this.access=o}get isTemplate(){return!0}}var Xo;(function(t){t[t.Uniform=0]="Uniform",t[t.Storage=1]="Storage",t[t.Texture=2]="Texture",t[t.Sampler=3]="Sampler",t[t.StorageTexture=4]="StorageTexture"})(Xo||(Xo={}));class Wd{constructor(e,i,r,o,u,d,a){this.name=e,this.type=i,this.group=r,this.binding=o,this.attributes=u,this.resourceType=d,this.access=a}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get size(){return this.type.size}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray?this.type.format:this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class NM{constructor(e,i){this.name=e,this.type=i}}class Xd{constructor(e,i){this.align=e,this.size=i}}class LM{constructor(e,i,r,o){this.name=e,this.type=i,this.locationType=r,this.location=o,this.interpolation=null}}class yv{constructor(e,i,r,o){this.name=e,this.type=i,this.locationType=r,this.location=o}}class UM{constructor(e,i,r,o){this.name=e,this.type=i,this.attributes=r,this.id=o}}class zM{constructor(e,i){this.name=e,this.type=i}}class VM{constructor(e,i=null){this.stage=null,this.inputs=[],this.outputs=[],this.arguments=[],this.returnType=null,this.resources=[],this.overrides=[],this.startLine=-1,this.endLine=-1,this.inUse=!1,this.calls=new Set,this.name=e,this.stage=i}}class jM{constructor(){this.vertex=[],this.fragment=[],this.compute=[]}}class HM{constructor(e){this.resources=null,this.inUse=!1,this.info=null,this.node=e}}class mo{constructor(e){this.uniforms=[],this.storage=[],this.textures=[],this.samplers=[],this.aliases=[],this.overrides=[],this.structs=[],this.entry=new jM,this.functions=[],this._types=new Map,this._functions=new Map,e&&this.update(e)}_isStorageTexture(e){return e.name=="texture_storage_1d"||e.name=="texture_storage_2d"||e.name=="texture_storage_2d_array"||e.name=="texture_storage_3d"}update(e){const r=new kM().parse(e);for(const o of r)o instanceof sg&&this._functions.set(o.name,new HM(o));for(const o of r)if(o instanceof ja){const u=this._getTypeInfo(o,null);u instanceof $d&&this.structs.push(u)}for(const o of r){if(o instanceof ov){this.aliases.push(this._getAliasInfo(o));continue}if(o instanceof rv){const u=o,d=this._getAttributeNum(u.attributes,"id",0),a=u.type!=null?this._getTypeInfo(u.type,u.attributes):null;this.overrides.push(new UM(u.name,a,u.attributes,d));continue}if(this._isUniformVar(o)){const u=o,d=this._getAttributeNum(u.attributes,"group",0),a=this._getAttributeNum(u.attributes,"binding",0),x=this._getTypeInfo(u.type,u.attributes),A=new Wd(u.name,x,d,a,u.attributes,Xo.Uniform,u.access);this.uniforms.push(A);continue}if(this._isStorageVar(o)){const u=o,d=this._getAttributeNum(u.attributes,"group",0),a=this._getAttributeNum(u.attributes,"binding",0),x=this._getTypeInfo(u.type,u.attributes),A=this._isStorageTexture(x),M=new Wd(u.name,x,d,a,u.attributes,A?Xo.StorageTexture:Xo.Storage,u.access);this.storage.push(M);continue}if(this._isTextureVar(o)){const u=o,d=this._getAttributeNum(u.attributes,"group",0),a=this._getAttributeNum(u.attributes,"binding",0),x=this._getTypeInfo(u.type,u.attributes),A=this._isStorageTexture(x),M=new Wd(u.name,x,d,a,u.attributes,A?Xo.StorageTexture:Xo.Texture,u.access);A?this.storage.push(M):this.textures.push(M);continue}if(this._isSamplerVar(o)){const u=o,d=this._getAttributeNum(u.attributes,"group",0),a=this._getAttributeNum(u.attributes,"binding",0),x=this._getTypeInfo(u.type,u.attributes),A=new Wd(u.name,x,d,a,u.attributes,Xo.Sampler,u.access);this.samplers.push(A);continue}if(o instanceof sg){const u=this._getAttribute(o,"vertex"),d=this._getAttribute(o,"fragment"),a=this._getAttribute(o,"compute"),x=u||d||a,A=new VM(o.name,x==null?void 0:x.name);A.startLine=o.startLine,A.endLine=o.endLine,this.functions.push(A),this._functions.get(o.name).info=A,x?(this._functions.get(o.name).inUse=!0,A.inUse=!0,A.resources=this._findResources(o,!!x),A.inputs=this._getInputs(o.args),A.outputs=this._getOutputs(o.returnType),this.entry[x.name].push(A)):(A.arguments=o.args.map(M=>new zM(M.name,this._getTypeInfo(M.type,M.attributes))),A.returnType=o.returnType?this._getTypeInfo(o.returnType,o.attributes):null);continue}}for(const o of this._functions.values())o.info&&(o.info.inUse=o.inUse,this._addCalls(o.node,o.info.calls));for(const o of this._functions.values())o.node.search(u=>{var d;if(u.astNodeType==="varExpr"){const a=u;for(const x of this.overrides)a.name==x.name&&((d=o.info)===null||d===void 0||d.overrides.push(x))}});for(const o of this.uniforms)this._markStructsInUse(o.type);for(const o of this.storage)this._markStructsInUse(o.type)}_markStructsInUse(e){if(e)if(e.isStruct){if(e.inUse=!0,e.members)for(const i of e.members)this._markStructsInUse(i.type)}else if(e.isArray)this._markStructsInUse(e.format);else if(e.isTemplate)e.format&&this._markStructsInUse(e.format);else{const i=this._getAlias(e.name);i&&this._markStructsInUse(i)}}_addCalls(e,i){var r;for(const o of e.calls){const u=(r=this._functions.get(o.name))===null||r===void 0?void 0:r.info;u&&i.add(u)}}findResource(e,i){for(const r of this.uniforms)if(r.group==e&&r.binding==i)return r;for(const r of this.storage)if(r.group==e&&r.binding==i)return r;for(const r of this.textures)if(r.group==e&&r.binding==i)return r;for(const r of this.samplers)if(r.group==e&&r.binding==i)return r;return null}_findResource(e){for(const i of this.uniforms)if(i.name==e)return i;for(const i of this.storage)if(i.name==e)return i;for(const i of this.textures)if(i.name==e)return i;for(const i of this.samplers)if(i.name==e)return i;return null}_markStructsFromAST(e){const i=this._getTypeInfo(e,null);this._markStructsInUse(i)}_findResources(e,i){const r=[],o=this,u=[];return e.search(d=>{if(d instanceof Hd)u.push({});else if(d instanceof Gd)u.pop();else if(d instanceof za){const a=d;i&&a.type!==null&&this._markStructsFromAST(a.type),u.length>0&&(u[u.length-1][a.name]=a)}else if(d instanceof Yl){const a=d;i&&a.type!==null&&this._markStructsFromAST(a.type)}else if(d instanceof ng){const a=d;i&&a.type!==null&&this._markStructsFromAST(a.type),u.length>0&&(u[u.length-1][a.name]=a)}else if(d instanceof og){const a=d;if(u.length>0&&u[u.length-1][a.name])return;const x=o._findResource(a.name);x&&r.push(x)}else if(d instanceof cv){const a=d,x=o._functions.get(a.name);x&&(i&&(x.inUse=!0),e.calls.add(x.node),x.resources===null&&(x.resources=o._findResources(x.node,i)),r.push(...x.resources))}else if(d instanceof nv){const a=d,x=o._functions.get(a.name);x&&(i&&(x.inUse=!0),e.calls.add(x.node),x.resources===null&&(x.resources=o._findResources(x.node,i)),r.push(...x.resources))}}),[...new Map(r.map(d=>[d.name,d])).values()]}getBindGroups(){const e=[];function i(r,o){r>=e.length&&(e.length=r+1),e[r]===void 0&&(e[r]=[]),o>=e[r].length&&(e[r].length=o+1)}for(const r of this.uniforms){i(r.group,r.binding);const o=e[r.group];o[r.binding]=r}for(const r of this.storage){i(r.group,r.binding);const o=e[r.group];o[r.binding]=r}for(const r of this.textures){i(r.group,r.binding);const o=e[r.group];o[r.binding]=r}for(const r of this.samplers){i(r.group,r.binding);const o=e[r.group];o[r.binding]=r}return e}_getOutputs(e,i=void 0){if(i===void 0&&(i=[]),e instanceof ja)this._getStructOutputs(e,i);else{const r=this._getOutputInfo(e);r!==null&&i.push(r)}return i}_getStructOutputs(e,i){for(const r of e.members)if(r.type instanceof ja)this._getStructOutputs(r.type,i);else{const o=this._getAttribute(r,"location")||this._getAttribute(r,"builtin");if(o!==null){const u=this._getTypeInfo(r.type,r.type.attributes),d=this._parseInt(o.value),a=new yv(r.name,u,o.name,d);i.push(a)}}}_getOutputInfo(e){const i=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(i!==null){const r=this._getTypeInfo(e,e.attributes),o=this._parseInt(i.value);return new yv("",r,i.name,o)}return null}_getInputs(e,i=void 0){i===void 0&&(i=[]);for(const r of e)if(r.type instanceof ja)this._getStructInputs(r.type,i);else{const o=this._getInputInfo(r);o!==null&&i.push(o)}return i}_getStructInputs(e,i){for(const r of e.members)if(r.type instanceof ja)this._getStructInputs(r.type,i);else{const o=this._getInputInfo(r);o!==null&&i.push(o)}}_getInputInfo(e){const i=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(i!==null){const r=this._getAttribute(e,"interpolation"),o=this._getTypeInfo(e.type,e.attributes),u=this._parseInt(i.value),d=new LM(e.name,o,i.name,u);return r!==null&&(d.interpolation=this._parseString(r.value)),d}return null}_parseString(e){return e instanceof Array&&(e=e[0]),e}_parseInt(e){e instanceof Array&&(e=e[0]);const i=parseInt(e);return isNaN(i)?e:i}_getAlias(e){for(const i of this.aliases)if(i.name==e)return i.type;return null}_getAliasInfo(e){return new NM(e.name,this._getTypeInfo(e.type,null))}_getTypeInfo(e,i){if(this._types.has(e))return this._types.get(e);if(e instanceof lv){const o=e,u=o.format?this._getTypeInfo(o.format,o.attributes):null,d=new ag(o.name,i);return d.format=u,d.count=o.count,this._types.set(e,d),this._updateTypeInfo(d),d}if(e instanceof ja){const o=e,u=new $d(o.name,i);u.startLine=o.startLine,u.endLine=o.endLine;for(const d of o.members){const a=this._getTypeInfo(d.type,d.attributes);u.members.push(new gv(d.name,a,d.attributes))}return this._types.set(e,u),this._updateTypeInfo(u),u}if(e instanceof kh){const o=e,u=o.format instanceof Va,d=o.format?u?this._getTypeInfo(o.format,null):new Jl(o.format,null):null,a=new mv(o.name,d,i,o.access);return this._types.set(e,a),this._updateTypeInfo(a),a}if(e instanceof av){const o=e,u=o.format?this._getTypeInfo(o.format,null):null,d=new mv(o.name,u,i,o.access);return this._types.set(e,d),this._updateTypeInfo(d),d}const r=new Jl(e.name,i);return this._types.set(e,r),this._updateTypeInfo(r),r}_updateTypeInfo(e){var i,r;const o=this._getTypeSize(e);if(e.size=(i=o==null?void 0:o.size)!==null&&i!==void 0?i:0,e instanceof ag&&e.format){const u=this._getTypeSize(e.format);e.stride=(r=u==null?void 0:u.size)!==null&&r!==void 0?r:0,this._updateTypeInfo(e.format)}e instanceof $d&&this._updateStructInfo(e)}_updateStructInfo(e){var i;let r=0,o=0,u=0,d=0;for(let a=0,x=e.members.length;a<x;++a){const A=e.members[a],M=this._getTypeSize(A);if(!M)continue;(i=this._getAlias(A.type.name))!==null&&i!==void 0||A.type;const D=M.align,N=M.size;r=this._roundUp(D,r+o),o=N,u=r,d=Math.max(d,D),A.offset=r,A.size=N,this._updateTypeInfo(A.type)}e.size=this._roundUp(d,u+o),e.align=d}_getTypeSize(e){var i,r;if(e==null)return null;const o=this._getAttributeNum(e.attributes,"size",0),u=this._getAttributeNum(e.attributes,"align",0);if(e instanceof gv&&(e=e.type),e instanceof Jl){const d=this._getAlias(e.name);d!==null&&(e=d)}{const d=mo._typeInfo[e.name];if(d!==void 0){const a=((i=e.format)===null||i===void 0?void 0:i.name)==="f16"?2:1;return new Xd(Math.max(u,d.align/a),Math.max(o,d.size/a))}}{const d=mo._typeInfo[e.name.substring(0,e.name.length-1)];if(d){const a=e.name[e.name.length-1]==="h"?2:1;return new Xd(Math.max(u,d.align/a),Math.max(o,d.size/a))}}if(e instanceof ag){let d=e,a=8,x=8;const A=this._getTypeSize(d.format);A!==null&&(x=A.size,a=A.align);const M=d.count,D=this._getAttributeNum((r=e==null?void 0:e.attributes)!==null&&r!==void 0?r:null,"stride",this._roundUp(a,x));return x=M*D,o&&(x=o),new Xd(Math.max(u,a),Math.max(o,x))}if(e instanceof $d){let d=0,a=0,x=0,A=0,M=0;for(const D of e.members){const N=this._getTypeSize(D.type);N!==null&&(d=Math.max(N.align,d),x=this._roundUp(N.align,x+A),A=N.size,M=x)}return a=this._roundUp(d,M+A),new Xd(Math.max(u,d),Math.max(o,a))}return null}_isUniformVar(e){return e instanceof za&&e.storage=="uniform"}_isStorageVar(e){return e instanceof za&&e.storage=="storage"}_isTextureVar(e){return e instanceof za&&e.type!==null&&mo._textureTypes.indexOf(e.type.name)!=-1}_isSamplerVar(e){return e instanceof za&&e.type!==null&&mo._samplerTypes.indexOf(e.type.name)!=-1}_getAttribute(e,i){const r=e;if(!r||!r.attributes)return null;const o=r.attributes;for(let u of o)if(u.name==i)return u;return null}_getAttributeNum(e,i,r){if(e===null)return r;for(let o of e)if(o.name==i){let u=o!==null&&o.value!==null?o.value:r;return u instanceof Array&&(u=u[0]),typeof u=="number"?u:typeof u=="string"?parseInt(u):r}return r}_roundUp(e,i){return Math.ceil(i/e)*e}}mo._typeInfo={f16:{align:2,size:2},i32:{align:4,size:4},u32:{align:4,size:4},f32:{align:4,size:4},atomic:{align:4,size:4},vec2:{align:8,size:8},vec3:{align:16,size:12},vec4:{align:16,size:16},mat2x2:{align:8,size:16},mat3x2:{align:8,size:24},mat4x2:{align:8,size:32},mat2x3:{align:16,size:32},mat3x3:{align:16,size:48},mat4x3:{align:16,size:64},mat2x4:{align:16,size:32},mat3x4:{align:16,size:48},mat4x4:{align:16,size:64}},mo._textureTypes=te.any_texture_type.map(t=>t.name),mo._samplerTypes=te.sampler_type.map(t=>t.name);function GM(t){var u;const e={attributes:[],bindings:[]};let i;try{i=$M(t)}catch(d){return Je.error(d.message)(),e}for(const d of i.uniforms){const a=[];for(const x of((u=d.type)==null?void 0:u.members)||[])a.push({name:x.name,type:bv(x.type)});e.bindings.push({type:"uniform",name:d.name,location:d.binding,group:d.group,members:a})}const r=i.entry.vertex[0],o=(r==null?void 0:r.inputs.length)||0;for(let d=0;d<o;d++){const a=r.inputs[d];if(a.locationType==="location"){const x=bv(a.type);e.attributes.push({name:a.name,location:Number(a.location),type:x})}}return e}function bv(t){return t.format?`${t.name}<${t.format.name}>`:t.name}function $M(t){try{return new mo(t)}catch(e){if(e instanceof Error)throw e;let i="WGSL parse error";throw typeof e=="object"&&(e!=null&&e.message)&&(i+=`: ${e.message} `),typeof e=="object"&&(e!=null&&e.token)&&(i+=e.token.line||""),new Error(i,{cause:e})}}const WM={name:"fp32",vs:`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;
const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;
const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;
const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01;
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03;
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04;
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06;
float sin_taylor_fp32(float a) {
float r, s, t, x;
if (a == 0.0) {
return 0.0;
}
x = -a * a;
s = a;
r = a;
r = r * x;
t = r * INVERSE_FACTORIAL_3;
s = s + t;
r = r * x;
t = r * INVERSE_FACTORIAL_5;
s = s + t;
r = r * x;
t = r * INVERSE_FACTORIAL_7;
s = s + t;
r = r * x;
t = r * INVERSE_FACTORIAL_9;
s = s + t;
return s;
}
void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
if (a == 0.0) {
sin_t = 0.0;
cos_t = 1.0;
}
sin_t = sin_taylor_fp32(a);
cos_t = sqrt(1.0 - sin_t * sin_t);
}
float tan_taylor_fp32(float a) {
float sin_a;
float cos_a;
if (a == 0.0) {
return 0.0;
}
float z = floor(a / TWO_PI);
float r = a - TWO_PI * z;
float t;
float q = floor(r / PI_2 + 0.5);
int j = int(q);
if (j < -2 || j > 2) {
return 1.0 / 0.0;
}
t = r - PI_2 * q;
q = floor(t / PI_16 + 0.5);
int k = int(q);
int abs_k = int(abs(float(k)));
if (abs_k > 4) {
return 1.0 / 0.0;
} else {
t = t - PI_16 * q;
}
float u = 0.0;
float v = 0.0;
float sin_t, cos_t;
float s, c;
sincos_taylor_fp32(t, sin_t, cos_t);
if (k == 0) {
s = sin_t;
c = cos_t;
} else {
if (abs(float(abs_k) - 1.0) < 0.5) {
u = COS_TABLE_0;
v = SIN_TABLE_0;
} else if (abs(float(abs_k) - 2.0) < 0.5) {
u = COS_TABLE_1;
v = SIN_TABLE_1;
} else if (abs(float(abs_k) - 3.0) < 0.5) {
u = COS_TABLE_2;
v = SIN_TABLE_2;
} else if (abs(float(abs_k) - 4.0) < 0.5) {
u = COS_TABLE_3;
v = SIN_TABLE_3;
}
if (k > 0) {
s = u * sin_t + v * cos_t;
c = u * cos_t - v * sin_t;
} else {
s = u * sin_t - v * cos_t;
c = u * cos_t + v * sin_t;
}
}
if (j == 0) {
sin_a = s;
cos_a = c;
} else if (j == 1) {
sin_a = c;
cos_a = -s;
} else if (j == -1) {
sin_a = -c;
cos_a = s;
} else {
sin_a = -s;
cos_a = -c;
}
return sin_a / cos_a;
}
#endif
float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
return tan_taylor_fp32(a);
#else
return tan(a);
#endif
}
`},vv={name:"picking",vs:`uniform pickingUniforms {
float isActive;
float isAttribute;
float isHighlightActive;
float useFloatColors;
vec3 highlightedObjectColor;
vec4 highlightColor;
} picking;
out vec4 picking_vRGBcolor_Avalid;
vec3 picking_normalizeColor(vec3 color) {
return picking.useFloatColors > 0.5 ? color : color / 255.0;
}
vec4 picking_normalizeColor(vec4 color) {
return picking.useFloatColors > 0.5 ? color : color / 255.0;
}
bool picking_isColorZero(vec3 color) {
return dot(color, vec3(1.0)) < 0.00001;
}
bool picking_isColorValid(vec3 color) {
return dot(color, vec3(1.0)) > 0.00001;
}
bool isVertexHighlighted(vec3 vertexColor) {
vec3 highlightedObjectColor = picking_normalizeColor(picking.highlightedObjectColor);
return
bool(picking.isHighlightActive) && picking_isColorZero(abs(vertexColor - highlightedObjectColor));
}
void picking_setPickingColor(vec3 pickingColor) {
pickingColor = picking_normalizeColor(pickingColor);
if (bool(picking.isActive)) {
picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));
if (!bool(picking.isAttribute)) {
picking_vRGBcolor_Avalid.rgb = pickingColor;
}
} else {
picking_vRGBcolor_Avalid.a = float(isVertexHighlighted(pickingColor));
}
}
void picking_setPickingAttribute(float value) {
if (bool(picking.isAttribute)) {
picking_vRGBcolor_Avalid.r = value;
}
}
void picking_setPickingAttribute(vec2 value) {
if (bool(picking.isAttribute)) {
picking_vRGBcolor_Avalid.rg = value;
}
}
void picking_setPickingAttribute(vec3 value) {
if (bool(picking.isAttribute)) {
picking_vRGBcolor_Avalid.rgb = value;
}
}
`,fs:`uniform pickingUniforms {
float isActive;
float isAttribute;
float isHighlightActive;
float useFloatColors;
vec3 highlightedObjectColor;
vec4 highlightColor;
} picking;
in vec4 picking_vRGBcolor_Avalid;
vec4 picking_filterHighlightColor(vec4 color) {
if (picking.isActive > 0.5) {
return color;
}
bool selected = bool(picking_vRGBcolor_Avalid.a);
if (selected) {
float highLightAlpha = picking.highlightColor.a;
float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
float highLightRatio = highLightAlpha / blendedAlpha;
vec3 blendedRGB = mix(color.rgb, picking.highlightColor.rgb, highLightRatio);
return vec4(blendedRGB, blendedAlpha);
} else {
return color;
}
}
vec4 picking_filterPickingColor(vec4 color) {
if (bool(picking.isActive)) {
if (picking_vRGBcolor_Avalid.a == 0.0) {
discard;
}
return picking_vRGBcolor_Avalid;
}
return color;
}
vec4 picking_filterColor(vec4 color) {
vec4 highlightColor = picking_filterHighlightColor(color);
return picking_filterPickingColor(highlightColor);
}
`,uniformTypes:{isActive:"f32",isAttribute:"f32",isHighlightActive:"f32",useFloatColors:"f32",highlightedObjectColor:"vec3<f32>",highlightColor:"vec4<f32>"},defaultUniforms:{isActive:!1,isAttribute:!1,isHighlightActive:!1,useFloatColors:!0,highlightedObjectColor:[0,0,0],highlightColor:[0,1,1,1]},getUniforms:XM};function XM(t={},e){const i={};if(t.highlightedObjectColor!==void 0)if(t.highlightedObjectColor===null)i.isHighlightActive=!1;else{i.isHighlightActive=!0;const r=t.highlightedObjectColor.slice(0,3);i.highlightedObjectColor=r}if(t.highlightColor){const r=Array.from(t.highlightColor,o=>o/255);Number.isFinite(r[3])||(r[3]=1),i.highlightColor=r}return t.isActive!==void 0&&(i.isActive=!!t.isActive,i.isAttribute=!!t.isAttribute),t.useFloatColors!==void 0&&(i.useFloatColors=!!t.useFloatColors),i}function xv(t,e=[],i=0){const r=Math.fround(t),o=t-r;return e[i]=r,e[i+1]=o,e}function qM(t){return t-Math.fround(t)}function ZM(t){const e=new Float32Array(32);for(let i=0;i<4;++i)for(let r=0;r<4;++r){const o=i*4+r;xv(t[r*4+i],e,o*2)}return e}const KM=`uniform float ONE;
vec2 split(float a) {
const float SPLIT = 4097.0;
float t = a * SPLIT;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
float a_hi = t * ONE - (t - a);
float a_lo = a * ONE - a_hi;
#else
float a_hi = t - (t - a);
float a_lo = a - a_hi;
#endif
return vec2(a_hi, a_lo);
}
vec2 split2(vec2 a) {
vec2 b = split(a.x);
b.y += a.y;
return b;
}
vec2 quickTwoSum(float a, float b) {
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
float sum = (a + b) * ONE;
float err = b - (sum - a) * ONE;
#else
float sum = a + b;
float err = b - (sum - a);
#endif
return vec2(sum, err);
}
vec2 twoSum(float a, float b) {
float s = (a + b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
float v = (s * ONE - a) * ONE;
float err = (a - (s - v) * ONE) * ONE * ONE * ONE + (b - v);
#else
float v = s - a;
float err = (a - (s - v)) + (b - v);
#endif
return vec2(s, err);
}
vec2 twoSub(float a, float b) {
float s = (a - b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
float v = (s * ONE - a) * ONE;
float err = (a - (s - v) * ONE) * ONE * ONE * ONE - (b + v);
#else
float v = s - a;
float err = (a - (s - v)) - (b + v);
#endif
return vec2(s, err);
}
vec2 twoSqr(float a) {
float prod = a * a;
vec2 a_fp64 = split(a);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
float err = ((a_fp64.x * a_fp64.x - prod) * ONE + 2.0 * a_fp64.x *
a_fp64.y * ONE * ONE) + a_fp64.y * a_fp64.y * ONE * ONE * ONE;
#else
float err = ((a_fp64.x * a_fp64.x - prod) + 2.0 * a_fp64.x * a_fp64.y) + a_fp64.y * a_fp64.y;
#endif
return vec2(prod, err);
}
vec2 twoProd(float a, float b) {
float prod = a * b;
vec2 a_fp64 = split(a);
vec2 b_fp64 = split(b);
float err = ((a_fp64.x * b_fp64.x - prod) + a_fp64.x * b_fp64.y +
a_fp64.y * b_fp64.x) + a_fp64.y * b_fp64.y;
return vec2(prod, err);
}
vec2 sum_fp64(vec2 a, vec2 b) {
vec2 s, t;
s = twoSum(a.x, b.x);
t = twoSum(a.y, b.y);
s.y += t.x;
s = quickTwoSum(s.x, s.y);
s.y += t.y;
s = quickTwoSum(s.x, s.y);
return s;
}
vec2 sub_fp64(vec2 a, vec2 b) {
vec2 s, t;
s = twoSub(a.x, b.x);
t = twoSub(a.y, b.y);
s.y += t.x;
s = quickTwoSum(s.x, s.y);
s.y += t.y;
s = quickTwoSum(s.x, s.y);
return s;
}
vec2 mul_fp64(vec2 a, vec2 b) {
vec2 prod = twoProd(a.x, b.x);
prod.y += a.x * b.y;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
prod = split2(prod);
#endif
prod = quickTwoSum(prod.x, prod.y);
prod.y += a.y * b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
prod = split2(prod);
#endif
prod = quickTwoSum(prod.x, prod.y);
return prod;
}
vec2 div_fp64(vec2 a, vec2 b) {
float xn = 1.0 / b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
vec2 yn = mul_fp64(a, vec2(xn, 0));
#else
vec2 yn = a * xn;
#endif
float diff = (sub_fp64(a, mul_fp64(b, yn))).x;
vec2 prod = twoProd(xn, diff);
return sum_fp64(yn, prod);
}
vec2 sqrt_fp64(vec2 a) {
if (a.x == 0.0 && a.y == 0.0) return vec2(0.0, 0.0);
if (a.x < 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);
float x = 1.0 / sqrt(a.x);
float yn = a.x * x;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
vec2 yn_sqr = twoSqr(yn) * ONE;
#else
vec2 yn_sqr = twoSqr(yn);
#endif
float diff = sub_fp64(a, yn_sqr).x;
vec2 prod = twoProd(x * 0.5, diff);
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
return sum_fp64(split(yn), prod);
#else
return sum_fp64(vec2(yn, 0.0), prod);
#endif
}
`,YM={ONE:1};function JM(){return YM}const QM={name:"fp64-arithmetic",vs:KM,getUniforms:JM,fp64ify:xv,fp64LowPart:qM,fp64ifyMatrix4:ZM},eR=1/Math.PI*180,tR=1/180*Math.PI,iR={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1};globalThis.mathgl=globalThis.mathgl||{config:{...iR}};const mr=globalThis.mathgl.config;function rR(t,{precision:e=mr.precision}={}){return t=aR(t),`${parseFloat(t.toPrecision(e))}`}function qo(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}function sR(t){return oR(t)}function nR(t){return mn(t)}function oR(t,e){return lg(t,i=>i*tR,e)}function mn(t,e){return lg(t,i=>i*eR,e)}function yo(t,e,i){return lg(t,r=>Math.max(e,Math.min(i,r)))}function qd(t,e,i){return qo(t)?t.map((r,o)=>qd(r,e[o],i)):i*e+(1-i)*t}function yn(t,e,i){const r=mr.EPSILON;i&&(mr.EPSILON=i);try{if(t===e)return!0;if(qo(t)&&qo(e)){if(t.length!==e.length)return!1;for(let o=0;o<t.length;++o)if(!yn(t[o],e[o]))return!1;return!0}return t&&t.equals?t.equals(e):e&&e.equals?e.equals(t):typeof t=="number"&&typeof e=="number"?Math.abs(t-e)<=mr.EPSILON*Math.max(1,Math.abs(t),Math.abs(e)):!1}finally{mr.EPSILON=r}}function aR(t){return Math.round(t/mr.EPSILON)*mr.EPSILON}function lR(t){return t.clone?t.clone():new Array(t.length)}function lg(t,e,i){if(qo(t)){const r=t;i=i||lR(r);for(let o=0;o<i.length&&o<r.length;++o){const u=typeof t=="number"?t:t[o];i[o]=e(u,o,i)}return i}return e(t)}class cg extends Array{clone(){return new this.constructor().copy(this)}fromArray(e,i=0){for(let r=0;r<this.ELEMENTS;++r)this[r]=e[r+i];return this.check()}toArray(e=[],i=0){for(let r=0;r<this.ELEMENTS;++r)e[i+r]=this[r];return e}toObject(e){return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:qo(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(mr)}formatString(e){let i="";for(let r=0;r<this.ELEMENTS;++r)i+=(r>0?", ":"")+rR(this[r],e);return`${e.printTypes?this.constructor.name:""}[${i}]`}equals(e){if(!e||this.length!==e.length)return!1;for(let i=0;i<this.ELEMENTS;++i)if(!yn(this[i],e[i]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let i=0;i<this.ELEMENTS;++i)if(this[i]!==e[i])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,i,r){if(r===void 0)return this.lerp(this,e,i);for(let o=0;o<this.ELEMENTS;++o){const u=e[o],d=typeof i=="number"?i:i[o];this[o]=u+r*(d-u)}return this.check()}min(e){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.min(e[i],this[i]);return this.check()}max(e){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.max(e[i],this[i]);return this.check()}clamp(e,i){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],e[r]),i[r]);return this.check()}add(...e){for(const i of e)for(let r=0;r<this.ELEMENTS;++r)this[r]+=i[r];return this.check()}subtract(...e){for(const i of e)for(let r=0;r<this.ELEMENTS;++r)this[r]-=i[r];return this.check()}scale(e){if(typeof e=="number")for(let i=0;i<this.ELEMENTS;++i)this[i]*=e;else for(let i=0;i<this.ELEMENTS&&i<e.length;++i)this[i]*=e[i];return this.check()}multiplyByScalar(e){for(let i=0;i<this.ELEMENTS;++i)this[i]*=e;return this.check()}check(){if(mr.debug&&!this.validate())throw new Error(`math.gl: ${this.constructor.name} some fields set to invalid numbers'`);return this}validate(){let e=this.length===this.ELEMENTS;for(let i=0;i<this.ELEMENTS;++i)e=e&&Number.isFinite(this[i]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let i=0;i<this.ELEMENTS;++i)this[i]=e;return this.check()}addScalar(e){for(let i=0;i<this.ELEMENTS;++i)this[i]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let i=0;i<this.ELEMENTS;++i)this[i]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,i){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],e),i);return this.check()}get elements(){return this}}function cR(t,e){if(t.length!==e)return!1;for(let i=0;i<t.length;++i)if(!Number.isFinite(t[i]))return!1;return!0}function ii(t){if(!Number.isFinite(t))throw new Error(`Invalid number ${JSON.stringify(t)}`);return t}function Nh(t,e,i=""){if(mr.debug&&!cR(t,e))throw new Error(`math.gl: ${i} some fields set to invalid numbers'`);return t}function bn(t,e){if(!t)throw new Error(`math.gl assertion ${e}`)}class hg extends cg{get x(){return this[0]}set x(e){this[0]=ii(e)}get y(){return this[1]}set y(e){this[1]=ii(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let i=0;i<this.ELEMENTS;++i)e+=this[i]*this[i];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let i=0;for(let r=0;r<this.ELEMENTS;++r){const o=this[r]-e[r];i+=o*o}return ii(i)}dot(e){let i=0;for(let r=0;r<this.ELEMENTS;++r)i+=this[r]*e[r];return ii(i)}normalize(){const e=this.magnitude();if(e!==0)for(let i=0;i<this.ELEMENTS;++i)this[i]/=e;return this.check()}multiply(...e){for(const i of e)for(let r=0;r<this.ELEMENTS;++r)this[r]*=i[r];return this.check()}divide(...e){for(const i of e)for(let r=0;r<this.ELEMENTS;++r)this[r]/=i[r];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return bn(e>=0&&e<this.ELEMENTS,"index is out of range"),ii(this[e])}setComponent(e,i){return bn(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=i,this.check()}addVectors(e,i){return this.copy(e).add(i)}subVectors(e,i){return this.copy(e).subtract(i)}multiplyVectors(e,i){return this.copy(e).multiply(i)}addScaledVector(e,i){return this.add(new this.constructor(e).multiplyScalar(i))}}const Lh=1e-6;let vn=typeof Float32Array<"u"?Float32Array:Array;function hR(){const t=new vn(2);return vn!=Float32Array&&(t[0]=0,t[1]=0),t}function wv(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t}function uR(t,e){return t[0]=-e[0],t[1]=-e[1],t}function Tv(t,e,i,r){const o=e[0],u=e[1];return t[0]=o+r*(i[0]-o),t[1]=u+r*(i[1]-u),t}function dR(t,e,i){const r=e[0],o=e[1];return t[0]=i[0]*r+i[2]*o,t[1]=i[1]*r+i[3]*o,t}function fR(t,e,i){const r=e[0],o=e[1];return t[0]=i[0]*r+i[2]*o+i[4],t[1]=i[1]*r+i[3]*o+i[5],t}function Av(t,e,i){const r=e[0],o=e[1];return t[0]=i[0]*r+i[3]*o+i[6],t[1]=i[1]*r+i[4]*o+i[7],t}function Ev(t,e,i){const r=e[0],o=e[1];return t[0]=i[0]*r+i[4]*o+i[12],t[1]=i[1]*r+i[5]*o+i[13],t}(function(){const t=hR();return function(e,i,r,o,u,d){let a,x;for(i||(i=2),r||(r=0),o?x=Math.min(o*i+r,e.length):x=e.length,a=r;a<x;a+=i)t[0]=e[a],t[1]=e[a+1],u(t,t,d),e[a]=t[0],e[a+1]=t[1];return e}})();function Sv(t,e,i){const r=e[0],o=e[1],u=i[3]*r+i[7]*o||1;return t[0]=(i[0]*r+i[4]*o)/u,t[1]=(i[1]*r+i[5]*o)/u,t}function Cv(t,e,i){const r=e[0],o=e[1],u=e[2],d=i[3]*r+i[7]*o+i[11]*u||1;return t[0]=(i[0]*r+i[4]*o+i[8]*u)/d,t[1]=(i[1]*r+i[5]*o+i[9]*u)/d,t[2]=(i[2]*r+i[6]*o+i[10]*u)/d,t}function pR(t,e,i){const r=e[0],o=e[1];return t[0]=i[0]*r+i[2]*o,t[1]=i[1]*r+i[3]*o,t[2]=e[2],t}function _R(t,e,i){const r=e[0],o=e[1];return t[0]=i[0]*r+i[2]*o,t[1]=i[1]*r+i[3]*o,t[2]=e[2],t[3]=e[3],t}function Iv(t,e,i){const r=e[0],o=e[1],u=e[2];return t[0]=i[0]*r+i[3]*o+i[6]*u,t[1]=i[1]*r+i[4]*o+i[7]*u,t[2]=i[2]*r+i[5]*o+i[8]*u,t[3]=e[3],t}class ug extends hg{constructor(e=0,i=0){super(2),qo(e)&&arguments.length===1?this.copy(e):(mr.debug&&(ii(e),ii(i)),this[0]=e,this[1]=i)}set(e,i){return this[0]=e,this[1]=i,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this.check()}fromObject(e){return mr.debug&&(ii(e.x),ii(e.y)),this[0]=e.x,this[1]=e.y,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e}get ELEMENTS(){return 2}horizontalAngle(){return Math.atan2(this.y,this.x)}verticalAngle(){return Math.atan2(this.x,this.y)}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return Ev(this,this,e),this.check()}transformAsVector(e){return Sv(this,this,e),this.check()}transformByMatrix3(e){return Av(this,this,e),this.check()}transformByMatrix2x3(e){return fR(this,this,e),this.check()}transformByMatrix2(e){return dR(this,this,e),this.check()}}function Mv(){const t=new vn(3);return vn!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function Rv(t){const e=t[0],i=t[1],r=t[2];return Math.sqrt(e*e+i*i+r*r)}function Pv(t,e,i){const r=new vn(3);return r[0]=t,r[1]=e,r[2]=i,r}function gR(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t}function mR(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function yR(t,e){const i=e[0],r=e[1],o=e[2];let u=i*i+r*r+o*o;return u>0&&(u=1/Math.sqrt(u)),t[0]=e[0]*u,t[1]=e[1]*u,t[2]=e[2]*u,t}function dg(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function Zd(t,e,i){const r=e[0],o=e[1],u=e[2],d=i[0],a=i[1],x=i[2];return t[0]=o*x-u*a,t[1]=u*d-r*x,t[2]=r*a-o*d,t}function fg(t,e,i){const r=e[0],o=e[1],u=e[2];let d=i[3]*r+i[7]*o+i[11]*u+i[15];return d=d||1,t[0]=(i[0]*r+i[4]*o+i[8]*u+i[12])/d,t[1]=(i[1]*r+i[5]*o+i[9]*u+i[13])/d,t[2]=(i[2]*r+i[6]*o+i[10]*u+i[14])/d,t}function Bv(t,e,i){const r=e[0],o=e[1],u=e[2];return t[0]=r*i[0]+o*i[3]+u*i[6],t[1]=r*i[1]+o*i[4]+u*i[7],t[2]=r*i[2]+o*i[5]+u*i[8],t}function Dv(t,e,i){const r=i[0],o=i[1],u=i[2],d=i[3],a=e[0],x=e[1],A=e[2];let M=o*A-u*x,D=u*a-r*A,N=r*x-o*a,U=o*N-u*D,re=u*M-r*N,ne=r*D-o*M;const xe=d*2;return M*=xe,D*=xe,N*=xe,U*=2,re*=2,ne*=2,t[0]=a+M+U,t[1]=x+D+re,t[2]=A+N+ne,t}function bR(t,e,i,r){const o=[],u=[];return o[0]=e[0]-i[0],o[1]=e[1]-i[1],o[2]=e[2]-i[2],u[0]=o[0],u[1]=o[1]*Math.cos(r)-o[2]*Math.sin(r),u[2]=o[1]*Math.sin(r)+o[2]*Math.cos(r),t[0]=u[0]+i[0],t[1]=u[1]+i[1],t[2]=u[2]+i[2],t}function vR(t,e,i,r){const o=[],u=[];return o[0]=e[0]-i[0],o[1]=e[1]-i[1],o[2]=e[2]-i[2],u[0]=o[2]*Math.sin(r)+o[0]*Math.cos(r),u[1]=o[1],u[2]=o[2]*Math.cos(r)-o[0]*Math.sin(r),t[0]=u[0]+i[0],t[1]=u[1]+i[1],t[2]=u[2]+i[2],t}function xR(t,e,i,r){const o=[],u=[];return o[0]=e[0]-i[0],o[1]=e[1]-i[1],o[2]=e[2]-i[2],u[0]=o[0]*Math.cos(r)-o[1]*Math.sin(r),u[1]=o[0]*Math.sin(r)+o[1]*Math.cos(r),u[2]=o[2],t[0]=u[0]+i[0],t[1]=u[1]+i[1],t[2]=u[2]+i[2],t}function wR(t,e){const i=t[0],r=t[1],o=t[2],u=e[0],d=e[1],a=e[2],x=Math.sqrt((i*i+r*r+o*o)*(u*u+d*d+a*a)),A=x&&dg(t,e)/x;return Math.acos(Math.min(Math.max(A,-1),1))}const TR=gR,AR=Rv;(function(){const t=Mv();return function(e,i,r,o,u,d){let a,x;for(i||(i=3),r||(r=0),o?x=Math.min(o*i+r,e.length):x=e.length,a=r;a<x;a+=i)t[0]=e[a],t[1]=e[a+1],t[2]=e[a+2],u(t,t,d),e[a]=t[0],e[a+1]=t[1],e[a+2]=t[2];return e}})();const pg=[0,0,0];let Kd;class De extends hg{static get ZERO(){return Kd||(Kd=new De(0,0,0),Object.freeze(Kd)),Kd}constructor(e=0,i=0,r=0){super(-0,-0,-0),arguments.length===1&&qo(e)?this.copy(e):(mr.debug&&(ii(e),ii(i),ii(r)),this[0]=e,this[1]=i,this[2]=r)}set(e,i,r){return this[0]=e,this[1]=i,this[2]=r,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return mr.debug&&(ii(e.x),ii(e.y),ii(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=ii(e)}angle(e){return wR(this,e)}cross(e){return Zd(this,this,e),this.check()}rotateX({radians:e,origin:i=pg}){return bR(this,this,i,e),this.check()}rotateY({radians:e,origin:i=pg}){return vR(this,this,i,e),this.check()}rotateZ({radians:e,origin:i=pg}){return xR(this,this,i,e),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return fg(this,this,e),this.check()}transformAsVector(e){return Cv(this,this,e),this.check()}transformByMatrix3(e){return Bv(this,this,e),this.check()}transformByMatrix2(e){return pR(this,this,e),this.check()}transformByQuaternion(e){return Dv(this,this,e),this.check()}}let Yd;class _g extends hg{static get ZERO(){return Yd||(Yd=new _g(0,0,0,0),Object.freeze(Yd)),Yd}constructor(e=0,i=0,r=0,o=0){super(-0,-0,-0,-0),qo(e)&&arguments.length===1?this.copy(e):(mr.debug&&(ii(e),ii(i),ii(r),ii(o)),this[0]=e,this[1]=i,this[2]=r,this[3]=o)}set(e,i,r,o){return this[0]=e,this[1]=i,this[2]=r,this[3]=o,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}fromObject(e){return mr.debug&&(ii(e.x),ii(e.y),ii(e.z),ii(e.w)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this[3]=e.w,this}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e.w=this[3],e}get ELEMENTS(){return 4}get z(){return this[2]}set z(e){this[2]=ii(e)}get w(){return this[3]}set w(e){this[3]=ii(e)}transform(e){return fg(this,this,e),this.check()}transformByMatrix3(e){return Iv(this,this,e),this.check()}transformByMatrix2(e){return _R(this,this,e),this.check()}transformByQuaternion(e){return Dv(this,this,e),this.check()}applyMatrix4(e){return e.transform(this,this),this}}class Ov extends cg{toString(){let e="[";if(mr.printRowMajor){e+="row-major:";for(let i=0;i<this.RANK;++i)for(let r=0;r<this.RANK;++r)e+=` ${this[r*this.RANK+i]}`}else{e+="column-major:";for(let i=0;i<this.ELEMENTS;++i)e+=` ${this[i]}`}return e+="]",e}getElementIndex(e,i){return i*this.RANK+e}getElement(e,i){return this[i*this.RANK+e]}setElement(e,i,r){return this[i*this.RANK+e]=ii(r),this}getColumn(e,i=new Array(this.RANK).fill(-0)){const r=e*this.RANK;for(let o=0;o<this.RANK;++o)i[o]=this[r+o];return i}setColumn(e,i){const r=e*this.RANK;for(let o=0;o<this.RANK;++o)this[r+o]=i[o];return this}}function ER(){const t=new vn(9);return vn!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function SR(t,e){if(t===e){const i=e[1],r=e[2],o=e[5];t[1]=e[3],t[2]=e[6],t[3]=i,t[5]=e[7],t[6]=r,t[7]=o}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}function CR(t,e){const i=e[0],r=e[1],o=e[2],u=e[3],d=e[4],a=e[5],x=e[6],A=e[7],M=e[8],D=M*d-a*A,N=-M*u+a*x,U=A*u-d*x;let re=i*D+r*N+o*U;return re?(re=1/re,t[0]=D*re,t[1]=(-M*r+o*A)*re,t[2]=(a*r-o*d)*re,t[3]=N*re,t[4]=(M*i-o*x)*re,t[5]=(-a*i+o*u)*re,t[6]=U*re,t[7]=(-A*i+r*x)*re,t[8]=(d*i-r*u)*re,t):null}function IR(t){const e=t[0],i=t[1],r=t[2],o=t[3],u=t[4],d=t[5],a=t[6],x=t[7],A=t[8];return e*(A*u-d*x)+i*(-A*o+d*a)+r*(x*o-u*a)}function Fv(t,e,i){const r=e[0],o=e[1],u=e[2],d=e[3],a=e[4],x=e[5],A=e[6],M=e[7],D=e[8],N=i[0],U=i[1],re=i[2],ne=i[3],xe=i[4],Ae=i[5],Te=i[6],Ie=i[7],Ue=i[8];return t[0]=N*r+U*d+re*A,t[1]=N*o+U*a+re*M,t[2]=N*u+U*x+re*D,t[3]=ne*r+xe*d+Ae*A,t[4]=ne*o+xe*a+Ae*M,t[5]=ne*u+xe*x+Ae*D,t[6]=Te*r+Ie*d+Ue*A,t[7]=Te*o+Ie*a+Ue*M,t[8]=Te*u+Ie*x+Ue*D,t}function MR(t,e,i){const r=e[0],o=e[1],u=e[2],d=e[3],a=e[4],x=e[5],A=e[6],M=e[7],D=e[8],N=i[0],U=i[1];return t[0]=r,t[1]=o,t[2]=u,t[3]=d,t[4]=a,t[5]=x,t[6]=N*r+U*d+A,t[7]=N*o+U*a+M,t[8]=N*u+U*x+D,t}function RR(t,e,i){const r=e[0],o=e[1],u=e[2],d=e[3],a=e[4],x=e[5],A=e[6],M=e[7],D=e[8],N=Math.sin(i),U=Math.cos(i);return t[0]=U*r+N*d,t[1]=U*o+N*a,t[2]=U*u+N*x,t[3]=U*d-N*r,t[4]=U*a-N*o,t[5]=U*x-N*u,t[6]=A,t[7]=M,t[8]=D,t}function kv(t,e,i){const r=i[0],o=i[1];return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=o*e[3],t[4]=o*e[4],t[5]=o*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function PR(t,e){const i=e[0],r=e[1],o=e[2],u=e[3],d=i+i,a=r+r,x=o+o,A=i*d,M=r*d,D=r*a,N=o*d,U=o*a,re=o*x,ne=u*d,xe=u*a,Ae=u*x;return t[0]=1-D-re,t[3]=M-Ae,t[6]=N+xe,t[1]=M+Ae,t[4]=1-A-re,t[7]=U-ne,t[2]=N-xe,t[5]=U+ne,t[8]=1-A-D,t}var gg;(function(t){t[t.COL0ROW0=0]="COL0ROW0",t[t.COL0ROW1=1]="COL0ROW1",t[t.COL0ROW2=2]="COL0ROW2",t[t.COL1ROW0=3]="COL1ROW0",t[t.COL1ROW1=4]="COL1ROW1",t[t.COL1ROW2=5]="COL1ROW2",t[t.COL2ROW0=6]="COL2ROW0",t[t.COL2ROW1=7]="COL2ROW1",t[t.COL2ROW2=8]="COL2ROW2"})(gg||(gg={}));const BR=Object.freeze([1,0,0,0,1,0,0,0,1]);class Hi extends Ov{static get IDENTITY(){return OR()}static get ZERO(){return DR()}get ELEMENTS(){return 9}get RANK(){return 3}get INDICES(){return gg}constructor(e,...i){super(-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):i.length>0?this.copy([e,...i]):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this.check()}identity(){return this.copy(BR)}fromObject(e){return this.check()}fromQuaternion(e){return PR(this,e),this.check()}set(e,i,r,o,u,d,a,x,A){return this[0]=e,this[1]=i,this[2]=r,this[3]=o,this[4]=u,this[5]=d,this[6]=a,this[7]=x,this[8]=A,this.check()}setRowMajor(e,i,r,o,u,d,a,x,A){return this[0]=e,this[1]=o,this[2]=a,this[3]=i,this[4]=u,this[5]=x,this[6]=r,this[7]=d,this[8]=A,this.check()}determinant(){return IR(this)}transpose(){return SR(this,this),this.check()}invert(){return CR(this,this),this.check()}multiplyLeft(e){return Fv(this,e,this),this.check()}multiplyRight(e){return Fv(this,this,e),this.check()}rotate(e){return RR(this,this,e),this.check()}scale(e){return Array.isArray(e)?kv(this,this,e):kv(this,this,[e,e]),this.check()}translate(e){return MR(this,this,e),this.check()}transform(e,i){let r;switch(e.length){case 2:r=Av(i||[-0,-0],e,this);break;case 3:r=Bv(i||[-0,-0,-0],e,this);break;case 4:r=Iv(i||[-0,-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Nh(r,e.length),r}transformVector(e,i){return this.transform(e,i)}transformVector2(e,i){return this.transform(e,i)}transformVector3(e,i){return this.transform(e,i)}}let Jd,Qd=null;function DR(){return Jd||(Jd=new Hi([0,0,0,0,0,0,0,0,0]),Object.freeze(Jd)),Jd}function OR(){return Qd||(Qd=new Hi,Object.freeze(Qd)),Qd}function FR(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function kR(t,e){if(t===e){const i=e[1],r=e[2],o=e[3],u=e[6],d=e[7],a=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=i,t[6]=e[9],t[7]=e[13],t[8]=r,t[9]=u,t[11]=e[14],t[12]=o,t[13]=d,t[14]=a}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function mg(t,e){const i=e[0],r=e[1],o=e[2],u=e[3],d=e[4],a=e[5],x=e[6],A=e[7],M=e[8],D=e[9],N=e[10],U=e[11],re=e[12],ne=e[13],xe=e[14],Ae=e[15],Te=i*a-r*d,Ie=i*x-o*d,Ue=i*A-u*d,Xe=r*x-o*a,qe=r*A-u*a,ht=o*A-u*x,gt=M*ne-D*re,nt=M*xe-N*re,at=M*Ae-U*re,bt=D*xe-N*ne,kt=D*Ae-U*ne,Ht=N*Ae-U*xe;let St=Te*Ht-Ie*kt+Ue*bt+Xe*at-qe*nt+ht*gt;return St?(St=1/St,t[0]=(a*Ht-x*kt+A*bt)*St,t[1]=(o*kt-r*Ht-u*bt)*St,t[2]=(ne*ht-xe*qe+Ae*Xe)*St,t[3]=(N*qe-D*ht-U*Xe)*St,t[4]=(x*at-d*Ht-A*nt)*St,t[5]=(i*Ht-o*at+u*nt)*St,t[6]=(xe*Ue-re*ht-Ae*Ie)*St,t[7]=(M*ht-N*Ue+U*Ie)*St,t[8]=(d*kt-a*at+A*gt)*St,t[9]=(r*at-i*kt-u*gt)*St,t[10]=(re*qe-ne*Ue+Ae*Te)*St,t[11]=(D*Ue-M*qe-U*Te)*St,t[12]=(a*nt-d*bt-x*gt)*St,t[13]=(i*bt-r*nt+o*gt)*St,t[14]=(ne*Ie-re*Xe-xe*Te)*St,t[15]=(M*Xe-D*Ie+N*Te)*St,t):null}function NR(t){const e=t[0],i=t[1],r=t[2],o=t[3],u=t[4],d=t[5],a=t[6],x=t[7],A=t[8],M=t[9],D=t[10],N=t[11],U=t[12],re=t[13],ne=t[14],xe=t[15],Ae=e*d-i*u,Te=e*a-r*u,Ie=i*a-r*d,Ue=A*re-M*U,Xe=A*ne-D*U,qe=M*ne-D*re,ht=e*qe-i*Xe+r*Ue,gt=u*qe-d*Xe+a*Ue,nt=A*Ie-M*Te+D*Ae,at=U*Ie-re*Te+ne*Ae;return x*ht-o*gt+xe*nt-N*at}function Ha(t,e,i){const r=e[0],o=e[1],u=e[2],d=e[3],a=e[4],x=e[5],A=e[6],M=e[7],D=e[8],N=e[9],U=e[10],re=e[11],ne=e[12],xe=e[13],Ae=e[14],Te=e[15];let Ie=i[0],Ue=i[1],Xe=i[2],qe=i[3];return t[0]=Ie*r+Ue*a+Xe*D+qe*ne,t[1]=Ie*o+Ue*x+Xe*N+qe*xe,t[2]=Ie*u+Ue*A+Xe*U+qe*Ae,t[3]=Ie*d+Ue*M+Xe*re+qe*Te,Ie=i[4],Ue=i[5],Xe=i[6],qe=i[7],t[4]=Ie*r+Ue*a+Xe*D+qe*ne,t[5]=Ie*o+Ue*x+Xe*N+qe*xe,t[6]=Ie*u+Ue*A+Xe*U+qe*Ae,t[7]=Ie*d+Ue*M+Xe*re+qe*Te,Ie=i[8],Ue=i[9],Xe=i[10],qe=i[11],t[8]=Ie*r+Ue*a+Xe*D+qe*ne,t[9]=Ie*o+Ue*x+Xe*N+qe*xe,t[10]=Ie*u+Ue*A+Xe*U+qe*Ae,t[11]=Ie*d+Ue*M+Xe*re+qe*Te,Ie=i[12],Ue=i[13],Xe=i[14],qe=i[15],t[12]=Ie*r+Ue*a+Xe*D+qe*ne,t[13]=Ie*o+Ue*x+Xe*N+qe*xe,t[14]=Ie*u+Ue*A+Xe*U+qe*Ae,t[15]=Ie*d+Ue*M+Xe*re+qe*Te,t}function ef(t,e,i){const r=i[0],o=i[1],u=i[2];let d,a,x,A,M,D,N,U,re,ne,xe,Ae;return e===t?(t[12]=e[0]*r+e[4]*o+e[8]*u+e[12],t[13]=e[1]*r+e[5]*o+e[9]*u+e[13],t[14]=e[2]*r+e[6]*o+e[10]*u+e[14],t[15]=e[3]*r+e[7]*o+e[11]*u+e[15]):(d=e[0],a=e[1],x=e[2],A=e[3],M=e[4],D=e[5],N=e[6],U=e[7],re=e[8],ne=e[9],xe=e[10],Ae=e[11],t[0]=d,t[1]=a,t[2]=x,t[3]=A,t[4]=M,t[5]=D,t[6]=N,t[7]=U,t[8]=re,t[9]=ne,t[10]=xe,t[11]=Ae,t[12]=d*r+M*o+re*u+e[12],t[13]=a*r+D*o+ne*u+e[13],t[14]=x*r+N*o+xe*u+e[14],t[15]=A*r+U*o+Ae*u+e[15]),t}function yg(t,e,i){const r=i[0],o=i[1],u=i[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*o,t[5]=e[5]*o,t[6]=e[6]*o,t[7]=e[7]*o,t[8]=e[8]*u,t[9]=e[9]*u,t[10]=e[10]*u,t[11]=e[11]*u,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function LR(t,e,i,r){let o=r[0],u=r[1],d=r[2],a=Math.sqrt(o*o+u*u+d*d),x,A,M,D,N,U,re,ne,xe,Ae,Te,Ie,Ue,Xe,qe,ht,gt,nt,at,bt,kt,Ht,St,xi;return a<Lh?null:(a=1/a,o*=a,u*=a,d*=a,A=Math.sin(i),x=Math.cos(i),M=1-x,D=e[0],N=e[1],U=e[2],re=e[3],ne=e[4],xe=e[5],Ae=e[6],Te=e[7],Ie=e[8],Ue=e[9],Xe=e[10],qe=e[11],ht=o*o*M+x,gt=u*o*M+d*A,nt=d*o*M-u*A,at=o*u*M-d*A,bt=u*u*M+x,kt=d*u*M+o*A,Ht=o*d*M+u*A,St=u*d*M-o*A,xi=d*d*M+x,t[0]=D*ht+ne*gt+Ie*nt,t[1]=N*ht+xe*gt+Ue*nt,t[2]=U*ht+Ae*gt+Xe*nt,t[3]=re*ht+Te*gt+qe*nt,t[4]=D*at+ne*bt+Ie*kt,t[5]=N*at+xe*bt+Ue*kt,t[6]=U*at+Ae*bt+Xe*kt,t[7]=re*at+Te*bt+qe*kt,t[8]=D*Ht+ne*St+Ie*xi,t[9]=N*Ht+xe*St+Ue*xi,t[10]=U*Ht+Ae*St+Xe*xi,t[11]=re*Ht+Te*St+qe*xi,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function Nv(t,e,i){const r=Math.sin(i),o=Math.cos(i),u=e[4],d=e[5],a=e[6],x=e[7],A=e[8],M=e[9],D=e[10],N=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=u*o+A*r,t[5]=d*o+M*r,t[6]=a*o+D*r,t[7]=x*o+N*r,t[8]=A*o-u*r,t[9]=M*o-d*r,t[10]=D*o-a*r,t[11]=N*o-x*r,t}function UR(t,e,i){const r=Math.sin(i),o=Math.cos(i),u=e[0],d=e[1],a=e[2],x=e[3],A=e[8],M=e[9],D=e[10],N=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=u*o-A*r,t[1]=d*o-M*r,t[2]=a*o-D*r,t[3]=x*o-N*r,t[8]=u*r+A*o,t[9]=d*r+M*o,t[10]=a*r+D*o,t[11]=x*r+N*o,t}function Lv(t,e,i){const r=Math.sin(i),o=Math.cos(i),u=e[0],d=e[1],a=e[2],x=e[3],A=e[4],M=e[5],D=e[6],N=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=u*o+A*r,t[1]=d*o+M*r,t[2]=a*o+D*r,t[3]=x*o+N*r,t[4]=A*o-u*r,t[5]=M*o-d*r,t[6]=D*o-a*r,t[7]=N*o-x*r,t}function zR(t,e){const i=e[0],r=e[1],o=e[2],u=e[4],d=e[5],a=e[6],x=e[8],A=e[9],M=e[10];return t[0]=Math.sqrt(i*i+r*r+o*o),t[1]=Math.sqrt(u*u+d*d+a*a),t[2]=Math.sqrt(x*x+A*A+M*M),t}function VR(t,e){const i=e[0],r=e[1],o=e[2],u=e[3],d=i+i,a=r+r,x=o+o,A=i*d,M=r*d,D=r*a,N=o*d,U=o*a,re=o*x,ne=u*d,xe=u*a,Ae=u*x;return t[0]=1-D-re,t[1]=M+Ae,t[2]=N-xe,t[3]=0,t[4]=M-Ae,t[5]=1-A-re,t[6]=U+ne,t[7]=0,t[8]=N+xe,t[9]=U-ne,t[10]=1-A-D,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function jR(t,e,i,r,o,u,d){const a=1/(i-e),x=1/(o-r),A=1/(u-d);return t[0]=u*2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=u*2*x,t[6]=0,t[7]=0,t[8]=(i+e)*a,t[9]=(o+r)*x,t[10]=(d+u)*A,t[11]=-1,t[12]=0,t[13]=0,t[14]=d*u*2*A,t[15]=0,t}function HR(t,e,i,r,o){const u=1/Math.tan(e/2);if(t[0]=u/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,o!=null&&o!==1/0){const d=1/(r-o);t[10]=(o+r)*d,t[14]=2*o*r*d}else t[10]=-1,t[14]=-2*r;return t}const GR=HR;function $R(t,e,i,r,o,u,d){const a=1/(e-i),x=1/(r-o),A=1/(u-d);return t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*x,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*A,t[11]=0,t[12]=(e+i)*a,t[13]=(o+r)*x,t[14]=(d+u)*A,t[15]=1,t}const WR=$R;function XR(t,e,i,r){let o,u,d,a,x,A,M,D,N,U;const re=e[0],ne=e[1],xe=e[2],Ae=r[0],Te=r[1],Ie=r[2],Ue=i[0],Xe=i[1],qe=i[2];return Math.abs(re-Ue)<Lh&&Math.abs(ne-Xe)<Lh&&Math.abs(xe-qe)<Lh?FR(t):(D=re-Ue,N=ne-Xe,U=xe-qe,o=1/Math.sqrt(D*D+N*N+U*U),D*=o,N*=o,U*=o,u=Te*U-Ie*N,d=Ie*D-Ae*U,a=Ae*N-Te*D,o=Math.sqrt(u*u+d*d+a*a),o?(o=1/o,u*=o,d*=o,a*=o):(u=0,d=0,a=0),x=N*a-U*d,A=U*u-D*a,M=D*d-N*u,o=Math.sqrt(x*x+A*A+M*M),o?(o=1/o,x*=o,A*=o,M*=o):(x=0,A=0,M=0),t[0]=u,t[1]=x,t[2]=D,t[3]=0,t[4]=d,t[5]=A,t[6]=N,t[7]=0,t[8]=a,t[9]=M,t[10]=U,t[11]=0,t[12]=-(u*re+d*ne+a*xe),t[13]=-(x*re+A*ne+M*xe),t[14]=-(D*re+N*ne+U*xe),t[15]=1,t)}function qR(){const t=new vn(4);return vn!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function ZR(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t}function Uv(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t}function KR(t){const e=t[0],i=t[1],r=t[2],o=t[3];return Math.sqrt(e*e+i*i+r*r+o*o)}function YR(t){const e=t[0],i=t[1],r=t[2],o=t[3];return e*e+i*i+r*r+o*o}function JR(t,e){const i=e[0],r=e[1],o=e[2],u=e[3];let d=i*i+r*r+o*o+u*u;return d>0&&(d=1/Math.sqrt(d)),t[0]=i*d,t[1]=r*d,t[2]=o*d,t[3]=u*d,t}function QR(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function eP(t,e,i,r){const o=e[0],u=e[1],d=e[2],a=e[3];return t[0]=o+r*(i[0]-o),t[1]=u+r*(i[1]-u),t[2]=d+r*(i[2]-d),t[3]=a+r*(i[3]-a),t}function Uh(t,e,i){const r=e[0],o=e[1],u=e[2],d=e[3];return t[0]=i[0]*r+i[4]*o+i[8]*u+i[12]*d,t[1]=i[1]*r+i[5]*o+i[9]*u+i[13]*d,t[2]=i[2]*r+i[6]*o+i[10]*u+i[14]*d,t[3]=i[3]*r+i[7]*o+i[11]*u+i[15]*d,t}function tP(t,e,i){const r=e[0],o=e[1],u=e[2],d=i[0],a=i[1],x=i[2],A=i[3],M=A*r+a*u-x*o,D=A*o+x*r-d*u,N=A*u+d*o-a*r,U=-d*r-a*o-x*u;return t[0]=M*A+U*-d+D*-x-N*-a,t[1]=D*A+U*-a+N*-d-M*-x,t[2]=N*A+U*-x+M*-a-D*-d,t[3]=e[3],t}(function(){const t=qR();return function(e,i,r,o,u,d){let a,x;for(i||(i=4),r||(r=0),o?x=Math.min(o*i+r,e.length):x=e.length,a=r;a<x;a+=i)t[0]=e[a],t[1]=e[a+1],t[2]=e[a+2],t[3]=e[a+3],u(t,t,d),e[a]=t[0],e[a+1]=t[1],e[a+2]=t[2],e[a+3]=t[3];return e}})();var bg;(function(t){t[t.COL0ROW0=0]="COL0ROW0",t[t.COL0ROW1=1]="COL0ROW1",t[t.COL0ROW2=2]="COL0ROW2",t[t.COL0ROW3=3]="COL0ROW3",t[t.COL1ROW0=4]="COL1ROW0",t[t.COL1ROW1=5]="COL1ROW1",t[t.COL1ROW2=6]="COL1ROW2",t[t.COL1ROW3=7]="COL1ROW3",t[t.COL2ROW0=8]="COL2ROW0",t[t.COL2ROW1=9]="COL2ROW1",t[t.COL2ROW2=10]="COL2ROW2",t[t.COL2ROW3=11]="COL2ROW3",t[t.COL3ROW0=12]="COL3ROW0",t[t.COL3ROW1=13]="COL3ROW1",t[t.COL3ROW2=14]="COL3ROW2",t[t.COL3ROW3=15]="COL3ROW3"})(bg||(bg={}));const iP=45*Math.PI/180,rP=1,vg=.1,xg=500,sP=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class $t extends Ov{static get IDENTITY(){return oP()}static get ZERO(){return nP()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return bg}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,i,r,o,u,d,a,x,A,M,D,N,U,re,ne,xe){return this[0]=e,this[1]=i,this[2]=r,this[3]=o,this[4]=u,this[5]=d,this[6]=a,this[7]=x,this[8]=A,this[9]=M,this[10]=D,this[11]=N,this[12]=U,this[13]=re,this[14]=ne,this[15]=xe,this.check()}setRowMajor(e,i,r,o,u,d,a,x,A,M,D,N,U,re,ne,xe){return this[0]=e,this[1]=u,this[2]=A,this[3]=U,this[4]=i,this[5]=d,this[6]=M,this[7]=re,this[8]=r,this[9]=a,this[10]=D,this[11]=ne,this[12]=o,this[13]=x,this[14]=N,this[15]=xe,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(sP)}fromObject(e){return this.check()}fromQuaternion(e){return VR(this,e),this.check()}frustum(e){const{left:i,right:r,bottom:o,top:u,near:d=vg,far:a=xg}=e;return a===1/0?aP(this,i,r,o,u,d):jR(this,i,r,o,u,d,a),this.check()}lookAt(e){const{eye:i,center:r=[0,0,0],up:o=[0,1,0]}=e;return XR(this,i,r,o),this.check()}ortho(e){const{left:i,right:r,bottom:o,top:u,near:d=vg,far:a=xg}=e;return WR(this,i,r,o,u,d,a),this.check()}orthographic(e){const{fovy:i=iP,aspect:r=rP,focalDistance:o=1,near:u=vg,far:d=xg}=e;zv(i);const a=i/2,x=o*Math.tan(a),A=x*r;return this.ortho({left:-A,right:A,bottom:-x,top:x,near:u,far:d})}perspective(e){const{fovy:i=45*Math.PI/180,aspect:r=1,near:o=.1,far:u=500}=e;return zv(i),GR(this,i,r,o,u),this.check()}determinant(){return NR(this)}getScale(e=[-0,-0,-0]){return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(e=[-0,-0,-0]){return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,i){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],i=i||[-0,-0,-0];const r=this.getScale(i),o=1/r[0],u=1/r[1],d=1/r[2];return e[0]=this[0]*o,e[1]=this[1]*u,e[2]=this[2]*d,e[3]=0,e[4]=this[4]*o,e[5]=this[5]*u,e[6]=this[6]*d,e[7]=0,e[8]=this[8]*o,e[9]=this[9]*u,e[10]=this[10]*d,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,i){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],i=i||[-0,-0,-0];const r=this.getScale(i),o=1/r[0],u=1/r[1],d=1/r[2];return e[0]=this[0]*o,e[1]=this[1]*u,e[2]=this[2]*d,e[3]=this[4]*o,e[4]=this[5]*u,e[5]=this[6]*d,e[6]=this[8]*o,e[7]=this[9]*u,e[8]=this[10]*d,e}transpose(){return kR(this,this),this.check()}invert(){return mg(this,this),this.check()}multiplyLeft(e){return Ha(this,e,this),this.check()}multiplyRight(e){return Ha(this,this,e),this.check()}rotateX(e){return Nv(this,this,e),this.check()}rotateY(e){return UR(this,this,e),this.check()}rotateZ(e){return Lv(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,i){return LR(this,this,e,i),this.check()}scale(e){return yg(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return ef(this,this,e),this.check()}transform(e,i){return e.length===4?(i=Uh(i||[-0,-0,-0,-0],e,this),Nh(i,4),i):this.transformAsPoint(e,i)}transformAsPoint(e,i){const{length:r}=e;let o;switch(r){case 2:o=Ev(i||[-0,-0],e,this);break;case 3:o=fg(i||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Nh(o,e.length),o}transformAsVector(e,i){let r;switch(e.length){case 2:r=Sv(i||[-0,-0],e,this);break;case 3:r=Cv(i||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Nh(r,e.length),r}transformPoint(e,i){return this.transformAsPoint(e,i)}transformVector(e,i){return this.transformAsPoint(e,i)}transformDirection(e,i){return this.transformAsVector(e,i)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,i,r){return this.identity().translate([e,i,r])}}let tf,rf;function nP(){return tf||(tf=new $t([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(tf)),tf}function oP(){return rf||(rf=new $t,Object.freeze(rf)),rf}function zv(t){if(t>Math.PI*2)throw Error("expected radians")}function aP(t,e,i,r,o,u){const d=2*u/(i-e),a=2*u/(o-r),x=(i+e)/(i-e),A=(o+r)/(o-r),M=-1,D=-1,N=-2*u;return t[0]=d,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=x,t[9]=A,t[10]=M,t[11]=D,t[12]=0,t[13]=0,t[14]=N,t[15]=0,t}function Vv(){const t=new vn(4);return vn!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function lP(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function jv(t,e,i){i=i*.5;const r=Math.sin(i);return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=Math.cos(i),t}function Hv(t,e,i){const r=e[0],o=e[1],u=e[2],d=e[3],a=i[0],x=i[1],A=i[2],M=i[3];return t[0]=r*M+d*a+o*A-u*x,t[1]=o*M+d*x+u*a-r*A,t[2]=u*M+d*A+r*x-o*a,t[3]=d*M-r*a-o*x-u*A,t}function cP(t,e,i){i*=.5;const r=e[0],o=e[1],u=e[2],d=e[3],a=Math.sin(i),x=Math.cos(i);return t[0]=r*x+d*a,t[1]=o*x+u*a,t[2]=u*x-o*a,t[3]=d*x-r*a,t}function hP(t,e,i){i*=.5;const r=e[0],o=e[1],u=e[2],d=e[3],a=Math.sin(i),x=Math.cos(i);return t[0]=r*x-u*a,t[1]=o*x+d*a,t[2]=u*x+r*a,t[3]=d*x-o*a,t}function uP(t,e,i){i*=.5;const r=e[0],o=e[1],u=e[2],d=e[3],a=Math.sin(i),x=Math.cos(i);return t[0]=r*x+o*a,t[1]=o*x-r*a,t[2]=u*x+d*a,t[3]=d*x-u*a,t}function dP(t,e){const i=e[0],r=e[1],o=e[2];return t[0]=i,t[1]=r,t[2]=o,t[3]=Math.sqrt(Math.abs(1-i*i-r*r-o*o)),t}function sf(t,e,i,r){const o=e[0],u=e[1],d=e[2],a=e[3];let x=i[0],A=i[1],M=i[2],D=i[3],N,U,re,ne,xe;return N=o*x+u*A+d*M+a*D,N<0&&(N=-N,x=-x,A=-A,M=-M,D=-D),1-N>Lh?(U=Math.acos(N),xe=Math.sin(U),re=Math.sin((1-r)*U)/xe,ne=Math.sin(r*U)/xe):(re=1-r,ne=r),t[0]=re*o+ne*x,t[1]=re*u+ne*A,t[2]=re*d+ne*M,t[3]=re*a+ne*D,t}function fP(t,e){const i=e[0],r=e[1],o=e[2],u=e[3],d=i*i+r*r+o*o+u*u,a=d?1/d:0;return t[0]=-i*a,t[1]=-r*a,t[2]=-o*a,t[3]=u*a,t}function pP(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function Gv(t,e){const i=e[0]+e[4]+e[8];let r;if(i>0)r=Math.sqrt(i+1),t[3]=.5*r,r=.5/r,t[0]=(e[5]-e[7])*r,t[1]=(e[6]-e[2])*r,t[2]=(e[1]-e[3])*r;else{let o=0;e[4]>e[0]&&(o=1),e[8]>e[o*3+o]&&(o=2);const u=(o+1)%3,d=(o+2)%3;r=Math.sqrt(e[o*3+o]-e[u*3+u]-e[d*3+d]+1),t[o]=.5*r,r=.5/r,t[3]=(e[u*3+d]-e[d*3+u])*r,t[u]=(e[u*3+o]+e[o*3+u])*r,t[d]=(e[d*3+o]+e[o*3+d])*r}return t}const _P=ZR,gP=Uv,mP=QR,yP=eP,bP=KR,vP=YR,$v=JR,xP=function(){const t=Mv(),e=Pv(1,0,0),i=Pv(0,1,0);return function(r,o,u){const d=dg(o,u);return d<-.999999?(Zd(t,e,o),AR(t)<1e-6&&Zd(t,i,o),yR(t,t),jv(r,t,Math.PI),r):d>.999999?(r[0]=0,r[1]=0,r[2]=0,r[3]=1,r):(Zd(t,o,u),r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=1+d,$v(r,r))}}();(function(){const t=Vv(),e=Vv();return function(i,r,o,u,d,a){return sf(t,r,d,a),sf(e,o,u,a),sf(i,t,e,2*a*(1-a)),i}})(),function(){const t=ER();return function(e,i,r,o){return t[0]=r[0],t[3]=r[1],t[6]=r[2],t[1]=o[0],t[4]=o[1],t[7]=o[2],t[2]=-i[0],t[5]=-i[1],t[8]=-i[2],$v(e,Gv(e,t))}}();const wP=[0,0,0,1];class zh extends cg{constructor(e=0,i=0,r=0,o=1){super(-0,-0,-0,-0),Array.isArray(e)&&arguments.length===1?this.copy(e):this.set(e,i,r,o)}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}set(e,i,r,o){return this[0]=e,this[1]=i,this[2]=r,this[3]=o,this.check()}fromObject(e){return this[0]=e.x,this[1]=e.y,this[2]=e.z,this[3]=e.w,this.check()}fromMatrix3(e){return Gv(this,e),this.check()}fromAxisRotation(e,i){return jv(this,e,i),this.check()}identity(){return lP(this),this.check()}setAxisAngle(e,i){return this.fromAxisRotation(e,i)}get ELEMENTS(){return 4}get x(){return this[0]}set x(e){this[0]=ii(e)}get y(){return this[1]}set y(e){this[1]=ii(e)}get z(){return this[2]}set z(e){this[2]=ii(e)}get w(){return this[3]}set w(e){this[3]=ii(e)}len(){return bP(this)}lengthSquared(){return vP(this)}dot(e){return mP(this,e)}rotationTo(e,i){return xP(this,e,i),this.check()}add(e){return _P(this,this,e),this.check()}calculateW(){return dP(this,this),this.check()}conjugate(){return pP(this,this),this.check()}invert(){return fP(this,this),this.check()}lerp(e,i,r){return r===void 0?this.lerp(this,e,i):(yP(this,e,i,r),this.check())}multiplyRight(e){return Hv(this,this,e),this.check()}multiplyLeft(e){return Hv(this,e,this),this.check()}normalize(){const e=this.len(),i=e>0?1/e:0;return this[0]=this[0]*i,this[1]=this[1]*i,this[2]=this[2]*i,this[3]=this[3]*i,e===0&&(this[3]=1),this.check()}rotateX(e){return cP(this,this,e),this.check()}rotateY(e){return hP(this,this,e),this.check()}rotateZ(e){return uP(this,this,e),this.check()}scale(e){return gP(this,this,e),this.check()}slerp(e,i,r){let o,u,d;switch(arguments.length){case 1:({start:o=wP,target:u,ratio:d}=e);break;case 2:o=this,u=e,d=i;break;default:o=e,u=i,d=r}return sf(this,o,u,d),this.check()}transformVector4(e,i=new _g){return tP(i,e,this),Nh(i,4)}lengthSq(){return this.lengthSquared()}setFromAxisAngle(e,i){return this.setAxisAngle(e,i)}premultiply(e){return this.multiplyLeft(e)}multiply(e){return this.multiplyRight(e)}}const TP=.1,AP=1e-12,Wv=1e-15,EP=1e-20,Xv=`#if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))
struct AmbientLight {
vec3 color;
};
struct PointLight {
vec3 color;
vec3 position;
vec3 attenuation;
};
struct DirectionalLight {
vec3 color;
vec3 direction;
};
uniform AmbientLight lighting_uAmbientLight;
uniform PointLight lighting_uPointLight[MAX_LIGHTS];
uniform DirectionalLight lighting_uDirectionalLight[MAX_LIGHTS];
uniform int lighting_uPointLightCount;
uniform int lighting_uDirectionalLightCount;
uniform bool lighting_uEnabled;
float getPointLightAttenuation(PointLight pointLight, float distance) {
return pointLight.attenuation.x
+ pointLight.attenuation.y * distance
+ pointLight.attenuation.z * distance * distance;
}
#endif
`,SP={lightSources:{}};function wg(t={}){const{color:e=[0,0,0],intensity:i=1}=t;return e.map(r=>r*i/255)}function CP({ambientLight:t,pointLights:e=[],directionalLights:i=[]}){const r={};return t?r["lighting_uAmbientLight.color"]=wg(t):r["lighting_uAmbientLight.color"]=[0,0,0],e.forEach((o,u)=>{r[`lighting_uPointLight[${u}].color`]=wg(o),r[`lighting_uPointLight[${u}].position`]=o.position,r[`lighting_uPointLight[${u}].attenuation`]=o.attenuation||[1,0,0]}),r.lighting_uPointLightCount=e.length,i.forEach((o,u)=>{r[`lighting_uDirectionalLight[${u}].color`]=wg(o),r[`lighting_uDirectionalLight[${u}].direction`]=o.direction}),r.lighting_uDirectionalLightCount=i.length,r}function qv(t=SP){var e,i;if("lightSources"in t){const{ambientLight:r,pointLights:o,directionalLights:u}=t.lightSources||{};return r||o&&o.length>0||u&&u.length>0?Object.assign({},CP({ambientLight:r,pointLights:o,directionalLights:u}),{lighting_uEnabled:!0}):{lighting_uEnabled:!1}}if("lights"in t){const r={pointLights:[],directionalLights:[]};for(const o of t.lights||[])switch(o.type){case"ambient":r.ambientLight=o;break;case"directional":(e=r.directionalLights)==null||e.push(o);break;case"point":(i=r.pointLights)==null||i.push(o);break}return qv({lightSources:r})}return{}}const Tg={name:"lights",vs:Xv,fs:Xv,getUniforms:qv,defines:{MAX_LIGHTS:3}},Zv=`uniform float lighting_uAmbient;
uniform float lighting_uDiffuse;
uniform float lighting_uShininess;
uniform vec3  lighting_uSpecularColor;
vec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {
vec3 halfway_direction = normalize(light_direction + view_direction);
float lambertian = dot(light_direction, normal_worldspace);
float specular = 0.0;
if (lambertian > 0.0) {
float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
specular = pow(specular_angle, lighting_uShininess);
}
lambertian = max(lambertian, 0.0);
return (lambertian * lighting_uDiffuse * surfaceColor + specular * lighting_uSpecularColor) * color;
}
vec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
vec3 lightColor = surfaceColor;
if (lighting_uEnabled) {
vec3 view_direction = normalize(cameraPosition - position_worldspace);
lightColor = lighting_uAmbient * surfaceColor * lighting_uAmbientLight.color;
for (int i = 0; i < MAX_LIGHTS; i++) {
if (i >= lighting_uPointLightCount) {
break;
}
PointLight pointLight = lighting_uPointLight[i];
vec3 light_position_worldspace = pointLight.position;
vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
}
for (int i = 0; i < MAX_LIGHTS; i++) {
if (i >= lighting_uDirectionalLightCount) {
break;
}
DirectionalLight directionalLight = lighting_uDirectionalLight[i];
lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
}
}
return lightColor;
}
vec3 lighting_getSpecularLightColor(vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
vec3 lightColor = vec3(0, 0, 0);
vec3 surfaceColor = vec3(0, 0, 0);
if (lighting_uEnabled) {
vec3 view_direction = normalize(cameraPosition - position_worldspace);
for (int i = 0; i < MAX_LIGHTS; i++) {
if (i >= lighting_uPointLightCount) {
break;
}
PointLight pointLight = lighting_uPointLight[i];
vec3 light_position_worldspace = pointLight.position;
vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
}
for (int i = 0; i < MAX_LIGHTS; i++) {
if (i >= lighting_uDirectionalLightCount) {
break;
}
DirectionalLight directionalLight = lighting_uDirectionalLight[i];
lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
}
}
return lightColor;
}
`,IP={};function MP(t){const{ambient:e=.35,diffuse:i=.6,shininess:r=32,specularColor:o=[30,30,30]}=t;return{lighting_uAmbient:e,lighting_uDiffuse:i,lighting_uShininess:r,lighting_uSpecularColor:o.map(u=>u/255)}}function Kv(t=IP){if(!("material"in t))return{};const{material:e}=t;return e?MP(e):{lighting_uEnabled:!1}}const RP={name:"gouraud-lighting",dependencies:[Tg],vs:Zv,defines:{LIGHTING_VERTEX:1},getUniforms:Kv},PP={name:"phong-lighting",dependencies:[Tg],fs:Zv,defines:{LIGHTING_FRAGMENT:1},getUniforms:Kv},Ag={name:"pbr",vs:`uniform mat4 u_MVPMatrix;
uniform mat4 u_ModelMatrix;
uniform mat4 u_NormalMatrix;
out vec3 pbr_vPosition;
out vec2 pbr_vUV;
#ifdef HAS_NORMALS
# ifdef HAS_TANGENTS
out mat3 pbr_vTBN;
# else
out vec3 pbr_vNormal;
# endif
#endif
void pbr_setPositionNormalTangentUV(vec4 position, vec4 normal, vec4 tangent, vec2 uv)
{
vec4 pos = u_ModelMatrix * position;
pbr_vPosition = vec3(pos.xyz) / pos.w;
#ifdef HAS_NORMALS
#ifdef HAS_TANGENTS
vec3 normalW = normalize(vec3(u_NormalMatrix * vec4(normal.xyz, 0.0)));
vec3 tangentW = normalize(vec3(u_ModelMatrix * vec4(tangent.xyz, 0.0)));
vec3 bitangentW = cross(normalW, tangentW) * tangent.w;
pbr_vTBN = mat3(tangentW, bitangentW, normalW);
#else
pbr_vNormal = normalize(vec3(u_ModelMatrix * vec4(normal.xyz, 0.0)));
#endif
#endif
#ifdef HAS_UV
pbr_vUV = uv;
#else
pbr_vUV = vec2(0.,0.);
#endif
}
`,fs:`precision highp float;
uniform bool pbr_uUnlit;
#ifdef USE_IBL
uniform samplerCube u_DiffuseEnvSampler;
uniform samplerCube u_SpecularEnvSampler;
uniform sampler2D u_brdfLUT;
uniform vec2 u_ScaleIBLAmbient;
#endif
#ifdef HAS_BASECOLORMAP
uniform sampler2D u_BaseColorSampler;
#endif
#ifdef HAS_NORMALMAP
uniform sampler2D u_NormalSampler;
uniform float u_NormalScale;
#endif
#ifdef HAS_EMISSIVEMAP
uniform sampler2D u_EmissiveSampler;
uniform vec3 u_EmissiveFactor;
#endif
#ifdef HAS_METALROUGHNESSMAP
uniform sampler2D u_MetallicRoughnessSampler;
#endif
#ifdef HAS_OCCLUSIONMAP
uniform sampler2D u_OcclusionSampler;
uniform float u_OcclusionStrength;
#endif
#ifdef ALPHA_CUTOFF
uniform float u_AlphaCutoff;
#endif
uniform vec2 u_MetallicRoughnessValues;
uniform vec4 u_BaseColorFactor;
uniform vec3 u_Camera;
#ifdef PBR_DEBUG
uniform vec4 u_ScaleDiffBaseMR;
uniform vec4 u_ScaleFGDSpec;
#endif
in vec3 pbr_vPosition;
in vec2 pbr_vUV;
#ifdef HAS_NORMALS
#ifdef HAS_TANGENTS
in mat3 pbr_vTBN;
#else
in vec3 pbr_vNormal;
#endif
#endif
struct PBRInfo
{
float NdotL;
float NdotV;
float NdotH;
float LdotH;
float VdotH;
float perceptualRoughness;
float metalness;
vec3 reflectance0;
vec3 reflectance90;
float alphaRoughness;
vec3 diffuseColor;
vec3 specularColor;
vec3 n;
vec3 v;
};
const float M_PI = 3.141592653589793;
const float c_MinRoughness = 0.04;
vec4 SRGBtoLINEAR(vec4 srgbIn)
{
#ifdef MANUAL_SRGB
#ifdef SRGB_FAST_APPROXIMATION
vec3 linOut = pow(srgbIn.xyz,vec3(2.2));
#else
vec3 bLess = step(vec3(0.04045),srgbIn.xyz);
vec3 linOut = mix( srgbIn.xyz/vec3(12.92), pow((srgbIn.xyz+vec3(0.055))/vec3(1.055),vec3(2.4)), bLess );
#endif
return vec4(linOut,srgbIn.w);;
#else
return srgbIn;
#endif
}
vec3 getNormal()
{
#ifndef HAS_TANGENTS
vec3 pos_dx = dFdx(pbr_vPosition);
vec3 pos_dy = dFdy(pbr_vPosition);
vec3 tex_dx = dFdx(vec3(pbr_vUV, 0.0));
vec3 tex_dy = dFdy(vec3(pbr_vUV, 0.0));
vec3 t = (tex_dy.t * pos_dx - tex_dx.t * pos_dy) / (tex_dx.s * tex_dy.t - tex_dy.s * tex_dx.t);
#ifdef HAS_NORMALS
vec3 ng = normalize(pbr_vNormal);
#else
vec3 ng = cross(pos_dx, pos_dy);
#endif
t = normalize(t - ng * dot(ng, t));
vec3 b = normalize(cross(ng, t));
mat3 tbn = mat3(t, b, ng);
#else
mat3 tbn = pbr_vTBN;
#endif
#ifdef HAS_NORMALMAP
vec3 n = texture(u_NormalSampler, pbr_vUV).rgb;
n = normalize(tbn * ((2.0 * n - 1.0) * vec3(u_NormalScale, u_NormalScale, 1.0)));
#else
vec3 n = normalize(tbn[2].xyz);
#endif
return n;
}
#ifdef USE_IBL
vec3 getIBLContribution(PBRInfo pbrInputs, vec3 n, vec3 reflection)
{
float mipCount = 9.0;
float lod = (pbrInputs.perceptualRoughness * mipCount);
vec3 brdf = SRGBtoLINEAR(texture(u_brdfLUT,
vec2(pbrInputs.NdotV, 1.0 - pbrInputs.perceptualRoughness))).rgb;
vec3 diffuseLight = SRGBtoLINEAR(textureCube(u_DiffuseEnvSampler, n)).rgb;
#ifdef USE_TEX_LOD
vec3 specularLight = SRGBtoLINEAR(textureCubeLod(u_SpecularEnvSampler, reflection, lod)).rgb;
#else
vec3 specularLight = SRGBtoLINEAR(textureCube(u_SpecularEnvSampler, reflection)).rgb;
#endif
vec3 diffuse = diffuseLight * pbrInputs.diffuseColor;
vec3 specular = specularLight * (pbrInputs.specularColor * brdf.x + brdf.y);
diffuse *= u_ScaleIBLAmbient.x;
specular *= u_ScaleIBLAmbient.y;
return diffuse + specular;
}
#endif
vec3 diffuse(PBRInfo pbrInputs)
{
return pbrInputs.diffuseColor / M_PI;
}
vec3 specularReflection(PBRInfo pbrInputs)
{
return pbrInputs.reflectance0 +
(pbrInputs.reflectance90 - pbrInputs.reflectance0) *
pow(clamp(1.0 - pbrInputs.VdotH, 0.0, 1.0), 5.0);
}
float geometricOcclusion(PBRInfo pbrInputs)
{
float NdotL = pbrInputs.NdotL;
float NdotV = pbrInputs.NdotV;
float r = pbrInputs.alphaRoughness;
float attenuationL = 2.0 * NdotL / (NdotL + sqrt(r * r + (1.0 - r * r) * (NdotL * NdotL)));
float attenuationV = 2.0 * NdotV / (NdotV + sqrt(r * r + (1.0 - r * r) * (NdotV * NdotV)));
return attenuationL * attenuationV;
}
float microfacetDistribution(PBRInfo pbrInputs)
{
float roughnessSq = pbrInputs.alphaRoughness * pbrInputs.alphaRoughness;
float f = (pbrInputs.NdotH * roughnessSq - pbrInputs.NdotH) * pbrInputs.NdotH + 1.0;
return roughnessSq / (M_PI * f * f);
}
void PBRInfo_setAmbientLight(inout PBRInfo pbrInputs) {
pbrInputs.NdotL = 1.0;
pbrInputs.NdotH = 0.0;
pbrInputs.LdotH = 0.0;
pbrInputs.VdotH = 1.0;
}
void PBRInfo_setDirectionalLight(inout PBRInfo pbrInputs, vec3 lightDirection) {
vec3 n = pbrInputs.n;
vec3 v = pbrInputs.v;
vec3 l = normalize(lightDirection);
vec3 h = normalize(l+v);
pbrInputs.NdotL = clamp(dot(n, l), 0.001, 1.0);
pbrInputs.NdotH = clamp(dot(n, h), 0.0, 1.0);
pbrInputs.LdotH = clamp(dot(l, h), 0.0, 1.0);
pbrInputs.VdotH = clamp(dot(v, h), 0.0, 1.0);
}
void PBRInfo_setPointLight(inout PBRInfo pbrInputs, PointLight pointLight) {
vec3 light_direction = normalize(pointLight.position - pbr_vPosition);
PBRInfo_setDirectionalLight(pbrInputs, light_direction);
}
vec3 calculateFinalColor(PBRInfo pbrInputs, vec3 lightColor) {
vec3 F = specularReflection(pbrInputs);
float G = geometricOcclusion(pbrInputs);
float D = microfacetDistribution(pbrInputs);
vec3 diffuseContrib = (1.0 - F) * diffuse(pbrInputs);
vec3 specContrib = F * G * D / (4.0 * pbrInputs.NdotL * pbrInputs.NdotV);
return pbrInputs.NdotL * lightColor * (diffuseContrib + specContrib);
}
vec4 pbr_filterColor(vec4 colorUnused)
{
#ifdef HAS_BASECOLORMAP
vec4 baseColor = SRGBtoLINEAR(texture(u_BaseColorSampler, pbr_vUV)) * u_BaseColorFactor;
#else
vec4 baseColor = u_BaseColorFactor;
#endif
#ifdef ALPHA_CUTOFF
if (baseColor.a < u_AlphaCutoff) {
discard;
}
#endif
vec3 color = vec3(0, 0, 0);
if(pbr_uUnlit){
color.rgb = baseColor.rgb;
}
else{
float perceptualRoughness = u_MetallicRoughnessValues.y;
float metallic = u_MetallicRoughnessValues.x;
#ifdef HAS_METALROUGHNESSMAP
vec4 mrSample = texture(u_MetallicRoughnessSampler, pbr_vUV);
perceptualRoughness = mrSample.g * perceptualRoughness;
metallic = mrSample.b * metallic;
#endif
perceptualRoughness = clamp(perceptualRoughness, c_MinRoughness, 1.0);
metallic = clamp(metallic, 0.0, 1.0);
float alphaRoughness = perceptualRoughness * perceptualRoughness;
vec3 f0 = vec3(0.04);
vec3 diffuseColor = baseColor.rgb * (vec3(1.0) - f0);
diffuseColor *= 1.0 - metallic;
vec3 specularColor = mix(f0, baseColor.rgb, metallic);
float reflectance = max(max(specularColor.r, specularColor.g), specularColor.b);
float reflectance90 = clamp(reflectance * 25.0, 0.0, 1.0);
vec3 specularEnvironmentR0 = specularColor.rgb;
vec3 specularEnvironmentR90 = vec3(1.0, 1.0, 1.0) * reflectance90;
vec3 n = getNormal();
vec3 v = normalize(u_Camera - pbr_vPosition);
float NdotV = clamp(abs(dot(n, v)), 0.001, 1.0);
vec3 reflection = -normalize(reflect(v, n));
PBRInfo pbrInputs = PBRInfo(
0.0,
NdotV,
0.0,
0.0,
0.0,
perceptualRoughness,
metallic,
specularEnvironmentR0,
specularEnvironmentR90,
alphaRoughness,
diffuseColor,
specularColor,
n,
v
);
#ifdef USE_LIGHTS
PBRInfo_setAmbientLight(pbrInputs);
color += calculateFinalColor(pbrInputs, lighting_uAmbientLight.color);
for(int i = 0; i < lighting_uDirectionalLightCount; i++) {
if (i < lighting_uDirectionalLightCount) {
PBRInfo_setDirectionalLight(pbrInputs, lighting_uDirectionalLight[i].direction);
color += calculateFinalColor(pbrInputs, lighting_uDirectionalLight[i].color);
}
}
for(int i = 0; i < lighting_uPointLightCount; i++) {
if (i < lighting_uPointLightCount) {
PBRInfo_setPointLight(pbrInputs, lighting_uPointLight[i]);
float attenuation = getPointLightAttenuation(lighting_uPointLight[i], distance(lighting_uPointLight[i].position, pbr_vPosition));
color += calculateFinalColor(pbrInputs, lighting_uPointLight[i].color / attenuation);
}
}
#endif
#ifdef USE_IBL
color += getIBLContribution(pbrInputs, n, reflection);
#endif
#ifdef HAS_OCCLUSIONMAP
float ao = texture(u_OcclusionSampler, pbr_vUV).r;
color = mix(color, color * ao, u_OcclusionStrength);
#endif
#ifdef HAS_EMISSIVEMAP
vec3 emissive = SRGBtoLINEAR(texture(u_EmissiveSampler, pbr_vUV)).rgb * u_EmissiveFactor;
color += emissive;
#endif
#ifdef PBR_DEBUG
color = mix(color, baseColor.rgb, u_ScaleDiffBaseMR.y);
color = mix(color, vec3(metallic), u_ScaleDiffBaseMR.z);
color = mix(color, vec3(perceptualRoughness), u_ScaleDiffBaseMR.w);
#endif
}
return vec4(pow(color,vec3(1.0/2.2)), baseColor.a);
}
`,defines:{LIGHTING_FRAGMENT:1},dependencies:[Tg]},Yv="#define SMOOTH_EDGE_RADIUS 0.5",BP=`
${Yv}

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`,DP=`
${Yv}

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,OP={name:"geometry",vs:BP,fs:DP},Xt={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(Xt,"IDENTITY",{get:()=>(Yt.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const Hn={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},Eg={common:0,meters:1,pixels:2},Sg={click:{handler:"onClick"},panstart:{handler:"onDragStart"},panmove:{handler:"onDrag"},panend:{handler:"onDragEnd"}},FP=Object.keys(Xt).map(t=>`const int COORDINATE_SYSTEM_${t} = ${Xt[t]};`).join(""),kP=Object.keys(Hn).map(t=>`const int PROJECTION_MODE_${t} = ${Hn[t]};`).join(""),NP=Object.keys(Eg).map(t=>`const int UNIT_${t.toUpperCase()} = ${Eg[t]};`).join(""),LP=`${FP}
${kP}
${NP}
uniform int project_uCoordinateSystem;
uniform int project_uProjectionMode;
uniform float project_uScale;
uniform bool project_uWrapLongitude;
uniform vec3 project_uCommonUnitsPerMeter;
uniform vec3 project_uCommonUnitsPerWorldUnit;
uniform vec3 project_uCommonUnitsPerWorldUnit2;
uniform vec4 project_uCenter;
uniform mat4 project_uModelMatrix;
uniform mat4 project_uViewProjectionMatrix;
uniform vec2 project_uViewportSize;
uniform float project_uDevicePixelRatio;
uniform float project_uFocalDistance;
uniform vec3 project_uCameraPosition;
uniform vec3 project_uCoordinateOrigin;
uniform vec3 project_uCommonOrigin;
uniform bool project_uPseudoMeters;
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
float y = clamp(lat, -89.9, 89.9);
return 1.0 / cos(radians(y));
}
float project_size() {
if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR &&
project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
project_uPseudoMeters == false) {
if (geometry.position.w == 0.0) {
return project_size_at_latitude(geometry.worldPosition.y);
}
float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
float y2 = y * y;
float y4 = y2 * y2;
float y6 = y4 * y2;
return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
}
return 1.0;
}
float project_size_at_latitude(float meters, float lat) {
return meters * project_uCommonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
return meters * project_uCommonUnitsPerMeter.z * project_size();
}
vec2 project_size(vec2 meters) {
return meters * project_uCommonUnitsPerMeter.xy * project_size();
}
vec3 project_size(vec3 meters) {
return meters * project_uCommonUnitsPerMeter * project_size();
}
vec4 project_size(vec4 meters) {
return vec4(meters.xyz * project_uCommonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
vec3 uz = normalize(up);
vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
vec3 uy = cross(uz, ux);
return mat3(ux, uy, uz);
}
bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
transform = project_get_orientation_matrix(commonPosition);
return true;
}
return false;
}
vec3 project_normal(vec3 vector) {
vec4 normal_modelspace = project_uModelMatrix * vec4(vector, 0.0);
vec3 n = normalize(normal_modelspace.xyz * project_uCommonUnitsPerMeter);
mat3 rotation;
if (project_needs_rotation(geometry.position.xyz, rotation)) {
n = rotation * n;
}
return n;
}
vec4 project_offset_(vec4 offset) {
float dy = offset.y;
vec3 commonUnitsPerWorldUnit = project_uCommonUnitsPerWorldUnit + project_uCommonUnitsPerWorldUnit2 * dy;
return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
float x = lnglat.x;
if (project_uWrapLongitude) {
x = mod(x + 180., 360.0) - 180.;
}
float y = clamp(lnglat.y, -89.9, 89.9);
return vec2(
radians(x) + PI,
PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
) * WORLD_SCALE;
}
vec3 project_globe_(vec3 lnglatz) {
float lambda = radians(lnglatz.x);
float phi = radians(lnglatz.y);
float cosPhi = cos(phi);
float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
return vec3(
sin(lambda) * cosPhi,
-cos(lambda) * cosPhi,
sin(phi)
) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
vec4 position_world = project_uModelMatrix * position;
if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR) {
if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_mercator_(position_world.xy),
project_size_at_latitude(position_world.z, position_world.y),
position_world.w
);
}
if (project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
position_world.xyz += project_uCoordinateOrigin;
}
}
if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_globe_(position_world.xyz),
position_world.w
);
}
}
if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
if (abs(position_world.y - project_uCoordinateOrigin.y) > 0.25) {
return vec4(
project_mercator_(position_world.xy) - project_uCommonOrigin.xy,
project_size(position_world.z),
position_world.w
);
}
}
}
if (project_uProjectionMode == PROJECTION_MODE_IDENTITY ||
(project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
(project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
position_world.xyz -= project_uCoordinateOrigin;
}
return project_offset_(position_world) + project_offset_(project_uModelMatrix * vec4(position64Low, 0.0));
}
vec4 project_position(vec4 position) {
return project_position(position, ZERO_64_LOW);
}
vec3 project_position(vec3 position, vec3 position64Low) {
vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
return projected_position.xyz;
}
vec3 project_position(vec3 position) {
vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
return projected_position.xyz;
}
vec2 project_position(vec2 position) {
vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
return projected_position.xy;
}
vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
return project_common_position_to_clipspace(position, project_uViewProjectionMatrix, project_uCenter);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
vec2 offset = pixels / project_uViewportSize * project_uDevicePixelRatio * 2.0;
return offset * project_uFocalDistance;
}
float project_size_to_pixel(float meters) {
return project_size(meters) * project_uScale;
}
float project_size_to_pixel(float size, int unit) {
if (unit == UNIT_METERS) return project_size_to_pixel(size);
if (unit == UNIT_COMMON) return size * project_uScale;
return size;
}
float project_pixel_size(float pixels) {
return pixels / project_uScale;
}
vec2 project_pixel_size(vec2 pixels) {
return pixels / project_uScale;
}
`;function UP(t,e){if(t===e)return!0;if(Array.isArray(t)){const i=t.length;if(!e||e.length!==i)return!1;for(let r=0;r<i;r++)if(t[r]!==e[r])return!1;return!0}return!1}function Vh(t){let e={},i;return r=>{for(const o in r)if(!UP(r[o],e[o])){i=t(r),e=r;break}return i}}const Jv=[0,0,0,0],zP=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],Qv=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],VP=[0,0,0],ex=[0,0,0],jP=Vh($P);function tx(t,e,i=ex){i.length<3&&(i=[i[0],i[1],0]);let r=i,o,u=!0;switch(e===Xt.LNGLAT_OFFSETS||e===Xt.METER_OFFSETS?o=i:o=t.isGeospatial?[Math.fround(t.longitude),Math.fround(t.latitude),0]:null,t.projectionMode){case Hn.WEB_MERCATOR:(e===Xt.LNGLAT||e===Xt.CARTESIAN)&&(o=[0,0,0],u=!1);break;case Hn.WEB_MERCATOR_AUTO_OFFSET:e===Xt.LNGLAT?r=o:e===Xt.CARTESIAN&&(r=[Math.fround(t.center[0]),Math.fround(t.center[1]),0],o=t.unprojectPosition(r),r[0]-=i[0],r[1]-=i[1],r[2]-=i[2]);break;case Hn.IDENTITY:r=t.position.map(Math.fround),r[2]=r[2]||0;break;case Hn.GLOBE:u=!1,o=null;break;default:u=!1}return{geospatialOrigin:o,shaderCoordinateOrigin:r,offsetMode:u}}function HP(t,e,i){const{viewMatrixUncentered:r,projectionMatrix:o}=t;let{viewMatrix:u,viewProjectionMatrix:d}=t,a=Jv,x=Jv,A=t.cameraPosition;const{geospatialOrigin:M,shaderCoordinateOrigin:D,offsetMode:N}=tx(t,e,i);return N&&(x=t.projectPosition(M||D),A=[A[0]-x[0],A[1]-x[1],A[2]-x[2]],x[3]=1,a=Uh([],x,d),u=r||u,d=Ha([],o,u),d=Ha([],d,zP)),{viewMatrix:u,viewProjectionMatrix:d,projectionCenter:a,originCommon:x,cameraPosCommon:A,shaderCoordinateOrigin:D,geospatialOrigin:M}}function GP({viewport:t,devicePixelRatio:e=1,modelMatrix:i=null,coordinateSystem:r=Xt.DEFAULT,coordinateOrigin:o=ex,autoWrapLongitude:u=!1}){r===Xt.DEFAULT&&(r=t.isGeospatial?Xt.LNGLAT:Xt.CARTESIAN);const d=jP({viewport:t,devicePixelRatio:e,coordinateSystem:r,coordinateOrigin:o});return d.project_uWrapLongitude=u,d.project_uModelMatrix=i||Qv,d}function $P({viewport:t,devicePixelRatio:e,coordinateSystem:i,coordinateOrigin:r}){const{projectionCenter:o,viewProjectionMatrix:u,originCommon:d,cameraPosCommon:a,shaderCoordinateOrigin:x,geospatialOrigin:A}=HP(t,i,r),M=t.getDistanceScales(),D=[t.width*e,t.height*e],N=Uh([],[0,0,-t.focalDistance,1],t.projectionMatrix)[3]||1,U={project_uCoordinateSystem:i,project_uProjectionMode:t.projectionMode,project_uCoordinateOrigin:x,project_uCommonOrigin:d.slice(0,3),project_uCenter:o,project_uPseudoMeters:!!t._pseudoMeters,project_uViewportSize:D,project_uDevicePixelRatio:e,project_uFocalDistance:N,project_uCommonUnitsPerMeter:M.unitsPerMeter,project_uCommonUnitsPerWorldUnit:M.unitsPerMeter,project_uCommonUnitsPerWorldUnit2:VP,project_uScale:t.scale,project_uWrapLongitude:!1,project_uViewProjectionMatrix:u,project_uModelMatrix:Qv,project_uCameraPosition:a};if(A){const re=t.getDistanceScales(A);switch(i){case Xt.METER_OFFSETS:U.project_uCommonUnitsPerWorldUnit=re.unitsPerMeter,U.project_uCommonUnitsPerWorldUnit2=re.unitsPerMeter2;break;case Xt.LNGLAT:case Xt.LNGLAT_OFFSETS:t._pseudoMeters||(U.project_uCommonUnitsPerMeter=re.unitsPerMeter),U.project_uCommonUnitsPerWorldUnit=re.unitsPerDegree,U.project_uCommonUnitsPerWorldUnit2=re.unitsPerDegree2;break;case Xt.CARTESIAN:U.project_uCommonUnitsPerWorldUnit=[1,1,re.unitsPerMeter[2]],U.project_uCommonUnitsPerWorldUnit2=[0,0,re.unitsPerMeter2[2]];break}}return U}const WP={};function XP(t=WP){return"viewport"in t?GP(t):{}}const Cg={name:"project",dependencies:[WM,OP],vs:LP,getUniforms:XP},Ig={name:"project32",dependencies:[Cg],vs:`
vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`};function qP(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function Ql(t,e){const i=Uh([],e,t);return Uv(i,i,1/i[3]),i}function ix(t,e){const i=t%e;return i<0?e+i:i}function Mg(t,e,i){return t<e?e:t>i?i:t}function ZP(t){return Math.log(t)*Math.LOG2E}const Rg=Math.log2||ZP;function bo(t,e){if(!t)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}const xn=Math.PI,rx=xn/4,en=xn/180,Pg=180/xn,ec=512,nf=4003e4,of=85.051129,KP=1.5;function YP(t){return Rg(t)}function jh(t){const[e,i]=t;bo(Number.isFinite(e)),bo(Number.isFinite(i)&&i>=-90&&i<=90,"invalid latitude");const r=e*en,o=i*en,u=ec*(r+xn)/(2*xn),d=ec*(xn+Math.log(Math.tan(rx+o*.5)))/(2*xn);return[u,d]}function tc(t){const[e,i]=t,r=e/ec*(2*xn)-xn,o=2*(Math.atan(Math.exp(i/ec*(2*xn)-xn))-rx);return[r*Pg,o*Pg]}function JP(t){const{latitude:e}=t;bo(Number.isFinite(e));const i=Math.cos(e*en);return YP(nf*i)-9}function af(t){const e=Math.cos(t*en);return ec/nf/e}function Bg(t){const{latitude:e,longitude:i,highPrecision:r=!1}=t;bo(Number.isFinite(e)&&Number.isFinite(i));const o=ec,u=Math.cos(e*en),d=o/360,a=d/u,x=o/nf/u,A={unitsPerMeter:[x,x,x],metersPerUnit:[1/x,1/x,1/x],unitsPerDegree:[d,a,x],degreesPerUnit:[1/d,1/a,1/x]};if(r){const M=en*Math.tan(e*en)/u,D=d*M/2,N=o/nf*M,U=N/a*x;A.unitsPerDegree2=[0,D,N],A.unitsPerMeter2=[U,0,U]}return A}function sx(t,e){const[i,r,o]=t,[u,d,a]=e,{unitsPerMeter:x,unitsPerMeter2:A}=Bg({longitude:i,latitude:r,highPrecision:!0}),M=jh(t);M[0]+=u*(x[0]+A[0]*d),M[1]+=d*(x[1]+A[1]*d);const D=tc(M),N=(o||0)+(a||0);return Number.isFinite(o)||Number.isFinite(a)?[D[0],D[1],N]:D}function QP(t){const{height:e,pitch:i,bearing:r,altitude:o,scale:u,center:d}=t,a=qP();ef(a,a,[0,0,-o]),Nv(a,a,-i*en),Lv(a,a,r*en);const x=u/e;return yg(a,a,[x,x,x]),d&&ef(a,a,mR([],d)),a}function e3(t){const{width:e,height:i,altitude:r,pitch:o=0,offset:u,center:d,scale:a,nearZMultiplier:x=1,farZMultiplier:A=1}=t;let{fovy:M=lf(KP)}=t;r!==void 0&&(M=lf(r));const D=M*en,N=o*en,U=nx(M);let re=U;d&&(re+=d[2]*a/Math.cos(N)/i);const ne=D*(.5+(u?u[1]:0)/i),xe=Math.sin(ne)*re/Math.sin(Mg(Math.PI/2-N-ne,.01,Math.PI-.01)),Ae=Math.sin(N)*xe+re,Te=re*10,Ie=Math.min(Ae*A,Te);return{fov:D,aspect:e/i,focalDistance:U,near:x,far:Ie}}function lf(t){return 2*Math.atan(.5/t)*Pg}function nx(t){return .5/Math.tan(.5*t*en)}function ox(t,e){const[i,r,o=0]=t;return bo(Number.isFinite(i)&&Number.isFinite(r)&&Number.isFinite(o)),Ql(e,[i,r,o,1])}function Dg(t,e,i=0){const[r,o,u]=t;if(bo(Number.isFinite(r)&&Number.isFinite(o),"invalid pixel coordinate"),Number.isFinite(u))return Ql(e,[r,o,u,1]);const d=Ql(e,[r,o,0,1]),a=Ql(e,[r,o,1,1]),x=d[2],A=a[2],M=x===A?0:((i||0)-x)/(A-x);return Tv([],d,a,M)}function t3(t){const{width:e,height:i,bounds:r,minExtent:o=0,maxZoom:u=24,offset:d=[0,0]}=t,[[a,x],[A,M]]=r,D=i3(t.padding),N=jh([a,Mg(M,-of,of)]),U=jh([A,Mg(x,-of,of)]),re=[Math.max(Math.abs(U[0]-N[0]),o),Math.max(Math.abs(U[1]-N[1]),o)],ne=[e-D.left-D.right-Math.abs(d[0])*2,i-D.top-D.bottom-Math.abs(d[1])*2];bo(ne[0]>0&&ne[1]>0);const xe=ne[0]/re[0],Ae=ne[1]/re[1],Te=(D.right-D.left)/2/xe,Ie=(D.top-D.bottom)/2/Ae,Ue=[(U[0]+N[0])/2+Te,(U[1]+N[1])/2+Ie],Xe=tc(Ue),qe=Math.min(u,Rg(Math.abs(Math.min(xe,Ae))));return bo(Number.isFinite(qe)),{longitude:Xe[0],latitude:Xe[1],zoom:qe}}function i3(t=0){return typeof t=="number"?{top:t,bottom:t,left:t,right:t}:(bo(Number.isFinite(t.top)&&Number.isFinite(t.bottom)&&Number.isFinite(t.left)&&Number.isFinite(t.right)),t)}const ax=Math.PI/180;function r3(t,e=0){const{width:i,height:r,unproject:o}=t,u={targetZ:e},d=o([0,r],u),a=o([i,r],u);let x,A;const M=t.fovy?.5*t.fovy*ax:Math.atan(.5/t.altitude),D=(90-t.pitch)*ax;return M>D-.01?(x=lx(t,0,e),A=lx(t,i,e)):(x=o([0,0],u),A=o([i,0],u)),[d,a,A,x]}function lx(t,e,i){const{pixelUnprojectionMatrix:r}=t,o=Ql(r,[e,0,1,1]),u=Ql(r,[e,t.height,1,1]),a=(i*t.distanceScales.unitsPerMeter[2]-o[2])/(u[2]-o[2]),x=Tv([],o,u,a),A=tc(x);return A.push(i),A}const cx=512;function s3(t){const{width:e,height:i,pitch:r=0}=t;let{longitude:o,latitude:u,zoom:d,bearing:a=0}=t;(o<-180||o>180)&&(o=ix(o+180,360)-180),(a<-180||a>180)&&(a=ix(a+180,360)-180);const x=Rg(i/cx);if(d<=x)d=x,u=0;else{const A=i/2/Math.pow(2,d),M=tc([0,A])[1];if(u<M)u=M;else{const D=tc([0,cx-A])[1];u>D&&(u=D)}}return{width:e,height:i,longitude:o,latitude:u,zoom:d,pitch:r,bearing:a}}const n3=`
const int max_lights = 2;
uniform mat4 shadow_uViewProjectionMatrices[max_lights];
uniform vec4 shadow_uProjectCenters[max_lights];
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform int shadow_uLightId;
uniform float shadow_uLightCount;

out vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  if (shadow_uDrawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[shadow_uLightId], shadow_uProjectCenters[shadow_uLightId]);
  }
  if (shadow_uUseShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow_uLightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[i], shadow_uProjectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,o3=`
const int max_lights = 2;
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;
uniform vec4 shadow_uColor;
uniform float shadow_uLightCount;

in vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow_uDrawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow_uUseShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow_uLightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow_uColor.a / shadow_uLightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow_uColor.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,a3=Vh(d3),l3=Vh(f3),c3=[0,0,0,1],h3=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function u3(t,e){const[i,r,o]=t,u=Dg([i,r,o],e);return Number.isFinite(o)?u:[u[0],u[1],0]}function d3({viewport:t,center:e}){return new $t(t.viewProjectionMatrix).invert().transform(e)}function f3({viewport:t,shadowMatrices:e}){const i=[],r=t.pixelUnprojectionMatrix,o=t.isGeospatial?void 0:1,u=[[0,0,o],[t.width,0,o],[0,t.height,o],[t.width,t.height,o],[0,0,-1],[t.width,0,-1],[0,t.height,-1],[t.width,t.height,-1]].map(d=>u3(d,r));for(const d of e){const a=d.clone().translate(new De(t.center).negate()),x=u.map(M=>a.transform(M)),A=new $t().ortho({left:Math.min(...x.map(M=>M[0])),right:Math.max(...x.map(M=>M[0])),bottom:Math.min(...x.map(M=>M[1])),top:Math.max(...x.map(M=>M[1])),near:Math.min(...x.map(M=>-M[2])),far:Math.max(...x.map(M=>-M[2]))});i.push(A.multiplyRight(d))}return i}function p3(t,e){const{shadowEnabled:i=!0}=t;if(!i||!t.shadowMatrices||!t.shadowMatrices.length)return{shadow_uDrawShadowMap:!1,shadow_uUseShadowMap:!1,shadow_uShadowMap0:t.dummyShadowMap,shadow_uShadowMap1:t.dummyShadowMap};const r={shadow_uDrawShadowMap:!!t.drawToShadowMap,shadow_uUseShadowMap:t.shadowMaps?t.shadowMaps.length>0:!1,shadow_uColor:t.shadowColor||c3,shadow_uLightId:t.shadowLightId||0,shadow_uLightCount:t.shadowMatrices.length},o=a3({viewport:t.viewport,center:e.project_uCenter}),u=[],d=l3({shadowMatrices:t.shadowMatrices,viewport:t.viewport}).slice();for(let a=0;a<t.shadowMatrices.length;a++){const x=d[a],A=x.clone().translate(new De(t.viewport.center).negate());e.project_uCoordinateSystem===Xt.LNGLAT&&e.project_uProjectionMode===Hn.WEB_MERCATOR?(d[a]=A,u[a]=o):(d[a]=x.clone().multiplyRight(h3),u[a]=A.transform(o))}for(let a=0;a<d.length;a++)r[`shadow_uViewProjectionMatrices[${a}]`]=d[a],r[`shadow_uProjectCenters[${a}]`]=u[a];for(let a=0;a<2;a++)r[`shadow_uShadowMap${a}`]=t.shadowMaps&&t.shadowMaps[a]||t.dummyShadowMap;return r}const hx={name:"shadow",dependencies:[Cg],vs:n3,fs:o3,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:(t={},e={})=>"viewport"in t&&(t.drawToShadowMap||t.shadowMaps&&t.shadowMaps.length>0)?p3(t,e):{}},Og={...vv,defaultUniforms:{...vv.defaultUniforms,useFloatColors:!1},inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}}},_3=[Cg],g3=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"];function m3(){const t=Od.getDefaultShaderAssembler();for(const e of _3)t.addDefaultModule(e);for(const e of g3)t.addShaderHook(e);return t}const y3=[255,255,255],b3=1;let v3=0;class x3{constructor(e={}){this.type="ambient";const{color:i=y3}=e,{intensity:r=b3}=e;this.id=e.id||`ambient-${v3++}`,this.color=i,this.intensity=r}}const w3=[255,255,255],T3=1,A3=[0,0,-1];let E3=0;class ux{constructor(e={}){this.type="directional";const{color:i=w3}=e,{intensity:r=T3}=e,{direction:o=A3}=e,{_shadow:u=!1}=e;this.id=e.id||`directional-${E3++}`,this.color=i,this.intensity=r,this.type="directional",this.direction=new De(o).normalize().toArray(),this.shadow=u}getProjectedLight(e){return this}}class S3{constructor(e,i={id:"pass"}){const{id:r}=i;this.id=r,this.device=e,this.props={...i}}setProps(e){Object.assign(this.props,e)}render(e){}cleanup(){}}class Fg extends S3{constructor(){super(...arguments),this._lastRenderIndex=-1}render(e){const[i,r]=this.device.canvasContext.getDrawingBufferSize(),o=e.clearCanvas??!0,u=e.clearColor??(o?[0,0,0,0]:!1),d=o?1:!1,a=o?0:!1,x=e.colorMask??15,A={viewport:[0,0,i,r]};e.colorMask&&(A.colorMask=x),e.scissorRect&&(A.scissorRect=e.scissorRect);const M=this.device.beginRenderPass({framebuffer:e.target,parameters:A,clearColor:u,clearDepth:d,clearStencil:a});try{return this._drawLayers(M,e)}finally{M.end()}}_drawLayers(e,i){const{target:r,moduleParameters:o,viewports:u,views:d,onViewportActive:a,clearStack:x=!0}=i;i.pass=i.pass||"unknown",x&&(this._lastRenderIndex=-1);const A=[];for(const M of u){const D=d&&d[M.id];a==null||a(M);const N=this._getDrawLayerParams(M,i),U=M.subViewports||[M];for(const re of U){const ne=this._drawLayersInViewport(e,{target:r,moduleParameters:o,viewport:re,view:D,pass:i.pass,layers:i.layers},N);A.push(ne)}}return A}_getDrawLayerParams(e,{layers:i,pass:r,isPicking:o=!1,layerFilter:u,cullRect:d,effects:a,moduleParameters:x},A=!1){var re;const M=[],D=dx(this._lastRenderIndex+1),N={layer:i[0],viewport:e,isPicking:o,renderPass:r,cullRect:d},U={};for(let ne=0;ne<i.length;ne++){const xe=i[ne],Ae=this._shouldDrawLayer(xe,N,u,U),Te={shouldDrawLayer:Ae};Ae&&!A&&(Te.layerRenderIndex=D(xe,Ae),Te.moduleParameters=this._getModuleParameters(xe,a,r,x),Te.layerParameters={...(re=xe.context.deck)==null?void 0:re.props.parameters,...this.getLayerParameters(xe,ne,e)}),M[ne]=Te}return M}_drawLayersInViewport(e,{layers:i,moduleParameters:r,pass:o,target:u,viewport:d,view:a},x){const A=C3(this.device,{moduleParameters:r,target:u,viewport:d});if(a&&a.props.clear){const D=a.props.clear===!0?{color:!0,depth:!0}:a.props.clear;this.device.withParametersWebGL({scissorTest:!0,scissor:A},()=>this.device.clearWebGL(D))}const M={totalCount:i.length,visibleCount:0,compositeCount:0,pickableCount:0};e.setParameters({viewport:A});for(let D=0;D<i.length;D++){const N=i[D],{shouldDrawLayer:U,layerRenderIndex:re,moduleParameters:ne,layerParameters:xe}=x[D];if(U&&N.props.pickable&&M.pickableCount++,N.isComposite)M.compositeCount++;else if(U){M.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,re),ne.viewport=d,N.context.renderPass=e;try{N._drawLayer({renderPass:e,moduleParameters:ne,uniforms:{layerIndex:re},parameters:xe})}catch(Ae){N.raiseError(Ae,`drawing ${N} to ${o}`)}}}return M}shouldDrawLayer(e){return!0}getModuleParameters(e,i){return null}getLayerParameters(e,i,r){return e.props.parameters}_shouldDrawLayer(e,i,r,o){if(!(e.props.visible&&this.shouldDrawLayer(e)))return!1;i.layer=e;let d=e.parent;for(;d;){if(!d.props.visible||!d.filterSubLayer(i))return!1;i.layer=d,d=d.parent}if(r){const a=i.layer.id;if(a in o||(o[a]=r(i)),!o[a])return!1}return e.activateViewport(i.viewport),!0}_getModuleParameters(e,i,r,o){var a,x;const u=this.device.canvasContext.cssToDeviceRatio(),d=Object.assign(Object.create(((a=e.internalState)==null?void 0:a.propsInTransition)||e.props),{autoWrapLongitude:e.wrapLongitude,viewport:e.context.viewport,mousePosition:e.context.mousePosition,picking:{isActive:0},devicePixelRatio:u});if(i)for(const A of i)Object.assign(d,(x=A.getModuleParameters)==null?void 0:x.call(A,e));return Object.assign(d,this.getModuleParameters(e,i),o)}}function dx(t=0,e={}){const i={},r=(o,u)=>{const d=o.props._offset,a=o.id,x=o.parent&&o.parent.id;let A;if(x&&!(x in e)&&r(o.parent,!1),x in i){const M=i[x]=i[x]||dx(e[x],e);A=M(o,u),i[a]=M}else Number.isFinite(d)?(A=d+(e[x]||0),i[a]=null):A=t;return u&&A>=t&&(t=A+1),e[a]=A,A};return r}function C3(t,{moduleParameters:e,target:i,viewport:r}){const o=e&&e.devicePixelRatio||t.canvasContext.cssToDeviceRatio(),[,u]=t.canvasContext.getDrawingBufferSize(),d=i?i.height:u,a=r;return[a.x*o,d-(a.y+a.height)*o,a.width*o,a.height*o]}class I3 extends Fg{constructor(e,i){super(e,i),this.shadowMap=e.createTexture({width:1,height:1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}}),this.depthBuffer=e.createTexture({format:"depth16unorm",width:1,height:1,mipmaps:!1,dataFormat:6402,type:5125}),this.fbo=e.createFramebuffer({id:"shadowmap",width:1,height:1,colorAttachments:[this.shadowMap],depthStencilAttachment:this.depthBuffer})}render(e){const i=this.fbo,r=this.device.canvasContext.cssToDeviceRatio(),o=e.viewports[0],u=o.width*r,d=o.height*r,a=[1,1,1,1];(u!==i.width||d!==i.height)&&i.resize({width:u,height:d}),super.render({...e,clearColor:a,target:i,pass:"shadow"})}getLayerParameters(e,i,r){return{...e.props.parameters,blend:!1,depthRange:[0,1],depthTest:!0}}shouldDrawLayer(e){return e.props.shadowEnabled!==!1}getModuleParameters(){return{drawToShadowMap:!0}}delete(){this.fbo&&(this.fbo.destroy(),this.fbo=null),this.shadowMap&&(this.shadowMap.destroy(),this.shadowMap=null),this.depthBuffer&&(this.depthBuffer.destroy(),this.depthBuffer=null)}}const M3={color:[255,255,255],intensity:1},fx=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],R3=[0,0,0,200/255];class px{constructor(e={}){this.id="lighting-effect",this.shadowColor=R3,this.shadow=!1,this.ambientLight=null,this.directionalLights=[],this.pointLights=[],this.shadowPasses=[],this.shadowMaps=[],this.dummyShadowMap=null,this.setProps(e)}setup(e){this.context=e;const{device:i,deck:r}=e;this.shadow&&!this.dummyShadowMap&&(this._createShadowPasses(i),r._addDefaultShaderModule(hx),this.dummyShadowMap=i.createTexture({width:1,height:1}))}setProps(e){this.ambientLight=null,this.directionalLights=[],this.pointLights=[];for(const i in e){const r=e[i];switch(r.type){case"ambient":this.ambientLight=r;break;case"directional":this.directionalLights.push(r);break;case"point":this.pointLights.push(r);break}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(i=>i.shadow),this.context&&this.setup(this.context),this.props=e}preRender({layers:e,layerFilter:i,viewports:r,onViewportActive:o,views:u}){if(this.shadow){this.shadowMatrices=this._calculateMatrices();for(let d=0;d<this.shadowPasses.length;d++)this.shadowPasses[d].render({layers:e,layerFilter:i,viewports:r,onViewportActive:o,views:u,moduleParameters:{shadowLightId:d,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}})}}getModuleParameters(e){const i=this.shadow?{shadowMaps:this.shadowMaps,dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{};return i.lightSources={ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(r=>r.getProjectedLight({layer:e})),pointLights:this.pointLights.map(r=>r.getProjectedLight({layer:e}))},i}cleanup(e){for(const i of this.shadowPasses)i.delete();this.shadowPasses.length=0,this.shadowMaps.length=0,this.dummyShadowMap&&(this.dummyShadowMap.destroy(),this.dummyShadowMap=null,e.deck._removeDefaultShaderModule(hx))}_calculateMatrices(){const e=[];for(const i of this.directionalLights){const r=new $t().lookAt({eye:new De(i.direction).negate()});e.push(r)}return e}_createShadowPasses(e){for(let i=0;i<this.directionalLights.length;i++){const r=new I3(e);this.shadowPasses[i]=r,this.shadowMaps[i]=r.shadowMap}}_applyDefaultLights(){const{ambientLight:e,pointLights:i,directionalLights:r}=this;!e&&i.length===0&&r.length===0&&(this.ambientLight=new x3(M3),this.directionalLights.push(new ux(fx[0]),new ux(fx[1])))}}class P3{constructor(e={}){this._pool=[],this.opts={overAlloc:2,poolSize:100},this.setOptions(e)}setOptions(e){Object.assign(this.opts,e)}allocate(e,i,{size:r=1,type:o,padding:u=0,copy:d=!1,initialize:a=!1,maxCount:x}){const A=o||e&&e.constructor||Float32Array,M=i*r+u;if(ArrayBuffer.isView(e)){if(M<=e.length)return e;if(M*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new A(e.buffer,0,M)}let D=1/0;x&&(D=x*r+u);const N=this._allocate(A,M,a,D);return e&&d?N.set(e):a||N.fill(0,0,4),this._release(e),N}release(e){this._release(e)}_allocate(e,i,r,o){let u=Math.max(Math.ceil(i*this.opts.overAlloc),1);u>o&&(u=o);const d=this._pool,a=e.BYTES_PER_ELEMENT*u,x=d.findIndex(A=>A.byteLength>=a);if(x>=0){const A=new e(d.splice(x,1)[0],0,u);return r&&A.fill(0),A}return new e(u)}_release(e){if(!ArrayBuffer.isView(e))return;const i=this._pool,{buffer:r}=e,{byteLength:o}=r,u=i.findIndex(d=>d.byteLength>=o);u<0?i.push(r):(u>0||i.length<this.opts.poolSize)&&i.splice(u,0,r),i.length>this.opts.poolSize&&i.shift()}}const Hh=new P3;function Gh(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function B3(t){return[t[12],t[13],t[14]]}function D3(t){return{left:ic(t[3]+t[0],t[7]+t[4],t[11]+t[8],t[15]+t[12]),right:ic(t[3]-t[0],t[7]-t[4],t[11]-t[8],t[15]-t[12]),bottom:ic(t[3]+t[1],t[7]+t[5],t[11]+t[9],t[15]+t[13]),top:ic(t[3]-t[1],t[7]-t[5],t[11]-t[9],t[15]-t[13]),near:ic(t[3]+t[2],t[7]+t[6],t[11]+t[10],t[15]+t[14]),far:ic(t[3]-t[2],t[7]-t[6],t[11]-t[10],t[15]-t[14])}}const _x=new De;function ic(t,e,i,r){_x.set(t,e,i);const o=_x.len();return{distance:r/o,normal:new De(-t/o,-e/o,-i/o)}}function O3(t){return t-Math.fround(t)}let $h;function kg(t,e){const{size:i=1,startIndex:r=0}=e,o=e.endIndex!==void 0?e.endIndex:t.length,u=(o-r)/i;$h=Hh.allocate($h,u,{type:Float32Array,size:i*2});let d=r,a=0;for(;d<o;){for(let x=0;x<i;x++){const A=t[d++];$h[a+x]=A,$h[a+x+i]=O3(A)}a+=i*2}return $h.subarray(0,u*i*2)}function F3(t){let e=null,i=!1;for(const r of t)r&&(e?(i||(e=[[e[0][0],e[0][1]],[e[1][0],e[1][1]]],i=!0),e[0][0]=Math.min(e[0][0],r[0][0]),e[0][1]=Math.min(e[0][1],r[0][1]),e[1][0]=Math.max(e[1][0],r[1][0]),e[1][1]=Math.max(e[1][1],r[1][1])):e=r);return e}const k3=Math.PI/180,N3=Gh(),gx=[0,0,0],L3={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function U3({width:t,height:e,orthographic:i,fovyRadians:r,focalDistance:o,padding:u,near:d,far:a}){const x=t/e,A=i?new $t().orthographic({fovy:r,aspect:x,focalDistance:o,near:d,far:a}):new $t().perspective({fovy:r,aspect:x,near:d,far:a});if(u){const{left:M=0,right:D=0,top:N=0,bottom:U=0}=u,re=yo((M+t-D)/2,0,t)-t/2,ne=yo((N+e-U)/2,0,e)-e/2;A[8]-=re*2/t,A[9]+=ne*2/e}return A}class Wh{constructor(e={}){this._frustumPlanes={},this.id=e.id||this.constructor.displayName||"viewport",this.x=e.x||0,this.y=e.y||0,this.width=e.width||1,this.height=e.height||1,this.zoom=e.zoom||0,this.padding=e.padding,this.distanceScales=e.distanceScales||L3,this.focalDistance=e.focalDistance||1,this.position=e.position||gx,this.modelMatrix=e.modelMatrix||null;const{longitude:i,latitude:r}=e;this.isGeospatial=Number.isFinite(r)&&Number.isFinite(i),this._initProps(e),this._initMatrices(e),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?Hn.WEB_MERCATOR:Hn.WEB_MERCATOR_AUTO_OFFSET:Hn.IDENTITY}equals(e){return e instanceof Wh?this===e?!0:e.width===this.width&&e.height===this.height&&e.scale===this.scale&&yn(e.projectionMatrix,this.projectionMatrix)&&yn(e.viewMatrix,this.viewMatrix):!1}project(e,{topLeft:i=!0}={}){const r=this.projectPosition(e),o=ox(r,this.pixelProjectionMatrix),[u,d]=o,a=i?d:this.height-d;return e.length===2?[u,a]:[u,a,o[2]]}unproject(e,{topLeft:i=!0,targetZ:r}={}){const[o,u,d]=e,a=i?u:this.height-u,x=r&&r*this.distanceScales.unitsPerMeter[2],A=Dg([o,a,d],this.pixelUnprojectionMatrix,x),[M,D,N]=this.unprojectPosition(A);return Number.isFinite(d)?[M,D,N]:Number.isFinite(r)?[M,D,r]:[M,D]}projectPosition(e){const[i,r]=this.projectFlat(e),o=(e[2]||0)*this.distanceScales.unitsPerMeter[2];return[i,r,o]}unprojectPosition(e){const[i,r]=this.unprojectFlat(e),o=(e[2]||0)*this.distanceScales.metersPerUnit[2];return[i,r,o]}projectFlat(e){if(this.isGeospatial){const i=jh(e);return i[1]=yo(i[1],-318,830),i}return e}unprojectFlat(e){return this.isGeospatial?tc(e):e}getBounds(e={}){const i={targetZ:e.z||0},r=this.unproject([0,0],i),o=this.unproject([this.width,0],i),u=this.unproject([0,this.height],i),d=this.unproject([this.width,this.height],i);return[Math.min(r[0],o[0],u[0],d[0]),Math.min(r[1],o[1],u[1],d[1]),Math.max(r[0],o[0],u[0],d[0]),Math.max(r[1],o[1],u[1],d[1])]}getDistanceScales(e){return e?Bg({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}containsPixel({x:e,y:i,width:r=1,height:o=1}){return e<this.x+this.width&&this.x<e+r&&i<this.y+this.height&&this.y<i+o}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,D3(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(e,i){return null}_initProps(e){const i=e.longitude,r=e.latitude;this.isGeospatial&&(Number.isFinite(e.zoom)||(this.zoom=JP({latitude:r})+Math.log2(this.focalDistance)),this.distanceScales=e.distanceScales||Bg({latitude:r,longitude:i}));const o=Math.pow(2,this.zoom);this.scale=o;const{position:u,modelMatrix:d}=e;let a=gx;if(u&&(a=d?new $t(d).transformAsVector(u,[]):u),this.isGeospatial){const x=this.projectPosition([i,r,0]);this.center=new De(a).scale(this.distanceScales.unitsPerMeter).add(x)}else this.center=this.projectPosition(a)}_initMatrices(e){const{viewMatrix:i=N3,projectionMatrix:r=null,orthographic:o=!1,fovyRadians:u,fovy:d=75,near:a=.1,far:x=1e3,padding:A=null,focalDistance:M=1}=e;this.viewMatrixUncentered=i,this.viewMatrix=new $t().multiplyRight(i).translate(new De(this.center).negate()),this.projectionMatrix=r||U3({width:this.width,height:this.height,orthographic:o,fovyRadians:u||d*k3,focalDistance:M,padding:A,near:a,far:x});const D=Gh();Ha(D,D,this.projectionMatrix),Ha(D,D,this.viewMatrix),this.viewProjectionMatrix=D,this.viewMatrixInverse=mg([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=B3(this.viewMatrixInverse);const N=Gh(),U=Gh();yg(N,N,[this.width/2,-this.height/2,1]),ef(N,N,[1,-1,0]),Ha(U,N,this.viewProjectionMatrix),this.pixelProjectionMatrix=U,this.pixelUnprojectionMatrix=mg(Gh(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||Yt.warn("Pixel project matrix not invertible")()}}Wh.displayName="Viewport";class Ga extends Wh{constructor(e={}){const{latitude:i=0,longitude:r=0,zoom:o=0,pitch:u=0,bearing:d=0,nearZMultiplier:a=.1,farZMultiplier:x=1.01,nearZ:A,farZ:M,orthographic:D=!1,projectionMatrix:N,repeat:U=!1,worldOffset:re=0,position:ne,padding:xe,legacyMeterSizes:Ae=!1}=e;let{width:Te,height:Ie,altitude:Ue=1.5}=e;const Xe=Math.pow(2,o);Te=Te||1,Ie=Ie||1;let qe,ht=null;if(N)Ue=N[5]/2,qe=lf(Ue);else{e.fovy?(qe=e.fovy,Ue=nx(qe)):qe=lf(Ue);let nt;if(xe){const{top:at=0,bottom:bt=0}=xe;nt=[0,yo((at+Ie-bt)/2,0,Ie)-Ie/2]}ht=e3({width:Te,height:Ie,scale:Xe,center:ne&&[0,0,ne[2]*af(i)],offset:nt,pitch:u,fovy:qe,nearZMultiplier:a,farZMultiplier:x}),Number.isFinite(A)&&(ht.near=A),Number.isFinite(M)&&(ht.far=M)}let gt=QP({height:Ie,pitch:u,bearing:d,scale:Xe,altitude:Ue});re&&(gt=new $t().translate([512*re,0,0]).multiplyLeft(gt)),super({...e,width:Te,height:Ie,viewMatrix:gt,longitude:r,latitude:i,zoom:o,...ht,fovy:qe,focalDistance:Ue}),this.latitude=i,this.longitude=r,this.zoom=o,this.pitch=u,this.bearing=d,this.altitude=Ue,this.fovy=qe,this.orthographic=D,this._subViewports=U?[]:null,this._pseudoMeters=Ae,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const e=this.getBounds(),i=Math.floor((e[0]+180)/360),r=Math.ceil((e[2]-180)/360);for(let o=i;o<=r;o++){const u=o?new Ga({...this,worldOffset:o}):this;this._subViewports.push(u)}}return this._subViewports}projectPosition(e){if(this._pseudoMeters)return super.projectPosition(e);const[i,r]=this.projectFlat(e),o=(e[2]||0)*af(e[1]);return[i,r,o]}unprojectPosition(e){if(this._pseudoMeters)return super.unprojectPosition(e);const[i,r]=this.unprojectFlat(e),o=(e[2]||0)/af(r);return[i,r,o]}addMetersToLngLat(e,i){return sx(e,i)}panByPosition(e,i){const r=Dg(i,this.pixelUnprojectionMatrix),o=this.projectFlat(e),u=wv([],o,uR([],r)),d=wv([],this.center,u),[a,x]=this.unprojectFlat(d);return{longitude:a,latitude:x}}getBounds(e={}){const i=r3(this,e.z||0);return[Math.min(i[0][0],i[1][0],i[2][0],i[3][0]),Math.min(i[0][1],i[1][1],i[2][1],i[3][1]),Math.max(i[0][0],i[1][0],i[2][0],i[3][0]),Math.max(i[0][1],i[1][1],i[2][1],i[3][1])]}fitBounds(e,i={}){const{width:r,height:o}=this,{longitude:u,latitude:d,zoom:a}=t3({width:r,height:o,bounds:e,...i});return new Ga({width:r,height:o,longitude:u,latitude:d,zoom:a})}}Ga.displayName="WebMercatorViewport";const mx=[0,0,0];function Ng(t,e,i=!1){const r=e.projectPosition(t);if(i&&e instanceof Ga){const[o,u,d=0]=t,a=e.getDistanceScales([o,u]);r[2]=d*a.unitsPerMeter[2]}return r}function z3(t){const{viewport:e,modelMatrix:i,coordinateOrigin:r}=t;let{coordinateSystem:o,fromCoordinateSystem:u,fromCoordinateOrigin:d}=t;return o===Xt.DEFAULT&&(o=e.isGeospatial?Xt.LNGLAT:Xt.CARTESIAN),u===void 0&&(u=o),d===void 0&&(d=r),{viewport:e,coordinateSystem:o,coordinateOrigin:r,modelMatrix:i,fromCoordinateSystem:u,fromCoordinateOrigin:d}}function yx(t,{viewport:e,modelMatrix:i,coordinateSystem:r,coordinateOrigin:o,offsetMode:u}){let[d,a,x=0]=t;switch(i&&([d,a,x]=Uh([],[d,a,x,1],i)),r){case Xt.LNGLAT:return Ng([d,a,x],e,u);case Xt.LNGLAT_OFFSETS:return Ng([d+o[0],a+o[1],x+(o[2]||0)],e,u);case Xt.METER_OFFSETS:return Ng(sx(o,[d,a,x]),e,u);case Xt.CARTESIAN:default:return e.isGeospatial?[d+o[0],a+o[1],x+o[2]]:e.projectPosition([d,a,x])}}function V3(t,e){const{viewport:i,coordinateSystem:r,coordinateOrigin:o,modelMatrix:u,fromCoordinateSystem:d,fromCoordinateOrigin:a}=z3(e),{autoOffset:x=!0}=e,{geospatialOrigin:A=mx,shaderCoordinateOrigin:M=mx,offsetMode:D=!1}=x?tx(i,r,o):{},N=yx(t,{viewport:i,modelMatrix:u,coordinateSystem:d,coordinateOrigin:a,offsetMode:D});if(D){const U=i.projectPosition(A||M);TR(N,N,U)}return N}let j3=1,H3=1;class bx{constructor(){L(this,"time",0);L(this,"channels",new Map);L(this,"animations",new Map);L(this,"playing",!1);L(this,"lastEngineTime",-1)}addChannel(e){const{delay:i=0,duration:r=Number.POSITIVE_INFINITY,rate:o=1,repeat:u=1}=e,d=j3++,a={time:0,delay:i,duration:r,rate:o,repeat:u};return this._setChannelTime(a,this.time),this.channels.set(d,a),d}removeChannel(e){this.channels.delete(e);for(const[i,r]of this.animations)r.channel===e&&this.detachAnimation(i)}isFinished(e){const i=this.channels.get(e);return i===void 0?!1:this.time>=i.delay+i.duration*i.repeat}getTime(e){if(e===void 0)return this.time;const i=this.channels.get(e);return i===void 0?-1:i.time}setTime(e){this.time=Math.max(0,e);const i=this.channels.values();for(const o of i)this._setChannelTime(o,this.time);const r=this.animations.values();for(const o of r){const{animation:u,channel:d}=o;u.setTime(this.getTime(d))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,i){const r=H3++;return this.animations.set(r,{animation:e,channel:i}),e.setTime(this.getTime(i)),r}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,i){const r=i-e.delay,o=e.duration*e.repeat;r>=o?e.time=e.duration*e.rate:(e.time=Math.max(0,r)%e.duration,e.time*=e.rate)}}let G3=0;const $3={device:null,onAddHTML:()=>"",onInitialize:async()=>null,onRender:()=>{},onFinalize:()=>{},onError:t=>console.error(t),stats:ql.stats.get(`animation-loop-${G3++}`),useDevicePixels:!0,autoResizeViewport:!1,autoResizeDrawingBuffer:!1};class W3{constructor(e){L(this,"device",null);L(this,"canvas",null);L(this,"props");L(this,"animationProps",null);L(this,"timeline",null);L(this,"stats");L(this,"cpuTime");L(this,"gpuTime");L(this,"frameRate");L(this,"display");L(this,"needsRedraw","initialized");L(this,"_initialized",!1);L(this,"_running",!1);L(this,"_animationFrameId",null);L(this,"_nextFramePromise",null);L(this,"_resolveNextFrame",null);L(this,"_cpuStartTime",0);if(this.props={...$3,...e},e=this.props,!e.device)throw new Error("No device provided");const{useDevicePixels:i=!0}=this.props;this.stats=e.stats||new Wl({id:"animation-loop-stats"}),this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this.setProps({autoResizeViewport:e.autoResizeViewport,autoResizeDrawingBuffer:e.autoResizeDrawingBuffer,useDevicePixels:i}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}destroy(){this.stop(),this._setDisplay(null)}delete(){this.destroy()}setNeedsRedraw(e){return this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.props.autoResizeViewport=e.autoResizeViewport||!1),"autoResizeDrawingBuffer"in e&&(this.props.autoResizeDrawingBuffer=e.autoResizeDrawingBuffer||!1),"useDevicePixels"in e&&(this.props.useDevicePixels=e.useDevicePixels||!1),this}async start(){if(this._running)return this;this._running=!0;try{let e;return this._initialized||(this._initialized=!0,await this._initDevice(),this._initialize(),await this.props.onInitialize(this._getAnimationProps())),this._running?(e!==!1&&(this._cancelAnimationFrame(),this._requestAnimationFrame()),this):null}catch(e){const i=e instanceof Error?e:new Error("Unknown error");throw this.props.onError(i),i}}stop(){return this._running&&(this.animationProps&&this.props.onFinalize(this.animationProps),this._cancelAnimationFrame(),this._nextFramePromise=null,this._resolveNextFrame=null,this._running=!1),this}redraw(){var e;return(e=this.device)!=null&&e.isLost?this:(this._beginFrameTimers(),this._setupFrame(),this._updateAnimationProps(),this._renderFrame(this._getAnimationProps()),this._clearNeedsRedraw(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endFrameTimers(),this)}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(e=>{this._resolveNextFrame=e})),this._nextFramePromise}async toDataURL(){if(this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.canvas instanceof HTMLCanvasElement)return this.canvas.toDataURL();throw new Error("OffscreenCanvas")}_initialize(){this._startEventHandling(),this._initializeAnimationProps(),this._updateAnimationProps(),this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_setDisplay(e){this.display&&(this.display.destroy(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_requestAnimationFrame(){this._running&&(this._animationFrameId=nM(this._animationFrame.bind(this)))}_cancelAnimationFrame(){this._animationFrameId!==null&&(oM(this._animationFrameId),this._animationFrameId=null)}_animationFrame(){this._running&&(this.redraw(),this._requestAnimationFrame())}_renderFrame(e){if(this.display){this.display._renderFrame(e);return}this.props.onRender(this._getAnimationProps()),this.device.submit()}_clearNeedsRedraw(){this.needsRedraw=!1}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_initializeAnimationProps(){var e,i;if(!this.device)throw new Error("loop");this.animationProps={animationLoop:this,device:this.device,canvas:(i=(e=this.device)==null?void 0:e.canvasContext)==null?void 0:i.canvas,timeline:this.timeline,useDevicePixels:this.props.useDevicePixels,needsRedraw:!1,width:1,height:1,aspect:1,time:0,startTime:Date.now(),engineTime:0,tick:0,tock:0,_mousePosition:null}}_getAnimationProps(){if(!this.animationProps)throw new Error("animationProps");return this.animationProps}_updateAnimationProps(){if(!this.animationProps)return;const{width:e,height:i,aspect:r}=this._getSizeAndAspect();(e!==this.animationProps.width||i!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),r!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=i,this.animationProps.aspect=r,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime}async _initDevice(){var e;if(this.device=await this.props.device,!this.device)throw new Error("No device provided");this.canvas=((e=this.device.canvasContext)==null?void 0:e.canvas)||null}_createInfoDiv(){if(this.canvas&&this.props.onAddHTML){const e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";const i=document.createElement("div");i.style.position="absolute",i.style.left="10px",i.style.bottom="10px",i.style.width="300px",i.style.background="white",this.canvas instanceof HTMLCanvasElement&&e.appendChild(this.canvas),e.appendChild(i);const r=this.props.onAddHTML(i);r&&(i.innerHTML=r)}}_getSizeAndAspect(){var u,d,a,x;if(!this.device)return{width:1,height:1,aspect:1};const[e,i]=((d=(u=this.device)==null?void 0:u.canvasContext)==null?void 0:d.getPixelSize())||[1,1];let r=1;const o=(x=(a=this.device)==null?void 0:a.canvasContext)==null?void 0:x.canvas;return o&&o.clientHeight?r=o.clientWidth/o.clientHeight:e>0&&i>0&&(r=e/i),{width:e,height:i,aspect:r}}_resizeViewport(){this.props.autoResizeViewport&&this.device.gl&&this.device.gl.viewport(0,0,this.device.gl.drawingBufferWidth,this.device.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){var e,i;this.props.autoResizeDrawingBuffer&&((i=(e=this.device)==null?void 0:e.canvasContext)==null||i.resize({useDevicePixels:this.props.useDevicePixels}))}_beginFrameTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this.cpuTime.timeStart()}_endFrameTimers(){this.cpuTime.timeEnd()}_startEventHandling(){this.canvas&&(this.canvas.addEventListener("mousemove",this._onMousemove.bind(this)),this.canvas.addEventListener("mouseleave",this._onMouseleave.bind(this)))}_onMousemove(e){e instanceof MouseEvent&&(this._getAnimationProps()._mousePosition=[e.offsetX,e.offsetY])}_onMouseleave(e){this._getAnimationProps()._mousePosition=null}}class vx{constructor(e){L(this,"id");L(this,"userData",{});L(this,"topology");L(this,"bufferLayout",[]);L(this,"vertexCount");L(this,"indices");L(this,"attributes");this.id=e.id||Wo("geometry"),this.topology=e.topology,this.indices=e.indices||null,this.attributes=e.attributes,this.vertexCount=e.vertexCount,this.bufferLayout=e.bufferLayout||[],this.indices&&ti(this.indices.usage===Fi.INDEX)}destroy(){var e;(e=this.indices)==null||e.destroy();for(const i of Object.values(this.attributes))i.destroy()}getVertexCount(){return this.vertexCount}getAttributes(){return this.attributes}getIndexes(){return this.indices}_calculateVertexCount(e){return e.byteLength/12}}function X3(t,e){if(e instanceof vx)return e;const i=q3(t,e),{attributes:r,bufferLayout:o}=Z3(t,e);return new vx({topology:e.topology||"triangle-list",bufferLayout:o,vertexCount:e.vertexCount,indices:i,attributes:r})}function q3(t,e){if(!e.indices)return;const i=e.indices.value;return t.createBuffer({usage:Fi.INDEX,data:i})}function Z3(t,e){const i=[],r={};for(const[u,d]of Object.entries(e.attributes)){let a=u;switch(u){case"POSITION":a="positions";break;case"NORMAL":a="normals";break;case"TEXCOORD_0":a="texCoords";break;case"COLOR_0":a="colors";break}r[a]=t.createBuffer({data:d.value,id:`${u}-buffer`});const{value:x,size:A,normalized:M}=d;i.push({name:a,format:eM(x,A,M)})}const o=e._calculateVertexCount(e.attributes,e.indices);return{attributes:r,bufferLayout:i,vertexCount:o}}class K3{constructor(e){L(this,"modules");L(this,"moduleUniforms");L(this,"moduleBindings");L(this,"moduleUniformsChanged");const i=Dd(Object.values(e).filter(r=>r.dependencies));for(const r of i)e[r.name]=r;Je.log(1,"Creating ShaderInputs with modules",Object.keys(e))(),this.modules=e,this.moduleUniforms={},this.moduleBindings={};for(const[r,o]of Object.entries(e)){const u=r;this.moduleUniforms[u]=o.defaultUniforms||{},this.moduleBindings[u]={}}}destroy(){}setProps(e){var i;for(const r of Object.keys(e)){const o=r,u=e[o],d=this.modules[o];if(!d){Je.warn(`Module ${r} not found`)();continue}const a=this.moduleUniforms[o],x=this.moduleBindings[o],A=((i=d.getUniforms)==null?void 0:i.call(d,u,a))||u,{uniforms:M,bindings:D}=ig(A);this.moduleUniforms[o]={...a,...M},this.moduleBindings[o]={...x,...D}}}getModules(){return Object.values(this.modules)}getUniformValues(){return this.moduleUniforms}getBindings(){const e={};for(const i of Object.values(this.moduleBindings))Object.assign(e,i);return e}getDebugTable(){var i;const e={};for(const[r,o]of Object.entries(this.moduleUniforms))for(const[u,d]of Object.entries(o))e[`${r}.${u}`]={type:(i=this.modules[r].uniformTypes)==null?void 0:i[u],value:String(d)};return e}}const cp=class cp{constructor(e){L(this,"device");L(this,"_hashCounter",0);L(this,"_hashes",{});L(this,"_renderPipelineCache",{});L(this,"_computePipelineCache",{});this.device=e}static getDefaultPipelineFactory(e){return e._lumaData.defaultPipelineFactory=e._lumaData.defaultPipelineFactory||new cp(e),e._lumaData.defaultPipelineFactory}createRenderPipeline(e){const i={...Zl.defaultProps,...e},r=this._hashRenderPipeline(i);if(!this._renderPipelineCache[r]){const o=this.device.createRenderPipeline({...i,id:i.id?`${i.id}-cached`:void 0});o.hash=r,this._renderPipelineCache[r]={pipeline:o,useCount:0}}return this._renderPipelineCache[r].useCount++,this._renderPipelineCache[r].pipeline}createComputePipeline(e){const i={...Vd.defaultProps,...e},r=this._hashComputePipeline(i);if(!this._computePipelineCache[r]){const o=this.device.createComputePipeline({...i,id:i.id?`${i.id}-cached`:void 0});o.hash=r,this._computePipelineCache[r]={pipeline:o,useCount:0}}return this._computePipelineCache[r].useCount++,this._computePipelineCache[r].pipeline}release(e){const i=e.hash,r=e instanceof Vd?this._computePipelineCache:this._renderPipelineCache;r[i].useCount--,r[i].useCount===0&&(r[i].pipeline.destroy(),delete r[i])}_hashComputePipeline(e){return`${this._getHash(e.shader.source)}`}_hashRenderPipeline(e){const i=this._getHash(e.vs.source),r=e.fs?this._getHash(e.fs.source):0,o="-",u=this._getHash(JSON.stringify(e.bufferLayout));switch(this.device.type){case"webgl":return`${i}/${r}V${o}BL${u}`;default:const d=this._getHash(JSON.stringify(e.parameters));return`${i}/${r}V${o}T${e.topology}P${d}BL${u}`}}_getHash(e){return this._hashes[e]===void 0&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}};L(cp,"defaultProps",{...Zl.defaultProps});let Lg=cp;const hp=class hp{constructor(e){L(this,"device");L(this,"_cache",{});this.device=e}static getDefaultShaderFactory(e){var i;return(i=e._lumaData).defaultShaderFactory||(i.defaultShaderFactory=new hp(e)),e._lumaData.defaultShaderFactory}createShader(e){const i=this._hashShader(e);let r=this._cache[i];if(!r){const o=this.device.createShader({...e,id:e.id?`${e.id}-cached`:void 0});this._cache[i]=r={shader:o,useCount:0}}return r.useCount++,r.shader}release(e){const i=this._hashShader(e),r=this._cache[i];r&&(r.useCount--,r.useCount===0&&(delete this._cache[i],r.shader.destroy()))}_hashShader(e){return`${e.stage}:${e.source}`}};L(hp,"defaultProps",{...Ld.defaultProps});let Ug=hp;function Y3(t,e){var o;const i={},r="Values";if(t.attributes.length===0&&!((o=t.varyings)!=null&&o.length))return{"No attributes or varyings":{[r]:"N/A"}};for(const u of t.attributes)if(u){const d=`${u.location} ${u.name}: ${u.type}`;i[`in ${d}`]={[r]:u.stepMode||"vertex"}}for(const u of t.varyings||[]){const d=`${u.location} ${u.name}`;i[`out ${d}`]={[r]:JSON.stringify(u.accessor)}}return i}let Sr=null,zg=null;function J3(t,{id:e,minimap:i,opaque:r,top:o="0",left:u="0",rgbaScale:d=1}){Sr||(Sr=document.createElement("canvas"),Sr.id=e,Sr.title=e,Sr.style.zIndex="100",Sr.style.position="absolute",Sr.style.top=o,Sr.style.left=u,Sr.style.border="blue 1px solid",Sr.style.transform="scaleY(-1)",document.body.appendChild(Sr),zg=Sr.getContext("2d")),(Sr.width!==t.width||Sr.height!==t.height)&&(Sr.width=t.width/2,Sr.height=t.height/2,Sr.style.width="400px",Sr.style.height="400px");const a=t.device.readPixelsToArrayWebGL(t),x=zg.createImageData(t.width,t.height),A=0;for(let M=0;M<a.length;M+=4)x.data[A+M+0]=a[M+0]*d,x.data[A+M+1]=a[M+1]*d,x.data[A+M+2]=a[M+2]*d,x.data[A+M+3]=r?255:a[M+3]*d;zg.putImageData(x,0,0)}const rc=2,Q3=1e4,up=class up{constructor(e,i){L(this,"device");L(this,"id");L(this,"source");L(this,"vs");L(this,"fs");L(this,"pipelineFactory");L(this,"shaderFactory");L(this,"userData",{});L(this,"parameters");L(this,"topology");L(this,"bufferLayout");L(this,"isInstanced");L(this,"instanceCount",0);L(this,"vertexCount");L(this,"indexBuffer",null);L(this,"bufferAttributes",{});L(this,"constantAttributes",{});L(this,"bindings",{});L(this,"uniforms",{});L(this,"vertexArray");L(this,"transformFeedback",null);L(this,"pipeline");L(this,"shaderInputs");L(this,"_uniformStore");L(this,"_attributeInfos",{});L(this,"_gpuGeometry",null);L(this,"_getModuleUniforms");L(this,"props");L(this,"_pipelineNeedsUpdate","newly created");L(this,"_needsRedraw","initializing");L(this,"_destroyed",!1);L(this,"_lastDrawTimestamp",-1);L(this,"_lastLogTime",0);L(this,"_logOpen",!1);L(this,"_drawCount",0);var a,x,A,M;this.props={...up.defaultProps,...i},i=this.props,this.id=i.id||Wo("model"),this.device=e,Object.assign(this.userData,i.userData);const r=Object.fromEntries(((a=this.props.modules)==null?void 0:a.map(D=>[D.name,D]))||[]);this.setShaderInputs(i.shaderInputs||new K3(r));const o=eB(e),u=(((x=this.props.modules)==null?void 0:x.length)>0?this.props.modules:(A=this.shaderInputs)==null?void 0:A.getModules())||[];if(this.device.type==="webgpu"&&this.props.source){(M=this.props).shaderLayout||(M.shaderLayout=GM(this.props.source));const{source:D,getUniforms:N}=this.props.shaderAssembler.assembleShader({platformInfo:o,...this.props,modules:u});this.source=D,this._getModuleUniforms=N}else{const{vs:D,fs:N,getUniforms:U}=this.props.shaderAssembler.assembleShaderPair({platformInfo:o,...this.props,modules:u});this.vs=D,this.fs=N,this._getModuleUniforms=U}this.vertexCount=this.props.vertexCount,this.instanceCount=this.props.instanceCount,this.topology=this.props.topology,this.bufferLayout=this.props.bufferLayout,this.parameters=this.props.parameters,i.geometry&&this.setGeometry(i.geometry),this.pipelineFactory=i.pipelineFactory||Lg.getDefaultPipelineFactory(this.device),this.shaderFactory=i.shaderFactory||Ug.getDefaultShaderFactory(this.device),this.pipeline=this._updatePipeline(),this.vertexArray=e.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry),"isInstanced"in i&&(this.isInstanced=i.isInstanced),i.instanceCount&&this.setInstanceCount(i.instanceCount),i.vertexCount&&this.setVertexCount(i.vertexCount),i.indexBuffer&&this.setIndexBuffer(i.indexBuffer),i.attributes&&this.setAttributes(i.attributes),i.constantAttributes&&this.setConstantAttributes(i.constantAttributes),i.bindings&&this.setBindings(i.bindings),i.uniforms&&this.setUniforms(i.uniforms),i.moduleSettings&&this.updateModuleSettings(i.moduleSettings),i.transformFeedback&&(this.transformFeedback=i.transformFeedback),Object.seal(this)}destroy(){var e;this._destroyed||(this.pipelineFactory.release(this.pipeline),this.shaderFactory.release(this.pipeline.vs),this.pipeline.fs&&this.shaderFactory.release(this.pipeline.fs),this._uniformStore.destroy(),(e=this._gpuGeometry)==null||e.destroy(),this._destroyed=!0)}needsRedraw(){this._getBindingsUpdateTimestamp()>this._lastDrawTimestamp&&this.setNeedsRedraw("contents of bound textures or buffers updated");const e=this._needsRedraw;return this._needsRedraw=!1,e}setNeedsRedraw(e){this._needsRedraw||(this._needsRedraw=e)}predraw(){this.updateShaderInputs(),this.pipeline=this._updatePipeline()}draw(e){this.predraw();let i;try{this._logDrawCallStart(),this.pipeline=this._updatePipeline(),this.pipeline.setBindings(this.bindings,{disableWarnings:this.props.disableWarnings}),Fd(this.uniforms)||this.pipeline.setUniformsWebGL(this.uniforms);const{indexBuffer:r}=this.vertexArray,o=r?r.byteLength/(r.indexType==="uint32"?4:2):void 0;i=this.pipeline.draw({renderPass:e,vertexArray:this.vertexArray,isInstanced:this.isInstanced,vertexCount:this.vertexCount,instanceCount:this.instanceCount,indexCount:o,transformFeedback:this.transformFeedback||void 0,parameters:this.parameters,topology:this.topology})}finally{this._logDrawCallEnd()}return this._logFramebuffer(e),i?(this._lastDrawTimestamp=this.device.timestamp,this._needsRedraw=!1):this._needsRedraw="waiting for resource initialization",i}setGeometry(e){var r;(r=this._gpuGeometry)==null||r.destroy();const i=e&&X3(this.device,e);i&&(this.setTopology(i.topology||"triangle-list"),this.bufferLayout=xx(i.bufferLayout,this.bufferLayout),this.vertexArray&&this._setGeometryAttributes(i)),this._gpuGeometry=i}setTopology(e){e!==this.topology&&(this.topology=e,this._setPipelineNeedsUpdate("topology"))}setBufferLayout(e){this.bufferLayout=this._gpuGeometry?xx(e,this._gpuGeometry.bufferLayout):e,this._setPipelineNeedsUpdate("bufferLayout"),this.pipeline=this._updatePipeline(),this.vertexArray=this.device.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry)}setParameters(e){rg(e,this.parameters,2)||(this.parameters=e,this._setPipelineNeedsUpdate("parameters"))}setInstanceCount(e){this.instanceCount=e,this.isInstanced===void 0&&e>0&&(this.isInstanced=!0),this.setNeedsRedraw("instanceCount")}setVertexCount(e){this.vertexCount=e,this.setNeedsRedraw("vertexCount")}setShaderInputs(e){this.shaderInputs=e,this._uniformStore=new QI(this.shaderInputs.modules);for(const i of Object.keys(this.shaderInputs.modules)){const r=this._uniformStore.getManagedUniformBuffer(this.device,i);this.bindings[`${i}Uniforms`]=r}this.setNeedsRedraw("shaderInputs")}updateShaderInputs(){this._uniformStore.setUniforms(this.shaderInputs.getUniformValues()),this.setBindings(this.shaderInputs.getBindings()),this.setNeedsRedraw("shaderInputs")}setBindings(e){Object.assign(this.bindings,e),this.setNeedsRedraw("bindings")}setTransformFeedback(e){this.transformFeedback=e,this.setNeedsRedraw("transformFeedback")}setIndexBuffer(e){this.vertexArray.setIndexBuffer(e),this.setNeedsRedraw("indexBuffer")}setAttributes(e,i){e.indices&&Je.warn(`Model:${this.id} setAttributes() - indexBuffer should be set using setIndexBuffer()`)();for(const[r,o]of Object.entries(e)){const u=this.bufferLayout.find(x=>wx(x).includes(r));if(!u){Je.warn(`Model(${this.id}): Missing layout for buffer "${r}".`)();continue}const d=wx(u);let a=!1;for(const x of d){const A=this._attributeInfos[x];A&&(this.vertexArray.setBuffer(A.location,o),a=!0)}!a&&!((i==null?void 0:i.disableWarnings)??this.props.disableWarnings)&&Je.warn(`Model(${this.id}): Ignoring buffer "${o.id}" for unknown attribute "${r}"`)()}this.setNeedsRedraw("attributes")}setConstantAttributes(e,i){for(const[r,o]of Object.entries(e)){const u=this._attributeInfos[r];u?this.vertexArray.setConstantWebGL(u.location,o):((i==null?void 0:i.disableWarnings)??this.props.disableWarnings)||Je.warn(`Model "${this.id}: Ignoring constant supplied for unknown attribute "${r}"`)()}this.setNeedsRedraw("constants")}setUniforms(e){Fd(e)||(this.pipeline.setUniformsWebGL(e),Object.assign(this.uniforms,e)),this.setNeedsRedraw("uniforms")}updateModuleSettings(e){const{bindings:i,uniforms:r}=ig(this._getModuleUniforms(e));Object.assign(this.bindings,i),Object.assign(this.uniforms,r),this.setNeedsRedraw("moduleSettings")}_getBindingsUpdateTimestamp(){let e=0;for(const i of Object.values(this.bindings))i instanceof Nd?e=Math.max(e,i.texture.updateTimestamp):i instanceof Fi||i instanceof As?e=Math.max(e,i.updateTimestamp):i instanceof Ud||(e=Math.max(e,i.buffer.updateTimestamp));return e}_setGeometryAttributes(e){const i={...e.attributes};for(const[r]of Object.entries(i))!this.pipeline.shaderLayout.attributes.find(o=>o.name===r)&&r!=="positions"&&delete i[r];this.vertexCount=e.vertexCount,this.setIndexBuffer(e.indices||null),this.setAttributes(e.attributes,{disableWarnings:!0}),this.setAttributes(i,{disableWarnings:this.props.disableWarnings}),this.setNeedsRedraw("geometry attributes")}_setPipelineNeedsUpdate(e){this._pipelineNeedsUpdate||(this._pipelineNeedsUpdate=e),this.setNeedsRedraw(e)}_updatePipeline(){if(this._pipelineNeedsUpdate){let e=null,i=null;this.pipeline&&(Je.log(1,`Model ${this.id}: Recreating pipeline because "${this._pipelineNeedsUpdate}".`)(),e=this.pipeline.vs,i=this.pipeline.fs),this._pipelineNeedsUpdate=!1;const r=this.shaderFactory.createShader({id:`${this.id}-vertex`,stage:"vertex",source:this.source||this.vs,debug:this.props.debugShaders});let o=null;this.source?o=r:this.fs&&(o=this.shaderFactory.createShader({id:`${this.id}-fragment`,stage:"fragment",source:this.source||this.fs,debug:this.props.debugShaders})),this.pipeline=this.pipelineFactory.createRenderPipeline({...this.props,bufferLayout:this.bufferLayout,topology:this.topology,parameters:this.parameters,vs:r,fs:o}),this._attributeInfos=Yb(this.pipeline.shaderLayout,this.bufferLayout),e&&this.shaderFactory.release(e),i&&this.shaderFactory.release(i)}return this.pipeline}_logDrawCallStart(){const e=Je.level>3?0:Q3;Je.level<2||Date.now()-this._lastLogTime<e||(this._lastLogTime=Date.now(),this._logOpen=!0,Je.group(rc,`>>> DRAWING MODEL ${this.id}`,{collapsed:Je.level<=2})())}_logDrawCallEnd(){if(this._logOpen){const e=Y3(this.pipeline.shaderLayout,this.id);Je.table(rc,e)();const i=this.shaderInputs.getDebugTable();for(const[o,u]of Object.entries(this.uniforms))i[o]={value:u};Je.table(rc,i)();const r=this._getAttributeDebugTable();Je.table(rc,this._attributeInfos)(),Je.table(rc,r)(),Je.groupEnd(rc)(),this._logOpen=!1}}_logFramebuffer(e){const i=Je.get("framebuffer");if(this._drawCount++,!i||this._drawCount++>3&&this._drawCount%60)return;const r=e.props.framebuffer;r&&J3(r,{id:r.id,minimap:!0})}_getAttributeDebugTable(){const e={};for(const[i,r]of Object.entries(this._attributeInfos))e[r.location]={name:i,type:r.shaderType,values:this._getBufferOrConstantValues(this.vertexArray.attributes[r.location],r.bufferDataType)};if(this.vertexArray.indexBuffer){const{indexBuffer:i}=this.vertexArray,r=i.indexType==="uint32"?new Uint32Array(i.debugData):new Uint16Array(i.debugData);e.indices={name:"indices",type:i.indexType,values:r.toString()}}return e}_getBufferOrConstantValues(e,i){const r=tv(i);return(e instanceof Fi?new r(e.debugData):e).toString()}};L(up,"defaultProps",{...Zl.defaultProps,source:null,vs:null,fs:null,id:"unnamed",handle:void 0,userData:{},defines:{},modules:[],moduleSettings:void 0,geometry:null,indexBuffer:null,attributes:{},constantAttributes:{},varyings:[],isInstanced:void 0,instanceCount:0,vertexCount:0,shaderInputs:void 0,pipelineFactory:void 0,shaderFactory:void 0,transformFeedback:void 0,shaderAssembler:Od.getDefaultShaderAssembler(),debugShaders:void 0,disableWarnings:void 0});let Zo=up;function xx(t,e){const i=[...t];for(const r of e){const o=i.findIndex(u=>u.name===r.name);o<0?i.push(r):i[o]=r}return i}function eB(t){return{type:t.type,shaderLanguage:t.info.shadingLanguage,shaderLanguageVersion:t.info.shadingLanguageVersion,gpu:t.info.gpu,features:t.features}}function wx(t){var e;return t.attributes?(e=t.attributes)==null?void 0:e.map(i=>i.attribute):[t.name]}class Xh{constructor(e,i=Zo.defaultProps){L(this,"device");L(this,"model");L(this,"transformFeedback");ti(Xh.isSupported(e),"BufferTransform not yet implemented on WebGPU"),this.device=e,this.model=new Zo(this.device,{id:i.id||"buffer-transform-model",fs:i.fs||tI(),topology:i.topology||"point-list",...i}),this.transformFeedback=this.device.createTransformFeedback({layout:this.model.pipeline.shaderLayout,buffers:i.feedbackBuffers}),this.model.setTransformFeedback(this.transformFeedback),Object.seal(this)}static isSupported(e){var i;return((i=e==null?void 0:e.info)==null?void 0:i.type)==="webgl"}destroy(){this.model&&this.model.destroy()}delete(){this.destroy()}run(e){const i=this.device.beginRenderPass(e);this.model.draw(i),i.end()}update(...e){console.warn("TextureTransform#update() not implemented")}getBuffer(e){return this.transformFeedback.getBuffer(e)}readAsync(e){const i=this.getBuffer(e);if(i instanceof Fi)return i.readAsync();const{buffer:r,byteOffset:o=0,byteLength:u=r.byteLength}=i;return r.readAsync(o,u)}}class sc{constructor(e){L(this,"id");L(this,"topology");L(this,"vertexCount");L(this,"indices");L(this,"attributes");L(this,"userData",{});const{attributes:i={},indices:r=null,vertexCount:o=null}=e;this.id=e.id||Wo("geometry"),this.topology=e.topology,r&&(this.indices=ArrayBuffer.isView(r)?{value:r,size:1}:r),this.attributes={};for(const[u,d]of Object.entries(i)){const a=ArrayBuffer.isView(d)?{value:d}:d;ti(ArrayBuffer.isView(a.value),`${this._print(u)}: must be typed array or object with value as typed array`),(u==="POSITION"||u==="positions")&&!a.size&&(a.size=3),u==="indices"?(ti(!this.indices),this.indices=a):this.attributes[u]=a}this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this.vertexCount=o||this._calculateVertexCount(this.attributes,this.indices)}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return`Geometry ${this.id} attribute ${e}`}_setAttributes(e,i){return this}_calculateVertexCount(e,i){if(i)return i.value.length;let r=1/0;for(const o of Object.values(e)){const{value:u,size:d,constant:a}=o;!a&&u&&d>=1&&(r=Math.min(r,u.length/d))}return ti(Number.isFinite(r)),r}}class cf{constructor(e={}){L(this,"id");L(this,"matrix",new $t);L(this,"display",!0);L(this,"position",new De);L(this,"rotation",new De);L(this,"scale",new De(1,1,1));L(this,"userData",{});L(this,"props",{});const{id:i}=e;this.id=i||Wo(this.constructor.name),this._setScenegraphNodeProps(e)}getBounds(){return null}destroy(){}delete(){this.destroy()}setProps(e){return this._setScenegraphNodeProps(e),this}toString(){return`{type: ScenegraphNode, id: ${this.id})}`}setPosition(e){return ti(e.length===3,"setPosition requires vector argument"),this.position=e,this}setRotation(e){return ti(e.length===3,"setRotation requires vector argument"),this.rotation=e,this}setScale(e){return ti(e.length===3,"setScale requires vector argument"),this.scale=e,this}setMatrix(e,i=!0){i?this.matrix.copy(e):this.matrix=e}setMatrixComponents(e){const{position:i,rotation:r,scale:o,update:u=!0}=e;return i&&this.setPosition(i),r&&this.setRotation(r),o&&this.setScale(o),u&&this.updateMatrix(),this}updateMatrix(){const e=this.position,i=this.rotation,r=this.scale;return this.matrix.identity(),this.matrix.translate(e),this.matrix.rotateXYZ(i),this.matrix.scale(r),this}update(e={}){const{position:i,rotation:r,scale:o}=e;return i&&this.setPosition(i),r&&this.setRotation(r),o&&this.setScale(o),this.updateMatrix(),this}getCoordinateUniforms(e,i){ti(e),i=i||this.matrix;const r=new $t(e).multiplyRight(i),o=r.invert(),u=o.transpose();return{viewMatrix:e,modelMatrix:i,objectMatrix:i,worldMatrix:r,worldInverseMatrix:o,worldInverseTransposeMatrix:u}}_setScenegraphNodeProps(e){"display"in e&&(this.display=e.display),"position"in e&&this.setPosition(e.position),"rotation"in e&&this.setRotation(e.rotation),"scale"in e&&this.setScale(e.scale),"matrix"in e&&this.setMatrix(e.matrix),Object.assign(this.props,e)}}class nc extends cf{constructor(i={}){i=Array.isArray(i)?{children:i}:i;const{children:r=[]}=i;Je.assert(r.every(o=>o instanceof cf),"every child must an instance of ScenegraphNode");super(i);L(this,"children");this.children=r}getBounds(){const i=[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]];return this.traverse((r,{worldMatrix:o})=>{const u=r.getBounds();if(!u)return;const[d,a]=u,x=new De(d).add(a).divide([2,2,2]);o.transformAsPoint(x,x);const A=new De(a).subtract(d).divide([2,2,2]);o.transformAsVector(A,A);for(let M=0;M<8;M++){const D=new De(M&1?-1:1,M&2?-1:1,M&4?-1:1).multiply(A).add(x);for(let N=0;N<3;N++)i[0][N]=Math.min(i[0][N],D[N]),i[1][N]=Math.max(i[1][N],D[N])}}),Number.isFinite(i[0][0])?i:null}destroy(){this.children.forEach(i=>i.destroy()),this.removeAll(),super.destroy()}add(...i){for(const r of i)Array.isArray(r)?this.add(...r):this.children.push(r);return this}remove(i){const r=this.children,o=r.indexOf(i);return o>-1&&r.splice(o,1),this}removeAll(){return this.children=[],this}traverse(i,{worldMatrix:r=new $t}={}){const o=new $t(r).multiplyRight(this.matrix);for(const u of this.children)u instanceof nc?u.traverse(i,{worldMatrix:o}):i(u,{worldMatrix:o})}}class Vg extends cf{constructor(i){super(i);L(this,"model");L(this,"bounds",null);L(this,"managedResources");this.model=i.model,this.managedResources=i.managedResources||[],this.bounds=i.bounds||null,this.setProps(i)}getBounds(){return this.bounds}destroy(){this.model&&(this.model.destroy(),this.model=null),this.managedResources.forEach(i=>i.destroy()),this.managedResources=[]}draw(i){return this.model.draw(i)}}const tB={blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"zero",blendAlphaOperation:"add",blendAlphaSrcFactor:"constant-alpha",blendAlphaDstFactor:"zero"};class Tx extends Fg{constructor(){super(...arguments),this._colorEncoderState=null}render(e){return"pickingFBO"in e?this._drawPickingBuffer(e):super.render(e)}_drawPickingBuffer({layers:e,layerFilter:i,views:r,viewports:o,onViewportActive:u,pickingFBO:d,deviceRect:{x:a,y:x,width:A,height:M},cullRect:D,effects:N,pass:U="picking",pickZ:re,moduleParameters:ne}){this.pickZ=re;const xe=this._resetColorEncoder(re),Ae=[a,x,A,M],Te=super.render({target:d,layers:e,layerFilter:i,views:r,viewports:o,onViewportActive:u,cullRect:D,effects:N==null?void 0:N.filter(Ue=>Ue.useInPicking),pass:U,isPicking:!0,moduleParameters:ne,clearColor:[0,0,0,0],colorMask:15,scissorRect:Ae});return this._colorEncoderState=null,{decodePickingColor:xe&&rB.bind(null,xe),stats:Te}}shouldDrawLayer(e){const{pickable:i,operation:r}=e.props;return i&&r.includes("draw")||r.includes("terrain")||r.includes("mask")}getModuleParameters(){return{picking:{isActive:1,isAttribute:this.pickZ},lightSources:{}}}getLayerParameters(e,i,r){const o={depthMask:!0,depthTest:!0,depthRange:[0,1],...e.props.parameters},{pickable:u,operation:d}=e.props;return!this._colorEncoderState||d.includes("terrain")?o.blend=!1:u&&d.includes("draw")&&(Object.assign(o,tB),o.blend=!0,o.blendColor=iB(this._colorEncoderState,e,r)),o}_resetColorEncoder(e){return this._colorEncoderState=e?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function iB(t,e,i){const{byLayer:r,byAlpha:o}=t;let u,d=r.get(e);return d?(d.viewports.push(i),u=d.a):(u=r.size+1,u<=255?(d={a:u,layer:e,viewports:[i]},r.set(e,d),o[u]=d):(Yt.warn("Too many pickable layers, only picking the first 255")(),u=0)),[0,0,0,u/255]}function rB(t,e){const i=t.byAlpha[e[3]];return i&&{pickedLayer:i.layer,pickedViewports:i.viewports,pickedObjectIndex:i.layer.decodePickingColor(e)}}const oc={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},hf=Symbol.for("component"),Ko=Symbol.for("propTypes"),jg=Symbol.for("deprecatedProps"),ac=Symbol.for("asyncPropDefaults"),$a=Symbol.for("asyncPropOriginal"),Yo=Symbol.for("asyncPropResolved");function lc(t,e=()=>!0){return Array.isArray(t)?Ax(t,e,[]):e(t)?[t]:[]}function Ax(t,e,i){let r=-1;for(;++r<t.length;){const o=t[r];Array.isArray(o)?Ax(o,e,i):e(o)&&i.push(o)}return i}function sB({target:t,source:e,start:i=0,count:r=1}){const o=e.length,u=r*o;let d=0;for(let a=i;d<o;d++)t[a++]=e[d];for(;d<u;)d<u-d?(t.copyWithin(i+d,i,i+d),d*=2):(t.copyWithin(i+d,i,i+u-d),d=u);return t}class nB{constructor(e,i,r){this._loadCount=0,this._subscribers=new Set,this.id=e,this.context=r,this.setData(i)}subscribe(e){this._subscribers.add(e)}unsubscribe(e){this._subscribers.delete(e)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(e,i){if(e===this._data&&!i)return;this._data=e;const r=++this._loadCount;let o=e;typeof e=="string"&&(o=$o(e)),o instanceof Promise?(this.isLoaded=!1,this._loader=o.then(u=>{this._loadCount===r&&(this.isLoaded=!0,this._error=void 0,this._content=u)}).catch(u=>{this._loadCount===r&&(this.isLoaded=!0,this._error=u||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=e);for(const u of this._subscribers)u.onChange(this.getData())}}class oB{constructor(e){var i;this.protocol=e.protocol||"resource://",this._context={device:e.device,gl:(i=e.device)==null?void 0:i.gl,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(e){return e.startsWith(this.protocol)?!0:e in this._resources}add({resourceId:e,data:i,forceUpdate:r=!1,persistent:o=!0}){let u=this._resources[e];u?u.setData(i,r):(u=new nB(e,i,this._context),this._resources[e]=u),u.persistent=o}remove(e){const i=this._resources[e];i&&(i.delete(),delete this._resources[e])}unsubscribe({consumerId:e}){const i=this._consumers[e];if(i){for(const r in i){const o=i[r],u=this._resources[o.resourceId];u&&u.unsubscribe(o)}delete this._consumers[e],this.prune()}}subscribe({resourceId:e,onChange:i,consumerId:r,requestId:o="default"}){const{_resources:u,protocol:d}=this;e.startsWith(d)&&(e=e.replace(d,""),u[e]||this.add({resourceId:e,data:null,persistent:!1}));const a=u[e];if(this._track(r,o,a,i),a)return a.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const e in this._resources)this._resources[e].delete()}_track(e,i,r,o){const u=this._consumers,d=u[e]=u[e]||{};let a=d[i];const x=a&&a.resourceId&&this._resources[a.resourceId];x&&(x.unsubscribe(a),this.prune()),r&&(a?(a.onChange=o,a.resourceId=r.id):a={onChange:o,resourceId:r.id},d[i]=a,r.subscribe(a))}_prune(){this._pruneRequest=null;for(const e of Object.keys(this._resources)){const i=this._resources[e];!i.persistent&&!i.inUse()&&(i.delete(),delete this._resources[e])}}}const aB="layerManager.setLayers",lB="layerManager.activateViewport";class cB{constructor(e,i){this._lastRenderedLayers=[],this._needsRedraw=!1,this._needsUpdate=!1,this._nextLayers=null,this._debug=!1,this._defaultShaderModulesChanged=!1,this.activateViewport=a=>{Wr(lB,this,a),a&&(this.context.viewport=a)};const{deck:r,stats:o,viewport:u,timeline:d}=i||{};this.layers=[],this.resourceManager=new oB({device:e,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,device:e,gl:e==null?void 0:e.gl,deck:r,shaderAssembler:m3(),defaultShaderModules:[],renderPass:void 0,stats:o||new Wl({id:"deck.gl"}),viewport:u||new Wh({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:d||new bx,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const e of this.layers)this._finalizeLayer(e)}needsRedraw(e={clearRedrawFlags:!1}){let i=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);for(const r of this.layers){const o=r.getNeedsRedraw(e);i=i||o}return i}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._defaultShaderModulesChanged?"shader modules changed":this._needsUpdate}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e}getLayers({layerIds:e}={}){return e?this.layers.filter(i=>e.find(r=>i.id.indexOf(r)===0)):this.layers}setProps(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}setLayers(e,i){Wr(aB,this,i,e),this._lastRenderedLayers=e;const r=lc(e,Boolean);for(const o of r)o.context=this.context;this._updateLayers(this.layers,r)}updateLayers(){const e=this.needsUpdate();e&&(this.setNeedsRedraw(`updating layers: ${e}`),this.setLayers(this._nextLayers||this._lastRenderedLayers,e)),this._nextLayers=null}addDefaultShaderModule(e){const{defaultShaderModules:i}=this.context;i.find(r=>r.name===e.name)||(i.push(e),this._defaultShaderModulesChanged=!0)}removeDefaultShaderModule(e){const{defaultShaderModules:i}=this.context,r=i.findIndex(o=>o.name===e.name);r>=0&&(i.splice(r,1),this._defaultShaderModulesChanged=!0)}_handleError(e,i,r){r.raiseError(i,`${e} of ${r}`)}_updateLayers(e,i){const r={};for(const d of e)r[d.id]?Yt.warn(`Multiple old layers with same id ${d.id}`)():r[d.id]=d;if(this._defaultShaderModulesChanged){for(const d of e)d.setNeedsUpdate(),d.setChangeFlags({extensionsChanged:!0});this._defaultShaderModulesChanged=!1}const o=[];this._updateSublayersRecursively(i,r,o),this._finalizeOldLayers(r);let u=!1;for(const d of o)if(d.hasUniformTransition()){u=`Uniform transition in ${d}`;break}this._needsUpdate=u,this.layers=o}_updateSublayersRecursively(e,i,r){for(const o of e){o.context=this.context;const u=i[o.id];u===null&&Yt.warn(`Multiple new layers with same id ${o.id}`)(),i[o.id]=null;let d=null;try{this._debug&&u!==o&&o.validateProps(),u?(this._transferLayerState(u,o),this._updateLayer(o)):this._initializeLayer(o),r.push(o),d=o.isComposite?o.getSubLayers():null}catch(a){this._handleError("matching",a,o)}d&&this._updateSublayersRecursively(d,i,r)}}_finalizeOldLayers(e){for(const i in e){const r=e[i];r&&this._finalizeLayer(r)}}_initializeLayer(e){try{e._initialize(),e.lifecycle=oc.INITIALIZED}catch(i){this._handleError("initialization",i,e)}}_transferLayerState(e,i){i._transferState(e),i.lifecycle=oc.MATCHED,i!==e&&(e.lifecycle=oc.AWAITING_GC)}_updateLayer(e){try{e._update()}catch(i){this._handleError("update",i,e)}}_finalizeLayer(e){this._needsRedraw=this._needsRedraw||`finalized ${e}`,e.lifecycle=oc.AWAITING_FINALIZATION;try{e._finalize(),e.lifecycle=oc.FINALIZED}catch(i){this._handleError("finalization",i,e)}}}function wn(t,e,i){if(t===e)return!0;if(!i||!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(!wn(t[r],e[r],i-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const r=Object.keys(t),o=Object.keys(e);if(r.length!==o.length)return!1;for(const u of r)if(!e.hasOwnProperty(u)||!wn(t[u],e[u],i-1))return!1;return!0}return!1}class hB{constructor(e){this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractionStateChange:e.onInteractionStateChange},Object.seal(this),this.setProps(e)}finalize(){for(const e in this.controllers){const i=this.controllers[e];i&&i.finalize()}this.controllers={}}needsRedraw(e={clearRedrawFlags:!1}){const i=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),i}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}updateViewStates(){for(const e in this.controllers){const i=this.controllers[e];i&&i.updateTransition()}}getViewports(e){return e?this._viewports.filter(i=>i.containsPixel(e)):this._viewports}getViews(){const e={};return this.views.forEach(i=>{e[i.id]=i}),e}getView(e){return this.views.find(i=>i.id===e)}getViewState(e){const i=typeof e=="string"?this.getView(e):e,r=i&&this.viewState[i.getViewStateId()]||this.viewState;return i?i.filterViewState(r):r}getViewport(e){return this._viewportMap[e]}unproject(e,i){const r=this.getViewports(),o={x:e[0],y:e[1]};for(let u=r.length-1;u>=0;--u){const d=r[u];if(d.containsPixel(o)){const a=e.slice();return a[0]-=d.x,a[1]-=d.y,d.unproject(a,i)}}return null}setProps(e){e.views&&this._setViews(e.views),e.viewState&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(e,i){(e!==this.width||i!==this.height)&&(this.width=e,this.height=i,this.setNeedsUpdate("Size changed"))}_setViews(e){e=lc(e,Boolean),this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}_setViewState(e){e?(!wn(e,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=e):Yt.warn("missing `viewState` or `initialViewState`")()}_createController(e,i){const r=i.type;return new r({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._eventCallbacks.onViewStateChange,onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:u=>{var d;return(d=this.getView(e.id))==null?void 0:d.makeViewport({viewState:u,width:this.width,height:this.height})}})}_updateController(e,i,r,o){const u=e.controller;if(u&&r){const d={...i,...u,id:e.id,x:r.x,y:r.y,width:r.width,height:r.height};return(!o||o.constructor!==u.type)&&(o=this._createController(e,d)),o&&o.setProps(d),o}return null}_rebuildViewports(){const{views:e}=this,i=this.controllers;this._viewports=[],this.controllers={};let r=!1;for(let o=e.length;o--;){const u=e[o],d=this.getViewState(u),a=u.makeViewport({viewState:d,width:this.width,height:this.height});let x=i[u.id];const A=!!u.controller;A&&!x&&(r=!0),(r||!A)&&x&&(x.finalize(),x=null),this.controllers[u.id]=this._updateController(u,d,a,x),a&&this._viewports.unshift(a)}for(const o in i){const u=i[o];u&&!this.controllers[o]&&u.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(e=>{e.id&&(this._viewportMap[e.id]=this._viewportMap[e.id]||e)})}_diffViews(e,i){return e.length!==i.length?!0:e.some((r,o)=>!e[o].equals(i[o]))}}const uB=/([0-9]+\.?[0-9]*)(%|px)/;function Jo(t){switch(typeof t){case"number":return{position:t,relative:!1};case"string":const e=uB.exec(t);if(e&&e.length>=3){const i=e[2]==="%",r=parseFloat(e[1]);return{position:i?r/100:r,relative:i}}default:throw new Error(`Could not parse position string ${t}`)}}function Qo(t,e){return t.relative?Math.round(t.position*e):t.position}class dB{constructor(e){const{id:i,x:r=0,y:o=0,width:u="100%",height:d="100%",padding:a=null}=e;this.id=i||this.constructor.displayName||"view",this.props={...e,id:this.id},this._x=Jo(r),this._y=Jo(o),this._width=Jo(u),this._height=Jo(d),this._padding=a&&{left:Jo(a.left||0),right:Jo(a.right||0),top:Jo(a.top||0),bottom:Jo(a.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(e){return this===e?!0:this.ViewportType===e.ViewportType&&wn(this.props,e.props,2)}makeViewport({width:e,height:i,viewState:r}){r=this.filterViewState(r);const o=this.getDimensions({width:e,height:i});return!o.height||!o.width?null:new this.ViewportType({...r,...this.props,...o})}getViewStateId(){const{viewState:e}=this.props;return typeof e=="string"?e:(e==null?void 0:e.id)||this.id}filterViewState(e){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const i={...e};for(const r in this.props.viewState)r!=="id"&&(i[r]=this.props.viewState[r]);return i}return e}getDimensions({width:e,height:i}){const r={x:Qo(this._x,e),y:Qo(this._y,i),width:Qo(this._width,e),height:Qo(this._height,i)};return this._padding&&(r.padding={left:Qo(this._padding.left,e),top:Qo(this._padding.top,i),right:Qo(this._padding.right,e),bottom:Qo(this._padding.bottom,i)}),r}get controller(){const e=this.props.controller;return e?e===!0?{type:this.ControllerType}:typeof e=="function"?{type:e}:{type:this.ControllerType,...e}:null}}class uf{constructor(e){this._inProgress=!1,this._handle=null,this.time=0,this.settings={duration:0},this._timeline=e}get inProgress(){return this._inProgress}start(e){var i,r;this.cancel(),this.settings=e,this._inProgress=!0,(r=(i=this.settings).onStart)==null||r.call(i,this)}end(){var e,i;this._inProgress&&(this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,(i=(e=this.settings).onEnd)==null||i.call(e,this))}cancel(){var e,i;this._inProgress&&((i=(e=this.settings).onInterrupt)==null||i.call(e,this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1)}update(){var e,i;if(!this._inProgress)return!1;if(this._handle===null){const{_timeline:r,settings:o}=this;this._handle=r.addChannel({delay:r.getTime(),duration:o.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),(i=(e=this.settings).onUpdate)==null||i.call(e,this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const Ex=()=>{},Hg={BREAK:1,SNAP_TO_END:2,IGNORE:3},fB=t=>t,pB=Hg.BREAK;class _B{constructor(e){this._onTransitionUpdate=i=>{const{time:r,settings:{interpolator:o,startProps:u,endProps:d,duration:a,easing:x}}=i,A=x(r/a),M=o.interpolateProps(u,d,A);this.propsInTransition=this.getControllerState({...this.props,...M}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})},this.getControllerState=e.getControllerState,this.propsInTransition=null,this.transition=new uf(e.timeline),this.onViewStateChange=e.onViewStateChange||Ex,this.onStateChange=e.onStateChange||Ex}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let i=!1;const r=this.props;if(this.props=e,!r||this._shouldIgnoreViewportChange(r,e))return!1;if(this._isTransitionEnabled(e)){let o=r;if(this.transition.inProgress){const{interruption:u,endProps:d}=this.transition.settings;o={...r,...u===Hg.SNAP_TO_END?d:this.propsInTransition||r}}this._triggerTransition(o,e),i=!0}else this.transition.cancel();return i}updateTransition(){this.transition.update()}_isTransitionEnabled(e){const{transitionDuration:i,transitionInterpolator:r}=e;return(i>0||i==="auto")&&!!r}_isUpdateDueToCurrentTransition(e){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition):!1}_shouldIgnoreViewportChange(e,i){return this.transition.inProgress?this.transition.settings.interruption===Hg.IGNORE||this._isUpdateDueToCurrentTransition(i):this._isTransitionEnabled(i)?i.transitionInterpolator.arePropsEqual(e,i):!0}_triggerTransition(e,i){const r=this.getControllerState(e),o=this.getControllerState(i).shortestPathFrom(r),u=i.transitionInterpolator,d=u.getDuration?u.getDuration(e,i):i.transitionDuration;if(d===0)return;const a=u.initializeProps(e,o);this.propsInTransition={};const x={duration:d,easing:i.transitionEasing||fB,interpolator:u,interruption:i.transitionInterruption||pB,startProps:a.start,endProps:a.end,onStart:i.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(i.onTransitionInterrupt),onEnd:this._onTransitionEnd(i.onTransitionEnd)};this.transition.start(x),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(e){return i=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),e==null||e(i)}}}function yr(t,e){if(!t)throw new Error(e||"deck.gl: assertion failed.")}class gB{constructor(e){const{compare:i,extract:r,required:o}=e;this._propsToCompare=i,this._propsToExtract=r||i,this._requiredProps=o}arePropsEqual(e,i){for(const r of this._propsToCompare)if(!(r in e)||!(r in i)||!yn(e[r],i[r]))return!1;return!0}initializeProps(e,i){const r={},o={};for(const u of this._propsToExtract)(u in e||u in i)&&(r[u]=e[u],o[u]=i[u]);return this._checkRequiredProps(r),this._checkRequiredProps(o),{start:r,end:o}}getDuration(e,i){return i.transitionDuration}_checkRequiredProps(e){this._requiredProps&&this._requiredProps.forEach(i=>{const r=e[i];yr(Number.isFinite(r)||Array.isArray(r),`${i} is required for transition`)})}}const mB=["longitude","latitude","zoom","bearing","pitch"],yB=["longitude","latitude","zoom"];class Sx extends gB{constructor(e={}){const i=Array.isArray(e)?e:e.transitionProps,r=Array.isArray(e)?{}:e;r.transitionProps=Array.isArray(i)?{compare:i,required:i}:i||{compare:mB,required:yB},super(r.transitionProps),this.opts=r}initializeProps(e,i){const r=super.initializeProps(e,i),{makeViewport:o,around:u}=this.opts;if(o&&u){const d=o(e),a=o(i),x=d.unproject(u);r.start.around=u,Object.assign(r.end,{around:a.project(x),aroundPosition:x,width:i.width,height:i.height})}return r}interpolateProps(e,i,r){const o={};for(const u of this._propsToExtract)o[u]=qd(e[u]||0,i[u]||0,r);if(i.aroundPosition&&this.opts.makeViewport){const u=this.opts.makeViewport({...i,...o});Object.assign(o,u.panByPosition(i.aroundPosition,qd(e.around,i.around,r)))}return o}}const ea={transitionDuration:0},bB=300,df=t=>1-(1-t)*(1-t),cc={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],TRIPLE_PAN:["tripanstart","tripanmove","tripanend"],DOUBLE_TAP:["doubletap"],KEYBOARD:["keydown"]},Wa={};class vB{constructor(e){this.state={},this._events={},this._interactionState={isDragging:!1},this._customEvents=[],this._eventStartBlocked=null,this._panMove=!1,this.invertPan=!1,this.dragMode="rotate",this.inertia=0,this.scrollZoom=!0,this.dragPan=!0,this.dragRotate=!0,this.doubleClickZoom=!0,this.touchZoom=!0,this.touchRotate=!1,this.keyboard=!0,this.transitionManager=new _B({...e,getControllerState:i=>new this.ControllerState(i),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=e.eventManager,this.onViewStateChange=e.onViewStateChange||(()=>{}),this.onStateChange=e.onStateChange||(()=>{}),this.makeViewport=e.makeViewport}set events(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.props&&this.setProps(this.props)}finalize(){var e;for(const i in this._events)this._events[i]&&((e=this.eventManager)==null||e.off(i,this.handleEvent));this.transitionManager.finalize()}handleEvent(e){this._controllerState=void 0;const i=this._eventStartBlocked;switch(e.type){case"panstart":return i?!1:this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return i?!1:this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"tripanstart":return i?!1:this._onTriplePanStart(e);case"tripanmove":return this._onTriplePan(e);case"tripanend":return this._onTriplePanEnd(e);case"doubletap":return this._onDoubleTap(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(e){const{x:i,y:r}=this.props,{offsetCenter:o}=e;return[o.x-i,o.y-r]}isPointInBounds(e,i){const{width:r,height:o}=this.props;if(i&&i.handled)return!1;const u=e[0]>=0&&e[0]<=r&&e[1]>=0&&e[1]<=o;return u&&i&&i.stopPropagation(),u}isFunctionKeyPressed(e){const{srcEvent:i}=e;return!!(i.metaKey||i.altKey||i.ctrlKey||i.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(e){const i=setTimeout(()=>{this._eventStartBlocked===i&&(this._eventStartBlocked=null)},e);this._eventStartBlocked=i}setProps(e){e.dragMode&&(this.dragMode=e.dragMode),this.props=e,"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);const{inertia:i}=e;this.inertia=Number.isFinite(i)?i:i===!0?bB:0;const{scrollZoom:r=!0,dragPan:o=!0,dragRotate:u=!0,doubleClickZoom:d=!0,touchZoom:a=!0,touchRotate:x=!1,keyboard:A=!0}=e,M=!!this.onViewStateChange;this.toggleEvents(cc.WHEEL,M&&r),this.toggleEvents(cc.PAN,M),this.toggleEvents(cc.PINCH,M&&(a||x)),this.toggleEvents(cc.TRIPLE_PAN,M&&x),this.toggleEvents(cc.DOUBLE_TAP,M&&d),this.toggleEvents(cc.KEYBOARD,M&&A),this.scrollZoom=r,this.dragPan=o,this.dragRotate=u,this.doubleClickZoom=d,this.touchZoom=a,this.touchRotate=x,this.keyboard=A}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(e,i){this.eventManager&&e.forEach(r=>{this._events[r]!==i&&(this._events[r]=i,i?this.eventManager.on(r,this.handleEvent):this.eventManager.off(r,this.handleEvent))})}updateViewport(e,i=null,r={}){const o={...e.getViewportProps(),...i},u=this.controllerState!==e;if(this.state=e.getState(),this._setInteractionState(r),u){const d=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:o,interactionState:this._interactionState,oldViewState:d,viewId:this.props.id})}}_onTransition(e){this.onViewStateChange({...e,interactionState:this._interactionState,viewId:this.props.id})}_setInteractionState(e){Object.assign(this._interactionState,e),this.onStateChange(this._interactionState)}_onPanStart(e){const i=this.getCenter(e);if(!this.isPointInBounds(i,e))return!1;let r=this.isFunctionKeyPressed(e)||e.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(r=!r);const o=this.controllerState[r?"panStart":"rotateStart"]({pos:i});return this._panMove=r,this.updateViewport(o,ea,{isDragging:!0}),!0}_onPan(e){return this.isDragging()?this._panMove?this._onPanMove(e):this._onPanRotate(e):!1}_onPanEnd(e){return this.isDragging()?this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e):!1}_onPanMove(e){if(!this.dragPan)return!1;const i=this.getCenter(e),r=this.controllerState.pan({pos:i});return this.updateViewport(r,ea,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(e){const{inertia:i}=this;if(this.dragPan&&i&&e.velocity){const r=this.getCenter(e),o=[r[0]+e.velocityX*i/2,r[1]+e.velocityY*i/2],u=this.controllerState.pan({pos:o}).panEnd();this.updateViewport(u,{...this._getTransitionProps(),transitionDuration:i,transitionEasing:df},{isDragging:!1,isPanning:!0})}else{const r=this.controllerState.panEnd();this.updateViewport(r,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(e){if(!this.dragRotate)return!1;const i=this.getCenter(e),r=this.controllerState.rotate({pos:i});return this.updateViewport(r,ea,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(e){const{inertia:i}=this;if(this.dragRotate&&i&&e.velocity){const r=this.getCenter(e),o=[r[0]+e.velocityX*i/2,r[1]+e.velocityY*i/2],u=this.controllerState.rotate({pos:o}).rotateEnd();this.updateViewport(u,{...this._getTransitionProps(),transitionDuration:i,transitionEasing:df},{isDragging:!1,isRotating:!0})}else{const r=this.controllerState.rotateEnd();this.updateViewport(r,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(e){if(!this.scrollZoom)return!1;const i=this.getCenter(e);if(!this.isPointInBounds(i,e))return!1;e.srcEvent.preventDefault();const{speed:r=.01,smooth:o=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:u}=e;let d=2/(1+Math.exp(-Math.abs(u*r)));u<0&&d!==0&&(d=1/d);const a=this.controllerState.zoom({pos:i,scale:d});return this.updateViewport(a,{...this._getTransitionProps({around:i}),transitionDuration:o?250:1},{isZooming:!0,isPanning:!0}),!0}_onTriplePanStart(e){const i=this.getCenter(e);if(!this.isPointInBounds(i,e))return!1;const r=this.controllerState.rotateStart({pos:i});return this.updateViewport(r,ea,{isDragging:!0}),!0}_onTriplePan(e){if(!this.touchRotate||!this.isDragging())return!1;const i=this.getCenter(e);i[0]-=e.deltaX;const r=this.controllerState.rotate({pos:i});return this.updateViewport(r,ea,{isDragging:!0,isRotating:!0}),!0}_onTriplePanEnd(e){if(!this.isDragging())return!1;const{inertia:i}=this;if(this.touchRotate&&i&&e.velocityY){const r=this.getCenter(e),o=[r[0],r[1]+=e.velocityY*i/2],u=this.controllerState.rotate({pos:o});this.updateViewport(u,{...this._getTransitionProps(),transitionDuration:i,transitionEasing:df},{isDragging:!1,isRotating:!0}),this.blockEvents(i)}else{const r=this.controllerState.rotateEnd();this.updateViewport(r,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(e){const i=this.getCenter(e);if(!this.isPointInBounds(i,e))return!1;const r=this.controllerState.zoomStart({pos:i}).rotateStart({pos:i});return Wa._startPinchRotation=e.rotation,Wa._lastPinchEvent=e,this.updateViewport(r,ea,{isDragging:!0}),!0}_onPinch(e){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let i=this.controllerState;if(this.touchZoom){const{scale:r}=e,o=this.getCenter(e);i=i.zoom({pos:o,scale:r})}if(this.touchRotate){const{rotation:r}=e;i=i.rotate({deltaAngleX:Wa._startPinchRotation-r})}return this.updateViewport(i,ea,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),Wa._lastPinchEvent=e,!0}_onPinchEnd(e){if(!this.isDragging())return!1;const{inertia:i}=this,{_lastPinchEvent:r}=Wa;if(this.touchZoom&&i&&r&&e.scale!==r.scale){const o=this.getCenter(e);let u=this.controllerState.rotateEnd();const d=Math.log2(e.scale),a=(d-Math.log2(r.scale))/(e.deltaTime-r.deltaTime),x=Math.pow(2,d+a*i/2);u=u.zoom({pos:o,scale:x}).zoomEnd(),this.updateViewport(u,{...this._getTransitionProps({around:o}),transitionDuration:i,transitionEasing:df},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(i)}else{const o=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(o,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return Wa._startPinchRotation=null,Wa._lastPinchEvent=null,!0}_onDoubleTap(e){if(!this.doubleClickZoom)return!1;const i=this.getCenter(e);if(!this.isPointInBounds(i,e))return!1;const r=this.isFunctionKeyPressed(e),o=this.controllerState.zoom({pos:i,scale:r?.5:2});return this.updateViewport(o,this._getTransitionProps({around:i}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(e){if(!this.keyboard)return!1;const i=this.isFunctionKeyPressed(e),{zoomSpeed:r,moveSpeed:o,rotateSpeedX:u,rotateSpeedY:d}=this.keyboard===!0?{}:this.keyboard,{controllerState:a}=this;let x;const A={};switch(e.srcEvent.code){case"Minus":x=i?a.zoomOut(r).zoomOut(r):a.zoomOut(r),A.isZooming=!0;break;case"Equal":x=i?a.zoomIn(r).zoomIn(r):a.zoomIn(r),A.isZooming=!0;break;case"ArrowLeft":i?(x=a.rotateLeft(u),A.isRotating=!0):(x=a.moveLeft(o),A.isPanning=!0);break;case"ArrowRight":i?(x=a.rotateRight(u),A.isRotating=!0):(x=a.moveRight(o),A.isPanning=!0);break;case"ArrowUp":i?(x=a.rotateUp(d),A.isRotating=!0):(x=a.moveUp(o),A.isPanning=!0);break;case"ArrowDown":i?(x=a.rotateDown(d),A.isRotating=!0):(x=a.moveDown(o),A.isPanning=!0);break;default:return!1}return this.updateViewport(x,this._getTransitionProps(),A),!0}_getTransitionProps(e){const{transition:i}=this;return!i||!i.transitionInterpolator?ea:e?{...i,transitionInterpolator:new Sx({...e,...i.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:i}}class xB{constructor(e,i){this._viewportProps=this.applyConstraints(e),this._state=i}getViewportProps(){return this._viewportProps}getState(){return this._state}}const Cx=5,wB=1.2;class TB extends xB{constructor(e){const{width:i,height:r,latitude:o,longitude:u,zoom:d,bearing:a=0,pitch:x=0,altitude:A=1.5,position:M=[0,0,0],maxZoom:D=20,minZoom:N=0,maxPitch:U=60,minPitch:re=0,startPanLngLat:ne,startZoomLngLat:xe,startRotatePos:Ae,startBearing:Te,startPitch:Ie,startZoom:Ue,normalize:Xe=!0}=e;yr(Number.isFinite(u)),yr(Number.isFinite(o)),yr(Number.isFinite(d)),super({width:i,height:r,latitude:o,longitude:u,zoom:d,bearing:a,pitch:x,altitude:A,maxZoom:D,minZoom:N,maxPitch:U,minPitch:re,normalize:Xe,position:M},{startPanLngLat:ne,startZoomLngLat:xe,startRotatePos:Ae,startBearing:Te,startPitch:Ie,startZoom:Ue}),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanLngLat:this._unproject(e)})}pan({pos:e,startPos:i}){const r=this.getState().startPanLngLat||this._unproject(i);if(!r)return this;const u=this.makeViewport(this.getViewportProps()).panByPosition(r,e);return this._getUpdatedState(u)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:e,deltaAngleX:i=0,deltaAngleY:r=0}){const{startRotatePos:o,startBearing:u,startPitch:d}=this.getState();if(!o||u===void 0||d===void 0)return this;let a;return e?a=this._getNewRotation(e,o,d,u):a={bearing:u+i,pitch:d+r},this._getUpdatedState(a)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:e}){return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:i,scale:r}){let{startZoom:o,startZoomLngLat:u}=this.getState();if(u||(o=this.getViewportProps().zoom,u=this._unproject(i)||this._unproject(e)),!u)return this;const{maxZoom:d,minZoom:a}=this.getViewportProps();let x=o+Math.log2(r);x=yo(x,a,d);const A=this.makeViewport({...this.getViewportProps(),zoom:x});return this._getUpdatedState({zoom:x,...A.panByPosition(u,e)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(e=2){return this._zoomFromCenter(e)}zoomOut(e=2){return this._zoomFromCenter(1/e)}moveLeft(e=100){return this._panFromCenter([e,0])}moveRight(e=100){return this._panFromCenter([-e,0])}moveUp(e=100){return this._panFromCenter([0,e])}moveDown(e=100){return this._panFromCenter([0,-e])}rotateLeft(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}shortestPathFrom(e){const i=e.getViewportProps(),r={...this.getViewportProps()},{bearing:o,longitude:u}=r;return Math.abs(o-i.bearing)>180&&(r.bearing=o<0?o+360:o-360),Math.abs(u-i.longitude)>180&&(r.longitude=u<0?u+360:u-360),r}applyConstraints(e){const{maxZoom:i,minZoom:r,zoom:o}=e;e.zoom=yo(o,r,i);const{maxPitch:u,minPitch:d,pitch:a}=e;e.pitch=yo(a,d,u);const{normalize:x=!0}=e;return x&&Object.assign(e,s3(e)),e}_zoomFromCenter(e){const{width:i,height:r}=this.getViewportProps();return this.zoom({pos:[i/2,r/2],scale:e})}_panFromCenter(e){const{width:i,height:r}=this.getViewportProps();return this.pan({startPos:[i/2,r/2],pos:[i/2+e[0],r/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}_unproject(e){const i=this.makeViewport(this.getViewportProps());return e&&i.unproject(e)}_getNewRotation(e,i,r,o){const u=e[0]-i[0],d=e[1]-i[1],a=e[1],x=i[1],{width:A,height:M}=this.getViewportProps(),D=u/A;let N=0;d>0?Math.abs(M-x)>Cx&&(N=d/(x-M)*wB):d<0&&x>Cx&&(N=1-a/x),N=yo(N,-1,1);const{minPitch:U,maxPitch:re}=this.getViewportProps(),ne=o+180*D;let xe=r;return N>0?xe=r+N*(re-r):N<0&&(xe=r-N*(U-r)),{pitch:xe,bearing:ne}}}class AB extends vB{constructor(){super(...arguments),this.ControllerState=TB,this.transition={transitionDuration:300,transitionInterpolator:new Sx({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})},this.dragMode="pan"}setProps(e){e.position=e.position||[0,0,0];const i=this.props;super.setProps(e),(!i||i.height!==e.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...e,...this.state}))}}class Gg extends dB{constructor(e={}){super(e)}get ViewportType(){return Ga}get ControllerType(){return AB}}Gg.displayName="MapView";const EB=new px;function SB(t,e){const i=t.order??1/0,r=e.order??1/0;return i-r}class CB{constructor(e){this._resolvedEffects=[],this._defaultEffects=[],this.effects=[],this._context=e,this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(e){const i=this._defaultEffects;if(!i.find(r=>r.id===e.id)){const r=i.findIndex(o=>SB(o,e)>0);r<0?i.push(e):i.splice(r,0,e),e.setup(this._context),this._setEffects(this.effects)}}setProps(e){"effects"in e&&(wn(e.effects,this.effects,1)||this._setEffects(e.effects))}needsRedraw(e={clearRedrawFlags:!1}){const i=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),i}getEffects(){return this._resolvedEffects}_setEffects(e){const i={};for(const o of this.effects)i[o.id]=o;const r=[];for(const o of e){const u=i[o.id];let d=o;u&&u!==o?u.setProps?(u.setProps(o.props),d=u):u.cleanup(this._context):u||o.setup(this._context),r.push(d),delete i[o.id]}for(const o in i)i[o].cleanup(this._context);this.effects=r,this._resolvedEffects=r.concat(this._defaultEffects),e.some(o=>o instanceof px)||this._resolvedEffects.push(EB),this._needsRedraw="effects changed"}finalize(){for(const e of this._resolvedEffects)e.cleanup(this._context);this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}class IB extends Fg{shouldDrawLayer(e){const{operation:i}=e.props;return i.includes("draw")||i.includes("terrain")}}const MB="deckRenderer.renderLayers";class RB{constructor(e){this.device=e,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new IB(e),this.pickLayersPass=new Tx(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(e){this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(e){if(!e.viewports.length)return;const i=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,r={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...e};r.effects&&this._preRender(r.effects,r);const o=this.lastPostProcessEffect?this.renderBuffers[0]:r.target;this.lastPostProcessEffect&&(r.clearColor=[0,0,0,0],r.clearCanvas=!0);const u=i.render({...r,target:o});r.effects&&this._postRender(r.effects,r),this.renderCount++,Wr(MB,this,u,e)}needsRedraw(e={clearRedrawFlags:!1}){const i=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),i}finalize(){const{renderBuffers:e}=this;for(const i of e)i.delete();e.length=0}_preRender(e,i){this.lastPostProcessEffect=null,i.preRenderStats=i.preRenderStats||{};for(const r of e)i.preRenderStats[r.id]=r.preRender(i),r.postRender&&(this.lastPostProcessEffect=r.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){const{renderBuffers:e}=this,i=this.device.canvasContext.getDrawingBufferSize();e.length===0&&[0,1].map(r=>{const o=this.device.createTexture({sampler:{minFilter:"linear",magFilter:"linear"}});e.push(this.device.createFramebuffer({id:`deck-renderbuffer-${r}`,colorAttachments:[o]}))});for(const r of e)r.resize(i)}_postRender(e,i){const{renderBuffers:r}=this,o={...i,inputBuffer:r[0],swapBuffer:r[1]};for(const u of e)if(u.postRender){o.target=u.id===this.lastPostProcessEffect?i.target:void 0;const d=u.postRender(o);o.inputBuffer=d,o.swapBuffer=d===r[0]?r[1]:r[0]}}}const PB={pickedColor:null,pickedObjectIndex:-1};function BB({pickedColors:t,decodePickingColor:e,deviceX:i,deviceY:r,deviceRadius:o,deviceRect:u}){const{x:d,y:a,width:x,height:A}=u;let M=o*o,D=-1,N=0;for(let U=0;U<A;U++){const re=U+a-r,ne=re*re;if(ne>M)N+=4*x;else for(let xe=0;xe<x;xe++){if(t[N+3]-1>=0){const Te=xe+d-i,Ie=Te*Te+ne;Ie<=M&&(M=Ie,D=N)}N+=4}}if(D>=0){const U=t.slice(D,D+4),re=e(U);if(re){const ne=Math.floor(D/4/x),xe=D/4-ne*x;return{...re,pickedColor:U,pickedX:d+xe,pickedY:a+ne}}Yt.error("Picked non-existent layer. Is picking buffer corrupt?")()}return PB}function DB({pickedColors:t,decodePickingColor:e}){const i=new Map;if(t){for(let r=0;r<t.length;r+=4)if(t[r+3]-1>=0){const u=t.slice(r,r+4),d=u.join(",");if(!i.has(d)){const a=e(u);a?i.set(d,{...a,color:u}):Yt.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(i.values())}function Ix({pickInfo:t,viewports:e,pixelRatio:i,x:r,y:o,z:u}){let d=e[0];e.length>1&&(d=FB((t==null?void 0:t.pickedViewports)||e,{x:r,y:o}));let a;if(d){const x=[r-d.x,o-d.y];u!==void 0&&(x[2]=u),a=d.unproject(x)}return{color:null,layer:null,viewport:d,index:-1,picked:!1,x:r,y:o,pixel:[r,o],coordinate:a,devicePixel:t&&"pickedX"in t?[t.pickedX,t.pickedY]:void 0,pixelRatio:i}}function OB(t){const{pickInfo:e,lastPickedInfo:i,mode:r,layers:o}=t,{pickedColor:u,pickedLayer:d,pickedObjectIndex:a}=e,x=d?[d]:[];if(r==="hover"){const D=i.index,N=i.layerId,U=d?d.props.id:null;if(U!==N||a!==D){if(U!==N){const re=o.find(ne=>ne.props.id===N);re&&x.unshift(re)}i.layerId=U,i.index=a,i.info=null}}const A=Ix(t),M=new Map;return M.set(null,A),x.forEach(D=>{let N={...A};D===d&&(N.color=u,N.index=a,N.picked=!0),N=Mx({layer:D,info:N,mode:r});const U=N.layer;D===d&&r==="hover"&&(i.info=N),M.set(U.id,N),r==="hover"&&U.updateAutoHighlight(N)}),M}function Mx({layer:t,info:e,mode:i}){for(;t&&e;){const r=e.layer||null;e.sourceLayer=r,e.layer=t,e=t.getPickingInfo({info:e,mode:i,sourceLayer:r}),t=t.parent}return e}function FB(t,e){for(let i=t.length-1;i>=0;i--){const r=t[i];if(r.containsPixel(e))return r}return t[0]}class kB{constructor(e){this._pickable=!0,this.device=e,this.pickLayersPass=new Tx(e),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.destroy(),this.depthFBO&&this.depthFBO.destroy()}pickObject(e){return this._pickClosestObject(e)}pickObjects(e){return this._pickVisibleObjects(e)}getLastPickedObject({x:e,y:i,layers:r,viewports:o},u=this.lastPickedInfo.info){const d=u&&u.layer&&u.layer.id,a=u&&u.viewport&&u.viewport.id,x=d?r.find(N=>N.id===d):null,A=a&&o.find(N=>N.id===a)||o[0],M=A&&A.unproject([e-A.x,i-A.y]);return{...u,...{x:e,y:i,viewport:A,coordinate:M,layer:x}}}_resizeBuffer(){var i,r;if(!this.pickingFBO&&(this.pickingFBO=this.device.createFramebuffer({colorAttachments:["rgba8unorm"],depthStencilAttachment:"depth16unorm"}),this.device.isTextureFormatRenderable("rgba32float"))){const o=this.device.createFramebuffer({colorAttachments:["rgba32float"],depthStencilAttachment:"depth16unorm"});this.depthFBO=o}const{canvas:e}=this.device.getCanvasContext();(i=this.pickingFBO)==null||i.resize({width:e.width,height:e.height}),(r=this.depthFBO)==null||r.resize({width:e.width,height:e.height})}_getPickable(e){if(this._pickable===!1)return null;const i=e.filter(r=>this.pickLayersPass.shouldDrawLayer(r)&&!r.isComposite);return i.length?i:null}_pickClosestObject({layers:e,views:i,viewports:r,x:o,y:u,radius:d=0,depth:a=1,mode:x="query",unproject3D:A,onViewportActive:M,effects:D}){const N=this.device.canvasContext.cssToDeviceRatio(),U=this._getPickable(e);if(!U||r.length===0)return{result:[],emptyInfo:Ix({viewports:r,x:o,y:u,pixelRatio:N})};this._resizeBuffer();const re=this.device.canvasContext.cssToDevicePixels([o,u],!0),ne=[re.x+Math.floor(re.width/2),re.y+Math.floor(re.height/2)],xe=Math.round(d*N),{width:Ae,height:Te}=this.pickingFBO,Ie=this._getPickingRect({deviceX:ne[0],deviceY:ne[1],deviceRadius:xe,deviceWidth:Ae,deviceHeight:Te}),Ue={x:o-d,y:u-d,width:d*2+1,height:d*2+1};let Xe;const qe=[],ht=new Set;for(let gt=0;gt<a;gt++){let nt;if(Ie){const bt=this._drawAndSample({layers:U,views:i,viewports:r,onViewportActive:M,deviceRect:Ie,cullRect:Ue,effects:D,pass:`picking:${x}`});nt=BB({...bt,deviceX:ne[0],deviceY:ne[1],deviceRadius:xe,deviceRect:Ie})}else nt={pickedColor:null,pickedObjectIndex:-1};let at;if(nt.pickedLayer&&A&&this.depthFBO){const{pickedColors:bt}=this._drawAndSample({layers:[nt.pickedLayer],views:i,viewports:r,onViewportActive:M,deviceRect:{x:nt.pickedX,y:nt.pickedY,width:1,height:1},cullRect:Ue,effects:D,pass:`picking:${x}:z`},!0);bt[3]&&(at=bt[0])}nt.pickedLayer&&gt+1<a&&(ht.add(nt.pickedLayer),nt.pickedLayer.disablePickingIndex(nt.pickedObjectIndex)),Xe=OB({pickInfo:nt,lastPickedInfo:this.lastPickedInfo,mode:x,layers:U,viewports:r,x:o,y:u,z:at,pixelRatio:N});for(const bt of Xe.values())bt.layer&&qe.push(bt);if(!nt.pickedColor)break}for(const gt of ht)gt.restorePickingColors();return{result:qe,emptyInfo:Xe.get(null)}}_pickVisibleObjects({layers:e,views:i,viewports:r,x:o,y:u,width:d=1,height:a=1,mode:x="query",maxObjects:A=null,onViewportActive:M,effects:D}){const N=this._getPickable(e);if(!N||r.length===0)return[];this._resizeBuffer();const U=this.device.canvasContext.cssToDeviceRatio(),re=this.device.canvasContext.cssToDevicePixels([o,u],!0),ne=re.x,xe=re.y+re.height,Ae=this.device.canvasContext.cssToDevicePixels([o+d,u+a],!0),Te=Ae.x+Ae.width,Ie=Ae.y,Ue={x:ne,y:Ie,width:Te-ne,height:xe-Ie},Xe=this._drawAndSample({layers:N,views:i,viewports:r,onViewportActive:M,deviceRect:Ue,cullRect:{x:o,y:u,width:d,height:a},effects:D,pass:`picking:${x}`}),qe=DB(Xe),ht=new Map,gt=[],nt=Number.isFinite(A);for(let at=0;at<qe.length&&!(nt&&gt.length>=A);at++){const bt=qe[at];let kt={color:bt.pickedColor,layer:null,index:bt.pickedObjectIndex,picked:!0,x:o,y:u,pixelRatio:U};kt=Mx({layer:bt.pickedLayer,info:kt,mode:x});const Ht=kt.layer.id;ht.has(Ht)||ht.set(Ht,new Set);const St=ht.get(Ht),xi=kt.object??kt.index;St.has(xi)||(St.add(xi),gt.push(kt))}return gt}_drawAndSample({layers:e,views:i,viewports:r,onViewportActive:o,deviceRect:u,cullRect:d,effects:a,pass:x},A=!1){const M=A?this.depthFBO:this.pickingFBO,D={layers:e,layerFilter:this.layerFilter,views:i,viewports:r,onViewportActive:o,pickingFBO:M,deviceRect:u,cullRect:d,effects:a,pass:x,pickZ:A,preRenderStats:{}};for(const Te of a)Te.useInPicking&&(D.preRenderStats[Te.id]=Te.preRender(D));const{decodePickingColor:N}=this.pickLayersPass.render(D),{x:U,y:re,width:ne,height:xe}=u,Ae=new(A?Float32Array:Uint8Array)(ne*xe*4);return this.device.readPixelsToArrayWebGL(M,{sourceX:U,sourceY:re,sourceWidth:ne,sourceHeight:xe,target:Ae}),{pickedColors:Ae,decodePickingColor:N}}_getPickingRect({deviceX:e,deviceY:i,deviceRadius:r,deviceWidth:o,deviceHeight:u}){const d=Math.max(0,e-r),a=Math.max(0,i-r),x=Math.min(o,e+r+1)-d,A=Math.min(u,i+r+1)-a;return x<=0||A<=0?null:{x:d,y:a,width:x,height:A}}}const NB={"top-left":{top:0,left:0},"top-right":{top:0,right:0},"bottom-left":{bottom:0,left:0},"bottom-right":{bottom:0,right:0},fill:{top:0,left:0,bottom:0,right:0}},LB="top-left",Rx="__root";class UB{constructor({deck:e,parentElement:i}){this.defaultWidgets=[],this.widgets=[],this.resolvedWidgets=[],this.containers={},this.lastViewports={},this.deck=e,this.parentElement=i}getWidgets(){return this.resolvedWidgets}setProps(e){e.widgets&&!wn(e.widgets,this.widgets,1)&&this._setWidgets(e.widgets)}finalize(){for(const e of this.getWidgets())this._remove(e);this.defaultWidgets.length=0,this.resolvedWidgets.length=0;for(const e in this.containers)this.containers[e].remove()}addDefault(e){this.defaultWidgets.find(i=>i.id===e.id)||(this._add(e),this.defaultWidgets.push(e),this._setWidgets(this.widgets))}_setWidgets(e){const i={};for(const r of this.resolvedWidgets)i[r.id]=r;this.resolvedWidgets.length=0;for(const r of this.defaultWidgets)i[r.id]=null,this.resolvedWidgets.push(r);for(let r of e){const o=i[r.id];o?o.viewId!==r.viewId||o.placement!==r.placement?(this._remove(o),this._add(r)):r!==o&&(o.setProps(r.props),r=o):this._add(r),i[r.id]=null,this.resolvedWidgets.push(r)}for(const r in i){const o=i[r];o&&this._remove(o)}this.widgets=e}_add(e){const{viewId:i=null,placement:r=LB}=e,o=e.onAdd({deck:this.deck,viewId:i});o&&this._getContainer(i,r).append(o),e._element=o}_remove(e){e.onRemove(),e._element&&e._element.remove(),e._element=void 0}_getContainer(e,i){var d;const r=e||Rx;let o=this.containers[r];o||(o=document.createElement("div"),o.style.pointerEvents="none",o.style.position="absolute",o.style.overflow="hidden",(d=this.parentElement)==null||d.append(o),this.containers[r]=o);let u=o.querySelector(`.${i}`);return u||(u=document.createElement("div"),u.className=i,u.style.position="absolute",u.style.zIndex="2",Object.assign(u.style,NB[i]),o.append(u)),u}_updateContainers(){const e=this.deck.width,i=this.deck.height;for(const r in this.containers){const o=this.lastViewports[r]||null,u=r===Rx||o,d=this.containers[r];u?(d.style.display="block",d.style.left=`${o?o.x:0}px`,d.style.top=`${o?o.y:0}px`,d.style.width=`${o?o.width:e}px`,d.style.height=`${o?o.height:i}px`):d.style.display="none"}}onRedraw({viewports:e,layers:i}){var u,d;const r=e.reduce((a,x)=>(a[x.id]=x,a),{}),{lastViewports:o}=this;for(const a of this.getWidgets()){const{viewId:x}=a;if(x){const A=r[x];A&&(a.onViewportChange&&!A.equals(o[x])&&a.onViewportChange(A),(u=a.onRedraw)==null||u.call(a,{viewports:[A],layers:i}))}else{if(a.onViewportChange)for(const A of e)A.equals(o[A.id])||a.onViewportChange(A);(d=a.onRedraw)==null||d.call(a,{viewports:e,layers:i})}}this.lastViewports=r,this._updateContainers()}onHover(e,i){var r,o;for(const u of this.getWidgets()){const{viewId:d}=u;(!d||d===((r=e.viewport)==null?void 0:r.id))&&((o=u.onHover)==null||o.call(u,e,i))}}onEvent(e,i){var o,u;const r=Sg[i.type];if(r)for(const d of this.getWidgets()){const{viewId:a}=d;(!a||a===((o=e.viewport)==null?void 0:o.id))&&((u=d[r.handler])==null||u.call(d,e,i))}}}const zB={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class VB{constructor(){this.id="default-tooltip",this.placement="fill",this.props={},this.isVisible=!1}onAdd({deck:e}){const i=document.createElement("div");return i.className="deck-tooltip",Object.assign(i.style,zB),this.deck=e,this.element=i,i}onRemove(){this.deck=void 0,this.element=void 0}setProps(){}onViewportChange(e){var i;this.isVisible&&e.id===((i=this.lastViewport)==null?void 0:i.id)&&e!==this.lastViewport&&this.setTooltip(null)}onHover(e){const{deck:i}=this,r=i&&i.props.getTooltip;if(!r)return;const o=r(e);this.lastViewport=e.viewport,this.setTooltip(o,e.x,e.y)}setTooltip(e,i,r){const o=this.element;if(o){if(typeof e=="string")o.innerText=e;else if(e)e.text&&(o.innerText=e.text),e.html&&(o.innerHTML=e.html),e.className&&(o.className=e.className);else{this.isVisible=!1,o.style.display="none";return}this.isVisible=!0,o.style.display="block",o.style.transform=`translate(${i}px, ${r}px)`,e&&typeof e=="object"&&"style"in e&&Object.assign(o.style,e.style)}}}var hc;(function(t){t[t.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",t[t.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",t[t.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN",t[t.ZERO=0]="ZERO",t[t.ONE=1]="ONE",t[t.SRC_COLOR=768]="SRC_COLOR",t[t.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",t[t.SRC_ALPHA=770]="SRC_ALPHA",t[t.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",t[t.DST_ALPHA=772]="DST_ALPHA",t[t.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",t[t.DST_COLOR=774]="DST_COLOR",t[t.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",t[t.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",t[t.CONSTANT_COLOR=32769]="CONSTANT_COLOR",t[t.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",t[t.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",t[t.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",t[t.FUNC_ADD=32774]="FUNC_ADD",t[t.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",t[t.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",t[t.BLEND_EQUATION=32777]="BLEND_EQUATION",t[t.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",t[t.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",t[t.BLEND_DST_RGB=32968]="BLEND_DST_RGB",t[t.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",t[t.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",t[t.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",t[t.BLEND_COLOR=32773]="BLEND_COLOR",t[t.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",t[t.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",t[t.LINE_WIDTH=2849]="LINE_WIDTH",t[t.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",t[t.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",t[t.CULL_FACE_MODE=2885]="CULL_FACE_MODE",t[t.FRONT_FACE=2886]="FRONT_FACE",t[t.DEPTH_RANGE=2928]="DEPTH_RANGE",t[t.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",t[t.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",t[t.DEPTH_FUNC=2932]="DEPTH_FUNC",t[t.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",t[t.STENCIL_FUNC=2962]="STENCIL_FUNC",t[t.STENCIL_FAIL=2964]="STENCIL_FAIL",t[t.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",t[t.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",t[t.STENCIL_REF=2967]="STENCIL_REF",t[t.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",t[t.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",t[t.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",t[t.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",t[t.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",t[t.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",t[t.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",t[t.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",t[t.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",t[t.VIEWPORT=2978]="VIEWPORT",t[t.SCISSOR_BOX=3088]="SCISSOR_BOX",t[t.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",t[t.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",t[t.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",t[t.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",t[t.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",t[t.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",t[t.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",t[t.RED_BITS=3410]="RED_BITS",t[t.GREEN_BITS=3411]="GREEN_BITS",t[t.BLUE_BITS=3412]="BLUE_BITS",t[t.ALPHA_BITS=3413]="ALPHA_BITS",t[t.DEPTH_BITS=3414]="DEPTH_BITS",t[t.STENCIL_BITS=3415]="STENCIL_BITS",t[t.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",t[t.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",t[t.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",t[t.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",t[t.SAMPLES=32937]="SAMPLES",t[t.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",t[t.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",t[t.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",t[t.VENDOR=7936]="VENDOR",t[t.RENDERER=7937]="RENDERER",t[t.VERSION=7938]="VERSION",t[t.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",t[t.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",t[t.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",t[t.STATIC_DRAW=35044]="STATIC_DRAW",t[t.STREAM_DRAW=35040]="STREAM_DRAW",t[t.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",t[t.BUFFER_SIZE=34660]="BUFFER_SIZE",t[t.BUFFER_USAGE=34661]="BUFFER_USAGE",t[t.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",t[t.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",t[t.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",t[t.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",t[t.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",t[t.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",t[t.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",t[t.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",t[t.CULL_FACE=2884]="CULL_FACE",t[t.FRONT=1028]="FRONT",t[t.BACK=1029]="BACK",t[t.FRONT_AND_BACK=1032]="FRONT_AND_BACK",t[t.BLEND=3042]="BLEND",t[t.DEPTH_TEST=2929]="DEPTH_TEST",t[t.DITHER=3024]="DITHER",t[t.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",t[t.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",t[t.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",t[t.SCISSOR_TEST=3089]="SCISSOR_TEST",t[t.STENCIL_TEST=2960]="STENCIL_TEST",t[t.NO_ERROR=0]="NO_ERROR",t[t.INVALID_ENUM=1280]="INVALID_ENUM",t[t.INVALID_VALUE=1281]="INVALID_VALUE",t[t.INVALID_OPERATION=1282]="INVALID_OPERATION",t[t.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",t[t.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",t[t.CW=2304]="CW",t[t.CCW=2305]="CCW",t[t.DONT_CARE=4352]="DONT_CARE",t[t.FASTEST=4353]="FASTEST",t[t.NICEST=4354]="NICEST",t[t.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.INT=5124]="INT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.FLOAT=5126]="FLOAT",t[t.DOUBLE=5130]="DOUBLE",t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.ALPHA=6406]="ALPHA",t[t.RGB=6407]="RGB",t[t.RGBA=6408]="RGBA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",t[t.VERTEX_SHADER=35633]="VERTEX_SHADER",t[t.COMPILE_STATUS=35713]="COMPILE_STATUS",t[t.DELETE_STATUS=35712]="DELETE_STATUS",t[t.LINK_STATUS=35714]="LINK_STATUS",t[t.VALIDATE_STATUS=35715]="VALIDATE_STATUS",t[t.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",t[t.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",t[t.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",t[t.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",t[t.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",t[t.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",t[t.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",t[t.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",t[t.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",t[t.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",t[t.SHADER_TYPE=35663]="SHADER_TYPE",t[t.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",t[t.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",t[t.NEVER=512]="NEVER",t[t.LESS=513]="LESS",t[t.EQUAL=514]="EQUAL",t[t.LEQUAL=515]="LEQUAL",t[t.GREATER=516]="GREATER",t[t.NOTEQUAL=517]="NOTEQUAL",t[t.GEQUAL=518]="GEQUAL",t[t.ALWAYS=519]="ALWAYS",t[t.KEEP=7680]="KEEP",t[t.REPLACE=7681]="REPLACE",t[t.INCR=7682]="INCR",t[t.DECR=7683]="DECR",t[t.INVERT=5386]="INVERT",t[t.INCR_WRAP=34055]="INCR_WRAP",t[t.DECR_WRAP=34056]="DECR_WRAP",t[t.NEAREST=9728]="NEAREST",t[t.LINEAR=9729]="LINEAR",t[t.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",t[t.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",t[t.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",t[t.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",t[t.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",t[t.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",t[t.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",t[t.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE=5890]="TEXTURE",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",t[t.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",t[t.TEXTURE0=33984]="TEXTURE0",t[t.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",t[t.REPEAT=10497]="REPEAT",t[t.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",t[t.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",t[t.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",t[t.FLOAT_VEC2=35664]="FLOAT_VEC2",t[t.FLOAT_VEC3=35665]="FLOAT_VEC3",t[t.FLOAT_VEC4=35666]="FLOAT_VEC4",t[t.INT_VEC2=35667]="INT_VEC2",t[t.INT_VEC3=35668]="INT_VEC3",t[t.INT_VEC4=35669]="INT_VEC4",t[t.BOOL=35670]="BOOL",t[t.BOOL_VEC2=35671]="BOOL_VEC2",t[t.BOOL_VEC3=35672]="BOOL_VEC3",t[t.BOOL_VEC4=35673]="BOOL_VEC4",t[t.FLOAT_MAT2=35674]="FLOAT_MAT2",t[t.FLOAT_MAT3=35675]="FLOAT_MAT3",t[t.FLOAT_MAT4=35676]="FLOAT_MAT4",t[t.SAMPLER_2D=35678]="SAMPLER_2D",t[t.SAMPLER_CUBE=35680]="SAMPLER_CUBE",t[t.LOW_FLOAT=36336]="LOW_FLOAT",t[t.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",t[t.HIGH_FLOAT=36338]="HIGH_FLOAT",t[t.LOW_INT=36339]="LOW_INT",t[t.MEDIUM_INT=36340]="MEDIUM_INT",t[t.HIGH_INT=36341]="HIGH_INT",t[t.FRAMEBUFFER=36160]="FRAMEBUFFER",t[t.RENDERBUFFER=36161]="RENDERBUFFER",t[t.RGBA4=32854]="RGBA4",t[t.RGB5_A1=32855]="RGB5_A1",t[t.RGB565=36194]="RGB565",t[t.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",t[t.STENCIL_INDEX=6401]="STENCIL_INDEX",t[t.STENCIL_INDEX8=36168]="STENCIL_INDEX8",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t[t.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",t[t.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",t[t.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",t[t.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",t[t.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",t[t.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",t[t.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",t[t.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",t[t.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",t[t.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",t[t.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",t[t.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",t[t.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",t[t.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",t[t.NONE=0]="NONE",t[t.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",t[t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",t[t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",t[t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",t[t.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",t[t.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",t[t.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",t[t.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",t[t.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",t[t.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",t[t.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",t[t.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",t[t.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",t[t.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",t[t.READ_BUFFER=3074]="READ_BUFFER",t[t.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",t[t.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",t[t.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",t[t.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",t[t.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",t[t.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",t[t.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",t[t.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",t[t.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",t[t.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",t[t.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",t[t.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",t[t.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",t[t.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",t[t.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",t[t.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",t[t.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",t[t.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",t[t.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",t[t.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",t[t.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",t[t.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",t[t.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",t[t.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",t[t.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",t[t.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",t[t.RED=6403]="RED",t[t.RGB8=32849]="RGB8",t[t.RGBA8=32856]="RGBA8",t[t.RGB10_A2=32857]="RGB10_A2",t[t.TEXTURE_3D=32879]="TEXTURE_3D",t[t.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",t[t.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",t[t.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",t[t.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",t[t.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",t[t.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",t[t.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",t[t.SRGB=35904]="SRGB",t[t.SRGB8=35905]="SRGB8",t[t.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",t[t.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",t[t.RGBA32F=34836]="RGBA32F",t[t.RGB32F=34837]="RGB32F",t[t.RGBA16F=34842]="RGBA16F",t[t.RGB16F=34843]="RGB16F",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",t[t.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",t[t.R11F_G11F_B10F=35898]="R11F_G11F_B10F",t[t.RGB9_E5=35901]="RGB9_E5",t[t.RGBA32UI=36208]="RGBA32UI",t[t.RGB32UI=36209]="RGB32UI",t[t.RGBA16UI=36214]="RGBA16UI",t[t.RGB16UI=36215]="RGB16UI",t[t.RGBA8UI=36220]="RGBA8UI",t[t.RGB8UI=36221]="RGB8UI",t[t.RGBA32I=36226]="RGBA32I",t[t.RGB32I=36227]="RGB32I",t[t.RGBA16I=36232]="RGBA16I",t[t.RGB16I=36233]="RGB16I",t[t.RGBA8I=36238]="RGBA8I",t[t.RGB8I=36239]="RGB8I",t[t.RED_INTEGER=36244]="RED_INTEGER",t[t.RGB_INTEGER=36248]="RGB_INTEGER",t[t.RGBA_INTEGER=36249]="RGBA_INTEGER",t[t.R8=33321]="R8",t[t.RG8=33323]="RG8",t[t.R16F=33325]="R16F",t[t.R32F=33326]="R32F",t[t.RG16F=33327]="RG16F",t[t.RG32F=33328]="RG32F",t[t.R8I=33329]="R8I",t[t.R8UI=33330]="R8UI",t[t.R16I=33331]="R16I",t[t.R16UI=33332]="R16UI",t[t.R32I=33333]="R32I",t[t.R32UI=33334]="R32UI",t[t.RG8I=33335]="RG8I",t[t.RG8UI=33336]="RG8UI",t[t.RG16I=33337]="RG16I",t[t.RG16UI=33338]="RG16UI",t[t.RG32I=33339]="RG32I",t[t.RG32UI=33340]="RG32UI",t[t.R8_SNORM=36756]="R8_SNORM",t[t.RG8_SNORM=36757]="RG8_SNORM",t[t.RGB8_SNORM=36758]="RGB8_SNORM",t[t.RGBA8_SNORM=36759]="RGBA8_SNORM",t[t.RGB10_A2UI=36975]="RGB10_A2UI",t[t.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",t[t.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",t[t.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",t[t.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",t[t.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",t[t.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",t[t.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",t[t.HALF_FLOAT=5131]="HALF_FLOAT",t[t.RG=33319]="RG",t[t.RG_INTEGER=33320]="RG_INTEGER",t[t.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",t[t.CURRENT_QUERY=34917]="CURRENT_QUERY",t[t.QUERY_RESULT=34918]="QUERY_RESULT",t[t.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",t[t.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",t[t.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",t[t.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",t[t.DRAW_BUFFER0=34853]="DRAW_BUFFER0",t[t.DRAW_BUFFER1=34854]="DRAW_BUFFER1",t[t.DRAW_BUFFER2=34855]="DRAW_BUFFER2",t[t.DRAW_BUFFER3=34856]="DRAW_BUFFER3",t[t.DRAW_BUFFER4=34857]="DRAW_BUFFER4",t[t.DRAW_BUFFER5=34858]="DRAW_BUFFER5",t[t.DRAW_BUFFER6=34859]="DRAW_BUFFER6",t[t.DRAW_BUFFER7=34860]="DRAW_BUFFER7",t[t.DRAW_BUFFER8=34861]="DRAW_BUFFER8",t[t.DRAW_BUFFER9=34862]="DRAW_BUFFER9",t[t.DRAW_BUFFER10=34863]="DRAW_BUFFER10",t[t.DRAW_BUFFER11=34864]="DRAW_BUFFER11",t[t.DRAW_BUFFER12=34865]="DRAW_BUFFER12",t[t.DRAW_BUFFER13=34866]="DRAW_BUFFER13",t[t.DRAW_BUFFER14=34867]="DRAW_BUFFER14",t[t.DRAW_BUFFER15=34868]="DRAW_BUFFER15",t[t.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",t[t.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",t[t.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",t[t.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",t[t.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",t[t.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",t[t.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",t[t.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",t[t.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",t[t.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",t[t.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",t[t.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",t[t.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",t[t.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",t[t.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",t[t.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",t[t.SAMPLER_3D=35679]="SAMPLER_3D",t[t.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",t[t.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",t[t.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",t[t.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",t[t.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",t[t.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",t[t.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",t[t.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",t[t.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",t[t.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",t[t.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",t[t.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",t[t.MAX_SAMPLES=36183]="MAX_SAMPLES",t[t.SAMPLER_BINDING=35097]="SAMPLER_BINDING",t[t.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",t[t.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",t[t.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",t[t.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",t[t.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",t[t.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",t[t.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",t[t.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",t[t.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",t[t.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",t[t.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",t[t.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",t[t.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",t[t.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",t[t.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",t[t.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",t[t.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",t[t.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",t[t.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",t[t.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",t[t.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",t[t.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",t[t.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",t[t.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",t[t.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",t[t.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",t[t.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",t[t.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",t[t.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",t[t.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",t[t.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",t[t.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",t[t.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",t[t.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",t[t.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",t[t.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",t[t.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",t[t.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",t[t.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",t[t.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",t[t.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",t[t.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",t[t.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",t[t.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",t[t.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",t[t.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",t[t.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",t[t.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",t[t.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",t[t.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",t[t.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",t[t.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",t[t.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",t[t.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",t[t.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",t[t.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",t[t.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",t[t.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",t[t.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",t[t.UNIFORM_TYPE=35383]="UNIFORM_TYPE",t[t.UNIFORM_SIZE=35384]="UNIFORM_SIZE",t[t.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",t[t.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",t[t.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",t[t.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",t[t.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",t[t.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",t[t.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",t[t.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",t[t.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",t[t.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",t[t.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",t[t.OBJECT_TYPE=37138]="OBJECT_TYPE",t[t.SYNC_CONDITION=37139]="SYNC_CONDITION",t[t.SYNC_STATUS=37140]="SYNC_STATUS",t[t.SYNC_FLAGS=37141]="SYNC_FLAGS",t[t.SYNC_FENCE=37142]="SYNC_FENCE",t[t.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",t[t.UNSIGNALED=37144]="UNSIGNALED",t[t.SIGNALED=37145]="SIGNALED",t[t.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",t[t.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",t[t.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",t[t.WAIT_FAILED=37149]="WAIT_FAILED",t[t.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",t[t.COLOR=6144]="COLOR",t[t.DEPTH=6145]="DEPTH",t[t.STENCIL=6146]="STENCIL",t[t.MIN=32775]="MIN",t[t.MAX=32776]="MAX",t[t.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",t[t.STREAM_READ=35041]="STREAM_READ",t[t.STREAM_COPY=35042]="STREAM_COPY",t[t.STATIC_READ=35045]="STATIC_READ",t[t.STATIC_COPY=35046]="STATIC_COPY",t[t.DYNAMIC_READ=35049]="DYNAMIC_READ",t[t.DYNAMIC_COPY=35050]="DYNAMIC_COPY",t[t.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",t[t.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",t[t.INVALID_INDEX=4294967295]="INVALID_INDEX",t[t.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",t[t.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",t[t.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",t[t.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",t[t.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",t[t.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",t[t.R16_EXT=33322]="R16_EXT",t[t.RG16_EXT=33324]="RG16_EXT",t[t.RGB16_EXT=32852]="RGB16_EXT",t[t.RGBA16_EXT=32859]="RGBA16_EXT",t[t.R16_SNORM_EXT=36760]="R16_SNORM_EXT",t[t.RG16_SNORM_EXT=36761]="RG16_SNORM_EXT",t[t.RGB16_SNORM_EXT=36762]="RGB16_SNORM_EXT",t[t.RGBA16_SNORM_EXT=36763]="RGBA16_SNORM_EXT",t[t.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",t[t.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",t[t.COMPRESSED_RED_RGTC1_EXT=36283]="COMPRESSED_RED_RGTC1_EXT",t[t.COMPRESSED_SIGNED_RED_RGTC1_EXT=36284]="COMPRESSED_SIGNED_RED_RGTC1_EXT",t[t.COMPRESSED_RED_GREEN_RGTC2_EXT=36285]="COMPRESSED_RED_GREEN_RGTC2_EXT",t[t.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT=36286]="COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT",t[t.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",t[t.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",t[t.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",t[t.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",t[t.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",t[t.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",t[t.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",t[t.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",t[t.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",t[t.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",t[t.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",t[t.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",t[t.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",t[t.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",t[t.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",t[t.COMPRESSED_RGBA_ASTC_5x4_KHR=37809]="COMPRESSED_RGBA_ASTC_5x4_KHR",t[t.COMPRESSED_RGBA_ASTC_5x5_KHR=37810]="COMPRESSED_RGBA_ASTC_5x5_KHR",t[t.COMPRESSED_RGBA_ASTC_6x5_KHR=37811]="COMPRESSED_RGBA_ASTC_6x5_KHR",t[t.COMPRESSED_RGBA_ASTC_6x6_KHR=37812]="COMPRESSED_RGBA_ASTC_6x6_KHR",t[t.COMPRESSED_RGBA_ASTC_8x5_KHR=37813]="COMPRESSED_RGBA_ASTC_8x5_KHR",t[t.COMPRESSED_RGBA_ASTC_8x6_KHR=37814]="COMPRESSED_RGBA_ASTC_8x6_KHR",t[t.COMPRESSED_RGBA_ASTC_8x8_KHR=37815]="COMPRESSED_RGBA_ASTC_8x8_KHR",t[t.COMPRESSED_RGBA_ASTC_10x5_KHR=37816]="COMPRESSED_RGBA_ASTC_10x5_KHR",t[t.COMPRESSED_RGBA_ASTC_10x6_KHR=37817]="COMPRESSED_RGBA_ASTC_10x6_KHR",t[t.COMPRESSED_RGBA_ASTC_10x8_KHR=37818]="COMPRESSED_RGBA_ASTC_10x8_KHR",t[t.COMPRESSED_RGBA_ASTC_10x10_KHR=37819]="COMPRESSED_RGBA_ASTC_10x10_KHR",t[t.COMPRESSED_RGBA_ASTC_12x10_KHR=37820]="COMPRESSED_RGBA_ASTC_12x10_KHR",t[t.COMPRESSED_RGBA_ASTC_12x12_KHR=37821]="COMPRESSED_RGBA_ASTC_12x12_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840]="COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR=37841]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR=37842]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR=37843]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR=37844]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR=37845]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR=37846]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR=37848]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR=37849]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR=37850]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR=37851]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR=37852]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR=37853]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR",t[t.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",t[t.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",t[t.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",t[t.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",t[t.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",t[t.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",t[t.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT",t[t.COMPLETION_STATUS_KHR=37297]="COMPLETION_STATUS_KHR",t[t.DEPTH_CLAMP_EXT=34383]="DEPTH_CLAMP_EXT",t[t.FIRST_VERTEX_CONVENTION_WEBGL=36429]="FIRST_VERTEX_CONVENTION_WEBGL",t[t.LAST_VERTEX_CONVENTION_WEBGL=36430]="LAST_VERTEX_CONVENTION_WEBGL",t[t.PROVOKING_VERTEX_WEBL=36431]="PROVOKING_VERTEX_WEBL",t[t.POLYGON_MODE_WEBGL=2880]="POLYGON_MODE_WEBGL",t[t.POLYGON_OFFSET_LINE_WEBGL=10754]="POLYGON_OFFSET_LINE_WEBGL",t[t.LINE_WEBGL=6913]="LINE_WEBGL",t[t.FILL_WEBGL=6914]="FILL_WEBGL",t[t.MAX_CLIP_DISTANCES_WEBGL=3378]="MAX_CLIP_DISTANCES_WEBGL",t[t.MAX_CULL_DISTANCES_WEBGL=33529]="MAX_CULL_DISTANCES_WEBGL",t[t.MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL=33530]="MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL",t[t.CLIP_DISTANCE0_WEBGL=12288]="CLIP_DISTANCE0_WEBGL",t[t.CLIP_DISTANCE1_WEBGL=12289]="CLIP_DISTANCE1_WEBGL",t[t.CLIP_DISTANCE2_WEBGL=12290]="CLIP_DISTANCE2_WEBGL",t[t.CLIP_DISTANCE3_WEBGL=12291]="CLIP_DISTANCE3_WEBGL",t[t.CLIP_DISTANCE4_WEBGL=12292]="CLIP_DISTANCE4_WEBGL",t[t.CLIP_DISTANCE5_WEBGL=12293]="CLIP_DISTANCE5_WEBGL",t[t.CLIP_DISTANCE6_WEBGL=12294]="CLIP_DISTANCE6_WEBGL",t[t.CLIP_DISTANCE7_WEBGL=12295]="CLIP_DISTANCE7_WEBGL",t[t.POLYGON_OFFSET_CLAMP_EXT=36379]="POLYGON_OFFSET_CLAMP_EXT",t[t.LOWER_LEFT_EXT=36001]="LOWER_LEFT_EXT",t[t.UPPER_LEFT_EXT=36002]="UPPER_LEFT_EXT",t[t.NEGATIVE_ONE_TO_ONE_EXT=37726]="NEGATIVE_ONE_TO_ONE_EXT",t[t.ZERO_TO_ONE_EXT=37727]="ZERO_TO_ONE_EXT",t[t.CLIP_ORIGIN_EXT=37724]="CLIP_ORIGIN_EXT",t[t.CLIP_DEPTH_MODE_EXT=37725]="CLIP_DEPTH_MODE_EXT",t[t.SRC1_COLOR_WEBGL=35065]="SRC1_COLOR_WEBGL",t[t.SRC1_ALPHA_WEBGL=34185]="SRC1_ALPHA_WEBGL",t[t.ONE_MINUS_SRC1_COLOR_WEBGL=35066]="ONE_MINUS_SRC1_COLOR_WEBGL",t[t.ONE_MINUS_SRC1_ALPHA_WEBGL=35067]="ONE_MINUS_SRC1_ALPHA_WEBGL",t[t.MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL=35068]="MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL",t[t.MIRROR_CLAMP_TO_EDGE_EXT=34627]="MIRROR_CLAMP_TO_EDGE_EXT"})(hc||(hc={}));const $g={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,35725:null,36006:null,36007:null,34229:null,34964:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32926:!1,32928:!1,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],36389:null,36662:null,36663:null,35053:null,35055:null,35723:4352,36010:null,35977:!1,3333:4,3317:4,37440:!1,37441:!1,37443:37444,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},sr=(t,e,i)=>e?t.enable(i):t.disable(i),Px=(t,e,i)=>t.hint(i,e),Es=(t,e,i)=>t.pixelStorei(i,e),Bx=(t,e,i)=>{const r=i===36006?36009:36008;return t.bindFramebuffer(r,e)},qh=(t,e,i)=>{const o={34964:34962,36662:36662,36663:36663,35053:35051,35055:35052}[i];t.bindBuffer(o,e)};function Wg(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}const jB={3042:sr,32773:(t,e)=>t.blendColor(...e),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(t,e)=>t.clearColor(...e),3107:(t,e)=>t.colorMask(...e),2884:sr,2885:(t,e)=>t.cullFace(e),2929:sr,2931:(t,e)=>t.clearDepth(e),2932:(t,e)=>t.depthFunc(e),2928:(t,e)=>t.depthRange(...e),2930:(t,e)=>t.depthMask(e),3024:sr,35723:Px,35725:(t,e)=>t.useProgram(e),36007:(t,e)=>t.bindRenderbuffer(36161,e),36389:(t,e)=>{var i;return(i=t.bindTransformFeedback)==null?void 0:i.call(t,36386,e)},34229:(t,e)=>t.bindVertexArray(e),36006:Bx,36010:Bx,34964:qh,36662:qh,36663:qh,35053:qh,35055:qh,2886:(t,e)=>t.frontFace(e),33170:Px,2849:(t,e)=>t.lineWidth(e),32823:sr,32824:"polygonOffset",10752:"polygonOffset",35977:sr,32926:sr,32928:sr,32938:"sampleCoverage",32939:"sampleCoverage",3089:sr,3088:(t,e)=>t.scissor(...e),2960:sr,2961:(t,e)=>t.clearStencil(e),2968:(t,e)=>t.stencilMaskSeparate(1028,e),36005:(t,e)=>t.stencilMaskSeparate(1029,e),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(t,e)=>t.viewport(...e),34383:sr,10754:sr,12288:sr,12289:sr,12290:sr,12291:sr,12292:sr,12293:sr,12294:sr,12295:sr,3333:Es,3317:Es,37440:Es,37441:Es,37443:Es,3330:Es,3332:Es,3331:Es,3314:Es,32878:Es,3316:Es,3315:Es,32877:Es,framebuffer:(t,e)=>{const i=e&&"handle"in e?e.handle:e;return t.bindFramebuffer(36160,i)},blend:(t,e)=>e?t.enable(3042):t.disable(3042),blendColor:(t,e)=>t.blendColor(...e),blendEquation:(t,e)=>{const i=typeof e=="number"?[e,e]:e;t.blendEquationSeparate(...i)},blendFunc:(t,e)=>{const i=(e==null?void 0:e.length)===2?[...e,...e]:e;t.blendFuncSeparate(...i)},clearColor:(t,e)=>t.clearColor(...e),clearDepth:(t,e)=>t.clearDepth(e),clearStencil:(t,e)=>t.clearStencil(e),colorMask:(t,e)=>t.colorMask(...e),cull:(t,e)=>e?t.enable(2884):t.disable(2884),cullFace:(t,e)=>t.cullFace(e),depthTest:(t,e)=>e?t.enable(2929):t.disable(2929),depthFunc:(t,e)=>t.depthFunc(e),depthMask:(t,e)=>t.depthMask(e),depthRange:(t,e)=>t.depthRange(...e),dither:(t,e)=>e?t.enable(3024):t.disable(3024),derivativeHint:(t,e)=>{t.hint(35723,e)},frontFace:(t,e)=>t.frontFace(e),mipmapHint:(t,e)=>t.hint(33170,e),lineWidth:(t,e)=>t.lineWidth(e),polygonOffsetFill:(t,e)=>e?t.enable(32823):t.disable(32823),polygonOffset:(t,e)=>t.polygonOffset(...e),sampleCoverage:(t,e)=>t.sampleCoverage(...e),scissorTest:(t,e)=>e?t.enable(3089):t.disable(3089),scissor:(t,e)=>t.scissor(...e),stencilTest:(t,e)=>e?t.enable(2960):t.disable(2960),stencilMask:(t,e)=>{e=Wg(e)?e:[e,e];const[i,r]=e;t.stencilMaskSeparate(1028,i),t.stencilMaskSeparate(1029,r)},stencilFunc:(t,e)=>{e=Wg(e)&&e.length===3?[...e,...e]:e;const[i,r,o,u,d,a]=e;t.stencilFuncSeparate(1028,i,r,o),t.stencilFuncSeparate(1029,u,d,a)},stencilOp:(t,e)=>{e=Wg(e)&&e.length===3?[...e,...e]:e;const[i,r,o,u,d,a]=e;t.stencilOpSeparate(1028,i,r,o),t.stencilOpSeparate(1029,u,d,a)},viewport:(t,e)=>t.viewport(...e)};function Gi(t,e,i){return e[t]!==void 0?e[t]:i[t]}const HB={blendEquation:(t,e,i)=>t.blendEquationSeparate(Gi(32777,e,i),Gi(34877,e,i)),blendFunc:(t,e,i)=>t.blendFuncSeparate(Gi(32969,e,i),Gi(32968,e,i),Gi(32971,e,i),Gi(32970,e,i)),polygonOffset:(t,e,i)=>t.polygonOffset(Gi(32824,e,i),Gi(10752,e,i)),sampleCoverage:(t,e,i)=>t.sampleCoverage(Gi(32938,e,i),Gi(32939,e,i)),stencilFuncFront:(t,e,i)=>t.stencilFuncSeparate(1028,Gi(2962,e,i),Gi(2967,e,i),Gi(2963,e,i)),stencilFuncBack:(t,e,i)=>t.stencilFuncSeparate(1029,Gi(34816,e,i),Gi(36003,e,i),Gi(36004,e,i)),stencilOpFront:(t,e,i)=>t.stencilOpSeparate(1028,Gi(2964,e,i),Gi(2965,e,i),Gi(2966,e,i)),stencilOpBack:(t,e,i)=>t.stencilOpSeparate(1029,Gi(34817,e,i),Gi(34818,e,i),Gi(34819,e,i))},Dx={enable:(t,e)=>t({[e]:!0}),disable:(t,e)=>t({[e]:!1}),pixelStorei:(t,e,i)=>t({[e]:i}),hint:(t,e,i)=>t({[e]:i}),useProgram:(t,e)=>t({35725:e}),bindRenderbuffer:(t,e,i)=>t({36007:i}),bindTransformFeedback:(t,e,i)=>t({36389:i}),bindVertexArray:(t,e)=>t({34229:e}),bindFramebuffer:(t,e,i)=>{switch(e){case 36160:return t({36006:i,36010:i});case 36009:return t({36006:i});case 36008:return t({36010:i});default:return null}},bindBuffer:(t,e,i)=>{const r={34962:[34964],36662:[36662],36663:[36663],35051:[35053],35052:[35055]}[e];return r?t({[r]:i}):{valueChanged:!0}},blendColor:(t,e,i,r,o)=>t({32773:new Float32Array([e,i,r,o])}),blendEquation:(t,e)=>t({32777:e,34877:e}),blendEquationSeparate:(t,e,i)=>t({32777:e,34877:i}),blendFunc:(t,e,i)=>t({32969:e,32968:i,32971:e,32970:i}),blendFuncSeparate:(t,e,i,r,o)=>t({32969:e,32968:i,32971:r,32970:o}),clearColor:(t,e,i,r,o)=>t({3106:new Float32Array([e,i,r,o])}),clearDepth:(t,e)=>t({2931:e}),clearStencil:(t,e)=>t({2961:e}),colorMask:(t,e,i,r,o)=>t({3107:[e,i,r,o]}),cullFace:(t,e)=>t({2885:e}),depthFunc:(t,e)=>t({2932:e}),depthRange:(t,e,i)=>t({2928:new Float32Array([e,i])}),depthMask:(t,e)=>t({2930:e}),frontFace:(t,e)=>t({2886:e}),lineWidth:(t,e)=>t({2849:e}),polygonOffset:(t,e,i)=>t({32824:e,10752:i}),sampleCoverage:(t,e,i)=>t({32938:e,32939:i}),scissor:(t,e,i,r,o)=>t({3088:new Int32Array([e,i,r,o])}),stencilMask:(t,e)=>t({2968:e,36005:e}),stencilMaskSeparate:(t,e,i)=>t({[e===1028?2968:36005]:i}),stencilFunc:(t,e,i,r)=>t({2962:e,2967:i,2963:r,34816:e,36003:i,36004:r}),stencilFuncSeparate:(t,e,i,r,o)=>t({[e===1028?2962:34816]:i,[e===1028?2967:36003]:r,[e===1028?2963:36004]:o}),stencilOp:(t,e,i,r)=>t({2964:e,2965:i,2966:r,34817:e,34818:i,34819:r}),stencilOpSeparate:(t,e,i,r,o)=>t({[e===1028?2964:34817]:i,[e===1028?2965:34818]:r,[e===1028?2966:34819]:o}),viewport:(t,e,i,r,o)=>t({2978:[e,i,r,o]})},Gn=(t,e)=>t.isEnabled(e),Ox={3042:Gn,2884:Gn,2929:Gn,3024:Gn,32823:Gn,32926:Gn,32928:Gn,3089:Gn,2960:Gn,35977:Gn},GB=new Set([34016,36388,36387,35983,35368,34965,35739,35738,3074,34853,34854,34855,34856,34857,34858,34859,34860,34861,34862,34863,34864,34865,34866,34867,34868,35097,32873,35869,32874,34068]);function uc(t,e){if(WB(e))return;const i={};for(const o in e){const u=Number(o),d=jB[o];d&&(typeof d=="string"?i[d]=!0:d(t,e[o],u))}const r=t.state&&t.state.cache;if(r)for(const o in i){const u=HB[o];u(t,e,r)}}function Fx(t,e=$g){if(typeof e=="number"){const o=e,u=Ox[o];return u?u(t,o):t.getParameter(o)}const i=Array.isArray(e)?e:Object.keys(e),r={};for(const o of i){const u=Ox[o];r[o]=u?u(t,Number(o)):t.getParameter(Number(o))}return r}function $B(t){uc(t,$g)}function WB(t){for(const e in t)return!1;return!0}function XB(t,e){if(t===e)return!0;const i=Array.isArray(t)||ArrayBuffer.isView(t),r=Array.isArray(e)||ArrayBuffer.isView(e);if(i&&r&&t.length===e.length){for(let o=0;o<t.length;++o)if(t[o]!==e[o])return!1;return!0}return!1}class qB{constructor(e,{copyState:i=!1,log:r=()=>{}}={}){L(this,"gl");L(this,"program",null);L(this,"stateStack",[]);L(this,"enable",!0);L(this,"cache");L(this,"log");this.gl=e,this.cache=i?Fx(e):Object.assign({},$g),this.log=r,this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(e={}){this.stateStack.push({})}pop(){ti(this.stateStack.length>0);const e=this.stateStack[this.stateStack.length-1];uc(this.gl,e),this.stateStack.pop()}_updateCache(e){let i=!1,r;const o=this.stateStack.length>0?this.stateStack[this.stateStack.length-1]:null;for(const u in e){ti(u!==void 0);const d=e[u],a=this.cache[u];XB(d,a)||(i=!0,r=a,o&&!(u in o)&&(o[u]=a),this.cache[u]=d)}return{valueChanged:i,oldValue:r}}}function Xa(t){return t.state}function kx(t,e){const{enable:i=!0,copyState:r}=e;if(ti(r!==void 0),!t.state){t.state=new qB(t,{copyState:r}),KB(t);for(const u in Dx){const d=Dx[u];ZB(t,u,d)}Nx(t,"getParameter"),Nx(t,"isEnabled")}const o=Xa(t);return o.enable=i,t}function ff(t){let e=Xa(t);e||(kx(t,{copyState:!1}),e=Xa(t)),e.push()}function Zh(t){const e=Xa(t);ti(e),e.pop()}function Nx(t,e){const i=t[e].bind(t);t[e]=function(o){if(o===void 0||GB.has(o))return i(o);const u=Xa(t);return o in u.cache||(u.cache[o]=i(o)),u.enable?u.cache[o]:i(o)},Object.defineProperty(t[e],"name",{value:`${e}-from-cache`,configurable:!1})}function ZB(t,e,i){if(!t[e])return;const r=t[e].bind(t);t[e]=function(...u){const d=Xa(t),{valueChanged:a,oldValue:x}=i(d._updateCache,...u);return a&&r(...u),x},Object.defineProperty(t[e],"name",{value:`${e}-to-cache`,configurable:!1})}function KB(t){const e=t.useProgram.bind(t);t.useProgram=function(r){const o=Xa(t);o.program!==r&&(e(r),o.program=r)}}const YB={powerPreference:"high-performance",onContextLost:()=>console.error("WebGL context lost"),onContextRestored:()=>console.info("WebGL context restored")};function JB(t,e){e={...YB,...e};let i=null;const r=u=>i=u.statusMessage||i;t.addEventListener("webglcontextcreationerror",r,!1);let o=null;if(o||(o=t.getContext("webgl2",e)),t.removeEventListener("webglcontextcreationerror",r,!1),!o)throw new Error(`Failed to create WebGL context: ${i||"Unknown error"}`);if(e.onContextLost){const{onContextLost:u}=e;t.addEventListener("webglcontextlost",d=>u(d),!1)}if(e.onContextRestored){const{onContextRestored:u}=e;t.addEventListener("webglcontextrestored",d=>u(d),!1)}return o}function ta(t,e,i){return i[e]===void 0&&(i[e]=t.getExtension(e)||null),i[e]}function QB(t,e){const i=t.getParameter(7936),r=t.getParameter(7937);ta(t,"WEBGL_debug_renderer_info",e);const o=e.WEBGL_debug_renderer_info,u=t.getParameter(o?o.UNMASKED_VENDOR_WEBGL:7936),d=t.getParameter(o?o.UNMASKED_RENDERER_WEBGL:7937),a=u||i,x=d||r,A=t.getParameter(7938),M=Lx(a,x),D=eD(a,x),N=tD(a,x);return{type:"webgl",gpu:M,gpuType:N,gpuBackend:D,vendor:a,renderer:x,version:A,shadingLanguage:"glsl",shadingLanguageVersion:300}}function Lx(t,e){return/NVIDIA/i.exec(t)||/NVIDIA/i.exec(e)?"nvidia":/INTEL/i.exec(t)||/INTEL/i.exec(e)?"intel":/Apple/i.exec(t)||/Apple/i.exec(e)?"apple":/AMD/i.exec(t)||/AMD/i.exec(e)||/ATI/i.exec(t)||/ATI/i.exec(e)?"amd":/SwiftShader/i.exec(t)||/SwiftShader/i.exec(e)?"software":"unknown"}function eD(t,e){return/Metal/i.exec(t)||/Metal/i.exec(e)?"metal":/ANGLE/i.exec(t)||/ANGLE/i.exec(e)?"opengl":"unknown"}function tD(t,e){if(/SwiftShader/i.exec(t)||/SwiftShader/i.exec(e))return"cpu";switch(Lx(t,e)){case"intel":return"integrated";case"software":return"cpu";case"unknown":return"unknown";default:return"discrete"}}function Ux(t){switch(t){case"uint8":return 5121;case"sint8":return 5120;case"unorm8":return 5121;case"snorm8":return 5120;case"uint16":return 5123;case"sint16":return 5122;case"unorm16":return 5123;case"snorm16":return 5122;case"uint32":return 5125;case"sint32":return 5124;case"float16":return 5131;case"float32":return 5126}throw new Error(String(t))}const Xr="texture-compression-bc",di="texture-compression-astc",$n="texture-compression-etc2",iD="texture-compression-etc1-webgl",pf="texture-compression-pvrtc-webgl",Xg="texture-compression-atc-webgl",Kh="float32-renderable-webgl",qg="float16-renderable-webgl",rD="rgb9e5ufloat_renderable-webgl",Zg="snorm8-renderable-webgl",Yh="norm16-renderable-webgl",Kg="snorm16-renderable-webgl",_f="float32-filterable",zx="float16-filterable-webgl",Jh="WEBGL_compressed_texture_s3tc",Qh="WEBGL_compressed_texture_s3tc_srgb",dc="EXT_texture_compression_rgtc",fc="EXT_texture_compression_bptc",sD="WEBGL_compressed_texture_etc",nD="WEBGL_compressed_texture_astc",oD="WEBGL_compressed_texture_etc1",aD="WEBGL_compressed_texture_pvrtc",lD="WEBGL_compressed_texture_atc",Vx="EXT_texture_norm16",jx="EXT_render_snorm",cD="EXT_color_buffer_float",Yg={"float32-renderable-webgl":["EXT_color_buffer_float"],"float16-renderable-webgl":["EXT_color_buffer_half_float"],"rgb9e5ufloat_renderable-webgl":["WEBGL_render_shared_exponent"],"snorm8-renderable-webgl":[jx],"norm16-renderable-webgl":[Vx],"snorm16-renderable-webgl":[Vx,jx],"float32-filterable":["OES_texture_float_linear"],"float16-filterable-webgl":["OES_texture_half_float_linear"],"texture-filterable-anisotropic-webgl":["EXT_texture_filter_anisotropic"],"texture-blend-float-webgl":["EXT_float_blend"],"texture-compression-bc":[Jh,Qh,dc,fc],"texture-compression-bc5-webgl":[dc],"texture-compression-bc7-webgl":[fc],"texture-compression-etc2":[sD],"texture-compression-astc":[nD],"texture-compression-etc1-webgl":[oD],"texture-compression-pvrtc-webgl":[aD],"texture-compression-atc-webgl":[lD]};function hD(t){return t in Yg}function uD(t,e,i){return(Yg[e]||[]).every(o=>ta(t,o,i))}const gf={"rgb8unorm-unsized":{gl:6407,b:4,c:2,bpp:4,dataFormat:6407,types:[5121,33635]},"rgba8unorm-unsized":{gl:6408,b:4,c:2,bpp:4,dataFormat:6408,types:[5121,32819,32820]},r8unorm:{gl:33321,b:1,c:1,rb:!0},r8snorm:{gl:36756,b:1,c:1,render:Zg},r8uint:{gl:33330,b:1,c:1,rb:!0},r8sint:{gl:33329,b:1,c:1,rb:!0},rg8unorm:{gl:33323,b:2,c:2,rb:!0},rg8snorm:{gl:36757,b:2,c:2,render:Zg},rg8uint:{gl:33336,b:2,c:2,rb:!0},rg8sint:{gl:33335,b:2,c:2,rb:!0},r16uint:{gl:33332,b:2,c:1,rb:!0},r16sint:{gl:33331,b:2,c:1,rb:!0},r16float:{gl:33325,b:2,c:1,render:qg,filter:"float16-filterable-webgl",rb:!0},"r16unorm-webgl":{gl:33322,b:2,c:1,f:Yh,rb:!0},"r16snorm-webgl":{gl:36760,b:2,c:1,f:Kg},"rgba4unorm-webgl":{gl:32854,b:2,c:4,wgpu:!1,rb:!0},"rgb565unorm-webgl":{gl:36194,b:2,c:4,wgpu:!1,rb:!0},"rgb5a1unorm-webgl":{gl:32855,b:2,c:4,wgpu:!1,rb:!0},"rgb8unorm-webgl":{gl:32849,b:3,c:3,wgpu:!1},"rgb8snorm-webgl":{gl:36758,b:3,c:3,wgpu:!1},rgba8unorm:{gl:32856,b:4,c:2,bpp:4},"rgba8unorm-srgb":{gl:35907,b:4,c:4,bpp:4},rgba8snorm:{gl:36759,b:4,c:4,render:Zg},rgba8uint:{gl:36220,b:4,c:4,bpp:4},rgba8sint:{gl:36238,b:4,c:4,bpp:4},bgra8unorm:{b:4,c:4},"bgra8unorm-srgb":{b:4,c:4},rg16uint:{gl:33338,b:4,c:1,bpp:4},rg16sint:{gl:33337,b:4,c:2,bpp:4},rg16float:{gl:33327,bpp:4,b:4,c:2,render:qg,filter:zx,rb:!0},"rg16unorm-webgl":{gl:33324,b:2,c:2,render:Yh},"rg16snorm-webgl":{gl:36761,b:2,c:2,render:Kg},r32uint:{gl:33334,b:4,c:1,bpp:4,rb:!0},r32sint:{gl:33333,b:4,c:1,bpp:4,rb:!0},r32float:{gl:33326,bpp:4,b:4,c:1,render:Kh,filter:_f},rgb9e5ufloat:{gl:35901,b:4,c:3,p:1,render:rD},rg11b10ufloat:{gl:35898,b:4,c:3,p:1,render:Kh,rb:!0},rgb10a2unorm:{gl:32857,b:4,c:4,p:1,rb:!0},"rgb10a2uint-webgl":{b:4,c:4,gl:36975,p:1,wgpu:!1,bpp:4,rb:!0},"rgb16unorm-webgl":{gl:32852,b:2,c:3,f:Yh},"rgb16snorm-webgl":{gl:36762,b:2,c:3,f:Yh},rg32uint:{gl:33340,b:8,c:2,rb:!0},rg32sint:{gl:33339,b:8,c:2,rb:!0},rg32float:{gl:33328,b:8,c:2,render:Kh,filter:_f,rb:!0},rgba16uint:{gl:36214,b:8,c:4,rb:!0},rgba16sint:{gl:36232,b:8,c:4,rb:!0},rgba16float:{gl:34842,b:8,c:4,render:qg,filter:zx},"rgba16unorm-webgl":{gl:32859,b:2,c:4,render:Yh,rb:!0},"rgba16snorm-webgl":{gl:36763,b:2,c:4,render:Kg},"rgb32float-webgl":{gl:34837,render:Kh,filter:_f,gl2ext:cD,dataFormat:6407,types:[5126]},rgba32uint:{gl:36208,b:16,c:4,rb:!0},rgba32sint:{gl:36226,b:16,c:4,rb:!0},rgba32float:{gl:34836,b:16,c:4,render:Kh,filter:_f,rb:!0},stencil8:{gl:36168,b:1,c:1,attachment:36128,rb:!0},depth16unorm:{gl:33189,b:2,c:1,attachment:36096,dataFormat:6402,types:[5123],rb:!0},depth24plus:{gl:33190,b:3,c:1,attachment:36096,dataFormat:6402,types:[5125]},depth32float:{gl:36012,b:4,c:1,attachment:36096,dataFormat:6402,types:[5126],rb:!0},"depth24plus-stencil8":{gl:35056,b:4,c:2,p:1,attachment:33306,rb:!0,depthTexture:!0,dataFormat:34041,types:[34042]},"depth24unorm-stencil8":{gl:35056,b:4,c:2,p:1,attachment:33306,dataFormat:34041,types:[34042],rb:!0},"depth32float-stencil8":{gl:36013,b:5,c:2,p:1,attachment:33306,dataFormat:34041,types:[36269],rb:!0},"bc1-rgb-unorm-webgl":{gl:33776,x:Jh,f:Xr},"bc1-rgb-unorm-srgb-webgl":{gl:35916,x:Qh,f:Xr},"bc1-rgba-unorm":{gl:33777,x:Jh,f:Xr},"bc1-rgba-unorm-srgb":{gl:35916,x:Qh,f:Xr},"bc2-rgba-unorm":{gl:33778,x:Jh,f:Xr},"bc2-rgba-unorm-srgb":{gl:35918,x:Qh,f:Xr},"bc3-rgba-unorm":{gl:33779,x:Jh,f:Xr},"bc3-rgba-unorm-srgb":{gl:35919,x:Qh,f:Xr},"bc4-r-unorm":{gl:36283,x:dc,f:Xr},"bc4-r-snorm":{gl:36284,x:dc,f:Xr},"bc5-rg-unorm":{gl:36285,x:dc,f:Xr},"bc5-rg-snorm":{gl:36286,x:dc,f:Xr},"bc6h-rgb-ufloat":{gl:36495,x:fc,f:Xr},"bc6h-rgb-float":{gl:36494,x:fc,f:Xr},"bc7-rgba-unorm":{gl:36492,x:fc,f:Xr},"bc7-rgba-unorm-srgb":{gl:36493,x:fc,f:Xr},"etc2-rgb8unorm":{gl:37492,f:$n},"etc2-rgb8unorm-srgb":{gl:37494,f:$n},"etc2-rgb8a1unorm":{gl:37496,f:$n},"etc2-rgb8a1unorm-srgb":{gl:37497,f:$n},"etc2-rgba8unorm":{gl:37493,f:$n},"etc2-rgba8unorm-srgb":{gl:37495,f:$n},"eac-r11unorm":{gl:37488,f:$n},"eac-r11snorm":{gl:37489,f:$n},"eac-rg11unorm":{gl:37490,f:$n},"eac-rg11snorm":{gl:37491,f:$n},"astc-4x4-unorm":{gl:37808,f:di},"astc-4x4-unorm-srgb":{gl:37840,f:di},"astc-5x4-unorm":{gl:37809,f:di},"astc-5x4-unorm-srgb":{gl:37841,f:di},"astc-5x5-unorm":{gl:37810,f:di},"astc-5x5-unorm-srgb":{gl:37842,f:di},"astc-6x5-unorm":{gl:37811,f:di},"astc-6x5-unorm-srgb":{gl:37843,f:di},"astc-6x6-unorm":{gl:37812,f:di},"astc-6x6-unorm-srgb":{gl:37844,f:di},"astc-8x5-unorm":{gl:37813,f:di},"astc-8x5-unorm-srgb":{gl:37845,f:di},"astc-8x6-unorm":{gl:37814,f:di},"astc-8x6-unorm-srgb":{gl:37846,f:di},"astc-8x8-unorm":{gl:37815,f:di},"astc-8x8-unorm-srgb":{gl:37847,f:di},"astc-10x5-unorm":{gl:37819,f:di},"astc-10x5-unorm-srgb":{gl:37851,f:di},"astc-10x6-unorm":{gl:37817,f:di},"astc-10x6-unorm-srgb":{gl:37849,f:di},"astc-10x8-unorm":{gl:37818,f:di},"astc-10x8-unorm-srgb":{gl:37850,f:di},"astc-10x10-unorm":{gl:37819,f:di},"astc-10x10-unorm-srgb":{gl:37851,f:di},"astc-12x10-unorm":{gl:37820,f:di},"astc-12x10-unorm-srgb":{gl:37852,f:di},"astc-12x12-unorm":{gl:37821,f:di},"astc-12x12-unorm-srgb":{gl:37853,f:di},"pvrtc-rgb4unorm-webgl":{gl:35840,f:pf},"pvrtc-rgba4unorm-webgl":{gl:35842,f:pf},"pvrtc-rbg2unorm-webgl":{gl:35841,f:pf},"pvrtc-rgba2unorm-webgl":{gl:35843,f:pf},"etc1-rbg-unorm-webgl":{gl:36196,f:iD},"atc-rgb-unorm-webgl":{gl:35986,f:Xg},"atc-rgba-unorm-webgl":{gl:35986,f:Xg},"atc-rgbai-unorm-webgl":{gl:34798,f:Xg}},dD={6403:1,36244:1,33319:2,33320:2,6407:3,36248:3,6408:4,36249:4,6402:1,34041:1,6406:1,6409:1,6410:2},fD={5126:4,5125:4,5124:4,5123:2,5122:2,5131:2,5120:1,5121:1};function Jg(t,e,i){const r=gf[e];if(!r||r.gl===void 0)return!1;const o=r.x||r.gl2ext;return o?!!ta(t,o,i):!0}function Hx(t){const e=gf[t],i=e==null?void 0:e.gl;if(i===void 0)throw new Error(`Unsupported texture format ${t}`);return i}function pD(t,e,i){if(!Jg(t,e,i)||e.startsWith("depth")||e.startsWith("stencil"))return!1;try{if(Hb(e).signed)return!1}catch{return!1}return e.endsWith("32float")?!!ta(t,"OES_texture_float_linear, extensions",i):e.endsWith("16float")?!!ta(t,"OES_texture_half_float_linear, extensions",i):!0}function _D(t,e,i){return!(!Jg(t,e,i)||typeof e=="number")}function mf(t){var o;const e=gf[t],i=Hx(t),r=Hb(t);return{format:i,dataFormat:(e==null?void 0:e.dataFormat)||mD(r.format,r.integer,r.normalized,i),type:r.dataType?Ux(r.dataType):((o=e==null?void 0:e.types)==null?void 0:o[0])||5121,compressed:r.compressed}}function gD(t){const e=gf[t];if(!(e!=null&&e.attachment))throw new Error(`${t} is not a depth stencil format`);return e.attachment}function Gx(t){const e=mf(t),i=dD[e.dataFormat]||4,r=fD[e.type]||1;return i*r}function mD(t,e,i,r){if(r===6408||r===6407)return r;switch(t){case"r":return e&&!i?36244:6403;case"rg":return e&&!i?33320:33319;case"rgb":return e&&!i?36248:6407;case"rgba":return e&&!i?36249:6408;default:return 6408}}const $x={"depth-clip-control":"EXT_depth_clamp","timer-query-webgl":"EXT_disjoint_timer_query_webgl2","compilation-status-async-webgl":"KHR_parallel_shader_compile","polygon-mode-webgl":"WEBGL_polygon_mode","provoking-vertex-webgl":"WEBGL_provoking_vertex","shader-clip-cull-distance-webgl":"WEBGL_clip_cull_distance","shader-noperspective-interpolation-webgl":"NV_shader_noperspective_interpolation","shader-conservative-depth-webgl":"EXT_conservative_depth"};class yD extends mI{constructor(i,r,o){super([],o);L(this,"gl");L(this,"extensions");L(this,"testedFeatures",new Set);this.gl=i,this.extensions=r,ta(i,"EXT_color_buffer_float",r)}*[Symbol.iterator](){const i=this.getFeatures();for(const r of i)this.has(r)&&(yield r);return[]}has(i){return this.disabledFeatures[i]?!1:(this.testedFeatures.has(i)||(this.testedFeatures.add(i),hD(i)&&uD(this.gl,i,this.extensions)&&this.features.add(i),this.getWebGLFeature(i)&&this.features.add(i)),this.features.has(i))}initializeFeatures(){const i=this.getFeatures().filter(r=>r!=="polygon-mode-webgl");for(const r of i)this.has(r)}getFeatures(){return[...Object.keys($x),...Object.keys(Yg)]}getWebGLFeature(i){const r=$x[i];return typeof r=="string"?!!ta(this.gl,r,this.extensions):!!r}}class bD extends gI{constructor(i){super();L(this,"gl");L(this,"limits",{});this.gl=i}get maxTextureDimension1D(){return 0}get maxTextureDimension2D(){return this.getParameter(3379)}get maxTextureDimension3D(){return this.getParameter(32883)}get maxTextureArrayLayers(){return this.getParameter(35071)}get maxBindGroups(){return 0}get maxDynamicUniformBuffersPerPipelineLayout(){return 0}get maxDynamicStorageBuffersPerPipelineLayout(){return 0}get maxSampledTexturesPerShaderStage(){return this.getParameter(35660)}get maxSamplersPerShaderStage(){return this.getParameter(35661)}get maxStorageBuffersPerShaderStage(){return 0}get maxStorageTexturesPerShaderStage(){return 0}get maxUniformBuffersPerShaderStage(){return this.getParameter(35375)}get maxUniformBufferBindingSize(){return this.getParameter(35376)}get maxStorageBufferBindingSize(){return 0}get minUniformBufferOffsetAlignment(){return this.getParameter(35380)}get minStorageBufferOffsetAlignment(){return 0}get maxVertexBuffers(){return 16}get maxVertexAttributes(){return this.getParameter(34921)}get maxVertexBufferArrayStride(){return 2048}get maxInterStageShaderComponents(){return this.getParameter(35659)}get maxComputeWorkgroupStorageSize(){return 0}get maxComputeInvocationsPerWorkgroup(){return 0}get maxComputeWorkgroupSizeX(){return 0}get maxComputeWorkgroupSizeY(){return 0}get maxComputeWorkgroupSizeZ(){return 0}get maxComputeWorkgroupsPerDimension(){return 0}getParameter(i){return this.limits[i]===void 0&&(this.limits[i]=this.gl.getParameter(i)),this.limits[i]}}function ia(t,e,i){if(vD(e))return i(t);const{nocatch:r=!0}=e;ff(t),uc(t,e);let o;if(r)o=i(t),Zh(t);else try{o=i(t)}finally{Zh(t)}return o}function vD(t){for(const e in t)return!1;return!0}function xD(t,e,i,r){if(Fd(e))return r(t);const o=t;ff(o.gl);try{return wD(t,e),uc(o.gl,i),r(t)}finally{Zh(o.gl)}}function wD(t,e){const i=t,{gl:r}=i;if(e.cullMode)switch(e.cullMode){case"none":r.disable(2884);break;case"front":r.enable(2884),r.cullFace(1028);break;case"back":r.enable(2884),r.cullFace(1029);break}if(e.frontFace&&r.frontFace(qa("frontFace",e.frontFace,{ccw:2305,cw:2304})),e.unclippedDepth&&t.features.has("depth-clip-control")&&r.enable(34383),e.depthBias!==void 0&&(r.enable(32823),r.polygonOffset(e.depthBias,e.depthBiasSlopeScale||0)),e.provokingVertex&&t.features.has("provoking-vertex-webgl")){const u=i.getExtension("WEBGL_provoking_vertex").WEBGL_provoking_vertex,d=qa("provokingVertex",e.provokingVertex,{first:36429,last:36430});u==null||u.provokingVertexWEBGL(d)}if((e.polygonMode||e.polygonOffsetLine)&&t.features.has("polygon-mode-webgl")){if(e.polygonMode){const u=i.getExtension("WEBGL_polygon_mode").WEBGL_polygon_mode,d=qa("polygonMode",e.polygonMode,{fill:6914,line:6913});u==null||u.polygonModeWEBGL(1028,d),u==null||u.polygonModeWEBGL(1029,d)}e.polygonOffsetLine&&r.enable(10754)}if(t.features.has("shader-clip-cull-distance-webgl")&&(e.clipDistance0&&r.enable(12288),e.clipDistance1&&r.enable(12289),e.clipDistance2&&r.enable(12290),e.clipDistance3&&r.enable(12291),e.clipDistance4&&r.enable(12292),e.clipDistance5&&r.enable(12293),e.clipDistance6&&r.enable(12294),e.clipDistance7&&r.enable(12295)),e.depthWriteEnabled!==void 0&&r.depthMask(AD("depthWriteEnabled",e.depthWriteEnabled)),e.depthCompare&&(e.depthCompare!=="always"?r.enable(2929):r.disable(2929),r.depthFunc(Qg("depthCompare",e.depthCompare))),e.stencilWriteMask){const o=e.stencilWriteMask;r.stencilMaskSeparate(1028,o),r.stencilMaskSeparate(1029,o)}if(e.stencilReadMask&&Je.warn("stencilReadMask not supported under WebGL"),e.stencilCompare){const o=e.stencilReadMask||4294967295,u=Qg("depthCompare",e.stencilCompare);e.stencilCompare!=="always"?r.enable(2960):r.disable(2960),r.stencilFuncSeparate(1028,u,0,o),r.stencilFuncSeparate(1029,u,0,o)}if(e.stencilPassOperation&&e.stencilFailOperation&&e.stencilDepthFailOperation){const o=em("stencilPassOperation",e.stencilPassOperation),u=em("stencilFailOperation",e.stencilFailOperation),d=em("stencilDepthFailOperation",e.stencilDepthFailOperation);r.stencilOpSeparate(1028,u,d,o),r.stencilOpSeparate(1029,u,d,o)}if(e.blendColorOperation||e.blendAlphaOperation){r.enable(3042);const o=Wx("blendColorOperation",e.blendColorOperation||"add"),u=Wx("blendAlphaOperation",e.blendAlphaOperation||"add");r.blendEquationSeparate(o,u);const d=yf("blendColorSrcFactor",e.blendColorSrcFactor||"one"),a=yf("blendColorDstFactor",e.blendColorDstFactor||"zero"),x=yf("blendAlphaSrcFactor",e.blendAlphaSrcFactor||"one"),A=yf("blendAlphaDstFactor",e.blendAlphaDstFactor||"zero");r.blendFuncSeparate(d,a,x,A)}}function Qg(t,e){return qa(t,e,{never:512,less:513,equal:514,"less-equal":515,greater:516,"not-equal":517,"greater-equal":518,always:519})}function em(t,e){return qa(t,e,{keep:7680,zero:0,replace:7681,invert:5386,"increment-clamp":7682,"decrement-clamp":7683,"increment-wrap":34055,"decrement-wrap":34056})}function Wx(t,e){return qa(t,e,{add:32774,subtract:32778,"reverse-subtract":32779,min:32775,max:32776})}function yf(t,e){return qa(t,e,{one:1,zero:0,"src-color":768,"one-minus-src-color":769,"dst-color":774,"one-minus-dst-color":775,"src-alpha":770,"one-minus-src-alpha":771,"dst-alpha":772,"one-minus-dst-alpha":773,"src-alpha-saturated":776,"constant-color":32769,"one-minus-constant-color":32770,"constant-alpha":32771,"one-minus-constant-alpha":32772})}function TD(t,e){return`Illegal parameter ${e} for ${t}`}function qa(t,e,i){if(!(e in i))throw new Error(TD(t,e));return i[e]}function AD(t,e){return e}function Xx(t){const e={};return t.addressModeU&&(e[10242]=tm(t.addressModeU)),t.addressModeV&&(e[10243]=tm(t.addressModeV)),t.addressModeW&&(e[32882]=tm(t.addressModeW)),t.magFilter&&(e[10240]=qx(t.magFilter)),(t.minFilter||t.mipmapFilter)&&(e[10241]=ED(t.minFilter||"linear",t.mipmapFilter)),t.lodMinClamp!==void 0&&(e[33082]=t.lodMinClamp),t.lodMaxClamp!==void 0&&(e[33083]=t.lodMaxClamp),t.type==="comparison-sampler"&&(e[34892]=34894),t.compare&&(e[34893]=Qg("compare",t.compare)),t.maxAnisotropy&&(e[34046]=t.maxAnisotropy),e}function tm(t){switch(t){case"clamp-to-edge":return 33071;case"repeat":return 10497;case"mirror-repeat":return 33648}}function qx(t){switch(t){case"nearest":return 9728;case"linear":return 9729}}function ED(t,e){if(!e)return qx(t);switch(t){case"nearest":return e==="nearest"?9984:9986;case"linear":return e==="nearest"?9985:9987}}class ra extends Fi{constructor(i,r={}){super(i,r);L(this,"device");L(this,"gl");L(this,"handle");L(this,"glTarget");L(this,"glUsage");L(this,"glIndexType",5123);L(this,"byteLength");L(this,"bytesUsed");this.device=i,this.gl=this.device.gl;const o=typeof r=="object"?r.handle:void 0;this.handle=o||this.gl.createBuffer(),i.setSpectorMetadata(this.handle,{...this.props,data:typeof this.props.data}),this.glTarget=SD(this.props.usage),this.glUsage=CD(this.props.usage),this.glIndexType=this.props.indexType==="uint32"?5125:5123,r.data?this._initWithData(r.data,r.byteOffset,r.byteLength):this._initWithByteLength(r.byteLength||0)}_initWithData(i,r=0,o=i.byteLength+r){const u=this.glTarget;this.gl.bindBuffer(u,this.handle),this.gl.bufferData(u,o,this.glUsage),this.gl.bufferSubData(u,r,i),this.gl.bindBuffer(u,null),this.bytesUsed=o,this.byteLength=o,this._setDebugData(i,r,o),this.trackAllocatedMemory(o)}_initWithByteLength(i){ti(i>=0);let r=i;i===0&&(r=new Float32Array(0));const o=this.glTarget;return this.gl.bindBuffer(o,this.handle),this.gl.bufferData(o,r,this.glUsage),this.gl.bindBuffer(o,null),this.bytesUsed=i,this.byteLength=i,this._setDebugData(null,0,i),this.trackAllocatedMemory(i),this}destroy(){!this.destroyed&&this.handle&&(this.removeStats(),this.trackDeallocatedMemory(),this.gl.deleteBuffer(this.handle),this.destroyed=!0,this.handle=null)}write(i,r=0){this.gl.bindBuffer(36663,this.handle),this.gl.bufferSubData(36663,r,i),this.gl.bindBuffer(36663,null),this._setDebugData(i,r,i.byteLength)}async readAsync(i=0,r){return this.readSyncWebGL(i,r)}readSyncWebGL(i=0,r){r=r??this.byteLength-i;const o=new Uint8Array(r),u=0;return this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,i,o,u,r),this.gl.bindBuffer(36662,null),this._setDebugData(o,i,r),o}}function SD(t){return t&Fi.INDEX?34963:t&Fi.VERTEX?34962:t&Fi.UNIFORM?35345:34962}function CD(t){return t&Fi.INDEX||t&Fi.VERTEX?35044:t&Fi.UNIFORM?35048:35044}class im extends Ud{constructor(i,r){super(i,r);L(this,"device");L(this,"handle");L(this,"parameters");this.device=i,this.parameters=Xx(r),this.handle=this.handle||this.device.gl.createSampler(),this._setSamplerParameters(this.parameters)}destroy(){this.handle&&(this.device.gl.deleteSampler(this.handle),this.handle=void 0)}toString(){return`Sampler(${this.id},${JSON.stringify(this.props)})`}_setSamplerParameters(i){for(const[r,o]of Object.entries(i)){const u=Number(r);switch(u){case 33082:case 33083:this.device.gl.samplerParameterf(this.handle,u,o);break;default:this.device.gl.samplerParameteri(this.handle,u,o);break}}}}class pc extends Nd{constructor(i,r){super(i,{...As.defaultProps,...r});L(this,"device");L(this,"gl");L(this,"handle");L(this,"texture");this.device=i,this.gl=this.device.gl,this.handle=null,this.texture=r.texture}}const ID={parameters:{},pixelStore:{},pixels:null,border:0,dataFormat:void 0,textureUnit:void 0,target:void 0},bu=class bu extends As{constructor(i,r){var o;super(i,{...ID,format:"rgba8unorm",...r});L(this,"MAX_ATTRIBUTES");L(this,"device");L(this,"gl");L(this,"handle");L(this,"sampler");L(this,"view");L(this,"glFormat");L(this,"type");L(this,"dataFormat");L(this,"mipmaps");L(this,"target");L(this,"textureUnit");L(this,"loaded",!1);L(this,"_video");this.device=i,this.gl=this.device.gl,this.handle=this.props.handle||this.gl.createTexture(),this.device.setSpectorMetadata(this.handle,{...this.props,data:typeof this.props.data}),this.glFormat=6408,this.target=MD(this.props),this.loaded=!1,typeof((o=this.props)==null?void 0:o.data)=="string"&&Object.assign(this.props,{data:sM(this.props.data)}),this.initialize(this.props),Object.seal(this)}destroy(){this.handle&&(this.gl.deleteTexture(this.handle),this.removeStats(),this.trackDeallocatedMemory("Texture"),this.destroyed=!0)}toString(){return`Texture(${this.id},${this.width}x${this.height})`}createView(i){return new pc(this.device,{...i,texture:this})}initialize(i={}){if(this.props.dimension==="cube")return this.initializeCube(i);let r=i.data;if(r instanceof Promise)return r.then(Ae=>this.initialize(Object.assign({},i,{pixels:Ae,data:Ae}))),this;const o=typeof HTMLVideoElement<"u"&&r instanceof HTMLVideoElement;if(o&&r.readyState<HTMLVideoElement.HAVE_METADATA)return this._video=null,r.addEventListener("loadeddata",()=>this.initialize(i)),this;const{parameters:u={}}=i,{pixels:d=null,pixelStore:a={},textureUnit:x=void 0,mipmaps:A=!0}=i;r||(r=d);let{width:M,height:D,dataFormat:N,type:U,compressed:re=!1}=i;const{depth:ne=0}=i,xe=Hx(i.format);return{width:M,height:D,compressed:re,dataFormat:N,type:U}=this._deduceParameters({format:i.format,type:U,dataFormat:N,compressed:re,data:r,width:M,height:D}),this.width=M,this.height=D,this.glFormat=xe,this.type=U,this.dataFormat=N,this.textureUnit=x,Number.isFinite(this.textureUnit)&&(this.gl.activeTexture(33984+this.textureUnit),this.gl.bindTexture(this.target,this.handle)),this.mipmaps=A,this.setImageData({data:r,width:M,height:D,depth:ne,format:i.format,type:U,dataFormat:N,parameters:a,compressed:re}),this.setSampler(i.sampler),this._setSamplerParameters(u),this.view=this.createView({...this.props,mipLevelCount:1,arrayLayerCount:1}),A&&this.device.isTextureFormatFilterable(i.format)&&this.generateMipmap(),o&&(this._video={video:r,parameters:u,lastTime:r.readyState>=HTMLVideoElement.HAVE_CURRENT_DATA?r.currentTime:-1}),this}initializeCube(i){const{mipmaps:r=!0,parameters:o={}}=i;return this.setCubeMapImageData(i).then(()=>{this.loaded=!0,r&&this.generateMipmap(i),this.setSampler(i.sampler),this._setSamplerParameters(o)}),this}setSampler(i={}){let r;i instanceof im?(this.sampler=i,r=i.props):(this.sampler=new im(this.device,i),r=i);const o=Xx(r);return this._setSamplerParameters(o),this}resize(i){const{height:r,width:o,mipmaps:u=!1}=i;return o!==this.width||r!==this.height?this.initialize({width:o,height:r,format:this.format,type:this.type,dataFormat:this.dataFormat,mipmaps:u}):this}update(){if(this._video){const{video:i,parameters:r,lastTime:o}=this._video;if(o===i.currentTime||i.readyState<HTMLVideoElement.HAVE_CURRENT_DATA)return;this.setSubImageData({data:i,parameters:r}),this.mipmaps&&this.generateMipmap(),this._video.lastTime=i.currentTime}}generateMipmap(i={}){return this.mipmaps=!0,this.gl.bindTexture(this.target,this.handle),ia(this.gl,i,()=>{this.gl.generateMipmap(this.target)}),this.gl.bindTexture(this.target,null),this}setImageData(i){if(this.props.dimension==="3d"||this.props.dimension==="2d-array")return this.setImageData3D(i);this.trackDeallocatedMemory("Texture");const{target:r=this.target,pixels:o=null,level:u=0,glFormat:d=this.glFormat,offset:a=0,parameters:x={}}=i;let{data:A=null,type:M=this.type,width:D=this.width,height:N=this.height,dataFormat:U=this.dataFormat,compressed:re=!1}=i;A||(A=o),{type:M,dataFormat:U,compressed:re,width:D,height:N}=this._deduceParameters({format:this.props.format,type:M,dataFormat:U,compressed:re,data:A,width:D,height:N});const{gl:ne}=this;ne.bindTexture(this.target,this.handle);let xe=null;if({data:A,dataType:xe}=this._getDataType({data:A,compressed:re}),ia(this.gl,x,()=>{switch(xe){case"null":ne.texImage2D(r,u,d,D,N,0,U,M,A);break;case"typed-array":ne.texImage2D(r,u,d,D,N,0,U,M,A,a);break;case"buffer":this.device.gl.bindBuffer(35052,A.handle||A),this.device.gl.texImage2D(r,u,d,D,N,0,U,M,a),this.device.gl.bindBuffer(35052,null);break;case"browser-object":ne.texImage2D(r,u,d,D,N,0,U,M,A);break;case"compressed":for(const[Ae,Te]of A.entries())ne.compressedTexImage2D(r,Ae,Te.format,Te.width,Te.height,0,Te.data);break;default:ti(!1,"Unknown image data type")}}),A&&A.byteLength)this.trackAllocatedMemory(A.byteLength,"Texture");else{const Ae=Gx(this.props.format);this.trackAllocatedMemory(this.width*this.height*Ae,"Texture")}return this.loaded=!0,this}setSubImageData({target:i=this.target,pixels:r=null,data:o=null,x:u=0,y:d=0,width:a=this.width,height:x=this.height,level:A=0,glFormat:M=this.glFormat,type:D=this.type,dataFormat:N=this.dataFormat,compressed:U=!1,offset:re=0,parameters:ne={}}){if({type:D,dataFormat:N,compressed:U,width:a,height:x}=this._deduceParameters({format:this.props.format,type:D,dataFormat:N,compressed:U,data:o,width:a,height:x}),ti(this.depth===1,"texSubImage not supported for 3D textures"),o||(o=r),o&&o.data){const xe=o;o=xe.data,a=xe.shape[0],x=xe.shape[1]}o instanceof ra&&(o=o.handle),this.gl.bindTexture(this.target,this.handle),ia(this.gl,ne,()=>{U?this.gl.compressedTexSubImage2D(i,A,u,d,a,x,M,o):o===null?this.gl.texSubImage2D(i,A,u,d,a,x,N,D,null):ArrayBuffer.isView(o)?this.gl.texSubImage2D(i,A,u,d,a,x,N,D,o,re):typeof WebGLBuffer<"u"&&o instanceof WebGLBuffer?(this.device.gl.bindBuffer(35052,o),this.device.gl.texSubImage2D(i,A,u,d,a,x,N,D,re),this.device.gl.bindBuffer(35052,null)):this.device.gl.texSubImage2D(i,A,u,d,a,x,N,D,o)}),this.gl.bindTexture(this.target,null)}copyFramebuffer(i={}){return Je.error("Texture.copyFramebuffer({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(i=this.textureUnit){const{gl:r}=this;return i!==void 0&&(this.textureUnit=i,r.activeTexture(33984+i)),r.bindTexture(this.target,this.handle),i}unbind(i=this.textureUnit){const{gl:r}=this;return i!==void 0&&(this.textureUnit=i,r.activeTexture(33984+i)),r.bindTexture(this.target,null),i}_getDataType({data:i,compressed:r=!1}){return r?{data:i,dataType:"compressed"}:i===null?{data:i,dataType:"null"}:ArrayBuffer.isView(i)?{data:i,dataType:"typed-array"}:i instanceof ra?{data:i.handle,dataType:"buffer"}:typeof WebGLBuffer<"u"&&i instanceof WebGLBuffer?{data:i,dataType:"buffer"}:{data:i,dataType:"browser-object"}}_deduceParameters(i){const{format:r,data:o}=i;let{width:u,height:d,dataFormat:a,type:x,compressed:A}=i;const M=mf(r);return a=a||M.dataFormat,x=x||M.type,A=A||M.compressed,{width:u,height:d}=this._deduceImageSize(o,u,d),{dataFormat:a,type:x,compressed:A,width:u,height:d,format:r,data:o}}_deduceImageSize(i,r,o){let u;return typeof ImageData<"u"&&i instanceof ImageData?u={width:i.width,height:i.height}:typeof HTMLImageElement<"u"&&i instanceof HTMLImageElement?u={width:i.naturalWidth,height:i.naturalHeight}:typeof HTMLCanvasElement<"u"&&i instanceof HTMLCanvasElement?u={width:i.width,height:i.height}:typeof ImageBitmap<"u"&&i instanceof ImageBitmap?u={width:i.width,height:i.height}:typeof HTMLVideoElement<"u"&&i instanceof HTMLVideoElement?u={width:i.videoWidth,height:i.videoHeight}:i?u={width:r,height:o}:u={width:r>=0?r:1,height:o>=0?o:1},ti(u,"Could not deduced texture size"),ti(r===void 0||u.width===r,"Deduced texture width does not match supplied width"),ti(o===void 0||u.height===o,"Deduced texture height does not match supplied height"),u}async setCubeMapImageData(i){const{gl:r}=this,{width:o,height:u,pixels:d,data:a,format:x=6408,type:A=5121}=i,M=d||a,D=await Promise.all(bu.FACES.map(N=>{const U=M[N];return Promise.all(Array.isArray(U)?U:[U])}));this.bind(),bu.FACES.forEach((N,U)=>{D[U].length>1&&this.props.mipmaps!==!1&&Je.warn(`${this.id} has mipmap and multiple LODs.`)(),D[U].forEach((re,ne)=>{o&&u?r.texImage2D(N,ne,x,o,u,0,x,A,re):r.texImage2D(N,ne,x,x,A,re)})}),this.unbind()}setImageDataForFace(i){const{face:r,width:o,height:u,pixels:d,data:a,format:x=6408,type:A=5121}=i,{gl:M}=this,D=d||a;return this.bind(),D instanceof Promise?D.then(N=>this.setImageDataForFace(Object.assign({},i,{face:r,data:N,pixels:N}))):this.width||this.height?M.texImage2D(r,0,x,o,u,0,x,A,D):M.texImage2D(r,0,x,x,A,D),this}setImageData3D(i){const{level:r=0,dataFormat:o,format:u,type:d,width:a,height:x,depth:A=1,offset:M=0,data:D,parameters:N={}}=i;this.trackDeallocatedMemory("Texture"),this.gl.bindTexture(this.target,this.handle);const U=mf(u);if(ia(this.gl,N,()=>{ArrayBuffer.isView(D)&&this.gl.texImage3D(this.target,r,U.format,a,x,A,0,U.dataFormat,U.type,D),D instanceof ra&&(this.gl.bindBuffer(35052,D.handle),this.gl.texImage3D(this.target,r,o,a,x,A,0,u,d,M))}),D&&D.byteLength)this.trackAllocatedMemory(D.byteLength,"Texture");else{const re=Gx(this.props.format);this.trackAllocatedMemory(this.width*this.height*this.depth*re,"Texture")}return this.loaded=!0,this}_setSamplerParameters(i){if(!Fd(i)){RD(i),this.gl.bindTexture(this.target,this.handle);for(const[r,o]of Object.entries(i)){const u=Number(r),d=o;switch(u){case 33082:case 33083:this.gl.texParameterf(this.target,u,d);break;default:this.gl.texParameteri(this.target,u,d);break}}this.gl.bindTexture(this.target,null)}}};L(bu,"FACES",[34069,34070,34071,34072,34073,34074]);let Wn=bu;function MD(t){switch(t.dimension){case"2d":return 3553;case"cube":return 34067;case"2d-array":return 35866;case"3d":return 32879;case"1d":case"cube-array":default:throw new Error(t.dimension)}}function RD(t){Je.log(1,"texture sampler parameters",t)()}class eu extends zd{constructor(i,r){super(i,r);L(this,"device");L(this,"gl");L(this,"handle");const o=r.handle===null;if(this.device=i,this.gl=i.gl,this.handle=this.props.handle||o?this.props.handle:this.gl.createFramebuffer(),!o){i.setSpectorMetadata(this.handle,{id:this.props.id,props:this.props}),this.autoCreateAttachmentTextures();const u=this.gl.bindFramebuffer(36160,this.handle);for(let d=0;d<this.colorAttachments.length;++d){const a=this.colorAttachments[d],x=36064+d;a&&this._attachOne(x,a)}if(this.depthStencilAttachment&&this._attachOne(gD(this.depthStencilAttachment.props.format),this.depthStencilAttachment),r.check!==!1){const d=this.gl.checkFramebufferStatus(36160);if(d!==36053)throw new Error(`Framebuffer ${BD(d)}`)}this.gl.bindFramebuffer(36160,u)}}get texture(){return this.colorAttachments[0]}destroy(){super.destroy(),!this.destroyed&&this.handle!==null&&this.gl.deleteFramebuffer(this.handle)}createDepthStencilTexture(i){return new Wn(this.device,{id:`${this.id}-depth-stencil`,format:i,width:this.width,height:this.height,mipmaps:!1})}resizeAttachments(i,r){if(this.handle===null)return this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight,this;i===void 0&&(i=this.gl.drawingBufferWidth),r===void 0&&(r=this.gl.drawingBufferHeight);for(const o of this.colorAttachments)o.texture.resize({width:i,height:r});return this.depthStencilAttachment&&this.depthStencilAttachment.texture.resize({width:i,height:r}),this}_attachOne(i,r){if(Array.isArray(r)){const[o,u=0,d=0]=r;return this._attachTexture(i,o,u,d),o}if(r instanceof Wn)return this._attachTexture(i,r,0,0),r;if(r instanceof pc){const o=r;return this._attachTexture(i,o.texture,o.props.baseMipLevel,o.props.baseArrayLayer),r.texture}throw new Error("attach")}_attachTexture(i,r,o,u){const{gl:d}=this.device;switch(d.bindTexture(r.target,r.handle),r.target){case 35866:case 32879:d.framebufferTextureLayer(36160,i,r.target,u,o);break;case 34067:const a=PD(o);d.framebufferTexture2D(36160,i,a,r.handle,u);break;case 3553:d.framebufferTexture2D(36160,i,3553,r.handle,u);break;default:ti(!1,"Illegal texture type")}d.bindTexture(r.target,null)}}function PD(t){return t<34069?t+34069:t}function BD(t){switch(t){case 36053:return"success";case 36054:return"Mismatched attachments";case 36055:return"No attachments";case 36057:return"Height/width mismatch";case 36061:return"Unsupported or split attachments";case 36182:return"Samples mismatch";default:return`${t}`}}class DD extends Z_{constructor(i,r){super(r);L(this,"device");L(this,"presentationSize");L(this,"_framebuffer",null);this.device=i,this.presentationSize=[-1,-1],this._setAutoCreatedCanvasId(`${this.device.id}-canvas`),this.update()}getCurrentFramebuffer(){return this.update(),this._framebuffer=this._framebuffer||new eu(this.device,{handle:null}),this._framebuffer}update(){const i=this.getPixelSize();(i[0]!==this.presentationSize[0]||i[1]!==this.presentationSize[1])&&(this.presentationSize=i,this.resize())}resize(i){if(this.device.gl&&this.canvas){const r=this.getDevicePixelRatio(i==null?void 0:i.useDevicePixels);this.setDevicePixelRatio(r,i);return}}commit(){}}const OD={spector:Je.get("spector")||Je.get("spectorjs")},FD="https://cdn.jsdelivr.net/npm/spectorjs@0.9.30/dist/spector.bundle.js",kD=1;let fi=null,Zx=!1;async function ND(t){if(!globalThis.SPECTOR)try{await iv(FD)}catch(e){Je.warn(String(e))}}function LD(t){if(t={...OD,...t},!(t!=null&&t.spector)||(!fi&&globalThis.SPECTOR&&(Je.probe(kD,"SPECTOR found and initialized")(),fi=new globalThis.SPECTOR.Spector,globalThis.luma&&(globalThis.luma.spector=fi)),!fi))return null;if(Zx||(Zx=!0,fi.spyCanvases(),fi==null||fi.onCaptureStarted.add(e=>Je.info("Spector capture started:",e)()),fi==null||fi.onCapture.add(e=>{Je.info("Spector capture complete:",e)(),fi==null||fi.getResultUI(),fi==null||fi.resultView.display(),fi==null||fi.resultView.addCapture(e)})),t!=null&&t.canvas){if(typeof t.spector=="string"&&t.spector!==t.canvas.id)return fi;fi==null||fi.startCapture(t==null?void 0:t.canvas,500),new Promise(e=>setTimeout(e,2e3)).then(e=>{Je.info("Spector capture stopped after 2 seconds")(),fi==null||fi.stopCapture()})}return fi}const UD="https://unpkg.com/webgl-debug@2.0.1/index.js";function Kx(t){return t.luma=t.luma||{},t.luma}async function zD(){Go()&&!globalThis.WebGLDebugUtils&&(globalThis.global=globalThis.global||globalThis,globalThis.global.module={},await iv(UD))}function VD(t,e={}){return t?e.debug?HD(t,e):jD(t):null}function jD(t){const e=Kx(t);return e.realContext?e.realContext:t}function HD(t,e){if(!globalThis.WebGLDebugUtils)return Je.warn("webgl-debug not loaded")(),t;const i=Kx(t);if(i.debugContext)return i.debugContext;globalThis.WebGLDebugUtils.init({...hc,...t});const r=globalThis.WebGLDebugUtils.makeDebugContext(t,GD.bind(null,e),$D.bind(null,e));for(const d in hc)!(d in r)&&typeof hc[d]=="number"&&(r[d]=hc[d]);class o{}Object.setPrototypeOf(r,Object.getPrototypeOf(t)),Object.setPrototypeOf(o,r);const u=Object.create(o);return i.realContext=t,i.debugContext=u,u.debug=!0,u}function rm(t,e){e=Array.from(e).map(r=>r===void 0?"undefined":r);let i=globalThis.WebGLDebugUtils.glFunctionArgsToString(t,e);return i=`${i.slice(0,100)}${i.length>100?"...":""}`,`gl.${t}(${i})`}function GD(t,e,i,r){r=Array.from(r).map(a=>a===void 0?"undefined":a);const o=globalThis.WebGLDebugUtils.glEnumToString(e),u=globalThis.WebGLDebugUtils.glFunctionArgsToString(i,r),d=`${o} in gl.${i}(${u})`;Je.error(d)();debugger;if(t.throwOnError)throw new Error(d)}function $D(t,e,i){let r="";if(Je.level>=1&&(r=rm(e,i),Je.log(1,r)()),t.break&&t.break.length>0&&(r=r||rm(e,i),t.break.every(u=>r.indexOf(u)!==-1)))debugger;for(const o of i)if(o===void 0){if(r=r||rm(e,i),t.throwOnError)throw new Error(`Undefined argument: ${r}`);Je.error(`Undefined argument: ${r}`)();debugger}}function WD(t){const e=t.split(/\r?\n/),i=[];for(const r of e){if(r.length<=1)continue;const o=r.split(":");if(o.length===2){const[D,N]=o;i.push({message:N.trim(),type:Yx(D),lineNum:0,linePos:0});continue}const[u,d,a,...x]=o;let A=parseInt(a,10);isNaN(A)&&(A=0);let M=parseInt(d,10);isNaN(M)&&(M=0),i.push({message:x.join(":").trim(),type:Yx(u),lineNum:A,linePos:M})}return i}function Yx(t){const e=["warning","error","info"],i=t.toLowerCase();return e.includes(i)?i:"info"}class XD extends Ld{constructor(i,r){super(i,r);L(this,"device");L(this,"handle");switch(this.device=i,this.props.stage){case"vertex":this.handle=this.props.handle||this.device.gl.createShader(35633);break;case"fragment":this.handle=this.props.handle||this.device.gl.createShader(35632);break;default:throw new Error(this.props.stage)}this._compile(this.source)}destroy(){this.handle&&(this.removeStats(),this.device.gl.deleteShader(this.handle),this.destroyed=!0)}async getCompilationInfo(){return await this._waitForCompilationComplete(),this.getCompilationInfoSync()}getCompilationInfoSync(){const i=this.device.gl.getShaderInfoLog(this.handle);return WD(i)}getTranslatedSource(){const r=this.device.getExtension("WEBGL_debug_shaders").WEBGL_debug_shaders;return r==null?void 0:r.getTranslatedShaderSource(this.handle)}async _compile(i){i=(u=>u.startsWith("#version ")?u:`#version 100
${u}`)(i);const{gl:o}=this.device;if(o.shaderSource(this.handle,i),o.compileShader(this.handle),Je.level===0){this.compilationStatus="pending";return}if(!this.device.features.has("compilation-status-async-webgl")){if(this._getCompilationStatus(),this.debugShader(),this.compilationStatus==="error")throw new Error(`GLSL compilation errors in ${this.props.stage} shader ${this.props.id}`);return}Je.once(1,"Shader compilation is asynchronous")(),await this._waitForCompilationComplete(),Je.info(2,`Shader ${this.id} - async compilation complete: ${this.compilationStatus}`)(),this._getCompilationStatus(),this.debugShader()}async _waitForCompilationComplete(){const i=async u=>await new Promise(d=>setTimeout(d,u));if(!this.device.features.has("compilation-status-async-webgl")){await i(10);return}const{gl:o}=this.device;for(;;){if(o.getShaderParameter(this.handle,37297))return;await i(10)}}_getCompilationStatus(){this.compilationStatus=this.device.gl.getShaderParameter(this.handle,35713)?"success":"error"}}const qD=256,ZD=1024,KD=16384,sm=6144,YD=[1,2,4,8];class JD extends K_{constructor(i,r){super(i,r);L(this,"device");L(this,"glParameters");this.device=i,ff(this.device.gl),this.setParameters(this.props.parameters),this.clear()}end(){Zh(this.device.gl)}pushDebugGroup(i){}popDebugGroup(){}insertDebugMarker(i){}setParameters(i={}){const r={...this.glParameters};this.props.framebuffer&&(r.framebuffer=this.props.framebuffer),this.props.depthReadOnly&&(r.depthMask=!this.props.depthReadOnly),r.stencilMask=this.props.stencilReadOnly?0:1,r[35977]=this.props.discard,i.viewport&&(i.viewport.length>=6?(r.viewport=i.viewport.slice(0,4),r.depthRange=[i.viewport[4],i.viewport[5]]):r.viewport=i.viewport),i.scissorRect&&(r.scissorTest=!0,r.scissor=i.scissorRect),i.blendConstant&&(r.blendColor=i.blendConstant),i.stencilReference&&(console.warn("RenderPassParameters.stencilReference not yet implemented in WebGL"),i[2967]=i.stencilReference),i.colorMask&&(r.colorMask=YD.map(o=>!!(o&i.colorMask))),this.glParameters=r,uc(this.device.gl,r)}beginOcclusionQuery(i){const r=this.props.occlusionQuerySet;r==null||r.beginOcclusionQuery()}endOcclusionQuery(){const i=this.props.occlusionQuerySet;i==null||i.endOcclusionQuery()}clear(){const i={...this.glParameters};let r=0;this.props.clearColor!==!1&&(r|=KD,i.clearColor=this.props.clearColor),this.props.clearDepth!==!1&&(r|=qD,i.clearDepth=this.props.clearDepth),this.props.clearStencil!==!1&&(r|=ZD,i.clearStencil=this.props.clearStencil),r!==0&&ia(this.device.gl,i,()=>{this.device.gl.clear(r)})}clearColorBuffer(i=0,r=[0,0,0,0]){ia(this.device.gl,{framebuffer:this.props.framebuffer},()=>{switch(r.constructor){case Int32Array:this.device.gl.clearBufferiv(sm,i,r);break;case Uint32Array:this.device.gl.clearBufferuiv(sm,i,r);break;case Float32Array:default:this.device.gl.clearBufferfv(sm,i,r);break}})}}const QD="Failed to deduce GL constant from typed array";function eO(t){switch(ArrayBuffer.isView(t)?t.constructor:t){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:return 5121;case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(QD)}}function nm(t,e){const{clamped:i=!0}=e||{};switch(t){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return i?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}const tO={offset:0,stride:0,type:5126,size:1,divisor:0,normalized:!1,integer:!1},iO={deprecatedProps:{instanced:"divisor",isInstanced:"divisor"}};class tu{constructor(...e){L(this,"offset");L(this,"stride");L(this,"type");L(this,"size");L(this,"divisor");L(this,"normalized");L(this,"integer");L(this,"buffer");L(this,"index");e.forEach(i=>this._assign(i)),Object.freeze(this)}static getBytesPerElement(e){return nm(e.type||5126).BYTES_PER_ELEMENT}static getBytesPerVertex(e){return ti(e.size),nm(e.type||5126).BYTES_PER_ELEMENT*e.size}static resolve(...e){return new tu(tO,...e)}toString(){return JSON.stringify(this)}get BYTES_PER_ELEMENT(){return tu.getBytesPerElement(this)}get BYTES_PER_VERTEX(){return tu.getBytesPerVertex(this)}_assign(e={}){return e=iM("Accessor",e,iO),e.type!==void 0&&(this.type=e.type,(e.type===5124||e.type===5125)&&(this.integer=!0)),e.size!==void 0&&(this.size=e.size),e.offset!==void 0&&(this.offset=e.offset),e.stride!==void 0&&(this.stride=e.stride),e.normalize!==void 0&&(this.normalized=e.normalize),e.normalized!==void 0&&(this.normalized=e.normalized),e.integer!==void 0&&(this.integer=e.integer),e.divisor!==void 0&&(this.divisor=e.divisor),e.buffer!==void 0&&(this.buffer=e.buffer),e.index!==void 0&&(typeof e.index=="boolean"?this.index=e.index?1:0:this.index=e.index),e.instanced!==void 0&&(this.divisor=e.instanced?1:0),e.isInstanced!==void 0&&(this.divisor=e.isInstanced?1:0),this.offset===void 0&&delete this.offset,this.stride===void 0&&delete this.stride,this.type===void 0&&delete this.type,this.size===void 0&&delete this.size,this.divisor===void 0&&delete this.divisor,this.normalized===void 0&&delete this.normalized,this.integer===void 0&&delete this.integer,this.buffer===void 0&&delete this.buffer,this.index===void 0&&delete this.index,this}}function rO(t){return sO.includes(t)}const sO=[35678,35680,35679,35682,36289,36292,36293,36298,36299,36300,36303,36306,36307,36308,36311],Jx={5126:[5126,1,"float","f32","float32"],35664:[5126,2,"vec2","vec2<f32>","float32x2"],35665:[5126,3,"vec3","vec3<f32>","float32x3"],35666:[5126,4,"vec4","vec4<f32>","float32x4"],5124:[5124,1,"int","i32","sint32"],35667:[5124,2,"ivec2","vec2<i32>","sint32x2"],35668:[5124,3,"ivec3","vec3<i32>","sint32x3"],35669:[5124,4,"ivec4","vec4<i32>","sint32x4"],5125:[5125,1,"uint","u32","uint32"],36294:[5125,2,"uvec2","vec2<u32>","uint32x2"],36295:[5125,3,"uvec3","vec3<u32>","uint32x3"],36296:[5125,4,"uvec4","vec4<u32>","uint32x4"],35670:[5126,1,"bool","f32","float32"],35671:[5126,2,"bvec2","vec2<f32>","float32x2"],35672:[5126,3,"bvec3","vec3<f32>","float32x3"],35673:[5126,4,"bvec4","vec4<f32>","float32x4"],35674:[5126,8,"mat2","mat2x2<f32>"],35685:[5126,8,"mat2x3","mat2x3<f32>"],35686:[5126,8,"mat2x4","mat2x4<f32>"],35687:[5126,12,"mat3x2","mat3x2<f32>"],35675:[5126,12,"mat3","mat3x3<f32>"],35688:[5126,12,"mat3x4","mat3x4<f32>"],35689:[5126,16,"mat4x2","mat4x2<f32>"],35690:[5126,16,"mat4x3","mat4x3<f32>"],35676:[5126,16,"mat4","mat4x4<f32>"]};function Qx(t){const e=Jx[t];if(!e)throw new Error("uniform");const[i,r,,o]=e;return{format:o,components:r,glType:i}}function nO(t){const e=Jx[t];if(!e)throw new Error("attribute");const[,i,,r,o]=e;return{attributeType:r,vertexFormat:o,components:i}}function oO(t,e){const i={attributes:[],bindings:[]};i.attributes=aO(t,e);const r=hO(t,e);for(const a of r){const x=a.uniforms.map(A=>({name:A.name,format:A.format,byteOffset:A.byteOffset,byteStride:A.byteStride,arrayLength:A.arrayLength}));i.bindings.push({type:"uniform",name:a.name,location:a.location,visibility:(a.vertex?1:0)&(a.fragment?2:0),minBindingSize:a.byteLength,uniforms:x})}const o=cO(t,e);let u=0;for(const a of o)if(rO(a.type)){const{viewDimension:x,sampleType:A}=dO(a.type);i.bindings.push({type:"texture",name:a.name,location:u,viewDimension:x,sampleType:A}),a.textureUnit=u,u+=1}o.length&&(i.uniforms=o);const d=lO(t,e);return d!=null&&d.length&&(i.varyings=d),i}function aO(t,e){const i=[],r=t.getProgramParameter(e,35721);for(let o=0;o<r;o++){const u=t.getActiveAttrib(e,o);if(!u)throw new Error("activeInfo");const{name:d,type:a}=u,x=t.getAttribLocation(e,d);if(x>=0){const{attributeType:A}=nO(a),M=/instance/i.test(d)?"instance":"vertex";i.push({name:d,location:x,stepMode:M,type:A})}}return i.sort((o,u)=>o.location-u.location),i}function lO(t,e){const i=[],r=t.getProgramParameter(e,35971);for(let o=0;o<r;o++){const u=t.getTransformFeedbackVarying(e,o);if(!u)throw new Error("activeInfo");const{name:d,type:a,size:x}=u,{glType:A,components:M}=Qx(a),D=new tu({type:A,size:x*M}),N={location:o,name:d,accessor:D};i.push(N)}return i.sort((o,u)=>o.location-u.location),i}function cO(t,e){const i=[],r=t.getProgramParameter(e,35718);for(let o=0;o<r;o++){const u=t.getActiveUniform(e,o);if(!u)throw new Error("activeInfo");const{name:d,size:a,type:x}=u,{name:A,isArray:M}=fO(d);let D=t.getUniformLocation(e,A);const N={location:D,name:A,size:a,type:x,isArray:M};if(i.push(N),N.size>1)for(let U=0;U<N.size;U++){const re=`${A}[${U}]`;D=t.getUniformLocation(e,re);const ne={...N,name:re,location:D};i.push(ne)}}return i}function hO(t,e){const i=(u,d)=>t.getActiveUniformBlockParameter(e,u,d),r=[],o=t.getProgramParameter(e,35382);for(let u=0;u<o;u++){const d={name:t.getActiveUniformBlockName(e,u)||"",location:i(u,35391),byteLength:i(u,35392),vertex:i(u,35396),fragment:i(u,35398),uniformCount:i(u,35394),uniforms:[]},a=i(u,35395)||[],x=t.getActiveUniforms(e,a,35383),A=t.getActiveUniforms(e,a,35384),M=t.getActiveUniforms(e,a,35387),D=t.getActiveUniforms(e,a,35388);for(let N=0;N<d.uniformCount;++N){const U=t.getActiveUniform(e,a[N]);if(!U)throw new Error("activeInfo");d.uniforms.push({name:U.name,format:Qx(x[N]).format,type:x[N],arrayLength:A[N],byteOffset:M[N],byteStride:D[N]})}r.push(d)}return r.sort((u,d)=>u.location-d.location),r}const uO={35678:["2d","float"],35680:["cube","float"],35679:["3d","float"],35682:["3d","depth"],36289:["2d-array","float"],36292:["2d-array","depth"],36293:["cube","float"],36298:["2d","sint"],36299:["3d","sint"],36300:["cube","sint"],36303:["2d-array","uint"],36306:["2d","uint"],36307:["3d","uint"],36308:["cube","uint"],36311:["2d-array","uint"]};function dO(t){const e=uO[t];if(!e)throw new Error("sampler");const[i,r]=e;return{viewDimension:i,sampleType:r}}function fO(t){if(t[t.length-1]!=="]")return{name:t,length:1,isArray:!1};const i=/([^[]*)(\[[0-9]+\])?/.exec(t);if(!i||i.length<2)throw new Error(`Failed to parse GLSL uniform name ${t}`);return{name:i[1],length:i[2]?1:0,isArray:!!i[2]}}function pO(t,e,i,r){const o=t;let u=r;u===!0&&(u=1),u===!1&&(u=0);const d=typeof u=="number"?[u]:u;switch(i){case 35678:case 35680:case 35679:case 35682:case 36289:case 36292:case 36293:case 36298:case 36299:case 36300:case 36303:case 36306:case 36307:case 36308:case 36311:if(typeof r!="number")throw new Error("samplers must be set to integers");return t.uniform1i(e,r);case 5126:return t.uniform1fv(e,d);case 35664:return t.uniform2fv(e,d);case 35665:return t.uniform3fv(e,d);case 35666:return t.uniform4fv(e,d);case 5124:return t.uniform1iv(e,d);case 35667:return t.uniform2iv(e,d);case 35668:return t.uniform3iv(e,d);case 35669:return t.uniform4iv(e,d);case 35670:return t.uniform1iv(e,d);case 35671:return t.uniform2iv(e,d);case 35672:return t.uniform3iv(e,d);case 35673:return t.uniform4iv(e,d);case 5125:return o.uniform1uiv(e,d,1);case 36294:return o.uniform2uiv(e,d,2);case 36295:return o.uniform3uiv(e,d,3);case 36296:return o.uniform4uiv(e,d,4);case 35674:return t.uniformMatrix2fv(e,!1,d);case 35675:return t.uniformMatrix3fv(e,!1,d);case 35676:return t.uniformMatrix4fv(e,!1,d);case 35685:return o.uniformMatrix2x3fv(e,!1,d);case 35686:return o.uniformMatrix2x4fv(e,!1,d);case 35687:return o.uniformMatrix3x2fv(e,!1,d);case 35688:return o.uniformMatrix3x4fv(e,!1,d);case 35689:return o.uniformMatrix4x2fv(e,!1,d);case 35690:return o.uniformMatrix4x3fv(e,!1,d)}throw new Error("Illegal uniform")}function _O(t){switch(t){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 3;case"line-loop-webgl":return 2;case"triangle-list":return 4;case"triangle-strip":return 5;case"triangle-fan-webgl":return 6;default:throw new Error(t)}}function gO(t){switch(t){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 1;case"line-loop-webgl":return 1;case"triangle-list":return 4;case"triangle-strip":return 4;case"triangle-fan-webgl":return 4;default:throw new Error(t)}}const e1=4;class mO extends Zl{constructor(i,r){super(i,r);L(this,"device");L(this,"handle");L(this,"vs");L(this,"fs");L(this,"introspectedLayout");L(this,"uniforms",{});L(this,"bindings",{});L(this,"varyings",null);L(this,"_uniformCount",0);L(this,"_uniformSetters",{});this.device=i,this.handle=this.props.handle||this.device.gl.createProgram(),this.device.setSpectorMetadata(this.handle,{id:this.props.id}),this.vs=r.vs,this.fs=r.fs;const{varyings:o,bufferMode:u=35981}=r;switch(o&&o.length>0&&(this.varyings=o,this.device.gl.transformFeedbackVaryings(this.handle,o,u)),this._linkShaders(),Je.time(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.introspectedLayout=oO(this.device.gl,this.handle),Je.timeEnd(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.shaderLayout=HI(this.introspectedLayout,r.shaderLayout),this.props.topology){case"triangle-fan-webgl":case"line-loop-webgl":Je.warn(`Primitive topology ${this.props.topology} is deprecated and will be removed in v9.1`);break}}destroy(){this.handle&&(this.device.gl.deleteProgram(this.handle),this.destroyed=!0)}setBindings(i,r){for(const[o,u]of Object.entries(i)){const d=this.shaderLayout.bindings.find(a=>a.name===o)||this.shaderLayout.bindings.find(a=>a.name===`${o}Uniforms`);if(!d){const a=this.shaderLayout.bindings.map(x=>`"${x.name}"`).join(", ");r!=null&&r.disableWarnings||Je.warn(`Unknown binding "${o}" in render pipeline "${this.id}", expected one of ${a}`)();continue}switch(u||Je.warn(`Unsetting binding "${o}" in render pipeline "${this.id}"`)(),d.type){case"uniform":if(!(u instanceof ra)&&!(u.buffer instanceof ra))throw new Error("buffer value");break;case"texture":if(!(u instanceof pc||u instanceof Wn||u instanceof eu))throw new Error("texture value");break;case"sampler":Je.warn(`Ignoring sampler ${o}`)();break;default:throw new Error(d.type)}this.bindings[o]=u}}draw(i){var xe;const{renderPass:r,parameters:o=this.props.parameters,topology:u=this.props.topology,vertexArray:d,vertexCount:a,instanceCount:x,isInstanced:A=!1,firstVertex:M=0,transformFeedback:D}=i,N=_O(u),U=!!d.indexBuffer,re=(xe=d.indexBuffer)==null?void 0:xe.glIndexType;if(this.linkStatus!=="success")return Je.info(2,`RenderPipeline:${this.id}.draw() aborted - waiting for shader linking`)(),!1;if(!this._areTexturesRenderable()||a===0)return Je.info(2,`RenderPipeline:${this.id}.draw() aborted - textures not yet loaded`)(),!1;if(a===0)return Je.info(2,`RenderPipeline:${this.id}.draw() aborted - no vertices to draw`)(),!0;this.device.gl.useProgram(this.handle),d.bindBeforeRender(r),D&&D.begin(this.props.topology),this._applyBindings(),this._applyUniforms();const ne=r;return xD(this.device,o,ne.glParameters,()=>{U&&A?this.device.gl.drawElementsInstanced(N,a||0,re,M,x||0):U?this.device.gl.drawElements(N,a||0,re,M):A?this.device.gl.drawArraysInstanced(N,M,a||0,x||0):this.device.gl.drawArrays(N,M,a||0),D&&D.end()}),d.unbindAfterRender(r),!0}setUniformsWebGL(i){const{bindings:r}=ig(i);Object.keys(r).forEach(o=>{Je.warn(`Unsupported value "${JSON.stringify(r[o])}" used in setUniforms() for key ${o}. Use setBindings() instead?`)()}),Object.assign(this.uniforms,i)}async _linkShaders(){const{gl:i}=this.device;if(i.attachShader(this.handle,this.vs.handle),i.attachShader(this.handle,this.fs.handle),Je.time(e1,`linkProgram for ${this.id}`)(),i.linkProgram(this.handle),Je.timeEnd(e1,`linkProgram for ${this.id}`)(),Je.level,!this.device.features.has("compilation-status-async-webgl")){const o=this._getLinkStatus();this._reportLinkStatus(o);return}Je.once(1,"RenderPipeline linking is asynchronous")(),await this._waitForLinkComplete(),Je.info(2,`RenderPipeline ${this.id} - async linking complete: ${this.linkStatus}`)();const r=this._getLinkStatus();this._reportLinkStatus(r)}_reportLinkStatus(i){var r;switch(i){case"success":return;default:throw this.vs.compilationStatus==="error"?(this.vs.debugShader(),new Error(`Error during compilation of shader ${this.vs.id}`)):((r=this.fs)==null?void 0:r.compilationStatus)==="error"?(this.fs.debugShader(),new Error(`Error during compilation of shader ${this.fs.id}`)):new Error(`Error during ${i}: ${this.device.gl.getProgramInfoLog(this.handle)}`)}}_getLinkStatus(){const{gl:i}=this.device;return i.getProgramParameter(this.handle,35714)?(i.validateProgram(this.handle),i.getProgramParameter(this.handle,35715)?(this.linkStatus="success","success"):(this.linkStatus="error","validation")):(this.linkStatus="error","linking")}async _waitForLinkComplete(){const i=async u=>await new Promise(d=>setTimeout(d,u));if(!this.device.features.has("compilation-status-async-webgl")){await i(10);return}const{gl:o}=this.device;for(;;){if(o.getProgramParameter(this.handle,37297))return;await i(10)}}_areTexturesRenderable(){let i=!0;for(const[,r]of Object.entries(this.bindings))r instanceof Wn&&(r.update(),i=i&&r.loaded);return i}_applyBindings(){if(this.linkStatus!=="success")return;const{gl:i}=this.device;i.useProgram(this.handle);let r=0,o=0;for(const u of this.shaderLayout.bindings){const d=this.bindings[u.name]||this.bindings[u.name.replace(/Uniforms$/,"")];if(!d)throw new Error(`No value for binding ${u.name} in ${this.id}`);switch(u.type){case"uniform":const{name:a}=u,x=i.getUniformBlockIndex(this.handle,a);if(x===4294967295)throw new Error(`Invalid uniform block name ${a}`);i.uniformBlockBinding(this.handle,o,x),d instanceof ra?i.bindBufferBase(35345,o,d.handle):i.bindBufferRange(35345,o,d.buffer.handle,d.offset||0,d.size||d.buffer.byteLength-d.offset),o+=1;break;case"texture":if(!(d instanceof pc||d instanceof Wn||d instanceof eu))throw new Error("texture");let A;if(d instanceof pc)A=d.texture;else if(d instanceof Wn)A=d;else if(d instanceof eu&&d.colorAttachments[0]instanceof pc)Je.warn("Passing framebuffer in texture binding may be deprecated. Use fbo.colorAttachments[0] instead")(),A=d.colorAttachments[0].texture;else throw new Error("No texture");i.activeTexture(33984+r),i.bindTexture(A.target,A.handle),r+=1;break;case"sampler":break;case"storage":case"read-only-storage":throw new Error(`binding type '${u.type}' not supported in WebGL`)}}}_applyUniforms(){for(const i of this.shaderLayout.uniforms||[]){const{name:r,location:o,type:u,textureUnit:d}=i,a=this.uniforms[r]??d;a!==void 0&&pO(this.device.gl,o,u,a)}}}function qV(t){return t}class yO extends J_{constructor(i){super(i,{});L(this,"device");L(this,"commands",[]);this.device=i}submitCommands(i=this.commands){for(const r of i)switch(r.name){case"copy-buffer-to-buffer":bO(this.device,r.options);break;case"copy-buffer-to-texture":vO(this.device,r.options);break;case"copy-texture-to-buffer":xO(this.device,r.options);break;case"copy-texture-to-texture":wO(this.device,r.options);break}}}function bO(t,e){const i=e.source,r=e.destination;t.gl.bindBuffer(36662,i.handle),t.gl.bindBuffer(36663,r.handle),t.gl.copyBufferSubData(36662,36663,e.sourceOffset??0,e.destinationOffset??0,e.size),t.gl.bindBuffer(36662,null),t.gl.bindBuffer(36663,null)}function vO(t,e){throw new Error("Not implemented")}function xO(t,e){const{source:i,mipLevel:r=0,aspect:o="all",width:u=e.source.width,height:d=e.source.height,depthOrArrayLayers:a=0,origin:x=[0,0],destination:A,byteOffset:M=0,bytesPerRow:D,rowsPerImage:N}=e;if(o!=="all")throw new Error("not supported");if(r!==0||a!==0||D||N)throw new Error("not implemented");const{framebuffer:U,destroyFramebuffer:re}=t1(i);let ne;try{const xe=A,Ae=u||U.width,Te=d||U.height,Ie=mf(U.texture.props.format),Ue=Ie.dataFormat,Xe=Ie.type;t.gl.bindBuffer(35051,xe.handle),ne=t.gl.bindFramebuffer(36160,U.handle),t.gl.readPixels(x[0],x[1],Ae,Te,Ue,Xe,M)}finally{t.gl.bindBuffer(35051,null),ne!==void 0&&t.gl.bindFramebuffer(36160,ne),re&&U.destroy()}}function wO(t,e){const{source:i,destinationMipLevel:r=0,origin:o=[0,0],destinationOrigin:u=[0,0],destination:d}=e;let{width:a=e.destination.width,height:x=e.destination.height}=e;const{framebuffer:A,destroyFramebuffer:M}=t1(i),[D,N]=o,[U,re,ne]=u,xe=t.gl.bindFramebuffer(36160,A.handle);let Ae=null,Te;if(d instanceof Wn)Ae=d,a=Number.isFinite(a)?a:Ae.width,x=Number.isFinite(x)?x:Ae.height,Ae.bind(0),Te=Ae.target;else throw new Error("invalid destination");switch(Te){case 3553:case 34067:t.gl.copyTexSubImage2D(Te,r,U,re,D,N,a,x);break;case 35866:case 32879:t.gl.copyTexSubImage3D(Te,r,U,re,ne,D,N,a,x);break}Ae&&Ae.unbind(),t.gl.bindFramebuffer(36160,xe),M&&A.destroy()}function t1(t){if(t instanceof As){const{width:e,height:i,id:r}=t;return{framebuffer:t.device.createFramebuffer({id:`framebuffer-for-${r}`,width:e,height:i,colorAttachments:[t]}),destroyFramebuffer:!0}}return{framebuffer:t,destroyFramebuffer:!1}}class TO extends Y_{constructor(i,r){super(i,r);L(this,"device");L(this,"commandBuffer");this.device=i,this.commandBuffer=new yO(i)}destroy(){}finish(){this.commandBuffer.submitCommands()}copyBufferToBuffer(i){this.commandBuffer.commands.push({name:"copy-buffer-to-buffer",options:i})}copyBufferToTexture(i){this.commandBuffer.commands.push({name:"copy-buffer-to-texture",options:i})}copyTextureToBuffer(i){this.commandBuffer.commands.push({name:"copy-texture-to-buffer",options:i})}copyTextureToTexture(i){this.commandBuffer.commands.push({name:"copy-texture-to-texture",options:i})}pushDebugGroup(i){}popDebugGroup(){}insertDebugMarker(i){}resolveQuerySet(i,r,o){}}class om extends Q_{constructor(i,r){super(i,r);L(this,"device");L(this,"handle");L(this,"buffer",null);L(this,"bufferValue",null);this.device=i,this.handle=this.device.gl.createVertexArray()}get[Symbol.toStringTag](){return"VertexArray"}static isConstantAttributeZeroSupported(i){return WE()==="Chrome"}destroy(){var i;super.destroy(),this.buffer&&((i=this.buffer)==null||i.destroy()),this.handle&&(this.device.gl.deleteVertexArray(this.handle),this.handle=void 0)}setIndexBuffer(i){const r=i;if(r&&r.glTarget!==34963)throw new Error("Use .setBuffer()");this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34963,r?r.handle:null),this.indexBuffer=r,this.device.gl.bindVertexArray(null)}setBuffer(i,r){const o=r;if(o.glTarget===34963)throw new Error("Use .setIndexBuffer()");const{size:u,type:d,stride:a,offset:x,normalized:A,integer:M,divisor:D}=this._getAccessor(i);this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34962,o.handle),M?this.device.gl.vertexAttribIPointer(i,u,d,a,x):this.device.gl.vertexAttribPointer(i,u,d,A,a,x),this.device.gl.bindBuffer(34962,null),this.device.gl.enableVertexAttribArray(i),this.device.gl.vertexAttribDivisor(i,D||0),this.attributes[i]=o,this.device.gl.bindVertexArray(null)}setConstantWebGL(i,r){this._enable(i,!1),this.attributes[i]=r}bindBeforeRender(){this.device.gl.bindVertexArray(this.handle),this._applyConstantAttributes()}unbindAfterRender(){this.device.gl.bindVertexArray(null)}_applyConstantAttributes(){for(let i=0;i<this.maxVertexAttributes;++i){const r=this.attributes[i];ArrayBuffer.isView(r)&&this.device.setConstantAttributeWebGL(i,r)}}_getAccessor(i){const r=this.attributeInfos[i];if(!r)throw new Error(`Unknown attribute location ${i}`);const o=Ux(r.bufferDataType);return{size:r.bufferComponents,type:o,stride:r.byteStride,offset:r.byteOffset,normalized:r.normalized,integer:r.integer,divisor:r.stepMode==="instance"?1:0}}_enable(i,r=!0){const u=om.isConstantAttributeZeroSupported(this.device)||i!==0;(r||u)&&(i=Number(i),this.device.gl.bindVertexArray(this.handle),r?this.device.gl.enableVertexAttribArray(i):this.device.gl.disableVertexAttribArray(i),this.device.gl.bindVertexArray(null))}getConstantBuffer(i,r){const o=AO(r),u=o.byteLength*i,d=o.length*i;if(this.buffer&&u!==this.buffer.byteLength)throw new Error(`Buffer size is immutable, byte length ${u} !== ${this.buffer.byteLength}.`);let a=!this.buffer;if(this.buffer=this.buffer||this.device.createBuffer({byteLength:u}),a=a||!EO(o,this.bufferValue),a){const x=XI(r.constructor,d);qI({target:x,source:o,start:0,count:d}),this.buffer.write(x),this.bufferValue=r}return this.buffer}}function AO(t){return Array.isArray(t)?new Float32Array(t):t}function EO(t,e){if(!t||!e||t.length!==e.length||t.constructor!==e.constructor)return!1;for(let i=0;i<t.length;++i)if(t[i]!==e[i])return!1;return!0}class SO extends eg{constructor(i,r){super(i,r);L(this,"device");L(this,"gl");L(this,"handle");L(this,"layout");L(this,"buffers",{});L(this,"unusedBuffers",{});L(this,"bindOnUse",!0);L(this,"_bound",!1);this.device=i,this.gl=i.gl,this.handle=this.props.handle||this.gl.createTransformFeedback(),this.layout=this.props.layout,r.buffers&&this.setBuffers(r.buffers),Object.seal(this)}destroy(){this.gl.deleteTransformFeedback(this.handle),super.destroy()}begin(i="point-list"){this.gl.bindTransformFeedback(36386,this.handle),this.bindOnUse&&this._bindBuffers(),this.gl.beginTransformFeedback(gO(i))}end(){this.gl.endTransformFeedback(),this.bindOnUse&&this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null)}setBuffers(i){this.buffers={},this.unusedBuffers={},this.bind(()=>{for(const r in i)this.setBuffer(r,i[r])})}setBuffer(i,r){const o=this._getVaryingIndex(i),{buffer:u,byteLength:d,byteOffset:a}=this._getBufferRange(r);if(o<0){this.unusedBuffers[i]=u,Je.warn(`${this.id} unusedBuffers varying buffer ${i}`)();return}this.buffers[o]={buffer:u,byteLength:d,byteOffset:a},this.bindOnUse||this._bindBuffer(o,u,a,d)}getBuffer(i){if(i1(i))return this.buffers[i]||null;const r=this._getVaryingIndex(i);return r>=0?this.buffers[r]:null}bind(i=this.handle){if(typeof i!="function")return this.gl.bindTransformFeedback(36386,i),this;let r;return this._bound?r=i():(this.gl.bindTransformFeedback(36386,this.handle),this._bound=!0,r=i(),this._bound=!1,this.gl.bindTransformFeedback(36386,null)),r}unbind(){this.bind(null)}_getBufferRange(i){if(i instanceof ra)return{buffer:i,byteOffset:0,byteLength:i.byteLength};const{buffer:r,byteOffset:o=0,byteLength:u=i.buffer.byteLength}=i;return{buffer:r,byteOffset:o,byteLength:u}}_getVaryingIndex(i){if(i1(i))return Number(i);for(const r of this.layout.varyings)if(i===r.name)return r.location;return-1}_bindBuffers(){for(const i in this.buffers){const{buffer:r,byteLength:o,byteOffset:u}=this._getBufferRange(this.buffers[i]);this._bindBuffer(Number(i),r,u,o)}}_unbindBuffers(){for(const i in this.buffers)this.gl.bindBufferBase(35982,Number(i),null)}_bindBuffer(i,r,o=0,u){const d=r&&r.handle;!d||u===void 0?this.gl.bindBufferBase(35982,i,d):this.gl.bindBufferRange(35982,i,d,o,u)}}function i1(t){return typeof t=="number"?Number.isInteger(t):/^\d+$/.test(t)}class CO extends tg{constructor(i,r){super(i,r);L(this,"device");L(this,"handle");L(this,"target",null);L(this,"_queryPending",!1);L(this,"_pollingPromise",null);if(this.device=i,r.count>1)throw new Error("WebGL QuerySet can only have one value");this.handle=this.device.gl.createQuery(),Object.seal(this)}get[Symbol.toStringTag](){return"Query"}destroy(){this.device.gl.deleteQuery(this.handle)}beginTimestampQuery(){return this._begin(35007)}endTimestampQuery(){this._end()}beginOcclusionQuery(i){return this._begin(i!=null&&i.conservative?36202:35887)}endOcclusionQuery(){this._end()}beginTransformFeedbackQuery(){return this._begin(35976)}endTransformFeedbackQuery(){this._end()}async resolveQuery(){return[await this.pollQuery()]}_begin(i){this._queryPending||(this.target=i,this.device.gl.beginQuery(this.target,this.handle))}_end(){this._queryPending||this.target&&(this.device.gl.endQuery(this.target),this.target=null,this._queryPending=!0)}isResultAvailable(){if(!this._queryPending)return!1;const i=this.device.gl.getQueryParameter(this.handle,34919);return i&&(this._queryPending=!1),i}isTimerDisjoint(){return this.device.gl.getParameter(36795)}getResult(){return this.device.gl.getQueryParameter(this.handle,34918)}getTimerMilliseconds(){return this.getResult()/1e6}pollQuery(i=Number.POSITIVE_INFINITY){if(this._pollingPromise)return this._pollingPromise;let r=0;return this._pollingPromise=new Promise((o,u)=>{const d=()=>{this.isResultAvailable()?(o(this.getResult()),this._pollingPromise=null):r++>i?(u("Timed out"),this._pollingPromise=null):requestAnimationFrame(d)};requestAnimationFrame(d)}),this._pollingPromise}}function r1(t){switch(t){case 6406:case 33326:case 6403:return 1;case 33328:case 33319:return 2;case 6407:case 34837:return 3;case 6408:case 34836:return 4;default:return ti(!1),0}}function IO(t){switch(t){case 5121:return 1;case 33635:case 32819:case 32820:return 2;case 5126:return 4;default:return ti(!1),0}}function MO(t,e){var xe,Ae;const{sourceX:i=0,sourceY:r=0,sourceFormat:o=6408,sourceAttachment:u=36064}=e||{};let{target:d=null,sourceWidth:a,sourceHeight:x,sourceType:A}=e||{};const{framebuffer:M,deleteFramebuffer:D}=s1(t);ti(M);const{gl:N,handle:U}=M;a=a||M.width,x=x||M.height;const re=u-36064;A=A||((Ae=(xe=M.colorAttachments[re])==null?void 0:xe.texture)==null?void 0:Ae.type)||5121,d=BO(d,A,o,a,x),A=A||eO(d);const ne=N.bindFramebuffer(36160,U);return N.readPixels(i,r,a,x,o,A,d),N.bindFramebuffer(36160,ne||null),D&&M.destroy(),d}function RO(t,e){const{target:i,sourceX:r=0,sourceY:o=0,sourceFormat:u=6408,targetByteOffset:d=0}=e||{};let{sourceWidth:a,sourceHeight:x,sourceType:A}=e||{};const{framebuffer:M,deleteFramebuffer:D}=s1(t);ti(M),a=a||M.width,x=x||M.height;const N=M;A=A||5121;let U=i;if(!U){const ne=r1(u),xe=IO(A),Ae=d+a*x*ne*xe;U=N.device.createBuffer({byteLength:Ae})}const re=t.device.createCommandEncoder();return re.copyTextureToBuffer({source:t,width:a,height:x,origin:[r,o],destination:U,byteOffset:d}),re.destroy(),D&&M.destroy(),U}function s1(t){return t instanceof zd?{framebuffer:t,deleteFramebuffer:!1}:{framebuffer:PO(t),deleteFramebuffer:!0}}function PO(t,e){const{device:i,width:r,height:o,id:u}=t;return i.createFramebuffer({...e,id:`framebuffer-for-${u}`,width:r,height:o,colorAttachments:[t]})}function BO(t,e,i,r,o){if(t)return t;e=e||5121;const u=nm(e,{clamped:!1}),d=r1(i);return new u(r*o*d)}const DO=256,OO=1024,FO=16384,kO="clear: bad arguments";function NO(t,e){const{framebuffer:i=null,color:r=null,depth:o=null,stencil:u=null}=e||{},d={};i&&(d.framebuffer=i);let a=0;r&&(a|=FO,r!==!0&&(d.clearColor=r)),o&&(a|=DO,o!==!0&&(d.clearDepth=o)),u&&(a|=OO,o!==!0&&(d.clearStencil=o)),ti(a!==0,kO);const x=t.gl;ia(x,d,()=>{x.clear(a)})}const iu=1,il=class il extends Xl{constructor(i){var x,A;super({...i,id:i.id||Wo("webgl-device")});L(this,"type","webgl");L(this,"handle");L(this,"features");L(this,"limits");L(this,"info");L(this,"canvasContext");L(this,"lost");L(this,"_resolveContextLost");L(this,"renderPass",null);L(this,"gl");L(this,"debug",!1);L(this,"_canvasSizeInfo",{clientWidth:0,clientHeight:0,devicePixelRatio:1});L(this,"_extensions",{});L(this,"_polyfilled",!1);L(this,"spectorJS");L(this,"_constants");const r=(x=i.gl)==null?void 0:x.device;if(r)throw new Error(`WebGL context already attached to device ${r.id}`);const o=((A=i.gl)==null?void 0:A.canvas)||i.canvas;this.canvasContext=new DD(this,{...i,canvas:o}),this.lost=new Promise(M=>{this._resolveContextLost=M});let u=i.gl||null;if(u||(u=JB(this.canvasContext.canvas,{...i,onContextLost:M=>{var D;return(D=this._resolveContextLost)==null?void 0:D.call(this,{reason:"destroyed",message:"Entered sleep mode, or too many apps or browser tabs are using the GPU."})}})),!u)throw new Error("WebGL context creation failed");this.handle=u,this.gl=u,this.gl.device=this,this.gl._version=2,i.spector&&(this.spectorJS=LD({...this.props,canvas:this.handle.canvas})),this.info=QB(this.gl,this._extensions),this.limits=new bD(this.gl),this.features=new yD(this.gl,this._extensions,this.props.disabledFeatures),this.props.initalizeFeatures&&this.features.initializeFeatures(),this.canvasContext.resize();const{enable:d=!0,copyState:a=!1}=i;kx(this.gl,{enable:d,copyState:a,log:(...M)=>Je.log(1,...M)()}),i.debug&&(this.gl=VD(this.gl,{...i,throwOnError:!0}),this.debug=!0,Je.level=Math.max(Je.level,1),Je.warn("WebGL debug mode activated. Performance reduced.")())}static isSupported(){return typeof WebGL2RenderingContext<"u"}static attach(i){if(i instanceof il)return i;if((i==null?void 0:i.device)instanceof Xl)return i.device;if(!LO(i))throw new Error("Invalid WebGL2RenderingContext");return new il({gl:i})}static async create(i={}){var a;Je.groupCollapsed(iu,"WebGLDevice created")();const r=[];i.debug&&r.push(zD()),i.spector&&r.push(ND()),typeof i.canvas=="string"&&r.push(Z_.pageLoaded);const o=await Promise.allSettled(r);for(const x of o)x.status==="rejected"&&Je.error(`Failed to initialize debug libraries ${x.reason}`)();if(Je.probe(iu+1,"DOM is loaded")(),(a=i.gl)!=null&&a.device)return Je.warn("reattaching existing device")(),il.attach(i.gl);const u=new il(i),d=`Created ${u.type}${u.debug?" debug":""} context: ${u.info.vendor}, ${u.info.renderer} for canvas: ${u.canvasContext.id}`;return Je.probe(iu,d)(),Je.table(iu,u.info)(),Je.groupEnd(iu)(),u}destroy(){}get isLost(){return this.gl.isContextLost()}getSize(){return[this.gl.drawingBufferWidth,this.gl.drawingBufferHeight]}isTextureFormatSupported(i){return Jg(this.gl,i,this._extensions)}isTextureFormatFilterable(i){return pD(this.gl,i,this._extensions)}isTextureFormatRenderable(i){return _D(this.gl,i,this._extensions)}createCanvasContext(i){throw new Error("WebGL only supports a single canvas")}createBuffer(i){const r=this._getBufferProps(i);return new ra(this,r)}_createTexture(i){return new Wn(this,i)}createExternalTexture(i){throw new Error("createExternalTexture() not implemented")}createSampler(i){return new im(this,i)}createShader(i){return new XD(this,i)}createFramebuffer(i){return new eu(this,i)}createVertexArray(i){return new om(this,i)}createTransformFeedback(i){return new SO(this,i)}createQuerySet(i){return new CO(this,i)}createRenderPipeline(i){return new mO(this,i)}beginRenderPass(i){return new JD(this,i)}createComputePipeline(i){throw new Error("ComputePipeline not supported in WebGL")}beginComputePass(i){throw new Error("ComputePass not supported in WebGL")}createCommandEncoder(i){return new TO(this,i)}submit(){var i;(i=this.renderPass)==null||i.end(),this.renderPass=null}readPixelsToArrayWebGL(i,r){return MO(i,r)}readPixelsToBufferWebGL(i,r){return RO(i,r)}setParametersWebGL(i){uc(this.gl,i)}getParametersWebGL(i){return Fx(this.gl,i)}withParametersWebGL(i,r){return ia(this.gl,i,r)}clearWebGL(i){NO(this,i)}resetWebGL(){Je.warn("WebGLDevice.resetWebGL is deprecated, use only for debugging")(),$B(this.gl)}loseDevice(){var u;let i=!1;const o=this.getExtension("WEBGL_lose_context").WEBGL_lose_context;return o&&(i=!0,o.loseContext()),(u=this._resolveContextLost)==null||u.call(this,{reason:"destroyed",message:"Application triggered context loss"}),i}pushState(){ff(this.gl)}popState(){Zh(this.gl)}setSpectorMetadata(i,r){i.__SPECTOR_Metadata=r}getGLKey(i,r){r=r||this.gl2||this.gl;const o=Number(i);for(const u in r)if(r[u]===o)return`GL.${u}`;return String(i)}setConstantAttributeWebGL(i,r){const o=this.limits.maxVertexAttributes;this._constants=this._constants||new Array(o).fill(null);const u=this._constants[i];switch(u&&jO(u,r)&&Je.info(1,`setConstantAttributeWebGL(${i}) could have been skipped, value unchanged`)(),this._constants[i]=r,r.constructor){case Float32Array:UO(this,i,r);break;case Int32Array:zO(this,i,r);break;case Uint32Array:VO(this,i,r);break;default:ti(!1)}}getExtension(i){return ta(this.gl,i,this._extensions),this._extensions}};L(il,"type","webgl");let ru=il;function LO(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:!!(t&&Number.isFinite(t._version))}function UO(t,e,i){switch(i.length){case 1:t.gl.vertexAttrib1fv(e,i);break;case 2:t.gl.vertexAttrib2fv(e,i);break;case 3:t.gl.vertexAttrib3fv(e,i);break;case 4:t.gl.vertexAttrib4fv(e,i);break;default:ti(!1)}}function zO(t,e,i){t.gl.vertexAttribI4iv(e,i)}function VO(t,e,i){t.gl.vertexAttribI4uiv(e,i)}function jO(t,e){if(!t||!e||t.length!==e.length||t.constructor!==e.constructor)return!1;for(let i=0;i<t.length;++i)if(t[i]!==e[i])return!1;return!0}var n1={exports:{}};/*! Hammer.JS - v2.0.7 - 2016-04-22
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2016 Jorik Tangelder;
 * Licensed under the MIT license */(function(t){(function(e,i,r,o){var u=["","webkit","Moz","MS","ms","o"],d=i.createElement("div"),a="function",x=Math.round,A=Math.abs,M=Date.now;function D(q,ee,de){return setTimeout(Ie(q,de),ee)}function N(q,ee,de){return Array.isArray(q)?(U(q,de[ee],de),!0):!1}function U(q,ee,de){var Ee;if(q)if(q.forEach)q.forEach(ee,de);else if(q.length!==o)for(Ee=0;Ee<q.length;)ee.call(de,q[Ee],Ee,q),Ee++;else for(Ee in q)q.hasOwnProperty(Ee)&&ee.call(de,q[Ee],Ee,q)}function re(q,ee,de){var Ee="DEPRECATED METHOD: "+ee+`
`+de+` AT 
`;return function(){var $e=new Error("get-stack-trace"),lt=$e&&$e.stack?$e.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",Mt=e.console&&(e.console.warn||e.console.log);return Mt&&Mt.call(e.console,Ee,lt),q.apply(this,arguments)}}var ne;typeof Object.assign!="function"?ne=function(ee){if(ee===o||ee===null)throw new TypeError("Cannot convert undefined or null to object");for(var de=Object(ee),Ee=1;Ee<arguments.length;Ee++){var $e=arguments[Ee];if($e!==o&&$e!==null)for(var lt in $e)$e.hasOwnProperty(lt)&&(de[lt]=$e[lt])}return de}:ne=Object.assign;var xe=re(function(ee,de,Ee){for(var $e=Object.keys(de),lt=0;lt<$e.length;)(!Ee||Ee&&ee[$e[lt]]===o)&&(ee[$e[lt]]=de[$e[lt]]),lt++;return ee},"extend","Use `assign`."),Ae=re(function(ee,de){return xe(ee,de,!0)},"merge","Use `assign`.");function Te(q,ee,de){var Ee=ee.prototype,$e;$e=q.prototype=Object.create(Ee),$e.constructor=q,$e._super=Ee,de&&ne($e,de)}function Ie(q,ee){return function(){return q.apply(ee,arguments)}}function Ue(q,ee){return typeof q==a?q.apply(ee&&ee[0]||o,ee):q}function Xe(q,ee){return q===o?ee:q}function qe(q,ee,de){U(at(ee),function(Ee){q.addEventListener(Ee,de,!1)})}function ht(q,ee,de){U(at(ee),function(Ee){q.removeEventListener(Ee,de,!1)})}function gt(q,ee){for(;q;){if(q==ee)return!0;q=q.parentNode}return!1}function nt(q,ee){return q.indexOf(ee)>-1}function at(q){return q.trim().split(/\s+/g)}function bt(q,ee,de){if(q.indexOf&&!de)return q.indexOf(ee);for(var Ee=0;Ee<q.length;){if(de&&q[Ee][de]==ee||!de&&q[Ee]===ee)return Ee;Ee++}return-1}function kt(q){return Array.prototype.slice.call(q,0)}function Ht(q,ee,de){for(var Ee=[],$e=[],lt=0;lt<q.length;){var Mt=q[lt][ee];bt($e,Mt)<0&&Ee.push(q[lt]),$e[lt]=Mt,lt++}return Ee=Ee.sort(function(yt,Si){return yt[ee]>Si[ee]}),Ee}function St(q,ee){for(var de,Ee,$e=ee[0].toUpperCase()+ee.slice(1),lt=0;lt<u.length;){if(de=u[lt],Ee=de?de+$e:ee,Ee in q)return Ee;lt++}return o}var xi=1;function Fr(){return xi++}function br(q){var ee=q.ownerDocument||q;return ee.defaultView||ee.parentWindow||e}var Qn=/mobile|tablet|ip(ad|hone|od)|android/i,Gt="ontouchstart"in e,or=St(e,"PointerEvent")!==o,Ai=Gt&&Qn.test(navigator.userAgent),ar="touch",gs="pen",ms="mouse",In="kinect",Ir=25,Pi=1,$i=2,Zt=4,ki=8,Rs=1,Qi=2,oi=4,ci=8,vr=16,Ni=Qi|oi,kr=ci|vr,is=Ni|kr,rs=["x","y"],Ps=["clientX","clientY"];function Li(q,ee){var de=this;this.manager=q,this.callback=ee,this.element=q.element,this.target=q.options.inputTarget,this.domHandler=function(Ee){Ue(q.options.enable,[q])&&de.handler(Ee)},this.init()}Li.prototype={handler:function(){},init:function(){this.evEl&&qe(this.element,this.evEl,this.domHandler),this.evTarget&&qe(this.target,this.evTarget,this.domHandler),this.evWin&&qe(br(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&ht(this.element,this.evEl,this.domHandler),this.evTarget&&ht(this.target,this.evTarget,this.domHandler),this.evWin&&ht(br(this.element),this.evWin,this.domHandler)}};function on(q){var ee,de=q.options.inputClass;return de?ee=de:or?ee=Tt:Ai?ee=Bt:Gt?ee=Wi:ee=Le,new ee(q,an)}function an(q,ee,de){var Ee=de.pointers.length,$e=de.changedPointers.length,lt=ee&Pi&&Ee-$e===0,Mt=ee&(Zt|ki)&&Ee-$e===0;de.isFirst=!!lt,de.isFinal=!!Mt,lt&&(q.session={}),de.eventType=ee,Mn(q,de),q.emit("hammer.input",de),q.recognize(de),q.session.prevInput=de}function Mn(q,ee){var de=q.session,Ee=ee.pointers,$e=Ee.length;de.firstInput||(de.firstInput=Bs(ee)),$e>1&&!de.firstMultiple?de.firstMultiple=Bs(ee):$e===1&&(de.firstMultiple=!1);var lt=de.firstInput,Mt=de.firstMultiple,pi=Mt?Mt.center:lt.center,yt=ee.center=Rn(Ee);ee.timeStamp=M(),ee.deltaTime=ee.timeStamp-lt.timeStamp,ee.angle=Z(pi,yt),ee.distance=X(pi,yt),ln(de,ee),ee.offsetDirection=$(ee.deltaX,ee.deltaY);var Si=ge(ee.deltaTime,ee.deltaX,ee.deltaY);ee.overallVelocityX=Si.x,ee.overallVelocityY=Si.y,ee.overallVelocity=A(Si.x)>A(Si.y)?Si.x:Si.y,ee.scale=Mt?pe(Mt.pointers,Ee):1,ee.rotation=Mt?oe(Mt.pointers,Ee):0,ee.maxPointers=de.prevInput?ee.pointers.length>de.prevInput.maxPointers?ee.pointers.length:de.prevInput.maxPointers:ee.pointers.length,cn(de,ee);var Lr=q.element;gt(ee.srcEvent.target,Lr)&&(Lr=ee.srcEvent.target),ee.target=Lr}function ln(q,ee){var de=ee.center,Ee=q.offsetDelta||{},$e=q.prevDelta||{},lt=q.prevInput||{};(ee.eventType===Pi||lt.eventType===Zt)&&($e=q.prevDelta={x:lt.deltaX||0,y:lt.deltaY||0},Ee=q.offsetDelta={x:de.x,y:de.y}),ee.deltaX=$e.x+(de.x-Ee.x),ee.deltaY=$e.y+(de.y-Ee.y)}function cn(q,ee){var de=q.lastInterval||ee,Ee=ee.timeStamp-de.timeStamp,$e,lt,Mt,pi;if(ee.eventType!=ki&&(Ee>Ir||de.velocity===o)){var yt=ee.deltaX-de.deltaX,Si=ee.deltaY-de.deltaY,Lr=ge(Ee,yt,Si);lt=Lr.x,Mt=Lr.y,$e=A(Lr.x)>A(Lr.y)?Lr.x:Lr.y,pi=$(yt,Si),q.lastInterval=ee}else $e=de.velocity,lt=de.velocityX,Mt=de.velocityY,pi=de.direction;ee.velocity=$e,ee.velocityX=lt,ee.velocityY=Mt,ee.direction=pi}function Bs(q){for(var ee=[],de=0;de<q.pointers.length;)ee[de]={clientX:x(q.pointers[de].clientX),clientY:x(q.pointers[de].clientY)},de++;return{timeStamp:M(),pointers:ee,center:Rn(ee),deltaX:q.deltaX,deltaY:q.deltaY}}function Rn(q){var ee=q.length;if(ee===1)return{x:x(q[0].clientX),y:x(q[0].clientY)};for(var de=0,Ee=0,$e=0;$e<ee;)de+=q[$e].clientX,Ee+=q[$e].clientY,$e++;return{x:x(de/ee),y:x(Ee/ee)}}function ge(q,ee,de){return{x:ee/q||0,y:de/q||0}}function $(q,ee){return q===ee?Rs:A(q)>=A(ee)?q<0?Qi:oi:ee<0?ci:vr}function X(q,ee,de){de||(de=rs);var Ee=ee[de[0]]-q[de[0]],$e=ee[de[1]]-q[de[1]];return Math.sqrt(Ee*Ee+$e*$e)}function Z(q,ee,de){de||(de=rs);var Ee=ee[de[0]]-q[de[0]],$e=ee[de[1]]-q[de[1]];return Math.atan2($e,Ee)*180/Math.PI}function oe(q,ee){return Z(ee[1],ee[0],Ps)+Z(q[1],q[0],Ps)}function pe(q,ee){return X(ee[0],ee[1],Ps)/X(q[0],q[1],Ps)}var ye={mousedown:Pi,mousemove:$i,mouseup:Zt},Re="mousedown",be="mousemove mouseup";function Le(){this.evEl=Re,this.evWin=be,this.pressed=!1,Li.apply(this,arguments)}Te(Le,Li,{handler:function(ee){var de=ye[ee.type];de&Pi&&ee.button===0&&(this.pressed=!0),de&$i&&ee.which!==1&&(de=Zt),this.pressed&&(de&Zt&&(this.pressed=!1),this.callback(this.manager,de,{pointers:[ee],changedPointers:[ee],pointerType:ms,srcEvent:ee}))}});var Ge={pointerdown:Pi,pointermove:$i,pointerup:Zt,pointercancel:ki,pointerout:ki},Ve={2:ar,3:gs,4:ms,5:In},ct="pointerdown",we="pointermove pointerup pointercancel";e.MSPointerEvent&&!e.PointerEvent&&(ct="MSPointerDown",we="MSPointerMove MSPointerUp MSPointerCancel");function Tt(){this.evEl=ct,this.evWin=we,Li.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}Te(Tt,Li,{handler:function(ee){var de=this.store,Ee=!1,$e=ee.type.toLowerCase().replace("ms",""),lt=Ge[$e],Mt=Ve[ee.pointerType]||ee.pointerType,pi=Mt==ar,yt=bt(de,ee.pointerId,"pointerId");lt&Pi&&(ee.button===0||pi)?yt<0&&(de.push(ee),yt=de.length-1):lt&(Zt|ki)&&(Ee=!0),!(yt<0)&&(de[yt]=ee,this.callback(this.manager,lt,{pointers:de,changedPointers:[ee],pointerType:Mt,srcEvent:ee}),Ee&&de.splice(yt,1))}});var Ft={touchstart:Pi,touchmove:$i,touchend:Zt,touchcancel:ki},pt="touchstart",Ct="touchstart touchmove touchend touchcancel";function Qt(){this.evTarget=pt,this.evWin=Ct,this.started=!1,Li.apply(this,arguments)}Te(Qt,Li,{handler:function(ee){var de=Ft[ee.type];if(de===Pi&&(this.started=!0),!!this.started){var Ee=Ui.call(this,ee,de);de&(Zt|ki)&&Ee[0].length-Ee[1].length===0&&(this.started=!1),this.callback(this.manager,de,{pointers:Ee[0],changedPointers:Ee[1],pointerType:ar,srcEvent:ee})}}});function Ui(q,ee){var de=kt(q.touches),Ee=kt(q.changedTouches);return ee&(Zt|ki)&&(de=Ht(de.concat(Ee),"identifier")),[de,Ee]}var zi={touchstart:Pi,touchmove:$i,touchend:Zt,touchcancel:ki},Ei="touchstart touchmove touchend touchcancel";function Bt(){this.evTarget=Ei,this.targetIds={},Li.apply(this,arguments)}Te(Bt,Li,{handler:function(ee){var de=zi[ee.type],Ee=Lt.call(this,ee,de);Ee&&this.callback(this.manager,de,{pointers:Ee[0],changedPointers:Ee[1],pointerType:ar,srcEvent:ee})}});function Lt(q,ee){var de=kt(q.touches),Ee=this.targetIds;if(ee&(Pi|$i)&&de.length===1)return Ee[de[0].identifier]=!0,[de,de];var $e,lt,Mt=kt(q.changedTouches),pi=[],yt=this.target;if(lt=de.filter(function(Si){return gt(Si.target,yt)}),ee===Pi)for($e=0;$e<lt.length;)Ee[lt[$e].identifier]=!0,$e++;for($e=0;$e<Mt.length;)Ee[Mt[$e].identifier]&&pi.push(Mt[$e]),ee&(Zt|ki)&&delete Ee[Mt[$e].identifier],$e++;if(pi.length)return[Ht(lt.concat(pi),"identifier"),pi]}var Bi=2500,We=25;function Wi(){Li.apply(this,arguments);var q=Ie(this.handler,this);this.touch=new Bt(this.manager,q),this.mouse=new Le(this.manager,q),this.primaryTouch=null,this.lastTouches=[]}Te(Wi,Li,{handler:function(ee,de,Ee){var $e=Ee.pointerType==ar,lt=Ee.pointerType==ms;if(!(lt&&Ee.sourceCapabilities&&Ee.sourceCapabilities.firesTouchEvents)){if($e)bi.call(this,de,Ee);else if(lt&&eo.call(this,Ee))return;this.callback(ee,de,Ee)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function bi(q,ee){q&Pi?(this.primaryTouch=ee.changedPointers[0].identifier,Ds.call(this,ee)):q&(Zt|ki)&&Ds.call(this,ee)}function Ds(q){var ee=q.changedPointers[0];if(ee.identifier===this.primaryTouch){var de={x:ee.clientX,y:ee.clientY};this.lastTouches.push(de);var Ee=this.lastTouches,$e=function(){var lt=Ee.indexOf(de);lt>-1&&Ee.splice(lt,1)};setTimeout($e,Bi)}}function eo(q){for(var ee=q.srcEvent.clientX,de=q.srcEvent.clientY,Ee=0;Ee<this.lastTouches.length;Ee++){var $e=this.lastTouches[Ee],lt=Math.abs(ee-$e.x),Mt=Math.abs(de-$e.y);if(lt<=We&&Mt<=We)return!0}return!1}var rt=St(d.style,"touchAction"),Ot=rt!==o,It="compute",Xi="auto",Os="manipulation",Mr="none",At="pan-x",hn="pan-y",ss=io();function to(q,ee){this.manager=q,this.set(ee)}to.prototype={set:function(q){q==It&&(q=this.compute()),Ot&&this.manager.element.style&&ss[q]&&(this.manager.element.style[rt]=q),this.actions=q.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var q=[];return U(this.manager.recognizers,function(ee){Ue(ee.options.enable,[ee])&&(q=q.concat(ee.getTouchAction()))}),ys(q.join(" "))},preventDefaults:function(q){var ee=q.srcEvent,de=q.offsetDirection;if(this.manager.session.prevented){ee.preventDefault();return}var Ee=this.actions,$e=nt(Ee,Mr)&&!ss[Mr],lt=nt(Ee,hn)&&!ss[hn],Mt=nt(Ee,At)&&!ss[At];if($e){var pi=q.pointers.length===1,yt=q.distance<2,Si=q.deltaTime<250;if(pi&&yt&&Si)return}if(!(Mt&&lt)&&($e||lt&&de&Ni||Mt&&de&kr))return this.preventSrc(ee)},preventSrc:function(q){this.manager.session.prevented=!0,q.preventDefault()}};function ys(q){if(nt(q,Mr))return Mr;var ee=nt(q,At),de=nt(q,hn);return ee&&de?Mr:ee||de?ee?At:hn:nt(q,Os)?Os:Xi}function io(){if(!Ot)return!1;var q={},ee=e.CSS&&e.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(de){q[de]=ee?e.CSS.supports("touch-action",de):!0}),q}var hi=1,xr=2,Vi=4,Vt=8,bs=Vt,Fs=16,Kr=32;function lr(q){this.options=ne({},this.defaults,q||{}),this.id=Fr(),this.manager=null,this.options.enable=Xe(this.options.enable,!0),this.state=hi,this.simultaneous={},this.requireFail=[]}lr.prototype={defaults:{},set:function(q){return ne(this.options,q),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(q){if(N(q,"recognizeWith",this))return this;var ee=this.simultaneous;return q=Eo(q,this),ee[q.id]||(ee[q.id]=q,q.recognizeWith(this)),this},dropRecognizeWith:function(q){return N(q,"dropRecognizeWith",this)?this:(q=Eo(q,this),delete this.simultaneous[q.id],this)},requireFailure:function(q){if(N(q,"requireFailure",this))return this;var ee=this.requireFail;return q=Eo(q,this),bt(ee,q)===-1&&(ee.push(q),q.requireFailure(this)),this},dropRequireFailure:function(q){if(N(q,"dropRequireFailure",this))return this;q=Eo(q,this);var ee=bt(this.requireFail,q);return ee>-1&&this.requireFail.splice(ee,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(q){return!!this.simultaneous[q.id]},emit:function(q){var ee=this,de=this.state;function Ee($e){ee.manager.emit($e,q)}de<Vt&&Ee(ee.options.event+ks(de)),Ee(ee.options.event),q.additionalEvent&&Ee(q.additionalEvent),de>=Vt&&Ee(ee.options.event+ks(de))},tryEmit:function(q){if(this.canEmit())return this.emit(q);this.state=Kr},canEmit:function(){for(var q=0;q<this.requireFail.length;){if(!(this.requireFail[q].state&(Kr|hi)))return!1;q++}return!0},recognize:function(q){var ee=ne({},q);if(!Ue(this.options.enable,[this,ee])){this.reset(),this.state=Kr;return}this.state&(bs|Fs|Kr)&&(this.state=hi),this.state=this.process(ee),this.state&(xr|Vi|Vt|Fs)&&this.tryEmit(ee)},process:function(q){},getTouchAction:function(){},reset:function(){}};function ks(q){return q&Fs?"cancel":q&Vt?"end":q&Vi?"move":q&xr?"start":""}function la(q){return q==vr?"down":q==ci?"up":q==Qi?"left":q==oi?"right":""}function Eo(q,ee){var de=ee.manager;return de?de.get(q):q}function Yr(){lr.apply(this,arguments)}Te(Yr,lr,{defaults:{pointers:1},attrTest:function(q){var ee=this.options.pointers;return ee===0||q.pointers.length===ee},process:function(q){var ee=this.state,de=q.eventType,Ee=ee&(xr|Vi),$e=this.attrTest(q);return Ee&&(de&ki||!$e)?ee|Fs:Ee||$e?de&Zt?ee|Vt:ee&xr?ee|Vi:xr:Kr}});function Ns(){Yr.apply(this,arguments),this.pX=null,this.pY=null}Te(Ns,Yr,{defaults:{event:"pan",threshold:10,pointers:1,direction:is},getTouchAction:function(){var q=this.options.direction,ee=[];return q&Ni&&ee.push(hn),q&kr&&ee.push(At),ee},directionTest:function(q){var ee=this.options,de=!0,Ee=q.distance,$e=q.direction,lt=q.deltaX,Mt=q.deltaY;return $e&ee.direction||(ee.direction&Ni?($e=lt===0?Rs:lt<0?Qi:oi,de=lt!=this.pX,Ee=Math.abs(q.deltaX)):($e=Mt===0?Rs:Mt<0?ci:vr,de=Mt!=this.pY,Ee=Math.abs(q.deltaY))),q.direction=$e,de&&Ee>ee.threshold&&$e&ee.direction},attrTest:function(q){return Yr.prototype.attrTest.call(this,q)&&(this.state&xr||!(this.state&xr)&&this.directionTest(q))},emit:function(q){this.pX=q.deltaX,this.pY=q.deltaY;var ee=la(q.direction);ee&&(q.additionalEvent=this.options.event+ee),this._super.emit.call(this,q)}});function ca(){Yr.apply(this,arguments)}Te(ca,Yr,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[Mr]},attrTest:function(q){return this._super.attrTest.call(this,q)&&(Math.abs(q.scale-1)>this.options.threshold||this.state&xr)},emit:function(q){if(q.scale!==1){var ee=q.scale<1?"in":"out";q.additionalEvent=this.options.event+ee}this._super.emit.call(this,q)}});function rl(){lr.apply(this,arguments),this._timer=null,this._input=null}Te(rl,lr,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[Xi]},process:function(q){var ee=this.options,de=q.pointers.length===ee.pointers,Ee=q.distance<ee.threshold,$e=q.deltaTime>ee.time;if(this._input=q,!Ee||!de||q.eventType&(Zt|ki)&&!$e)this.reset();else if(q.eventType&Pi)this.reset(),this._timer=D(function(){this.state=bs,this.tryEmit()},ee.time,this);else if(q.eventType&Zt)return bs;return Kr},reset:function(){clearTimeout(this._timer)},emit:function(q){this.state===bs&&(q&&q.eventType&Zt?this.manager.emit(this.options.event+"up",q):(this._input.timeStamp=M(),this.manager.emit(this.options.event,this._input)))}});function sl(){Yr.apply(this,arguments)}Te(sl,Yr,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[Mr]},attrTest:function(q){return this._super.attrTest.call(this,q)&&(Math.abs(q.rotation)>this.options.threshold||this.state&xr)}});function nl(){Yr.apply(this,arguments)}Te(nl,Yr,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:Ni|kr,pointers:1},getTouchAction:function(){return Ns.prototype.getTouchAction.call(this)},attrTest:function(q){var ee=this.options.direction,de;return ee&(Ni|kr)?de=q.overallVelocity:ee&Ni?de=q.overallVelocityX:ee&kr&&(de=q.overallVelocityY),this._super.attrTest.call(this,q)&&ee&q.offsetDirection&&q.distance>this.options.threshold&&q.maxPointers==this.options.pointers&&A(de)>this.options.velocity&&q.eventType&Zt},emit:function(q){var ee=la(q.offsetDirection);ee&&this.manager.emit(this.options.event+ee,q),this.manager.emit(this.options.event,q)}});function ro(){lr.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}Te(ro,lr,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[Os]},process:function(q){var ee=this.options,de=q.pointers.length===ee.pointers,Ee=q.distance<ee.threshold,$e=q.deltaTime<ee.time;if(this.reset(),q.eventType&Pi&&this.count===0)return this.failTimeout();if(Ee&&$e&&de){if(q.eventType!=Zt)return this.failTimeout();var lt=this.pTime?q.timeStamp-this.pTime<ee.interval:!0,Mt=!this.pCenter||X(this.pCenter,q.center)<ee.posThreshold;this.pTime=q.timeStamp,this.pCenter=q.center,!Mt||!lt?this.count=1:this.count+=1,this._input=q;var pi=this.count%ee.taps;if(pi===0)return this.hasRequireFailures()?(this._timer=D(function(){this.state=bs,this.tryEmit()},ee.interval,this),xr):bs}return Kr},failTimeout:function(){return this._timer=D(function(){this.state=Kr},this.options.interval,this),Kr},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==bs&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function Nr(q,ee){return ee=ee||{},ee.recognizers=Xe(ee.recognizers,Nr.defaults.preset),new un(q,ee)}Nr.VERSION="2.0.7",Nr.defaults={domEvents:!1,touchAction:It,enable:!0,inputTarget:null,inputClass:null,preset:[[sl,{enable:!1}],[ca,{enable:!1},["rotate"]],[nl,{direction:Ni}],[Ns,{direction:Ni},["swipe"]],[ro],[ro,{event:"doubletap",taps:2},["tap"]],[rl]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var ol=1,ha=2;function un(q,ee){this.options=ne({},Nr.defaults,ee||{}),this.options.inputTarget=this.options.inputTarget||q,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=q,this.input=on(this),this.touchAction=new to(this,this.options.touchAction),ua(this,!0),U(this.options.recognizers,function(de){var Ee=this.add(new de[0](de[1]));de[2]&&Ee.recognizeWith(de[2]),de[3]&&Ee.requireFailure(de[3])},this)}un.prototype={set:function(q){return ne(this.options,q),q.touchAction&&this.touchAction.update(),q.inputTarget&&(this.input.destroy(),this.input.target=q.inputTarget,this.input.init()),this},stop:function(q){this.session.stopped=q?ha:ol},recognize:function(q){var ee=this.session;if(!ee.stopped){this.touchAction.preventDefaults(q);var de,Ee=this.recognizers,$e=ee.curRecognizer;(!$e||$e&&$e.state&bs)&&($e=ee.curRecognizer=null);for(var lt=0;lt<Ee.length;)de=Ee[lt],ee.stopped!==ha&&(!$e||de==$e||de.canRecognizeWith($e))?de.recognize(q):de.reset(),!$e&&de.state&(xr|Vi|Vt)&&($e=ee.curRecognizer=de),lt++}},get:function(q){if(q instanceof lr)return q;for(var ee=this.recognizers,de=0;de<ee.length;de++)if(ee[de].options.event==q)return ee[de];return null},add:function(q){if(N(q,"add",this))return this;var ee=this.get(q.options.event);return ee&&this.remove(ee),this.recognizers.push(q),q.manager=this,this.touchAction.update(),q},remove:function(q){if(N(q,"remove",this))return this;if(q=this.get(q),q){var ee=this.recognizers,de=bt(ee,q);de!==-1&&(ee.splice(de,1),this.touchAction.update())}return this},on:function(q,ee){if(q!==o&&ee!==o){var de=this.handlers;return U(at(q),function(Ee){de[Ee]=de[Ee]||[],de[Ee].push(ee)}),this}},off:function(q,ee){if(q!==o){var de=this.handlers;return U(at(q),function(Ee){ee?de[Ee]&&de[Ee].splice(bt(de[Ee],ee),1):delete de[Ee]}),this}},emit:function(q,ee){this.options.domEvents&&al(q,ee);var de=this.handlers[q]&&this.handlers[q].slice();if(!(!de||!de.length)){ee.type=q,ee.preventDefault=function(){ee.srcEvent.preventDefault()};for(var Ee=0;Ee<de.length;)de[Ee](ee),Ee++}},destroy:function(){this.element&&ua(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function ua(q,ee){var de=q.element;if(de.style){var Ee;U(q.options.cssProps,function($e,lt){Ee=St(de.style,lt),ee?(q.oldCssProps[Ee]=de.style[Ee],de.style[Ee]=$e):de.style[Ee]=q.oldCssProps[Ee]||""}),ee||(q.oldCssProps={})}}function al(q,ee){var de=i.createEvent("Event");de.initEvent(q,!0,!0),de.gesture=ee,ee.target.dispatchEvent(de)}ne(Nr,{INPUT_START:Pi,INPUT_MOVE:$i,INPUT_END:Zt,INPUT_CANCEL:ki,STATE_POSSIBLE:hi,STATE_BEGAN:xr,STATE_CHANGED:Vi,STATE_ENDED:Vt,STATE_RECOGNIZED:bs,STATE_CANCELLED:Fs,STATE_FAILED:Kr,DIRECTION_NONE:Rs,DIRECTION_LEFT:Qi,DIRECTION_RIGHT:oi,DIRECTION_UP:ci,DIRECTION_DOWN:vr,DIRECTION_HORIZONTAL:Ni,DIRECTION_VERTICAL:kr,DIRECTION_ALL:is,Manager:un,Input:Li,TouchAction:to,TouchInput:Bt,MouseInput:Le,PointerEventInput:Tt,TouchMouseInput:Wi,SingleTouchInput:Qt,Recognizer:lr,AttrRecognizer:Yr,Tap:ro,Pan:Ns,Swipe:nl,Pinch:ca,Rotate:sl,Press:rl,on:qe,off:ht,each:U,merge:Ae,extend:xe,assign:ne,inherit:Te,bindFn:Ie,prefixed:St});var vu=typeof e<"u"?e:typeof self<"u"?self:{};vu.Hammer=Nr,t.exports?t.exports=Nr:e[r]=Nr})(window,document,"Hammer")})(n1);var su=n1.exports;const Xn=us({__proto__:null,default:B0(su)},[su]),o1=1,a1=2,am=4,HO={mousedown:o1,mousemove:a1,mouseup:am};function GO(t,e){for(let i=0;i<t.length;i++)if(e(t[i]))return!0;return!1}function $O(t){const e=t.prototype.handler;t.prototype.handler=function(r){const o=this.store;r.button>0&&r.type==="pointerdown"&&(GO(o,u=>u.pointerId===r.pointerId)||o.push(r)),e.call(this,r)}}function WO(t){t.prototype.handler=function(i){let r=HO[i.type];r&o1&&i.button>=0&&(this.pressed=!0),r&a1&&i.buttons===0&&(r=am),this.pressed&&(r&am&&(this.pressed=!1),this.callback(this.manager,r,{pointers:[i],changedPointers:[i],pointerType:"mouse",srcEvent:i}))}}$O(su.PointerEventInput),WO(su.MouseInput);const XO=su.Manager;class bf{constructor(e,i,r){this.element=e,this.callback=i,this.options={enable:!0,...r}}}const qO=Xn?[[Xn.Pan,{event:"tripan",pointers:3,threshold:0,enable:!1}],[Xn.Rotate,{enable:!1}],[Xn.Pinch,{enable:!1}],[Xn.Swipe,{enable:!1}],[Xn.Pan,{threshold:0,enable:!1}],[Xn.Press,{enable:!1}],[Xn.Tap,{event:"doubletap",taps:2,enable:!1}],[Xn.Tap,{event:"anytap",enable:!1}],[Xn.Tap,{enable:!1}]]:null,l1={tripan:["rotate","pinch","pan"],rotate:["pinch"],pinch:["pan"],pan:["press","doubletap","anytap","tap"],doubletap:["anytap"],anytap:["tap"]},ZO={doubletap:["tap"]},KO={pointerdown:"pointerdown",pointermove:"pointermove",pointerup:"pointerup",touchstart:"pointerdown",touchmove:"pointermove",touchend:"pointerup",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup"},lm={KEY_EVENTS:["keydown","keyup"],MOUSE_EVENTS:["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"],WHEEL_EVENTS:["wheel","mousewheel"]},YO={tap:"tap",anytap:"anytap",doubletap:"doubletap",press:"press",pinch:"pinch",pinchin:"pinch",pinchout:"pinch",pinchstart:"pinch",pinchmove:"pinch",pinchend:"pinch",pinchcancel:"pinch",rotate:"rotate",rotatestart:"rotate",rotatemove:"rotate",rotateend:"rotate",rotatecancel:"rotate",tripan:"tripan",tripanstart:"tripan",tripanmove:"tripan",tripanup:"tripan",tripandown:"tripan",tripanleft:"tripan",tripanright:"tripan",tripanend:"tripan",tripancancel:"tripan",pan:"pan",panstart:"pan",panmove:"pan",panup:"pan",pandown:"pan",panleft:"pan",panright:"pan",panend:"pan",pancancel:"pan",swipe:"swipe",swipeleft:"swipe",swiperight:"swipe",swipeup:"swipe",swipedown:"swipe"},c1={click:"tap",anyclick:"anytap",dblclick:"doubletap",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup",mouseover:"pointerover",mouseout:"pointerout",mouseleave:"pointerleave"},JO=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",_c=typeof window<"u"?window:global;let cm=!1;try{const t={get passive(){return cm=!0,!0}};_c.addEventListener("test",null,t),_c.removeEventListener("test",null)}catch{cm=!1}const QO=JO.indexOf("firefox")!==-1,{WHEEL_EVENTS:eF}=lm,h1="wheel",u1=4.000244140625,tF=40,iF=.25;class rF extends bf{constructor(e,i,r){super(e,i,r),this.handleEvent=o=>{if(!this.options.enable)return;let u=o.deltaY;_c.WheelEvent&&(QO&&o.deltaMode===_c.WheelEvent.DOM_DELTA_PIXEL&&(u/=_c.devicePixelRatio),o.deltaMode===_c.WheelEvent.DOM_DELTA_LINE&&(u*=tF)),u!==0&&u%u1===0&&(u=Math.floor(u/u1)),o.shiftKey&&u&&(u=u*iF),this.callback({type:h1,center:{x:o.clientX,y:o.clientY},delta:-u,srcEvent:o,pointerType:"mouse",target:o.target})},this.events=(this.options.events||[]).concat(eF),this.events.forEach(o=>e.addEventListener(o,this.handleEvent,cm?{passive:!1}:!1))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,i){e===h1&&(this.options.enable=i)}}const{MOUSE_EVENTS:sF}=lm,d1="pointermove",f1="pointerover",p1="pointerout",_1="pointerenter",g1="pointerleave";class nF extends bf{constructor(e,i,r){super(e,i,r),this.handleEvent=u=>{this.handleOverEvent(u),this.handleOutEvent(u),this.handleEnterEvent(u),this.handleLeaveEvent(u),this.handleMoveEvent(u)},this.pressed=!1;const{enable:o}=this.options;this.enableMoveEvent=o,this.enableLeaveEvent=o,this.enableEnterEvent=o,this.enableOutEvent=o,this.enableOverEvent=o,this.events=(this.options.events||[]).concat(sF),this.events.forEach(u=>e.addEventListener(u,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,i){e===d1&&(this.enableMoveEvent=i),e===f1&&(this.enableOverEvent=i),e===p1&&(this.enableOutEvent=i),e===_1&&(this.enableEnterEvent=i),e===g1&&(this.enableLeaveEvent=i)}handleOverEvent(e){this.enableOverEvent&&e.type==="mouseover"&&this._emit(f1,e)}handleOutEvent(e){this.enableOutEvent&&e.type==="mouseout"&&this._emit(p1,e)}handleEnterEvent(e){this.enableEnterEvent&&e.type==="mouseenter"&&this._emit(_1,e)}handleLeaveEvent(e){this.enableLeaveEvent&&e.type==="mouseleave"&&this._emit(g1,e)}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":e.buttons===0&&(this.pressed=!1),this.pressed||this._emit(d1,e);break;case"mouseup":this.pressed=!1;break}}_emit(e,i){this.callback({type:e,center:{x:i.clientX,y:i.clientY},srcEvent:i,pointerType:"mouse",target:i.target})}}const{KEY_EVENTS:oF}=lm,m1="keydown",y1="keyup";class aF extends bf{constructor(e,i,r){super(e,i,r),this.handleEvent=o=>{const u=o.target||o.srcElement;u.tagName==="INPUT"&&u.type==="text"||u.tagName==="TEXTAREA"||(this.enableDownEvent&&o.type==="keydown"&&this.callback({type:m1,srcEvent:o,key:o.key,target:o.target}),this.enableUpEvent&&o.type==="keyup"&&this.callback({type:y1,srcEvent:o,key:o.key,target:o.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,this.events=(this.options.events||[]).concat(oF),e.tabIndex=this.options.tabIndex||0,e.style.outline="none",this.events.forEach(o=>e.addEventListener(o,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,i){e===m1&&(this.enableDownEvent=i),e===y1&&(this.enableUpEvent=i)}}const b1="contextmenu";class lF extends bf{constructor(e,i,r){super(e,i,r),this.handleEvent=o=>{this.options.enable&&this.callback({type:b1,center:{x:o.clientX,y:o.clientY},srcEvent:o,pointerType:"mouse",target:o.target})},e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,i){e===b1&&(this.options.enable=i)}}const v1=1,hm=2,x1=4,cF={pointerdown:v1,pointermove:hm,pointerup:x1,mousedown:v1,mousemove:hm,mouseup:x1},hF=0,uF=1,dF=2,fF=1,pF=2,_F=4;function gF(t){const e=cF[t.srcEvent.type];if(!e)return null;const{buttons:i,button:r}=t.srcEvent;let o=!1,u=!1,d=!1;return e===hm?(o=!!(i&fF),u=!!(i&_F),d=!!(i&pF)):(o=r===hF,u=r===uF,d=r===dF),{leftButton:o,middleButton:u,rightButton:d}}function mF(t,e){const i=t.center;if(!i)return null;const r=e.getBoundingClientRect(),o=r.width/e.offsetWidth||1,u=r.height/e.offsetHeight||1,d={x:(i.x-r.left-e.clientLeft)/o,y:(i.y-r.top-e.clientTop)/u};return{center:i,offsetCenter:d}}const um={srcElement:"root",priority:0};class yF{constructor(e){this.handleEvent=i=>{if(this.isEmpty())return;const r=this._normalizeEvent(i);let o=i.srcEvent.target;for(;o&&o!==r.rootElement;){if(this._emit(r,o),r.handled)return;o=o.parentNode}this._emit(r,"root")},this.eventManager=e,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(e,i,r,o=!1,u=!1){const{handlers:d,handlersByElement:a}=this;let x=um;typeof r=="string"||r&&r.addEventListener?x={...um,srcElement:r}:r&&(x={...um,...r});let A=a.get(x.srcElement);A||(A=[],a.set(x.srcElement,A));const M={type:e,handler:i,srcElement:x.srcElement,priority:x.priority};o&&(M.once=!0),u&&(M.passive=!0),d.push(M),this._active=this._active||!M.passive;let D=A.length-1;for(;D>=0&&!(A[D].priority>=M.priority);)D--;A.splice(D+1,0,M)}remove(e,i){const{handlers:r,handlersByElement:o}=this;for(let u=r.length-1;u>=0;u--){const d=r[u];if(d.type===e&&d.handler===i){r.splice(u,1);const a=o.get(d.srcElement);a.splice(a.indexOf(d),1),a.length===0&&o.delete(d.srcElement)}}this._active=r.some(u=>!u.passive)}_emit(e,i){const r=this.handlersByElement.get(i);if(r){let o=!1;const u=()=>{e.handled=!0},d=()=>{e.handled=!0,o=!0},a=[];for(let x=0;x<r.length;x++){const{type:A,handler:M,once:D}=r[x];if(M({...e,type:A,stopPropagation:u,stopImmediatePropagation:d}),D&&a.push(r[x]),o)break}for(let x=0;x<a.length;x++){const{type:A,handler:M}=a[x];this.remove(A,M)}}}_normalizeEvent(e){const i=this.eventManager.getElement();return{...e,...gF(e),...mF(e,i),preventDefault:()=>{e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:i}}}const bF={events:null,recognizers:null,recognizerOptions:{},Manager:XO,touchAction:"none",tabIndex:0};class vF{constructor(e=null,i){this._onBasicInput=o=>{const{srcEvent:u}=o,d=KO[u.type];d&&this.manager.emit(d,o)},this._onOtherEvent=o=>{this.manager.emit(o.type,o)},this.options={...bF,...i},this.events=new Map,this.setElement(e);const{events:r}=this.options;r&&this.on(r)}getElement(){return this.element}setElement(e){if(this.element&&this.destroy(),this.element=e,!e)return;const{options:i}=this,r=i.Manager;this.manager=new r(e,{touchAction:i.touchAction,recognizers:i.recognizers||qO}).on("hammer.input",this._onBasicInput),i.recognizers||Object.keys(l1).forEach(o=>{const u=this.manager.get(o);u&&l1[o].forEach(d=>{u.recognizeWith(d)})});for(const o in i.recognizerOptions){const u=this.manager.get(o);if(u){const d=i.recognizerOptions[o];delete d.enable,u.set(d)}}this.wheelInput=new rF(e,this._onOtherEvent,{enable:!1}),this.moveInput=new nF(e,this._onOtherEvent,{enable:!1}),this.keyInput=new aF(e,this._onOtherEvent,{enable:!1,tabIndex:i.tabIndex}),this.contextmenuInput=new lF(e,this._onOtherEvent,{enable:!1});for(const[o,u]of this.events)u.isEmpty()||(this._toggleRecognizer(u.recognizerName,!0),this.manager.on(o,u.handleEvent))}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy(),this.wheelInput=null,this.moveInput=null,this.keyInput=null,this.contextmenuInput=null,this.manager=null,this.element=null)}on(e,i,r){this._addEventHandler(e,i,r,!1)}once(e,i,r){this._addEventHandler(e,i,r,!0)}watch(e,i,r){this._addEventHandler(e,i,r,!1,!0)}off(e,i){this._removeEventHandler(e,i)}_toggleRecognizer(e,i){const{manager:r}=this;if(!r)return;const o=r.get(e);if(o&&o.options.enable!==i){o.set({enable:i});const u=ZO[e];u&&!this.options.recognizers&&u.forEach(d=>{const a=r.get(d);i?(a.requireFailure(e),o.dropRequireFailure(d)):a.dropRequireFailure(e)})}this.wheelInput.enableEventType(e,i),this.moveInput.enableEventType(e,i),this.keyInput.enableEventType(e,i),this.contextmenuInput.enableEventType(e,i)}_addEventHandler(e,i,r,o,u){if(typeof e!="string"){r=i;for(const M in e)this._addEventHandler(M,e[M],r,o,u);return}const{manager:d,events:a}=this,x=c1[e]||e;let A=a.get(x);A||(A=new yF(this),a.set(x,A),A.recognizerName=YO[x]||x,d&&d.on(x,A.handleEvent)),A.add(e,i,r,o,u),A.isEmpty()||this._toggleRecognizer(A.recognizerName,!0)}_removeEventHandler(e,i){if(typeof e!="string"){for(const d in e)this._removeEventHandler(d,e[d]);return}const{events:r}=this,o=c1[e]||e,u=r.get(o);if(u&&(u.remove(e,i),u.isEmpty())){const{recognizerName:d}=u;let a=!1;for(const x of r.values())if(x.recognizerName===d&&!x.isEmpty()){a=!0;break}a||this._toggleRecognizer(d,!1)}}}function sa(){}const w1={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,parameters:{},parent:null,device:null,deviceProps:{type:"webgl"},gl:null,glOptions:{},canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,widgets:[],onDeviceInitialized:sa,onWebGLInitialized:sa,onResize:sa,onViewStateChange:sa,onInteractionStateChange:sa,onBeforeRender:sa,onAfterRender:sa,onLoad:sa,onError:t=>Yt.error(t.message,t.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:({isDragging:t})=>t?"grabbing":"grab",getTooltip:null,debug:!1,drawPickingColors:!1};class nu{constructor(e){this.width=0,this.height=0,this.userData={},this.device=null,this.canvas=null,this.viewManager=null,this.layerManager=null,this.effectManager=null,this.deckRenderer=null,this.deckPicker=null,this.eventManager=null,this.widgetManager=null,this.tooltip=null,this.animationLoop=null,this.cursorState={isHovering:!1,isDragging:!1},this.stats=new Wl({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this._lastPointerDownInfo=null,this._onPointerMove=r=>{const{_pickRequest:o}=this;if(r.type==="pointerleave")o.x=-1,o.y=-1,o.radius=0;else{if(r.leftButton||r.rightButton)return;{const u=r.offsetCenter;if(!u)return;o.x=u.x,o.y=u.y,o.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:o.x,y:o.y}),o.event=r},this._onEvent=r=>{const o=Sg[r.type],u=r.offsetCenter;if(!o||!u||!this.layerManager)return;const d=this.layerManager.getLayers(),a=this.deckPicker.getLastPickedObject({x:u.x,y:u.y,layers:d,viewports:this.getViewports(u)},this._lastPointerDownInfo),{layer:x}=a,A=x&&(x[o.handler]||x.props[o.handler]),M=this.props[o.handler];let D=!1;A&&(D=A.call(x,a,r)),D||(M==null||M(a,r),this.widgetManager.onEvent(a,r))},this._onPointerDown=r=>{const o=r.offsetCenter,u=this._pick("pickObject","pickObject Time",{x:o.x,y:o.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=u.result[0]||u.emptyInfo},this.props={...w1,...e},e=this.props,e.viewState&&e.initialViewState&&Yt.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),this.viewState=this.props.initialViewState,e.device?this.device=e.device:e.gl&&(e.gl instanceof WebGLRenderingContext&&Yt.error("WebGL1 context not supported.")(),this.device=ru.attach(e.gl));let i=this.device;i||(ql.registerDevices([ru]),i=ql.createDevice({...e.deviceProps,canvas:this._createCanvas(e)})),this.animationLoop=this._createAnimationLoop(i,e),this.setProps(e),e._typedArrayManagerProps&&Hh.setOptions(e._typedArrayManagerProps),this.animationLoop.start()}finalize(){var e,i,r,o,u,d,a,x,A,M;(e=this.animationLoop)==null||e.stop(),(i=this.animationLoop)==null||i.destroy(),this.animationLoop=null,this._lastPointerDownInfo=null,(r=this.layerManager)==null||r.finalize(),this.layerManager=null,(o=this.viewManager)==null||o.finalize(),this.viewManager=null,(u=this.effectManager)==null||u.finalize(),this.effectManager=null,(d=this.deckRenderer)==null||d.finalize(),this.deckRenderer=null,(a=this.deckPicker)==null||a.finalize(),this.deckPicker=null,(x=this.eventManager)==null||x.destroy(),this.eventManager=null,(A=this.widgetManager)==null||A.finalize(),this.widgetManager=null,!this.props.canvas&&!this.props.device&&!this.props.gl&&this.canvas&&((M=this.canvas.parentElement)==null||M.removeChild(this.canvas),this.canvas=null)}setProps(e){var r;this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&Yt.removed("onLayerHover","onHover")(),"onLayerClick"in e&&Yt.removed("onLayerClick","onClick")(),e.initialViewState&&!wn(this.props.initialViewState,e.initialViewState,3)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);const i=Object.create(this.props);Object.assign(i,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),(r=this.animationLoop)==null||r.setProps(i),this.layerManager&&(this.viewManager.setProps(i),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(i),this.effectManager.setProps(i),this.deckRenderer.setProps(i),this.deckPicker.setProps(i),this.widgetManager.setProps(i)),this.stats.get("setProps Time").timeEnd()}needsRedraw(e={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let i=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);const r=this.viewManager.needsRedraw(e),o=this.layerManager.needsRedraw(e),u=this.effectManager.needsRedraw(e),d=this.deckRenderer.needsRedraw(e);return i=i||r||o||u||d,i}redraw(e){if(!this.layerManager)return;let i=this.needsRedraw({clearRedrawFlags:!0});i=e||i,i&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(i):this._drawLayers(i))}get isInitialized(){return this.viewManager!==null}getViews(){return yr(this.viewManager),this.viewManager.views}getViewports(e){return yr(this.viewManager),this.viewManager.getViewports(e)}getCanvas(){return this.canvas}pickObject(e){const i=this._pick("pickObject","pickObject Time",e).result;return i.length?i[0]:null}pickMultipleObjects(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}pickObjects(e){return this._pick("pickObjects","pickObjects Time",e)}_addResources(e,i=!1){for(const r in e)this.layerManager.resourceManager.add({resourceId:r,data:e[r],forceUpdate:i})}_removeResources(e){for(const i of e)this.layerManager.resourceManager.remove(i)}_addDefaultEffect(e){this.effectManager.addDefaultEffect(e)}_addDefaultShaderModule(e){this.layerManager.addDefaultShaderModule(e)}_removeDefaultShaderModule(e){var i;(i=this.layerManager)==null||i.removeDefaultShaderModule(e)}_pick(e,i,r){yr(this.deckPicker);const{stats:o}=this;o.get("Pick Count").incrementCount(),o.get(i).timeStart();const u=this.deckPicker[e]({layers:this.layerManager.getLayers(r),views:this.viewManager.getViews(),viewports:this.getViewports(r),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...r});return o.get(i).timeEnd(),u}_createCanvas(e){let i=e.canvas;return typeof i=="string"&&(i=document.getElementById(i),yr(i)),i||(i=document.createElement("canvas"),i.id=e.id||"deckgl-overlay",(e.parent||document.body).appendChild(i)),Object.assign(i.style,e.style),i}_setCanvasSize(e){var o;if(!this.canvas)return;const{width:i,height:r}=e;if(i||i===0){const u=Number.isFinite(i)?`${i}px`:i;this.canvas.style.width=u}if(r||r===0){const u=Number.isFinite(r)?`${r}px`:r;this.canvas.style.position=((o=e.style)==null?void 0:o.position)||"absolute",this.canvas.style.height=u}}_updateCanvasSize(){var o,u;const{canvas:e}=this;if(!e)return;const i=e.clientWidth??e.width,r=e.clientHeight??e.height;(i!==this.width||r!==this.height)&&(this.width=i,this.height=r,(o=this.viewManager)==null||o.setProps({width:i,height:r}),(u=this.layerManager)==null||u.activateViewport(this.getViewports()[0]),this.props.onResize({width:i,height:r}))}_createAnimationLoop(e,i){const{gl:r,onError:o,useDevicePixels:u}=i;return new W3({device:e,useDevicePixels:u,autoResizeDrawingBuffer:!r,autoResizeViewport:!1,onInitialize:d=>this._setDevice(d.device),onRender:this._onRenderFrame.bind(this),onError:o})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){const{views:e}=this.props,i=Array.isArray(e)?e:e?[e]:[new Gg({id:"default-view"})];return i.length&&this.props.controller&&(i[0].props.controller=this.props.controller),i}_onContextLost(){const{onError:e}=this.props;this.animationLoop&&e&&e(new Error("WebGL context is lost"))}_pickAndCallback(){var i,r,o;const{_pickRequest:e}=this;if(e.event){const{result:u,emptyInfo:d}=this._pick("pickObject","pickObject Time",e);this.cursorState.isHovering=u.length>0;let a=d,x=!1;for(const A of u)a=A,x=((i=A.layer)==null?void 0:i.onHover(A,e.event))||x;x||((o=(r=this.props).onHover)==null||o.call(r,a,e.event),this.widgetManager.onHover(a,e.event)),e.event=null}}_updateCursor(){const e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.cursorState))}_setDevice(e){var o,u;if(this.device=e,!this.animationLoop)return;this.canvas||(this.canvas=(o=this.device.canvasContext)==null?void 0:o.canvas),this.device.setParametersWebGL({blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onDeviceInitialized(this.device),this.device instanceof ru&&this.props.onWebGLInitialized(this.device.gl);const i=new bx;i.play(),this.animationLoop.attachTimeline(i),this.eventManager=new vF(this.props.parent||this.canvas,{touchAction:this.props.touchAction,recognizerOptions:this.props.eventRecognizerOptions,events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const d in Sg)this.eventManager.on(d,this._onEvent);this.viewManager=new hB({timeline:i,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const r=this.viewManager.getViewports()[0];this.layerManager=new cB(this.device,{deck:this,stats:this.stats,viewport:r,timeline:i}),this.effectManager=new CB({deck:this,device:this.device}),this.deckRenderer=new RB(this.device),this.deckPicker=new kB(this.device),this.widgetManager=new UB({deck:this,parentElement:(u=this.canvas)==null?void 0:u.parentElement}),this.widgetManager.addDefault(new VB),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(e,i){var d;const{device:r,gl:o}=this.layerManager.context;this.props.onBeforeRender({device:r,gl:o});const u={target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...i};(d=this.deckRenderer)==null||d.renderLayers(u),u.pass==="screen"&&this.widgetManager.onRedraw({viewports:u.viewports,layers:u.layers}),this.props.onAfterRender({device:r,gl:o})}_onRenderFrame(){this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),Yt.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.layerManager.updateLayers(),this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(e){const i=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState={...this.viewState,[e.viewId]:i},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(e){this.cursorState.isDragging=e.isDragging||!1,this.props.onInteractionStateChange(e)}_getFrameStats(){const{stats:e}=this;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();const i=this.animationLoop.stats;e.get("GPU Time").addTime(i.get("GPU Time").lastTiming),e.get("CPU Time").addTime(i.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:e,stats:i}=this;e.fps=i.get("frameRate").getHz(),e.setPropsTime=i.get("setProps Time").time,e.updateAttributesTime=i.get("Update Attributes").time,e.framesRedrawn=i.get("Redraw Count").count,e.pickTime=i.get("pickObject Time").time+i.get("pickMultipleObjects Time").time+i.get("pickObjects Time").time,e.pickCount=i.get("Pick Count").count,e.gpuTime=i.get("GPU Time").time,e.cpuTime=i.get("CPU Time").time,e.gpuTimePerFrame=i.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=i.get("CPU Time").getAverageTime();const r=ql.stats.get("Memory Usage");e.bufferMemory=r.get("Buffer Memory").count,e.textureMemory=r.get("Texture Memory").count,e.renderbufferMemory=r.get("Renderbuffer Memory").count,e.gpuMemory=r.get("GPU Memory").count}}nu.defaultProps=w1,nu.VERSION=B2;function xF(t){switch(t){case"float64":return Float64Array;case"uint8":case"unorm8":return Uint8ClampedArray;default:return tv(t)}}const wF=ev;function vf(t,e){return{attribute:t,format:e.size>1?`${e.type}x${e.size}`:e.type,byteOffset:e.offset||0}}function Za(t){return t.stride||t.size*t.bytesPerElement}function TF(t,e){return t.type===e.type&&t.size===e.size&&Za(t)===Za(e)&&(t.offset||0)===(e.offset||0)}function dm(t,e){e.offset&&Yt.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const i=Za(t),r=e.vertexOffset!==void 0?e.vertexOffset:t.vertexOffset||0,o=e.elementOffset||0,u=r*i+o*t.bytesPerElement+(t.offset||0);return{...e,offset:u,stride:i}}function AF(t,e){const i=dm(t,e);return{high:i,low:{...i,offset:i.offset+t.size*4}}}class EF{constructor(e,i,r){this._buffer=null,this.device=e,this.id=i.id||"",this.size=i.size||1;const o=i.logicalType||i.type,u=o==="float64";let{defaultValue:d}=i;d=Number.isFinite(d)?[d]:d||new Array(this.size).fill(0);let a;u?a="float32":!o&&i.isIndexed?a="uint32":a=o||"float32";let x=xF(o||a);this.doublePrecision=u,u&&i.fp64===!1&&(x=Float32Array),this.value=null,this.settings={...i,defaultType:x,defaultValue:d,logicalType:o,type:a,normalized:a.includes("norm"),size:this.size,bytesPerElement:x.BYTES_PER_ELEMENT},this.state={...r,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1}}get isConstant(){return this.state.constant}get buffer(){return this._buffer}get byteOffset(){const e=this.getAccessor();return e.vertexOffset?e.vertexOffset*Za(e):0}get numInstances(){return this.state.numInstances}set numInstances(e){this.state.numInstances=e}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),Hh.release(this.state.allocatedValue)}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(e=this.id,i=null){const r={};if(this.state.constant){const o=this.value;if(i){const u=dm(this.getAccessor(),i),d=u.offset/o.BYTES_PER_ELEMENT,a=u.size||this.size;r[e]=o.subarray(d,d+a)}else r[e]=o}else r[e]=this.getBuffer();return this.doublePrecision&&(this.value instanceof Float64Array?r[`${e}64Low`]=r[e]:r[`${e}64Low`]=new Float32Array(this.size)),r}_getBufferLayout(e=this.id,i=null){const r=this.getAccessor(),o=[],u={name:this.id,byteStride:Za(r),attributes:o};if(this.doublePrecision){const d=AF(r,i||{});o.push(vf(e,{...r,...d.high}),vf(`${e}64Low`,{...r,...d.low}))}else if(i){const d=dm(r,i);o.push(vf(e,{...r,...d}))}else o.push(vf(e,r));return u}setAccessor(e){this.state.bufferAccessor=e}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let e=null;if(this.state.constant&&this.value){const i=Array.from(this.value);e=[i,i]}else{const{value:i,numInstances:r,size:o}=this,u=r*o;if(i&&u&&i.length>=u){const d=new Array(o).fill(1/0),a=new Array(o).fill(-1/0);for(let x=0;x<u;)for(let A=0;A<o;A++){const M=i[x++];M<d[A]&&(d[A]=M),M>a[A]&&(a[A]=M)}e=[d,a]}}return this.state.bounds=e,e}setData(e){const{state:i}=this;let r;ArrayBuffer.isView(e)?r={value:e}:e instanceof Fi?r={buffer:e}:r=e;const o={...this.settings,...r};if(ArrayBuffer.isView(r.value)){if(!r.type)if(this.doublePrecision&&r.value instanceof Float64Array)o.type="float32";else{const d=wF(r.value);o.type=o.normalized?d.replace("int","norm"):d}o.bytesPerElement=r.value.BYTES_PER_ELEMENT,o.stride=Za(o)}if(i.bounds=null,r.constant){let u=r.value;if(u=this._normalizeValue(u,[],0),this.settings.normalized&&(u=this.normalizeConstant(u)),!(!i.constant||!this._areValuesEqual(u,this.value)))return!1;i.externalBuffer=null,i.constant=!0,this.value=ArrayBuffer.isView(u)?u:new Float32Array(u)}else if(r.buffer){const u=r.buffer;i.externalBuffer=u,i.constant=!1,this.value=r.value||null}else if(r.value){this._checkExternalBuffer(r);let u=r.value;i.externalBuffer=null,i.constant=!1,this.value=u;let{buffer:d}=this;const a=Za(o),x=(o.vertexOffset||0)*a;if(this.doublePrecision&&u instanceof Float64Array&&(u=kg(u,o)),this.settings.isIndexed){const M=this.settings.defaultType;u.constructor!==M&&(u=new M(u))}const A=u.byteLength+x+a*2;(!d||d.byteLength<A)&&(d=this._createBuffer(A)),d.write(u,x)}return this.setAccessor(o),!0}updateSubBuffer(e={}){this.state.bounds=null;const i=this.value,{startOffset:r=0,endOffset:o}=e;this.buffer.write(this.doublePrecision&&i instanceof Float64Array?kg(i,{size:this.size,startIndex:r,endIndex:o}):i.subarray(r,o),r*i.BYTES_PER_ELEMENT+this.byteOffset)}allocate(e,i=!1){const{state:r}=this,o=r.allocatedValue,u=Hh.allocate(o,e+1,{size:this.size,type:this.settings.defaultType,copy:i});this.value=u;const{byteOffset:d}=this;let{buffer:a}=this;return(!a||a.byteLength<u.byteLength+d)&&(a=this._createBuffer(u.byteLength+d),i&&o&&a.write(o instanceof Float64Array?kg(o,this):o,d)),r.allocatedValue=u,r.constant=!1,r.externalBuffer=null,this.setAccessor(this.settings),!0}_checkExternalBuffer(e){const{value:i}=e;if(!ArrayBuffer.isView(i))throw new Error(`Attribute ${this.id} value is not TypedArray`);const r=this.settings.defaultType;let o=!1;if(this.doublePrecision&&(o=i.BYTES_PER_ELEMENT<4),o)throw new Error(`Attribute ${this.id} does not support ${i.constructor.name}`);!(i instanceof r)&&this.settings.normalized&&!("normalized"in e)&&Yt.warn(`Attribute ${this.id} is normalized`)()}normalizeConstant(e){switch(this.settings.type){case"snorm8":return new Float32Array(e).map(i=>(i+128)/255*2-1);case"snorm16":return new Float32Array(e).map(i=>(i+32768)/65535*2-1);case"unorm8":return new Float32Array(e).map(i=>i/255);case"unorm16":return new Float32Array(e).map(i=>i/65535);default:return e}}_normalizeValue(e,i,r){const{defaultValue:o,size:u}=this.settings;if(Number.isFinite(e))return i[r]=e,i;if(!e){let d=u;for(;--d>=0;)i[r+d]=o[d];return i}switch(u){case 4:i[r+3]=Number.isFinite(e[3])?e[3]:o[3];case 3:i[r+2]=Number.isFinite(e[2])?e[2]:o[2];case 2:i[r+1]=Number.isFinite(e[1])?e[1]:o[1];case 1:i[r+0]=Number.isFinite(e[0])?e[0]:o[0];break;default:let d=u;for(;--d>=0;)i[r+d]=Number.isFinite(e[d])?e[d]:o[d]}return i}_areValuesEqual(e,i){if(!e||!i)return!1;const{size:r}=this;for(let o=0;o<r;o++)if(e[o]!==i[o])return!1;return!0}_createBuffer(e){var o;this._buffer&&this._buffer.destroy();const{isIndexed:i,type:r}=this.settings;return this._buffer=this.device.createBuffer({...(o=this._buffer)==null?void 0:o.props,id:this.id,usage:i?Fi.INDEX:Fi.VERTEX,indexType:i?r:void 0,byteLength:e}),this._buffer}}const T1=[],A1=[];function E1(t,e=0,i=1/0){let r=T1;const o={index:-1,data:t,target:[]};return t?typeof t[Symbol.iterator]=="function"?r=t:t.length>0&&(A1.length=t.length,r=A1):r=T1,(e>0||Number.isFinite(i))&&(r=(Array.isArray(r)?r:Array.from(r)).slice(e,i),o.index=e-1),{iterable:r,objectInfo:o}}function S1(t){return t&&t[Symbol.asyncIterator]}function SF(t,e){const{size:i,stride:r,offset:o,startIndices:u,nested:d}=e,a=t.BYTES_PER_ELEMENT,x=r?r/a:i,A=o?o/a:0,M=Math.floor((t.length-A)/x);return(D,{index:N,target:U})=>{if(!u){const Ae=N*x+A;for(let Te=0;Te<i;Te++)U[Te]=t[Ae+Te];return U}const re=u[N],ne=u[N+1]||M;let xe;if(d){xe=new Array(ne-re);for(let Ae=re;Ae<ne;Ae++){const Te=Ae*x+A;U=new Array(i);for(let Ie=0;Ie<i;Ie++)U[Ie]=t[Te+Ie];xe[Ae-re]=U}}else if(x===i)xe=t.subarray(re*i+A,ne*i+A);else{xe=new t.constructor((ne-re)*i);let Ae=0;for(let Te=re;Te<ne;Te++){const Ie=Te*x+A;for(let Ue=0;Ue<i;Ue++)xe[Ae++]=t[Ie+Ue]}}return xe}}const CF=[],xf=[[0,1/0]];function IF(t,e){if(t===xf||(e[0]<0&&(e[0]=0),e[0]>=e[1]))return t;const i=[],r=t.length;let o=0;for(let u=0;u<r;u++){const d=t[u];d[1]<e[0]?(i.push(d),o=u+1):d[0]>e[1]?i.push(d):e=[Math.min(d[0],e[0]),Math.max(d[1],e[1])]}return i.splice(o,0,e),i}const MF={interpolation:{duration:0,easing:t=>t},spring:{stiffness:.05,damping:.5}};function C1(t,e){if(!t)return null;Number.isFinite(t)&&(t={type:"interpolation",duration:t});const i=t.type||"interpolation";return{...MF[i],...e,...t,type:i}}class I1 extends EF{constructor(e,i){super(e,i,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,layoutChanged:!1,updateRanges:xf}),this.constant=!1,this.settings.update=i.update||(i.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(e){this.state.startIndices=e}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:e=!1}={}){const i=this.state.needsRedraw;return this.state.needsRedraw=i&&!e,i}layoutChanged(){return this.state.layoutChanged}setAccessor(e){var i;(i=this.state).layoutChanged||(i.layoutChanged=!TF(e,this.getAccessor())),super.setAccessor(e)}getUpdateTriggers(){const{accessor:e}=this.settings;return[this.id].concat(typeof e!="function"&&e||[])}supportsTransition(){return!!this.settings.transition}getTransitionSetting(e){if(!e||!this.supportsTransition())return null;const{accessor:i}=this.settings,r=this.settings.transition,o=Array.isArray(i)?e[i.find(u=>e[u])]:e[i];return C1(o,r)}setNeedsUpdate(e=this.id,i){if(this.state.needsUpdate=this.state.needsUpdate||e,this.setNeedsRedraw(e),i){const{startRow:r=0,endRow:o=1/0}=i;this.state.updateRanges=IF(this.state.updateRanges,[r,o])}else this.state.updateRanges=xf}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=CF}setNeedsRedraw(e=this.id){this.state.needsRedraw=this.state.needsRedraw||e}allocate(e){const{state:i,settings:r}=this;return r.noAlloc?!1:r.update?(super.allocate(e,i.updateRanges!==xf),!0):!1}updateBuffer({numInstances:e,data:i,props:r,context:o}){if(!this.needsUpdate())return!1;const{state:{updateRanges:u},settings:{update:d,noAlloc:a}}=this;let x=!0;if(d){for(const[A,M]of u)d.call(o,this,{data:i,startRow:A,endRow:M,props:r,numInstances:e});if(this.value)if(this.constant||!this.buffer||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[A,M]of u){const D=Number.isFinite(A)?this.getVertexOffset(A):0,N=Number.isFinite(M)?this.getVertexOffset(M):a||!Number.isFinite(e)?this.value.length:e*this.size;super.updateSubBuffer({startOffset:D,endOffset:N})}this._checkAttributeArray()}else x=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),x}setConstantValue(e){return e===void 0||typeof e=="function"?!1:(this.setData({constant:!0,value:e})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}setExternalBuffer(e){const{state:i}=this;return e?(this.clearNeedsUpdate(),i.lastExternalBuffer===e||(i.lastExternalBuffer=e,this.setNeedsRedraw(),this.setData(e)),!0):(i.lastExternalBuffer=null,!1)}setBinaryValue(e,i=null){const{state:r,settings:o}=this;if(!e)return r.binaryValue=null,r.binaryAccessor=null,!1;if(o.noAlloc)return!1;if(r.binaryValue===e)return this.clearNeedsUpdate(),!0;if(r.binaryValue=e,this.setNeedsRedraw(),o.transform||i!==this.startIndices){ArrayBuffer.isView(e)&&(e={value:e});const d=e;yr(ArrayBuffer.isView(d.value),`invalid ${o.accessor}`);const a=!!d.size&&d.size!==this.size;return r.binaryAccessor=SF(d.value,{size:d.size||this.size,stride:d.stride,offset:d.offset,startIndices:i,nested:a}),!1}return this.clearNeedsUpdate(),this.setData(e),!0}getVertexOffset(e){const{startIndices:i}=this;return(i?e<i.length?i[e]:this.numInstances:e)*this.size}getValue(){const e=this.settings.shaderAttributes,i=super.getValue();if(!e)return i;for(const r in e)Object.assign(i,super.getValue(r,e[r]));return i}getBufferLayout(e){this.state.layoutChanged=!1;const i=this.settings.shaderAttributes,r=super._getBufferLayout(),{stepMode:o}=this.settings;if(o==="dynamic"?r.stepMode=e?e.isInstanced?"instance":"vertex":"instance":r.stepMode=o??"vertex",!i)return r;for(const u in i){const d=super._getBufferLayout(u,i[u]);r.attributes.push(...d.attributes)}return r}_autoUpdater(e,{data:i,startRow:r,endRow:o,props:u,numInstances:d}){if(e.constant)return;const{settings:a,state:x,value:A,size:M,startIndices:D}=e,{accessor:N,transform:U}=a,re=x.binaryAccessor||(typeof N=="function"?N:u[N]);yr(typeof re=="function",`accessor "${N}" is not a function`);let ne=e.getVertexOffset(r);const{iterable:xe,objectInfo:Ae}=E1(i,r,o);for(const Te of xe){Ae.index++;let Ie=re(Te,Ae);if(U&&(Ie=U.call(this,Ie)),D){const Ue=(Ae.index<D.length-1?D[Ae.index+1]:d)-D[Ae.index];if(Ie&&Array.isArray(Ie[0])){let Xe=ne;for(const qe of Ie)e._normalizeValue(qe,A,Xe),Xe+=M}else Ie&&Ie.length>M?A.set(Ie,ne):(e._normalizeValue(Ie,Ae.target,0),sB({target:A,source:Ae.target,start:ne,count:Ue}));ne+=Ue*M}else e._normalizeValue(Ie,A,ne),ne+=M}}_validateAttributeUpdaters(){const{settings:e}=this;if(!(e.noAlloc||typeof e.update=="function"))throw new Error(`Attribute ${this.id} missing update or accessor`)}_checkAttributeArray(){const{value:e}=this,i=Math.min(4,this.size);if(e&&e.length>=i){let r=!0;switch(i){case 4:r=r&&Number.isFinite(e[3]);case 3:r=r&&Number.isFinite(e[2]);case 2:r=r&&Number.isFinite(e[1]);case 1:r=r&&Number.isFinite(e[0]);break;default:r=!1}if(!r)throw new Error(`Illegal attribute generated for ${this.id}`)}}}function fm(t){const{source:e,target:i,start:r=0,size:o,getData:u}=t,d=t.end||i.length,a=e.length,x=d-r;if(a>x){i.set(e.subarray(0,x),r);return}if(i.set(e,r),!u)return;let A=a;for(;A<x;){const M=u(A,e);for(let D=0;D<o;D++)i[r+A]=M[D]||0,A++}}function RF({source:t,target:e,size:i,getData:r,sourceStartIndices:o,targetStartIndices:u}){if(!o||!u)return fm({source:t,target:e,size:i,getData:r}),e;let d=0,a=0;const x=r&&((M,D)=>r(M+a,D)),A=Math.min(o.length,u.length);for(let M=1;M<A;M++){const D=o[M]*i,N=u[M]*i;fm({source:t.subarray(d,D),target:e,start:a,end:N,size:i,getData:x}),d=D,a=N}return a<e.length&&fm({source:[],target:e,start:a,size:i,getData:x}),e}function PF(t){const{device:e,settings:i,value:r}=t,o=new I1(e,i);return o.setData({value:r instanceof Float64Array?new Float64Array(0):new Float32Array(0),normalized:i.normalized}),o}function M1(t){switch(t){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`No defined attribute type for size "${t}"`)}}function R1(t){switch(t){case 1:return"float32";case 2:return"float32x2";case 3:return"float32x3";case 4:return"float32x4";default:throw new Error("invalid type size")}}function P1(t){t.push(t.shift())}function BF(t,e){const{doublePrecision:i,settings:r,value:o,size:u}=t,d=i&&o instanceof Float64Array?2:1;let a=0;const{shaderAttributes:x}=t.settings;if(x)for(const A of Object.values(x))a=Math.max(a,A.vertexOffset??0);return(r.noAlloc?o.length:(e+a)*u)*d}function B1({device:t,source:e,target:i}){return(!i||i.byteLength<e.byteLength)&&(i==null||i.destroy(),i=t.createBuffer({byteLength:e.byteLength,usage:e.usage})),i}function D1({device:t,buffer:e,attribute:i,fromLength:r,toLength:o,fromStartIndices:u,getData:d=a=>a}){const a=i.doublePrecision&&i.value instanceof Float64Array?2:1,x=i.size*a,A=i.byteOffset,M=i.settings.bytesPerElement<4?A/i.settings.bytesPerElement*4:A,D=i.startIndices,N=u&&D,U=i.isConstant;if(!N&&e&&r>=o)return e;const re=i.value instanceof Float64Array?Float32Array:i.value.constructor,ne=U?i.value:new re(i.getBuffer().readSyncWebGL(A,o*re.BYTES_PER_ELEMENT).buffer);if(i.settings.normalized&&!U){const Ie=d;d=(Ue,Xe)=>i.normalizeConstant(Ie(Ue,Xe))}const xe=U?(Ie,Ue)=>d(ne,Ue):(Ie,Ue)=>d(ne.subarray(Ie+A,Ie+A+x),Ue),Ae=e?new Float32Array(e.readSyncWebGL(M,r*4).buffer):new Float32Array(0),Te=new Float32Array(o);return RF({source:Ae,target:Te,sourceStartIndices:u,targetStartIndices:D,size:x,getData:xe}),(!e||e.byteLength<Te.byteLength+M)&&(e==null||e.destroy(),e=t.createBuffer({byteLength:Te.byteLength+M,usage:35050})),e.write(Te,M),e}class O1{constructor({device:e,attribute:i,timeline:r}){this.buffers=[],this.currentLength=0,this.device=e,this.transition=new uf(r),this.attribute=i,this.attributeInTransition=PF(i),this.currentStartIndices=i.startIndices}get inProgress(){return this.transition.inProgress}start(e,i,r=1/0){this.settings=e,this.currentStartIndices=this.attribute.startIndices,this.currentLength=BF(this.attribute,i),this.transition.start({...e,duration:r})}update(){const e=this.transition.update();return e&&this.onUpdate(),e}setBuffer(e){this.attributeInTransition.setData({buffer:e,normalized:this.attribute.settings.normalized,value:this.attributeInTransition.value})}cancel(){this.transition.cancel()}delete(){this.cancel();for(const e of this.buffers)e.destroy();this.buffers.length=0}}class DF extends O1{constructor({device:e,attribute:i,timeline:r}){super({device:e,attribute:i,timeline:r}),this.type="interpolation",this.transform=kF(e,i)}start(e,i){const r=this.currentLength,o=this.currentStartIndices;if(super.start(e,i,e.duration),e.duration<=0){this.transition.cancel();return}const{buffers:u,attribute:d}=this;P1(u),u[0]=D1({device:this.device,buffer:u[0],attribute:d,fromLength:r,toLength:this.currentLength,fromStartIndices:o,getData:e.enter}),u[1]=B1({device:this.device,source:u[0],target:u[1]}),this.setBuffer(u[1]);const{transform:a}=this,x=a.model;let A=Math.floor(this.currentLength/d.size);F1(d)&&(A/=2),x.setVertexCount(A),d.isConstant?(x.setAttributes({aFrom:u[0]}),x.setConstantAttributes({aTo:d.value})):x.setAttributes({aFrom:u[0],aTo:d.getBuffer()}),a.transformFeedback.setBuffers({vCurrent:u[1]})}onUpdate(){const{duration:e,easing:i}=this.settings,{time:r}=this.transition;let o=r/e;i&&(o=i(o));const{model:u}=this.transform;u.setUniforms({time:o}),this.transform.run({discard:!0})}delete(){super.delete(),this.transform.destroy()}}const OF=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

uniform float time;
in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, time);
  gl_Position = vec4(0.0);
}
`,FF=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

uniform float time;
in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aFrom64Low;
in ATTRIBUTE_TYPE aTo;
in ATTRIBUTE_TYPE aTo64Low;
out ATTRIBUTE_TYPE vCurrent;
out ATTRIBUTE_TYPE vCurrent64Low;

vec2 mix_fp64(vec2 a, vec2 b, float x) {
  vec2 range = sub_fp64(b, a);
  return sum_fp64(a, mul_fp64(range, vec2(x, 0.0)));
}

void main(void) {
  for (int i=0; i<ATTRIBUTE_SIZE; i++) {
    vec2 value = mix_fp64(vec2(aFrom[i], aFrom64Low[i]), vec2(aTo[i], aTo64Low[i]), time);
    vCurrent[i] = value.x;
    vCurrent64Low[i] = value.y;
  }
  gl_Position = vec4(0.0);
}
`;function F1(t){return t.doublePrecision&&t.value instanceof Float64Array}function kF(t,e){const i=e.size,r=M1(i),o=R1(i),u=e.getBufferLayout();return F1(e)?new Xh(t,{vs:FF,bufferLayout:[{name:"aFrom",byteStride:8*i,attributes:[{attribute:"aFrom",format:o,byteOffset:0},{attribute:"aFrom64Low",format:o,byteOffset:4*i}]},{name:"aTo",byteStride:8*i,attributes:[{attribute:"aTo",format:o,byteOffset:0},{attribute:"aTo64Low",format:o,byteOffset:4*i}]}],modules:[QM],defines:{ATTRIBUTE_TYPE:r,ATTRIBUTE_SIZE:i},moduleSettings:{},varyings:["vCurrent","vCurrent64Low"],bufferMode:35980,disableWarnings:!0}):new Xh(t,{vs:OF,bufferLayout:[{name:"aFrom",format:o},{name:"aTo",format:u.attributes[0].format}],defines:{ATTRIBUTE_TYPE:r},varyings:["vCurrent"],disableWarnings:!0})}class NF extends O1{constructor({device:e,attribute:i,timeline:r}){super({device:e,attribute:i,timeline:r}),this.type="spring",this.texture=VF(e),this.framebuffer=jF(e,this.texture),this.transform=zF(e,i)}start(e,i){const r=this.currentLength,o=this.currentStartIndices;super.start(e,i);const{buffers:u,attribute:d}=this;for(let x=0;x<2;x++)u[x]=D1({device:this.device,buffer:u[x],attribute:d,fromLength:r,toLength:this.currentLength,fromStartIndices:o,getData:e.enter});u[2]=B1({device:this.device,source:u[0],target:u[2]}),this.setBuffer(u[1]);const{model:a}=this.transform;a.setVertexCount(Math.floor(this.currentLength/d.size)),d.isConstant?a.setConstantAttributes({aTo:d.value}):a.setAttributes({aTo:d.getBuffer()})}onUpdate(){const{buffers:e,transform:i,framebuffer:r,transition:o}=this,u=this.settings;i.model.setAttributes({aPrev:e[0],aCur:e[1]}),i.transformFeedback.setBuffers({vNext:e[2]}),i.model.setUniforms({stiffness:u.stiffness,damping:u.damping}),i.run({framebuffer:r,discard:!1,parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]}),P1(e),this.setBuffer(e[1]),this.device.readPixelsToArrayWebGL(r)[0]>0||o.end()}delete(){super.delete(),this.transform.destroy(),this.texture.destroy(),this.framebuffer.destroy()}}const LF=`#version 300 es
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

uniform float stiffness;
uniform float damping;
in ATTRIBUTE_TYPE aPrev;
in ATTRIBUTE_TYPE aCur;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vNext;
out float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE spring = delta * stiffness;
  ATTRIBUTE_TYPE damper = velocity * -1.0 * damping;
  return spring + damper + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,UF=`#version 300 es
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

in float vIsTransitioningFlag;

out vec4 fragColor;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  fragColor = vec4(1.0);
}`;function zF(t,e){const i=M1(e.size),r=R1(e.size);return new Xh(t,{vs:LF,fs:UF,bufferLayout:[{name:"aPrev",format:r},{name:"aCur",format:r},{name:"aTo",format:e.getBufferLayout().attributes[0].format}],varyings:["vNext"],defines:{ATTRIBUTE_TYPE:i},parameters:{depthCompare:"always",blendColorOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaOperation:"max",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}})}function VF(t){return t.createTexture({data:new Uint8Array(4),format:"rgba8unorm",mipmaps:!1,width:1,height:1})}function jF(t,e){return t.createFramebuffer({id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,colorAttachments:[e]})}const HF={interpolation:DF,spring:NF};class GF{constructor(e,{id:i,timeline:r}){if(!e)throw new Error("AttributeTransitionManager is constructed without device");this.id=i,this.device=e,this.timeline=r,this.transitions={},this.needsRedraw=!1,this.numInstances=1}finalize(){for(const e in this.transitions)this._removeTransition(e)}update({attributes:e,transitions:i,numInstances:r}){this.numInstances=r||1;for(const o in e){const u=e[o],d=u.getTransitionSetting(i);d&&this._updateAttribute(o,u,d)}for(const o in this.transitions){const u=e[o];(!u||!u.getTransitionSetting(i))&&this._removeTransition(o)}}hasAttribute(e){const i=this.transitions[e];return i&&i.inProgress}getAttributes(){const e={};for(const i in this.transitions){const r=this.transitions[i];r.inProgress&&(e[i]=r.attributeInTransition)}return e}run(){if(this.numInstances===0)return!1;for(const i in this.transitions)this.transitions[i].update()&&(this.needsRedraw=!0);const e=this.needsRedraw;return this.needsRedraw=!1,e}_removeTransition(e){this.transitions[e].delete(),delete this.transitions[e]}_updateAttribute(e,i,r){const o=this.transitions[e];let u=!o||o.type!==r.type;if(u){o&&this._removeTransition(e);const d=HF[r.type];d?this.transitions[e]=new d({attribute:i,timeline:this.timeline,device:this.device}):(Yt.error(`unsupported transition type '${r.type}'`)(),u=!1)}(u||i.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(r,this.numInstances))}}const k1="attributeManager.invalidate",$F="attributeManager.updateStart",WF="attributeManager.updateEnd",XF="attribute.updateStart",qF="attribute.allocate",ZF="attribute.updateEnd";class KF{constructor(e,{id:i="attribute-manager",stats:r,timeline:o}={}){this.mergeBoundsMemoized=Vh(F3),this.id=i,this.device=e,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=r,this.attributeTransitionManager=new GF(e,{id:`${i}-transitions`,timeline:o}),Object.seal(this)}finalize(){for(const e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(e={clearRedrawFlags:!1}){const i=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,i&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(e){this._add(e)}addInstanced(e){this._add(e,{stepMode:"instance"})}remove(e){for(const i of e)this.attributes[i]!==void 0&&(this.attributes[i].delete(),delete this.attributes[i])}invalidate(e,i){const r=this._invalidateTrigger(e,i);Wr(k1,this,e,r)}invalidateAll(e){for(const i in this.attributes)this.attributes[i].setNeedsUpdate(i,e);Wr(k1,this,"all")}update({data:e,numInstances:i,startIndices:r=null,transitions:o,props:u={},buffers:d={},context:a={}}){let x=!1;Wr($F,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const A in this.attributes){const M=this.attributes[A],D=M.settings.accessor;M.startIndices=r,M.numInstances=i,u[A]&&Yt.removed(`props.${A}`,`data.attributes.${A}`)(),M.setExternalBuffer(d[A])||M.setBinaryValue(typeof D=="string"?d[D]:void 0,e.startIndices)||typeof D=="string"&&!d[D]&&M.setConstantValue(u[D])||M.needsUpdate()&&(x=!0,this._updateAttribute({attribute:M,numInstances:i,data:e,props:u,context:a})),this.needsRedraw=this.needsRedraw||M.needsRedraw()}x&&Wr(WF,this,i),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:i,transitions:o})}updateTransition(){const{attributeTransitionManager:e}=this,i=e.run();return this.needsRedraw=this.needsRedraw||i,i}getAttributes(){return{...this.attributes,...this.attributeTransitionManager.getAttributes()}}getBounds(e){const i=e.map(r=>{var o;return(o=this.attributes[r])==null?void 0:o.getBounds()});return this.mergeBoundsMemoized(i)}getChangedAttributes(e={clearChangedFlags:!1}){const{attributes:i,attributeTransitionManager:r}=this,o={...r.getAttributes()};for(const u in i){const d=i[u];d.needsRedraw(e)&&!r.hasAttribute(u)&&(o[u]=d)}return o}getBufferLayouts(e){return Object.values(this.getAttributes()).map(i=>i.getBufferLayout(e))}_add(e,i){for(const r in e){const o=e[r],u={...o,id:r,size:o.isIndexed&&1||o.size||1,...i};this.attributes[r]=new I1(this.device,u)}this._mapUpdateTriggersToAttributes()}_mapUpdateTriggersToAttributes(){const e={};for(const i in this.attributes)this.attributes[i].getUpdateTriggers().forEach(o=>{e[o]||(e[o]=[]),e[o].push(i)});this.updateTriggers=e}_invalidateTrigger(e,i){const{attributes:r,updateTriggers:o}=this,u=o[e];return u&&u.forEach(d=>{const a=r[d];a&&a.setNeedsUpdate(a.id,i)}),u}_updateAttribute(e){const{attribute:i,numInstances:r}=e;if(Wr(XF,i),i.constant){i.setConstantValue(i.value);return}i.allocate(r)&&Wr(qF,i,r),i.updateBuffer(e)&&(this.needsRedraw=!0,Wr(ZF,i,r))}}class YF extends uf{get value(){return this._value}_onUpdate(){const{time:e,settings:{fromValue:i,toValue:r,duration:o,easing:u}}=this,d=u(e/o);this._value=qd(i,r,d)}}const N1=1e-5;function L1(t,e,i,r,o){const u=e-t,a=(i-e)*o,x=-u*r;return a+x+u+e}function JF(t,e,i,r,o){if(Array.isArray(i)){const u=[];for(let d=0;d<i.length;d++)u[d]=L1(t[d],e[d],i[d],r,o);return u}return L1(t,e,i,r,o)}function U1(t,e){if(Array.isArray(t)){let i=0;for(let r=0;r<t.length;r++){const o=t[r]-e[r];i+=o*o}return Math.sqrt(i)}return Math.abs(t-e)}class QF extends uf{get value(){return this._currValue}_onUpdate(){const{fromValue:e,toValue:i,damping:r,stiffness:o}=this.settings,{_prevValue:u=e,_currValue:d=e}=this;let a=JF(u,d,i,r,o);const x=U1(a,i),A=U1(a,d);x<N1&&A<N1&&(a=i,this.end()),this._prevValue=d,this._currValue=a}}const ek={interpolation:YF,spring:QF};class tk{constructor(e){this.transitions=new Map,this.timeline=e}get active(){return this.transitions.size>0}add(e,i,r,o){const{transitions:u}=this;if(u.has(e)){const x=u.get(e),{value:A=x.settings.fromValue}=x;i=A,this.remove(e)}if(o=C1(o),!o)return;const d=ek[o.type];if(!d){Yt.error(`unsupported transition type '${o.type}'`)();return}const a=new d(this.timeline);a.start({...o,fromValue:i,toValue:r}),u.set(e,a)}remove(e){const{transitions:i}=this;i.has(e)&&(i.get(e).cancel(),i.delete(e))}update(){const e={};for(const[i,r]of this.transitions)r.update(),e[i]=r.value,r.inProgress||this.remove(i);return e}clear(){for(const e of this.transitions.keys())this.remove(e)}}function ik(t){const e=t[Ko];for(const i in e){const r=e[i],{validate:o}=r;if(o&&!o(t[i],r))throw new Error(`Invalid prop ${i}: ${t[i]}`)}}function rk(t,e){const i=z1({newProps:t,oldProps:e,propTypes:t[Ko],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),r=nk(t,e);let o=!1;return r||(o=ok(t,e)),{dataChanged:r,propsChanged:i,updateTriggersChanged:o,extensionsChanged:ak(t,e),transitionsChanged:sk(t,e)}}function sk(t,e){if(!t.transitions)return!1;const i={},r=t[Ko];let o=!1;for(const u in t.transitions){const d=r[u],a=d&&d.type;(a==="number"||a==="color"||a==="array")&&pm(t[u],e[u],d)&&(i[u]=!0,o=!0)}return o?i:!1}function z1({newProps:t,oldProps:e,ignoreProps:i={},propTypes:r={},triggerName:o="props"}){if(e===t)return!1;if(typeof t!="object"||t===null)return`${o} changed shallowly`;if(typeof e!="object"||e===null)return`${o} changed shallowly`;for(const u of Object.keys(t))if(!(u in i)){if(!(u in e))return`${o}.${u} added`;const d=pm(t[u],e[u],r[u]);if(d)return`${o}.${u} ${d}`}for(const u of Object.keys(e))if(!(u in i)){if(!(u in t))return`${o}.${u} dropped`;if(!Object.hasOwnProperty.call(t,u)){const d=pm(t[u],e[u],r[u]);if(d)return`${o}.${u} ${d}`}}return!1}function pm(t,e,i){let r=i&&i.equal;return r&&!r(t,e,i)||!r&&(r=t&&e&&t.equals,r&&!r.call(t,e))?"changed deeply":!r&&e!==t?"changed shallowly":null}function nk(t,e){if(e===null)return"oldProps is null, initial diff";let i=!1;const{dataComparator:r,_dataDiff:o}=t;return r?r(t.data,e.data)||(i="Data comparator detected a change"):t.data!==e.data&&(i="A new data container was supplied"),i&&o&&(i=o(t.data,e.data)||i),i}function ok(t,e){if(e===null)return{all:!0};if("all"in t.updateTriggers&&V1(t,e,"all"))return{all:!0};const i={};let r=!1;for(const o in t.updateTriggers)o!=="all"&&V1(t,e,o)&&(i[o]=!0,r=!0);return r?i:!1}function ak(t,e){if(e===null)return!0;const i=e.extensions,{extensions:r}=t;if(r===i)return!1;if(!i||!r||r.length!==i.length)return!0;for(let o=0;o<r.length;o++)if(!r[o].equals(i[o]))return!0;return!1}function V1(t,e,i){let r=t.updateTriggers[i];r=r??{};let o=e.updateTriggers[i];return o=o??{},z1({oldProps:o,newProps:r,triggerName:i})}const lk="count(): argument not an object",ck="count(): argument not a container";function hk(t){if(!dk(t))throw new Error(lk);if(typeof t.count=="function")return t.count();if(Number.isFinite(t.size))return t.size;if(Number.isFinite(t.length))return t.length;if(uk(t))return Object.keys(t).length;throw new Error(ck)}function uk(t){return t!==null&&typeof t=="object"&&t.constructor===Object}function dk(t){return t!==null&&typeof t=="object"}function j1(t,e){if(!e)return t;const i={...t,...e};if("defines"in e&&(i.defines={...t.defines,...e.defines}),"modules"in e&&(i.modules=(t.modules||[]).concat(e.modules),e.modules.some(r=>r.name==="project64"))){const r=i.modules.findIndex(o=>o.name==="project32");r>=0&&i.modules.splice(r,1)}if("inject"in e)if(!t.inject)i.inject=e.inject;else{const r={...t.inject};for(const o in e.inject)r[o]=(r[o]||"")+e.inject[o];i.inject=r}return i}const fk={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},_m={};function pk(t,e,i,r){if(i instanceof As)return i;i.constructor&&i.constructor.name!=="Object"&&(i={data:i});let o=null;i.compressed&&(o={minFilter:"linear",mipmapFilter:i.data.length>1?"nearest":"linear"});const u=e.createTexture({...i,sampler:{...fk,...o,...r}});return _m[u.id]=t,u}function _k(t,e){!e||!(e instanceof As)||_m[e.id]===t&&(e.delete(),delete _m[e.id])}const gk={boolean:{validate(t,e){return!0},equal(t,e,i){return!!t==!!e}},number:{validate(t,e){return Number.isFinite(t)&&(!("max"in e)||t<=e.max)&&(!("min"in e)||t>=e.min)}},color:{validate(t,e){return e.optional&&!t||gm(t)&&(t.length===3||t.length===4)},equal(t,e,i){return wn(t,e,1)}},accessor:{validate(t,e){const i=wf(t);return i==="function"||i===wf(e.value)},equal(t,e,i){return typeof e=="function"?!0:wn(t,e,1)}},array:{validate(t,e){return e.optional&&!t||gm(t)},equal(t,e,i){const{compare:r}=i,o=Number.isInteger(r)?r:r?1:0;return r?wn(t,e,o):t===e}},object:{equal(t,e,i){if(i.ignore)return!0;const{compare:r}=i,o=Number.isInteger(r)?r:r?1:0;return r?wn(t,e,o):t===e}},function:{validate(t,e){return e.optional&&!t||typeof t=="function"},equal(t,e,i){return!i.compare&&i.ignore!==!1||t===e}},data:{transform:(t,e,i)=>{if(!t)return t;const{dataTransform:r}=i.props;return r?r(t):typeof t.shape=="string"&&t.shape.endsWith("-table")&&Array.isArray(t.data)?t.data:t}},image:{transform:(t,e,i)=>{const r=i.context;return!r||!r.device?null:pk(i.id,r.device,t,{...e.parameters,...i.props.textureParameters})},release:(t,e,i)=>{_k(i.id,t)}}};function mk(t){const e={},i={},r={};for(const[o,u]of Object.entries(t)){const d=u==null?void 0:u.deprecatedFor;if(d)r[o]=Array.isArray(d)?d:[d];else{const a=yk(o,u);e[o]=a,i[o]=a.value}}return{propTypes:e,defaultProps:i,deprecatedProps:r}}function yk(t,e){switch(wf(e)){case"object":return ou(t,e);case"array":return ou(t,{type:"array",value:e,compare:!1});case"boolean":return ou(t,{type:"boolean",value:e});case"number":return ou(t,{type:"number",value:e});case"function":return ou(t,{type:"function",value:e,compare:!0});default:return{name:t,type:"unknown",value:e}}}function ou(t,e){return"type"in e?{name:t,...gk[e.type],...e}:"value"in e?{name:t,type:wf(e.value),...e}:{name:t,type:"object",value:e}}function gm(t){return Array.isArray(t)||ArrayBuffer.isView(t)}function wf(t){return gm(t)?"array":t===null?"null":typeof t}function bk(t,e){let i;for(let u=e.length-1;u>=0;u--){const d=e[u];"extensions"in d&&(i=d.extensions)}const r=mm(t.constructor,i),o=Object.create(r);o[hf]=t,o[$a]={},o[Yo]={};for(let u=0;u<e.length;++u){const d=e[u];for(const a in d)o[a]=d[a]}return Object.freeze(o),o}const vk="_mergedDefaultProps";function mm(t,e){if(!(t instanceof Tf.constructor))return{};let i=vk;if(e)for(const o of e){const u=o.constructor;u&&(i+=`:${u.extensionName||u.name}`)}const r=H1(t,i);return r||(t[i]=xk(t,e||[]))}function xk(t,e){if(!t.prototype)return null;const r=Object.getPrototypeOf(t),o=mm(r),u=H1(t,"defaultProps")||{},d=mk(u),a=Object.assign(Object.create(null),o,d.defaultProps),x=Object.assign(Object.create(null),o==null?void 0:o[Ko],d.propTypes),A=Object.assign(Object.create(null),o==null?void 0:o[jg],d.deprecatedProps);for(const M of e){const D=mm(M.constructor);D&&(Object.assign(a,D),Object.assign(x,D[Ko]),Object.assign(A,D[jg]))}return wk(a,t),Ak(a,x),Tk(a,A),a[Ko]=x,a[jg]=A,e.length===0&&!ym(t,"_propTypes")&&(t._propTypes=x),a}function wk(t,e){const i=Sk(e);Object.defineProperties(t,{id:{writable:!0,value:i}})}function Tk(t,e){for(const i in e)Object.defineProperty(t,i,{enumerable:!1,set(r){const o=`${this.id}: ${i}`;for(const u of e[i])ym(this,u)||(this[u]=r);Yt.deprecated(o,e[i].join("/"))()}})}function Ak(t,e){const i={},r={};for(const o in e){const u=e[o],{name:d,value:a}=u;u.async&&(i[d]=a,r[d]=Ek(d))}t[ac]=i,t[$a]={},Object.defineProperties(t,r)}function Ek(t){return{enumerable:!0,set(e){typeof e=="string"||e instanceof Promise||S1(e)?this[$a][t]=e:this[Yo][t]=e},get(){if(this[Yo]){if(t in this[Yo])return this[Yo][t]||this[ac][t];if(t in this[$a]){const e=this[hf]&&this[hf].internalState;if(e&&e.hasAsyncProp(t))return e.getAsyncProp(t)||this[ac][t]}}return this[ac][t]}}}function ym(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function H1(t,e){return ym(t,e)&&t[e]}function Sk(t){const e=t.componentName;return e||Yt.warn(`${t.name}.componentName not specified`)(),e||t.name}let Ck=0;class Tf{constructor(...e){this.props=bk(this,e),this.id=this.props.id,this.count=Ck++}clone(e){const{props:i}=this,r={};for(const o in i[ac])o in i[Yo]?r[o]=i[Yo][o]:o in i[$a]&&(r[o]=i[$a][o]);return new this.constructor({...i,...r,...e})}}Tf.componentName="Component",Tf.defaultProps={};const Ik=Object.freeze({});class Mk{constructor(e){this.component=e,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const e in this.asyncProps){const i=this.asyncProps[e];i&&i.type&&i.type.release&&i.type.release(i.resolvedValue,i.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||Ik}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(e){return e in this.asyncProps}getAsyncProp(e){const i=this.asyncProps[e];return i&&i.resolvedValue}isAsyncPropLoading(e){if(e){const i=this.asyncProps[e];return!!(i&&i.pendingLoadCount>0&&i.pendingLoadCount!==i.resolvedLoadCount)}for(const i in this.asyncProps)if(this.isAsyncPropLoading(i))return!0;return!1}reloadAsyncProp(e,i){this._watchPromise(e,Promise.resolve(i))}setAsyncProps(e){this.component=e[hf]||this.component;const i=e[Yo]||{},r=e[$a]||e,o=e[ac]||{};for(const u in i){const d=i[u];this._createAsyncPropData(u,o[u]),this._updateAsyncProp(u,d),i[u]=this.getAsyncProp(u)}for(const u in r){const d=r[u];this._createAsyncPropData(u,o[u]),this._updateAsyncProp(u,d)}}_fetch(e,i){return null}_onResolve(e,i){}_onError(e,i){}_updateAsyncProp(e,i){if(this._didAsyncInputValueChange(e,i)){if(typeof i=="string"&&(i=this._fetch(e,i)),i instanceof Promise){this._watchPromise(e,i);return}if(S1(i)){this._resolveAsyncIterable(e,i);return}this._setPropValue(e,i)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const e in this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}}_didAsyncInputValueChange(e,i){const r=this.asyncProps[e];return i===r.resolvedValue||i===r.lastValue?!1:(r.lastValue=i,!0)}_setPropValue(e,i){this._freezeAsyncOldProps();const r=this.asyncProps[e];r&&(i=this._postProcessValue(r,i),r.resolvedValue=i,r.pendingLoadCount++,r.resolvedLoadCount=r.pendingLoadCount)}_setAsyncPropValue(e,i,r){const o=this.asyncProps[e];o&&r>=o.resolvedLoadCount&&i!==void 0&&(this._freezeAsyncOldProps(),o.resolvedValue=i,o.resolvedLoadCount=r,this.onAsyncPropUpdated(e,i))}_watchPromise(e,i){const r=this.asyncProps[e];if(r){r.pendingLoadCount++;const o=r.pendingLoadCount;i.then(u=>{this.component&&(u=this._postProcessValue(r,u),this._setAsyncPropValue(e,u,o),this._onResolve(e,u))}).catch(u=>{this._onError(e,u)})}}async _resolveAsyncIterable(e,i){if(e!=="data"){this._setPropValue(e,i);return}const r=this.asyncProps[e];if(!r)return;r.pendingLoadCount++;const o=r.pendingLoadCount;let u=[],d=0;for await(const a of i){if(!this.component)return;const{dataTransform:x}=this.component.props;x?u=x(a,u):u=u.concat(a),Object.defineProperty(u,"__diff",{enumerable:!1,value:[{startRow:d,endRow:u.length}]}),d=u.length,this._setAsyncPropValue(e,u,o)}this._onResolve(e,u)}_postProcessValue(e,i){const r=e.type;return r&&this.component&&(r.release&&r.release(e.resolvedValue,r,this.component),r.transform)?r.transform(i,r,this.component):i}_createAsyncPropData(e,i){if(!this.asyncProps[e]){const o=this.component&&this.component.props[Ko];this.asyncProps[e]={type:o&&o[e],lastValue:null,resolvedValue:i,pendingLoadCount:0,resolvedLoadCount:0}}}}class Rk extends Mk{constructor({attributeManager:e,layer:i}){super(i),this.attributeManager=e,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(e,i){const r=this.layer,o=r==null?void 0:r.props.fetch;return o?o(i,{propName:e,layer:r}):super._fetch(e,i)}_onResolve(e,i){const r=this.layer;if(r){const o=r.props.onDataLoad;e==="data"&&o&&o(i,{propName:e,layer:r})}}_onError(e,i){const r=this.layer;r&&r.raiseError(i,`loading ${e} of ${this.layer}`)}}const Pk="layer.changeFlag",Bk="layer.initialize",Dk="layer.update",Ok="layer.finalize",Fk="layer.matched",G1=2**24-1,kk=Object.freeze([]),Nk=Vh(({oldViewport:t,viewport:e})=>t.equals(e));let qn=new Uint8ClampedArray(0);const Lk={data:{type:"data",value:kk,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:t=>t&&t.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(t,{propName:e,layer:i,loaders:r,loadOptions:o,signal:u})=>{const{resourceManager:d}=i.context;o=o||i.getLoadOptions(),r=r||i.props.loaders,u&&(o={...o,fetch:{...o==null?void 0:o.fetch,signal:u}});let a=d.contains(t);return!a&&!o&&(d.add({resourceId:t,data:$o(t,r),persistent:!1}),a=!0),a?d.subscribe({resourceId:t,onChange:x=>{var A;return(A=i.internalState)==null?void 0:A.reloadAsyncProp(e,x)},consumerId:i.id,requestId:e}):$o(t,r,o)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:Xt.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:({layerIndex:t})=>[0,-t*100]},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class gc extends Tf{constructor(){super(...arguments),this.internalState=null,this.lifecycle=oc.NO_STATE,this.parent=null}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let e=this;for(;e.parent;)e=e.parent;return e}toString(){return`${this.constructor.layerName||this.constructor.name}({id: '${this.props.id}'})`}project(e){yr(this.internalState);const i=this.internalState.viewport||this.context.viewport,r=yx(e,{viewport:i,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[o,u,d]=ox(r,i.pixelProjectionMatrix);return e.length===2?[o,u]:[o,u,d]}unproject(e){return yr(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(e)}projectPosition(e,i){yr(this.internalState);const r=this.internalState.viewport||this.context.viewport;return V3(e,{viewport:r,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...i})}get isComposite(){return!1}setState(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){const e=this.state;return e&&(e.models||e.model&&[e.model])||[]}setModuleParameters(e){for(const i of this.getModels())i.updateModuleSettings(e)}setShaderModuleProps(...e){for(const i of this.getModels())i.shaderInputs.setProps(...e)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:e}=this.props;return e===Xt.DEFAULT||e===Xt.LNGLAT||e===Xt.CARTESIAN}onHover(e,i){return this.props.onHover&&this.props.onHover(e,i)||!1}onClick(e,i){return this.props.onClick&&this.props.onClick(e,i)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(e,i=[]){return i[0]=e+1&255,i[1]=e+1>>8&255,i[2]=e+1>>8>>8&255,i}decodePickingColor(e){yr(e instanceof Uint8Array);const[i,r,o]=e;return i+r*256+o*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:hk(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){var e;return(e=this.getAttributeManager())==null?void 0:e.getBounds(["positions","instancePositions"])}getShaders(e){e=j1(e,{disableWarnings:!0,modules:this.context.defaultShaderModules});for(const i of this.props.extensions)e=j1(e,i.getShaders.call(this,i));return e}shouldUpdateState(e){return e.changeFlags.propsOrDataChanged}updateState(e){const i=this.getAttributeManager(),{dataChanged:r}=e.changeFlags;if(r&&i)if(Array.isArray(r))for(const o of r)i.invalidateAll(o);else i.invalidateAll();if(i){const{props:o}=e,u=this.internalState.hasPickingBuffer,d=Number.isInteger(o.highlightedObjectIndex)||o.pickable||o.extensions.some(a=>a.getNeedsPickingBuffer.call(this,a));if(u!==d){this.internalState.hasPickingBuffer=d;const{pickingColors:a,instancePickingColors:x}=i.attributes,A=a||x;A&&(d&&A.constant&&(A.constant=!1,i.invalidate(A.id)),!A.value&&!d&&(A.constant=!0,A.value=[0,0,0]))}}}finalizeState(e){for(const r of this.getModels())r.destroy();const i=this.getAttributeManager();i&&i.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(e){for(const i of this.getModels())i.draw(e)}getPickingInfo({info:e,mode:i,sourceLayer:r}){const{index:o}=e;return o>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[o]),e}raiseError(e,i){var r,o,u,d;i&&(e=new Error(`${i}: ${e.message}`,{cause:e})),(o=(r=this.props).onError)!=null&&o.call(r,e)||(d=(u=this.context)==null?void 0:u.onError)==null||d.call(u,e,this)}getNeedsRedraw(e={clearRedrawFlags:!1}){return this._getNeedsRedraw(e)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){var e;return((e=this.internalState)==null?void 0:e.uniformTransitions.active)||!1}activateViewport(e){if(!this.internalState)return;const i=this.internalState.viewport;this.internalState.viewport=e,(!i||!Nk({oldViewport:i,viewport:e}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(e="all"){const i=this.getAttributeManager();i&&(e==="all"?i.invalidateAll():i.invalidate(e))}updateAttributes(e){let i=!1;for(const r in e)e[r].layoutChanged()&&(i=!0);for(const r of this.getModels())this._setModelAttributes(r,e,i)}_updateAttributes(){const e=this.getAttributeManager();if(!e)return;const i=this.props,r=this.getNumInstances(),o=this.getStartIndices();e.update({data:i.data,numInstances:r,startIndices:o,props:i,transitions:i.transitions,buffers:i.data.attributes,context:this});const u=e.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(u)}_updateAttributeTransition(){const e=this.getAttributeManager();e&&e.updateTransition()}_updateUniformTransition(){const{uniformTransitions:e}=this.internalState;if(e.active){const i=e.update(),r=Object.create(this.props);for(const o in i)Object.defineProperty(r,o,{value:i[o]});return r}return this.props}calculateInstancePickingColors(e,{numInstances:i}){if(e.constant)return;const r=Math.floor(qn.length/4);if(this.internalState.usesPickingColorCache=!0,r<i){i>G1&&Yt.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),qn=Hh.allocate(qn,i,{size:4,copy:!0,maxCount:Math.max(i,G1)});const o=Math.floor(qn.length/4),u=[];for(let d=r;d<o;d++)this.encodePickingColor(d,u),qn[d*4+0]=u[0],qn[d*4+1]=u[1],qn[d*4+2]=u[2]}e.value=qn.subarray(0,i*4)}_setModelAttributes(e,i,r=!1){var a;if(!Object.keys(i).length)return;if(r){const x=this.getAttributeManager();e.setBufferLayout(x.getBufferLayouts(e)),i=x.getAttributes()}const o=((a=e.userData)==null?void 0:a.excludeAttributes)||{},u={},d={};for(const x in i){if(o[x])continue;const A=i[x].getValue();for(const M in A){const D=A[M];D instanceof Fi?i[x].settings.isIndexed?e.setIndexBuffer(D):u[M]=D:D&&(d[M]=D)}}e.setAttributes(u),e.setConstantAttributes(d)}disablePickingIndex(e){const i=this.props.data;if(!("attributes"in i)){this._disablePickingIndex(e);return}const{pickingColors:r,instancePickingColors:o}=this.getAttributeManager().attributes,u=r||o,d=u&&i.attributes&&i.attributes[u.id];if(d&&d.value){const a=d.value,x=this.encodePickingColor(e);for(let A=0;A<i.length;A++){const M=u.getVertexOffset(A);a[M]===x[0]&&a[M+1]===x[1]&&a[M+2]===x[2]&&this._disablePickingIndex(A)}}else this._disablePickingIndex(e)}_disablePickingIndex(e){const{pickingColors:i,instancePickingColors:r}=this.getAttributeManager().attributes,o=i||r;if(!o)return;const u=o.getVertexOffset(e),d=o.getVertexOffset(e+1);o.buffer.write(new Uint8Array(d-u),u)}restorePickingColors(){const{pickingColors:e,instancePickingColors:i}=this.getAttributeManager().attributes,r=e||i;r&&(this.internalState.usesPickingColorCache&&r.value.buffer!==qn.buffer&&(r.value=qn.subarray(0,r.value.length)),r.updateSubBuffer({startOffset:0}))}_initialize(){yr(!this.internalState),yr(Number.isFinite(this.props.coordinateSystem)),Wr(Bk,this);const e=this._getAttributeManager();e&&e.addInstanced({instancePickingColors:{type:"uint8",size:4,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new Rk({attributeManager:e,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(Yt.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),e)}),this.internalState.uniformTransitions=new tk(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const i of this.props.extensions)i.initializeState.call(this,this.context,i);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(e){Wr(Fk,this,this===e);const{state:i,internalState:r}=e;this!==e&&(this.internalState=r,this.state=i,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const e=this.needsUpdate();if(Wr(Dk,this,e),!e)return;const i=this.props,r=this.context,o=this.internalState,u=r.viewport,d=this._updateUniformTransition();o.propsInTransition=d,r.viewport=o.viewport||u,this.props=d;try{const a=this._getUpdateParams(),x=this.getModels();if(r.device)this.updateState(a);else try{this.updateState(a)}catch{}for(const M of this.props.extensions)M.updateState.call(this,a,M);const A=this.getModels()[0]!==x[0];this._postUpdate(a,A)}finally{r.viewport=u,this.props=i,this._clearChangeFlags(),o.needsUpdate=!1,o.resetOldProps()}}_finalize(){Wr(Ok,this),this.finalizeState(this.context);for(const e of this.props.extensions)e.finalizeState.call(this,this.context,e)}_drawLayer({renderPass:e,moduleParameters:i=null,uniforms:r={},parameters:o={}}){this._updateAttributeTransition();const u=this.props,d=this.context;this.props=this.internalState.propsInTransition||u;const a=this.props.opacity;r.opacity=Math.pow(a,1/2.2);try{if(i){const{isActive:M,isAttribute:D}=i.picking;this.setModuleParameters(i),this.setShaderModuleProps({picking:{isActive:M,isAttribute:D}})}const{getPolygonOffset:x}=this.props,A=x&&x(r)||[0,0];d.device.setParametersWebGL({polygonOffset:A});for(const M of this.getModels())M.setParameters(o);d.device.withParametersWebGL(o,()=>{const M={renderPass:e,moduleParameters:i,uniforms:r,parameters:o,context:d};for(const D of this.props.extensions)D.draw.call(this,M,D);this.draw(M)})}finally{this.props=u}}getChangeFlags(){var e;return(e=this.internalState)==null?void 0:e.changeFlags}setChangeFlags(e){if(!this.internalState)return;const{changeFlags:i}=this.internalState;for(const o in e)if(e[o]){let u=!1;switch(o){case"dataChanged":const d=e[o],a=i[o];d&&Array.isArray(a)&&(i.dataChanged=Array.isArray(d)?a.concat(d):d,u=!0);default:i[o]||(i[o]=e[o],u=!0)}u&&Wr(Pk,this,o,e)}const r=!!(i.dataChanged||i.updateTriggersChanged||i.propsChanged||i.extensionsChanged);i.propsOrDataChanged=r,i.somethingChanged=r||i.viewportChanged||i.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(e,i){var o;const r=rk(e,i);if(r.updateTriggersChanged)for(const u in r.updateTriggersChanged)r.updateTriggersChanged[u]&&this.invalidateAttribute(u);if(r.transitionsChanged)for(const u in r.transitionsChanged)this.internalState.uniformTransitions.add(u,i[u],e[u],(o=e.transitions)==null?void 0:o[u]);return this.setChangeFlags(r)}validateProps(){ik(this.props)}updateAutoHighlight(e){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(e)}_updateAutoHighlight(e){const i={highlightedObjectColor:e.picked?e.color:null},{highlightColor:r}=this.props;e.picked&&typeof r=="function"&&(i.highlightColor=r(e)),this.setShaderModuleProps({picking:i}),this.setNeedsRedraw()}_getAttributeManager(){const e=this.context;return new KF(e.device,{id:this.props.id,stats:e.stats,timeline:e.timeline})}_postUpdate(e,i){const{props:r,oldProps:o}=e;this.setNeedsRedraw(),this._updateAttributes();const u=this.state.model;u!=null&&u.isInstanced&&u.setInstanceCount(this.getNumInstances());const{autoHighlight:d,highlightedObjectIndex:a,highlightColor:x}=r;if(i||o.autoHighlight!==d||o.highlightedObjectIndex!==a||o.highlightColor!==x){const A={};Array.isArray(x)&&(A.highlightColor=x),(i||o.autoHighlight!==d||a!==o.highlightedObjectIndex)&&(A.highlightedObjectColor=Number.isFinite(a)&&a>=0?this.encodePickingColor(a):null),this.setShaderModuleProps({picking:A})}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(e){if(!this.internalState)return!1;let i=!1;i=i||this.internalState.needsRedraw&&this.id;const r=this.getAttributeManager(),o=r?r.getNeedsRedraw(e):!1;if(i=i||o,i)for(const u of this.props.extensions)u.onNeedsRedraw.call(this,u);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!e.clearRedrawFlags,i}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}gc.defaultProps=Lk,gc.layerName="Layer";const Uk="compositeLayer.renderLayers";class $1 extends gc{get isComposite(){return!0}get isLoaded(){return super.isLoaded&&this.getSubLayers().every(e=>e.isLoaded)}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(e){}setState(e){super.setState(e),this.setNeedsUpdate()}getPickingInfo({info:e}){const{object:i}=e;return i&&i.__source&&i.__source.parent&&i.__source.parent.id===this.id&&(e.object=i.__source.object,e.index=i.__source.index),e}filterSubLayer(e){return!0}shouldRenderSubLayer(e,i){return i&&i.length}getSubLayerClass(e,i){const{_subLayerProps:r}=this.props;return r&&r[e]&&r[e].type||i}getSubLayerRow(e,i,r){return e.__source={parent:this,object:i,index:r},e}getSubLayerAccessor(e){if(typeof e=="function"){const i={index:-1,data:this.props.data,target:[]};return(r,o)=>r&&r.__source?(i.index=r.__source.index,e(r.__source.object,i)):e(r,o)}return e}getSubLayerProps(e={}){var ht;const{opacity:i,pickable:r,visible:o,parameters:u,getPolygonOffset:d,highlightedObjectIndex:a,autoHighlight:x,highlightColor:A,coordinateSystem:M,coordinateOrigin:D,wrapLongitude:N,positionFormat:U,modelMatrix:re,extensions:ne,fetch:xe,operation:Ae,_subLayerProps:Te}=this.props,Ie={id:"",updateTriggers:{},opacity:i,pickable:r,visible:o,parameters:u,getPolygonOffset:d,highlightedObjectIndex:a,autoHighlight:x,highlightColor:A,coordinateSystem:M,coordinateOrigin:D,wrapLongitude:N,positionFormat:U,modelMatrix:re,extensions:ne,fetch:xe,operation:Ae},Ue=Te&&e.id&&Te[e.id],Xe=Ue&&Ue.updateTriggers,qe=e.id||"sublayer";if(Ue){const gt=this.props[Ko],nt=e.type?e.type._propTypes:{};for(const at in Ue){const bt=nt[at]||gt[at];bt&&bt.type==="accessor"&&(Ue[at]=this.getSubLayerAccessor(Ue[at]))}}Object.assign(Ie,e,Ue),Ie.id=`${this.props.id}-${qe}`,Ie.updateTriggers={all:(ht=this.props.updateTriggers)==null?void 0:ht.all,...e.updateTriggers,...Xe};for(const gt of ne){const nt=gt.getSubLayerProps.call(this,gt);nt&&Object.assign(Ie,nt,{updateTriggers:Object.assign(Ie.updateTriggers,nt.updateTriggers)})}return Ie}_updateAutoHighlight(e){for(const i of this.getSubLayers())i.updateAutoHighlight(e)}_getAttributeManager(){return null}_postUpdate(e,i){let r=this.internalState.subLayers;const o=!r||this.needsUpdate();if(o){const u=this.renderLayers();r=lc(u,Boolean),this.internalState.subLayers=r}Wr(Uk,this,o,r);for(const u of r)u.parent=this}}$1.layerName="CompositeLayer";const zk=`#version 300 es
#define SHADER_NAME point-cloud-layer-vertex-shader
in vec3 positions;
in vec3 instanceNormals;
in vec4 instanceColors;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec3 instancePickingColors;
uniform float opacity;
uniform float radiusPixels;
uniform int sizeUnits;
out vec4 vColor;
out vec2 unitPosition;
void main(void) {
geometry.worldPosition = instancePositions;
geometry.normal = project_normal(instanceNormals);
unitPosition = positions.xy;
geometry.uv = unitPosition;
geometry.pickingColor = instancePickingColors;
vec3 offset = vec3(positions.xy * project_size_to_pixel(radiusPixels, sizeUnits), 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
vec3 lightColor = lighting_getLightColor(instanceColors.rgb, project_uCameraPosition, geometry.position.xyz, geometry.normal);
vColor = vec4(lightColor, instanceColors.a * opacity);
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,Vk=`#version 300 es
#define SHADER_NAME point-cloud-layer-fragment-shader
precision highp float;
in vec4 vColor;
in vec2 unitPosition;
out vec4 fragColor;
void main(void) {
geometry.uv = unitPosition;
float distToCenter = length(unitPosition);
if (distToCenter > 1.0) {
discard;
}
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,W1=[0,0,0,255],X1=[0,0,1],jk={sizeUnits:"pixels",pointSize:{type:"number",min:0,value:10},getPosition:{type:"accessor",value:t=>t.position},getNormal:{type:"accessor",value:X1},getColor:{type:"accessor",value:W1},material:!0,radiusPixels:{deprecatedFor:"pointSize"}};function Hk(t){const{header:e,attributes:i}=t;if(!(!e||!i)&&(t.length=e.vertexCount,i.POSITION&&(i.instancePositions=i.POSITION),i.NORMAL&&(i.instanceNormals=i.NORMAL),i.COLOR_0)){const{size:r,value:o}=i.COLOR_0;i.instanceColors={size:r,type:"unorm8",value:o}}}class bm extends gc{getShaders(){return super.getShaders({vs:zk,fs:Vk,modules:[Ig,RP,Og]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceNormals:{size:3,transition:!0,accessor:"getNormal",defaultValue:X1},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getColor",defaultValue:W1}})}updateState(e){var o;const{changeFlags:i,props:r}=e;super.updateState(e),i.extensionsChanged&&((o=this.state.model)==null||o.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll()),i.dataChanged&&Hk(r.data)}draw({uniforms:e}){const{pointSize:i,sizeUnits:r}=this.props,o=this.state.model;o.setUniforms(e),o.setUniforms({sizeUnits:Eg[r],radiusPixels:i}),o.draw(this.context.renderPass)}_getModel(){const e=[];for(let i=0;i<3;i++){const r=i/3*Math.PI*2;e.push(Math.cos(r)*2,Math.sin(r)*2,0)}return new Zo(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new sc({topology:"triangle-list",attributes:{positions:new Float32Array(e)}}),isInstanced:!0})}}bm.layerName="PointCloudLayer",bm.defaultProps=jk;const Ss={OUTSIDE:-1,INTERSECTING:0,INSIDE:1};new De,new De;const au=new De,q1=new De;class lu{constructor(e=[0,0,0],i=0){this.radius=-0,this.center=new De,this.fromCenterRadius(e,i)}fromCenterRadius(e,i){return this.center.from(e),this.radius=i,this}fromCornerPoints(e,i){return i=au.from(i),this.center=new De().from(e).add(i).scale(.5),this.radius=this.center.distance(i),this}equals(e){return this===e||!!e&&this.center.equals(e.center)&&this.radius===e.radius}clone(){return new lu(this.center,this.radius)}union(e){const i=this.center,r=this.radius,o=e.center,u=e.radius,d=au.copy(o).subtract(i),a=d.magnitude();if(r>=a+u)return this.clone();if(u>=a+r)return e.clone();const x=(r+a+u)*.5;return q1.copy(d).scale((-r+x)/a).add(i),this.center.copy(q1),this.radius=x,this}expand(e){const r=au.from(e).subtract(this.center).magnitude();return r>this.radius&&(this.radius=r),this}transform(e){this.center.transform(e);const i=zR(au,e);return this.radius=Math.max(i[0],Math.max(i[1],i[2]))*this.radius,this}distanceSquaredTo(e){const i=this.distanceTo(e);return i*i}distanceTo(e){const r=au.from(e).subtract(this.center);return Math.max(0,r.len()-this.radius)}intersectPlane(e){const i=this.center,r=this.radius,u=e.normal.dot(i)+e.distance;return u<-r?Ss.OUTSIDE:u<r?Ss.INTERSECTING:Ss.INSIDE}}const Gk=new De,$k=new De,Af=new De,Ef=new De,Sf=new De,Wk=new De,Xk=new De,vo={COLUMN0ROW0:0,COLUMN0ROW1:1,COLUMN0ROW2:2,COLUMN1ROW0:3,COLUMN1ROW1:4,COLUMN1ROW2:5,COLUMN2ROW0:6,COLUMN2ROW1:7,COLUMN2ROW2:8};class cu{constructor(e=[0,0,0],i=[0,0,0,0,0,0,0,0,0]){this.center=new De().from(e),this.halfAxes=new Hi(i)}get halfSize(){const e=this.halfAxes.getColumn(0),i=this.halfAxes.getColumn(1),r=this.halfAxes.getColumn(2);return[new De(e).len(),new De(i).len(),new De(r).len()]}get quaternion(){const e=this.halfAxes.getColumn(0),i=this.halfAxes.getColumn(1),r=this.halfAxes.getColumn(2),o=new De(e).normalize(),u=new De(i).normalize(),d=new De(r).normalize();return new zh().fromMatrix3(new Hi([...o,...u,...d]))}fromCenterHalfSizeQuaternion(e,i,r){const o=new zh(r),u=new Hi().fromQuaternion(o);return u[0]=u[0]*i[0],u[1]=u[1]*i[0],u[2]=u[2]*i[0],u[3]=u[3]*i[1],u[4]=u[4]*i[1],u[5]=u[5]*i[1],u[6]=u[6]*i[2],u[7]=u[7]*i[2],u[8]=u[8]*i[2],this.center=new De().from(e),this.halfAxes=u,this}clone(){return new cu(this.center,this.halfAxes)}equals(e){return this===e||!!e&&this.center.equals(e.center)&&this.halfAxes.equals(e.halfAxes)}getBoundingSphere(e=new lu){const i=this.halfAxes,r=i.getColumn(0,Af),o=i.getColumn(1,Ef),u=i.getColumn(2,Sf),d=Gk.copy(r).add(o).add(u);return e.center.copy(this.center),e.radius=d.magnitude(),e}intersectPlane(e){const i=this.center,r=e.normal,o=this.halfAxes,u=r.x,d=r.y,a=r.z,x=Math.abs(u*o[vo.COLUMN0ROW0]+d*o[vo.COLUMN0ROW1]+a*o[vo.COLUMN0ROW2])+Math.abs(u*o[vo.COLUMN1ROW0]+d*o[vo.COLUMN1ROW1]+a*o[vo.COLUMN1ROW2])+Math.abs(u*o[vo.COLUMN2ROW0]+d*o[vo.COLUMN2ROW1]+a*o[vo.COLUMN2ROW2]),A=r.dot(i)+e.distance;return A<=-x?Ss.OUTSIDE:A>=x?Ss.INSIDE:Ss.INTERSECTING}distanceTo(e){return Math.sqrt(this.distanceSquaredTo(e))}distanceSquaredTo(e){const i=$k.from(e).subtract(this.center),r=this.halfAxes,o=r.getColumn(0,Af),u=r.getColumn(1,Ef),d=r.getColumn(2,Sf),a=o.magnitude(),x=u.magnitude(),A=d.magnitude();o.normalize(),u.normalize(),d.normalize();let M=0,D;return D=Math.abs(i.dot(o))-a,D>0&&(M+=D*D),D=Math.abs(i.dot(u))-x,D>0&&(M+=D*D),D=Math.abs(i.dot(d))-A,D>0&&(M+=D*D),M}computePlaneDistances(e,i,r=[-0,-0]){let o=Number.POSITIVE_INFINITY,u=Number.NEGATIVE_INFINITY;const d=this.center,a=this.halfAxes,x=a.getColumn(0,Af),A=a.getColumn(1,Ef),M=a.getColumn(2,Sf),D=Wk.copy(x).add(A).add(M).add(d),N=Xk.copy(D).subtract(e);let U=i.dot(N);return o=Math.min(U,o),u=Math.max(U,u),D.copy(d).add(x).add(A).subtract(M),N.copy(D).subtract(e),U=i.dot(N),o=Math.min(U,o),u=Math.max(U,u),D.copy(d).add(x).subtract(A).add(M),N.copy(D).subtract(e),U=i.dot(N),o=Math.min(U,o),u=Math.max(U,u),D.copy(d).add(x).subtract(A).subtract(M),N.copy(D).subtract(e),U=i.dot(N),o=Math.min(U,o),u=Math.max(U,u),d.copy(D).subtract(x).add(A).add(M),N.copy(D).subtract(e),U=i.dot(N),o=Math.min(U,o),u=Math.max(U,u),d.copy(D).subtract(x).add(A).subtract(M),N.copy(D).subtract(e),U=i.dot(N),o=Math.min(U,o),u=Math.max(U,u),d.copy(D).subtract(x).subtract(A).add(M),N.copy(D).subtract(e),U=i.dot(N),o=Math.min(U,o),u=Math.max(U,u),d.copy(D).subtract(x).subtract(A).subtract(M),N.copy(D).subtract(e),U=i.dot(N),o=Math.min(U,o),u=Math.max(U,u),r[0]=o,r[1]=u,r}transform(e){this.center.transformAsPoint(e);const i=this.halfAxes.getColumn(0,Af);i.transformAsPoint(e);const r=this.halfAxes.getColumn(1,Ef);r.transformAsPoint(e);const o=this.halfAxes.getColumn(2,Sf);return o.transformAsPoint(e),this.halfAxes=new Hi([...i,...r,...o]),this}getTransform(){throw new Error("not implemented")}}const Z1=new De,K1=new De;class Zn{constructor(e=[0,0,1],i=0){this.normal=new De,this.distance=-0,this.fromNormalDistance(e,i)}fromNormalDistance(e,i){return bn(Number.isFinite(i)),this.normal.from(e).normalize(),this.distance=i,this}fromPointNormal(e,i){e=Z1.from(e),this.normal.from(i).normalize();const r=-this.normal.dot(e);return this.distance=r,this}fromCoefficients(e,i,r,o){return this.normal.set(e,i,r),bn(yn(this.normal.len(),1)),this.distance=o,this}clone(){return new Zn(this.normal,this.distance)}equals(e){return yn(this.distance,e.distance)&&yn(this.normal,e.normal)}getPointDistance(e){return this.normal.dot(e)+this.distance}transform(e){const i=K1.copy(this.normal).transformAsVector(e).normalize(),r=this.normal.scale(-this.distance).transform(e);return this.fromPointNormal(r,i)}projectPointOntoPlane(e,i=[0,0,0]){const r=Z1.from(e),o=this.getPointDistance(r),u=K1.copy(this.normal).scale(o);return r.subtract(u).to(i)}}const Y1=[new De([1,0,0]),new De([0,1,0]),new De([0,0,1])],J1=new De,qk=new De;class tn{constructor(e=[]){this.planes=e}fromBoundingSphere(e){this.planes.length=2*Y1.length;const i=e.center,r=e.radius;let o=0;for(const u of Y1){let d=this.planes[o],a=this.planes[o+1];d||(d=this.planes[o]=new Zn),a||(a=this.planes[o+1]=new Zn);const x=J1.copy(u).scale(-r).add(i);d.fromPointNormal(x,u);const A=J1.copy(u).scale(r).add(i),M=qk.copy(u).negate();a.fromPointNormal(A,M),o+=2}return this}computeVisibility(e){let i=Ss.INSIDE;for(const r of this.planes)switch(e.intersectPlane(r)){case Ss.OUTSIDE:return Ss.OUTSIDE;case Ss.INTERSECTING:i=Ss.INTERSECTING;break}return i}computeVisibilityWithPlaneMask(e,i){if(bn(Number.isFinite(i),"parentPlaneMask is required."),i===tn.MASK_OUTSIDE||i===tn.MASK_INSIDE)return i;let r=tn.MASK_INSIDE;const o=this.planes;for(let u=0;u<this.planes.length;++u){const d=u<31?1<<u:0;if(u<31&&!(i&d))continue;const a=o[u],x=e.intersectPlane(a);if(x===Ss.OUTSIDE)return tn.MASK_OUTSIDE;x===Ss.INTERSECTING&&(r|=d)}return r}}tn.MASK_OUTSIDE=4294967295,tn.MASK_INSIDE=0,tn.MASK_INDETERMINATE=2147483647,new De,new De,new De,new De,new De,new De,new De,new De,new De,new De,new De,new De,new De,new De,new De,new De,new De;const Kn=new Hi,Zk=new Hi,Kk=new Hi,Cf=new Hi,Q1=new Hi;function Yk(t,e={}){const i=EP,r=10;let o=0,u=0;const d=Zk,a=Kk;d.identity(),a.copy(t);const x=i*Jk(a);for(;u<r&&Qk(a)>x;)eN(a,Cf),Q1.copy(Cf).transpose(),a.multiplyRight(Cf),a.multiplyLeft(Q1),d.multiplyRight(Cf),++o>2&&(++u,o=0);return e.unitary=d.toTarget(e.unitary),e.diagonal=a.toTarget(e.diagonal),e}function Jk(t){let e=0;for(let i=0;i<9;++i){const r=t[i];e+=r*r}return Math.sqrt(e)}const vm=[1,0,0],xm=[2,2,1];function Qk(t){let e=0;for(let i=0;i<3;++i){const r=t[Kn.getElementIndex(xm[i],vm[i])];e+=2*r*r}return Math.sqrt(e)}function eN(t,e){const i=Wv;let r=0,o=1;for(let A=0;A<3;++A){const M=Math.abs(t[Kn.getElementIndex(xm[A],vm[A])]);M>r&&(o=A,r=M)}const u=vm[o],d=xm[o];let a=1,x=0;if(Math.abs(t[Kn.getElementIndex(d,u)])>i){const A=t[Kn.getElementIndex(d,d)],M=t[Kn.getElementIndex(u,u)],D=t[Kn.getElementIndex(d,u)],N=(A-M)/2/D;let U;N<0?U=-1/(-N+Math.sqrt(1+N*N)):U=1/(N+Math.sqrt(1+N*N)),a=1/Math.sqrt(1+U*U),x=U*a}return Hi.IDENTITY.to(e),e[Kn.getElementIndex(u,u)]=e[Kn.getElementIndex(d,d)]=a,e[Kn.getElementIndex(d,u)]=x,e[Kn.getElementIndex(u,d)]=-x,e}const na=new De,tN=new De,iN=new De,rN=new De,sN=new De,nN=new Hi,oN={diagonal:new Hi,unitary:new Hi};function aN(t,e=new cu){if(!t||t.length===0)return e.halfAxes=new Hi([0,0,0,0,0,0,0,0,0]),e.center=new De,e;const i=t.length,r=new De(0,0,0);for(const nt of t)r.add(nt);const o=1/i;r.multiplyByScalar(o);let u=0,d=0,a=0,x=0,A=0,M=0;for(const nt of t){const at=na.copy(nt).subtract(r);u+=at.x*at.x,d+=at.x*at.y,a+=at.x*at.z,x+=at.y*at.y,A+=at.y*at.z,M+=at.z*at.z}u*=o,d*=o,a*=o,x*=o,A*=o,M*=o;const D=nN;D[0]=u,D[1]=d,D[2]=a,D[3]=d,D[4]=x,D[5]=A,D[6]=a,D[7]=A,D[8]=M;const{unitary:N}=Yk(D,oN),U=e.halfAxes.copy(N);let re=U.getColumn(0,iN),ne=U.getColumn(1,rN),xe=U.getColumn(2,sN),Ae=-Number.MAX_VALUE,Te=-Number.MAX_VALUE,Ie=-Number.MAX_VALUE,Ue=Number.MAX_VALUE,Xe=Number.MAX_VALUE,qe=Number.MAX_VALUE;for(const nt of t)na.copy(nt),Ae=Math.max(na.dot(re),Ae),Te=Math.max(na.dot(ne),Te),Ie=Math.max(na.dot(xe),Ie),Ue=Math.min(na.dot(re),Ue),Xe=Math.min(na.dot(ne),Xe),qe=Math.min(na.dot(xe),qe);re=re.multiplyByScalar(.5*(Ue+Ae)),ne=ne.multiplyByScalar(.5*(Xe+Te)),xe=xe.multiplyByScalar(.5*(qe+Ie)),e.center.copy(re).add(ne).add(xe);const ht=tN.set(Ae-Ue,Te-Xe,Ie-qe).multiplyByScalar(.5),gt=new Hi([ht[0],0,0,0,ht[1],0,0,0,ht[2]]);return e.halfAxes.multiplyRight(gt),e}const wm=Math.PI/180,If=new Float32Array(16),ew=new Float32Array(12);function tw(t,e,i){const r=e[0]*wm,o=e[1]*wm,u=e[2]*wm,d=Math.sin(u),a=Math.sin(r),x=Math.sin(o),A=Math.cos(u),M=Math.cos(r),D=Math.cos(o),N=i[0],U=i[1],re=i[2];t[0]=N*D*M,t[1]=N*x*M,t[2]=N*-a,t[3]=U*(-x*A+D*a*d),t[4]=U*(D*A+x*a*d),t[5]=U*M*d,t[6]=re*(x*d+D*a*A),t[7]=re*(-D*d+x*a*A),t[8]=re*M*A}function iw(t){return t[0]=t[0],t[1]=t[1],t[2]=t[2],t[3]=t[4],t[4]=t[5],t[5]=t[6],t[6]=t[8],t[7]=t[9],t[8]=t[10],t[9]=t[12],t[10]=t[13],t[11]=t[14],t.subarray(0,12)}const rw={size:12,accessor:["getOrientation","getScale","getTranslation","getTransformMatrix"],shaderAttributes:{instanceModelMatrixCol0:{size:3,elementOffset:0},instanceModelMatrixCol1:{size:3,elementOffset:3},instanceModelMatrixCol2:{size:3,elementOffset:6},instanceTranslation:{size:3,elementOffset:9}},update(t,{startRow:e,endRow:i}){const{data:r,getOrientation:o,getScale:u,getTranslation:d,getTransformMatrix:a}=this.props,x=Array.isArray(a),A=x&&a.length===16,M=Array.isArray(u),D=Array.isArray(o),N=Array.isArray(d),U=A||!x&&!!a(r[0]);U?t.constant=A:t.constant=D&&M&&N;const re=t.value;if(t.constant){let ne;U?(If.set(a),ne=iw(If)):(ne=ew,tw(ne,o,u),ne.set(d,9)),t.value=new Float32Array(ne)}else{let ne=e*t.size;const{iterable:xe,objectInfo:Ae}=E1(r,e,i);for(const Te of xe){Ae.index++;let Ie;if(U)If.set(A?a:a(Te,Ae)),Ie=iw(If);else{Ie=ew;const Ue=D?o:o(Te,Ae),Xe=M?u:u(Te,Ae);tw(Ie,Ue,Xe),Ie.set(N?d:d(Te,Ae),9)}re[ne++]=Ie[0],re[ne++]=Ie[1],re[ne++]=Ie[2],re[ne++]=Ie[3],re[ne++]=Ie[4],re[ne++]=Ie[5],re[ne++]=Ie[6],re[ne++]=Ie[7],re[ne++]=Ie[8],re[ne++]=Ie[9],re[ne++]=Ie[10],re[ne++]=Ie[11]}}}};function sw(t,e){return e===Xt.CARTESIAN||e===Xt.METER_OFFSETS||e===Xt.DEFAULT&&!t.isGeospatial}const lN=`#version 300 es
#define SHADER_NAME simple-mesh-layer-vs
uniform float sizeScale;
uniform bool composeModelMatrix;
in vec3 positions;
in vec3 normals;
in vec3 colors;
in vec2 texCoords;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec3 instanceModelMatrixCol0;
in vec3 instanceModelMatrixCol1;
in vec3 instanceModelMatrixCol2;
in vec3 instanceTranslation;
out vec2 vTexCoord;
out vec3 cameraPosition;
out vec3 normals_commonspace;
out vec4 position_commonspace;
out vec4 vColor;
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = texCoords;
geometry.pickingColor = instancePickingColors;
vTexCoord = texCoords;
cameraPosition = project_uCameraPosition;
vColor = vec4(colors * instanceColors.rgb, instanceColors.a);
mat3 instanceModelMatrix = mat3(instanceModelMatrixCol0, instanceModelMatrixCol1, instanceModelMatrixCol2);
vec3 pos = (instanceModelMatrix * positions) * sizeScale + instanceTranslation;
if (composeModelMatrix) {
DECKGL_FILTER_SIZE(pos, geometry);
normals_commonspace = project_normal(instanceModelMatrix * normals);
geometry.worldPosition += pos;
gl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), position_commonspace);
geometry.position = position_commonspace;
}
else {
pos = project_size(pos);
DECKGL_FILTER_SIZE(pos, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, position_commonspace);
geometry.position = position_commonspace;
normals_commonspace = project_normal(instanceModelMatrix * normals);
}
geometry.normal = normals_commonspace;
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,cN=`#version 300 es
#define SHADER_NAME simple-mesh-layer-fs
precision highp float;
uniform bool hasTexture;
uniform sampler2D sampler;
uniform bool flatShading;
uniform float opacity;
in vec2 vTexCoord;
in vec3 cameraPosition;
in vec3 normals_commonspace;
in vec4 position_commonspace;
in vec4 vColor;
out vec4 fragColor;
void main(void) {
geometry.uv = vTexCoord;
vec3 normal;
if (flatShading) {
normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
} else {
normal = normals_commonspace;
}
vec4 color = hasTexture ? texture(sampler, vTexCoord) : vColor;
DECKGL_FILTER_COLOR(color, geometry);
vec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);
fragColor = vec4(lightColor, color.a * opacity);
}
`;function Tm(t){const e=t.positions||t.POSITION;Yt.assert(e,'no "postions" or "POSITION" attribute in mesh');const i=e.value.length/e.size;let r=t.COLOR_0||t.colors;r||(r={size:3,value:new Float32Array(i*3).fill(1)});let o=t.NORMAL||t.normals;o||(o={size:3,value:new Float32Array(i*3).fill(0)});let u=t.TEXCOORD_0||t.texCoords;return u||(u={size:2,value:new Float32Array(i*2).fill(0)}),{positions:e,colors:r,normals:o,texCoords:u}}function nw(t){return t instanceof sc?(t.attributes=Tm(t.attributes),t):t.attributes?new sc({...t,topology:"triangle-list",attributes:Tm(t.attributes)}):new sc({topology:"triangle-list",attributes:Tm(t)})}const hN={mesh:{type:"object",value:null,async:!0},texture:{type:"image",value:null,async:!0},sizeScale:{type:"number",value:1,min:0},_instanced:!0,wireframe:!1,material:!0,getPosition:{type:"accessor",value:t=>t.position},getColor:{type:"accessor",value:[0,0,0,255]},getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]},textureParameters:{type:"object",ignore:!0,value:null}};class Am extends gc{getShaders(){return super.getShaders({vs:lN,fs:cN,modules:[Ig,PP,Og]})}getBounds(){var r;if(this.props._instanced)return super.getBounds();let e=this.state.positionBounds;if(e)return e;const{mesh:i}=this.props;if(!i)return null;if(e=(r=i.header)==null?void 0:r.boundingBox,!e){const{attributes:o}=nw(i);o.POSITION=o.POSITION||o.positions,e=Tb(o)}return this.state.positionBounds=e,e}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{transition:!0,type:"float64",fp64:this.use64bitPositions(),size:3,accessor:"getPosition"},instanceColors:{type:"unorm8",transition:!0,size:this.props.colorFormat.length,accessor:"getColor",defaultValue:[0,0,0,255]},instanceModelMatrix:rw}),this.setState({emptyTexture:this.context.device.createTexture({data:new Uint8Array(4),width:1,height:1})})}updateState(e){var u;super.updateState(e);const{props:i,oldProps:r,changeFlags:o}=e;if(i.mesh!==r.mesh||o.extensionsChanged){if(this.state.positionBounds=null,(u=this.state.model)==null||u.destroy(),i.mesh){this.state.model=this.getModel(i.mesh);const d=i.mesh.attributes||i.mesh;this.setState({hasNormals:!!(d.NORMAL||d.normals)})}this.getAttributeManager().invalidateAll()}i.texture!==r.texture&&i.texture instanceof As&&this.setTexture(i.texture),this.state.model&&this.state.model.setTopology(this.props.wireframe?"line-strip":"triangle-list")}finalizeState(e){super.finalizeState(e),this.state.emptyTexture.delete()}draw({uniforms:e}){const{model:i}=this.state;if(!i)return;const{viewport:r,renderPass:o}=this.context,{sizeScale:u,coordinateSystem:d,_instanced:a}=this.props;i.setUniforms(e),i.setUniforms({sizeScale:u,composeModelMatrix:!a||sw(r,d),flatShading:!this.state.hasNormals}),i.draw(o)}get isLoaded(){var e;return!!((e=this.state)!=null&&e.model&&super.isLoaded)}getModel(e){const i=new Zo(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:nw(e),isInstanced:!0}),{texture:r}=this.props,{emptyTexture:o}=this.state;return i.setBindings({sampler:r||o}),i.setUniforms({hasTexture:!!r}),i}setTexture(e){const{emptyTexture:i,model:r}=this.state;r&&(r.setBindings({sampler:e||i}),r.setUniforms({hasTexture:!!e}))}}Am.defaultProps=hN,Am.layerName="SimpleMeshLayer";var Tn;(function(t){t[t.FUNC_ADD=32774]="FUNC_ADD",t[t.ONE=1]="ONE",t[t.SRC_ALPHA=770]="SRC_ALPHA",t[t.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",t[t.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",t[t.LINEAR=9729]="LINEAR",t[t.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",t[t.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL"})(Tn||(Tn={}));function ow(t,e,i,r){const o={defines:{MANUAL_SRGB:1,SRGB_FAST_APPROXIMATION:1},bindings:{},uniforms:{u_Camera:[0,0,0],u_MetallicRoughnessValues:[1,1]},parameters:{},glParameters:{},generatedTextures:[]};o.defines.USE_TEX_LOD=1;const{imageBasedLightingEnvironment:u}=r;return u&&(o.bindings.u_DiffuseEnvSampler=u.diffuseEnvSampler,o.bindings.u_SpecularEnvSampler=u.specularEnvSampler,o.bindings.u_brdfLUT=u.brdfLutTexture,o.uniforms.u_ScaleIBLAmbient=[1,1]),r!=null&&r.pbrDebug&&(o.defines.PBR_DEBUG=1,o.uniforms.u_ScaleDiffBaseMR=[0,0,0,0],o.uniforms.u_ScaleFGDSpec=[0,0,0,0]),i.NORMAL&&(o.defines.HAS_NORMALS=1),i.TANGENT&&(r!=null&&r.useTangents)&&(o.defines.HAS_TANGENTS=1),i.TEXCOORD_0&&(o.defines.HAS_UV=1),r!=null&&r.imageBasedLightingEnvironment&&(o.defines.USE_IBL=1),r!=null&&r.lights&&(o.defines.USE_LIGHTS=1),e&&uN(t,e,o),o}function uN(t,e,i){if(i.uniforms.pbr_uUnlit=!!e.unlit,e.pbrMetallicRoughness&&dN(t,e.pbrMetallicRoughness,i),e.normalTexture){hu(t,e.normalTexture,"u_NormalSampler","HAS_NORMALMAP",i);const{scale:r=1}=e.normalTexture;i.uniforms.u_NormalScale=r}if(e.occlusionTexture){hu(t,e.occlusionTexture,"u_OcclusionSampler","HAS_OCCLUSIONMAP",i);const{strength:r=1}=e.occlusionTexture;i.uniforms.u_OcclusionStrength=r}switch(e.emissiveTexture&&(hu(t,e.emissiveTexture,"u_EmissiveSampler","HAS_EMISSIVEMAP",i),i.uniforms.u_EmissiveFactor=e.emissiveFactor||[0,0,0]),e.alphaMode){case"MASK":const{alphaCutoff:r=.5}=e;i.defines.ALPHA_CUTOFF=1,i.uniforms.u_AlphaCutoff=r;break;case"BLEND":Je.warn("glTF BLEND alphaMode might not work well because it requires mesh sorting")(),i.parameters.blendColorOperation="add",i.parameters.blendColorSrcFactor="src-alpha",i.parameters.blendColorDstFactor="one-minus-src-alpha",i.parameters.blendAlphaOperation="add",i.parameters.blendAlphaSrcFactor="one",i.parameters.blendAlphaDstFactor="one-minus-src-alpha",i.glParameters.blend=!0,i.glParameters.blendEquation=Tn.FUNC_ADD,i.glParameters.blendFunc=[Tn.SRC_ALPHA,Tn.ONE_MINUS_SRC_ALPHA,Tn.ONE,Tn.ONE_MINUS_SRC_ALPHA];break}}function dN(t,e,i){e.baseColorTexture&&hu(t,e.baseColorTexture,"u_BaseColorSampler","HAS_BASECOLORMAP",i),i.uniforms.u_BaseColorFactor=e.baseColorFactor||[1,1,1,1],e.metallicRoughnessTexture&&hu(t,e.metallicRoughnessTexture,"u_MetallicRoughnessSampler","HAS_METALROUGHNESSMAP",i);const{metallicFactor:r=1,roughnessFactor:o=1}=e;i.uniforms.u_MetallicRoughnessValues=[r,o]}function hu(t,e,i,r=null,o){var M,D;const u=((D=(M=e==null?void 0:e.texture)==null?void 0:M.sampler)==null?void 0:D.parameters)||{},d=e.texture.source.image;let a,x={};d.compressed?(a=d,x={[Tn.TEXTURE_MIN_FILTER]:d.data.length>1?Tn.LINEAR_MIPMAP_NEAREST:Tn.LINEAR}):a={data:d};const A=t.createTexture({id:e.uniformName||e.id,parameters:{...u,...x},pixelStore:{[Tn.UNPACK_FLIP_Y_WEBGL]:!1},...a});o.bindings[i]=A,r&&(o.defines[r]=1),o.generatedTextures.push(A)}const fN="4.3.1",Mf={TRANSCODER:"basis_transcoder.js",TRANSCODER_WASM:"basis_transcoder.wasm",ENCODER:"basis_encoder.js",ENCODER_WASM:"basis_encoder.wasm"};let aw;async function lw(t){aS(t.modules);const e=lS("basis");return e||(aw||(aw=pN(t)),await aw)}async function pN(t){let e=null,i=null;return[e,i]=await Promise.all([await Fa(Mf.TRANSCODER,"textures",t),await Fa(Mf.TRANSCODER_WASM,"textures",t)]),e=e||globalThis.BASIS,await _N(e,i)}function _N(t,e){const i={};return e&&(i.wasmBinary=e),new Promise(r=>{t(i).then(o=>{const{BasisFile:u,initializeBasis:d}=o;d(),r({BasisFile:u})})})}let Em;async function cw(t){const e=t.modules||{};return e.basisEncoder?e.basisEncoder:(Em=Em||gN(t),await Em)}async function gN(t){let e=null,i=null;return[e,i]=await Promise.all([await Fa(Mf.ENCODER,"textures",t),await Fa(Mf.ENCODER_WASM,"textures",t)]),e=e||globalThis.BASIS,await mN(e,i)}function mN(t,e){const i={};return e&&(i.wasmBinary=e),new Promise(r=>{t(i).then(o=>{const{BasisFile:u,KTX2File:d,initializeBasis:a,BasisEncoder:x}=o;a(),r({BasisFile:u,KTX2File:d,BasisEncoder:x})})})}const mc={COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_EXT:33778,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_R11_EAC:37488,COMPRESSED_SIGNED_R11_EAC:37489,COMPRESSED_RG11_EAC:37490,COMPRESSED_SIGNED_RG11_EAC:37491,COMPRESSED_RGB8_ETC2:37492,COMPRESSED_RGBA8_ETC2_EAC:37493,COMPRESSED_SRGB8_ETC2:37494,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:37495,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:37496,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:37497,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGB_ETC1_WEBGL:36196,COMPRESSED_RGB_ATC_WEBGL:35986,COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL:35987,COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL:34798,COMPRESSED_RGBA_ASTC_4X4_KHR:37808,COMPRESSED_RGBA_ASTC_5X4_KHR:37809,COMPRESSED_RGBA_ASTC_5X5_KHR:37810,COMPRESSED_RGBA_ASTC_6X5_KHR:37811,COMPRESSED_RGBA_ASTC_6X6_KHR:37812,COMPRESSED_RGBA_ASTC_8X5_KHR:37813,COMPRESSED_RGBA_ASTC_8X6_KHR:37814,COMPRESSED_RGBA_ASTC_8X8_KHR:37815,COMPRESSED_RGBA_ASTC_10X5_KHR:37816,COMPRESSED_RGBA_ASTC_10X6_KHR:37817,COMPRESSED_RGBA_ASTC_10X8_KHR:37818,COMPRESSED_RGBA_ASTC_10X10_KHR:37819,COMPRESSED_RGBA_ASTC_12X10_KHR:37820,COMPRESSED_RGBA_ASTC_12X12_KHR:37821,COMPRESSED_SRGB8_ALPHA8_ASTC_4X4_KHR:37840,COMPRESSED_SRGB8_ALPHA8_ASTC_5X4_KHR:37841,COMPRESSED_SRGB8_ALPHA8_ASTC_5X5_KHR:37842,COMPRESSED_SRGB8_ALPHA8_ASTC_6X5_KHR:37843,COMPRESSED_SRGB8_ALPHA8_ASTC_6X6_KHR:37844,COMPRESSED_SRGB8_ALPHA8_ASTC_8X5_KHR:37845,COMPRESSED_SRGB8_ALPHA8_ASTC_8X6_KHR:37846,COMPRESSED_SRGB8_ALPHA8_ASTC_8X8_KHR:37847,COMPRESSED_SRGB8_ALPHA8_ASTC_10X5_KHR:37848,COMPRESSED_SRGB8_ALPHA8_ASTC_10X6_KHR:37849,COMPRESSED_SRGB8_ALPHA8_ASTC_10X8_KHR:37850,COMPRESSED_SRGB8_ALPHA8_ASTC_10X10_KHR:37851,COMPRESSED_SRGB8_ALPHA8_ASTC_12X10_KHR:37852,COMPRESSED_SRGB8_ALPHA8_ASTC_12X12_KHR:37853,COMPRESSED_RED_RGTC1_EXT:36283,COMPRESSED_SIGNED_RED_RGTC1_EXT:36284,COMPRESSED_RED_GREEN_RGTC2_EXT:36285,COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT:36286,COMPRESSED_SRGB_S3TC_DXT1_EXT:35916,COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT:35917,COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT:35918,COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT:35919},yN=["","WEBKIT_","MOZ_"],hw={WEBGL_compressed_texture_s3tc:"dxt",WEBGL_compressed_texture_s3tc_srgb:"dxt-srgb",WEBGL_compressed_texture_etc1:"etc1",WEBGL_compressed_texture_etc:"etc2",WEBGL_compressed_texture_pvrtc:"pvrtc",WEBGL_compressed_texture_atc:"atc",WEBGL_compressed_texture_astc:"astc",EXT_texture_compression_rgtc:"rgtc"};let Rf=null;function bN(t){if(!Rf){t=t||vN()||void 0,Rf=new Set;for(const e of yN)for(const i in hw)if(t&&t.getExtension(`${e}${i}`)){const r=hw[i];Rf.add(r)}}return Rf}function vN(){try{return document.createElement("canvas").getContext("webgl")}catch{return null}}const Cs=[171,75,84,88,32,50,48,187,13,10,26,10];function xN(t){const e=new Uint8Array(t);return!(e.byteLength<Cs.length||e[0]!==Cs[0]||e[1]!==Cs[1]||e[2]!==Cs[2]||e[3]!==Cs[3]||e[4]!==Cs[4]||e[5]!==Cs[5]||e[6]!==Cs[6]||e[7]!==Cs[7]||e[8]!==Cs[8]||e[9]!==Cs[9]||e[10]!==Cs[10]||e[11]!==Cs[11])}const wN={etc1:{basisFormat:0,compressed:!0,format:mc.COMPRESSED_RGB_ETC1_WEBGL},etc2:{basisFormat:1,compressed:!0},bc1:{basisFormat:2,compressed:!0,format:mc.COMPRESSED_RGB_S3TC_DXT1_EXT},bc3:{basisFormat:3,compressed:!0,format:mc.COMPRESSED_RGBA_S3TC_DXT5_EXT},bc4:{basisFormat:4,compressed:!0},bc5:{basisFormat:5,compressed:!0},"bc7-m6-opaque-only":{basisFormat:6,compressed:!0},"bc7-m5":{basisFormat:7,compressed:!0},"pvrtc1-4-rgb":{basisFormat:8,compressed:!0,format:mc.COMPRESSED_RGB_PVRTC_4BPPV1_IMG},"pvrtc1-4-rgba":{basisFormat:9,compressed:!0,format:mc.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG},"astc-4x4":{basisFormat:10,compressed:!0,format:mc.COMPRESSED_RGBA_ASTC_4X4_KHR},"atc-rgb":{basisFormat:11,compressed:!0},"atc-rgba-interpolated-alpha":{basisFormat:12,compressed:!0},rgba32:{basisFormat:13,compressed:!1},rgb565:{basisFormat:14,compressed:!1},bgr565:{basisFormat:15,compressed:!1},rgba4444:{basisFormat:16,compressed:!1}};async function TN(t,e){if(e.basis.containerFormat==="auto"){if(xN(t)){const r=await cw(e);return uw(r.KTX2File,t,e)}const{BasisFile:i}=await lw(e);return Sm(i,t,e)}switch(e.basis.module){case"encoder":const i=await cw(e);switch(e.basis.containerFormat){case"ktx2":return uw(i.KTX2File,t,e);case"basis":default:return Sm(i.BasisFile,t,e)}case"transcoder":default:const{BasisFile:r}=await lw(e);return Sm(r,t,e)}}function Sm(t,e,i){const r=new t(new Uint8Array(e));try{if(!r.startTranscoding())throw new Error("Failed to start basis transcoding");const o=r.getNumImages(),u=[];for(let d=0;d<o;d++){const a=r.getNumLevels(d),x=[];for(let A=0;A<a;A++)x.push(AN(r,d,A,i));u.push(x)}return u}finally{r.close(),r.delete()}}function AN(t,e,i,r){const o=t.getImageWidth(e,i),u=t.getImageHeight(e,i),d=t.getHasAlpha(),{compressed:a,format:x,basisFormat:A}=dw(r,d),M=t.getImageTranscodedSizeInBytes(e,i,A),D=new Uint8Array(M);if(!t.transcodeImage(D,e,i,A,0,0))throw new Error("failed to start Basis transcoding");return{width:o,height:u,data:D,compressed:a,format:x,hasAlpha:d}}function uw(t,e,i){const r=new t(new Uint8Array(e));try{if(!r.startTranscoding())throw new Error("failed to start KTX2 transcoding");const o=r.getLevels(),u=[];for(let d=0;d<o;d++)u.push(EN(r,d,i));return[u]}finally{r.close(),r.delete()}}function EN(t,e,i){const{alphaFlag:r,height:o,width:u}=t.getImageLevelInfo(e,0,0),{compressed:d,format:a,basisFormat:x}=dw(i,r),A=t.getImageTranscodedSizeInBytes(e,0,0,x),M=new Uint8Array(A);if(!t.transcodeImage(M,e,0,0,x,0,-1,-1))throw new Error("Failed to transcode KTX2 image");return{width:u,height:o,data:M,compressed:d,levelSize:A,hasAlpha:r,format:a}}function dw(t,e){let i=t&&t.basis&&t.basis.format;return i==="auto"&&(i=fw()),typeof i=="object"&&(i=e?i.alpha:i.noAlpha),i=i.toLowerCase(),wN[i]}function fw(){const t=bN();return t.has("astc")?"astc-4x4":t.has("dxt")?{alpha:"bc3",noAlpha:"bc1"}:t.has("pvrtc")?{alpha:"pvrtc1-4-rgba",noAlpha:"pvrtc1-4-rgb"}:t.has("etc1")?"etc1":t.has("etc2")?"etc2":"rgb565"}const SN={...{dataType:null,batchType:null,name:"Basis",id:"basis",module:"textures",version:fN,worker:!0,extensions:["basis","ktx2"],mimeTypes:["application/octet-stream","image/ktx2"],tests:["sB"],binary:!0,options:{basis:{format:"auto",libraryPath:"libs/",containerFormat:"auto",module:"transcoder"}}},parse:TN},CN={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},IN={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};class MN{constructor(e){L(this,"name");L(this,"startTime",0);L(this,"playing",!0);L(this,"speed",1);L(this,"channels",[]);Object.assign(this,e)}animate(e){if(!this.playing)return;const r=(e/1e3-this.startTime)*this.speed;this.channels.forEach(({sampler:o,target:u,path:d})=>{kN(r,o,u,d),BN(u,u._node)})}}class RN{constructor(e){L(this,"animations");this.animations=e.animations.map((i,r)=>{const o=i.name||`Animation-${r}`,u=i.samplers.map(({input:a,interpolation:x="LINEAR",output:A})=>({input:pw(e.accessors[a]),interpolation:x,output:pw(e.accessors[A])})),d=i.channels.map(({sampler:a,target:x})=>({sampler:u[a],target:e.nodes[x.node],path:x.path}));return new MN({name:o,channels:d})})}animate(e){this.setTime(e)}setTime(e){this.animations.forEach(i=>i.animate(e))}getAnimations(){return this.animations}}function pw(t){if(!t._animation){const e=IN[t.componentType],i=CN[t.type],r=i*t.count,{buffer:o,byteOffset:u}=t.bufferView.data,d=new e(o,u+(t.byteOffset||0),r);if(i===1)t._animation=Array.from(d);else{const a=[];for(let x=0;x<d.length;x+=i)a.push(Array.from(d.slice(x,x+i)));t._animation=a}}return t._animation}const PN=new $t;function BN(t,e){if(e.matrix.identity(),t.translation&&e.matrix.translate(t.translation),t.rotation){const i=PN.fromQuaternion(t.rotation);e.matrix.multiplyRight(i)}t.scale&&e.matrix.scale(t.scale)}const Cm=new zh;function DN(t,e,i,r,o){if(e==="rotation"){Cm.slerp({start:i,target:r,ratio:o});for(let u=0;u<Cm.length;u++)t[e][u]=Cm[u]}else for(let u=0;u<i.length;u++)t[e][u]=o*r[u]+(1-o)*i[u]}function ON(t,e,{p0:i,outTangent0:r,inTangent1:o,p1:u,tDiff:d,ratio:a}){for(let x=0;x<t[e].length;x++){const A=r[x]*d,M=o[x]*d;t[e][x]=(2*Math.pow(a,3)-3*Math.pow(a,2)+1)*i[x]+(Math.pow(a,3)-2*Math.pow(a,2)+a)*A+(-2*Math.pow(a,3)+3*Math.pow(a,2))*u[x]+(Math.pow(a,3)-Math.pow(a,2))*M}}function FN(t,e,i){for(let r=0;r<i.length;r++)t[e][r]=i[r]}function kN(t,{input:e,interpolation:i,output:r},o,u){const d=e[e.length-1],a=t%d,x=e.findIndex(N=>N>=a),A=Math.max(0,x-1);if(!Array.isArray(o[u]))switch(u){case"translation":o[u]=[0,0,0];break;case"rotation":o[u]=[0,0,0,1];break;case"scale":o[u]=[1,1,1];break;default:Je.warn(`Bad animation path ${u}`)()}ti(o[u].length===r[A].length);const M=e[A],D=e[x];switch(i){case"STEP":FN(o,u,r[A]);break;case"LINEAR":if(D>M){const N=(a-M)/(D-M);DN(o,u,r[A],r[x],N)}break;case"CUBICSPLINE":if(D>M){const N=(a-M)/(D-M),U=D-M,re=r[3*A+1],ne=r[3*A+2],xe=r[3*x+0],Ae=r[3*x+1];ON(o,u,{p0:re,outTangent0:ne,inTangent1:xe,p1:Ae,tDiff:U,ratio:N})}break;default:Je.warn(`Interpolation ${i} not supported`)();break}}const NN=`
#pragma vscode_glsllint_stage: vert
#if (__VERSION__ < 300)
  #define _attr attribute
#else
  #define _attr in
#endif

  // _attr vec4 POSITION;
  _attr vec4 positions;

  #ifdef HAS_NORMALS
    // _attr vec4 NORMAL;
    _attr vec4 normals;
  #endif

  #ifdef HAS_TANGENTS
    _attr vec4 TANGENT;
  #endif

  #ifdef HAS_UV
    // _attr vec2 TEXCOORD_0;
    _attr vec2 texCoords;
  #endif

  void main(void) {
    vec4 _NORMAL = vec4(0.);
    vec4 _TANGENT = vec4(0.);
    vec2 _TEXCOORD_0 = vec2(0.);

    #ifdef HAS_NORMALS
      _NORMAL = normals;
    #endif

    #ifdef HAS_TANGENTS
      _TANGENT = TANGENT;
    #endif

    #ifdef HAS_UV
      _TEXCOORD_0 = texCoords;
    #endif

    pbr_setPositionNormalTangentUV(positions, _NORMAL, _TANGENT, _TEXCOORD_0);
    gl_Position = u_MVPMatrix * positions;
  }
`,LN=`
#pragma vscode_glsllint_stage: frag
#if (__VERSION__ < 300)
  #define fragmentColor gl_FragColor
#else
  out vec4 fragmentColor;
#endif

  void main(void) {
    vec3 pos = pbr_vPosition;
    fragmentColor = pbr_filterColor(vec4(1.0));
  }
`;function UN(t,e){const{id:i,geometry:r,material:o,vertexCount:u,materialOptions:d,modelOptions:a}=e,x=ow(t,o,r.attributes,d);Je.info(4,"createGLTFModel defines: ",x.defines)();const A=[],M={depthWriteEnabled:!0,depthCompare:"less",depthFormat:"depth24plus",cullMode:"back"},D={id:i,geometry:r,topology:r.topology,vertexCount:u,modules:[Ag],vs:_w(t,NN),fs:_w(t,LN),...a,bindings:{...x.bindings,...a.bindings},defines:{...x.defines,...a.defines},parameters:{...M,...x.parameters,...a.parameters},uniforms:{...x.uniforms,...a.uniforms}},N=new Zo(t,D);return new Vg({managedResources:A,model:N})}function _w(t,e){return`#version 300 es
${e}`}const zN={modelOptions:{},pbrDebug:!1,imageBasedLightingEnvironment:null,lights:!0,useTangents:!1};class VN{constructor(e,i={}){L(this,"device");L(this,"options");L(this,"gltf");this.device=e,this.options={...zN,...i}}instantiate(e){return this.gltf=e,(e.scenes||[]).map(r=>this.createScene(r))}createAnimator(){return Array.isArray(this.gltf.animations)?new RN(this.gltf):null}createScene(e){const r=(e.nodes||[]).map(u=>this.createNode(u));return new nc({id:e.name||e.id,children:r})}createNode(e){if(!e._node){const r=(e.children||[]).map(u=>this.createNode(u));e.mesh&&r.push(this.createMesh(e.mesh));const o=new nc({id:e.name||e.id,children:r});if(e.matrix)o.setMatrix(e.matrix);else{if(o.matrix.identity(),e.translation&&o.matrix.translate(e.translation),e.rotation){const u=new $t().fromQuaternion(e.rotation);o.matrix.multiplyRight(u)}e.scale&&o.matrix.scale(e.scale)}e._node=o}return e._node}createMesh(e){if(!e._mesh){const r=(e.primitives||[]).map((u,d)=>this.createPrimitive(u,d,e)),o=new nc({id:e.name||e.id,children:r});e._mesh=o}return e._mesh}createPrimitive(e,i,r){const o=e.name||`${r.name||r.id}-primitive-${i}`,u=jN(e.mode||4),d=e.indices?e.indices.count:this.getVertexCount(e.attributes),a=UN(this.device,{id:o,geometry:this.createGeometry(o,e,u),material:e.material,materialOptions:this.options,modelOptions:this.options.modelOptions,vertexCount:d});return a.bounds=[e.attributes.POSITION.min,e.attributes.POSITION.max],a}getVertexCount(e){throw new Error("getVertexCount not implemented")}createGeometry(e,i,r){const o={};for(const[u,d]of Object.entries(i.attributes)){const{components:a,size:x,value:A}=d;o[u]={size:x??a,value:A}}return new sc({id:e,topology:r,indices:i.indices.value,attributes:o})}createBuffer(e,i){e.bufferView||(e.bufferView={});const{bufferView:r}=e;return r.lumaBuffers||(r.lumaBuffers={}),r.lumaBuffers[i]||(r.lumaBuffers[i]=this.device.createBuffer({id:`from-${r.id}`,data:r.data||e.value})),r.lumaBuffers[i]}createSampler(e){return e}needsPOT(){return!1}}var xo;(function(t){t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN"})(xo||(xo={}));function jN(t){switch(t){case xo.POINTS:return"point-list";case xo.LINES:return"line-list";case xo.LINE_STRIP:return"line-strip";case xo.LINE_LOOP:return"line-loop-webgl";case xo.TRIANGLES:return"triangle-list";case xo.TRIANGLE_STRIP:return"triangle-strip";case xo.TRIANGLE_FAN:return"triangle-fan-webgl";default:throw new Error(t)}}function HN(t,e,i){const r=new VN(t,i),o=r.instantiate(e),u=r.createAnimator();return{scenes:o,animator:u}}function Is(t,e){if(!t)throw new Error(e||"assert failed: gltf")}const gw={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},mw={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},GN=1.33,yw=["SCALAR","VEC2","VEC3","VEC4"],$N=[[Int8Array,5120],[Uint8Array,5121],[Int16Array,5122],[Uint16Array,5123],[Uint32Array,5125],[Float32Array,5126],[Float64Array,5130]],WN=new Map($N),XN={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},qN={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},ZN={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function bw(t){return yw[t-1]||yw[0]}function Pf(t){const e=WN.get(t.constructor);if(!e)throw new Error("Illegal typed array");return e}function Im(t,e){const i=ZN[t.componentType],r=XN[t.type],o=qN[t.componentType],u=t.count*r,d=t.count*r*o;Is(d>=0&&d<=e.byteLength);const a=mw[t.componentType],x=gw[t.type];return{ArrayType:i,length:u,byteLength:d,componentByteSize:a,numberOfComponentsInElement:x}}function vw(t){let{images:e,bufferViews:i}=t;e=e||[],i=i||[];const r=e.map(d=>d.bufferView);i=i.filter(d=>!r.includes(d));const o=i.reduce((d,a)=>d+a.byteLength,0),u=e.reduce((d,a)=>{const{width:x,height:A}=a.image;return d+x*A},0);return o+Math.ceil(4*u*GN)}function KN(t,e,i){const r=t.bufferViews[i];Is(r);const o=r.buffer,u=e[o];Is(u);const d=(r.byteOffset||0)+u.byteOffset;return new Uint8Array(u.arrayBuffer,d,r.byteLength)}function YN(t,e,i){var ne,xe;const r=typeof i=="number"?(ne=t.accessors)==null?void 0:ne[i]:i;if(!r)throw new Error(`No gltf accessor ${JSON.stringify(i)}`);const o=(xe=t.bufferViews)==null?void 0:xe[r.bufferView||0];if(!o)throw new Error(`No gltf buffer view for accessor ${o}`);const{arrayBuffer:u,byteOffset:d}=e[o.buffer],a=(d||0)+(r.byteOffset||0)+(o.byteOffset||0),{ArrayType:x,length:A,componentByteSize:M,numberOfComponentsInElement:D}=Im(r,o),N=M*D,U=o.byteStride||N;if(typeof o.byteStride>"u"||o.byteStride===N)return new x(u,a,A);const re=new x(A);for(let Ae=0;Ae<r.count;Ae++){const Te=new x(u,a+Ae*U,D);re.set(Te,Ae*D)}return re}function JN(){return{asset:{version:"2.0",generator:"loaders.gl"},buffers:[],extensions:{},extensionsRequired:[],extensionsUsed:[]}}class Cr{constructor(e){L(this,"gltf");L(this,"sourceBuffers");L(this,"byteLength");this.gltf={json:(e==null?void 0:e.json)||JN(),buffers:(e==null?void 0:e.buffers)||[],images:(e==null?void 0:e.images)||[]},this.sourceBuffers=[],this.byteLength=0,this.gltf.buffers&&this.gltf.buffers[0]&&(this.byteLength=this.gltf.buffers[0].byteLength,this.sourceBuffers=[this.gltf.buffers[0]])}get json(){return this.gltf.json}getApplicationData(e){return this.json[e]}getExtraData(e){return(this.json.extras||{})[e]}hasExtension(e){const i=this.getUsedExtensions().find(o=>o===e),r=this.getRequiredExtensions().find(o=>o===e);return typeof i=="string"||typeof r=="string"}getExtension(e){const i=this.getUsedExtensions().find(o=>o===e),r=this.json.extensions||{};return i?r[e]:null}getRequiredExtension(e){return this.getRequiredExtensions().find(r=>r===e)?this.getExtension(e):null}getRequiredExtensions(){return this.json.extensionsRequired||[]}getUsedExtensions(){return this.json.extensionsUsed||[]}getRemovedExtensions(){return this.json.extensionsRemoved||[]}getObjectExtension(e,i){return(e.extensions||{})[i]}getScene(e){return this.getObject("scenes",e)}getNode(e){return this.getObject("nodes",e)}getSkin(e){return this.getObject("skins",e)}getMesh(e){return this.getObject("meshes",e)}getMaterial(e){return this.getObject("materials",e)}getAccessor(e){return this.getObject("accessors",e)}getTexture(e){return this.getObject("textures",e)}getSampler(e){return this.getObject("samplers",e)}getImage(e){return this.getObject("images",e)}getBufferView(e){return this.getObject("bufferViews",e)}getBuffer(e){return this.getObject("buffers",e)}getObject(e,i){if(typeof i=="object")return i;const r=this.json[e]&&this.json[e][i];if(!r)throw new Error(`glTF file error: Could not find ${e}[${i}]`);return r}getTypedArrayForBufferView(e){e=this.getBufferView(e);const i=e.buffer,r=this.gltf.buffers[i];Is(r);const o=(e.byteOffset||0)+r.byteOffset;return new Uint8Array(r.arrayBuffer,o,e.byteLength)}getTypedArrayForAccessor(e){const i=this.getAccessor(e);return YN(this.gltf.json,this.gltf.buffers,i)}getTypedArrayForImageData(e){e=this.getAccessor(e);const i=this.getBufferView(e.bufferView),o=this.getBuffer(i.buffer).data,u=i.byteOffset||0;return new Uint8Array(o,u,i.byteLength)}addApplicationData(e,i){return this.json[e]=i,this}addExtraData(e,i){return this.json.extras=this.json.extras||{},this.json.extras[e]=i,this}addObjectExtension(e,i,r){return e.extensions=e.extensions||{},e.extensions[i]=r,this.registerUsedExtension(i),this}setObjectExtension(e,i,r){const o=e.extensions||{};o[i]=r}removeObjectExtension(e,i){const r=(e==null?void 0:e.extensions)||{};if(r[i]){this.json.extensionsRemoved=this.json.extensionsRemoved||[];const o=this.json.extensionsRemoved;o.includes(i)||o.push(i)}delete r[i]}addExtension(e,i={}){return Is(i),this.json.extensions=this.json.extensions||{},this.json.extensions[e]=i,this.registerUsedExtension(e),i}addRequiredExtension(e,i={}){return Is(i),this.addExtension(e,i),this.registerRequiredExtension(e),i}registerUsedExtension(e){this.json.extensionsUsed=this.json.extensionsUsed||[],this.json.extensionsUsed.find(i=>i===e)||this.json.extensionsUsed.push(e)}registerRequiredExtension(e){this.registerUsedExtension(e),this.json.extensionsRequired=this.json.extensionsRequired||[],this.json.extensionsRequired.find(i=>i===e)||this.json.extensionsRequired.push(e)}removeExtension(e){var i;if((i=this.json.extensions)!=null&&i[e]){this.json.extensionsRemoved=this.json.extensionsRemoved||[];const r=this.json.extensionsRemoved;r.includes(e)||r.push(e)}this.json.extensions&&delete this.json.extensions[e],this.json.extensionsRequired&&this._removeStringFromArray(this.json.extensionsRequired,e),this.json.extensionsUsed&&this._removeStringFromArray(this.json.extensionsUsed,e)}setDefaultScene(e){this.json.scene=e}addScene(e){const{nodeIndices:i}=e;return this.json.scenes=this.json.scenes||[],this.json.scenes.push({nodes:i}),this.json.scenes.length-1}addNode(e){const{meshIndex:i,matrix:r}=e;this.json.nodes=this.json.nodes||[];const o={mesh:i};return r&&(o.matrix=r),this.json.nodes.push(o),this.json.nodes.length-1}addMesh(e){const{attributes:i,indices:r,material:o,mode:u=4}=e,a={primitives:[{attributes:this._addAttributes(i),mode:u}]};if(r){const x=this._addIndices(r);a.primitives[0].indices=x}return Number.isFinite(o)&&(a.primitives[0].material=o),this.json.meshes=this.json.meshes||[],this.json.meshes.push(a),this.json.meshes.length-1}addPointCloud(e){const r={primitives:[{attributes:this._addAttributes(e),mode:0}]};return this.json.meshes=this.json.meshes||[],this.json.meshes.push(r),this.json.meshes.length-1}addImage(e,i){const r=U_(e),o=i||(r==null?void 0:r.mimeType),d={bufferView:this.addBufferView(e),mimeType:o};return this.json.images=this.json.images||[],this.json.images.push(d),this.json.images.length-1}addBufferView(e,i=0,r=this.byteLength){const o=e.byteLength;Is(Number.isFinite(o)),this.sourceBuffers=this.sourceBuffers||[],this.sourceBuffers.push(e);const u={buffer:i,byteOffset:r,byteLength:o};return this.byteLength+=Ch(o,4),this.json.bufferViews=this.json.bufferViews||[],this.json.bufferViews.push(u),this.json.bufferViews.length-1}addAccessor(e,i){const r={bufferView:e,type:bw(i.size),componentType:i.componentType,count:i.count,max:i.max,min:i.min};return this.json.accessors=this.json.accessors||[],this.json.accessors.push(r),this.json.accessors.length-1}addBinaryBuffer(e,i={size:3}){const r=this.addBufferView(e);let o={min:i.min,max:i.max};(!o.min||!o.max)&&(o=this._getAccessorMinMax(e,i.size));const u={size:i.size,componentType:Pf(e),count:Math.round(e.length/i.size),min:o.min,max:o.max};return this.addAccessor(r,Object.assign(u,i))}addTexture(e){const{imageIndex:i}=e,r={source:i};return this.json.textures=this.json.textures||[],this.json.textures.push(r),this.json.textures.length-1}addMaterial(e){return this.json.materials=this.json.materials||[],this.json.materials.push(e),this.json.materials.length-1}createBinaryChunk(){var u,d;const e=this.byteLength,i=new ArrayBuffer(e),r=new Uint8Array(i);let o=0;for(const a of this.sourceBuffers||[])o=DS(a,r,o);(d=(u=this.json)==null?void 0:u.buffers)!=null&&d[0]?this.json.buffers[0].byteLength=e:this.json.buffers=[{byteLength:e}],this.gltf.binary=i,this.sourceBuffers=[i],this.gltf.buffers=[{arrayBuffer:i,byteOffset:0,byteLength:i.byteLength}]}_removeStringFromArray(e,i){let r=!0;for(;r;){const o=e.indexOf(i);o>-1?e.splice(o,1):r=!1}}_addAttributes(e={}){const i={};for(const r in e){const o=e[r],u=this._getGltfAttributeName(r),d=this.addBinaryBuffer(o.value,o);i[u]=d}return i}_addIndices(e){return this.addBinaryBuffer(e,{size:1})}_getGltfAttributeName(e){switch(e.toLowerCase()){case"position":case"positions":case"vertices":return"POSITION";case"normal":case"normals":return"NORMAL";case"color":case"colors":return"COLOR_0";case"texcoord":case"texcoords":return"TEXCOORD_0";default:return e}}_getAccessorMinMax(e,i){const r={min:null,max:null};if(e.length<i)return r;r.min=[],r.max=[];const o=e.subarray(0,i);for(const u of o)r.min.push(u),r.max.push(u);for(let u=i;u<e.length;u+=i)for(let d=0;d<i;d++)r.min[0+d]=Math.min(r.min[0+d],e[u+d]),r.max[0+d]=Math.max(r.max[0+d],e[u+d]);return r}}function xw(t){return(t%1+1)%1}const ww={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16,BOOLEAN:1,STRING:1,ENUM:1},QN={INT8:Int8Array,UINT8:Uint8Array,INT16:Int16Array,UINT16:Uint16Array,INT32:Int32Array,UINT32:Uint32Array,INT64:BigInt64Array,UINT64:BigUint64Array,FLOAT32:Float32Array,FLOAT64:Float64Array},Tw={INT8:1,UINT8:1,INT16:2,UINT16:2,INT32:4,UINT32:4,INT64:8,UINT64:8,FLOAT32:4,FLOAT64:8};function Mm(t,e){return Tw[e]*ww[t]}function Bf(t,e,i,r){if(i!=="UINT8"&&i!=="UINT16"&&i!=="UINT32"&&i!=="UINT64")return null;const o=t.getTypedArrayForBufferView(e),u=Df(o,"SCALAR",i,r+1);return u instanceof BigInt64Array||u instanceof BigUint64Array?null:u}function Df(t,e,i,r=1){const o=ww[e],u=QN[i],d=Tw[i],a=r*o,x=a*d;let A=t.buffer,M=t.byteOffset;return M%d!==0&&(A=new Uint8Array(A).slice(M,M+x).buffer,M=0),new u(A,M,a)}function Rm(t,e,i){var A,M,D,N,U;const r=`TEXCOORD_${e.texCoord||0}`,o=i.attributes[r],u=t.getTypedArrayForAccessor(o),d=t.gltf.json,a=e.index,x=(M=(A=d.textures)==null?void 0:A[a])==null?void 0:M.source;if(typeof x<"u"){const re=(N=(D=d.images)==null?void 0:D[x])==null?void 0:N.mimeType,ne=(U=t.gltf.images)==null?void 0:U[x];if(ne&&typeof ne.width<"u"){const xe=[];for(let Ae=0;Ae<u.length;Ae+=2){const Te=eL(ne,re,u,Ae,e.channels);xe.push(Te)}return xe}}return[]}function Aw(t,e,i,r,o){if(!(i!=null&&i.length))return;const u=[];for(const M of i){let D=r.findIndex(N=>N===M);D===-1&&(D=r.push(M)-1),u.push(D)}const d=new Uint32Array(u),a=t.gltf.buffers.push({arrayBuffer:d.buffer,byteOffset:d.byteOffset,byteLength:d.byteLength})-1,x=t.addBufferView(d,a,0),A=t.addAccessor(x,{size:1,componentType:Pf(d),count:d.length});o.attributes[e]=A}function eL(t,e,i,r,o=[0]){const u={r:{offset:0,shift:0},g:{offset:1,shift:8},b:{offset:2,shift:16},a:{offset:3,shift:24}},d=i[r],a=i[r+1];let x=1;e&&(e.indexOf("image/jpeg")!==-1||e.indexOf("image/png")!==-1)&&(x=4);const A=tL(d,a,t,x);let M=0;for(const D of o){const N=typeof D=="number"?Object.values(u)[D]:u[D],U=A+N.offset,re=Ab(t);if(re.data.length<=U)throw new Error(`${re.data.length} <= ${U}`);const ne=re.data[U];M|=ne<<N.shift}return M}function tL(t,e,i,r=1){const o=i.width,u=xw(t)*(o-1),d=Math.round(u),a=i.height,x=xw(e)*(a-1),A=Math.round(x),M=i.components?i.components:r;return(A*o+d)*M}function Ew(t,e,i,r,o){const u=[];for(let d=0;d<e;d++){const a=i[d],x=i[d+1]-i[d];if(x+a>r)break;const A=a/o,M=x/o;u.push(t.slice(A,A+M))}return u}function Sw(t,e,i){const r=[];for(let o=0;o<e;o++){const u=o*i;r.push(t.slice(u,u+i))}return r}function Cw(t,e,i,r){if(i)throw new Error("Not implemented - arrayOffsets for strings is specified");if(r){const o=[],u=new TextDecoder("utf8");let d=0;for(let a=0;a<t;a++){const x=r[a+1]-r[a];if(x+d<=e.length){const A=e.subarray(d,x+d),M=u.decode(A);o.push(M),d+=x}}return o}return[]}const yc="EXT_mesh_features",iL=yc;async function rL(t,e){const i=new Cr(t);nL(i,e)}function sL(t,e){const i=new Cr(t);return aL(i),i.createBinaryChunk(),i.gltf}function nL(t,e){const i=t.gltf.json;if(i.meshes)for(const r of i.meshes)for(const o of r.primitives)oL(t,o,e)}function oL(t,e,i){var u,d,a;if(!((u=i==null?void 0:i.gltf)!=null&&u.loadBuffers))return;const r=(d=e.extensions)==null?void 0:d[yc],o=r==null?void 0:r.featureIds;if(o)for(const x of o){let A;if(typeof x.attribute<"u"){const M=`_FEATURE_ID_${x.attribute}`,D=e.attributes[M];A=t.getTypedArrayForAccessor(D)}else typeof x.texture<"u"&&((a=i==null?void 0:i.gltf)!=null&&a.loadImages)?A=Rm(t,x.texture,e):A=[];x.data=A}}function aL(t,e){const i=t.gltf.json.meshes;if(i)for(const r of i)for(const o of r.primitives)cL(t,o)}function lL(t,e,i,r){e.extensions||(e.extensions={});let o=e.extensions[yc];o||(o={featureIds:[]},e.extensions[yc]=o);const{featureIds:u}=o,d={featureCount:i.length,propertyTable:r,data:i};u.push(d),t.addObjectExtension(e,yc,o)}function cL(t,e){var o;const i=(o=e.extensions)==null?void 0:o[yc];if(!i)return;const r=i.featureIds;r.forEach((u,d)=>{if(u.data){const{accessorKey:a,index:x}=hL(e.attributes),A=new Uint32Array(u.data);r[d]={featureCount:A.length,propertyTable:u.propertyTable,attribute:x},t.gltf.buffers.push({arrayBuffer:A.buffer,byteOffset:A.byteOffset,byteLength:A.byteLength});const M=t.addBufferView(A),D=t.addAccessor(M,{size:1,componentType:Pf(A),count:A.length});e.attributes[a]=D}})}function hL(t){const e="_FEATURE_ID_",i=Object.keys(t).filter(u=>u.indexOf(e)===0);let r=-1;for(const u of i){const d=Number(u.substring(e.length));d>r&&(r=d)}return r++,{accessorKey:`${e}${r}`,index:r}}const uL=Object.freeze(Object.defineProperty({__proto__:null,createExtMeshFeatures:lL,decode:rL,encode:sL,name:iL},Symbol.toStringTag,{value:"Module"})),bc="EXT_structural_metadata",dL=bc;async function fL(t,e){const i=new Cr(t);_L(i,e)}function pL(t,e){const i=new Cr(t);return PL(i),i.createBinaryChunk(),i.gltf}function _L(t,e){var r,o;if(!((r=e.gltf)!=null&&r.loadBuffers))return;const i=t.getExtension(bc);i&&((o=e.gltf)!=null&&o.loadImages&&gL(t,i),mL(t,i))}function gL(t,e){const i=e.propertyTextures,r=t.gltf.json;if(i&&r.meshes)for(const o of r.meshes)for(const u of o.primitives)bL(t,i,u,e)}function mL(t,e){const i=e.schema;if(!i)return;const r=i.classes,o=e.propertyTables;if(r&&o)for(const u in r){const d=yL(o,u);d&&xL(t,i,d)}}function yL(t,e){for(const i of t)if(i.class===e)return i;return null}function bL(t,e,i,r){var d;if(!e)return;const o=(d=i.extensions)==null?void 0:d[bc],u=o==null?void 0:o.propertyTextures;if(u)for(const a of u){const x=e[a];vL(t,x,i,r)}}function vL(t,e,i,r){var u;if(!e.properties)return;r.dataAttributeNames||(r.dataAttributeNames=[]);const o=e.class;for(const d in e.properties){const a=`${o}_${d}`,x=(u=e.properties)==null?void 0:u[d];if(!x)continue;x.data||(x.data=[]);const A=x.data,M=Rm(t,x,i);M!==null&&(Aw(t,a,M,A,i),x.data=A,r.dataAttributeNames.push(a))}}function xL(t,e,i){var u,d;const r=(u=e.classes)==null?void 0:u[i.class];if(!r)throw new Error(`Incorrect data in the EXT_structural_metadata extension: no schema class with name ${i.class}`);const o=i.count;for(const a in r.properties){const x=r.properties[a],A=(d=i.properties)==null?void 0:d[a];if(A){const M=wL(t,e,x,o,A);A.data=M}}}function wL(t,e,i,r,o){let u=[];const d=o.values,a=t.getTypedArrayForBufferView(d),x=TL(t,i,o,r),A=AL(t,o,r);switch(i.type){case"SCALAR":case"VEC2":case"VEC3":case"VEC4":case"MAT2":case"MAT3":case"MAT4":{u=EL(i,r,a,x);break}case"BOOLEAN":throw new Error(`Not implemented - classProperty.type=${i.type}`);case"STRING":{u=Cw(r,a,x,A);break}case"ENUM":{u=SL(e,i,r,a,x);break}default:throw new Error(`Unknown classProperty type ${i.type}`)}return u}function TL(t,e,i,r){return e.array&&typeof e.count>"u"&&typeof i.arrayOffsets<"u"?Bf(t,i.arrayOffsets,i.arrayOffsetType||"UINT32",r):null}function AL(t,e,i){return typeof e.stringOffsets<"u"?Bf(t,e.stringOffsets,e.stringOffsetType||"UINT32",i):null}function EL(t,e,i,r){const o=t.array,u=t.count,d=Mm(t.type,t.componentType),a=i.byteLength/d;let x;return t.componentType?x=Df(i,t.type,t.componentType,a):x=i,o?r?Ew(x,e,r,i.length,d):u?Sw(x,e,u):[]:x}function SL(t,e,i,r,o){var D;const u=e.enumType;if(!u)throw new Error("Incorrect data in the EXT_structural_metadata extension: classProperty.enumType is not set for type ENUM");const d=(D=t.enums)==null?void 0:D[u];if(!d)throw new Error(`Incorrect data in the EXT_structural_metadata extension: schema.enums does't contain ${u}`);const a=d.valueType||"UINT16",x=Mm(e.type,a),A=r.byteLength/x;let M=Df(r,e.type,a,A);if(M||(M=r),e.array){if(o)return CL({valuesData:M,numberOfElements:i,arrayOffsets:o,valuesDataBytesLength:r.length,elementSize:x,enumEntry:d});const N=e.count;return N?IL(M,i,N,d):[]}return Pm(M,0,i,d)}function CL(t){const{valuesData:e,numberOfElements:i,arrayOffsets:r,valuesDataBytesLength:o,elementSize:u,enumEntry:d}=t,a=[];for(let x=0;x<i;x++){const A=r[x],M=r[x+1]-r[x];if(M+A>o)break;const D=A/u,N=M/u,U=Pm(e,D,N,d);a.push(U)}return a}function IL(t,e,i,r){const o=[];for(let u=0;u<e;u++){const d=i*u,a=Pm(t,d,i,r);o.push(a)}return o}function Pm(t,e,i,r){const o=[];for(let u=0;u<i;u++)if(t instanceof BigInt64Array||t instanceof BigUint64Array)o.push("");else{const d=t[e+u],a=ML(r,d);a?o.push(a.name):o.push("")}return o}function ML(t,e){for(const i of t.values)if(i.value===e)return i;return null}const RL="schemaClassId";function PL(t,e){var r,o;const i=t.getExtension(bc);if(i&&i.propertyTables)for(const u of i.propertyTables){const d=u.class,a=(o=(r=i.schema)==null?void 0:r.classes)==null?void 0:o[d];u.properties&&a&&BL(u,a,t)}}function BL(t,e,i){for(const r in t.properties){const o=t.properties[r].data;if(o){const u=e.properties[r];if(u){const d=kL(o,u,i);t.properties[r]=d}}}}function DL(t,e,i=RL){let r=t.getExtension(bc);r||(r=t.addExtension(bc)),r.schema=OL(e,i,r.schema);const o=FL(e,i,r.schema);return r.propertyTables||(r.propertyTables=[]),r.propertyTables.push(o)-1}function OL(t,e,i){const r=i??{id:"schema_id"},o={properties:{}};for(const u of t){const d={type:u.elementType,componentType:u.componentType};o.properties[u.name]=d}return r.classes={},r.classes[e]=o,r}function FL(t,e,i){var d;const r={class:e,count:0};let o=0;const u=(d=i.classes)==null?void 0:d[e];for(const a of t){if(o===0&&(o=a.values.length),o!==a.values.length&&a.values.length)throw new Error("Illegal values in attributes");(u==null?void 0:u.properties[a.name])&&(r.properties||(r.properties={}),r.properties[a.name]={values:0,data:a.values})}return r.count=o,r}function kL(t,e,i){const r={values:0};if(e.type==="STRING"){const{stringData:o,stringOffsets:u}=UL(t);r.stringOffsets=Bm(u,i),r.values=Bm(o,i)}else if(e.type==="SCALAR"&&e.componentType){const o=LL(t,e.componentType);r.values=Bm(o,i)}return r}const NL={INT8:Int8Array,UINT8:Uint8Array,INT16:Int16Array,UINT16:Uint16Array,INT32:Int32Array,UINT32:Uint32Array,INT64:Int32Array,UINT64:Uint32Array,FLOAT32:Float32Array,FLOAT64:Float64Array};function LL(t,e){const i=[];for(const o of t)i.push(Number(o));const r=NL[e];if(!r)throw new Error("Illegal component type");return new r(i)}function UL(t){const e=new TextEncoder,i=[];let r=0;for(const x of t){const A=e.encode(x);r+=A.length,i.push(A)}const o=new Uint8Array(r),u=[];let d=0;for(const x of i)o.set(x,d),u.push(d),d+=x.length;u.push(d);const a=new Uint32Array(u);return{stringData:o,stringOffsets:a}}function Bm(t,e){return e.gltf.buffers.push({arrayBuffer:t.buffer,byteOffset:t.byteOffset,byteLength:t.byteLength}),e.addBufferView(t)}const zL=Object.freeze(Object.defineProperty({__proto__:null,createExtStructuralMetadata:DL,decode:fL,encode:pL,name:dL},Symbol.toStringTag,{value:"Module"})),Iw="EXT_feature_metadata",VL=Iw;async function jL(t,e){const i=new Cr(t);HL(i,e)}function HL(t,e){var r,o;if(!((r=e.gltf)!=null&&r.loadBuffers))return;const i=t.getExtension(Iw);i&&((o=e.gltf)!=null&&o.loadImages&&$L(t,i),WL(t,i))}function $L(t,e){const i=e.schema;if(!i)return;const r=i.classes,{featureTextures:o}=e;if(r&&o)for(const u in r){const d=r[u],a=qL(o,u);a&&KL(t,a,d)}}function WL(t,e){const i=e.schema;if(!i)return;const r=i.classes,o=e.featureTables;if(r&&o)for(const u in r){const d=XL(o,u);d&&ZL(t,i,d)}}function XL(t,e){for(const i in t){const r=t[i];if(r.class===e)return r}return null}function qL(t,e){for(const i in t){const r=t[i];if(r.class===e)return r}return null}function ZL(t,e,i){var u,d;if(!i.class)return;const r=(u=e.classes)==null?void 0:u[i.class];if(!r)throw new Error(`Incorrect data in the EXT_structural_metadata extension: no schema class with name ${i.class}`);const o=i.count;for(const a in r.properties){const x=r.properties[a],A=(d=i.properties)==null?void 0:d[a];if(A){const M=YL(t,e,x,o,A);A.data=M}}}function KL(t,e,i){var o;const r=e.class;for(const u in i.properties){const d=(o=e==null?void 0:e.properties)==null?void 0:o[u];if(d){const a=iU(t,d,r);d.data=a}}}function YL(t,e,i,r,o){let u=[];const d=o.bufferView,a=t.getTypedArrayForBufferView(d),x=JL(t,i,o,r),A=QL(t,i,o,r);return i.type==="STRING"||i.componentType==="STRING"?u=Cw(r,a,x,A):eU(i)&&(u=tU(i,r,a,x)),u}function JL(t,e,i,r){return e.type==="ARRAY"&&typeof e.componentCount>"u"&&typeof i.arrayOffsetBufferView<"u"?Bf(t,i.arrayOffsetBufferView,i.offsetType||"UINT32",r):null}function QL(t,e,i,r){return typeof i.stringOffsetBufferView<"u"?Bf(t,i.stringOffsetBufferView,i.offsetType||"UINT32",r):null}function eU(t){const e=["UINT8","INT16","UINT16","INT32","UINT32","INT64","UINT64","FLOAT32","FLOAT64"];return e.includes(t.type)||typeof t.componentType<"u"&&e.includes(t.componentType)}function tU(t,e,i,r){const o=t.type==="ARRAY",u=t.componentCount,d="SCALAR",a=t.componentType||t.type,x=Mm(d,a),A=i.byteLength/x,M=Df(i,d,a,A);return o?r?Ew(M,e,r,i.length,x):u?Sw(M,e,u):[]:M}function iU(t,e,i){const r=t.gltf.json;if(!r.meshes)return[];const o=[];for(const u of r.meshes)for(const d of u.primitives)rU(t,i,e,o,d);return o}function rU(t,e,i,r,o){const u={channels:i.channels,...i.texture},d=Rm(t,u,o);d&&Aw(t,e,d,r,o)}const sU=Object.freeze(Object.defineProperty({__proto__:null,decode:jL,name:VL},Symbol.toStringTag,{value:"Module"})),nU="4.3.1",vc=!0,Mw=1735152710,Dm=12,Of=8,oU=1313821514,aU=5130562,lU=0,cU=0,hU=1;function uU(t,e=0){return`${String.fromCharCode(t.getUint8(e+0))}${String.fromCharCode(t.getUint8(e+1))}${String.fromCharCode(t.getUint8(e+2))}${String.fromCharCode(t.getUint8(e+3))}`}function dU(t,e=0,i={}){const r=new DataView(t),{magic:o=Mw}=i,u=r.getUint32(e,!1);return u===o||u===Mw}function fU(t,e,i=0,r={}){const o=new DataView(e),u=uU(o,i+0),d=o.getUint32(i+4,vc),a=o.getUint32(i+8,vc);switch(Object.assign(t,{header:{byteOffset:i,byteLength:a,hasBinChunk:!1},type:u,version:d,json:{},binChunks:[]}),i+=Dm,t.version){case 1:return pU(t,o,i);case 2:return _U(t,o,i,r={});default:throw new Error(`Invalid GLB version ${t.version}. Only supports version 1 and 2.`)}}function pU(t,e,i){mi(t.header.byteLength>Dm+Of);const r=e.getUint32(i+0,vc),o=e.getUint32(i+4,vc);return i+=Of,mi(o===lU),Om(t,e,i,r),i+=r,i+=Fm(t,e,i,t.header.byteLength),i}function _U(t,e,i,r){return mi(t.header.byteLength>Dm+Of),gU(t,e,i,r),i+t.header.byteLength}function gU(t,e,i,r){for(;i+8<=t.header.byteLength;){const o=e.getUint32(i+0,vc),u=e.getUint32(i+4,vc);switch(i+=Of,u){case oU:Om(t,e,i,o);break;case aU:Fm(t,e,i,o);break;case cU:r.strict||Om(t,e,i,o);break;case hU:r.strict||Fm(t,e,i,o);break}i+=Ch(o,4)}return i}function Om(t,e,i,r){const o=new Uint8Array(e.buffer,i,r),d=new TextDecoder("utf8").decode(o);return t.json=JSON.parse(d),Ch(r,4)}function Fm(t,e,i,r){return t.header.hasBinChunk=!0,t.binChunks.push({byteOffset:i,byteLength:r,arrayBuffer:e.buffer}),Ch(r,4)}function Rw(t,e){if(t.startsWith("data:")||t.startsWith("http:")||t.startsWith("https:"))return t;const r=e.baseUri||e.uri;if(!r)throw new Error(`'baseUri' must be provided to resolve relative url ${t}`);return r.substr(0,r.lastIndexOf("/")+1)+t}const mU="B9h9z9tFBBBF8fL9gBB9gLaaaaaFa9gEaaaB9gFaFa9gEaaaFaEMcBFFFGGGEIIILF9wFFFLEFBFKNFaFCx/IFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBF8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBGy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBEn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBIi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBKI9z9iqlBOc+x8ycGBM/qQFTa8jUUUUBCU/EBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAGTkUUUBRNCUoBAG9uC/wgBZHKCUGAKCUG9JyRVAECFJRICBRcGXEXAcAF9PQFAVAFAclAcAVJAF9JyRMGXGXAG9FQBAMCbJHKC9wZRSAKCIrCEJCGrRQANCUGJRfCBRbAIRTEXGXAOATlAQ9PQBCBRISEMATAQJRIGXAS9FQBCBRtCBREEXGXAOAIlCi9PQBCBRISLMANCU/CBJAEJRKGXGXGXGXGXATAECKrJ2BBAtCKZrCEZfIBFGEBMAKhB83EBAKCNJhB83EBSEMAKAI2BIAI2BBHmCKrHYAYCE6HYy86BBAKCFJAICIJAYJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCGJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCEJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCIJAYAmJHY2BBAI2BFHmCKrHPAPCE6HPy86BBAKCLJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCKJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCOJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCNJAYAmJHY2BBAI2BGHmCKrHPAPCE6HPy86BBAKCVJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCcJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCMJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCSJAYAmJHm2BBAI2BEHICKrHYAYCE6HYy86BBAKCQJAmAYJHm2BBAICIrCEZHYAYCE6HYy86BBAKCfJAmAYJHm2BBAICGrCEZHYAYCE6HYy86BBAKCbJAmAYJHK2BBAICEZHIAICE6HIy86BBAKAIJRISGMAKAI2BNAI2BBHmCIrHYAYCb6HYy86BBAKCFJAICNJAYJHY2BBAmCbZHmAmCb6Hmy86BBAKCGJAYAmJHm2BBAI2BFHYCIrHPAPCb6HPy86BBAKCEJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCIJAmAYJHm2BBAI2BGHYCIrHPAPCb6HPy86BBAKCLJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCKJAmAYJHm2BBAI2BEHYCIrHPAPCb6HPy86BBAKCOJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCNJAmAYJHm2BBAI2BIHYCIrHPAPCb6HPy86BBAKCVJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCcJAmAYJHm2BBAI2BLHYCIrHPAPCb6HPy86BBAKCMJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCSJAmAYJHm2BBAI2BKHYCIrHPAPCb6HPy86BBAKCQJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCfJAmAYJHm2BBAI2BOHICIrHYAYCb6HYy86BBAKCbJAmAYJHK2BBAICbZHIAICb6HIy86BBAKAIJRISFMAKAI8pBB83BBAKCNJAICNJ8pBB83BBAICTJRIMAtCGJRtAECTJHEAS9JQBMMGXAIQBCBRISEMGXAM9FQBANAbJ2BBRtCBRKAfREEXAEANCU/CBJAKJ2BBHTCFrCBATCFZl9zAtJHt86BBAEAGJREAKCFJHKAM9HQBMMAfCFJRfAIRTAbCFJHbAG9HQBMMABAcAG9sJANCUGJAMAG9sTkUUUBpANANCUGJAMCaJAG9sJAGTkUUUBpMAMCBAIyAcJRcAIQBMC9+RKSFMCBC99AOAIlAGCAAGCA9Ly6yRKMALCU/EBJ8kUUUUBAKM+OmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUFT+JUUUBpALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM+lLKFaF99GaG99FaG99GXGXAGCI9HQBAF9FQFEXGXGX9DBBB8/9DBBB+/ABCGJHG1BB+yAB1BBHE+yHI+L+TABCFJHL1BBHK+yHO+L+THN9DBBBB9gHVyAN9DBB/+hANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE86BBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG86BBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG86BBABCIJRBAFCaJHFQBSGMMAF9FQBEXGXGX9DBBB8/9DBBB+/ABCIJHG8uFB+yAB8uFBHE+yHI+L+TABCGJHL8uFBHK+yHO+L+THN9DBBBB9gHVyAN9DB/+g6ANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE87FBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG87FBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG87FBABCNJRBAFCaJHFQBMMM/SEIEaE99EaF99GXAF9FQBCBREABRIEXGXGX9D/zI818/AICKJ8uFBHLCEq+y+VHKAI8uFB+y+UHO9DB/+g6+U9DBBB8/9DBBB+/AO9DBBBB9gy+SHN+L9DBBB9P9d9FQBAN+oRVSFMCUUUU94RVMAICIJ8uFBRcAICGJ8uFBRMABALCFJCEZAEqCFWJAV87FBGXGXAKAM+y+UHN9DB/+g6+U9DBBB8/9DBBB+/AN9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRMSFMCUUUU94RMMABALCGJCEZAEqCFWJAM87FBGXGXAKAc+y+UHK9DB/+g6+U9DBBB8/9DBBB+/AK9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRcSFMCUUUU94RcMABALCaJCEZAEqCFWJAc87FBGXGX9DBBU8/AOAO+U+TANAN+U+TAKAK+U+THO9DBBBBAO9DBBBB9gy+R9DB/+g6+U9DBBB8/+SHO+L9DBBB9P9d9FQBAO+oRcSFMCUUUU94RcMABALCEZAEqCFWJAc87FBAICNJRIAECIJREAFCaJHFQBMMM9JBGXAGCGrAF9sHF9FQBEXABAB8oGBHGCNWCN91+yAGCi91CnWCUUU/8EJ+++U84GBABCIJRBAFCaJHFQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEM/lFFFaGXGXAFABqCEZ9FQBABRESFMGXGXAGCT9PQBABRESFMABREEXAEAF8oGBjGBAECIJAFCIJ8oGBjGBAECNJAFCNJ8oGBjGBAECSJAFCSJ8oGBjGBAECTJREAFCTJRFAGC9wJHGCb9LQBMMAGCI9JQBEXAEAF8oGBjGBAFCIJRFAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF2BB86BBAECFJREAFCFJRFAGCaJHGQBMMABMoFFGaGXGXABCEZ9FQBABRESFMAFCgFZC+BwsN9sRIGXGXAGCT9PQBABRESFMABREEXAEAIjGBAECSJAIjGBAECNJAIjGBAECIJAIjGBAECTJREAGC9wJHGCb9LQBMMAGCI9JQBEXAEAIjGBAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF86BBAECFJREAGCaJHGQBMMABMMMFBCUNMIT9kBB",yU="B9h9z9tFBBBF8dL9gBB9gLaaaaaFa9gEaaaB9gGaaB9gFaFaEQSBBFBFFGEGEGIILF9wFFFLEFBFKNFaFCx/aFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBG8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBIy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBKi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBNn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBcI9z9iqlBMc/j9JSIBTEM9+FLa8jUUUUBCTlRBCBRFEXCBRGCBREEXABCNJAGJAECUaAFAGrCFZHIy86BBAEAIJREAGCFJHGCN9HQBMAFCx+YUUBJAE86BBAFCEWCxkUUBJAB8pEN83EBAFCFJHFCUG9HQBMMkRIbaG97FaK978jUUUUBCU/KBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAG/8cBBCUoBAG9uC/wgBZHKCUGAKCUG9JyRNAECFJRKCBRVGXEXAVAF9PQFANAFAVlAVANJAF9JyRcGXGXAG9FQBAcCbJHIC9wZHMCE9sRSAMCFWRQAICIrCEJCGrRfCBRbEXAKRTCBRtGXEXGXAOATlAf9PQBCBRKSLMALCU/CBJAtAM9sJRmATAfJRKCBREGXAMCoB9JQBAOAKlC/gB9JQBCBRIEXAmAIJREGXGXGXGXGXATAICKrJ2BBHYCEZfIBFGEBMAECBDtDMIBSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIBAKCTJRKMGXGXGXGXGXAYCGrCEZfIBFGEBMAECBDtDMITSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMITAKCTJRKMGXGXGXGXGXAYCIrCEZfIBFGEBMAECBDtDMIASEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIAAKCTJRKMGXGXGXGXGXAYCKrfIBFGEBMAECBDtDMI8wSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCIJAnDeBJAYCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCNJAnDeBJAYCx+YUUBJ2BBJRKSFMAEAKDBBBDMI8wAKCTJRKMAICoBJREAICUFJAM9LQFAERIAOAKlC/fB9LQBMMGXAEAM9PQBAECErRIEXGXAOAKlCi9PQBCBRKSOMAmAEJRYGXGXGXGXGXATAECKrJ2BBAICKZrCEZfIBFGEBMAYCBDtDMIBSEMAYAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAYAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAYAKDBBBDMIBAKCTJRKMAICGJRIAECTJHEAM9JQBMMGXAK9FQBAKRTAtCFJHtCI6QGSFMMCBRKSEMGXAM9FQBALCUGJAbJREALAbJDBGBRnCBRYEXAEALCU/CBJAYJHIDBIBHdCFD9tAdCFDbHPD9OD9hD9RHdAIAMJDBIBHiCFD9tAiAPD9OD9hD9RHiDQBTFtGmEYIPLdKeOnH8ZAIAQJDBIBHpCFD9tApAPD9OD9hD9RHpAIASJDBIBHyCFD9tAyAPD9OD9hD9RHyDQBTFtGmEYIPLdKeOnH8cDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGEAnD9uHnDyBjGBAEAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnA8ZA8cDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNiV8ZcpMyS8cQ8df8eb8fHdApAyDQNiV8ZcpMyS8cQ8df8eb8fHiDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJREAYCTJHYAM9JQBMMAbCIJHbAG9JQBMMABAVAG9sJALCUGJAcAG9s/8cBBALALCUGJAcCaJAG9sJAG/8cBBMAcCBAKyAVJRVAKQBMC9+RKSFMCBC99AOAKlAGCAAGCA9Ly6yRKMALCU/KBJ8kUUUUBAKMNBT+BUUUBM+KmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUF/8MBALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM/xLGEaK978jUUUUBCAlHE8kUUUUBGXGXAGCI9HQBGXAFC98ZHI9FQBABRGCBRLEXAGAGDBBBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMBBAGCTJRGALCIJHLAI9JQBMMAIAF9PQFAEAFCEZHLCGWHGqCBCTAGl/8MBAEABAICGWJHIAG/8cBBGXAL9FQBAEAEDBIBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMIBMAIAEAG/8cBBSFMABAFC98ZHGT+HUUUBAGAF9PQBAEAFCEZHICEWHLJCBCAALl/8MBAEABAGCEWJHGAL/8cBBAEAIT+HUUUBAGAEAL/8cBBMAECAJ8kUUUUBM+yEGGaO97GXAF9FQBCBRGEXABCTJHEAEDBBBHICBDtHLCUU98D8cFCUU98D8cEHKD9OABDBBBHOAIDQILKOSQfbPden8c8d8e8fCggFDtD9OD/6FAOAIDQBFGENVcMTtmYi8ZpyHICTD+sFD/6FHND/gFAICTD+rFCTD+sFD/6FHVD/gFD/kFD/lFHI9DB/+g6DYAVAIALD+2FHLAVCUUUU94DtHcD9OD9RD/kFHVAVD/mFAIAID/mFANALANAcD9OD9RD/kFHIAID/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHLD/kFCTD+rFAVAND/mFALD/kFCggEDtD9OD9QHVAIAND/mFALD/kFCaDbCBDnGCBDnECBDnKCBDnOCBDncCBDnMCBDnfCBDnbD9OHIDQNVi8ZcMpySQ8c8dfb8e8fD9QDMBBABAOAKD9OAVAIDQBFTtGEmYILPdKOenD9QDMBBABCAJRBAGCIJHGAF9JQBMMM94FEa8jUUUUBCAlHE8kUUUUBABAFC98ZHIT+JUUUBGXAIAF9PQBAEAFCEZHLCEWHFJCBCAAFl/8MBAEABAICEWJHBAF/8cBBAEALT+JUUUBABAEAF/8cBBMAECAJ8kUUUUBM/hEIGaF97FaL978jUUUUBCTlRGGXAF9FQBCBREEXAGABDBBBHIABCTJHLDBBBHKDQILKOSQfbPden8c8d8e8fHOCTD+sFHNCID+rFDMIBAB9DBBU8/DY9D/zI818/DYANCEDtD9QD/6FD/nFHNAIAKDQBFGENVcMTtmYi8ZpyHICTD+rFCTD+sFD/6FD/mFHKAKD/mFANAICTD+sFD/6FD/mFHVAVD/mFANAOCTD+rFCTD+sFD/6FD/mFHOAOD/mFD/kFD/kFD/lFCBDtD+4FD/jF9DB/+g6DYHND/mF9DBBX9LDYHID/kFCggEDtHcD9OAVAND/mFAID/kFCTD+rFD9QHVAOAND/mFAID/kFCTD+rFAKAND/mFAID/kFAcD9OD9QHNDQBFTtGEmYILPdKOenHID8dBAGDBIBDyB+t+J83EBABCNJAID8dFAGDBIBDyF+t+J83EBALAVANDQNVi8ZcMpySQ8c8dfb8e8fHND8dBAGDBIBDyG+t+J83EBABCiJAND8dFAGDBIBDyE+t+J83EBABCAJRBAECIJHEAF9JQBMMM/3FGEaF978jUUUUBCoBlREGXAGCGrAF9sHIC98ZHL9FQBCBRGABRFEXAFAFDBBBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMBBAFCTJRFAGCIJHGAL9JQBMMGXALAI9PQBAEAICEZHGCGWHFqCBCoBAFl/8MBAEABALCGWJHLAF/8cBBGXAG9FQBAEAEDBIBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMIBMALAEAF/8cBBMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEMMMFBCUNMIT9tBB",bU=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),vU=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]),xU={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},wU={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};async function TU(t,e,i,r,o,u="NONE"){const d=await AU();CU(d,d.exports[wU[o]],t,e,i,r,d.exports[xU[u||"NONE"]])}let km;async function AU(){return km||(km=EU()),km}async function EU(){let t=mU;WebAssembly.validate(bU)&&(t=yU,console.log("Warning: meshopt_decoder is using experimental SIMD support"));const e=await WebAssembly.instantiate(SU(t),{});return await e.instance.exports.__wasm_call_ctors(),e.instance}function SU(t){const e=new Uint8Array(t.length);for(let r=0;r<t.length;++r){const o=t.charCodeAt(r);e[r]=o>96?o-71:o>64?o-65:o>47?o+4:o>46?63:62}let i=0;for(let r=0;r<t.length;++r)e[i++]=e[r]<60?vU[e[r]]:(e[r]-60)*64+e[++r];return e.buffer.slice(0,i)}function CU(t,e,i,r,o,u,d){const a=t.exports.sbrk,x=r+3&-4,A=a(x*o),M=a(u.length),D=new Uint8Array(t.exports.memory.buffer);D.set(u,M);const N=e(A,r,o,M,u.length);if(N===0&&d&&d(A,x,o),i.set(D.subarray(A,A+r*o)),a(A-a(0)),N!==0)throw new Error(`Malformed buffer data: ${N}`)}const Ff="EXT_meshopt_compression",IU=Ff;async function MU(t,e){var o,u;const i=new Cr(t);if(!((o=e==null?void 0:e.gltf)!=null&&o.decompressMeshes)||!((u=e.gltf)!=null&&u.loadBuffers))return;const r=[];for(const d of t.json.bufferViews||[])r.push(RU(i,d));await Promise.all(r),i.removeExtension(Ff)}async function RU(t,e){const i=t.getObjectExtension(e,Ff);if(i){const{byteOffset:r=0,byteLength:o=0,byteStride:u,count:d,mode:a,filter:x="NONE",buffer:A}=i,M=t.gltf.buffers[A],D=new Uint8Array(M.arrayBuffer,M.byteOffset+r,o),N=new Uint8Array(t.gltf.buffers[e.buffer].arrayBuffer,e.byteOffset,e.byteLength);await TU(N,d,u,D,a,x),t.removeObjectExtension(e,Ff)}}const PU=Object.freeze(Object.defineProperty({__proto__:null,decode:MU,name:IU},Symbol.toStringTag,{value:"Module"})),xc="EXT_texture_webp",BU=xc;function DU(t,e){const i=new Cr(t);if(!A2("image/webp")){if(i.getRequiredExtensions().includes(xc))throw new Error(`gltf: Required extension ${xc} not supported by browser`);return}const{json:r}=i;for(const o of r.textures||[]){const u=i.getObjectExtension(o,xc);u&&(o.source=u.source),i.removeObjectExtension(o,xc)}i.removeExtension(xc)}const OU=Object.freeze(Object.defineProperty({__proto__:null,name:BU,preprocess:DU},Symbol.toStringTag,{value:"Module"})),kf="KHR_texture_basisu",FU=kf;function kU(t,e){const i=new Cr(t),{json:r}=i;for(const o of r.textures||[]){const u=i.getObjectExtension(o,kf);u&&(o.source=u.source,i.removeObjectExtension(o,kf))}i.removeExtension(kf)}const NU=Object.freeze(Object.defineProperty({__proto__:null,name:FU,preprocess:kU},Symbol.toStringTag,{value:"Module"})),LU={dataType:null,batchType:null,name:"Draco",id:"draco",module:"draco",version:"4.3.1",worker:!0,extensions:["drc"],mimeTypes:["application/octet-stream"],binary:!0,tests:["DRACO"],options:{draco:{decoderType:typeof WebAssembly=="object"?"wasm":"js",libraryPath:"libs/",extraAttributes:{},attributeNameEntry:void 0}}};function UU(t,e,i){const r=Bw(e.metadata),o=[],u=zU(e.attributes);for(const d in t){const a=t[d],x=Pw(d,a,u[d]);o.push(x)}if(i){const d=Pw("indices",i);o.push(d)}return{fields:o,metadata:r}}function zU(t){const e={};for(const i in t){const r=t[i];e[r.name||"undefined"]=r}return e}function Pw(t,e,i){const r=i?Bw(i.metadata):void 0;return qC(t,e,r)}function Bw(t){Object.entries(t);const e={};for(const i in t)e[`${i}.string`]=JSON.stringify(t[i]);return e}const Dw={POSITION:"POSITION",NORMAL:"NORMAL",COLOR:"COLOR_0",TEX_COORD:"TEXCOORD_0"},VU={1:Int8Array,2:Uint8Array,3:Int16Array,4:Uint16Array,5:Int32Array,6:Uint32Array,9:Float32Array},jU=4;class HU{constructor(e){L(this,"draco");L(this,"decoder");L(this,"metadataQuerier");this.draco=e,this.decoder=new this.draco.Decoder,this.metadataQuerier=new this.draco.MetadataQuerier}destroy(){this.draco.destroy(this.decoder),this.draco.destroy(this.metadataQuerier)}parseSync(e,i={}){const r=new this.draco.DecoderBuffer;r.Init(new Int8Array(e),e.byteLength),this._disableAttributeTransforms(i);const o=this.decoder.GetEncodedGeometryType(r),u=o===this.draco.TRIANGULAR_MESH?new this.draco.Mesh:new this.draco.PointCloud;try{let d;switch(o){case this.draco.TRIANGULAR_MESH:d=this.decoder.DecodeBufferToMesh(r,u);break;case this.draco.POINT_CLOUD:d=this.decoder.DecodeBufferToPointCloud(r,u);break;default:throw new Error("DRACO: Unknown geometry type.")}if(!d.ok()||!u.ptr){const N=`DRACO decompression failed: ${d.error_msg()}`;throw new Error(N)}const a=this._getDracoLoaderData(u,o,i),x=this._getMeshData(u,a,i),A=Tb(x.attributes),M=UU(x.attributes,a,x.indices);return{loader:"draco",loaderData:a,header:{vertexCount:u.num_points(),boundingBox:A},...x,schema:M}}finally{this.draco.destroy(r),u&&this.draco.destroy(u)}}_getDracoLoaderData(e,i,r){const o=this._getTopLevelMetadata(e),u=this._getDracoAttributes(e,r);return{geometry_type:i,num_attributes:e.num_attributes(),num_points:e.num_points(),num_faces:e instanceof this.draco.Mesh?e.num_faces():0,metadata:o,attributes:u}}_getDracoAttributes(e,i){const r={};for(let o=0;o<e.num_attributes();o++){const u=this.decoder.GetAttribute(e,o),d=this._getAttributeMetadata(e,o);r[u.unique_id()]={unique_id:u.unique_id(),attribute_type:u.attribute_type(),data_type:u.data_type(),num_components:u.num_components(),byte_offset:u.byte_offset(),byte_stride:u.byte_stride(),normalized:u.normalized(),attribute_index:o,metadata:d};const a=this._getQuantizationTransform(u,i);a&&(r[u.unique_id()].quantization_transform=a);const x=this._getOctahedronTransform(u,i);x&&(r[u.unique_id()].octahedron_transform=x)}return r}_getMeshData(e,i,r){const o=this._getMeshAttributes(i,e,r);if(!o.POSITION)throw new Error("DRACO: No position attribute found.");if(e instanceof this.draco.Mesh)switch(r.topology){case"triangle-strip":return{topology:"triangle-strip",mode:4,attributes:o,indices:{value:this._getTriangleStripIndices(e),size:1}};case"triangle-list":default:return{topology:"triangle-list",mode:5,attributes:o,indices:{value:this._getTriangleListIndices(e),size:1}}}return{topology:"point-list",mode:0,attributes:o}}_getMeshAttributes(e,i,r){const o={};for(const u of Object.values(e.attributes)){const d=this._deduceAttributeName(u,r);u.name=d;const a=this._getAttributeValues(i,u);if(a){const{value:x,size:A}=a;o[d]={value:x,size:A,byteOffset:u.byte_offset,byteStride:u.byte_stride,normalized:u.normalized}}}return o}_getTriangleListIndices(e){const r=e.num_faces()*3,o=r*jU,u=this.draco._malloc(o);try{return this.decoder.GetTrianglesUInt32Array(e,o,u),new Uint32Array(this.draco.HEAPF32.buffer,u,r).slice()}finally{this.draco._free(u)}}_getTriangleStripIndices(e){const i=new this.draco.DracoInt32Array;try{return this.decoder.GetTriangleStripsFromMesh(e,i),WU(i)}finally{this.draco.destroy(i)}}_getAttributeValues(e,i){const r=VU[i.data_type];if(!r)return console.warn(`DRACO: Unsupported attribute type ${i.data_type}`),null;const o=i.num_components,d=e.num_points()*o,a=d*r.BYTES_PER_ELEMENT,x=GU(this.draco,r);let A;const M=this.draco._malloc(a);try{const D=this.decoder.GetAttribute(e,i.attribute_index);this.decoder.GetAttributeDataArrayForAllPoints(e,D,x,a,M),A=new r(this.draco.HEAPF32.buffer,M,d).slice()}finally{this.draco._free(M)}return{value:A,size:o}}_deduceAttributeName(e,i){const r=e.unique_id;for(const[d,a]of Object.entries(i.extraAttributes||{}))if(a===r)return d;const o=e.attribute_type;for(const d in Dw)if(this.draco[d]===o)return Dw[d];const u=i.attributeNameEntry||"name";return e.metadata[u]?e.metadata[u].string:`CUSTOM_ATTRIBUTE_${r}`}_getTopLevelMetadata(e){const i=this.decoder.GetMetadata(e);return this._getDracoMetadata(i)}_getAttributeMetadata(e,i){const r=this.decoder.GetAttributeMetadata(e,i);return this._getDracoMetadata(r)}_getDracoMetadata(e){if(!e||!e.ptr)return{};const i={},r=this.metadataQuerier.NumEntries(e);for(let o=0;o<r;o++){const u=this.metadataQuerier.GetEntryName(e,o);i[u]=this._getDracoMetadataField(e,u)}return i}_getDracoMetadataField(e,i){const r=new this.draco.DracoInt32Array;try{this.metadataQuerier.GetIntEntryArray(e,i,r);const o=$U(r);return{int:this.metadataQuerier.GetIntEntry(e,i),string:this.metadataQuerier.GetStringEntry(e,i),double:this.metadataQuerier.GetDoubleEntry(e,i),intArray:o}}finally{this.draco.destroy(r)}}_disableAttributeTransforms(e){const{quantizedAttributes:i=[],octahedronAttributes:r=[]}=e,o=[...i,...r];for(const u of o)this.decoder.SkipAttributeTransform(this.draco[u])}_getQuantizationTransform(e,i){const{quantizedAttributes:r=[]}=i,o=e.attribute_type();if(r.map(d=>this.decoder[d]).includes(o)){const d=new this.draco.AttributeQuantizationTransform;try{if(d.InitFromAttribute(e))return{quantization_bits:d.quantization_bits(),range:d.range(),min_values:new Float32Array([1,2,3]).map(a=>d.min_value(a))}}finally{this.draco.destroy(d)}}return null}_getOctahedronTransform(e,i){const{octahedronAttributes:r=[]}=i,o=e.attribute_type();if(r.map(d=>this.decoder[d]).includes(o)){const d=new this.draco.AttributeQuantizationTransform;try{if(d.InitFromAttribute(e))return{quantization_bits:d.quantization_bits()}}finally{this.draco.destroy(d)}}return null}}function GU(t,e){switch(e){case Float32Array:return t.DT_FLOAT32;case Int8Array:return t.DT_INT8;case Int16Array:return t.DT_INT16;case Int32Array:return t.DT_INT32;case Uint8Array:return t.DT_UINT8;case Uint16Array:return t.DT_UINT16;case Uint32Array:return t.DT_UINT32;default:return t.DT_INVALID}}function $U(t){const e=t.size(),i=new Int32Array(e);for(let r=0;r<e;r++)i[r]=t.GetValue(r);return i}function WU(t){const e=t.size(),i=new Int32Array(e);for(let r=0;r<e;r++)i[r]=t.GetValue(r);return i}const XU="1.5.6",qU="1.4.1",Nm=`https://www.gstatic.com/draco/versioned/decoders/${XU}`,ds={DECODER:"draco_wasm_wrapper.js",DECODER_WASM:"draco_decoder.wasm",FALLBACK_DECODER:"draco_decoder.js",ENCODER:"draco_encoder.js"},Lm={[ds.DECODER]:`${Nm}/${ds.DECODER}`,[ds.DECODER_WASM]:`${Nm}/${ds.DECODER_WASM}`,[ds.FALLBACK_DECODER]:`${Nm}/${ds.FALLBACK_DECODER}`,[ds.ENCODER]:`https://raw.githubusercontent.com/google/draco/${qU}/javascript/${ds.ENCODER}`};let Um;async function ZU(t){const e=t.modules||{};return e.draco3d?Um||(Um=e.draco3d.createDecoderModule({}).then(i=>({draco:i}))):Um||(Um=KU(t)),await Um}async function KU(t){let e,i;switch(t.draco&&t.draco.decoderType){case"js":e=await Fa(Lm[ds.FALLBACK_DECODER],"draco",t,ds.FALLBACK_DECODER);break;case"wasm":default:[e,i]=await Promise.all([await Fa(Lm[ds.DECODER],"draco",t,ds.DECODER),await Fa(Lm[ds.DECODER_WASM],"draco",t,ds.DECODER_WASM)])}return e=e||globalThis.DracoDecoderModule,await YU(e,i)}function YU(t,e){const i={};return e&&(i.wasmBinary=e),new Promise(r=>{t({...i,onModuleLoaded:o=>r({draco:o})})})}const Ow={...LU,parse:JU};async function JU(t,e){const{draco:i}=await ZU(e),r=new HU(i);try{return r.parseSync(t,e==null?void 0:e.draco)}finally{r.destroy()}}function QU(t){const e={};for(const i in t){const r=t[i];if(i!=="indices"){const o=Fw(r);e[i]=o}}return e}function Fw(t){const{buffer:e,size:i,count:r}=ez(t);return{value:e,size:i,byteOffset:0,count:r,type:bw(i),componentType:Pf(e)}}function ez(t){let e=t,i=1,r=0;return t&&t.value&&(e=t.value,i=t.size||1),e&&(ArrayBuffer.isView(e)||(e=tz(e,Float32Array)),r=e.length/i),{buffer:e,size:i,count:r}}function tz(t,e,i=!1){return t?Array.isArray(t)?new e(t):i&&!(t instanceof e)?new e(t):t:null}const Ka="KHR_draco_mesh_compression",iz=Ka;function rz(t,e,i){const r=new Cr(t);for(const o of kw(r))r.getObjectExtension(o,Ka)}async function sz(t,e,i){var u;if(!((u=e==null?void 0:e.gltf)!=null&&u.decompressMeshes))return;const r=new Cr(t),o=[];for(const d of kw(r))r.getObjectExtension(d,Ka)&&o.push(oz(r,d,e,i));await Promise.all(o),r.removeExtension(Ka)}function nz(t,e={}){const i=new Cr(t);for(const r of i.json.meshes||[])az(),i.addRequiredExtension(Ka)}async function oz(t,e,i,r){const o=t.getObjectExtension(e,Ka);if(!o)return;const u=t.getTypedArrayForBufferView(o.bufferView),d=S_(u.buffer,u.byteOffset),a={...i};delete a["3d-tiles"];const x=await Sh(d,Ow,a,r),A=QU(x.attributes);for(const[M,D]of Object.entries(A))if(M in e.attributes){const N=e.attributes[M],U=t.getAccessor(N);U!=null&&U.min&&(U!=null&&U.max)&&(D.min=U.min,D.max=U.max)}e.attributes=A,x.indices&&(e.indices=Fw(x.indices)),t.removeObjectExtension(e,Ka),lz(e)}function az(t,e,i=4,r,o){if(!r.DracoWriter)throw new Error("options.gltf.DracoWriter not provided")}function lz(t){if(!t.attributes&&Object.keys(t.attributes).length>0)throw new Error("glTF: Empty primitive detected: Draco decompression failure?")}function*kw(t){for(const e of t.json.meshes||[])for(const i of e.primitives)yield i}const cz=Object.freeze(Object.defineProperty({__proto__:null,decode:sz,encode:nz,name:iz,preprocess:rz},Symbol.toStringTag,{value:"Module"})),Nf="KHR_texture_transform",hz=Nf,Lf=new De,uz=new Hi,dz=new Hi;async function fz(t,e){var u;if(!new Cr(t).hasExtension(Nf)||!((u=e.gltf)!=null&&u.loadBuffers))return;const o=t.json.materials||[];for(let d=0;d<o.length;d++)pz(d,t)}function pz(t,e){var u,d,a,x;const i=(u=e.json.materials)==null?void 0:u[t],r=[(d=i==null?void 0:i.pbrMetallicRoughness)==null?void 0:d.baseColorTexture,i==null?void 0:i.emissiveTexture,i==null?void 0:i.normalTexture,i==null?void 0:i.occlusionTexture,(a=i==null?void 0:i.pbrMetallicRoughness)==null?void 0:a.metallicRoughnessTexture],o=[];for(const A of r)A&&((x=A==null?void 0:A.extensions)!=null&&x[Nf])&&_z(e,t,A,o)}function _z(t,e,i,r){const o=gz(i,r);if(!o)return;const u=t.json.meshes||[];for(const d of u)for(const a of d.primitives){const x=a.material;Number.isFinite(x)&&e===x&&mz(t,a,o)}}function gz(t,e){var d;const i=(d=t.extensions)==null?void 0:d[Nf],{texCoord:r=0}=t,{texCoord:o=r}=i;if(!(e.findIndex(([a,x])=>a===r&&x===o)!==-1)){const a=vz(i);return r!==o&&(t.texCoord=o),e.push([r,o]),{originalTexCoord:r,texCoord:o,matrix:a}}return null}function mz(t,e,i){var a,x;const{originalTexCoord:r,texCoord:o,matrix:u}=i,d=e.attributes[`TEXCOORD_${r}`];if(Number.isFinite(d)){const A=(a=t.json.accessors)==null?void 0:a[d];if(A&&A.bufferView){const M=(x=t.json.bufferViews)==null?void 0:x[A.bufferView];if(M){const{arrayBuffer:D,byteOffset:N}=t.buffers[M.buffer],U=(N||0)+(A.byteOffset||0)+(M.byteOffset||0),{ArrayType:re,length:ne}=Im(A,M),xe=mw[A.componentType],Ae=gw[A.type],Te=M.byteStride||xe*Ae,Ie=new Float32Array(ne);for(let Ue=0;Ue<A.count;Ue++){const Xe=new re(D,U+Ue*Te,2);Lf.set(Xe[0],Xe[1],1),Lf.transformByMatrix3(u),Ie.set([Lf[0],Lf[1]],Ue*Ae)}r===o?yz(A,M,t.buffers,Ie):bz(o,A,e,t,Ie)}}}}function yz(t,e,i,r){t.componentType=5126,i.push({arrayBuffer:r.buffer,byteOffset:0,byteLength:r.buffer.byteLength}),e.buffer=i.length-1,e.byteLength=r.buffer.byteLength,e.byteOffset=0,delete e.byteStride}function bz(t,e,i,r,o){r.buffers.push({arrayBuffer:o.buffer,byteOffset:0,byteLength:o.buffer.byteLength});const u=r.json.bufferViews;if(!u)return;u.push({buffer:r.buffers.length-1,byteLength:o.buffer.byteLength,byteOffset:0});const d=r.json.accessors;d&&(d.push({bufferView:(u==null?void 0:u.length)-1,byteOffset:0,componentType:5126,count:e.count,type:"VEC2"}),i.attributes[`TEXCOORD_${t}`]=d.length-1)}function vz(t){const{offset:e=[0,0],rotation:i=0,scale:r=[1,1]}=t,o=new Hi().set(1,0,0,0,1,0,e[0],e[1],1),u=uz.set(Math.cos(i),Math.sin(i),0,-Math.sin(i),Math.cos(i),0,0,0,1),d=dz.set(r[0],0,0,0,r[1],0,0,0,1);return o.multiplyRight(u).multiplyRight(d)}const xz=Object.freeze(Object.defineProperty({__proto__:null,decode:fz,name:hz},Symbol.toStringTag,{value:"Module"})),Ya="KHR_lights_punctual",wz=Ya;async function Tz(t){const e=new Cr(t),{json:i}=e,r=e.getExtension(Ya);r&&(e.json.lights=r.lights,e.removeExtension(Ya));for(const o of i.nodes||[]){const u=e.getObjectExtension(o,Ya);u&&(o.light=u.light),e.removeObjectExtension(o,Ya)}}async function Az(t){const e=new Cr(t),{json:i}=e;if(i.lights){const r=e.addExtension(Ya);Is(!r.lights),r.lights=i.lights,delete i.lights}if(e.json.lights){for(const r of e.json.lights){const o=r.node;e.addObjectExtension(o,Ya,r)}delete e.json.lights}}const Ez=Object.freeze(Object.defineProperty({__proto__:null,decode:Tz,encode:Az,name:wz},Symbol.toStringTag,{value:"Module"})),uu="KHR_materials_unlit",Sz=uu;async function Cz(t){const e=new Cr(t),{json:i}=e;for(const r of i.materials||[])r.extensions&&r.extensions.KHR_materials_unlit&&(r.unlit=!0),e.removeObjectExtension(r,uu);e.removeExtension(uu)}function Iz(t){const e=new Cr(t),{json:i}=e;if(e.materials)for(const r of i.materials||[])r.unlit&&(delete r.unlit,e.addObjectExtension(r,uu,{}),e.addExtension(uu))}const Mz=Object.freeze(Object.defineProperty({__proto__:null,decode:Cz,encode:Iz,name:Sz},Symbol.toStringTag,{value:"Module"})),du="KHR_techniques_webgl",Rz=du;async function Pz(t){const e=new Cr(t),{json:i}=e,r=e.getExtension(du);if(r){const o=Dz(r,e);for(const u of i.materials||[]){const d=e.getObjectExtension(u,du);d&&(u.technique=Object.assign({},d,o[d.technique]),u.technique.values=Oz(u.technique,e)),e.removeObjectExtension(u,du)}e.removeExtension(du)}}async function Bz(t,e){}function Dz(t,e){const{programs:i=[],shaders:r=[],techniques:o=[]}=t,u=new TextDecoder;return r.forEach(d=>{if(Number.isFinite(d.bufferView))d.code=u.decode(e.getTypedArrayForBufferView(d.bufferView));else throw new Error("KHR_techniques_webgl: no shader code")}),i.forEach(d=>{d.fragmentShader=r[d.fragmentShader],d.vertexShader=r[d.vertexShader]}),o.forEach(d=>{d.program=i[d.program]}),o}function Oz(t,e){const i=Object.assign({},t.values);return Object.keys(t.uniforms||{}).forEach(r=>{t.uniforms[r].value&&!(r in i)&&(i[r]=t.uniforms[r].value)}),Object.keys(i).forEach(r=>{typeof i[r]=="object"&&i[r].index!==void 0&&(i[r].texture=e.getTexture(i[r].index))}),i}const Nw=[zL,uL,PU,OU,NU,cz,Ez,Mz,Object.freeze(Object.defineProperty({__proto__:null,decode:Pz,encode:Bz,name:Rz},Symbol.toStringTag,{value:"Module"})),xz,sU];function Fz(t,e={},i){var o;const r=Nw.filter(u=>Lw(u.name,e));for(const u of r)(o=u.preprocess)==null||o.call(u,t,e,i)}async function kz(t,e={},i){var o;const r=Nw.filter(u=>Lw(u.name,e));for(const u of r)await((o=u.decode)==null?void 0:o.call(u,t,e,i))}function Lw(t,e){var o;const i=((o=e==null?void 0:e.gltf)==null?void 0:o.excludeExtensions)||{};return!(t in i&&!i[t])}const zm="KHR_binary_glTF";function Nz(t){const e=new Cr(t),{json:i}=e;for(const r of i.images||[]){const o=e.getObjectExtension(r,zm);o&&Object.assign(r,o),e.removeObjectExtension(r,zm)}i.buffers&&i.buffers[0]&&delete i.buffers[0].uri,e.removeExtension(zm)}const Uw={accessors:"accessor",animations:"animation",buffers:"buffer",bufferViews:"bufferView",images:"image",materials:"material",meshes:"mesh",nodes:"node",samplers:"sampler",scenes:"scene",skins:"skin",textures:"texture"},Lz={accessor:"accessors",animations:"animation",buffer:"buffers",bufferView:"bufferViews",image:"images",material:"materials",mesh:"meshes",node:"nodes",sampler:"samplers",scene:"scenes",skin:"skins",texture:"textures"};class Uz{constructor(){L(this,"idToIndexMap",{animations:{},accessors:{},buffers:{},bufferViews:{},images:{},materials:{},meshes:{},nodes:{},samplers:{},scenes:{},skins:{},textures:{}});L(this,"json")}normalize(e,i){this.json=e.json;const r=e.json;switch(r.asset&&r.asset.version){case"2.0":return;case void 0:case"1.0":break;default:console.warn(`glTF: Unknown version ${r.asset.version}`);return}if(!i.normalize)throw new Error("glTF v1 is not supported.");console.warn("Converting glTF v1 to glTF v2 format. This is experimental and may fail."),this._addAsset(r),this._convertTopLevelObjectsToArrays(r),Nz(e),this._convertObjectIdsToArrayIndices(r),this._updateObjects(r),this._updateMaterial(r)}_addAsset(e){e.asset=e.asset||{},e.asset.version="2.0",e.asset.generator=e.asset.generator||"Normalized to glTF 2.0 by loaders.gl"}_convertTopLevelObjectsToArrays(e){for(const i in Uw)this._convertTopLevelObjectToArray(e,i)}_convertTopLevelObjectToArray(e,i){const r=e[i];if(!(!r||Array.isArray(r))){e[i]=[];for(const o in r){const u=r[o];u.id=u.id||o;const d=e[i].length;e[i].push(u),this.idToIndexMap[i][o]=d}}}_convertObjectIdsToArrayIndices(e){for(const i in Uw)this._convertIdsToIndices(e,i);"scene"in e&&(e.scene=this._convertIdToIndex(e.scene,"scene"));for(const i of e.textures)this._convertTextureIds(i);for(const i of e.meshes)this._convertMeshIds(i);for(const i of e.nodes)this._convertNodeIds(i);for(const i of e.scenes)this._convertSceneIds(i)}_convertTextureIds(e){e.source&&(e.source=this._convertIdToIndex(e.source,"image"))}_convertMeshIds(e){for(const i of e.primitives){const{attributes:r,indices:o,material:u}=i;for(const d in r)r[d]=this._convertIdToIndex(r[d],"accessor");o&&(i.indices=this._convertIdToIndex(o,"accessor")),u&&(i.material=this._convertIdToIndex(u,"material"))}}_convertNodeIds(e){e.children&&(e.children=e.children.map(i=>this._convertIdToIndex(i,"node"))),e.meshes&&(e.meshes=e.meshes.map(i=>this._convertIdToIndex(i,"mesh")))}_convertSceneIds(e){e.nodes&&(e.nodes=e.nodes.map(i=>this._convertIdToIndex(i,"node")))}_convertIdsToIndices(e,i){e[i]||(console.warn(`gltf v1: json doesn't contain attribute ${i}`),e[i]=[]);for(const r of e[i])for(const o in r){const u=r[o],d=this._convertIdToIndex(u,o);r[o]=d}}_convertIdToIndex(e,i){const r=Lz[i];if(r in this.idToIndexMap){const o=this.idToIndexMap[r][e];if(!Number.isFinite(o))throw new Error(`gltf v1: failed to resolve ${i} with id ${e}`);return o}return e}_updateObjects(e){for(const i of this.json.buffers)delete i.type}_updateMaterial(e){var i,r,o;for(const u of e.materials){u.pbrMetallicRoughness={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1};const d=((i=u.values)==null?void 0:i.tex)||((r=u.values)==null?void 0:r.texture2d_0)||((o=u.values)==null?void 0:o.diffuseTex),a=e.textures.findIndex(x=>x.id===d);a!==-1&&(u.pbrMetallicRoughness.baseColorTexture={index:a})}}}function zz(t,e={}){return new Uz().normalize(t,e)}async function Vz(t,e,i=0,r,o){var u,d,a;return jz(t,e,i,r),zz(t,{normalize:(u=r==null?void 0:r.gltf)==null?void 0:u.normalize}),Fz(t,r,o),(d=r==null?void 0:r.gltf)!=null&&d.loadBuffers&&t.json.buffers&&await Hz(t,r,o),(a=r==null?void 0:r.gltf)!=null&&a.loadImages&&await Gz(t,r,o),await kz(t,r,o),t}function jz(t,e,i,r){if(r.uri&&(t.baseUri=r.uri),e instanceof ArrayBuffer&&!dU(e,i,r)&&(e=new TextDecoder().decode(e)),typeof e=="string")t.json=MS(e);else if(e instanceof ArrayBuffer){const d={};i=fU(d,e,i,r.glb),Is(d.type==="glTF",`Invalid GLB magic string ${d.type}`),t._glb=d,t.json=d.json}else Is(!1,"GLTF: must be ArrayBuffer or string");const o=t.json.buffers||[];if(t.buffers=new Array(o.length).fill(null),t._glb&&t._glb.header.hasBinChunk){const{binChunks:d}=t._glb;t.buffers[0]={arrayBuffer:d[0].arrayBuffer,byteOffset:d[0].byteOffset,byteLength:d[0].byteLength}}const u=t.json.images||[];t.images=new Array(u.length).fill({})}async function Hz(t,e,i){var o,u;const r=t.json.buffers||[];for(let d=0;d<r.length;++d){const a=r[d];if(a.uri){const{fetch:x}=i;Is(x);const A=Rw(a.uri,e),M=await((o=i==null?void 0:i.fetch)==null?void 0:o.call(i,A)),D=await((u=M==null?void 0:M.arrayBuffer)==null?void 0:u.call(M));t.buffers[d]={arrayBuffer:D,byteOffset:0,byteLength:D.byteLength},delete a.uri}else t.buffers[d]===null&&(t.buffers[d]={arrayBuffer:new ArrayBuffer(a.byteLength),byteOffset:0,byteLength:a.byteLength})}}async function Gz(t,e,i){const r=$z(t),o=t.json.images||[],u=[];for(const d of r)u.push(Wz(t,o[d],d,e,i));return await Promise.all(u)}function $z(t){const e=new Set,i=t.json.textures||[];for(const r of i)r.source!==void 0&&e.add(r.source);return Array.from(e).sort()}async function Wz(t,e,i,r,o){let u;if(e.uri&&!e.hasOwnProperty("bufferView")){const a=Rw(e.uri,r),{fetch:x}=o;u=await(await x(a)).arrayBuffer(),e.bufferView={data:u}}if(Number.isFinite(e.bufferView)){const a=KN(t.json,t.buffers,e.bufferView);u=S_(a.buffer,a.byteOffset,a.byteLength)}Is(u,"glTF image has no data");let d=await Sh(u,[Ib,SN],{...r,mimeType:e.mimeType,basis:r.basis||{format:fw()}},o);d&&d[0]&&(d={compressed:!0,mipmaps:!1,width:d[0].width,height:d[0].height,data:d[0]}),t.images=t.images||[],t.images[i]=d}const fu={dataType:null,batchType:null,name:"glTF",id:"gltf",module:"gltf",version:nU,extensions:["gltf","glb"],mimeTypes:["model/gltf+json","model/gltf-binary"],text:!0,binary:!0,tests:["glTF"],parse:Xz,options:{gltf:{normalize:!0,loadBuffers:!0,loadImages:!0,decompressMeshes:!0},log:console}};async function Xz(t,e={},i){e={...fu.options,...e},e.gltf={...fu.options.gltf,...e.gltf};const{byteOffset:r=0}=e;return await Vz({},t,r,e,i)}const qz={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Zz={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},rn={TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,REPEAT:10497,LINEAR:9729,NEAREST_MIPMAP_LINEAR:9986},Kz={magFilter:rn.TEXTURE_MAG_FILTER,minFilter:rn.TEXTURE_MIN_FILTER,wrapS:rn.TEXTURE_WRAP_S,wrapT:rn.TEXTURE_WRAP_T},Yz={[rn.TEXTURE_MAG_FILTER]:rn.LINEAR,[rn.TEXTURE_MIN_FILTER]:rn.NEAREST_MIPMAP_LINEAR,[rn.TEXTURE_WRAP_S]:rn.REPEAT,[rn.TEXTURE_WRAP_T]:rn.REPEAT};function Jz(){return{id:"default-sampler",parameters:Yz}}function Qz(t){return Zz[t]}function e6(t){return qz[t]}class t6{constructor(){L(this,"baseUri","");L(this,"jsonUnprocessed");L(this,"json");L(this,"buffers",[]);L(this,"images",[])}postProcess(e,i={}){const{json:r,buffers:o=[],images:u=[]}=e,{baseUri:d=""}=e;return Is(r),this.baseUri=d,this.buffers=o,this.images=u,this.jsonUnprocessed=r,this.json=this._resolveTree(e.json,i),this.json}_resolveTree(e,i={}){const r={...e};return this.json=r,e.bufferViews&&(r.bufferViews=e.bufferViews.map((o,u)=>this._resolveBufferView(o,u))),e.images&&(r.images=e.images.map((o,u)=>this._resolveImage(o,u))),e.samplers&&(r.samplers=e.samplers.map((o,u)=>this._resolveSampler(o,u))),e.textures&&(r.textures=e.textures.map((o,u)=>this._resolveTexture(o,u))),e.accessors&&(r.accessors=e.accessors.map((o,u)=>this._resolveAccessor(o,u))),e.materials&&(r.materials=e.materials.map((o,u)=>this._resolveMaterial(o,u))),e.meshes&&(r.meshes=e.meshes.map((o,u)=>this._resolveMesh(o,u))),e.nodes&&(r.nodes=e.nodes.map((o,u)=>this._resolveNode(o,u)),r.nodes=r.nodes.map((o,u)=>this._resolveNodeChildren(o))),e.skins&&(r.skins=e.skins.map((o,u)=>this._resolveSkin(o,u))),e.scenes&&(r.scenes=e.scenes.map((o,u)=>this._resolveScene(o,u))),typeof this.json.scene=="number"&&r.scenes&&(r.scene=r.scenes[this.json.scene]),r}getScene(e){return this._get(this.json.scenes,e)}getNode(e){return this._get(this.json.nodes,e)}getSkin(e){return this._get(this.json.skins,e)}getMesh(e){return this._get(this.json.meshes,e)}getMaterial(e){return this._get(this.json.materials,e)}getAccessor(e){return this._get(this.json.accessors,e)}getCamera(e){return this._get(this.json.cameras,e)}getTexture(e){return this._get(this.json.textures,e)}getSampler(e){return this._get(this.json.samplers,e)}getImage(e){return this._get(this.json.images,e)}getBufferView(e){return this._get(this.json.bufferViews,e)}getBuffer(e){return this._get(this.json.buffers,e)}_get(e,i){if(typeof i=="object")return i;const r=e&&e[i];return r||console.warn(`glTF file error: Could not find ${e}[${i}]`),r}_resolveScene(e,i){return{...e,id:e.id||`scene-${i}`,nodes:(e.nodes||[]).map(r=>this.getNode(r))}}_resolveNode(e,i){const r={...e,id:(e==null?void 0:e.id)||`node-${i}`};return e.mesh!==void 0&&(r.mesh=this.getMesh(e.mesh)),e.camera!==void 0&&(r.camera=this.getCamera(e.camera)),e.skin!==void 0&&(r.skin=this.getSkin(e.skin)),e.meshes!==void 0&&e.meshes.length&&(r.mesh=e.meshes.reduce((o,u)=>{const d=this.getMesh(u);return o.id=d.id,o.primitives=o.primitives.concat(d.primitives),o},{primitives:[]})),r}_resolveNodeChildren(e){return e.children&&(e.children=e.children.map(i=>this.getNode(i))),e}_resolveSkin(e,i){const r=typeof e.inverseBindMatrices=="number"?this.getAccessor(e.inverseBindMatrices):void 0;return{...e,id:e.id||`skin-${i}`,inverseBindMatrices:r}}_resolveMesh(e,i){const r={...e,id:e.id||`mesh-${i}`,primitives:[]};return e.primitives&&(r.primitives=e.primitives.map(o=>{const u={...o,attributes:{},indices:void 0,material:void 0},d=o.attributes;for(const a in d)u.attributes[a]=this.getAccessor(d[a]);return o.indices!==void 0&&(u.indices=this.getAccessor(o.indices)),o.material!==void 0&&(u.material=this.getMaterial(o.material)),u})),r}_resolveMaterial(e,i){const r={...e,id:e.id||`material-${i}`};if(r.normalTexture&&(r.normalTexture={...r.normalTexture},r.normalTexture.texture=this.getTexture(r.normalTexture.index)),r.occlusionTexture&&(r.occlusionTexture={...r.occlusionTexture},r.occlusionTexture.texture=this.getTexture(r.occlusionTexture.index)),r.emissiveTexture&&(r.emissiveTexture={...r.emissiveTexture},r.emissiveTexture.texture=this.getTexture(r.emissiveTexture.index)),r.emissiveFactor||(r.emissiveFactor=r.emissiveTexture?[1,1,1]:[0,0,0]),r.pbrMetallicRoughness){r.pbrMetallicRoughness={...r.pbrMetallicRoughness};const o=r.pbrMetallicRoughness;o.baseColorTexture&&(o.baseColorTexture={...o.baseColorTexture},o.baseColorTexture.texture=this.getTexture(o.baseColorTexture.index)),o.metallicRoughnessTexture&&(o.metallicRoughnessTexture={...o.metallicRoughnessTexture},o.metallicRoughnessTexture.texture=this.getTexture(o.metallicRoughnessTexture.index))}return r}_resolveAccessor(e,i){const r=Qz(e.componentType),o=e6(e.type),u=r*o,d={...e,id:e.id||`accessor-${i}`,bytesPerComponent:r,components:o,bytesPerElement:u,value:void 0,bufferView:void 0,sparse:void 0};if(e.bufferView!==void 0&&(d.bufferView=this.getBufferView(e.bufferView)),d.bufferView){const a=d.bufferView.buffer,{ArrayType:x,byteLength:A}=Im(d,d.bufferView),M=(d.bufferView.byteOffset||0)+(d.byteOffset||0)+a.byteOffset;let D=a.arrayBuffer.slice(M,M+A);d.bufferView.byteStride&&(D=this._getValueFromInterleavedBuffer(a,M,d.bufferView.byteStride,d.bytesPerElement,d.count)),d.value=new x(D)}return d}_getValueFromInterleavedBuffer(e,i,r,o,u){const d=new Uint8Array(u*o);for(let a=0;a<u;a++){const x=i+a*r;d.set(new Uint8Array(e.arrayBuffer.slice(x,x+o)),a*o)}return d.buffer}_resolveTexture(e,i){return{...e,id:e.id||`texture-${i}`,sampler:typeof e.sampler=="number"?this.getSampler(e.sampler):Jz(),source:typeof e.source=="number"?this.getImage(e.source):void 0}}_resolveSampler(e,i){const r={id:e.id||`sampler-${i}`,...e,parameters:{}};for(const o in r){const u=this._enumSamplerParameter(o);u!==void 0&&(r.parameters[u]=r[o])}return r}_enumSamplerParameter(e){return Kz[e]}_resolveImage(e,i){const r={...e,id:e.id||`image-${i}`,image:null,bufferView:e.bufferView!==void 0?this.getBufferView(e.bufferView):void 0},o=this.images[i];return o&&(r.image=o),r}_resolveBufferView(e,i){const r=e.buffer,o=this.buffers[r].arrayBuffer;let u=this.buffers[r].byteOffset||0;return e.byteOffset&&(u+=e.byteOffset),{id:`bufferView-${i}`,...e,buffer:this.buffers[r],data:new Uint8Array(o,u,e.byteLength)}}_resolveCamera(e,i){const r={...e,id:e.id||`camera-${i}`};return r.perspective,r.orthographic,r}}function Vm(t,e){return new t6().postProcess(t,e)}async function i6(t){const e=[];return t.scenes.forEach(i=>{i.traverse(r=>{Object.values(r.model.uniforms).forEach(o=>{o.loaded===!1&&e.push(o)})})}),await r6(()=>e.some(i=>!i.loaded))}async function r6(t){for(;t();)await new Promise(e=>requestAnimationFrame(e))}const s6=`#version 300 es
#define SHADER_NAME scenegraph-layer-vertex-shader
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec3 instanceModelMatrixCol0;
in vec3 instanceModelMatrixCol1;
in vec3 instanceModelMatrixCol2;
in vec3 instanceTranslation;
uniform float sizeScale;
uniform float sizeMinPixels;
uniform float sizeMaxPixels;
uniform mat4 sceneModelMatrix;
uniform bool composeModelMatrix;
in vec3 positions;
#ifdef HAS_UV
in vec2 texCoords;
#endif
#ifdef MODULE_PBR
#ifdef HAS_NORMALS
in vec3 normals;
#endif
#endif
out vec4 vColor;
#ifndef MODULE_PBR
#ifdef HAS_UV
out vec2 vTEXCOORD_0;
#endif
#endif
void main(void) {
#if defined(HAS_UV) && !defined(MODULE_PBR)
vTEXCOORD_0 = texCoords;
geometry.uv = texCoords;
#endif
geometry.worldPosition = instancePositions;
geometry.pickingColor = instancePickingColors;
mat3 instanceModelMatrix = mat3(instanceModelMatrixCol0, instanceModelMatrixCol1, instanceModelMatrixCol2);
vec3 normal = vec3(0.0, 0.0, 1.0);
#ifdef MODULE_PBR
#ifdef HAS_NORMALS
normal = instanceModelMatrix * (sceneModelMatrix * vec4(normals, 0.0)).xyz;
#endif
#endif
float originalSize = project_size_to_pixel(sizeScale);
float clampedSize = clamp(originalSize, sizeMinPixels, sizeMaxPixels);
vec3 pos = (instanceModelMatrix * (sceneModelMatrix * vec4(positions, 1.0)).xyz) * sizeScale * (clampedSize / originalSize) + instanceTranslation;
if(composeModelMatrix) {
DECKGL_FILTER_SIZE(pos, geometry);
geometry.normal = project_normal(normal);
geometry.worldPosition += pos;
gl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
}
else {
pos = project_size(pos);
DECKGL_FILTER_SIZE(pos, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, geometry.position);
geometry.normal = project_normal(normal);
}
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
#ifdef MODULE_PBR
pbr_vPosition = geometry.position.xyz;
#ifdef HAS_NORMALS
pbr_vNormal = geometry.normal;
#endif
#ifdef HAS_UV
pbr_vUV = texCoords;
#else
pbr_vUV = vec2(0., 0.);
#endif
geometry.uv = pbr_vUV;
#endif
vColor = instanceColors;
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,n6=`#version 300 es
#define SHADER_NAME scenegraph-layer-fragment-shader
uniform float opacity;
in vec4 vColor;
out vec4 fragColor;
#ifndef MODULE_PBR
#if defined(HAS_UV) && defined(HAS_BASECOLORMAP)
in vec2 vTEXCOORD_0;
uniform sampler2D u_BaseColorSampler;
#endif
#endif
void main(void) {
#ifdef MODULE_PBR
fragColor = vColor * pbr_filterColor(vec4(0));
geometry.uv = pbr_vUV;
#else
#if defined(HAS_UV) && defined(HAS_BASECOLORMAP)
fragColor = vColor * texture(u_BaseColorSampler, vTEXCOORD_0);
geometry.uv = vTEXCOORD_0;
#else
fragColor = vColor;
#endif
#endif
fragColor.a *= opacity;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,zw=[255,255,255,255],o6={scenegraph:{type:"object",value:null,async:!0},getScene:t=>t&&t.scenes?typeof t.scene=="object"?t.scene:t.scenes[t.scene||0]:t,getAnimator:t=>t&&t.animator,_animations:null,sizeScale:{type:"number",value:1,min:0},sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},getPosition:{type:"accessor",value:t=>t.position},getColor:{type:"accessor",value:zw},_lighting:"flat",_imageBasedLightingEnvironment:void 0,getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]},loaders:[fu]};class jm extends gc{getShaders(){const e=[Ig,Og];return this.props._lighting==="pbr"&&e.push(Ag),super.getShaders({vs:s6,fs:n6,modules:e})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),accessor:"getPosition",transition:!0},instanceColors:{type:"unorm8",size:this.props.colorFormat.length,accessor:"getColor",defaultValue:zw,transition:!0},instanceModelMatrix:rw})}updateState(e){super.updateState(e);const{props:i,oldProps:r}=e;i.scenegraph!==r.scenegraph?this._updateScenegraph():i._animations!==r._animations&&this._applyAnimationsProp(this.state.animator,i._animations)}finalizeState(e){var i;super.finalizeState(e),(i=this.state.scenegraph)==null||i.destroy()}get isLoaded(){var e;return!!((e=this.state)!=null&&e.scenegraph&&super.isLoaded)}_updateScenegraph(){var a;const e=this.props,{device:i}=this.context;let r=null;if(e.scenegraph instanceof cf)r={scenes:[e.scenegraph]};else if(e.scenegraph&&typeof e.scenegraph=="object"){const x=e.scenegraph,A=x.json?Vm(x):x,M=HN(i,A,this._getModelOptions());r={gltf:A,...M},i6(M).then(()=>{this.setNeedsRedraw()}).catch(D=>{this.raiseError(D,"loading glTF")})}const o={layer:this,device:this.context.device},u=e.getScene(r,o),d=e.getAnimator(r,o);if(u instanceof nc){(a=this.state.scenegraph)==null||a.destroy(),this._applyAnimationsProp(d,e._animations);const x=[];u.traverse(A=>{A instanceof Vg&&x.push(A.model)}),this.setState({scenegraph:u,animator:d,models:x}),this.getAttributeManager().invalidateAll()}else u!==null&&Yt.warn("invalid scenegraph:",u)()}_applyAnimationsProp(e,i){if(!e||!i)return;const r=e.getAnimations();Object.keys(i).sort().forEach(o=>{const u=i[o];if(o==="*")r.forEach(d=>{Object.assign(d,u)});else if(Number.isFinite(Number(o))){const d=Number(o);d>=0&&d<r.length?Object.assign(r[d],u):Yt.warn(`animation ${o} not found`)()}else{const d=r.find(({name:a})=>a===o);d?Object.assign(d,u):Yt.warn(`animation ${o} not found`)()}})}_getModelOptions(){const{_imageBasedLightingEnvironment:e}=this.props;let i;return e&&(typeof e=="function"?i=e({gl:this.context.gl,layer:this}):i=e),{imageBasedLightingEnvironment:i,modelOptions:{id:this.props.id,isInstanced:!0,bufferLayout:this.getAttributeManager().getBufferLayouts(),...this.getShaders()},useTangents:!1}}draw({context:e}){if(!this.state.scenegraph)return;this.props._animations&&this.state.animator&&(this.state.animator.animate(e.timeline.getTime()),this.setNeedsRedraw());const{viewport:i,renderPass:r}=this.context,{sizeScale:o,sizeMinPixels:u,sizeMaxPixels:d,opacity:a,coordinateSystem:x}=this.props,A=this.getNumInstances();this.state.scenegraph.traverse((M,{worldMatrix:D})=>{if(M instanceof Vg){const{model:N}=M;N.setInstanceCount(A),N.setUniforms({sizeScale:o,opacity:a,sizeMinPixels:u,sizeMaxPixels:d,composeModelMatrix:sw(i,x),sceneModelMatrix:D,u_Camera:N.uniforms.project_uCameraPosition}),N.draw(r)}})}}jm.defaultProps=o6,jm.layerName="ScenegraphLayer";const a6=`#version 300 es
#define SHADER_NAME simple-mesh-layer-vs
uniform float sizeScale;
uniform bool composeModelMatrix;
uniform bool pickFeatureIds;
in vec3 positions;
in vec3 normals;
in vec3 colors;
in vec2 texCoords;
in vec4 uvRegions;
in vec3 featureIdsPickingColors;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec3 instanceModelMatrixCol0;
in vec3 instanceModelMatrixCol1;
in vec3 instanceModelMatrixCol2;
out vec2 vTexCoord;
out vec3 cameraPosition;
out vec3 normals_commonspace;
out vec4 position_commonspace;
out vec4 vColor;
vec2 applyUVRegion(vec2 uv) {
#ifdef HAS_UV_REGIONS
return fract(uv) * (uvRegions.zw - uvRegions.xy) + uvRegions.xy;
#else
return uv;
#endif
}
void main(void) {
vec2 uv = applyUVRegion(texCoords);
geometry.uv = uv;
if (pickFeatureIds) {
geometry.pickingColor = featureIdsPickingColors;
} else {
geometry.pickingColor = instancePickingColors;
}
mat3 instanceModelMatrix = mat3(instanceModelMatrixCol0, instanceModelMatrixCol1, instanceModelMatrixCol2);
vTexCoord = uv;
cameraPosition = project_uCameraPosition;
vColor = vec4(colors * instanceColors.rgb, instanceColors.a);
vec3 pos = (instanceModelMatrix * positions) * sizeScale;
vec3 projectedPosition = project_position(positions);
position_commonspace = vec4(projectedPosition, 1.0);
gl_Position = project_common_position_to_clipspace(position_commonspace);
geometry.position = position_commonspace;
normals_commonspace = project_normal(instanceModelMatrix * normals);
geometry.normal = normals_commonspace;
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
#ifdef MODULE_PBR
pbr_vPosition = geometry.position.xyz;
#ifdef HAS_NORMALS
pbr_vNormal = geometry.normal;
#endif
#ifdef HAS_UV
pbr_vUV = uv;
#else
pbr_vUV = vec2(0., 0.);
#endif
geometry.uv = pbr_vUV;
#endif
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,l6=`#version 300 es
#define SHADER_NAME simple-mesh-layer-fs
precision highp float;
uniform bool hasTexture;
uniform sampler2D sampler;
uniform bool flatShading;
uniform float opacity;
in vec2 vTexCoord;
in vec3 cameraPosition;
in vec3 normals_commonspace;
in vec4 position_commonspace;
in vec4 vColor;
out vec4 fragColor;
void main(void) {
#ifdef MODULE_PBR
fragColor = vColor * pbr_filterColor(vec4(0));
geometry.uv = pbr_vUV;
fragColor.a *= opacity;
#else
geometry.uv = vTexCoord;
vec3 normal;
if (flatShading) {
normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
} else {
normal = normals_commonspace;
}
vec4 color = hasTexture ? texture(sampler, vTexCoord) : vColor;
vec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);
fragColor = vec4(lightColor, color.a * opacity);
#endif
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;function c6(t){const e=t.positions||t.POSITION,i=e.value.length/e.size;t.COLOR_0||t.colors||(t.colors={size:4,value:new Uint8Array(i*4).fill(255),normalized:!0})}const h6={pbrMaterial:{type:"object",value:null},featureIds:{type:"array",value:null,optional:!0}};class Hm extends Am{getShaders(){const e=super.getShaders();return e.modules.push(Ag),{...e,vs:a6,fs:l6}}initializeState(){const{featureIds:e}=this.props;super.initializeState();const i=this.getAttributeManager();e&&i.add({featureIdsPickingColors:{type:"uint8",size:3,noAlloc:!0,update:this.calculateFeatureIdsPickingColors}})}updateState(e){super.updateState(e);const{props:i,oldProps:r}=e;i.pbrMaterial!==r.pbrMaterial&&this.updatePbrMaterialUniforms(i.pbrMaterial)}draw(e){const{featureIds:i}=this.props;this.state.model&&(this.state.model.setUniforms({u_Camera:this.state.model.uniforms.project_uCameraPosition,pickFeatureIds:!!i}),super.draw(e))}getModel(e){const{id:i,pbrMaterial:r}=this.props,o=this.parseMaterial(r,e);this.setState({parsedPBRMaterial:o});const u=this.getShaders();return c6(e.attributes),new Zo(this.context.device,{...this.getShaders(),id:i,geometry:e,bufferLayout:this.getAttributeManager().getBufferLayouts(),defines:{...u.defines,...o==null?void 0:o.defines,HAS_UV_REGIONS:e.attributes.uvRegions?1:0},parameters:o==null?void 0:o.parameters,isInstanced:!0})}updatePbrMaterialUniforms(e){const{model:i}=this.state;if(i){const{mesh:r}=this.props,o=this.parseMaterial(e,r);this.setState({parsedPBRMaterial:o}),i.setBindings(o.bindings),i.setUniforms(o.uniforms)}}parseMaterial(e,i){const r=!!(e.pbrMetallicRoughness&&e.pbrMetallicRoughness.baseColorTexture);return ow(this.context.device,{unlit:r,...e},{NORMAL:i.attributes.normals,TEXCOORD_0:i.attributes.texCoords},{pbrDebug:!1,lights:!0,useTangents:!1})}calculateFeatureIdsPickingColors(e){const i=this.props.featureIds,r=new Uint8ClampedArray(i.length*e.size),o=[];for(let u=0;u<i.length;u++)this.encodePickingColor(i[u],o),r[u*3]=o[0],r[u*3+1]=o[1],r[u*3+2]=o[2];e.value=r}finalizeState(e){var i;super.finalizeState(e),(i=this.state.parsedPBRMaterial)==null||i.generatedTextures.forEach(r=>r.destroy()),this.setState({parsedPBRMaterial:null})}}Hm.layerName="MeshLayer",Hm.defaultProps=h6;const u6=6378137,d6=6378137,f6=6356752314245179e-9;function Uf(t){return t}new De;function p6(t,e=[],i=Uf){return"longitude"in t?(e[0]=i(t.longitude),e[1]=i(t.latitude),e[2]=t.height):"x"in t?(e[0]=i(t.x),e[1]=i(t.y),e[2]=t.z):(e[0]=i(t[0]),e[1]=i(t[1]),e[2]=t[2]),e}function _6(t,e=[]){return p6(t,e,mr._cartographicRadians?Uf:sR)}function g6(t,e,i=Uf){return"longitude"in e?(e.longitude=i(t[0]),e.latitude=i(t[1]),e.height=t[2]):"x"in e?(e.x=i(t[0]),e.y=i(t[1]),e.z=t[2]):(e[0]=i(t[0]),e[1]=i(t[1]),e[2]=t[2]),e}function m6(t,e){return g6(t,e,mr._cartographicRadians?Uf:nR)}const Vw=1e-14,y6=new De,jw={up:{south:"east",north:"west",west:"south",east:"north"},down:{south:"west",north:"east",west:"north",east:"south"},south:{up:"west",down:"east",west:"down",east:"up"},north:{up:"east",down:"west",west:"up",east:"down"},west:{up:"north",down:"south",north:"down",south:"up"},east:{up:"south",down:"north",north:"up",south:"down"}},Gm={north:[-1,0,0],east:[0,1,0],up:[0,0,1],south:[1,0,0],west:[0,-1,0],down:[0,0,-1]},pu={east:new De,north:new De,up:new De,west:new De,south:new De,down:new De},b6=new De,v6=new De,x6=new De;function Hw(t,e,i,r,o,u){const d=jw[e]&&jw[e][i];bn(d&&(!r||r===d));let a,x,A;const M=y6.copy(o);if(yn(M.x,0,Vw)&&yn(M.y,0,Vw)){const N=Math.sign(M.z);a=b6.fromArray(Gm[e]),e!=="east"&&e!=="west"&&a.scale(N),x=v6.fromArray(Gm[i]),i!=="east"&&i!=="west"&&x.scale(N),A=x6.fromArray(Gm[r]),r!=="east"&&r!=="west"&&A.scale(N)}else{const{up:N,east:U,north:re}=pu;U.set(-M.y,M.x,0).normalize(),t.geodeticSurfaceNormal(M,N),re.copy(N).cross(U);const{down:ne,west:xe,south:Ae}=pu;ne.copy(N).scale(-1),xe.copy(U).scale(-1),Ae.copy(re).scale(-1),a=pu[e],x=pu[i],A=pu[r]}return u[0]=a.x,u[1]=a.y,u[2]=a.z,u[3]=0,u[4]=x.x,u[5]=x.y,u[6]=x.z,u[7]=0,u[8]=A.x,u[9]=A.y,u[10]=A.z,u[11]=0,u[12]=M.x,u[13]=M.y,u[14]=M.z,u[15]=1,u}const wc=new De,w6=new De,T6=new De;function A6(t,e,i=[]){const{oneOverRadii:r,oneOverRadiiSquared:o,centerToleranceSquared:u}=e;wc.from(t);const d=wc.x,a=wc.y,x=wc.z,A=r.x,M=r.y,D=r.z,N=d*d*A*A,U=a*a*M*M,re=x*x*D*D,ne=N+U+re,xe=Math.sqrt(1/ne);if(!Number.isFinite(xe))return;const Ae=w6;if(Ae.copy(t).scale(xe),ne<u)return Ae.to(i);const Te=o.x,Ie=o.y,Ue=o.z,Xe=T6;Xe.set(Ae.x*Te*2,Ae.y*Ie*2,Ae.z*Ue*2);let qe=(1-xe)*wc.len()/(.5*Xe.len()),ht=0,gt,nt,at,bt;do{qe-=ht,gt=1/(1+qe*Te),nt=1/(1+qe*Ie),at=1/(1+qe*Ue);const kt=gt*gt,Ht=nt*nt,St=at*at,xi=kt*gt,Fr=Ht*nt,br=St*at;bt=N*kt+U*Ht+re*St-1;const Gt=-2*(N*xi*Te+U*Fr*Ie+re*br*Ue);ht=bt/Gt}while(Math.abs(bt)>AP);return wc.scale([gt,nt,at]).to(i)}const zf=new De,Gw=new De,E6=new De,An=new De,S6=new De,Vf=new De;class yi{constructor(e=0,i=0,r=0){this.centerToleranceSquared=TP,bn(e>=0),bn(i>=0),bn(r>=0),this.radii=new De(e,i,r),this.radiiSquared=new De(e*e,i*i,r*r),this.radiiToTheFourth=new De(e*e*e*e,i*i*i*i,r*r*r*r),this.oneOverRadii=new De(e===0?0:1/e,i===0?0:1/i,r===0?0:1/r),this.oneOverRadiiSquared=new De(e===0?0:1/(e*e),i===0?0:1/(i*i),r===0?0:1/(r*r)),this.minimumRadius=Math.min(e,i,r),this.maximumRadius=Math.max(e,i,r),this.radiiSquared.z!==0&&(this.squaredXOverSquaredZ=this.radiiSquared.x/this.radiiSquared.z),Object.freeze(this)}equals(e){return this===e||!!(e&&this.radii.equals(e.radii))}toString(){return this.radii.toString()}cartographicToCartesian(e,i=[0,0,0]){const r=Gw,o=E6,[,,u]=e;this.geodeticSurfaceNormalCartographic(e,r),o.copy(this.radiiSquared).scale(r);const d=Math.sqrt(r.dot(o));return o.scale(1/d),r.scale(u),o.add(r),o.to(i)}cartesianToCartographic(e,i=[0,0,0]){Vf.from(e);const r=this.scaleToGeodeticSurface(Vf,An);if(!r)return;const o=this.geodeticSurfaceNormal(r,Gw),u=S6;u.copy(Vf).subtract(r);const d=Math.atan2(o.y,o.x),a=Math.asin(o.z),x=Math.sign(dg(u,Vf))*Rv(u);return m6([d,a,x],i)}eastNorthUpToFixedFrame(e,i=new $t){return Hw(this,"east","north","up",e,i)}localFrameToFixedFrame(e,i,r,o,u=new $t){return Hw(this,e,i,r,o,u)}geocentricSurfaceNormal(e,i=[0,0,0]){return zf.from(e).normalize().to(i)}geodeticSurfaceNormalCartographic(e,i=[0,0,0]){const r=_6(e),o=r[0],u=r[1],d=Math.cos(u);return zf.set(d*Math.cos(o),d*Math.sin(o),Math.sin(u)).normalize(),zf.to(i)}geodeticSurfaceNormal(e,i=[0,0,0]){return zf.from(e).scale(this.oneOverRadiiSquared).normalize().to(i)}scaleToGeodeticSurface(e,i){return A6(e,this,i)}scaleToGeocentricSurface(e,i=[0,0,0]){An.from(e);const r=An.x,o=An.y,u=An.z,d=this.oneOverRadiiSquared,a=1/Math.sqrt(r*r*d.x+o*o*d.y+u*u*d.z);return An.multiplyScalar(a).to(i)}transformPositionToScaledSpace(e,i=[0,0,0]){return An.from(e).scale(this.oneOverRadii).to(i)}transformPositionFromScaledSpace(e,i=[0,0,0]){return An.from(e).scale(this.radii).to(i)}getSurfaceNormalIntersectionWithZAxis(e,i=0,r=[0,0,0]){bn(yn(this.radii.x,this.radii.y,Wv)),bn(this.radii.z>0),An.from(e);const o=An.z*(1-this.squaredXOverSquaredZ);if(!(Math.abs(o)>=this.radii.z-i))return An.set(0,0,o).to(r)}}yi.WGS84=new yi(u6,d6,f6);class C6{constructor(e,i,r){L(this,"item");L(this,"previous");L(this,"next");this.item=e,this.previous=i,this.next=r}}class I6{constructor(){L(this,"head",null);L(this,"tail",null);L(this,"_length",0)}get length(){return this._length}add(e){const i=new C6(e,this.tail,null);return this.tail?(this.tail.next=i,this.tail=i):(this.head=i,this.tail=i),++this._length,i}remove(e){e&&(e.previous&&e.next?(e.previous.next=e.next,e.next.previous=e.previous):e.previous?(e.previous.next=null,this.tail=e.previous):e.next?(e.next.previous=null,this.head=e.next):(this.head=null,this.tail=null),e.next=null,e.previous=null,--this._length)}splice(e,i){e!==i&&(this.remove(i),this._insert(e,i))}_insert(e,i){const r=e.next;e.next=i,this.tail===e?this.tail=i:r.previous=i,i.next=r,i.previous=e,++this._length}}class M6{constructor(){L(this,"_list");L(this,"_sentinel");L(this,"_trimTiles");this._list=new I6,this._sentinel=this._list.add("sentinel"),this._trimTiles=!1}reset(){this._list.splice(this._list.tail,this._sentinel)}touch(e){const i=e._cacheNode;i&&this._list.splice(this._sentinel,i)}add(e,i,r){i._cacheNode||(i._cacheNode=this._list.add(i),r&&r(e,i))}unloadTile(e,i,r){const o=i._cacheNode;o&&(this._list.remove(o),i._cacheNode=null,r&&r(e,i))}unloadTiles(e,i){const r=this._trimTiles;this._trimTiles=!1;const o=this._list,u=e.maximumMemoryUsage*1024*1024,d=this._sentinel;let a=o.head;for(;a!==d&&(e.gpuMemoryUsageInBytes>u||r);){const x=a.item;a=a.next,this.unloadTile(e,x,i)}}trim(){this._trimTiles=!0}}function R6(t,e){mi(t),mi(e);const{rtcCenter:i,gltfUpAxis:r}=e,{computedTransform:o,boundingVolume:{center:u}}=t;let d=new $t(o);switch(i&&d.translate(i),r){case"Z":break;case"Y":const D=new $t().rotateX(Math.PI/2);d=d.multiplyRight(D);break;case"X":const N=new $t().rotateY(-Math.PI/2);d=d.multiplyRight(N);break}e.isQuantized&&d.translate(e.quantizedVolumeOffset).scale(e.quantizedVolumeScale);const a=new De(u);e.cartesianModelMatrix=d,e.cartesianOrigin=a;const x=yi.WGS84.cartesianToCartographic(a,new De),M=yi.WGS84.eastNorthUpToFixedFrame(a).invert();e.cartographicModelMatrix=M.multiplyRight(d),e.cartographicOrigin=x,e.coordinateSystem||(e.modelMatrix=e.cartographicModelMatrix)}const $w=new De,$m=new De,Wm=new tn([new Zn,new Zn,new Zn,new Zn,new Zn,new Zn]);function P6(t,e){const{cameraDirection:i,cameraUp:r,height:o}=t,{metersPerUnit:u}=t.distanceScales,d=jf(t,t.center),a=yi.WGS84.eastNorthUpToFixedFrame(d),x=t.unprojectPosition(t.cameraPosition),A=yi.WGS84.cartographicToCartesian(x,new De),M=new De(a.transformAsVector(new De(i).scale(u))).normalize(),D=new De(a.transformAsVector(new De(r).scale(u))).normalize();D6(t);const N=t.constructor,{longitude:U,latitude:re,width:ne,bearing:xe,zoom:Ae}=t,Te=new N({longitude:U,latitude:re,height:o,width:ne,bearing:xe,zoom:Ae,pitch:0});return{camera:{position:A,direction:M,up:D},viewport:t,topDownViewport:Te,height:o,cullingVolume:Wm,frameNumber:e,sseDenominator:1.15}}function B6(t,e,i){if(i===0||t.length<=i)return[t,[]];const r=[],{longitude:o,latitude:u}=e.viewport;for(const[A,M]of t.entries()){const[D,N]=M.header.mbs,U=Math.abs(o-D),re=Math.abs(u-N),ne=Math.sqrt(re*re+U*U);r.push([A,ne])}const d=r.sort((A,M)=>A[1]-M[1]),a=[];for(let A=0;A<i;A++)a.push(t[d[A][0]]);const x=[];for(let A=i;A<d.length;A++)x.push(t[d[A][0]]);return[a,x]}function D6(t){const e=t.getFrustumPlanes(),i=Ww(e.near,t.cameraPosition),r=jf(t,i),o=jf(t,t.cameraPosition,$m);let u=0;Wm.planes[u++].fromPointNormal(r,$w.copy(r).subtract(o));for(const d in e){if(d==="near")continue;const a=e[d],x=Ww(a,i,$m),A=jf(t,x,$m);Wm.planes[u++].fromPointNormal(A,$w.copy(r).subtract(A))}}function Ww(t,e,i=new De){const r=t.normal.dot(e);return i.copy(t.normal).scale(t.distance-r).add(e),i}function jf(t,e,i=new De){const r=t.unprojectPosition(e);return yi.WGS84.cartographicToCartesian(r,i)}const O6=6378137,F6=6378137,Xm=6356752314245179e-9,Tc=new De;function k6(t,e){if(t instanceof cu){const{halfAxes:i}=t,r=L6(i);return Math.log2(Xm/(r+e[2]))}else if(t instanceof lu){const{radius:i}=t;return Math.log2(Xm/(i+e[2]))}else if(t.width&&t.height){const{width:i,height:r}=t,o=Math.log2(O6/i),u=Math.log2(F6/r);return(o+u)/2}return 1}function Xw(t,e,i){yi.WGS84.cartographicToCartesian([t.xmax,t.ymax,t.zmax],Tc);const r=Math.sqrt(Math.pow(Tc[0]-i[0],2)+Math.pow(Tc[1]-i[1],2)+Math.pow(Tc[2]-i[2],2));return Math.log2(Xm/(r+e[2]))}function N6(t,e,i){const[r,o,u,d]=t;return Xw({xmin:r,xmax:u,ymin:o,ymax:d,zmin:0,zmax:0},e,i)}function L6(t){t.getColumn(0,Tc);const e=t.getColumn(1),i=t.getColumn(2);return Tc.add(e).add(i).len()}const Ms={UNLOADED:0,LOADING:1,PROCESSING:2,READY:3,EXPIRED:4,FAILED:5};var En;(function(t){t[t.ADD=1]="ADD",t[t.REPLACE=2]="REPLACE"})(En||(En={}));var wo;(function(t){t.EMPTY="empty",t.SCENEGRAPH="scenegraph",t.POINTCLOUD="pointcloud",t.MESH="mesh"})(wo||(wo={}));var fs;(function(t){t.I3S="I3S",t.TILES3D="TILES3D"})(fs||(fs={}));var Ac;(function(t){t.GEOMETRIC_ERROR="geometricError",t.MAX_SCREEN_THRESHOLD="maxScreenThreshold"})(Ac||(Ac={}));const U6={NOT_COMPUTED:-1,USE_OPTIMIZATION:1,SKIP_OPTIMIZATION:0};function qw(t){return t!=null}const qr=new De,Hf=new De,z6=new De,V6=new De,Ja=new De,Zw=new De,Kw=new De,Yw=new De;function qm(t,e,i){if(mi(t,"3D Tile: boundingVolume must be defined"),t.box)return Jw(t.box,e,i);if(t.region)return G6(t.region);if(t.sphere)return H6(t.sphere,e,i);throw new Error("3D Tile: boundingVolume must contain a sphere, region, or box")}function j6(t,e){if(t.box)return $6(e);if(t.region){const[i,r,o,u,d,a]=t.region;return[[mn(i),mn(r),d],[mn(o),mn(u),a]]}if(t.sphere)return W6(e);throw new Error("Unkown boundingVolume type")}function Jw(t,e,i){const r=new De(t[0],t[1],t[2]);e.transform(r,r);let o=[];if(t.length===10){const A=t.slice(3,6),M=new zh;M.fromArray(t,6);const D=new De([1,0,0]),N=new De([0,1,0]),U=new De([0,0,1]);D.transformByQuaternion(M),D.scale(A[0]),N.transformByQuaternion(M),N.scale(A[1]),U.transformByQuaternion(M),U.scale(A[2]),o=[...D.toArray(),...N.toArray(),...U.toArray()]}else o=[...t.slice(3,6),...t.slice(6,9),...t.slice(9,12)];const u=e.transformAsVector(o.slice(0,3)),d=e.transformAsVector(o.slice(3,6)),a=e.transformAsVector(o.slice(6,9)),x=new Hi([u[0],u[1],u[2],d[0],d[1],d[2],a[0],a[1],a[2]]);return qw(i)?(i.center=r,i.halfAxes=x,i):new cu(r,x)}function H6(t,e,i){const r=new De(t[0],t[1],t[2]);e.transform(r,r);const o=e.getScale(Hf),u=Math.max(Math.max(o[0],o[1]),o[2]),d=t[3]*u;return qw(i)?(i.center=r,i.radius=d,i):new lu(r,d)}function G6(t){const[e,i,r,o,u,d]=t,a=yi.WGS84.cartographicToCartesian([mn(e),mn(o),u],z6),x=yi.WGS84.cartographicToCartesian([mn(r),mn(i),d],V6),A=new De().addVectors(a,x).multiplyByScalar(.5);return yi.WGS84.cartesianToCartographic(A,Ja),yi.WGS84.cartographicToCartesian([mn(r),Ja[1],Ja[2]],Zw),yi.WGS84.cartographicToCartesian([Ja[0],mn(o),Ja[2]],Kw),yi.WGS84.cartographicToCartesian([Ja[0],Ja[1],d],Yw),Jw([...A,...Zw.subtract(A),...Kw.subtract(A),...Yw.subtract(A)],new $t)}function $6(t){const e=Qw(),{halfAxes:i}=t,r=new De(i.getColumn(0)),o=new De(i.getColumn(1)),u=new De(i.getColumn(2));for(let d=0;d<2;d++){for(let a=0;a<2;a++){for(let x=0;x<2;x++)qr.copy(t.center),qr.add(r),qr.add(o),qr.add(u),eT(e,qr),u.negate();o.negate()}r.negate()}return e}function W6(t){const e=Qw(),{center:i,radius:r}=t,o=yi.WGS84.scaleToGeodeticSurface(i,qr);let u;o?u=yi.WGS84.geodeticSurfaceNormal(o):u=new De(0,0,1);let d=new De(u[2],-u[1],0);d.len()>0?d.normalize():d=new De(0,1,0);const a=d.clone().cross(u);for(const x of[d,a,u]){Hf.copy(x).scale(r);for(let A=0;A<2;A++)qr.copy(i),qr.add(Hf),eT(e,qr),Hf.negate()}return e}function Qw(){return[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]]}function eT(t,e){yi.WGS84.cartesianToCartographic(e,qr),t[0][0]=Math.min(t[0][0],qr[0]),t[0][1]=Math.min(t[0][1],qr[1]),t[0][2]=Math.min(t[0][2],qr[2]),t[1][0]=Math.max(t[1][0],qr[0]),t[1][1]=Math.max(t[1][1],qr[1]),t[1][2]=Math.max(t[1][2],qr[2])}new De,new De,new $t,new De,new De,new De;function X6(t,e){const i=t*e;return 1-Math.exp(-(i*i))}function q6(t,e){if(t.dynamicScreenSpaceError&&t.dynamicScreenSpaceErrorComputedDensity){const i=t.dynamicScreenSpaceErrorComputedDensity,r=t.dynamicScreenSpaceErrorFactor;return X6(e,i)*r}return 0}function Z6(t,e,i){const r=t.tileset,o=t.parent&&t.parent.lodMetricValue||t.lodMetricValue,u=i?o:t.lodMetricValue;if(u===0)return 0;const d=Math.max(t._distanceToCamera,1e-7),{height:a,sseDenominator:x}=e,{viewDistanceScale:A}=r.options;let M=u*a*(A||1)/(d*x);return M-=q6(r,d),M}const Zm=new De,tT=new De,oa=new De,iT=new De,K6=new De,Km=new $t,rT=new $t;function Y6(t,e){if(t.lodMetricValue===0||isNaN(t.lodMetricValue))return"DIG";const i=2*sT(t,e);return i<2?"OUT":!t.header.children||i<=t.lodMetricValue?"DRAW":t.header.children?"DIG":"OUT"}function sT(t,e){const{topDownViewport:i}=e,r=t.header.mbs[1],o=t.header.mbs[0],u=t.header.mbs[2],d=t.header.mbs[3],a=[...t.boundingVolume.center],x=i.unprojectPosition(i.cameraPosition);yi.WGS84.cartographicToCartesian(x,Zm),tT.copy(Zm).subtract(a).normalize(),yi.WGS84.eastNorthUpToFixedFrame(a,Km),rT.copy(Km).invert(),oa.copy(Zm).transform(rT);const A=Math.sqrt(oa[0]*oa[0]+oa[1]*oa[1]),M=A*A/oa[2];iT.copy([oa[0],oa[1],M]);const N=iT.transform(Km).subtract(a).normalize(),re=tT.cross(N).normalize().scale(d).add(a),ne=yi.WGS84.cartesianToCartographic(re),xe=i.project([o,r,u]),Ae=i.project(ne);return K6.copy(xe).subtract(Ae).magnitude()}function J6(t){return{assetGltfUpAxis:t.asset&&t.asset.gltfUpAxis||"Y"}}class nT{constructor(e=0){L(this,"_map",new Map);L(this,"_array");L(this,"_length");this._array=new Array(e),this._length=e}get length(){return this._length}set length(e){this._length=e,e>this._array.length&&(this._array.length=e)}get values(){return this._array}get(e){return mi(e<this._array.length),this._array[e]}set(e,i){mi(e>=0),e>=this.length&&(this.length=e+1),this._map.has(this._array[e])&&this._map.delete(this._array[e]),this._array[e]=i,this._map.set(i,e)}delete(e){const i=this._map.get(e);i>=0&&(this._array.splice(i,1),this._map.delete(e),this.length--)}peek(){return this._array[this._length-1]}push(e){if(!this._map.has(e)){const i=this.length++;this._array[i]=e,this._map.set(e,i)}}pop(){const e=this._array[--this.length];return this._map.delete(e),e}reserve(e){mi(e>=0),e>this._array.length&&(this._array.length=e)}resize(e){mi(e>=0),this.length=e}trim(e){e==null&&(e=this.length),this._array.length=e}reset(){this._array=[],this._map=new Map,this._length=0}find(e){return this._map.has(e)}}const Q6={loadSiblings:!1,skipLevelOfDetail:!1,updateTransforms:!0,onTraversalEnd:()=>{},viewportTraversersMap:{},basePath:""};class Gf{constructor(e){L(this,"options");L(this,"root",null);L(this,"selectedTiles",{});L(this,"requestedTiles",{});L(this,"emptyTiles",{});L(this,"lastUpdate",new Date().getTime());L(this,"updateDebounceTime",1e3);L(this,"_traversalStack",new nT);L(this,"_emptyTraversalStack",new nT);L(this,"_frameNumber",null);this.options={...Q6,...e}}traversalFinished(e){return!0}traverse(e,i,r){this.root=e,this.options={...this.options,...r},this.reset(),this.updateTile(e,i),this._frameNumber=i.frameNumber,this.executeTraversal(e,i)}reset(){this.requestedTiles={},this.selectedTiles={},this.emptyTiles={},this._traversalStack.reset(),this._emptyTraversalStack.reset()}executeTraversal(e,i){const r=this._traversalStack;for(e._selectionDepth=1,r.push(e);r.length>0;){const u=r.pop();let d=!1;this.canTraverse(u,i)&&(this.updateChildTiles(u,i),d=this.updateAndPushChildren(u,i,r,u.hasRenderContent?u._selectionDepth+1:u._selectionDepth));const a=u.parent,x=!!(!a||a._shouldRefine),A=!d;u.hasRenderContent?u.refine===En.ADD?(this.loadTile(u,i),this.selectTile(u,i)):u.refine===En.REPLACE&&(this.loadTile(u,i),A&&this.selectTile(u,i)):(this.emptyTiles[u.id]=u,this.loadTile(u,i),A&&this.selectTile(u,i)),this.touchTile(u,i),u._shouldRefine=d&&x}const o=new Date().getTime();(this.traversalFinished(i)||o-this.lastUpdate>this.updateDebounceTime)&&(this.lastUpdate=o,this.options.onTraversalEnd(i))}updateChildTiles(e,i){const r=e.children;for(const o of r)this.updateTile(o,i)}updateAndPushChildren(e,i,r,o){const{loadSiblings:u,skipLevelOfDetail:d}=this.options,a=e.children;a.sort(this.compareDistanceToCamera.bind(this));const x=e.refine===En.REPLACE&&e.hasRenderContent&&!d;let A=!1,M=!0;for(const D of a)if(D._selectionDepth=o,D.isVisibleAndInRequestVolume?(r.find(D)&&r.delete(D),r.push(D),A=!0):(x||u)&&(this.loadTile(D,i),this.touchTile(D,i)),x){let N;if(D._inRequestVolume?D.hasRenderContent?N=D.contentAvailable:N=this.executeEmptyTraversal(D,i):N=!1,M=M&&N,!M)return!1}return A||(M=!1),M}updateTile(e,i){this.updateTileVisibility(e,i)}selectTile(e,i){this.shouldSelectTile(e)&&(e._selectedFrame=i.frameNumber,this.selectedTiles[e.id]=e)}loadTile(e,i){this.shouldLoadTile(e)&&(e._requestedFrame=i.frameNumber,e._priority=e._getPriority(),this.requestedTiles[e.id]=e)}touchTile(e,i){e.tileset._cache.touch(e),e._touchedFrame=i.frameNumber}canTraverse(e,i){return e.hasChildren?e.hasTilesetContent?!e.contentExpired:this.shouldRefine(e,i):!1}shouldLoadTile(e){return e.hasUnloadedContent||e.contentExpired}shouldSelectTile(e){return e.contentAvailable&&!this.options.skipLevelOfDetail}shouldRefine(e,i,r=!1){let o=e._screenSpaceError;return r&&(o=e.getScreenSpaceError(i,!0)),o>e.tileset.memoryAdjustedScreenSpaceError}updateTileVisibility(e,i){const r=[];if(this.options.viewportTraversersMap)for(const o in this.options.viewportTraversersMap)this.options.viewportTraversersMap[o]===i.viewport.id&&r.push(o);else r.push(i.viewport.id);e.updateVisibility(i,r)}compareDistanceToCamera(e,i){return e._distanceToCamera-i._distanceToCamera}anyChildrenVisible(e,i){let r=!1;for(const o of e.children)o.updateVisibility(i),r=r||o.isVisibleAndInRequestVolume;return r}executeEmptyTraversal(e,i){let r=!0;const o=this._emptyTraversalStack;for(o.push(e);o.length>0;){const u=o.pop(),d=!u.hasRenderContent&&this.canTraverse(u,i),a=!u.hasRenderContent&&u.children.length===0;if(!d&&!u.contentAvailable&&!a&&(r=!1),this.updateTile(u,i),u.isVisibleAndInRequestVolume||(this.loadTile(u,i),this.touchTile(u,i)),d){const x=u.children;for(const A of x)o.push(A)}}return r}}const oT=new De;function e4(t){return t!=null}class Ym{constructor(e,i,r,o=""){L(this,"tileset");L(this,"header");L(this,"id");L(this,"url");L(this,"parent");L(this,"refine");L(this,"type");L(this,"contentUrl");L(this,"lodMetricType","geometricError");L(this,"lodMetricValue",0);L(this,"boundingVolume",null);L(this,"content",null);L(this,"contentState",Ms.UNLOADED);L(this,"gpuMemoryUsageInBytes",0);L(this,"children",[]);L(this,"depth",0);L(this,"viewportIds",[]);L(this,"transform",new $t);L(this,"extensions",null);L(this,"implicitTiling",null);L(this,"userData",{});L(this,"computedTransform");L(this,"hasEmptyContent",!1);L(this,"hasTilesetContent",!1);L(this,"traverser",new Gf({}));L(this,"_cacheNode",null);L(this,"_frameNumber",null);L(this,"_expireDate",null);L(this,"_expiredContent",null);L(this,"_boundingBox");L(this,"_distanceToCamera",0);L(this,"_screenSpaceError",0);L(this,"_visibilityPlaneMask");L(this,"_visible");L(this,"_contentBoundingVolume");L(this,"_viewerRequestVolume");L(this,"_initialTransform",new $t);L(this,"_priority",0);L(this,"_selectedFrame",0);L(this,"_requestedFrame",0);L(this,"_selectionDepth",0);L(this,"_touchedFrame",0);L(this,"_centerZDepth",0);L(this,"_shouldRefine",!1);L(this,"_stackLength",0);L(this,"_visitedFrame",0);L(this,"_inRequestVolume",!1);L(this,"_lodJudge",null);this.header=i,this.tileset=e,this.id=o||i.id,this.url=i.url,this.parent=r,this.refine=this._getRefine(i.refine),this.type=i.type,this.contentUrl=i.contentUrl,this._initializeLodMetric(i),this._initializeTransforms(i),this._initializeBoundingVolumes(i),this._initializeContent(i),this._initializeRenderingState(i),Object.seal(this)}destroy(){this.header=null}isDestroyed(){return this.header===null}get selected(){return this._selectedFrame===this.tileset._frameNumber}get isVisible(){return this._visible}get isVisibleAndInRequestVolume(){return this._visible&&this._inRequestVolume}get hasRenderContent(){return!this.hasEmptyContent&&!this.hasTilesetContent}get hasChildren(){return this.children.length>0||this.header.children&&this.header.children.length>0}get contentReady(){return this.contentState===Ms.READY||this.hasEmptyContent}get contentAvailable(){return!!(this.contentReady&&this.hasRenderContent||this._expiredContent&&!this.contentFailed)}get hasUnloadedContent(){return this.hasRenderContent&&this.contentUnloaded}get contentUnloaded(){return this.contentState===Ms.UNLOADED}get contentExpired(){return this.contentState===Ms.EXPIRED}get contentFailed(){return this.contentState===Ms.FAILED}get distanceToCamera(){return this._distanceToCamera}get screenSpaceError(){return this._screenSpaceError}get boundingBox(){return this._boundingBox||(this._boundingBox=j6(this.header.boundingVolume,this.boundingVolume)),this._boundingBox}getScreenSpaceError(e,i){switch(this.tileset.type){case fs.I3S:return sT(this,e);case fs.TILES3D:return Z6(this,e,i);default:throw new Error("Unsupported tileset type")}}unselect(){this._selectedFrame=0}_getGpuMemoryUsageInBytes(){return this.content.gpuMemoryUsageInBytes||this.content.byteLength||0}_getPriority(){const e=this.tileset._traverser,{skipLevelOfDetail:i}=e.options,r=this.refine===En.ADD||i;if(r&&!this.isVisible&&this._visible!==void 0||this.tileset._frameNumber-this._touchedFrame>=1||this.contentState===Ms.UNLOADED)return-1;const o=this.parent,d=o&&(!r||this._screenSpaceError===0||o.hasTilesetContent)?o._screenSpaceError:this._screenSpaceError,a=e.root?e.root._screenSpaceError:0;return Math.max(a-d,0)}async loadContent(){if(this.hasEmptyContent)return!1;if(this.content)return!0;this.contentExpired&&(this._expireDate=null),this.contentState=Ms.LOADING;const i=await this.tileset._requestScheduler.scheduleRequest(this.id,this._getPriority.bind(this));if(!i)return this.contentState=Ms.UNLOADED,!1;try{const r=this.tileset.getTileUrl(this.contentUrl),o=this.tileset.loader,u={...this.tileset.loadOptions,[o.id]:{...this.tileset.loadOptions[o.id],isTileset:this.type==="json",...this._getLoaderSpecificOptions(o.id)}};return this.content=await $o(r,o,u),this.tileset.options.contentLoader&&await this.tileset.options.contentLoader(this),this._isTileset()&&this.tileset._initializeTileHeaders(this.content,this),this.contentState=Ms.READY,this._onContentLoaded(),!0}catch(r){throw this.contentState=Ms.FAILED,r}finally{i.done()}}unloadContent(){return this.content&&this.content.destroy&&this.content.destroy(),this.content=null,this.header.content&&this.header.content.destroy&&this.header.content.destroy(),this.header.content=null,this.contentState=Ms.UNLOADED,!0}updateVisibility(e,i){if(this._frameNumber===e.frameNumber)return;const r=this.parent,o=r?r._visibilityPlaneMask:tn.MASK_INDETERMINATE;if(this.tileset._traverser.options.updateTransforms){const u=r?r.computedTransform:this.tileset.modelMatrix;this._updateTransform(u)}this._distanceToCamera=this.distanceToTile(e),this._screenSpaceError=this.getScreenSpaceError(e,!1),this._visibilityPlaneMask=this.visibility(e,o),this._visible=this._visibilityPlaneMask!==tn.MASK_OUTSIDE,this._inRequestVolume=this.insideViewerRequestVolume(e),this._frameNumber=e.frameNumber,this.viewportIds=i}visibility(e,i){const{cullingVolume:r}=e,{boundingVolume:o}=this;return r.computeVisibilityWithPlaneMask(o,i)}contentVisibility(){return!0}distanceToTile(e){const i=this.boundingVolume;return Math.sqrt(Math.max(i.distanceSquaredTo(e.camera.position),0))}cameraSpaceZDepth({camera:e}){const i=this.boundingVolume;return oT.subVectors(i.center,e.position),e.direction.dot(oT)}insideViewerRequestVolume(e){const i=this._viewerRequestVolume;return!i||i.distanceSquaredTo(e.camera.position)<=0}updateExpiration(){if(e4(this._expireDate)&&this.contentReady&&!this.hasEmptyContent){const e=Date.now();Date.lessThan(this._expireDate,e)&&(this.contentState=Ms.EXPIRED,this._expiredContent=this.content)}}get extras(){return this.header.extras}_initializeLodMetric(e){"lodMetricType"in e?this.lodMetricType=e.lodMetricType:(this.lodMetricType=this.parent&&this.parent.lodMetricType||this.tileset.lodMetricType,console.warn("3D Tile: Required prop lodMetricType is undefined. Using parent lodMetricType")),"lodMetricValue"in e?this.lodMetricValue=e.lodMetricValue:(this.lodMetricValue=this.parent&&this.parent.lodMetricValue||this.tileset.lodMetricValue,console.warn("3D Tile: Required prop lodMetricValue is undefined. Using parent lodMetricValue"))}_initializeTransforms(e){this.transform=e.transform?new $t(e.transform):new $t;const i=this.parent,r=this.tileset,o=i&&i.computedTransform?i.computedTransform.clone():r.modelMatrix.clone();this.computedTransform=new $t(o).multiplyRight(this.transform);const u=i&&i._initialTransform?i._initialTransform.clone():new $t;this._initialTransform=new $t(u).multiplyRight(this.transform)}_initializeBoundingVolumes(e){this._contentBoundingVolume=null,this._viewerRequestVolume=null,this._updateBoundingVolume(e)}_initializeContent(e){this.content={_tileset:this.tileset,_tile:this},this.hasEmptyContent=!0,this.contentState=Ms.UNLOADED,this.hasTilesetContent=!1,e.contentUrl&&(this.content=null,this.hasEmptyContent=!1)}_initializeRenderingState(e){this.depth=e.level||(this.parent?this.parent.depth+1:0),this._shouldRefine=!1,this._distanceToCamera=0,this._centerZDepth=0,this._screenSpaceError=0,this._visibilityPlaneMask=tn.MASK_INDETERMINATE,this._visible=void 0,this._inRequestVolume=!1,this._stackLength=0,this._selectionDepth=0,this._frameNumber=0,this._touchedFrame=0,this._visitedFrame=0,this._selectedFrame=0,this._requestedFrame=0,this._priority=0}_getRefine(e){return e||this.parent&&this.parent.refine||En.REPLACE}_isTileset(){return this.contentUrl.indexOf(".json")!==-1}_onContentLoaded(){switch(this.content&&this.content.type){case"vctr":case"geom":this.tileset._traverser.disableSkipLevelOfDetail=!0;break}this._isTileset()?this.hasTilesetContent=!0:this.gpuMemoryUsageInBytes=this._getGpuMemoryUsageInBytes()}_updateBoundingVolume(e){this.boundingVolume=qm(e.boundingVolume,this.computedTransform,this.boundingVolume);const i=e.content;i&&(i.boundingVolume&&(this._contentBoundingVolume=qm(i.boundingVolume,this.computedTransform,this._contentBoundingVolume)),e.viewerRequestVolume&&(this._viewerRequestVolume=qm(e.viewerRequestVolume,this.computedTransform,this._viewerRequestVolume)))}_updateTransform(e=new $t){const i=e.clone().multiplyRight(this.transform);i.equals(this.computedTransform)||(this.computedTransform=i,this._updateBoundingVolume(this.header))}_getLoaderSpecificOptions(e){switch(e){case"i3s":return{...this.tileset.options.i3s,_tileOptions:{attributeUrls:this.header.attributeUrls,textureUrl:this.header.textureUrl,textureFormat:this.header.textureFormat,textureLoaderOptions:this.header.textureLoaderOptions,materialDefinition:this.header.materialDefinition,isDracoGeometry:this.header.isDracoGeometry,mbs:this.header.mbs},_tilesetOptions:{store:this.tileset.tileset.store,attributeStorageInfo:this.tileset.tileset.attributeStorageInfo,fields:this.tileset.tileset.fields},isTileHeader:!1};case"3d-tiles":case"cesium-ion":default:return J6(this.tileset.tileset)}}}class t4 extends Gf{compareDistanceToCamera(e,i){return i._distanceToCamera===0&&e._distanceToCamera===0?i._centerZDepth-e._centerZDepth:i._distanceToCamera-e._distanceToCamera}updateTileVisibility(e,i){if(super.updateTileVisibility(e,i),!e.isVisibleAndInRequestVolume)return;const r=e.children.length>0;if(e.hasTilesetContent&&r){const d=e.children[0];this.updateTileVisibility(d,i),e._visible=d._visible;return}if(this.meetsScreenSpaceErrorEarly(e,i)){e._visible=!1;return}const o=e.refine===En.REPLACE,u=e._optimChildrenWithinParent===U6.USE_OPTIMIZATION;if(o&&u&&r&&!this.anyChildrenVisible(e,i)){e._visible=!1;return}}meetsScreenSpaceErrorEarly(e,i){const{parent:r}=e;return!r||r.hasTilesetContent||r.refine!==En.ADD?!1:!this.shouldRefine(e,i,!0)}}class i4{constructor(){L(this,"frameNumberMap",new Map)}register(e,i){const r=this.frameNumberMap.get(e)||new Map,o=r.get(i)||0;r.set(i,o+1),this.frameNumberMap.set(e,r)}deregister(e,i){const r=this.frameNumberMap.get(e);if(!r)return;const o=r.get(i)||1;r.set(i,o-1)}isZero(e,i){var o;return(((o=this.frameNumberMap.get(e))==null?void 0:o.get(i))||0)===0}}const Jm={REQUESTED:"REQUESTED",COMPLETED:"COMPLETED",ERROR:"ERROR"};class r4{constructor(){L(this,"_statusMap");L(this,"pendingTilesRegister",new i4);this._statusMap={}}add(e,i,r,o){if(!this._statusMap[i]){const{frameNumber:u,viewport:{id:d}}=o;this._statusMap[i]={request:e,callback:r,key:i,frameState:o,status:Jm.REQUESTED},this.pendingTilesRegister.register(d,u),e().then(a=>{this._statusMap[i].status=Jm.COMPLETED;const{frameNumber:x,viewport:{id:A}}=this._statusMap[i].frameState;this.pendingTilesRegister.deregister(A,x),this._statusMap[i].callback(a,o)}).catch(a=>{this._statusMap[i].status=Jm.ERROR;const{frameNumber:x,viewport:{id:A}}=this._statusMap[i].frameState;this.pendingTilesRegister.deregister(A,x),r(a)})}}update(e,i){if(this._statusMap[e]){const{frameNumber:r,viewport:{id:o}}=this._statusMap[e].frameState;this.pendingTilesRegister.deregister(o,r);const{frameNumber:u,viewport:{id:d}}=i;this.pendingTilesRegister.register(d,u),this._statusMap[e].frameState=i}}find(e){return this._statusMap[e]}hasPendingTiles(e,i){return!this.pendingTilesRegister.isZero(e,i)}}class s4 extends Gf{constructor(i){super(i);L(this,"_tileManager");this._tileManager=new r4}traversalFinished(i){return!this._tileManager.hasPendingTiles(i.viewport.id,this._frameNumber||0)}shouldRefine(i,r){return i._lodJudge=Y6(i,r),i._lodJudge==="DIG"}updateChildTiles(i,r){const o=i.header.children||[],u=i.children,d=i.tileset;for(const a of o){const x=`${a.id}-${r.viewport.id}`,A=u&&u.find(M=>M.id===x);if(A)A&&this.updateTile(A,r);else{let M=()=>this._loadTile(a.id,d);this._tileManager.find(x)?this._tileManager.update(x,r):(d.tileset.nodePages&&(M=()=>d.tileset.nodePagesTile.formTileFromNodePages(a.id)),this._tileManager.add(M,x,N=>this._onTileLoad(N,i,x),r))}}return!1}async _loadTile(i,r){const{loader:o}=r,u=r.getTileUrl(`${r.url}/nodes/${i}`),d={...r.loadOptions,i3s:{...r.loadOptions.i3s,isTileHeader:!0}};return await $o(u,o,d)}_onTileLoad(i,r,o){const u=new Ym(r.tileset,i,r,o);r.children.push(u);const d=this._tileManager.find(u.id).frameState;this.updateTile(u,d),this._frameNumber===d.frameNumber&&(this.traversalFinished(d)||new Date().getTime()-this.lastUpdate>this.updateDebounceTime)&&this.executeTraversal(u,d)}}const n4={description:"",ellipsoid:yi.WGS84,modelMatrix:new $t,throttleRequests:!0,maxRequests:64,maximumMemoryUsage:32,memoryCacheOverflow:1,maximumTilesSelected:0,debounceTime:0,onTileLoad:()=>{},onTileUnload:()=>{},onTileError:()=>{},onTraversalComplete:t=>t,contentLoader:void 0,viewDistanceScale:1,maximumScreenSpaceError:8,memoryAdjustedScreenSpaceError:!1,loadTiles:!0,updateTransforms:!0,viewportTraversersMap:null,loadOptions:{fetch:{}},attributions:[],basePath:"",i3s:{}},$f="Tiles In Tileset(s)",Qm="Tiles In Memory",aT="Tiles In View",lT="Tiles To Render",cT="Tiles Loaded",ey="Tiles Loading",hT="Tiles Unloaded",uT="Failed Tile Loads",dT="Points/Vertices",ty="Tile Memory Use",fT="Maximum Screen Space Error";class o4{constructor(e,i){L(this,"options");L(this,"loadOptions");L(this,"type");L(this,"tileset");L(this,"loader");L(this,"url");L(this,"basePath");L(this,"modelMatrix");L(this,"ellipsoid");L(this,"lodMetricType");L(this,"lodMetricValue");L(this,"refine");L(this,"root",null);L(this,"roots",{});L(this,"asset",{});L(this,"description","");L(this,"properties");L(this,"extras",null);L(this,"attributions",{});L(this,"credits",{});L(this,"stats");L(this,"contentFormats",{draco:!1,meshopt:!1,dds:!1,ktx2:!1});L(this,"cartographicCenter",null);L(this,"cartesianCenter",null);L(this,"zoom",1);L(this,"boundingVolume",null);L(this,"dynamicScreenSpaceErrorComputedDensity",0);L(this,"maximumMemoryUsage",32);L(this,"gpuMemoryUsageInBytes",0);L(this,"memoryAdjustedScreenSpaceError",0);L(this,"_cacheBytes",0);L(this,"_cacheOverflowBytes",0);L(this,"_frameNumber",0);L(this,"_queryParams",{});L(this,"_extensionsUsed",[]);L(this,"_tiles",{});L(this,"_pendingCount",0);L(this,"selectedTiles",[]);L(this,"traverseCounter",0);L(this,"geometricError",0);L(this,"lastUpdatedVieports",null);L(this,"_requestedTiles",[]);L(this,"_emptyTiles",[]);L(this,"frameStateData",{});L(this,"_traverser");L(this,"_cache",new M6);L(this,"_requestScheduler");L(this,"updatePromise",null);L(this,"tilesetInitializationPromise");this.options={...n4,...i},this.tileset=e,this.loader=e.loader,this.type=e.type,this.url=e.url,this.basePath=e.basePath||C_(this.url),this.modelMatrix=this.options.modelMatrix,this.ellipsoid=this.options.ellipsoid,this.lodMetricType=e.lodMetricType,this.lodMetricValue=e.lodMetricValue,this.refine=e.root.refine,this.loadOptions=this.options.loadOptions||{},this._traverser=this._initializeTraverser(),this._requestScheduler=new VS({throttleRequests:this.options.throttleRequests,maxRequests:this.options.maxRequests}),this.memoryAdjustedScreenSpaceError=this.options.maximumScreenSpaceError,this._cacheBytes=this.options.maximumMemoryUsage*1024*1024,this._cacheOverflowBytes=this.options.memoryCacheOverflow*1024*1024,this.stats=new Wl({id:this.url}),this._initializeStats(),this.tilesetInitializationPromise=this._initializeTileSet(e)}destroy(){this._destroy()}isLoaded(){return this._pendingCount===0&&this._frameNumber!==0&&this._requestedTiles.length===0}get tiles(){return Object.values(this._tiles)}get frameNumber(){return this._frameNumber}get queryParams(){return new URLSearchParams(this._queryParams).toString()}setProps(e){this.options={...this.options,...e}}getTileUrl(e){if(e.startsWith("data:"))return e;let r=e;return this.queryParams.length&&(r=`${e}${e.includes("?")?"&":"?"}${this.queryParams}`),r}hasExtension(e){return this._extensionsUsed.indexOf(e)>-1}update(e=null){this.tilesetInitializationPromise.then(()=>{!e&&this.lastUpdatedVieports?e=this.lastUpdatedVieports:this.lastUpdatedVieports=e,e&&this.doUpdate(e)})}async selectTiles(e=null){return await this.tilesetInitializationPromise,e&&(this.lastUpdatedVieports=e),this.updatePromise||(this.updatePromise=new Promise(i=>{setTimeout(()=>{this.lastUpdatedVieports&&this.doUpdate(this.lastUpdatedVieports),i(this._frameNumber),this.updatePromise=null},this.options.debounceTime)})),this.updatePromise}adjustScreenSpaceError(){this.gpuMemoryUsageInBytes<this._cacheBytes?this.memoryAdjustedScreenSpaceError=Math.max(this.memoryAdjustedScreenSpaceError/1.02,this.options.maximumScreenSpaceError):this.gpuMemoryUsageInBytes>this._cacheBytes+this._cacheOverflowBytes&&(this.memoryAdjustedScreenSpaceError*=1.02)}doUpdate(e){if("loadTiles"in this.options&&!this.options.loadTiles||this.traverseCounter>0)return;const i=e instanceof Array?e:[e];this._cache.reset(),this._frameNumber++,this.traverseCounter=i.length;const r=[];for(const o of i){const u=o.id;this._needTraverse(u)?r.push(u):this.traverseCounter--}for(const o of i){const u=o.id;if(this.roots[u]||(this.roots[u]=this._initializeTileHeaders(this.tileset,null)),!r.includes(u))continue;const d=P6(o,this._frameNumber);this._traverser.traverse(this.roots[u],d,this.options)}}_needTraverse(e){let i=e;return this.options.viewportTraversersMap&&(i=this.options.viewportTraversersMap[e]),i===e}_onTraversalEnd(e){const i=e.viewport.id;this.frameStateData[i]||(this.frameStateData[i]={selectedTiles:[],_requestedTiles:[],_emptyTiles:[]});const r=this.frameStateData[i],o=Object.values(this._traverser.selectedTiles),[u,d]=B6(o,e,this.options.maximumTilesSelected);r.selectedTiles=u;for(const a of d)a.unselect();r._requestedTiles=Object.values(this._traverser.requestedTiles),r._emptyTiles=Object.values(this._traverser.emptyTiles),this.traverseCounter--,!(this.traverseCounter>0)&&this._updateTiles()}_updateTiles(){this.selectedTiles=[],this._requestedTiles=[],this._emptyTiles=[];for(const e in this.frameStateData){const i=this.frameStateData[e];this.selectedTiles=this.selectedTiles.concat(i.selectedTiles),this._requestedTiles=this._requestedTiles.concat(i._requestedTiles),this._emptyTiles=this._emptyTiles.concat(i._emptyTiles)}this.selectedTiles=this.options.onTraversalComplete(this.selectedTiles);for(const e of this.selectedTiles)this._tiles[e.id]=e;this._loadTiles(),this._unloadTiles(),this._updateStats()}_tilesChanged(e,i){if(e.length!==i.length)return!0;const r=new Set(e.map(d=>d.id)),o=new Set(i.map(d=>d.id));let u=e.filter(d=>!o.has(d.id)).length>0;return u=u||i.filter(d=>!r.has(d.id)).length>0,u}_loadTiles(){for(const e of this._requestedTiles)e.contentUnloaded&&this._loadTile(e)}_unloadTiles(){this._cache.unloadTiles(this,(e,i)=>e._unloadTile(i))}_updateStats(){let e=0,i=0;for(const r of this.selectedTiles)r.contentAvailable&&r.content&&(e++,r.content.pointCount?i+=r.content.pointCount:i+=r.content.vertexCount);this.stats.get(aT).count=this.selectedTiles.length,this.stats.get(lT).count=e,this.stats.get(dT).count=i,this.stats.get(fT).count=this.memoryAdjustedScreenSpaceError}async _initializeTileSet(e){this.type===fs.I3S&&(this.calculateViewPropsI3S(),e.root=await e.root),this.root=this._initializeTileHeaders(e,null),this.type===fs.TILES3D&&(this._initializeTiles3DTileset(e),this.calculateViewPropsTiles3D()),this.type===fs.I3S&&this._initializeI3STileset()}calculateViewPropsI3S(){var r;const e=this.tileset.fullExtent;if(e){const{xmin:o,xmax:u,ymin:d,ymax:a,zmin:x,zmax:A}=e;this.cartographicCenter=new De(o+(u-o)/2,d+(a-d)/2,x+(A-x)/2),this.cartesianCenter=new De,yi.WGS84.cartographicToCartesian(this.cartographicCenter,this.cartesianCenter),this.zoom=Xw(e,this.cartographicCenter,this.cartesianCenter);return}const i=(r=this.tileset.store)==null?void 0:r.extent;if(i){const[o,u,d,a]=i;this.cartographicCenter=new De(o+(d-o)/2,u+(a-u)/2,0),this.cartesianCenter=new De,yi.WGS84.cartographicToCartesian(this.cartographicCenter,this.cartesianCenter),this.zoom=N6(i,this.cartographicCenter,this.cartesianCenter);return}console.warn("Extent is not defined in the tileset header"),this.cartographicCenter=new De,this.zoom=1}calculateViewPropsTiles3D(){const e=this.root,{center:i}=e.boundingVolume;if(!i){console.warn("center was not pre-calculated for the root tile"),this.cartographicCenter=new De,this.zoom=1;return}i[0]!==0||i[1]!==0||i[2]!==0?(this.cartographicCenter=new De,yi.WGS84.cartesianToCartographic(i,this.cartographicCenter)):this.cartographicCenter=new De(0,0,-yi.WGS84.radii[0]),this.cartesianCenter=i,this.zoom=k6(e.boundingVolume,this.cartographicCenter)}_initializeStats(){this.stats.get($f),this.stats.get(ey),this.stats.get(Qm),this.stats.get(aT),this.stats.get(lT),this.stats.get(cT),this.stats.get(hT),this.stats.get(uT),this.stats.get(dT),this.stats.get(ty,"memory"),this.stats.get(fT)}_initializeTileHeaders(e,i){var o;const r=new Ym(this,e.root,i);if(i&&(i.children.push(r),r.depth=i.depth+1),this.type===fs.TILES3D){const u=[];for(u.push(r);u.length>0;){const d=u.pop();this.stats.get($f).incrementCount();const a=d.header.children||[];for(const x of a){const A=new Ym(this,x,d);if((o=A.contentUrl)!=null&&o.includes("?session=")){const D=new URL(A.contentUrl).searchParams.get("session");D&&(this._queryParams.session=D)}d.children.push(A),A.depth=d.depth+1,u.push(A)}}}return r}_initializeTraverser(){let e;switch(this.type){case fs.TILES3D:e=t4;break;case fs.I3S:e=s4;break;default:e=Gf}return new e({basePath:this.basePath,onTraversalEnd:this._onTraversalEnd.bind(this)})}_destroyTileHeaders(e){this._destroySubtree(e)}async _loadTile(e){let i;try{this._onStartTileLoading(),i=await e.loadContent()}catch(r){this._onTileLoadError(e,r instanceof Error?r:new Error("load failed"))}finally{this._onEndTileLoading(),this._onTileLoad(e,i)}}_onTileLoadError(e,i){this.stats.get(uT).incrementCount();const r=i.message||i.toString(),o=e.url;console.error(`A 3D tile failed to load: ${e.url} ${r}`),this.options.onTileError(e,r,o)}_onTileLoad(e,i){var r,o;if(i){if(this.type===fs.I3S){const u=((o=(r=this.tileset)==null?void 0:r.nodePagesTile)==null?void 0:o.nodesInNodePages)||0;this.stats.get($f).reset(),this.stats.get($f).addCount(u)}e&&e.content&&R6(e,e.content),this.updateContentTypes(e),this._addTileToCache(e),this.options.onTileLoad(e)}}updateContentTypes(e){var i;if(this.type===fs.I3S)switch(e.header.isDracoGeometry&&(this.contentFormats.draco=!0),e.header.textureFormat){case"dds":this.contentFormats.dds=!0;break;case"ktx2":this.contentFormats.ktx2=!0;break}else if(this.type===fs.TILES3D){const{extensionsRemoved:r=[]}=((i=e.content)==null?void 0:i.gltf)||{};r.includes("KHR_draco_mesh_compression")&&(this.contentFormats.draco=!0),r.includes("EXT_meshopt_compression")&&(this.contentFormats.meshopt=!0),r.includes("KHR_texture_basisu")&&(this.contentFormats.ktx2=!0)}}_onStartTileLoading(){this._pendingCount++,this.stats.get(ey).incrementCount()}_onEndTileLoading(){this._pendingCount--,this.stats.get(ey).decrementCount()}_addTileToCache(e){this._cache.add(this,e,i=>i._updateCacheStats(e))}_updateCacheStats(e){this.stats.get(cT).incrementCount(),this.stats.get(Qm).incrementCount(),this.gpuMemoryUsageInBytes+=e.gpuMemoryUsageInBytes||0,this.stats.get(ty).count=this.gpuMemoryUsageInBytes,this.options.memoryAdjustedScreenSpaceError&&this.adjustScreenSpaceError()}_unloadTile(e){this.gpuMemoryUsageInBytes-=e.gpuMemoryUsageInBytes||0,this.stats.get(Qm).decrementCount(),this.stats.get(hT).incrementCount(),this.stats.get(ty).count=this.gpuMemoryUsageInBytes,this.options.onTileUnload(e),e.unloadContent()}_destroy(){const e=[];for(this.root&&e.push(this.root);e.length>0;){const i=e.pop();for(const r of i.children)e.push(r);this._destroyTile(i)}this.root=null}_destroySubtree(e){const i=e,r=[];for(r.push(i);r.length>0;){e=r.pop();for(const o of e.children)r.push(o);e!==i&&this._destroyTile(e)}i.children=[]}_destroyTile(e){this._cache.unloadTile(this,e),this._unloadTile(e),e.destroy()}_initializeTiles3DTileset(e){if(e.queryString){const i=new URLSearchParams(e.queryString),r=Object.fromEntries(i.entries());this._queryParams={...this._queryParams,...r}}if(this.asset=e.asset,!this.asset)throw new Error("Tileset must have an asset property.");if(this.asset.version!=="0.0"&&this.asset.version!=="1.0"&&this.asset.version!=="1.1")throw new Error("The tileset must be 3D Tiles version either 0.0 or 1.0 or 1.1.");"tilesetVersion"in this.asset&&(this._queryParams.v=this.asset.tilesetVersion),this.credits={attributions:this.options.attributions||[]},this.description=this.options.description||"",this.properties=e.properties,this.geometricError=e.geometricError,this._extensionsUsed=e.extensionsUsed||[],this.extras=e.extras}_initializeI3STileset(){this.loadOptions.i3s&&"token"in this.loadOptions.i3s&&(this._queryParams.token=this.loadOptions.i3s.token)}}const pT="4.3.1",_u={COMPOSITE:"cmpt",POINT_CLOUD:"pnts",BATCHED_3D_MODEL:"b3dm",INSTANCED_3D_MODEL:"i3dm",GEOMETRY:"geom",VECTOR:"vect",GLTF:"glTF"};function _T(t,e,i){mi(t instanceof ArrayBuffer);const r=new TextDecoder("utf8"),o=new Uint8Array(t,e,i);return r.decode(o)}function a4(t,e=0){const i=new DataView(t);return`${String.fromCharCode(i.getUint8(e+0))}${String.fromCharCode(i.getUint8(e+1))}${String.fromCharCode(i.getUint8(e+2))}${String.fromCharCode(i.getUint8(e+3))}`}const l4={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},nr={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DOUBLE:5130},Kt={...l4,...nr},iy={[nr.DOUBLE]:Float64Array,[nr.FLOAT]:Float32Array,[nr.UNSIGNED_SHORT]:Uint16Array,[nr.UNSIGNED_INT]:Uint32Array,[nr.UNSIGNED_BYTE]:Uint8Array,[nr.BYTE]:Int8Array,[nr.SHORT]:Int16Array,[nr.INT]:Int32Array},c4={DOUBLE:nr.DOUBLE,FLOAT:nr.FLOAT,UNSIGNED_SHORT:nr.UNSIGNED_SHORT,UNSIGNED_INT:nr.UNSIGNED_INT,UNSIGNED_BYTE:nr.UNSIGNED_BYTE,BYTE:nr.BYTE,SHORT:nr.SHORT,INT:nr.INT},ry="Failed to convert GL type";class Yn{static fromTypedArray(e){e=ArrayBuffer.isView(e)?e.constructor:e;for(const i in iy)if(iy[i]===e)return i;throw new Error(ry)}static fromName(e){const i=c4[e];if(!i)throw new Error(ry);return i}static getArrayType(e){switch(e){case nr.UNSIGNED_SHORT_5_6_5:case nr.UNSIGNED_SHORT_4_4_4_4:case nr.UNSIGNED_SHORT_5_5_5_1:return Uint16Array;default:const i=iy[e];if(!i)throw new Error(ry);return i}}static getByteSize(e){return Yn.getArrayType(e).BYTES_PER_ELEMENT}static validate(e){return!!Yn.getArrayType(e)}static createTypedArray(e,i,r=0,o){o===void 0&&(o=(i.byteLength-r)/Yn.getByteSize(e));const u=Yn.getArrayType(e);return new u(i,r,o)}}function h4(t,e){if(!t)throw new Error(`math.gl assertion failed. ${e}`)}function u4(t,e=[0,0,0]){const i=t>>11&31,r=t>>5&63,o=t&31;return e[0]=i<<3,e[1]=r<<2,e[2]=o<<3,e}new ug,new De,new ug,new ug;function gT(t,e=255){return yo(t,0,e)/e*2-1}function mT(t){return t<0?-1:1}function d4(t,e,i,r){if(h4(r),t<0||t>i||e<0||e>i)throw new Error(`x and y must be unsigned normalized integers between 0 and ${i}`);if(r.x=gT(t,i),r.y=gT(e,i),r.z=1-(Math.abs(r.x)+Math.abs(r.y)),r.z<0){const o=r.x;r.x=(1-Math.abs(r.y))*mT(o),r.y=(1-Math.abs(o))*mT(r.y)}return r.normalize()}function f4(t,e,i){return d4(t,e,255,i)}class sy{constructor(e,i){L(this,"json");L(this,"buffer");L(this,"featuresLength",0);L(this,"_cachedTypedArrays",{});this.json=e,this.buffer=i}getExtension(e){return this.json.extensions&&this.json.extensions[e]}hasProperty(e){return!!this.json[e]}getGlobalProperty(e,i=Kt.UNSIGNED_INT,r=1){const o=this.json[e];return o&&Number.isFinite(o.byteOffset)?this._getTypedArrayFromBinary(e,i,r,1,o.byteOffset):o}getPropertyArray(e,i,r){const o=this.json[e];return o&&Number.isFinite(o.byteOffset)?("componentType"in o&&(i=Yn.fromName(o.componentType)),this._getTypedArrayFromBinary(e,i,r,this.featuresLength,o.byteOffset)):this._getTypedArrayFromArray(e,i,o)}getProperty(e,i,r,o,u){const d=this.json[e];if(!d)return d;const a=this.getPropertyArray(e,i,r);if(r===1)return a[o];for(let x=0;x<r;++x)u[x]=a[r*o+x];return u}_getTypedArrayFromBinary(e,i,r,o,u){const d=this._cachedTypedArrays;let a=d[e];return a||(a=Yn.createTypedArray(i,this.buffer.buffer,this.buffer.byteOffset+u,o*r),d[e]=a),a}_getTypedArrayFromArray(e,i,r){const o=this._cachedTypedArrays;let u=o[e];return u||(u=Yn.createTypedArray(i,r),o[e]=u),u}}const p4={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},_4={SCALAR:(t,e)=>t[e],VEC2:(t,e)=>[t[2*e+0],t[2*e+1]],VEC3:(t,e)=>[t[3*e+0],t[3*e+1],t[3*e+2]],VEC4:(t,e)=>[t[4*e+0],t[4*e+1],t[4*e+2],t[4*e+3]],MAT2:(t,e)=>[t[4*e+0],t[4*e+1],t[4*e+2],t[4*e+3]],MAT3:(t,e)=>[t[9*e+0],t[9*e+1],t[9*e+2],t[9*e+3],t[9*e+4],t[9*e+5],t[9*e+6],t[9*e+7],t[9*e+8]],MAT4:(t,e)=>[t[16*e+0],t[16*e+1],t[16*e+2],t[16*e+3],t[16*e+4],t[16*e+5],t[16*e+6],t[16*e+7],t[16*e+8],t[16*e+9],t[16*e+10],t[16*e+11],t[16*e+12],t[16*e+13],t[16*e+14],t[16*e+15]]},g4={SCALAR:(t,e,i)=>{e[i]=t},VEC2:(t,e,i)=>{e[2*i+0]=t[0],e[2*i+1]=t[1]},VEC3:(t,e,i)=>{e[3*i+0]=t[0],e[3*i+1]=t[1],e[3*i+2]=t[2]},VEC4:(t,e,i)=>{e[4*i+0]=t[0],e[4*i+1]=t[1],e[4*i+2]=t[2],e[4*i+3]=t[3]},MAT2:(t,e,i)=>{e[4*i+0]=t[0],e[4*i+1]=t[1],e[4*i+2]=t[2],e[4*i+3]=t[3]},MAT3:(t,e,i)=>{e[9*i+0]=t[0],e[9*i+1]=t[1],e[9*i+2]=t[2],e[9*i+3]=t[3],e[9*i+4]=t[4],e[9*i+5]=t[5],e[9*i+6]=t[6],e[9*i+7]=t[7],e[9*i+8]=t[8],e[9*i+9]=t[9]},MAT4:(t,e,i)=>{e[16*i+0]=t[0],e[16*i+1]=t[1],e[16*i+2]=t[2],e[16*i+3]=t[3],e[16*i+4]=t[4],e[16*i+5]=t[5],e[16*i+6]=t[6],e[16*i+7]=t[7],e[16*i+8]=t[8],e[16*i+9]=t[9],e[16*i+10]=t[10],e[16*i+11]=t[11],e[16*i+12]=t[12],e[16*i+13]=t[13],e[16*i+14]=t[14],e[16*i+15]=t[15]}};function m4(t,e,i,r){const{componentType:o}=t;mi(t.componentType);const u=typeof o=="string"?Yn.fromName(o):o,d=p4[t.type],a=_4[t.type],x=g4[t.type];return i+=t.byteOffset,{values:Yn.createTypedArray(u,e,i,d*r),type:u,size:d,unpacker:a,packer:x}}const Jn=t=>t!==void 0;function y4(t,e,i){if(!e)return null;let r=t.getExtension("3DTILES_batch_table_hierarchy");const o=e.HIERARCHY;return o&&(console.warn("3D Tile Parser: HIERARCHY is deprecated. Use 3DTILES_batch_table_hierarchy."),e.extensions=e.extensions||{},e.extensions["3DTILES_batch_table_hierarchy"]=o,r=o),r?b4(r,i):null}function b4(t,e){let i,r,o;const u=t.instancesLength,d=t.classes;let a=t.classIds,x=t.parentCounts,A=t.parentIds,M=u;Jn(a.byteOffset)&&(a.componentType=defaultValue(a.componentType,GL.UNSIGNED_SHORT),a.type=AttributeType.SCALAR,o=getBinaryAccessor(a),a=o.createArrayBufferView(e.buffer,e.byteOffset+a.byteOffset,u));let D;if(Jn(x))for(Jn(x.byteOffset)&&(x.componentType=defaultValue(x.componentType,GL.UNSIGNED_SHORT),x.type=AttributeType.SCALAR,o=getBinaryAccessor(x),x=o.createArrayBufferView(e.buffer,e.byteOffset+x.byteOffset,u)),D=new Uint16Array(u),M=0,i=0;i<u;++i)D[i]=M,M+=x[i];Jn(A)&&Jn(A.byteOffset)&&(A.componentType=defaultValue(A.componentType,GL.UNSIGNED_SHORT),A.type=AttributeType.SCALAR,o=getBinaryAccessor(A),A=o.createArrayBufferView(e.buffer,e.byteOffset+A.byteOffset,M));const N=d.length;for(i=0;i<N;++i){const xe=d[i].length,Ae=d[i].instances,Te=getBinaryProperties(xe,Ae,e);d[i].instances=combine(Te,Ae)}const U=new Array(N).fill(0),re=new Uint16Array(u);for(i=0;i<u;++i)r=a[i],re[i]=U[r],++U[r];const ne={classes:d,classIds:a,classIndexes:re,parentCounts:x,parentIndexes:D,parentIds:A};return w4(ne),ne}function gu(t,e,i){if(!t)return;const r=t.parentCounts;return t.parentIds?i(t,e):r>0?v4(t,e,i):x4(t,e,i)}function v4(t,e,i){const r=t.classIds,o=t.parentCounts,u=t.parentIds,d=t.parentIndexes,a=r.length,x=scratchVisited;x.length=Math.max(x.length,a);const A=++marker,M=scratchStack;for(M.length=0,M.push(e);M.length>0;){if(e=M.pop(),x[e]===A)continue;x[e]=A;const D=i(t,e);if(Jn(D))return D;const N=o[e],U=d[e];for(let re=0;re<N;++re){const ne=u[U+re];ne!==e&&M.push(ne)}}return null}function x4(t,e,i){let r=!0;for(;r;){const o=i(t,e);if(Jn(o))return o;const u=t.parentIds[e];r=u!==e,e=u}throw new Error("traverseHierarchySingleParent")}function w4(t){const i=t.classIds.length;for(let r=0;r<i;++r)yT(t,r,stack)}function yT(t,e,i){const r=t.parentCounts,o=t.parentIds,u=t.parentIndexes,a=t.classIds.length;if(!Jn(o))return;assert(e<a,`Parent index ${e} exceeds the total number of instances: ${a}`),assert(i.indexOf(e)===-1,"Circular dependency detected in the batch table hierarchy."),i.push(e);const x=Jn(r)?r[e]:1,A=Jn(r)?u[e]:e;for(let M=0;M<x;++M){const D=o[A+M];D!==e&&yT(t,D,i)}i.pop(e)}function ps(t){return t!=null}const Wf=(t,e)=>t,T4={HIERARCHY:!0,extensions:!0,extras:!0};class bT{constructor(e,i,r,o={}){L(this,"json");L(this,"binary");L(this,"featureCount");L(this,"_extensions");L(this,"_properties");L(this,"_binaryProperties");L(this,"_hierarchy");var u;mi(r>=0),this.json=e||{},this.binary=i,this.featureCount=r,this._extensions=((u=this.json)==null?void 0:u.extensions)||{},this._properties={};for(const d in this.json)T4[d]||(this._properties[d]=this.json[d]);this._binaryProperties=this._initializeBinaryProperties(),o["3DTILES_batch_table_hierarchy"]&&(this._hierarchy=y4(this,this.json,this.binary))}getExtension(e){return this.json&&this.json.extensions&&this.json.extensions[e]}memorySizeInBytes(){return 0}isClass(e,i){if(this._checkBatchId(e),mi(typeof i=="string",i),this._hierarchy){const r=gu(this._hierarchy,e,(o,u)=>{const d=o.classIds[u];return o.classes[d].name===i});return ps(r)}return!1}isExactClass(e,i){return mi(typeof i=="string",i),this.getExactClassName(e)===i}getExactClassName(e){if(this._checkBatchId(e),this._hierarchy){const i=this._hierarchy.classIds[e];return this._hierarchy.classes[i].name}}hasProperty(e,i){return this._checkBatchId(e),mi(typeof i=="string",i),ps(this._properties[i])||this._hasPropertyInHierarchy(e,i)}getPropertyNames(e,i){this._checkBatchId(e),i=ps(i)?i:[],i.length=0;const r=Object.keys(this._properties);return i.push(...r),this._hierarchy&&this._getPropertyNamesInHierarchy(e,i),i}getProperty(e,i){if(this._checkBatchId(e),mi(typeof i=="string",i),this._binaryProperties){const o=this._binaryProperties[i];if(ps(o))return this._getBinaryProperty(o,e)}const r=this._properties[i];if(ps(r))return Wf(r[e]);if(this._hierarchy){const o=this._getHierarchyProperty(e,i);if(ps(o))return o}}setProperty(e,i,r){const o=this.featureCount;if(this._checkBatchId(e),mi(typeof i=="string",i),this._binaryProperties){const d=this._binaryProperties[i];if(d){this._setBinaryProperty(d,e,r);return}}if(this._hierarchy&&this._setHierarchyProperty(this,e,i,r))return;let u=this._properties[i];ps(u)||(this._properties[i]=new Array(o),u=this._properties[i]),u[e]=Wf(r)}_checkBatchId(e){if(!(e>=0&&e<this.featureCount))throw new Error("batchId not in range [0, featureCount - 1].")}_getBinaryProperty(e,i){return e.unpack(e.typedArray,i)}_setBinaryProperty(e,i,r){e.pack(r,e.typedArray,i)}_initializeBinaryProperties(){let e=null;for(const i in this._properties){const r=this._properties[i],o=this._initializeBinaryProperty(i,r);o&&(e=e||{},e[i]=o)}return e}_initializeBinaryProperty(e,i){if("byteOffset"in i){const r=i;mi(this.binary,`Property ${e} requires a batch table binary.`),mi(r.type,`Property ${e} requires a type.`);const o=m4(r,this.binary.buffer,this.binary.byteOffset|0,this.featureCount);return{typedArray:o.values,componentCount:o.size,unpack:o.unpacker,pack:o.packer}}return null}_hasPropertyInHierarchy(e,i){if(!this._hierarchy)return!1;const r=gu(this._hierarchy,e,(o,u)=>{const d=o.classIds[u],a=o.classes[d].instances;return ps(a[i])});return ps(r)}_getPropertyNamesInHierarchy(e,i){gu(this._hierarchy,e,(r,o)=>{const u=r.classIds[o],d=r.classes[u].instances;for(const a in d)d.hasOwnProperty(a)&&i.indexOf(a)===-1&&i.push(a)})}_getHierarchyProperty(e,i){return gu(this._hierarchy,e,(r,o)=>{const u=r.classIds[o],d=r.classes[u],a=r.classIndexes[o],x=d.instances[i];return ps(x)?ps(x.typedArray)?this._getBinaryProperty(x,a):Wf(x[a]):null})}_setHierarchyProperty(e,i,r,o){const u=gu(this._hierarchy,i,(d,a)=>{const x=d.classIds[a],A=d.classes[x],M=d.classIndexes[a],D=A.instances[r];return ps(D)?(mi(a===i,`Inherited property "${r}" is read-only.`),ps(D.typedArray)?this._setBinaryProperty(D,M,o):D[M]=Wf(o),!0):!1});return ps(u)}}const ny=4;function Xf(t,e,i=0){const r=new DataView(e);if(t.magic=r.getUint32(i,!0),i+=ny,t.version=r.getUint32(i,!0),i+=ny,t.byteLength=r.getUint32(i,!0),i+=ny,t.version!==1)throw new Error(`3D Tile Version ${t.version} not supported`);return i}const Ec=4,vT="b3dm tile in legacy format.";function oy(t,e,i){const r=new DataView(e);let o;t.header=t.header||{};let u=r.getUint32(i,!0);i+=Ec;let d=r.getUint32(i,!0);i+=Ec;let a=r.getUint32(i,!0);i+=Ec;let x=r.getUint32(i,!0);return i+=Ec,a>=570425344?(i-=Ec*2,o=u,a=d,x=0,u=0,d=0,console.warn(vT)):x>=570425344&&(i-=Ec,o=a,a=u,x=d,u=0,d=0,console.warn(vT)),t.header.featureTableJsonByteLength=u,t.header.featureTableBinaryByteLength=d,t.header.batchTableJsonByteLength=a,t.header.batchTableBinaryByteLength=x,t.header.batchLength=o,i}function ay(t,e,i,r){return i=A4(t,e,i),i=E4(t,e,i),i}function A4(t,e,i,r){const{featureTableJsonByteLength:o,featureTableBinaryByteLength:u,batchLength:d}=t.header||{};if(t.featureTableJson={BATCH_LENGTH:d||0},o&&o>0){const a=_T(e,i,o);t.featureTableJson=JSON.parse(a)}return i+=o||0,t.featureTableBinary=new Uint8Array(e,i,u),i+=u||0,i}function E4(t,e,i,r){const{batchTableJsonByteLength:o,batchTableBinaryByteLength:u}=t.header||{};if(o&&o>0){const d=_T(e,i,o);t.batchTableJson=JSON.parse(d),i+=o,u&&u>0&&(t.batchTableBinary=new Uint8Array(e,i,u),t.batchTableBinary=new Uint8Array(t.batchTableBinary),i+=u)}return i}function xT(t,e,i){if(!e&&(!t||!t.batchIds||!i))return null;const{batchIds:r,isRGB565:o,pointCount:u=0}=t;if(r&&i){const d=new Uint8ClampedArray(u*3);for(let a=0;a<u;a++){const x=r[a],M=i.getProperty(x,"dimensions").map(D=>D*255);d[a*3]=M[0],d[a*3+1]=M[1],d[a*3+2]=M[2]}return{type:Kt.UNSIGNED_BYTE,value:d,size:3,normalized:!0}}if(e&&o){const d=new Uint8ClampedArray(u*3);for(let a=0;a<u;a++){const x=u4(e[a]);d[a*3]=x[0],d[a*3+1]=x[1],d[a*3+2]=x[2]}return{type:Kt.UNSIGNED_BYTE,value:d,size:3,normalized:!0}}return e&&e.length===u*3?{type:Kt.UNSIGNED_BYTE,value:e,size:3,normalized:!0}:{type:Kt.UNSIGNED_BYTE,value:e||new Uint8ClampedArray,size:4,normalized:!0}}const wT=new De;function S4(t,e){if(!e)return null;if(t.isOctEncoded16P){const i=new Float32Array((t.pointsLength||0)*3);for(let r=0;r<(t.pointsLength||0);r++)f4(e[r*2],e[r*2+1],wT),wT.toArray(i,r*3);return{type:Kt.FLOAT,size:2,value:i}}return{type:Kt.FLOAT,size:2,value:e}}function C4(t,e,i){return t.isQuantized?i["3d-tiles"]&&i["3d-tiles"].decodeQuantizedPositions?(t.isQuantized=!1,I4(t,e)):{type:Kt.UNSIGNED_SHORT,value:e,size:3,normalized:!0}:e}function I4(t,e){const i=new De,r=new Float32Array(t.pointCount*3);for(let o=0;o<t.pointCount;o++)i.set(e[o*3],e[o*3+1],e[o*3+2]).scale(1/t.quantizedRange).multiply(t.quantizedVolumeScale).add(t.quantizedVolumeOffset).toArray(r,o*3);return r}async function M4(t,e,i,r,o){i=Xf(t,e,i),i=oy(t,e,i),i=ay(t,e,i),R4(t);const{featureTable:u,batchTable:d}=P4(t);return await k4(t,u,d,r,o),B4(t,u,r),D4(t,u,d),O4(t,u),i}function R4(t){t.attributes={positions:null,colors:null,normals:null,batchIds:null},t.isQuantized=!1,t.isTranslucent=!1,t.isRGB565=!1,t.isOctEncoded16P=!1}function P4(t){const e=new sy(t.featureTableJson,t.featureTableBinary),i=e.getGlobalProperty("POINTS_LENGTH");if(!Number.isFinite(i))throw new Error("POINTS_LENGTH must be defined");e.featuresLength=i,t.featuresLength=i,t.pointsLength=i,t.pointCount=i,t.rtcCenter=e.getGlobalProperty("RTC_CENTER",Kt.FLOAT,3);const r=F4(t,e);return{featureTable:e,batchTable:r}}function B4(t,e,i){if(t.attributes=t.attributes||{positions:null,colors:null,normals:null,batchIds:null},!t.attributes.positions){if(e.hasProperty("POSITION"))t.attributes.positions=e.getPropertyArray("POSITION",Kt.FLOAT,3);else if(e.hasProperty("POSITION_QUANTIZED")){const r=e.getPropertyArray("POSITION_QUANTIZED",Kt.UNSIGNED_SHORT,3);if(t.isQuantized=!0,t.quantizedRange=65535,t.quantizedVolumeScale=e.getGlobalProperty("QUANTIZED_VOLUME_SCALE",Kt.FLOAT,3),!t.quantizedVolumeScale)throw new Error("QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");if(t.quantizedVolumeOffset=e.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",Kt.FLOAT,3),!t.quantizedVolumeOffset)throw new Error("QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");t.attributes.positions=C4(t,r,i)}}if(!t.attributes.positions)throw new Error("Either POSITION or POSITION_QUANTIZED must be defined.")}function D4(t,e,i){if(t.attributes=t.attributes||{positions:null,colors:null,normals:null,batchIds:null},!t.attributes.colors){let r=null;e.hasProperty("RGBA")?(r=e.getPropertyArray("RGBA",Kt.UNSIGNED_BYTE,4),t.isTranslucent=!0):e.hasProperty("RGB")?r=e.getPropertyArray("RGB",Kt.UNSIGNED_BYTE,3):e.hasProperty("RGB565")&&(r=e.getPropertyArray("RGB565",Kt.UNSIGNED_SHORT,1),t.isRGB565=!0),t.attributes.colors=xT(t,r,i)}e.hasProperty("CONSTANT_RGBA")&&(t.constantRGBA=e.getGlobalProperty("CONSTANT_RGBA",Kt.UNSIGNED_BYTE,4))}function O4(t,e){if(t.attributes=t.attributes||{positions:null,colors:null,normals:null,batchIds:null},!t.attributes.normals){let i=null;e.hasProperty("NORMAL")?i=e.getPropertyArray("NORMAL",Kt.FLOAT,3):e.hasProperty("NORMAL_OCT16P")&&(i=e.getPropertyArray("NORMAL_OCT16P",Kt.UNSIGNED_BYTE,2),t.isOctEncoded16P=!0),t.attributes.normals=S4(t,i)}}function F4(t,e){let i=null;if(!t.batchIds&&e.hasProperty("BATCH_ID")&&(t.batchIds=e.getPropertyArray("BATCH_ID",Kt.UNSIGNED_SHORT,1),t.batchIds)){const r=e.getGlobalProperty("BATCH_LENGTH");if(!r)throw new Error("Global property: BATCH_LENGTH must be defined when BATCH_ID is defined.");const{batchTableJson:o,batchTableBinary:u}=t;i=new bT(o,u,r)}return i}async function k4(t,e,i,r,o){let u,d,a;const x=t.batchTableJson&&t.batchTableJson.extensions&&t.batchTableJson.extensions["3DTILES_draco_point_compression"];x&&(a=x.properties);const A=e.getExtension("3DTILES_draco_point_compression");if(A){d=A.properties;const D=A.byteOffset,N=A.byteLength;if(!d||!Number.isFinite(D)||!N)throw new Error("Draco properties, byteOffset, and byteLength must be defined");u=(t.featureTableBinary||[]).slice(D,D+N),t.hasPositions=Number.isFinite(d.POSITION),t.hasColors=Number.isFinite(d.RGB)||Number.isFinite(d.RGBA),t.hasNormals=Number.isFinite(d.NORMAL),t.hasBatchIds=Number.isFinite(d.BATCH_ID),t.isTranslucent=Number.isFinite(d.RGBA)}if(!u)return!0;const M={buffer:u,properties:{...d,...a},featureTableProperties:d,batchTableProperties:a,dequantizeInShader:!1};return await N4(t,M,r,o)}async function N4(t,e,i,r){if(!r)return;const o={...i,draco:{...i==null?void 0:i.draco,extraAttributes:e.batchTableProperties||{}}};delete o["3d-tiles"];const u=await Sh(e.buffer,Ow,o,r),d=u.attributes.POSITION&&u.attributes.POSITION.value,a=u.attributes.COLOR_0&&u.attributes.COLOR_0.value,x=u.attributes.NORMAL&&u.attributes.NORMAL.value,A=u.attributes.BATCH_ID&&u.attributes.BATCH_ID.value,M=d&&u.attributes.POSITION.value.quantization,D=x&&u.attributes.NORMAL.value.quantization;if(M){const U=u.POSITION.data.quantization,re=U.range;t.quantizedVolumeScale=new De(re,re,re),t.quantizedVolumeOffset=new De(U.minValues),t.quantizedRange=(1<<U.quantizationBits)-1,t.isQuantizedDraco=!0}D&&(t.octEncodedRange=(1<<u.NORMAL.data.quantization.quantizationBits)-1,t.isOctEncodedDraco=!0);const N={};if(e.batchTableProperties)for(const U of Object.keys(e.batchTableProperties))u.attributes[U]&&u.attributes[U].value&&(N[U.toLowerCase()]=u.attributes[U].value);t.attributes={positions:d,colors:xT(t,a,void 0),normals:x,batchIds:A,...N}}const ly={URI:0,EMBEDDED:1};function TT(t,e,i,r){t.rotateYtoZ=!0;const o=(t.byteOffset||0)+(t.byteLength||0)-i;if(o===0)throw new Error("glTF byte length must be greater than 0.");return t.gltfUpAxis=r!=null&&r["3d-tiles"]&&r["3d-tiles"].assetGltfUpAxis?r["3d-tiles"].assetGltfUpAxis:"Y",t.gltfArrayBuffer=S_(e,i,o),t.gltfByteOffset=0,t.gltfByteLength=o,i%4===0||console.warn(`${t.type}: embedded glb is not aligned to a 4-byte boundary.`),(t.byteOffset||0)+(t.byteLength||0)}async function AT(t,e,i,r){const o=(i==null?void 0:i["3d-tiles"])||{};if(L4(t,e),o.loadGLTF){if(!r)return;if(t.gltfUrl){const{fetch:u}=r,d=await u(t.gltfUrl,i);t.gltfArrayBuffer=await d.arrayBuffer(),t.gltfByteOffset=0}if(t.gltfArrayBuffer){const u=await Sh(t.gltfArrayBuffer,fu,i,r);t.gltf=Vm(u),t.gpuMemoryUsageInBytes=vw(t.gltf),delete t.gltfArrayBuffer,delete t.gltfByteOffset,delete t.gltfByteLength}}}function L4(t,e,i){switch(e){case ly.URI:if(t.gltfArrayBuffer){const r=new Uint8Array(t.gltfArrayBuffer,t.gltfByteOffset),u=new TextDecoder().decode(r);t.gltfUrl=u.replace(/[\s\0]+$/,"")}delete t.gltfArrayBuffer,delete t.gltfByteOffset,delete t.gltfByteLength;break;case ly.EMBEDDED:break;default:throw new Error("b3dm: Illegal glTF format field")}}async function U4(t,e,i,r,o){var d;i=z4(t,e,i,r),await AT(t,ly.EMBEDDED,r,o);const u=(d=t==null?void 0:t.gltf)==null?void 0:d.extensions;return u&&u.CESIUM_RTC&&(t.rtcCenter=u.CESIUM_RTC.center),i}function z4(t,e,i,r,o){i=Xf(t,e,i),i=oy(t,e,i),i=ay(t,e,i),i=TT(t,e,i,r);const u=new sy(t.featureTableJson,t.featureTableBinary);return t.rtcCenter=u.getGlobalProperty("RTC_CENTER",Kt.FLOAT,3),i}async function V4(t,e,i,r,o){return i=j4(t,e,i,r),await AT(t,t.gltfFormat||0,r,o),i}function j4(t,e,i,r,o){var A;if(i=Xf(t,e,i),t.version!==1)throw new Error(`Instanced 3D Model version ${t.version} is not supported`);i=oy(t,e,i);const u=new DataView(e);if(t.gltfFormat=u.getUint32(i,!0),i+=4,i=ay(t,e,i),i=TT(t,e,i,r),!((A=t==null?void 0:t.header)!=null&&A.featureTableJsonByteLength)||t.header.featureTableJsonByteLength===0)throw new Error("i3dm parser: featureTableJsonByteLength is zero.");const d=new sy(t.featureTableJson,t.featureTableBinary),a=d.getGlobalProperty("INSTANCES_LENGTH");if(d.featuresLength=a,!Number.isFinite(a))throw new Error("i3dm parser: INSTANCES_LENGTH must be defined");t.eastNorthUp=d.getGlobalProperty("EAST_NORTH_UP"),t.rtcCenter=d.getGlobalProperty("RTC_CENTER",Kt.FLOAT,3);const x=new bT(t.batchTableJson,t.batchTableBinary,a);return H4(t,d,x,a),i}function H4(t,e,i,r){const o=new Array(r),u=new De;new De,new De,new De;const d=new Hi,a=new zh,x=new De,A={},M=new $t,D=[],N=[],U=[],re=[];for(let ne=0;ne<r;ne++){let xe;if(e.hasProperty("POSITION"))xe=e.getProperty("POSITION",Kt.FLOAT,3,ne,u);else if(e.hasProperty("POSITION_QUANTIZED")){xe=e.getProperty("POSITION_QUANTIZED",Kt.UNSIGNED_SHORT,3,ne,u);const qe=e.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",Kt.FLOAT,3);if(!qe)throw new Error("i3dm parser: QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");const ht=e.getGlobalProperty("QUANTIZED_VOLUME_SCALE",Kt.FLOAT,3);if(!ht)throw new Error("i3dm parser: QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");const gt=65535;for(let nt=0;nt<3;nt++)xe[nt]=xe[nt]/gt*ht[nt]+qe[nt]}if(!xe)throw new Error("i3dm: POSITION or POSITION_QUANTIZED must be defined for each instance.");if(u.copy(xe),A.translation=u,t.normalUp=e.getProperty("NORMAL_UP",Kt.FLOAT,3,ne,D),t.normalRight=e.getProperty("NORMAL_RIGHT",Kt.FLOAT,3,ne,N),t.normalUp){if(!t.normalRight)throw new Error("i3dm: Custom orientation requires both NORMAL_UP and NORMAL_RIGHT.");t.hasCustomOrientation=!0}else{if(t.octNormalUp=e.getProperty("NORMAL_UP_OCT32P",Kt.UNSIGNED_SHORT,2,ne,D),t.octNormalRight=e.getProperty("NORMAL_RIGHT_OCT32P",Kt.UNSIGNED_SHORT,2,ne,N),t.octNormalUp)throw t.octNormalRight?new Error("i3dm: oct-encoded orientation not implemented"):new Error("i3dm: oct-encoded orientation requires NORMAL_UP_OCT32P and NORMAL_RIGHT_OCT32P");t.eastNorthUp?(yi.WGS84.eastNorthUpToFixedFrame(u,M),M.getRotationMatrix3(d)):d.identity()}a.fromMatrix3(d),A.rotation=a,x.set(1,1,1);const Ae=e.getProperty("SCALE",Kt.FLOAT,1,ne,U);Number.isFinite(Ae)&&x.multiplyByScalar(Ae);const Te=e.getProperty("SCALE_NON_UNIFORM",Kt.FLOAT,3,ne,D);Te&&x.scale(Te),A.scale=x;let Ie=e.getProperty("BATCH_ID",Kt.UNSIGNED_SHORT,1,ne,re);Ie===void 0&&(Ie=ne);const Ue=new $t().fromQuaternion(A.rotation);M.identity(),M.translate(A.translation),M.multiplyRight(Ue),M.scale(A.scale);const Xe=M.clone();o[ne]={modelMatrix:Xe,batchId:Ie}}t.instances=o}async function G4(t,e,i,r,o,u){i=Xf(t,e,i);const d=new DataView(e);for(t.tilesLength=d.getUint32(i,!0),i+=4,t.tiles=[];t.tiles.length<t.tilesLength&&(t.byteLength||0)-i>12;){const a={shape:"tile3d"};t.tiles.push(a),i=await u(e,i,r,o,a)}return i}async function $4(t,e,i,r){var o,u;if(t.rotateYtoZ=!0,t.gltfUpAxis=(o=i==null?void 0:i["3d-tiles"])!=null&&o.assetGltfUpAxis?i["3d-tiles"].assetGltfUpAxis:"Y",(u=i==null?void 0:i["3d-tiles"])!=null&&u.loadGLTF){if(!r)return e.byteLength;const d=await Sh(e,fu,i,r);t.gltf=Vm(d),t.gpuMemoryUsageInBytes=vw(t.gltf)}else t.gltfArrayBuffer=e;return e.byteLength}async function ET(t,e=0,i,r,o={shape:"tile3d"}){switch(o.byteOffset=e,o.type=a4(t,e),o.type){case _u.COMPOSITE:return await G4(o,t,e,i,r,ET);case _u.BATCHED_3D_MODEL:return await U4(o,t,e,i,r);case _u.GLTF:return await $4(o,t,i,r);case _u.INSTANCED_3D_MODEL:return await V4(o,t,e,i,r);case _u.POINT_CLOUD:return await M4(o,t,e,i,r);default:throw new Error(`3DTileLoader: unknown type ${o.type}`)}}const W4=1952609651,X4=1;async function q4(t,e,i){if(new Uint32Array(t.slice(0,4))[0]!==W4)throw new Error("Wrong subtree file magic number");if(new Uint32Array(t.slice(4,8))[0]!==X4)throw new Error("Wrong subtree file verson, must be 1");const u=ST(t.slice(8,16)),d=new Uint8Array(t,24,u),x=new TextDecoder("utf8").decode(d),A=JSON.parse(x),M=ST(t.slice(16,24));let D=new ArrayBuffer(0);if(M&&(D=t.slice(24+u)),await qf(A,A.tileAvailability,D,i),Array.isArray(A.contentAvailability))for(const N of A.contentAvailability)await qf(A,N,D,i);else await qf(A,A.contentAvailability,D,i);return await qf(A,A.childSubtreeAvailability,D,i),A}async function qf(t,e,i,r){const o=Number.isFinite(e.bitstream)?e.bitstream:e.bufferView;if(typeof o!="number")return;const u=t.bufferViews[o],d=t.buffers[u.buffer];if(!(r!=null&&r.baseUrl))throw new Error("Url is not provided");if(!r.fetch)throw new Error("fetch is not provided");if(d.uri){const x=`${(r==null?void 0:r.baseUrl)||""}/${d.uri}`,M=await(await r.fetch(x)).arrayBuffer();e.explicitBitstream=new Uint8Array(M,u.byteOffset,u.byteLength);return}const a=t.buffers.slice(0,u.buffer).reduce((x,A)=>x+A.byteLength,0);e.explicitBitstream=new Uint8Array(i.slice(a,a+d.byteLength),u.byteOffset,u.byteLength)}function ST(t){const e=new DataView(t),i=e.getUint32(0,!0),r=e.getUint32(4,!0);return i+2**32*r}const CT={dataType:null,batchType:null,id:"3d-tiles-subtree",name:"3D Tiles Subtree",module:"3d-tiles",version:pT,extensions:["subtree"],mimeTypes:["application/octet-stream"],tests:["subtree"],parse:q4,options:{}};/**
 * @license
 * Copyright 2009 The Closure Library Authors
 * Copyright 2020 Daniel Wirtz / The long.js Authors.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * SPDX-License-Identifier: Apache-2.0
 */var sn=null;try{sn=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function li(t,e,i){this.low=t|0,this.high=e|0,this.unsigned=!!i}li.prototype.__isLong__,Object.defineProperty(li.prototype,"__isLong__",{value:!0});function Zr(t){return(t&&t.__isLong__)===!0}function IT(t){var e=Math.clz32(t&-t);return t?31-e:e}li.isLong=Zr;var MT={},RT={};function Qa(t,e){var i,r,o;return e?(t>>>=0,(o=0<=t&&t<256)&&(r=RT[t],r)?r:(i=Jt(t,0,!0),o&&(RT[t]=i),i)):(t|=0,(o=-128<=t&&t<128)&&(r=MT[t],r)?r:(i=Jt(t,t<0?-1:0,!1),o&&(MT[t]=i),i))}li.fromInt=Qa;function nn(t,e){if(isNaN(t))return e?To:Cn;if(e){if(t<0)return To;if(t>=BT)return NT}else{if(t<=-DT)return _s;if(t+1>=DT)return kT}return t<0?nn(-t,e).neg():Jt(t%Sc|0,t/Sc|0,e)}li.fromNumber=nn;function Jt(t,e,i){return new li(t,e,i)}li.fromBits=Jt;var Zf=Math.pow;function cy(t,e,i){if(t.length===0)throw Error("empty string");if(typeof e=="number"?(i=e,e=!1):e=!!e,t==="NaN"||t==="Infinity"||t==="+Infinity"||t==="-Infinity")return e?To:Cn;if(i=i||10,i<2||36<i)throw RangeError("radix");var r;if((r=t.indexOf("-"))>0)throw Error("interior hyphen");if(r===0)return cy(t.substring(1),e,i).neg();for(var o=nn(Zf(i,8)),u=Cn,d=0;d<t.length;d+=8){var a=Math.min(8,t.length-d),x=parseInt(t.substring(d,d+a),i);if(a<8){var A=nn(Zf(i,a));u=u.mul(A).add(nn(x))}else u=u.mul(o),u=u.add(nn(x))}return u.unsigned=e,u}li.fromString=cy;function Sn(t,e){return typeof t=="number"?nn(t,e):typeof t=="string"?cy(t,e):Jt(t.low,t.high,typeof e=="boolean"?e:t.unsigned)}li.fromValue=Sn;var PT=65536,Z4=1<<24,Sc=PT*PT,BT=Sc*Sc,DT=BT/2,OT=Qa(Z4),Cn=Qa(0);li.ZERO=Cn;var To=Qa(0,!0);li.UZERO=To;var Cc=Qa(1);li.ONE=Cc;var FT=Qa(1,!0);li.UONE=FT;var hy=Qa(-1);li.NEG_ONE=hy;var kT=Jt(-1,2147483647,!1);li.MAX_VALUE=kT;var NT=Jt(-1,-1,!0);li.MAX_UNSIGNED_VALUE=NT;var _s=Jt(0,-2147483648,!1);li.MIN_VALUE=_s;var it=li.prototype;it.toInt=function(){return this.unsigned?this.low>>>0:this.low},it.toNumber=function(){return this.unsigned?(this.high>>>0)*Sc+(this.low>>>0):this.high*Sc+(this.low>>>0)},it.toString=function(e){if(e=e||10,e<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(_s)){var i=nn(e),r=this.div(i),o=r.mul(i).sub(this);return r.toString(e)+o.toInt().toString(e)}else return"-"+this.neg().toString(e);for(var u=nn(Zf(e,6),this.unsigned),d=this,a="";;){var x=d.div(u),A=d.sub(x.mul(u)).toInt()>>>0,M=A.toString(e);if(d=x,d.isZero())return M+a;for(;M.length<6;)M="0"+M;a=""+M+a}},it.getHighBits=function(){return this.high},it.getHighBitsUnsigned=function(){return this.high>>>0},it.getLowBits=function(){return this.low},it.getLowBitsUnsigned=function(){return this.low>>>0},it.getNumBitsAbs=function(){if(this.isNegative())return this.eq(_s)?64:this.neg().getNumBitsAbs();for(var e=this.high!=0?this.high:this.low,i=31;i>0&&!(e&1<<i);i--);return this.high!=0?i+33:i+1},it.isZero=function(){return this.high===0&&this.low===0},it.eqz=it.isZero,it.isNegative=function(){return!this.unsigned&&this.high<0},it.isPositive=function(){return this.unsigned||this.high>=0},it.isOdd=function(){return(this.low&1)===1},it.isEven=function(){return(this.low&1)===0},it.equals=function(e){return Zr(e)||(e=Sn(e)),this.unsigned!==e.unsigned&&this.high>>>31===1&&e.high>>>31===1?!1:this.high===e.high&&this.low===e.low},it.eq=it.equals,it.notEquals=function(e){return!this.eq(e)},it.neq=it.notEquals,it.ne=it.notEquals,it.lessThan=function(e){return this.comp(e)<0},it.lt=it.lessThan,it.lessThanOrEqual=function(e){return this.comp(e)<=0},it.lte=it.lessThanOrEqual,it.le=it.lessThanOrEqual,it.greaterThan=function(e){return this.comp(e)>0},it.gt=it.greaterThan,it.greaterThanOrEqual=function(e){return this.comp(e)>=0},it.gte=it.greaterThanOrEqual,it.ge=it.greaterThanOrEqual,it.compare=function(e){if(Zr(e)||(e=Sn(e)),this.eq(e))return 0;var i=this.isNegative(),r=e.isNegative();return i&&!r?-1:!i&&r?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},it.comp=it.compare,it.negate=function(){return!this.unsigned&&this.eq(_s)?_s:this.not().add(Cc)},it.neg=it.negate,it.add=function(e){Zr(e)||(e=Sn(e));var i=this.high>>>16,r=this.high&65535,o=this.low>>>16,u=this.low&65535,d=e.high>>>16,a=e.high&65535,x=e.low>>>16,A=e.low&65535,M=0,D=0,N=0,U=0;return U+=u+A,N+=U>>>16,U&=65535,N+=o+x,D+=N>>>16,N&=65535,D+=r+a,M+=D>>>16,D&=65535,M+=i+d,M&=65535,Jt(N<<16|U,M<<16|D,this.unsigned)},it.subtract=function(e){return Zr(e)||(e=Sn(e)),this.add(e.neg())},it.sub=it.subtract,it.multiply=function(e){if(this.isZero())return this;if(Zr(e)||(e=Sn(e)),sn){var i=sn.mul(this.low,this.high,e.low,e.high);return Jt(i,sn.get_high(),this.unsigned)}if(e.isZero())return this.unsigned?To:Cn;if(this.eq(_s))return e.isOdd()?_s:Cn;if(e.eq(_s))return this.isOdd()?_s:Cn;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(OT)&&e.lt(OT))return nn(this.toNumber()*e.toNumber(),this.unsigned);var r=this.high>>>16,o=this.high&65535,u=this.low>>>16,d=this.low&65535,a=e.high>>>16,x=e.high&65535,A=e.low>>>16,M=e.low&65535,D=0,N=0,U=0,re=0;return re+=d*M,U+=re>>>16,re&=65535,U+=u*M,N+=U>>>16,U&=65535,U+=d*A,N+=U>>>16,U&=65535,N+=o*M,D+=N>>>16,N&=65535,N+=u*A,D+=N>>>16,N&=65535,N+=d*x,D+=N>>>16,N&=65535,D+=r*M+o*A+u*x+d*a,D&=65535,Jt(U<<16|re,D<<16|N,this.unsigned)},it.mul=it.multiply,it.divide=function(e){if(Zr(e)||(e=Sn(e)),e.isZero())throw Error("division by zero");if(sn){if(!this.unsigned&&this.high===-2147483648&&e.low===-1&&e.high===-1)return this;var i=(this.unsigned?sn.div_u:sn.div_s)(this.low,this.high,e.low,e.high);return Jt(i,sn.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?To:Cn;var r,o,u;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return To;if(e.gt(this.shru(1)))return FT;u=To}else{if(this.eq(_s)){if(e.eq(Cc)||e.eq(hy))return _s;if(e.eq(_s))return Cc;var d=this.shr(1);return r=d.div(e).shl(1),r.eq(Cn)?e.isNegative()?Cc:hy:(o=this.sub(e.mul(r)),u=r.add(o.div(e)),u)}else if(e.eq(_s))return this.unsigned?To:Cn;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();u=Cn}for(o=this;o.gte(e);){r=Math.max(1,Math.floor(o.toNumber()/e.toNumber()));for(var a=Math.ceil(Math.log(r)/Math.LN2),x=a<=48?1:Zf(2,a-48),A=nn(r),M=A.mul(e);M.isNegative()||M.gt(o);)r-=x,A=nn(r,this.unsigned),M=A.mul(e);A.isZero()&&(A=Cc),u=u.add(A),o=o.sub(M)}return u},it.div=it.divide,it.modulo=function(e){if(Zr(e)||(e=Sn(e)),sn){var i=(this.unsigned?sn.rem_u:sn.rem_s)(this.low,this.high,e.low,e.high);return Jt(i,sn.get_high(),this.unsigned)}return this.sub(this.div(e).mul(e))},it.mod=it.modulo,it.rem=it.modulo,it.not=function(){return Jt(~this.low,~this.high,this.unsigned)},it.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32},it.clz=it.countLeadingZeros,it.countTrailingZeros=function(){return this.low?IT(this.low):IT(this.high)+32},it.ctz=it.countTrailingZeros,it.and=function(e){return Zr(e)||(e=Sn(e)),Jt(this.low&e.low,this.high&e.high,this.unsigned)},it.or=function(e){return Zr(e)||(e=Sn(e)),Jt(this.low|e.low,this.high|e.high,this.unsigned)},it.xor=function(e){return Zr(e)||(e=Sn(e)),Jt(this.low^e.low,this.high^e.high,this.unsigned)},it.shiftLeft=function(e){return Zr(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?Jt(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):Jt(0,this.low<<e-32,this.unsigned)},it.shl=it.shiftLeft,it.shiftRight=function(e){return Zr(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?Jt(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):Jt(this.high>>e-32,this.high>=0?0:-1,this.unsigned)},it.shr=it.shiftRight,it.shiftRightUnsigned=function(e){return Zr(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?Jt(this.low>>>e|this.high<<32-e,this.high>>>e,this.unsigned):e===32?Jt(this.high,0,this.unsigned):Jt(this.high>>>e-32,0,this.unsigned)},it.shru=it.shiftRightUnsigned,it.shr_u=it.shiftRightUnsigned,it.rotateLeft=function(e){var i;return Zr(e)&&(e=e.toInt()),(e&=63)===0?this:e===32?Jt(this.high,this.low,this.unsigned):e<32?(i=32-e,Jt(this.low<<e|this.high>>>i,this.high<<e|this.low>>>i,this.unsigned)):(e-=32,i=32-e,Jt(this.high<<e|this.low>>>i,this.low<<e|this.high>>>i,this.unsigned))},it.rotl=it.rotateLeft,it.rotateRight=function(e){var i;return Zr(e)&&(e=e.toInt()),(e&=63)===0?this:e===32?Jt(this.high,this.low,this.unsigned):e<32?(i=32-e,Jt(this.high<<i|this.low>>>e,this.low<<i|this.high>>>e,this.unsigned)):(e-=32,i=32-e,Jt(this.low<<i|this.high>>>e,this.high<<i|this.low>>>e,this.unsigned))},it.rotr=it.rotateRight,it.toSigned=function(){return this.unsigned?Jt(this.low,this.high,!1):this},it.toUnsigned=function(){return this.unsigned?this:Jt(this.low,this.high,!0)},it.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},it.toBytesLE=function(){var e=this.high,i=this.low;return[i&255,i>>>8&255,i>>>16&255,i>>>24,e&255,e>>>8&255,e>>>16&255,e>>>24]},it.toBytesBE=function(){var e=this.high,i=this.low;return[e>>>24,e>>>16&255,e>>>8&255,e&255,i>>>24,i>>>16&255,i>>>8&255,i&255]},li.fromBytes=function(e,i,r){return r?li.fromBytesLE(e,i):li.fromBytesBE(e,i)},li.fromBytesLE=function(e,i){return new li(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,i)},li.fromBytesBE=function(e,i){return new li(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],i)};const K4=16;function LT(t){t==="X"&&(t="");const e=t.padEnd(K4,"0");return li.fromString(e,!0,16)}function Y4(t){if(t.isZero())return"X";let e=t.countTrailingZeros();const i=e%4;e=(e-i)/4;const r=e;e*=4;const u=t.shiftRightUnsigned(e).toString(16).replace(/0+$/,"");return Array(17-r-u.length).join("0")+u}function J4(t,e){const i=Q4(t).shiftRightUnsigned(2);return t.add(li.fromNumber(2*e+1-4).multiply(i))}function Q4(t){return t.and(t.not().add(1))}const e5=3,t5=2*30+1,UT=180/Math.PI;function i5(t){if(t.length===0)throw new Error(`Invalid Hilbert quad key ${t}`);const e=t.split("/"),i=parseInt(e[0],10),r=e[1],o=r.length;let u=0;const d=[0,0];for(let a=o-1;a>=0;a--){u=o-a;const x=r[a];let A=0,M=0;x==="1"?M=1:x==="2"?(A=1,M=1):x==="3"&&(A=1);const D=Math.pow(2,u-1);s5(D,d,A,M),d[0]+=D*A,d[1]+=D*M}if(i%2===1){const a=d[0];d[0]=d[1],d[1]=a}return{face:i,ij:d,level:u}}function r5(t){if(t.isZero())return"";let e=t.toString(2);for(;e.length<e5+t5;)e="0"+e;const i=e.lastIndexOf("1"),r=e.substring(0,3),o=e.substring(3,i),u=o.length/2,d=li.fromString(r,!0,2).toString(10);let a="";if(u!==0)for(a=li.fromString(o,!0,2).toString(4);a.length<u;)a="0"+a;return`${d}/${a}`}function zT(t,e,i){const r=1<<e;return[(t[0]+i[0])/r,(t[1]+i[1])/r]}function VT(t){return t>=.5?1/3*(4*t*t-1):1/3*(1-4*(1-t)*(1-t))}function jT(t){return[VT(t[0]),VT(t[1])]}function HT(t,[e,i]){switch(t){case 0:return[1,e,i];case 1:return[-e,1,i];case 2:return[-e,-i,1];case 3:return[-1,-i,-e];case 4:return[i,-1,-e];case 5:return[i,e,-1];default:throw new Error("Invalid face")}}function GT([t,e,i]){const r=Math.atan2(i,Math.sqrt(t*t+e*e));return[Math.atan2(e,t)*UT,r*UT]}function s5(t,e,i,r){if(r===0){i===1&&(e[0]=t-1-e[0],e[1]=t-1-e[1]);const o=e[0];e[0]=e[1],e[1]=o}}function n5(t){const e=zT(t.ij,t.level,[.5,.5]),i=jT(e),r=HT(t.face,i);return GT(r)}const o5=100;function $T(t){const{face:e,ij:i,level:r}=t,o=[[0,0],[0,1],[1,1],[1,0],[0,0]],u=Math.max(1,Math.ceil(o5*Math.pow(2,-r))),d=new Float64Array(4*u*2+2);let a=0,x=0;for(let A=0;A<4;A++){const M=o[A].slice(0),D=o[A+1],N=(D[0]-M[0])/u,U=(D[1]-M[1])/u;for(let re=0;re<u;re++){M[0]+=N,M[1]+=U;const ne=zT(i,r,M),xe=jT(ne),Ae=HT(e,xe),Te=GT(Ae);Math.abs(Te[1])>89.999&&(Te[0]=x);const Ie=Te[0]-x;Te[0]+=Ie>180?-360:Ie<-180?360:0,d[a++]=Te[0],d[a++]=Te[1],x=Te[0]}}return d[a++]=d[0],d[a++]=d[1],d}function uy(t){const e=a5(t);return i5(e)}function a5(t){if(t.indexOf("/")>0)return t;const e=LT(t);return r5(e)}function l5(t){const e=uy(t);return n5(e)}function c5(t){let e;if(t.face===2||t.face===5){let i=null,r=0;for(let o=0;o<4;o++){const u=`${t.face}/${o}`,d=uy(u),a=$T(d);(typeof i>"u"||i===null)&&(i=new Float64Array(4*a.length)),i.set(a,r),r+=a.length}e=WT(i)}else{const i=$T(t);e=WT(i)}return e}function WT(t){if(t.length%2!==0)throw new Error("Invalid corners");const e=[],i=[];for(let r=0;r<t.length;r+=2)e.push(t[r]),i.push(t[r+1]);return e.sort((r,o)=>r-o),i.sort((r,o)=>r-o),{west:e[0],east:e[e.length-1],north:i[i.length-1],south:i[0]}}function h5(t,e){const i=(e==null?void 0:e.minimumHeight)||0,r=(e==null?void 0:e.maximumHeight)||0,o=uy(t),u=c5(o),d=u.west,a=u.south,x=u.east,A=u.north,M=[];return M.push(new De(d,A,i)),M.push(new De(x,A,i)),M.push(new De(x,a,i)),M.push(new De(d,a,i)),M.push(new De(d,A,r)),M.push(new De(x,A,r)),M.push(new De(x,a,r)),M.push(new De(d,a,r)),M}function XT(t){const e=t.token,i={minimumHeight:t.minimumHeight,maximumHeight:t.maximumHeight},r=h5(e,i),o=l5(e),u=o[0],d=o[1],a=yi.WGS84.cartographicToCartesian([u,d,i.maximumHeight]),x=new De(a[0],a[1],a[2]);r.push(x);const A=aN(r);return[...A.center,...A.halfAxes]}const u5={QUADTREE:4,OCTREE:8};function d5(t,e,i){if(t!=null&&t.box){const r=LT(t.s2VolumeInfo.token),o=J4(r,e),u=Y4(o),d={...t.s2VolumeInfo};switch(d.token=u,i){case"OCTREE":const A=t.s2VolumeInfo,M=A.maximumHeight-A.minimumHeight,D=M/2,N=A.minimumHeight+M/2;A.minimumHeight=N-D,A.maximumHeight=N+D;break}return{box:XT(d),s2VolumeInfo:d}}}async function qT(t){const{subtree:e,subtreeData:i={level:0,x:0,y:0,z:0},parentData:r={mortonIndex:0,localLevel:-1,localX:0,localY:0,localZ:0},childIndex:o=0,implicitOptions:u,loaderOptions:d,s2VolumeBox:a}=t,{subdivisionScheme:x,subtreeLevels:A,maximumLevel:M,contentUrlTemplate:D,subtreesUriTemplate:N,basePath:U}=u,re={children:[],lodMetricValue:0,contentUrl:""};if(!M)return j0.once(`Missing 'maximumLevel' or 'availableLevels' property. The subtree ${D} won't be loaded...`),re;const ne=r.localLevel+1,xe=i.level+ne;if(xe>M)return re;const Ae=u5[x],Te=Math.log2(Ae),Ie=o&1,Ue=o>>1&1,Xe=o>>2&1,qe=el(r.localX,Ie,1),ht=el(r.localY,Ue,1),gt=el(r.localZ,Xe,1),nt=el(i.x,qe,ne),at=el(i.y,ht,ne),bt=el(i.z,gt,ne),kt=el(r.mortonIndex,o,Te),Ht=ne===A&&dy(e.childSubtreeAvailability,kt);let St,xi,Fr,br;if(Ht){const or=`${U}/${N}`,Ai=fy(or,xe,nt,at,bt);St=await $o(Ai,CT,d),br=0,xi={level:xe,x:nt,y:at,z:bt},Fr={mortonIndex:0,localLevel:0,localX:0,localY:0,localZ:0}}else St=e,br=(Ae**ne-1)/(Ae-1)+kt,xi=i,Fr={mortonIndex:kt,localLevel:ne,localX:qe,localY:ht,localZ:gt};if(!dy(St.tileAvailability,br))return re;dy(St.contentAvailability,br)&&(re.contentUrl=fy(D,xe,nt,at,bt));for(let or=0;or<Ae;or++){const Ai=d5(a,or,x),ar=await qT({subtree:St,subtreeData:xi,parentData:Fr,childIndex:or,implicitOptions:u,loaderOptions:d,s2VolumeBox:Ai});(ar.contentUrl||ar.children.length)&&re.children.push(ar)}return re.contentUrl||re.children.length?f5(re,{level:xe,x:nt,y:at,z:bt},u,a):re}function dy(t,e){let i;return Array.isArray(t)?(i=t[0],t.length>1&&j0.once('Not supported extension "3DTILES_multiple_contents" has been detected')):i=t,"constant"in i?!!i.constant:i.explicitBitstream?g5(e,i.explicitBitstream):!1}function f5(t,e,i,r){const{basePath:o,refine:u,getRefine:d,lodMetricType:a,getTileType:x,rootLodMetricValue:A,rootBoundingVolume:M}=i,D=t.contentUrl&&t.contentUrl.replace(`${o}/`,""),N=A/2**e.level,U=r!=null&&r.box?{box:r.box}:M,re=p5(U,e,i.subdivisionScheme);return{children:t.children,contentUrl:t.contentUrl,content:{uri:D},id:t.contentUrl,refine:d(u),type:x(t),lodMetricType:a,lodMetricValue:N,geometricError:N,transform:t.transform,boundingVolume:re}}function p5(t,e,i){if(t.region){const{level:r,x:o,y:u,z:d}=e,[a,x,A,M,D,N]=t.region,U=2**r,re=(A-a)/U,[ne,xe]=[a+re*o,a+re*(o+1)],Ae=(M-x)/U,[Te,Ie]=[x+Ae*u,x+Ae*(u+1)];let Ue,Xe;if(i==="OCTREE"){const qe=(N-D)/U;[Ue,Xe]=[D+qe*d,D+qe*(d+1)]}else[Ue,Xe]=[D,N];return{region:[ne,Te,xe,Ie,Ue,Xe]}}if(t.box)return t;throw new Error(`Unsupported bounding volume type ${JSON.stringify(t)}`)}function el(t,e,i){return(t<<i)+e}function fy(t,e,i,r,o){const u=_5({level:e,x:i,y:r,z:o});return t.replace(/{level}|{x}|{y}|{z}/gi,d=>u[d])}function _5(t){const e={};for(const i in t)e[`{${i}}`]=t[i];return e}function g5(t,e){const i=Math.floor(t/8),r=t%8;return(e[i]>>r&1)===1}function py(t,e=""){if(!e)return wo.EMPTY;const r=e.split("?")[0].split(".").pop();switch(r){case"pnts":return wo.POINTCLOUD;case"i3dm":case"b3dm":case"glb":case"gltf":return wo.SCENEGRAPH;default:return r||wo.EMPTY}}function _y(t){switch(t){case"REPLACE":case"replace":return En.REPLACE;case"ADD":case"add":return En.ADD;default:return t}}function gy(t,e){if(/^[a-z][0-9a-z+.-]*:/i.test(e)){const r=new URL(t,`${e}/`);return decodeURI(r.toString())}else if(t.startsWith("/"))return t;return WS(e,t)}function ZT(t,e){var o;if(!t)return null;let i;if(t.content){const u=t.content.uri||((o=t.content)==null?void 0:o.url);typeof u<"u"&&(i=gy(u,e))}return{...t,id:i,contentUrl:i,lodMetricType:Ac.GEOMETRIC_ERROR,lodMetricValue:t.geometricError,transformMatrix:t.transform,type:py(t,i),refine:_y(t.refine)}}async function m5(t,e,i){let r=null;const o=YT(t.root);o&&t.root?r=await KT(t.root,t,e,o,i):r=ZT(t.root,e);const u=[];for(u.push(r);u.length>0;){const d=u.pop()||{},a=d.children||[],x=[];for(const A of a){const M=YT(A);let D;M?D=await KT(A,t,e,M,i):D=ZT(A,e),D&&(x.push(D),u.push(D))}d.children=x}return r}async function KT(t,e,i,r,o){var Ue,Xe,qe;const{subdivisionScheme:u,maximumLevel:d,availableLevels:a,subtreeLevels:x,subtrees:{uri:A}}=r,M=fy(A,0,0,0,0),D=gy(M,i),N=await $o(D,CT,o),U=(Ue=t.content)==null?void 0:Ue.uri,re=U?gy(U,i):"",ne=(Xe=e==null?void 0:e.root)==null?void 0:Xe.refine,xe=t.geometricError,Ae=(qe=t.boundingVolume.extensions)==null?void 0:qe["3DTILES_bounding_volume_S2"];if(Ae){const gt={box:XT(Ae),s2VolumeInfo:Ae};t.boundingVolume=gt}const Te=t.boundingVolume,Ie={contentUrlTemplate:re,subtreesUriTemplate:A,subdivisionScheme:u,subtreeLevels:x,maximumLevel:Number.isFinite(a)?a-1:d,refine:ne,basePath:i,lodMetricType:Ac.GEOMETRIC_ERROR,rootLodMetricValue:xe,rootBoundingVolume:Te,getTileType:py,getRefine:_y};return await y5(t,i,N,Ie,o)}async function y5(t,e,i,r,o){if(!t)return null;const{children:u,contentUrl:d}=await qT({subtree:i,implicitOptions:r,loaderOptions:o});let a,x=null;return d&&(a=d,x={uri:d.replace(`${e}/`,"")}),{...t,id:a,contentUrl:a,lodMetricType:Ac.GEOMETRIC_ERROR,lodMetricValue:t.geometricError,transformMatrix:t.transform,type:py(t,a),refine:_y(t.refine),content:x||t.content,children:u}}function YT(t){var e;return((e=t==null?void 0:t.extensions)==null?void 0:e["3DTILES_implicit_tiling"])||(t==null?void 0:t.implicitTiling)}const JT={dataType:null,batchType:null,id:"3d-tiles",name:"3D Tiles",module:"3d-tiles",version:pT,extensions:["cmpt","pnts","b3dm","i3dm"],mimeTypes:["application/octet-stream"],tests:["cmpt","pnts","b3dm","i3dm"],parse:b5,options:{"3d-tiles":{loadGLTF:!0,decodeQuantizedPositions:!1,isTileset:"auto",assetGltfUpAxis:null}}};async function b5(t,e={},i){const r=e["3d-tiles"]||{};let o;return r.isTileset==="auto"?o=(i==null?void 0:i.url)&&i.url.indexOf(".json")!==-1:o=r.isTileset,o?v5(t,e,i):x5(t,e,i)}async function v5(t,e,i){var x;const r=JSON.parse(new TextDecoder().decode(t)),o=(i==null?void 0:i.url)||"",u=w5(o),d=await m5(r,u,e||{});return{...r,shape:"tileset3d",loader:JT,url:o,queryString:(i==null?void 0:i.queryString)||"",basePath:u,root:d||r.root,type:fs.TILES3D,lodMetricType:Ac.GEOMETRIC_ERROR,lodMetricValue:((x=r.root)==null?void 0:x.geometricError)||0}}async function x5(t,e,i){const r={content:{shape:"tile3d",featureIds:null}};return await ET(t,0,e,i,r.content),r.content}function w5(t){return C_(t)}const QT=[0],T5={getPointColor:{type:"accessor",value:[0,0,0,255]},pointSize:1,data:"",loader:JT,onTilesetLoad:{type:"function",value:t=>{}},onTileLoad:{type:"function",value:t=>{}},onTileUnload:{type:"function",value:t=>{}},onTileError:{type:"function",value:(t,e,i)=>{}},_getMeshColor:{type:"function",value:t=>[255,255,255]}};class my extends $1{initializeState(){"onTileLoadFail"in this.props&&Yt.removed("onTileLoadFail","onTileError")(),this.state={layerMap:{},tileset3d:null,activeViewports:{},lastUpdatedViewports:null}}get isLoaded(){var e,i;return!!((i=(e=this.state)==null?void 0:e.tileset3d)!=null&&i.isLoaded()&&super.isLoaded)}shouldUpdateState({changeFlags:e}){return e.somethingChanged}updateState({props:e,oldProps:i,changeFlags:r}){if(e.data&&e.data!==i.data&&this._loadTileset(e.data),r.viewportChanged){const{activeViewports:o}=this.state;Object.keys(o).length&&(this._updateTileset(o),this.state.lastUpdatedViewports=o,this.state.activeViewports={})}if(r.propsChanged){const{layerMap:o}=this.state;for(const u in o)o[u].needsUpdate=!0}}activateViewport(e){const{activeViewports:i,lastUpdatedViewports:r}=this.state;this.internalState.viewport=e,i[e.id]=e;const o=r==null?void 0:r[e.id];(!o||!e.equals(o))&&(this.setChangeFlags({viewportChanged:!0}),this.setNeedsUpdate())}getPickingInfo({info:e,sourceLayer:i}){const r=i&&i.props.tile;return e.picked&&(e.object=r),e.sourceTile=r,e}filterSubLayer({layer:e,viewport:i}){const{tile:r}=e.props,{id:o}=i;return r.selected&&r.viewportIds.includes(o)}_updateAutoHighlight(e){const i=e.sourceTile,r=this.state.layerMap[i==null?void 0:i.id];r&&r.layer&&r.layer.updateAutoHighlight(e)}async _loadTileset(e){const{loadOptions:i={}}=this.props,r=this.props.loader||this.props.loaders,o=Array.isArray(r)?r[0]:r,u={loadOptions:{...i}};let d=e;if(o.preload){const A=await o.preload(e,i);A.url&&(d=A.url),A.headers&&(u.loadOptions.fetch={...u.loadOptions.fetch,headers:A.headers}),Object.assign(u,A)}const a=await $o(d,o,u.loadOptions),x=new o4(a,{onTileLoad:this._onTileLoad.bind(this),onTileUnload:this._onTileUnload.bind(this),onTileError:this.props.onTileError,...u});this.setState({tileset3d:x,layerMap:{}}),this._updateTileset(this.state.activeViewports),this.props.onTilesetLoad(x)}_onTileLoad(e){const{lastUpdatedViewports:i}=this.state;this.props.onTileLoad(e),this._updateTileset(i),this.setNeedsUpdate()}_onTileUnload(e){delete this.state.layerMap[e.id],this.props.onTileUnload(e)}_updateTileset(e){if(!e)return;const{tileset3d:i}=this.state,{timeline:r}=this.context,o=Object.keys(e).length;!r||!o||!i||i.selectTiles(Object.values(e)).then(u=>{this.state.frameNumber!==u&&this.setState({frameNumber:u})})}_getSubLayer(e,i){if(!e.content)return null;switch(e.type){case wo.POINTCLOUD:return this._makePointCloudLayer(e,i);case wo.SCENEGRAPH:return this._make3DModelLayer(e);case wo.MESH:return this._makeSimpleMeshLayer(e,i);default:throw new Error(`Tile3DLayer: Failed to render layer of type ${e.content.type}`)}}_makePointCloudLayer(e,i){const{attributes:r,pointCount:o,constantRGBA:u,cartographicOrigin:d,modelMatrix:a}=e.content,{positions:x,normals:A,colors:M}=r;if(!x)return null;const D=i&&i.props.data||{header:{vertexCount:o},attributes:{POSITION:x,NORMAL:A,COLOR_0:M}},{pointSize:N,getPointColor:U}=this.props,re=this.getSubLayerClass("pointcloud",bm);return new re({pointSize:N},this.getSubLayerProps({id:"pointcloud"}),{id:`${this.id}-pointcloud-${e.id}`,tile:e,data:D,coordinateSystem:Xt.METER_OFFSETS,coordinateOrigin:d,modelMatrix:a,getColor:u||U,_offset:0})}_make3DModelLayer(e){const{gltf:i,instances:r,cartographicOrigin:o,modelMatrix:u}=e.content,d=this.getSubLayerClass("scenegraph",jm);return new d({_lighting:"pbr"},this.getSubLayerProps({id:"scenegraph"}),{id:`${this.id}-scenegraph-${e.id}`,tile:e,data:r||QT,scenegraph:i,coordinateSystem:Xt.METER_OFFSETS,coordinateOrigin:o,modelMatrix:u,getTransformMatrix:a=>a.modelMatrix,getPosition:[0,0,0],_offset:0})}_makeSimpleMeshLayer(e,i){const r=e.content,{attributes:o,indices:u,modelMatrix:d,cartographicOrigin:a,coordinateSystem:x=Xt.METER_OFFSETS,material:A,featureIds:M}=r,{_getMeshColor:D}=this.props,N=i&&i.props.mesh||new sc({topology:"triangle-list",attributes:A5(o),indices:u}),U=this.getSubLayerClass("mesh",Hm);return new U(this.getSubLayerProps({id:"mesh"}),{id:`${this.id}-mesh-${e.id}`,tile:e,mesh:N,data:QT,getColor:D(e),pbrMaterial:A,modelMatrix:d,coordinateOrigin:a,coordinateSystem:x,featureIds:M,_offset:0})}renderLayers(){const{tileset3d:e,layerMap:i}=this.state;return e?e.tiles.map(r=>{const o=i[r.id]=i[r.id]||{tile:r};let{layer:u}=o;return r.selected&&(u?o.needsUpdate&&(u=this._getSubLayer(r,u),o.needsUpdate=!1):u=this._getSubLayer(r)),o.layer=u,u}).filter(Boolean):null}}my.defaultProps=T5,my.layerName="Tile3DLayer";function A5(t){const e={};return e.positions={...t.positions,value:new Float32Array(t.positions.value)},t.normals&&(e.normals=t.normals),t.texCoords&&(e.texCoords=t.texCoords),t.colors&&(e.colors=t.colors),t.uvRegions&&(e.uvRegions=t.uvRegions),e}const yy=512,E5=Math.PI/180;function eA({map:t,gl:e,deck:i}){if(t.__deck)return t.__deck;const r=i==null?void 0:i.props._customRender,o=i==null?void 0:i.props.onLoad,u=rA({...i==null?void 0:i.props,_customRender:()=>{t.triggerRepaint(),r==null||r("")}});let d;return(!i||i.props.gl===e)&&(Object.assign(u,{gl:e,width:null,height:null,touchAction:"unset",viewState:mu(t)}),i!=null&&i.isInitialized?tA(i,t):u.onLoad=()=>{o==null||o(),tA(d,t)}),i?(d=i,i.setProps(u),i.userData.isExternal=!0):(d=new nu(u),t.on("remove",()=>{iA(t)})),d.userData.mapboxLayers=new Set,t.__deck=d,t.on("render",()=>{d.isInitialized&&P5(d,t)}),d}function tA(t,e){const i=()=>{t.isInitialized?B5(t,e):e.off("move",i)};e.on("move",i)}function iA(t){var e;(e=t.__deck)==null||e.finalize(),t.__deck=null}function rA(t){return{...t,parameters:{depthMask:!0,depthTest:!0,blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthFunc:515,blendEquation:32774,...t.parameters},views:t.views||[new Gg({id:"mapbox"})]}}function S5(t,e){t.userData.mapboxLayers.add(e),by(t)}function C5(t,e){t.userData.mapboxLayers.delete(e),by(t)}function I5(t,e){by(t)}function M5(t,e,i){let{currentViewport:r}=t.userData,o=!1;r||(r=sA(t,e,!0),t.userData.currentViewport=r,o=!0),t.isInitialized&&t._drawLayers("mapbox-repaint",{viewports:[r],layerFilter:({layer:u})=>i.id===u.id||u.props.operation.includes("terrain"),clearStack:o,clearCanvas:!1})}function mu(t){var o;const{lng:e,lat:i}=t.getCenter(),r={longitude:(e+540)%360-180,latitude:i,zoom:t.getZoom(),bearing:t.getBearing(),pitch:t.getPitch(),padding:t.getPadding(),repeat:t.getRenderWorldCopies()};return(o=t.getTerrain)!=null&&o.call(t)&&R5(t,r),r}function R5(t,e){if(t.getFreeCameraOptions){const{position:i}=t.getFreeCameraOptions();if(!i||i.z===void 0)return;const r=t.transform.height,{longitude:o,latitude:u,pitch:d}=e,a=i.x*yy,x=(1-i.y)*yy,A=i.z*yy,M=jh([o,u]),D=a-M[0],N=x-M[1],U=Math.sqrt(D*D+N*N),re=d*E5,ne=1.5*r,xe=re<.001?ne*Math.cos(re)/A:ne*Math.sin(re)/U;e.zoom=Math.log2(xe);const Ae=ne*Math.cos(re)/xe,Te=A-Ae;e.position=[0,0,Te/af(u)]}else typeof t.transform.elevation=="number"&&(e.position=[0,0,t.transform.elevation])}function sA(t,e,i=!0){return new Ga({id:"mapbox",x:0,y:0,width:t.width,height:t.height,...mu(e),nearZMultiplier:i?.02:.1,nearZ:e.transform._nearZ/e.transform.height,farZ:e.transform._farZ/e.transform.height})}function P5(t,e){const{mapboxLayers:i,isExternal:r}=t.userData;if(r){const o=Array.from(i,M=>M.id),d=lc(t.props.layers,Boolean).some(M=>M&&!o.includes(M.id));let a=t.getViewports();const x=a.findIndex(M=>M.id==="mapbox"),A=a.length>1||x<0;(d||A)&&(x>=0&&(a=a.slice(),a[x]=sA(t,e,!1)),t._drawLayers("mapbox-repaint",{viewports:a,layerFilter:M=>(!t.props.layerFilter||t.props.layerFilter(M))&&(M.viewport.id!=="mapbox"||!o.includes(M.layer.id)),clearCanvas:!1}))}t.userData.currentViewport=null}function B5(t,e){t.setProps({viewState:mu(e)}),t.needsRedraw({clearRedrawFlags:!0})}function by(t){if(t.userData.isExternal)return;const e=[];t.userData.mapboxLayers.forEach(i=>{const r=i.props.type,o=new r(i.props);e.push(o)}),t.setProps({layers:e})}class D5{constructor(e){if(!e.id)throw new Error("Layer must have an unique id");this.id=e.id,this.type="custom",this.renderingMode=e.renderingMode||"3d",this.map=null,this.deck=null,this.props=e}onAdd(e,i){this.map=e,this.deck=eA({map:e,gl:i,deck:this.props.deck}),S5(this.deck,this)}onRemove(){this.deck&&C5(this.deck,this)}setProps(e){Object.assign(this.props,e,{id:this.id}),this.deck&&I5(this.deck)}render(){M5(this.deck,this.map,this)}}const vy="__UNDEFINED__";function Kf(t,e,i,r){if(!t||!e||!t.style||!t.style._loaded)return;const o=lc(r,Boolean);if(i!==r){const a=lc(i,Boolean),x=new Set(a.map(A=>A.id));for(const A of o)x.delete(A.id);for(const A of x)t.getLayer(A)&&t.removeLayer(A)}for(const a of o){const x=t.getLayer(a.id);x?(x.implementation||x).setProps(a.props):t.addLayer(new D5({id:a.id,deck:e}),a.props.beforeId)}const u=t.style._order,d={};for(const a of o){let{beforeId:x}=a.props;(!x||!u.includes(x))&&(x=vy),d[x]=d[x]||[],d[x].push(a.id)}for(const a in d){const x=d[a];let A=a===vy?u.length:u.indexOf(a),M=a===vy?void 0:a;for(let D=x.length-1;D>=0;D--){const N=x[D],U=u.indexOf(N);U!==A-1&&(t.moveLayer(N,M),U>A&&A++),A--,M=N}}}class O5{constructor(e){this._handleStyleChange=()=>{Kf(this._map,this._deck,this._props.layers,this._props.layers)},this._updateContainerSize=()=>{if(this._map&&this._container){const{clientWidth:o,clientHeight:u}=this._map.getContainer();Object.assign(this._container.style,{width:`${o}px`,height:`${u}px`})}},this._updateViewState=()=>{const o=this._deck;o&&(o.setProps({viewState:mu(this._map)}),o.isInitialized&&o.redraw())},this._handleMouseEvent=o=>{const u=this._deck;if(!u||!u.isInitialized)return;const d={type:o.type,offsetCenter:o.point,srcEvent:o},a=this._lastMouseDownPoint;switch(!o.point&&a&&(d.deltaX=o.originalEvent.clientX-a.clientX,d.deltaY=o.originalEvent.clientY-a.clientY,d.offsetCenter={x:a.x+d.deltaX,y:a.y+d.deltaY}),d.type){case"mousedown":u._onPointerDown(d),this._lastMouseDownPoint={...o.point,clientX:o.originalEvent.clientX,clientY:o.originalEvent.clientY};break;case"dragstart":d.type="panstart",u._onEvent(d);break;case"drag":d.type="panmove",u._onEvent(d);break;case"dragend":d.type="panend",u._onEvent(d);break;case"click":d.tapCount=1,u._onEvent(d);break;case"dblclick":d.type="click",d.tapCount=2,u._onEvent(d);break;case"mousemove":d.type="pointermove",u._onPointerMove(d);break;case"mouseout":d.type="pointerleave",u._onPointerMove(d);break;default:return}};const{interleaved:i=!1,...r}=e;this._interleaved=i,this._props=r}setProps(e){this._interleaved&&e.layers&&Kf(this._map,this._deck,this._props.layers,e.layers),Object.assign(this._props,e),this._deck&&this._deck.setProps(this._interleaved?rA(this._props):this._props)}onAdd(e){return this._map=e,this._interleaved?this._onAddInterleaved(e):this._onAddOverlaid(e)}_onAddOverlaid(e){const i=document.createElement("div");return Object.assign(i.style,{position:"absolute",left:0,top:0,textAlign:"initial",pointerEvents:"none"}),this._container=i,this._deck=new nu({...this._props,parent:i,viewState:mu(e)}),e.on("resize",this._updateContainerSize),e.on("render",this._updateViewState),e.on("mousedown",this._handleMouseEvent),e.on("dragstart",this._handleMouseEvent),e.on("drag",this._handleMouseEvent),e.on("dragend",this._handleMouseEvent),e.on("mousemove",this._handleMouseEvent),e.on("mouseout",this._handleMouseEvent),e.on("click",this._handleMouseEvent),e.on("dblclick",this._handleMouseEvent),this._updateContainerSize(),i}_onAddInterleaved(e){const i=e.painter.context.gl;return i instanceof WebGLRenderingContext&&Yt.warn("Incompatible basemap library. See: https://deck.gl/docs/api-reference/mapbox/overview#compatibility")(),this._deck=eA({map:e,gl:i,deck:new nu({...this._props,gl:i})}),e.on("styledata",this._handleStyleChange),Kf(e,this._deck,[],this._props.layers),document.createElement("div")}onRemove(){const e=this._map;e&&(this._interleaved?this._onRemoveInterleaved(e):this._onRemoveOverlaid(e)),this._deck=void 0,this._map=void 0,this._container=void 0}_onRemoveOverlaid(e){var i;e.off("resize",this._updateContainerSize),e.off("render",this._updateViewState),e.off("mousedown",this._handleMouseEvent),e.off("dragstart",this._handleMouseEvent),e.off("drag",this._handleMouseEvent),e.off("dragend",this._handleMouseEvent),e.off("mousemove",this._handleMouseEvent),e.off("mouseout",this._handleMouseEvent),e.off("click",this._handleMouseEvent),e.off("dblclick",this._handleMouseEvent),(i=this._deck)==null||i.finalize()}_onRemoveInterleaved(e){e.off("styledata",this._handleStyleChange),Kf(e,this._deck,this._props.layers,[]),iA(e)}getDefaultPosition(){return"top-left"}pickObject(e){return yr(this._deck),this._deck.pickObject(e)}pickMultipleObjects(e){return yr(this._deck),this._deck.pickMultipleObjects(e)}pickObjects(e){return yr(this._deck),this._deck.pickObjects(e)}finalize(){this._map&&this._map.removeControl(this)}getCanvas(){return this._map?this._interleaved?this._map.getCanvas():this._deck.getCanvas():null}}class nA{constructor({apiKey:e,accessToken:i="",mode:r="2d",threedTileset:o=HE}){L(this,"olaMaps");L(this,"apiKey");L(this,"accessToken");L(this,"mode");L(this,"threedTileset");this.apiKey=e,this.mode=r,this.threedTileset=o,this.accessToken=i}addOlaLogo(e){var o;if(typeof window>"u")return;const i=document.getElementsByClassName("maplibregl-ctrl-bottom-left");let r="#000";(o=e.style)!=null&&o.includes("dark")&&(r="#FFF");for(let u=0;u<i.length;u++){const d=document.createElement("div");d.style.position="absolute",d.style.bottom="4px",d.style.left="10px",d.style.zIndex="1000",d.innerHTML=GE(r),i[u].appendChild(d)}}addAttribution(){const e=document.querySelectorAll(".maplibregl-ctrl-bottom-right .maplibregl-ctrl-attrib-inner");e==null||e.forEach(i=>{const r=i.querySelector("a");r&&(r.style.display="none");const o="ola-maps-link";if(!i.querySelector(`#${o}`)){const d=document.createElement("a");d.id=o,d.href="https://maps.olakrutrim.com/",d.target="_blank",d.textContent="Ola Maps ",i.appendChild(d)}const u="osm-link";if(!i.querySelector(`#${u}`)){const d=document.createElement("a");d.id=u,d.href="https://www.openstreetmap.org/copyright",d.target="_blank",d.textContent="|  OpenStreetMap contributors",i.appendChild(d)}})}fetchStaticMap(e){try{return fetch(e).then(i=>i.blob())}catch(i){console.log(i)}}async add3dLayer(){if(!this.threedTileset)throw new Error("3d Tileset is not initialized");const e=new my({id:"tile-3d-layer",data:`${this.threedTileset}?api_key=${this.apiKey}`,beforeId:"poi_railway"}),i=new O5({interleaved:!0,layers:[e]});i&&this.olaMaps.on("style.load",()=>{this.olaMaps.setFilter("building-3d",["all",["!has","hide_3d"],["!=","render_as_3d",!0]]),this.olaMaps.addControl(i)})}init(e){this.olaMaps=new po.Map({container:(e==null?void 0:e.container)||"map",center:(e==null?void 0:e.center)||[0,0],zoom:(e==null?void 0:e.zoom)||9,hash:(e==null?void 0:e.hash)||!1,style:(e==null?void 0:e.style)||jE,transformRequest:(o,u)=>{if(this.accessToken)return{url:o,headers:{Authorization:`Bearer ${this.accessToken}`}};{const d=new URL(o);return u!=="Image"&&d.searchParams.append("api_key",this.apiKey),{url:d.toString()}}},...e}),this.mode==="3d"&&this.add3dLayer(),this.addOlaLogo(e),this.addAttribution();const i={};return Object.getOwnPropertyNames(po.Map.prototype).forEach(o=>{typeof this.olaMaps[o]=="function"&&(i[o]=this.olaMaps[o].bind(this.olaMaps))}),Object.keys(Ad).forEach(o=>{typeof Ad[o]=="function"?i[o]=(...u)=>new Ad[o](...u):i[o]=Ad[o]}),Object.getOwnPropertyNames(this.olaMaps).forEach(o=>{o in i||(i[o]=this.olaMaps[o])}),Object.assign(this.olaMaps,i)}addNavigationControls(e){return new po.NavigationControl(e)}addGeolocateControls(e){return new po.GeolocateControl(e)}getMercatorCoordinate(){return po.MercatorCoordinate}addMarker(e){return new po.Marker(e)}addPopup(e){return new po.Popup(e)}getStaticMap(e,i){const r=this.fetchStaticMap(e);r==null||r.then(o=>{const u=URL.createObjectURL(o),d=document.createElement("img");d.src=u;const a=document.getElementById(i);a&&!a.querySelector("img")?a==null||a.appendChild(d):console.log("An image already exists in the element.")}).catch(o=>console.error(o))}}typeof window<"u"&&(window.OlaMaps=nA),Js.OlaMaps=nA,Object.defineProperty(Js,Symbol.toStringTag,{value:"Module"})});
